<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>Introdução à Linguagem R: seus fundamentos e sua prática</title>

    <meta name="author" content="Pedro Faria" />
  
   <meta name="description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
   <meta name="generator" content="placeholder" />
  <meta property="og:title" content="Introdução à Linguagem R: seus fundamentos e sua prática" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="bem-vindo.html" />
  <meta property="og:image" content="bem-vindo.html/capa.png" />
  <meta property="og:description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Introdução à Linguagem R: seus fundamentos e sua prática" />
  
  <meta name="twitter:description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  <meta name="twitter:image" content="bem-vindo.html/capa.png" />
  <!-- JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script>
  <script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script>
    <script src="libs/header-attrs-2.11/header-attrs.js"></script>
    <script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet" />
    <script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script>
    <script src="libs/bs3compat-0.3.1/transition.js"></script>
    <script src="libs/bs3compat-0.3.1/tabs.js"></script>
    <script src="libs/bs3compat-0.3.1/bs3compat.js"></script>
    <link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet" />
    <script src="libs/bs4_book-1.0.0/bs4_book.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script>

  <!-- CSS -->
  
</head>

<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<!--bookdown:title:start-->
<!--bookdown:title:end-->

<!--bookdown:toc:start-->
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book">
    <a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Introdução à Linguagem R: seus fundamentos e sua prática</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
      </form>

      <nav aria-label="Table of contents">
        <h2>Table of contents</h2>
        <div id="book-toc"></div>

        <div class="book-extra">
          <p><a id="book-repo" href="#">View book source <i class="fab fa-github"></i></a></li></p>
        </div>
      </nav>
    </div>
  </header>

  <main class="col-sm-12 col-md-9 col-lg-7" id="content">
<!--bookdown:toc:end-->
<!--bookdown:body:start-->
<div id="bem-vindo" class="section level1 unnumbered">
<h1 class="unnumbered">Bem vindo!</h1>
<p>Olá! Este é o site do livro “Introdução à Linguagem R: seus fundamentos e sua prática.” Aqui você pode ler o conteúdo do livro de maneira eficiente e gratuita. Para mais, você também pode baixar uma versão em PDF deste livro de forma gratuita, através da <a href="https://pedro-faria.netlify.app/pt/publication/book/introducao_linguagem_r/">página de publicação do livro</a>.</p>
<p><img src="capa.jpg" width="350" height="auto" align="right" hspace="20" vspace="20" class="cover"></p>
<p>Lorem ipsum, talvez, quem sabe Aqui você pode ler o conteúdo do livro de maneira eficiente e gratuita. Para mais, você também pode baixar uma versão em PDF deste livro de forma gratuita, através da <a href="https://pedro-faria.netlify.app/pt/publication/book/introducao_linguagem_r/">página de publicação do livro</a>.</p>
<p>Aqui você pode ler o conteúdo do livro de maneira eficiente e gratuita. Para mais, você também pode baixar uma versão em PDF deste livro de forma gratuita, através da <a href="https://pedro-faria.netlify.app/pt/publication/book/introducao_linguagem_r/">página de publicação do livro</a>. Aqui você pode ler o conteúdo do livro de maneira eficiente e gratuita. Para mais, você também pode baixar uma versão em PDF deste livro de forma gratuita, através da <a href="https://pedro-faria.netlify.app/pt/publication/book/introducao_linguagem_r/">página de publicação do livro</a>.</p>
<!--chapter:end:index.Rmd-->
<!--chapter:end:setup.Rmd-->
<p><strong>Pedro Duarte Faria</strong></p>
<p>Pedro Duarte Faria é economista formado pela Universidade Federal de
Ouro Preto - UFOP, e professor apaixonado pela linguagem R.
Atualmente é Analista de Performance e Inteligência
de Negócios em Take Blip.</p>
<p>Já ministrou vários cursos sobre a linguagem R, dentro de centros de pós-graduação
além de organizações federais e estaduais.
Vem programando a quatro anos com a linguagem R,
construindo programas, relatórios e análises para instituições de pesquisa e grandes empresas do país. Como pesquisador, tem experiência em especial na
área de Economia da Ciência, Tecnologia e Inovação.</p>
<p>Lattes: </p>
<p>Site pessoal: </p>
<p>Twitter: </p>
<p></p>
<p>João Pedro Figueira Amorim Parga é mestre em Economia pelo CEDEPLAR-UFMG
(2020), e possui graduação em Economia pela mesma instituição. Atualmente é Pesquisador Assistente
no Instituto de Pesquisa Econômica Aplicada (IPEA). Possui
experiência em Economia Regional e Urbana, especialmente nos seguintes
temas: distribuição espacial de atividades econômicas, setor de
serviços, ciência de dados, habitação, aglomeração espacial e geografia
econômica.</p>
<p>Lattes: </p>
<p>Este livro surgiu inicialmente, como um material de apoio aos pesquisadores e alunos do Curso Introdutório de R, que foi realizado durante o primeiro semestre de 2020, na Fundação João Pinheiro<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a> (FJP-MG). O projeto foi idealizado na época, por um conjunto de três pessoas, dentre elas, estão os autores desta obra: Pedro Duarte Faria e João Pedro Figueira Amorim Parga.</p>
<p>Portanto, esse material é resultado dessa experiência de ensino, onde buscamos compartilhar conhecimentos sobre essa linguagem com outras pessoas. Eu como professor, aluno e economista, sou muito grato por ter compartilhado essas experiências, com meu querido colega João Pedro Figueira Amorim Parga, que me ajudou a montar este livro.</p>
<p>As origens da linguagem R, remetem a um dos mais importantes laboratórios de pesquisa do mundo, a Bell Labs, localizada nos EUA. Por sua origem, a enorme maioria dos materiais de referência a respeito da linguagem, estão em inglês, incluindo as principais fontes de ajuda da linguagem, como o <a href="https://stackoverflow.com/questions/tagged/r">StackOverflow</a>, ou as páginas e manuais internos do <a href="https://cran.r-project.org/">CRAN R</a>.</p>
<p>Entretanto, a comunidade de R no Brasil, tem se expandido constantemente nos últimos anos. Brasileiros tem desenvolvido importantes pacotes para a linguagem, que trazem grande apoio à produção científica do país. Apenas para citar alguns desses excelentes trabalhos, estão <span class="citation">(<a href="#ref-geobr" role="doc-biblioref">Pereira et al. 2020</a>; <a href="#ref-read_dbc" role="doc-biblioref">Petruzalek 2016</a>; <a href="#ref-cepr" role="doc-biblioref">McDonnell, Oliveira, and Giannotti 2020</a>; <a href="#ref-sidrar" role="doc-biblioref">Siqueira 2020</a>; <a href="#ref-pnadc" role="doc-biblioref">Braga, Assuncao, and Hidalgo 2020</a>)</span>.</p>
<p>Como resultado, bons materiais em português, de referência e apoio à linguagem tem surgido. Exemplos são: os materiais curtos montados pelo <a href="https://www.curso-r.com/material/">Curso R</a>; os trabalhos realizados pelos capítulos brasileiros do grupo <a href="https://rladies.org/">R-Ladies</a>, como os <a href="https://medium.com/rladiesbh">posts do capítulo de Belo Horizonte</a>, e os <a href="https://www.meetup.com/pt-BR/rladies-sao-paulo/">encontros desenvolvidos pelo capítulo de São Paulo</a>; além de alguns materias produzidos pelo Departamento de Estatística da UFPR, como um <a href="http://cursos.leg.ufpr.br/ecr/">site de apoio ao seu curso</a>, ou este produzido por um dos professores do departamento, o <a href="http://leg.ufpr.br/~walmes/cursoR/data-vis/">Dr. Walmes Marques Zeviani</a>.</p>
<p>Porém, mesmo com esse avanço, grande parte desses conteúdos em português geralmente caem em algum desses dois problemas: 1) carecem de profundidade, ou de detalhamento sobre o que está “ocorrendo nos bastidores.” Em outras palavras, esses materiais são muito abstratos, pois tentam abordar muita coisa em um espaço muito curto, sem dar o devido tempo a cada um dos componentes por trás da linguagem; 2) ou são especializados demais. Por exemplo, materiais que ensinam como estimar modelos específicos (ex: regressão linear sobre dados em painel), ou a trabalhar com bases de dados específicas (ex: PNAD contínua). Em outras palavras, esses materiais concedem em geral, uma visão muito restrita sobre a linguagem, e que é de difícil transposição para outros cenários e necessidades práticas.</p>
<p>Esses problemas emergem do próprio objetivo que esses materiais buscam cumprir. Como exemplo, os materiais escritos pelo <a href="https://www.curso-r.com/">Curso-R</a> carregam certa abstração, pois em nenhum momento esses materiais pretendem oferecer uma revisão completa e profunda sobre o tema, mas sim, tutoriais rápidos e úteis, que lhe mostram o básico.</p>
<p>Tendo isso em mente, esta obra em específico, representa a nossa tentativa de combater esses dois problemas. Ao discutir pacotes largamente utilizados nas mais diversas aplicações, além de fornecer uma visão aprofundada sobre os fundamentos (ou a teoria) da linguagem R. Por isso, o público-alvo deste livro são os brasileiros que desejam obter uma base mais sólida e uma visão mais abrangente da linguagem, de forma que eles possam identificar mais facilmente, as possíveis soluções que o R oferece para vários problemas de seu trabalho.</p>
<p>Por essas razões, este material é até certo ponto, prolixo em muitos assuntos aos quais são comumente tratados como simples e rápidos de se compreender (e.g. Objetos). Ao mesmo tempo, este material certamente busca ser descritivo, e não poupa detalhes em assuntos que são complexos e de difícil compreensão (e.g. Funções e <em>Loops</em>). Para mais, fornecemos ao longo da obra, diversos diagramas e representações visuais, que ajudam o leitor, a formar um modelo mental sobre como a linguagem R funciona. A obra também oferece exercícios ao final de cada capítulo, e suas respostas estão disponíveis na página de publicação do livro.</p>
<p>Vários exemplos são fornecidos em cada tópico. Alguns desses exemplos são reais e retirados diretamente de nosso dia-a-dia com a linguagem. Já uma outra parte desses exemplos, buscam evidenciar ou demonstrar problemas práticos que podem emergir de seu trabalho com a linguagem e, portanto, mostrar quais são as possíveis soluções a serem empregadas. Dessa forma, podemos construir um <em>workflow</em>, ou um modelo mental de trabalho com a linguagem, ao longo de diferentes tópicos importantes para a sua aplicação prática em análise de dados.</p>
<p>Você sempre pode encontrar uma versão atualizada desta obra, em sua <a href="https://pedro-faria.netlify.app/pt/publication/book/introducao_linguagem_r/">página de publicação</a>. Este documento foi criado dentro do RStudio, por meio do pacote <code>rmarkdown</code> e do sistema . Grande parte do conhecimento exposto aqui, está baseado em diversas referências sobre a linguagem R, em especial os trabalhos de <span class="citation">(<a href="#ref-wickham2015_advanced" role="doc-biblioref">Wickham 2015a</a>; <a href="#ref-peng2015" role="doc-biblioref">Peng 2015</a>; <a href="#ref-wickham2017" role="doc-biblioref">Wickham and Grolemund 2017</a>; <a href="#ref-long2019" role="doc-biblioref">Long and Teetor 2019</a>)</span>,
assim como a documentação oficial da linguagem R <span class="citation">(<a href="#ref-Rlanguage" role="doc-biblioref">R Core Team 2020b</a>, <a href="#ref-Rintroduction" role="doc-biblioref">2020a</a>)</span>.</p>
<p>Esta terceira edição traz muitas novidades. Temos seis novos capítulos, os quais compõe uma nova parte do livro e, trazem consigo, grandes avanços sobre o processo de desenvolvimento de programas no R. Além disso, várias melhorias foram feitas em seções específicas do livro, especialmente sobre o capítulo 2.</p>
<p>Primeiro, houve uma reorganização significativa do livro. Os capítulos pré-existentes foram reorganizados em quatro partes diferentes. Já a quinta e nova parte (Funções e <em>Loops</em>: construindo os seus próprios programas e automatizando tarefas) é composta pelos seis novos capítulos introduzidos nesta edição.</p>
<p>Segundo, o capítulo de Funções e <em>Loops</em> foi completamente reescrito, expandido, e, repartido em dois novos capítulos. Mais especificamente, os capítulos 14 (Funções) e 15 (<em>Loops</em>) desta edição.</p>
<p>Terceiro, o capítulo 16 desta edição traz uma das novidades programadas desde a segunda edição: um novo (e robusto) capítulo sobre <em>functional programming</em>. Com essa adição, esta obra se torna uma referência mais moderna e, se aproxima dos padrões adotados hoje pela comunidade internacional de R.</p>
<p>Quarto, várias adições e melhorias foram feitas no capítulo 2 (Fundamentos da Linguagem R). Dentre elas, temos: um novo estudo de caso (Importando os dados da PINTEC); novas seções sobre as funções <code>str()</code> e <code>is.*()</code>; além de melhorias significativas sobre as seções de Coerção no R e Valores especiais do R.</p>
<p>Quinto, um novo e pequeno capítulo foi adicionado à segunda parte do livro, com o objetivo de introduzir o universo do <code>tidyverse</code> ao leitor de maneira mais clara e amigável.</p>
<p>Sexto, o apêndice contendo as respostas dos exercícios foi retirado, com o objetivo de reduzir o número de páginas do livro. Consequentemente, as respostas dos exercícios estão sendo disponibilizadas em um PDF separado, o qual pode ser baixado gratuitamente, a partir da página de publicação do livro<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a>.</p>
<p>A resposta curta é: uma parte crescente de nosso trabalho é realizada dentro de um computador, e a linguagem R nos permite comunicar as nossas intenções e necessidades para esse computador de maneira muito mais precisa e eficiente.</p>
<p>Temos dependido cada vez mais de computadores para desenvolver as nossas tarefas. Isso vale tanto para secretários, que precisam enviar e-mails, organizar agendas e reuniões; ou para engenheiros, que precisam desenhar plantas e calcular volumes de materiais; ou para analistas, que precisam construir planilhas, calcular indicadores e construir relatórios; e para várias outras categorias de profissionais.</p>
<p>Como um outro exemplo, praticamente a totalidade da ciência atual é desenvolvida dentro de um computador. Todo cientista precisa (em algum momento) escrever um artigo científico, e, tal atividade geralmente é feita hoje em programas como Microsoft Word, LibreOffice e Latex. Além disso, cientistas usam computadores para desenvolver experimentos nas mais diversas áreas da ciência, seja simulando cenários, ou desenvolvendo modelos computacionais que explicam a realidade que nos cerca.</p>
<p>Saber como se comunicar com o seu computador nunca foi tão importante como nos dias de hoje. Se você possui esse tipo de conhecimento, você é capaz de dizer ao seu computador, exatamente o que você precisa que ele faça, e, com isso, você pode deixar o trabalho duro com ele. Ou seja, você é capaz de delegar e automatizar tarefas, pois o seu computador passa a realizar esse trabalho por você. Consequentemente, você consegue realizar mais trabalho, em menos tempo.</p>
<p>Computadores falam um único idioma, que é o código binário (ou <em>machine code</em>). Entretanto, este idioma é extremamente complicado para nós seres humanos. Por esse conflito, programadores e cientistas criaram o que chamamos de linguagens de programação. A linguagem R é uma dessas várias linguagens existentes.</p>
<p>Uma linguagem de programação é uma espécie de idioma intermediário, que utilizamos para criar um programa. Um programa é um conjunto de instruções que podem ser seguidas e executadas por um computador com o objetivo de desempenhar uma atividade específica.</p>
<p>Sendo assim, nós utilizamos uma linguagem de programação (como a linguagem R) para dizer aos nossos computadores, o que eles devem fazer, quais são os elementos envolvidos nessa atividade, com quem ou o quê o computador deve se comunicar, de onde ele deve extrair os recursos, e como ele vai combinar esses recursos e calcular o resultado que desejamos obter ao final dessa atividade.</p>
<p>Essa atividade pode ser qualquer coisa, desde enviar um e-mail todos os dias para a diretoria, contendo o último relatório gerado, ou, estimar um modelo com os dados mais recentes do Yahoo Finance, até reorganizar um conjunto de planilhas do Excel no formato adequado para serem inseridas em uma base de dados.</p>
<p>Como uma parte cada vez maior do trabalho humano está sendo realizada através de computadores, existe um conjunto crescente de atividades, problemas e desafios que você pode solucionar ao construir um programa através de uma linguagem como o R.</p>
<p>Como exemplo, programas como Adobe Photoshop e Figma foram desenvolvidos a partir do momento em que designers precisavam desenhar sites, materiais, artes e documentos para o mundo digital da web. Logo, antes desse período, não existiam grandes motivos para desenharmos através de computadores.</p>
<p>Ou seja, uma necessidade surgiu, e por essa necessidade, certas pessoas utilizaram uma linguagem de programação para construir um programa que permitisse que os designers desenvolvessem o seu trabalho dentro de um computador. Como exemplo, tanto o Figma quanto o Adobe Photoshop são programas construídos a partir da linguagem C++.</p>
<p>Imagine por exemplo, criar um programa capaz de controlar um robô que está a milhares de quilômetros de distância. Na verdade, esse programa já existe. A NASA (agência espacial americana) possui diversos projetos focados em robótica e automação, e tem desenvolvido vários programas para controlar (à distância) os seus robôs espaciais. Você pode saber mais desses programas, ao navegar pelo site do <a href="https://software.nasa.gov/">programa de transferência tecnológica da agência</a> (NASA’S TECHNOLOGY TRANSFER PROGRAM).</p>
<p>Em resumo, linguagens como Python e R possuem um nível de abstração mínimo, que facilita muito a sua compreensão e o seu trabalho com elas. Por outro lado, devido a essas escolhas, essas linguagens (Python e R) não são particularmente rápidas se comparadas com outras linguagens que lhe obrigam a especificar cada componente de sua análise, como as linguagens C e C++. Pois o computador tem de reservar um tempo para calcular e compilar essas especificações por você.</p>
<p>Porém, essas linguagens ainda assim são muito mais rápidas do que programas como Excel, e lidam muito melhor com grandes volumes de dados. Por exemplo, se você usa o Excel em seu trabalho, você provavelmente sabe que as suas versões mais recentes são capazes de abrir arquivos com mais de 1 milhão de linhas. Mas se você já tentou, por exemplo, adicionar uma nova coluna a este arquivo, você rapidamente percebeu que o Excel não foi feito para lidar eficientemente com arquivos desta magnitude.</p>
<p>Com linguagens como o R, você possui uma capacidade de processamento maior, e os seus problemas geralmente se limitam a quantidade de memória que você possui em seu computador. Se você possui memória suficiente para alocar uma tabela com mais de 1 milhão de linhas, o seu trabalho com esses dados será muito mais rápido e eficiente no R. E como os componentes de computadores tem ficado cada vez mais baratos, essa vantagem tende a aumentar com o tempo. Hoje, um cartucho de 16GB de RAM (que já é uma quantidade muito boa de memória) é muito mais barato, do que ele era a 10 anos atrás.</p>
<p>Vamos a um exemplo prático! Eu comecei a aplicar a linguagem R, quando ainda trabalhava na Diretoria de Estatística e Informações da Fundação João Pinheiro (FJP) como estagiário. A FJP é uma instituição de pesquisa ligada à Secretaria de Estado de Planejamento e Gestão de Minas Gerais, e é responsável pela produção e divulgação das principais estatísticas econômicas e demográficas do estado de Minas Gerais.</p>
<p>Na época, uma de minhas responsabilidades era a produção de mapas temáticos para os informativos mensais de PIB das regiões intermediárias do estado. Eu poderia fabricar esses mapas, utilizando programas especializados como o QGis. Porém, utilizar o QGis, tornava a atividade repetitiva e manual.</p>
<p>Para mais, cada uma das etapas do processo (importar os dados de PIB, importar os <em>shapefiles</em>, escolher as cores do mapa, escolher os títulos e rótulos, criar uma legenda, etc.) não eram salvas em algum lugar. Consequentemente, o mapa criado no QGis, não era reproduzível!</p>
<p>Essas considerações são muito importantes, pois quase sempre eu tinha que reconstruir o mapa. Seja porque o editorial sugeria o uso de novas cores, ou porque o tamanho da fonte estava pequeno, ou principalmente, porque erros podem surgir no processo! Se o mapa gerado pelo QGis possui um erro, seja por falha humana ou do computador, eu tenho que recomeçar o trabalho do zero, pois as etapas do processo não foram salvas de alguma forma.</p>
<p>É tendo essas preocupações em mente, que eu construí na época, um <em>script</em> no R (isto é, um programa), que guarda todos os comandos necessários para produzir esses mapas. Dessa maneira, não apenas cada etapa do processo é contida e salva em cada comando do R utilizado, mas eu também posso reproduzir cada uma dessas etapas (ou comandos), com muita facilidade, ao longo de vários pontos diferentes.</p>
<p>Isso significa, por exemplo, que eu posso criar um mapa com as mesmas especificações, para cada uma das 13 regiões intermediárias, em questão de segundos, e utilizando apenas 1 comando. Caso eu precise, também posso expandir esse programa, para gerar um mapa com as mesmas especificações, para todas as regiões intermediárias do país. Novamente, esses mapas são gerados em questão de segundos, pois computadores são extremamente rápidos em seus cálculos.</p>
<p>A figura abaixo, é uma representação deste <em>script</em>, onde delimito cada uma das etapas que o R realiza para construir esses mapas por mim. Se a nossa equipe descobre um erro no mapa, eu posso voltar ao <em>script</em>, e executá-lo parte por parte, e descobrir em qual delas o erro surge. Será que eu errei ao filtrar os dados? Ou o R não conseguiu gerar o gráfico corretamente? Ou será que o erro aparece antes mesmo de eu importar os dados para o R?</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/plot_exemplo_mod.png" alt="Um exemplo de script contendo comandos do R" width="70%" />
<p class="caption">
(#fig:unnamed-chunk-2)Um exemplo de script contendo comandos do R
</p>
</div>
<p></p>
<p>A partir do momento em que eu descubro em qual parte de meu <em>script</em> o erro ocorre, eu posso corrigir o erro naquele local em específico, e após me assegurar de que tudo está ok, eu posso executar todo o <em>script</em> novamente, e assim, o novo mapa contendo as correções aplicadas é gerado em questão de segundos. Dessa forma, eu estou automatizando as etapas repetitivas que possuo em meu trabalho, e não preciso começar do zero caso algum erro ocorra durante o processo.</p>
<p>Neste caso, eu posso inclusive criar alguns processos automatizados que conferem a robustez dos dados, para evitar que erros humanos gerem mais dor de cabeça do que o necessário. Por exemplo, se na minha base de dados, cada linha representa um município de Minas Gerais, eu posso criar um sistema que confere se esta base possui 853 linhas (número total de municípios no estado de Minas Gerais). Como os mapas são geralmente produzidos para cada região intermediária do estado, eu posso também, me certificar que o número de linhas (ou o número de municípios) que compõe cada região intermediária dessa base, estão corretos.</p>
<p>A linguagem R possui vários pacotes e interfaces que facilitam a sua conexão com servidores e outras linguagens. Exemplos são os pacotes <code>DBI</code> e <code>odbc</code>, que são muito utilizados para a conexão de sua sessão do R, com servidores SQL (<em>Structured Query Language</em>). Com essa conexão, você pode puxar resultados de <em>queries</em> direto do servidor para a sua sessão do R.</p>
<p>Outro exemplo, é o pacote <code>Rcpp</code> que provê uma boa interface entre o R e a linguagem C++. Com este pacote, você pode misturar comandos em C++ com os seus comandos em R, com o objetivo de utilizar uma linguagem mais rápida (C++) em processos que são, por natureza, muito trabalhosos para o seu computador.</p>
<p>Além disso, tanto o Python quanto o R, possuem interfaces para se comunicar entre si. Isto é uma ferramenta muito poderosa! Pois você pode se aproveitar do melhor que as duas principais linguagens utilizadas em análise de dados oferecem. O R possui um arsenal estatístico melhor do que o Python, porém, ele não possui a conectividade e amplitude de aplicações que o Python oferece. No caso do R, o pacote <code>reticulate</code> fornece tal interface para o interpretador do Python.</p>
<p>Para mais, grandes esforços tem sido empregado no desenvolvimento de pacotes voltados para serviços web. Uma área que até pouco tempo, possuía pouco suporte dentro da linguagem R. Hoje, você já pode criar sites (pacote <code>blogdown</code>), dashboards interativos em HTML (pacote <code>shiny</code>), além de REST APIs (pacote <code>plumber</code>) com os recursos disponíveis. Também há pacotes como <code>httr</code> e <code>rvest</code>, que possibilitam a realização de atividades de <em>web scrapping</em>. Além dos pacotes <code>xml2</code> e <code>jsonlite</code>, que permitem a leitura de dados em XML e JSON, respectivamente. Para esse tópico, você pode descobrir mais pacotes na seção de <a href="https://cran.r-project.org/web/views/WebTechnologies.html">Web Technologies do CRAN R</a>.</p>
<p>Por último, o time da Microsoft, também tem desenvolvido interfaces em seus serviços da Azure Cloud Computing, permitindo que você utilize R em seus projetos na plataforma. Caso esteja interessado nisso, você pode consultar a página da empresa sobre este serviço<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a>.</p>
<p>O R é uma linguagem gratuita e <em>open source</em> e, por isso, o seu crescimento como linguagem depende não apenas da fundação que a mantém e a atualiza (<em>R Foundation</em>), mas também depende de sua comunidade que está o tempo todo discutindo, inovando e abrindo novos caminhos, tudo isso de forma aberta e gratuita. Esta obra é uma contribuição a essa comunidade e um convite a você. Venha para a comunidade de R!</p>
<p>Portanto, a comunidade é um dos principais ativos da linguagem R (e também do Python). Grande parte dessa comunidade, está concentrada no <a href="https://twitter.com/">Twitter</a>. Mas essa comunidade também está muito presente em blogs, comentando novas soluções e recursos para a linguagem (sendo o <a href="https://www.tidyverse.org/blog/">Tidyverse blog</a>, <a href="https://rweekly.org/">Rweekly</a> e <a href="https://ropensci.org/">ROpensci</a> os principais exemplos) e, com isso, você pode se manter atualizado sobre o que a linguagem oferece. Por outro lado, parte desses blogs, possuem um foco maior em tutoriais, e representam assim, um local em que você sempre pode aprender mais sobre o R (o principal exemplo dessa categoria se trata do <a href="https://www.r-bloggers.com/">R-Bloggers</a>).</p>
<p>Recentemente, um novo e excelente centro de discussão foi criado pela comunidade, denominado <a href="https://www.rfordatasci.com/">R4DS Online Learning Community</a>, um nome que claramente se refere a obra de <span class="citation"><a href="#ref-wickham2017" role="doc-biblioref">Wickham and Grolemund</a> (<a href="#ref-wickham2017" role="doc-biblioref">2017</a>)</span>. Esse é um ótimo local para criar conversas com membros da comunidade, e pedir por ajuda em algum problema que você esteja enfrentando.</p>
<p>Além disso, a comunidade de R também possui forte presença no <a href="https://stackoverflow.com/questions/tagged/r">StackOverflow</a>, que é comumente caracterizado como o principal canal de dúvidas e de ajuda em diversas linguagens de programação. Logo, se você não sabe como realizar um processo, ou não consegue descobrir de onde um erro está surgindo em seu <em>script</em>, você pode pedir por ajuda da comunidade ao postar uma pergunta, ou encontrar uma pergunta parecida com o seu problema que já foi respondida no <a href="https://stackoverflow.com/questions/tagged/r"><em>StackOverflow</em></a>.</p>
<p>No caso do Brasil, a principal força motriz de nossa comunidade provavelmente se encontra nos capítulos brasileiros do <a href="https://rladies.org/">R-Ladies global</a>, além do blog <a href="https://www.curso-r.com/blog/">Curso-R</a>. Por exemplo, temos os encontros mensais online realizados pelo <a href="https://www.meetup.com/pt-BR/rladies-sao-paulo/">capítulo de São Paulo</a>, além dos bons tutoriais escritos pelo <a href="https://medium.com/rladiesbh">capítulo de Belo Horizonte</a>. Existem também, outros capítulos no Brasil<a href="#fn4" class="footnote-ref" id="fnref4"><sup>4</sup></a>, que também realizam alguns encontros.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/code_hero.jpg" alt="Code Hero por Allison Horst" width="80%" />
<p class="caption">
(#fig:unnamed-chunk-3)Code Hero por Allison Horst
</p>
</div>
<p></p>
<!--chapter:end:prefacio.Rmd-->
</div>
<div id="part-introduzindo-a-linguagem-r" class="section level1 unnumbered">
<h1 class="unnumbered">(PART) Introduzindo a Linguagem R</h1>
</div>
<div id="noções-básicas-do-r" class="section level1" number="1">
<h1 number="1"><span class="header-section-number">1</span> Noções Básicas do R</h1>
<div id="uma-descrição-do-r" class="section level2" number="1.1">
<h2 number="1.1"><span class="header-section-number">1.1</span> Uma descrição do R</h2>
<div id="história-do-r" class="section level3" number="1.1.1">
<h3 number="1.1.1"><span class="header-section-number">1.1.1</span> História do R</h3>
<p>A linguagem R, nasceu durante a década de 90, inicialmente como um projeto de pesquisa de Ross Ihaka e Robert Gentleman, ambos estatísticos e pesquisadores associados na época ao departamento de estatística da Universidade de Auckland <span class="citation">(<a href="#ref-ihaka1996" role="doc-biblioref">Ihaka and Gentleman 1996</a>)</span>. Porém, as origens da linguagem R retornam a década de 70, com o desenvolvimento da linguagem S, em um dos mais importantes laboratórios de pesquisa do mundo, a Bell Labs <span class="citation">(<a href="#ref-peng2015" role="doc-biblioref">Peng 2015</a>)</span>.</p>
<p>Pois como foi descrito por <span class="citation"><a href="#ref-ihaka1996" role="doc-biblioref">Ihaka and Gentleman</a> (<a href="#ref-ihaka1996" role="doc-biblioref">1996</a>)</span>, a linguagem R foi desenvolvida com fortes influências das linguagens S e Scheme. Sendo que a própria sintaxe da linguagem R, se assemelha muito a da linguagem S. Por isso, muitos autores como <span class="citation"><a href="#ref-peng2015" role="doc-biblioref">Peng</a> (<a href="#ref-peng2015" role="doc-biblioref">2015</a>)</span> e <span class="citation"><a href="#ref-chambers2008" role="doc-biblioref">Chambers</a> (<a href="#ref-chambers2008" role="doc-biblioref">2008</a>)</span>, caracterizam a linguagem R como um dialeto da linguagem S. Segundo <span class="citation"><a href="#ref-ihaka1996" role="doc-biblioref">Ihaka and Gentleman</a> (<a href="#ref-ihaka1996" role="doc-biblioref">1996</a>)</span> a linguagem S representava uma forma concisa de se expressar ideias e operações estatísticas para um computador e, por isso, foi uma fonte de inspiração importante para o R. Em outras palavras, comparado às demais linguagens, a linguagem S oferecia uma sintaxe mais atrativa e confortável para estatísticos executarem as suas ideias, e grande parte dessa sintaxe, foi transportada para o R.</p>
</div>
<div id="r" class="section level3" number="1.1.2">
<h3 number="1.1.2"><span class="header-section-number">1.1.2</span> R</h3>
<p>R é um <em>software</em> estatístico que oferece um ambiente para análise interativa de dados, e que conta com uma poderosa linguagem de programação, e é dessa linguagem que vamos tratar neste livro. Diferente de outras linguagens como C e C++, que são linguagens compiladas, a linguagem R é uma linguagem interpretada. Isso significa, que para trabalharmos no R, vamos estar constantemente enviando comandos escritos para o Console do programa, e esse Console vai avaliar os comandos que enviarmos (segundo as “regras gramaticais” da linguagem R), antes de executá-los.</p>
<p>Logo, o console é o coração do R, e a mais importante ferramenta do programa <span class="citation">(<a href="#ref-adler2010" role="doc-biblioref">Adler 2010</a>, p 11)</span>, pois é nele que se encontra o interpretador que vai avaliar e executar todos os nossos comandos. O uso de uma linguagem de programação, representa uma maneira extremamente eficiente de se analisar dados, e que de certa forma, adquire um aspecto interativo no R, ou cria uma sensação de que estamos construindo (interativamente) uma conversa com o console. Ou seja, o trabalho no R funciona da seguinte maneira: 1) você envia um comando para o console; 2) o comando é avaliado pelo console e é executado; 3) o resultado desse comando é retornado pelo console; 4) ao olhar para o resultado, você analisa se ele satisfaz os seus desejos; 5) caso não, você faz ajustes em seu comando (ou utiliza um comando completamente diferente), e o envia novamente para o console; e assim, todo o ciclo recomeça.</p>
</div>
<div id="sec:sistema_universo_r" class="section level3" number="1.1.3">
<h3 number="1.1.3"><span class="header-section-number">1.1.3</span> O sistema e universo do R</h3>
<p>O universo do R pode ser divido em duas partes, sendo elas:</p>
<ol style="list-style-type: decimal">
<li><p>O sistema “básico” do R, que é composto pelos pacotes básicos da linguagem. Esses pacotes são a base da linguagem R, e são comumente chamados pela comunidade, por <code>base R</code>. Pois diversas das funções básicas do R, advém de um pacote chamado <code>base</code>. Lembrando que você pode baixar e instalar esses pacotes básicos, pelo site do <a href="https://cran.r-project.org">Comprehensive R Archive Network (CRAN R)</a>.</p></li>
<li><p>Todo o resto, ou mais especificamente, todos os pacotes externos ao sistema “básico,” desenvolvidos pelo público em geral da linguagem. A grande maioria desses pacotes também estão disponíveis através do <a href="https://cran.r-project.org">Comprehensive R Archive Network (CRAN R)</a>, mas alguns outros estão presentes apenas em outras plataformas, como o <a href="https://github.com/">GitHub</a>.</p></li>
</ol>
<p>Todas as funcionalidades e operações disponíveis no R, são executadas através de suas funções, e essas funções são divididas em “pacotes.” O sistema “básico” do R, contém um conjunto de pacotes que oferecem as funcionalidades básicas da linguagem. Alguns desses pacotes básicos, são <code>base</code> (fornece funções de uso geral) e <code>stats</code> (fornece funções para análises e operações estatísticas). Caso você precise de funcionalidades que vão além do que está disponível neste sistema “básico,” ou neste conjunto de pacotes “básicos” do R, é neste momento em que você precisa instalar outros pacotes que estão fora desse sistema “básico,” e que oferecem funções que possam executar as funcionalidades que você deseja. Vamos dissecar alguns desses pacotes “externos” ao longo deste material, com especial atenção ao conjunto de pacotes fornecidos pelo <a href="https://www.tidyverse.org/"><code>tidyverse</code></a>.</p>
<p>Pelo fato do R ser gratuito e <em>open source</em>, várias pessoas estão constantemente desenvolvendo novas funcionalidades, e efetivamente expandindo o universo da linguagem R. Esses pacotes desenvolvidos pelos próprios usuários da linguagem, servem como grande apoio ao trabalho de outros usuários. Ou seja, se você possui um problema a sua frente, é muito provável que alguém tenha enfrentado o mesmo problema, ou algo próximo, e que tenha desenvolvido uma solução para aquele problema no formato de um pacote do R. Assim, você pode resolver os seus problemas, com a ajuda do trabalho de outras pessoas que passaram pelas mesmas dificuldades.</p>
</div>
<div id="rstudio" class="section level3" number="1.1.4">
<h3 number="1.1.4"><span class="header-section-number">1.1.4</span> RStudio</h3>
<p>O RStudio, é um Ambiente de Desenvolvimento Integrado (<em>Integrated Development Environment</em> - IDE, em inglês) para o R. Em síntese, esse programa oferece um ambiente com diversas melhorias, atalhos e ferramentas que facilitam de maneira expressiva, o seu trabalho com o R. Algumas dessas funcionalidades incluem: indentação automática, realces de código, menus rápidos para importação e exportação de arquivos, além de diversos atalhos de teclado úteis. Sendo, portanto, uma ferramenta muito recomendada para qualquer usuário que venha a trabalhar com a linguagem R <span class="citation">(<a href="#ref-gillespie2017" role="doc-biblioref">Gillespie and Lovelace 2017</a>)</span>.</p>
<p>Para encontrar mais detalhes sobre o programa, você pode consultar o <a href="https://rstudio.com">site oficial do RStudio</a>.</p>
</div>
</div>
<div id="introdução-ao-r-e-rstudio-noções-básicas" class="section level2" number="1.2">
<h2 number="1.2"><span class="header-section-number">1.2</span> Introdução ao R e RStudio: noções básicas</h2>
<div id="sec:console" class="section level3" number="1.2.1">
<h3 number="1.2.1"><span class="header-section-number">1.2.1</span> Executando comandos: Console</h3>
<p>Você trabalha no R através de sua linguagem de programação. Você importa os seus dados, remove ou acrescenta colunas, reordena a sua base, constrói gráficos, e estima os seus parâmetros, através de comandos escritos que devem ser interpretados e executados pelo Console. Qual o porquê de tudo isso? Por que precisamos de um console para interpretar os nossos comandos? A resposta se encontra no fato de que o seu computador não fala a sua língua!</p>
<p>Ou seja, o seu computador não sabe o que os verbos “ordenar” e “selecionar” significam, estejam eles em qualquer língua humana que você conseguir imaginar agora. Pois o seu computador, só fala e compreende uma única língua, que é extremamente difícil para nós seres humanos, que são os <em>bits</em> ou <em>bytes</em> de informação. Se quisermos nos comunicar com o nosso computador, e passarmos instruções e comandos para serem executados por ele, nós devemos repassar essas informações como <em>bits</em> de informação. Com isso, o trabalho do Console, e principalmente do interpretador presente nele, é o de traduzir os seus comandos escritos na linguagem R (que nós seres humanos conseguimos entender), para comandos em <em>bits</em>, de forma que o seu computador possa compreender o que você está pedindo a ele que faça.</p>
<p>Tanto no programa padrão do R, quanto no RStudio, o console se localiza a esquerda de sua tela, como mostrada na figura 1.1:</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/r_console.png" alt="Consoles no R padrão (à esquerda) e no RStudio (à direita)" width="90%" />
<p class="caption">
(#fig:unnamed-chunk-4-1)Consoles no R padrão (à esquerda) e no RStudio (à direita)
</p>
</div>
<div class="figure" style="text-align: center">
<img src="Figuras/rstudio_console.png" alt="Consoles no R padrão (à esquerda) e no RStudio (à direita)" width="90%" />
<p class="caption">
(#fig:unnamed-chunk-4-2)Consoles no R padrão (à esquerda) e no RStudio (à direita)
</p>
</div>
<p></p>
<p>Ao olhar para o Console, você pode perceber que em sua parte inferior, nós temos no início da linha um símbolo de “maior que” (<code>&gt;</code>). Esse símbolo, significa que o Console está pronto e esperando por novos comandos a serem interpretados. Ou seja, você coloca os seus comandos à frente deste símbolo, e em seguida, você aperta <code>Enter</code> para confirmar o envio dos comandos. Assim, os comandos serão avaliados, e o console vai lhe retornar o resultado destes comandos. Há algumas ocasiões em que o console vai apenas executar os comandos, e não irá lhe mostrar automaticamente o resultado. Isso geralmente ocorre quando você está salvando os resultados desses comandos em um objeto (iremos aprender sobre eles mais a frente).</p>
<p>Como um exemplo clássico, eu posso utilizar o R como uma simples calculadora, ao escrever o comando “1 + 3” no Console (e apertar a tecla <code>Enter</code>), e como não estou salvando o resultado dessa soma em algum objeto, o console me mostra automaticamente o resultado dessa operação.</p>
<p></p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="sc">+</span> <span class="dv">3</span></span></code></pre></div>
<pre><code>## [1] 4</code></pre>
<p></p>
<p>Vale destacar, que todo comando que você escrever no Console, deve estar completo para ser avaliado. Dito de outra forma, quando você escreve no Console, algum comando que ainda está incompleto de alguma forma (por exemplo, que ainda está faltando fechar algum par de parênteses, ou está faltando uma vírgula, ou está faltando algum valor a ser fornecido), e você aperta <code>Enter</code> para ele ser avaliado, o símbolo <code>&gt;</code> do Console, será substituído por um <code>+</code>, te indicando que ainda falta algo em sua expressão. Neste caso, o Console ficará esperando até que você escreva o restante, e complete o comando, como mostrado na figura 1.2. Em uma situação como essa, você pode abortar a operação, e reescrever do início o seu comando, ao apertar a tecla <code>Esc</code> de seu computador.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/console_incompleto.png" alt="Expressões incompletas" width="80%" />
<p class="caption">
(#fig:unnamed-chunk-6)Expressões incompletas
</p>
</div>
<p></p>
</div>
<div id="comentários" class="section level3" number="1.2.2">
<h3 number="1.2.2"><span class="header-section-number">1.2.2</span> Comentários</h3>
<p>O R possui diversos caracteres especiais, e que sofrem ou geram efeitos distintos ao serem avaliados. Um desses caracteres, é o <em>hash</em> (<code>#</code>), que no R, representa o início de um comentário. Ou seja, todo e qualquer comando, letra ou expressão escrita após o símbolo <code>#</code> (incluindo o próprio símbolo <code>#</code>), será completamente ignorado pelo Console. Portanto, o símbolo <code>#</code> constitui uma forma útil de incluirmos anotações e comentários em nossos comandos. Por exemplo, você talvez tenha dificuldade de lembrar o que cada função faz, e por isso, você pode utilizar o símbolo <code>#</code> para inserir pequenas descrições e lembretes ao longo de seus comandos, para relembrá-lo o que cada função faz.</p>
<p></p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># A função sum() serve para somar um</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co"># conjunto de números.</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>)</span></code></pre></div>
<pre><code>## [1] 15</code></pre>
<p></p>
</div>
<div id="comandos-e-resultados" class="section level3" number="1.2.3">
<h3 number="1.2.3"><span class="header-section-number">1.2.3</span> Comandos e resultados</h3>
<p>O símbolo de “maior que” (<code>&gt;</code>) no Console, também representa uma forma útil de você diferenciar o que é um comando a ser interpretado pelo R, e o que foi retornado pelo R como o resultado desse comando. Ou seja, todo bloco de texto em seu Console, que estiver logo à direita do símbolo <code>&gt;</code>, representa um bloco de comandos a serem avaliados (ou que já foram avaliados) pelo R. Em contrapartida, todo texto que não possuir o símbolo <code>&gt;</code> à sua esquerda, representa o resultado do comando anterior, ou então, uma mensagem de erro referente a esse comando anterior.</p>
<p>Uma outra forma útil de identificar os resultados de seus comandos, é perceber que eles sempre vêm acompanhados por algum índice numérico no início de cada linha. Esse índice pode estar dentro de um par de colchetes (como <code>[1]</code>), ou pode estar livre, como no resultado da função <code>data.frame()</code> apresentado na figura 1.3. Perceba que esses números são apenas índices, logo, eles não fazem parte do resultado de seus comandos, e são apenas valores que marcam o início cada linha de seu resultado.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/comandos_e_resultados_mod.png" alt="Comandos e seus respectivos resultados no Console" width="85%" />
<p class="caption">
(#fig:unnamed-chunk-8)Comandos e seus respectivos resultados no Console
</p>
</div>
<p></p>
</div>
<div id="histórico-de-comandos" class="section level3" number="1.2.4">
<h3 number="1.2.4"><span class="header-section-number">1.2.4</span> Histórico de comandos</h3>
<p>O Console possui uma memória dos comandos que você executou anteriormente. Tanto que esses comandos e seus resultados, permanecem visíveis ao navegarmos pelo Console. Porém, você também pode navegar pelos comandos previamente executados, ao utilizar a seta para cima (<span class="math inline">\(\uparrow\)</span>) de seu teclado, quando estiver no Console. Através dessa tecla, os comandos executados anteriormente são apresentados na linha de inserção de códigos do próprio Console.</p>
<p>Porém, você também pode visualizar de forma mais eficiente o seu histórico de comandos, ao acessar a janela <code>History</code> do RStudio, que fica na parte direita e superior de sua tela, como mostrado na figura 1.4. Uma outra forma de abrirmos essa janela, está na função <code>history()</code>. Com essa função, você pode determinar até quantos comandos anteriores devem ser exibidos nessa janela.</p>
<p></p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Exibir os últimos 10 comandos executados</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">history</span>(<span class="dv">10</span>)</span></code></pre></div>
<p></p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/history.png" alt="Aba History - Quadrante superior direito" width="60%" />
<p class="caption">
(#fig:unnamed-chunk-10)Aba History - Quadrante superior direito
</p>
</div>
<p></p>
<p>Para mais, você também pode visualizar esse histórico de comandos, por meio de uma pequena janela aberta em seu Console, como na figura 1.5. Quando estiver no console, você pode acessar essa janela, ao pressionar as teclas <code>Ctrl</code> + <span class="math inline">\(\uparrow\)</span>.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/historico_janela_console.png" alt="Histórico de comandos - Console" width="60%" />
<p class="caption">
(#fig:unnamed-chunk-11)Histórico de comandos - Console
</p>
</div>
<p></p>
</div>
<div id="sec:operacoes_matematicas" class="section level3" number="1.2.5">
<h3 number="1.2.5"><span class="header-section-number">1.2.5</span> Operações matemáticas básicas</h3>
<p>O R pode ser utilizado como uma simples calculadora, através de seus operadores aritméticos.</p>
<p></p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Simples Adição</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span> <span class="sc">+</span> <span class="dv">15</span></span></code></pre></div>
<pre><code>## [1] 18</code></pre>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Multiplicação</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span> <span class="sc">*</span> <span class="dv">125</span></span></code></pre></div>
<pre><code>## [1] 375</code></pre>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Potenciação</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span> <span class="sc">^</span> <span class="dv">4</span></span></code></pre></div>
<pre><code>## [1] 81</code></pre>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Miscelânia de operadores</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>((<span class="fl">4.505</span> <span class="sc">*</span> <span class="dv">100</span>)<span class="sc">/</span> <span class="dv">5</span>) <span class="sc">+</span> <span class="fl">0.015</span> </span></code></pre></div>
<pre><code>## [1] 90.115</code></pre>
<p></p>
<p>Você irá rapidamente perceber que esses operadores são extremamente úteis e estão por toda parte, sendo utilizados em diversas outras operações muito mais complexas. Por isso, é importante que você leve um tempo se familiarizando com esses operadores. Temos na tabela 1.1, uma lista dos principais operadores aritméticos, além de alguns comandos no R, que exemplificam o seu uso.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/operadores_matematicos.png" alt="Operadores aritméticos do R" width="70%" />
<p class="caption">
(#fig:unnamed-chunk-13)Operadores aritméticos do R
</p>
</div>
<p></p>
</div>
</div>
<div id="introdução-a-objetos" class="section level2" number="1.3">
<h2 number="1.3"><span class="header-section-number">1.3</span> Introdução a objetos</h2>
<p>Uma das principais características do R, é que ele é uma linguagem orientada a objetos (<em>object oriented</em>). Objetos são o método que o R possui para guardar os valores, funções e resultados que você produz. Como foi posto por <span class="citation"><a href="#ref-adler2010" role="doc-biblioref">Adler</a> (<a href="#ref-adler2010" role="doc-biblioref">2010</a>, p 50)</span>, todo código do R, busca utilizar, manipular ou modificar de alguma forma, um objeto do R. Logo, quando você estiver trabalhando com seus dados no R, você estará constantemente aplicando operações e transformações sobre os objetos onde seus dados estão guardados, de uma forma interativa e dinâmica.</p>
<p>Para que um objeto seja criado, o R necessita de uma forma de referenciar aquele objeto, ou em outras palavras, uma forma de reconhecer o objeto ao qual você está requisitando. Esse mecanismo consiste fundamentalmente de um nome <span class="citation">(<a href="#ref-chambers2008" role="doc-biblioref">Chambers 2008</a>, p 24)</span>. Ou seja, todo objeto no R, possui um nome, e será através desse nome, que você será capaz de acessar esse objeto. Portanto, para você salvar todo e qualquer resultado ou valor no R, você precisa obrigatoriamente salvá-lo dentro de um objeto, isto é, dar um nome a esse resultado ou valor que você está gerando.</p>
<p>No exemplo abaixo, eu estou guardando a minha idade em um objeto chamado <code>idade_pedro</code>. Dessa forma, quando eu precisar deste número em algum momento de minha análise, eu preciso apenas chamar pelo nome onde guardei este número, ou nos termos do R, pelo nome dei ao objeto onde guardei este número.</p>
<p></p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>idade_pedro <span class="ot">&lt;-</span> <span class="dv">22</span></span></code></pre></div>
<p></p>
<p>Após criarmos o objeto de nome <code>idade_pedro</code>, eu posso acessar o valor que foi salvo nele, ao chamar pelo nome do objeto no Console.</p>
<p></p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>idade_pedro</span></code></pre></div>
<pre><code>## [1] 22</code></pre>
<p></p>
<p>Sempre que você estiver criando um objeto, ele irá seguir essa estrutura acima. Você possui primeiro o nome do objeto, depois o símbolo de <code>assignment</code> (<code>&lt;-</code>), e por último, o valor (ou o conjunto de valores) que você quer guardar dentro deste objeto. Independente do quê, ou, do porquê, o código à direita do símbolo de <code>assignment</code> faz, ao ver essa estrutura, você sabe de antemão que esses comandos estão criando um objeto.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/objeto.png" alt="Estrutura necessária para criar um objeto" width="70%" />
<p class="caption">
(#fig:unnamed-chunk-16)Estrutura necessária para criar um objeto
</p>
</div>
<p></p>
<p>Nós podemos sobrepor o valor guardado em um objeto, ao atribuir um novo valor a este objeto. Neste caso, estaríamos perdendo o valor que salvamos anteriormente neste objeto. Como exemplo, se eu atribuir o texto “Importado” ao objeto <code>idade_pedro</code>. Após este novo comando, se chamarmos pelo nome do objeto, o R irá lhe mostrar o novo texto que acabamos de guardar, e o número 22 que estava anteriormente guardado nele, se perdeu.</p>
<p></p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>idade_pedro <span class="ot">&lt;-</span> <span class="st">&quot;Importado&quot;</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>idade_pedro</span></code></pre></div>
<pre><code>## [1] &quot;Importado&quot;</code></pre>
<p></p>
<p>Caso você tenha que sobrepor o valor de um objeto, mas você não quer perder o valor que está salvo em nele, você deve conectar este valor a um novo objeto. Se um valor não está conectado a um nome, o R vai jogar este valor fora, por isso, precisamos de uma nova conexão até ele, ou em outras palavras, precisamos conectá-lo a um novo nome. Dessa forma, podemos tranquilamente sobrepor o valor guardado em <code>idade_pedro</code>, pois agora, o valor 22 está guardado em um outro objeto.</p>
<p></p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>idade_pedro <span class="ot">&lt;-</span> <span class="dv">22</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>numero_importante <span class="ot">&lt;-</span> idade_pedro</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>idade_pedro <span class="ot">&lt;-</span> <span class="st">&quot;Importado&quot;</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Ao chamar pelo nome de</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="co"># ambos os objetos, temos dois valores</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="co"># diferentes</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>idade_pedro</span></code></pre></div>
<pre><code>## [1] &quot;Importado&quot;</code></pre>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>numero_importante</span></code></pre></div>
<pre><code>## [1] 22</code></pre>
<p></p>
<div id="como-nomear-um-objeto" class="section level3" number="1.3.1">
<h3 number="1.3.1"><span class="header-section-number">1.3.1</span> Como nomear um objeto</h3>
<p>Como foi destacado por <span class="citation"><a href="#ref-wickham2017" role="doc-biblioref">Wickham and Grolemund</a> (<a href="#ref-wickham2017" role="doc-biblioref">2017</a>)</span>, existem regras sobre como você pode nomear os seus objetos no R. Segundo <span class="citation"><a href="#ref-Rintroduction" role="doc-biblioref">R Core Team</a> (<a href="#ref-Rintroduction" role="doc-biblioref">2020a</a>, p 4)</span>, o nome de um objeto, pode conter qualquer símbolo alfanumérico (qualquer letra ou número), inclusive letras acentuadas. Sendo que o nome desse objeto, deve obrigatoriamente se iniciar por uma letra, ou por um ponto (<code>.</code>), como por exemplo, os nomes: <code>População</code>; <code>dados.2007</code>; <code>.abc</code>; <code>media_1990</code>.</p>
<p>Porém, um nome não pode começar por um número, logo, um nome como <code>1995populacao</code>, não é permitido. Também não é possível, que se inicie um nome por um ponto (<code>.</code>) caso ele seja seguido por um número. Logo, você não pode criar um objeto com o nome <code>.2media</code>, mas você pode criar um objeto que possua o nome <code>.m2edia</code> ou <code>.media2</code>.</p>
<p>Em suma, o nome de um objeto pode conter os seguintes tipos de caractere:</p>
<ul>
<li>Letras.</li>
<li>Números.</li>
<li><code>_</code> (<em>underline</em>).</li>
<li><code>.</code> (ponto).</li>
</ul>
<p>Além disso, o nome de um objeto pode se iniciar com um:</p>
<ul>
<li>Letra.</li>
<li><code>.</code> (ponto, desde que não seja seguido por um número).</li>
</ul>
<p>Porém, o nome de qualquer objeto, <strong>não deve começar</strong> por um:</p>
<ul>
<li><code>_</code> (<em>underline</em>).</li>
<li>Número.</li>
<li><code>.</code> (ponto) seguido de um número.</li>
</ul>
<p>Pode ser difícil pensar em um nome para os seus objetos. Mas a melhor alternativa, é sempre dar um nome claro e descritivo aos seus objetos, mesmo que esse nome possa ficar muito extenso. Por exemplo, <code>microdados_pnad_2020</code> para uma base de dados contendo os microdados da PNAD de 2020; ou <code>vetor_idade</code>, para um vetor que contém as idades das pessoas que foram entrevistadas em uma pesquisa.</p>
</div>
<div id="o-r-é-case-sensitive" class="section level3" number="1.3.2">
<h3 number="1.3.2"><span class="header-section-number">1.3.2</span> O R é <em>case-sensitive</em></h3>
<p>O R é uma linguagem <em>case-sensitive</em>. Isso significa, que ele é capaz de diferenciar a capitalização de sua escrita. Logo, um objeto chamado <code>a</code>, é um objeto completamente diferente de um objeto chamado <code>A</code>. Veja o exemplo abaixo.</p>
<p></p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>casa <span class="ot">&lt;-</span> <span class="dv">10</span> <span class="sc">^</span> <span class="dv">2</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>cAsa <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">+</span> <span class="dv">2</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>casa</span></code></pre></div>
<pre><code>## [1] 100</code></pre>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>cAsa</span></code></pre></div>
<pre><code>## [1] 4</code></pre>
<p></p>
<p>Como visto, os objetos <code>casa</code> e <code>cAsa</code> contêm valores diferentes, e, portanto, representam objetos distintos.</p>
</div>
<div id="como-utilizar-objetos" class="section level3" number="1.3.3">
<h3 number="1.3.3"><span class="header-section-number">1.3.3</span> Como utilizar objetos</h3>
<p>Um objeto é de certa forma, uma referência até um certo conjunto de valores, e você utiliza, ou acessa essa referência, através do nome que você deu a esse objeto. Logo, sempre que você quiser utilizar os valores que estão guardados em algum objeto (seja dentro de alguma função ou em alguma operação específica), você precisa apenas utilizar o nome que você deu a esse objeto.</p>
<p>Por exemplo, se eu quero somar um conjunto de valores guardados em um objeto chamado <code>vec_num</code>, eu posso fornecer o nome deste objeto à função <code>sum()</code>.</p>
<p></p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>vec_num <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">2.5</span>, <span class="fl">5.8</span>, <span class="fl">10.1</span>, <span class="fl">25.2</span>, <span class="fl">4.4</span>)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>soma <span class="ot">&lt;-</span> <span class="fu">sum</span>(vec_num)</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>soma</span></code></pre></div>
<pre><code>## [1] 48</code></pre>
<p></p>
</div>
</div>
<div id="sec:funcoes" class="section level2" number="1.4">
<h2 number="1.4"><span class="header-section-number">1.4</span> Funções (noções básicas)</h2>
<p>Como destacado por <span class="citation"><a href="#ref-chambers2016" role="doc-biblioref">Chambers</a> (<a href="#ref-chambers2016" role="doc-biblioref">2016</a>)</span>, até as funções que você utiliza, são objetos no R. A grande maioria das funções são escritas e utilizadas, segundo o formato abaixo. Portanto, sempre que você for utilizar uma função no R, você deve escrever o nome dessa função, e em em seguida, abrir um par de parênteses. Dentro destes parênteses, você irá fornecer os argumentos (ou <em>input</em>’s) que serão utilizados pela função para gerar o seu resultado.</p>
<p></p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>nome_da_função(lista_de_argumentos)</span></code></pre></div>
<p></p>
<p>Os operadores aritméticos utilizados até aqui (<code>+</code>, <code>-</code>, <code>*</code>, etc.) também são funções para o R, porém, eles representam um tipo especial de <em>função</em>. Pois nós podemos posicionar os seus argumentos, ao redor desses operadores (ex: <code>2 + 3</code>). Por outro lado, nós podemos escrever esses operadores (ou essas funções), da forma “tradicional,” ou como as demais funções no R são escritas, o que é demonstrado logo abaixo. Perceba que pelo fato do nome da função (a função que representa o operador +), se iniciar por um símbolo que não respeita as regras que definimos anteriormente (sobre como nomear um objeto), para nos referirmos a esse objeto, ou a essa função, nós devemos contornar o nome dessa função por acentos graves.</p>
<p></p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># O mesmo que 2 + 3</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">+</span><span class="st">`</span>(<span class="dv">2</span>, <span class="dv">3</span>)</span></code></pre></div>
<pre><code>## [1] 5</code></pre>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># O mesmo que 12 + 8</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">+</span><span class="st">`</span>(<span class="dv">12</span>, <span class="dv">8</span>)</span></code></pre></div>
<pre><code>## [1] 20</code></pre>
<p></p>
<p>Os argumentos da função identificam os dados que serão transformados, ou representam especificações que vão modificar o comportamento da função, ou modificar a metodologia de cálculo utilizada. Dessa forma, nós definimos os argumentos das funções (i.e., incluímos as especificações desejadas) para que possamos obter os resultados de acordo com as nossas necessidades. Sendo que a <code>lista_de_argumentos</code>, corresponde a uma lista onde cada argumento é separado por uma vírgula (<code>,</code>), como no exemplo abaixo.</p>
<p></p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>exemplo_função(<span class="at">argumento1 =</span> valor_argumento1, <span class="at">argumento2 =</span> valor_argumento2)</span></code></pre></div>
<p></p>
<p>Um argumento pode ser um símbolo, que contém um valor específico (ex.: <code>argumento1 = valor_argumento1</code>) ou o argumento especial ‘<code>...</code>’ que pode conter qualquer número de argumentos (geralmente, o argumento especial é encontrado em funções em que a quantidade de argumentos que será passada é desconhecida). Algumas funções possuem valores padrões em seus argumentos. Em outras palavras, caso você não defina algum valor específico para este tipo de argumento, a função vai utilizar um valor pré-definido para esse argumento. Usualmente, os valores padrão são os valores mais comuns, que utilizam as metodologias mais conservadoras ou tradicionais de cálculo da função.</p>
<p>Por exemplo, a função <code>sum()</code> possui o argumento <code>na.rm</code>, que define se os valores <code>NA</code> presentes em um objeto, devem ser ignorados ou não durante o cálculo da soma. Por padrão, esse argumento é configurado para <code>FALSE</code> (falso). Isso significa, que qualquer valor <code>NA</code> que estiver presente no objeto a ser somado, vai alterar o comportamento da soma executada por <code>sum()</code>. Por isso, se quisermos ignorar os valores <code>NA</code> durante o cálculo da soma, nós precisamos definir explicitamente o argumento <code>na.rm</code> para <code>TRUE</code> (verdadeiro).</p>
<p></p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>vec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">1.2</span>, <span class="fl">2.5</span>, <span class="dv">3</span>, <span class="cn">NA_real_</span>, <span class="fl">7.6</span>)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(vec)</span></code></pre></div>
<pre><code>## [1] NA</code></pre>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(vec, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## [1] 14.3</code></pre>
<p></p>
<p>Ao definirmos os valores a serem utilizados em cada argumento de uma função, nós não precisamos determinar o nome do argumento a ser utilizado. Como exemplo, veja a função <code>rnorm()</code> abaixo. O primeiro argumento (<code>n</code>) da função, define o número de observações a serem geradas; o segundo (<code>mean</code>), define a média desses valores; e o terceiro (<code>sd</code>), define o desvio padrão que esses valores vão seguir ao serem gerados.</p>
<p></p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># A função rnorm() e seus argumentos</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rnorm</span>(n, mean, sd)</span></code></pre></div>
<p></p>
<p>Quando nós não definimos explicitamente o nome do argumento que estamos utilizando, o R vai conectar o valor que fornecemos, de acordo com a ordem que os argumentos aparecem na função. Ou seja, o primeiro valor, será conectado ao primeiro argumento da função. Já o segundo valor, será conectado ao segundo argumento da função. E assim por diante. Isso significa, que se quisermos configurar algum argumento, fora da ordem em que ele aparece na função, nós teremos que explicitar o nome do argumento a ser utilizado.</p>
<p></p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rnorm</span>(<span class="dv">10</span>, <span class="dv">15</span>, <span class="fl">2.5</span>)</span></code></pre></div>
<pre><code>##  [1] 16.57956 19.92727 15.16260 15.04473 11.27895 18.39141 14.79197
##  [8] 12.63172 16.39849 15.00137</code></pre>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">10</span>, <span class="at">sd =</span> <span class="fl">2.5</span>, <span class="at">mean =</span> <span class="dv">15</span>)</span></code></pre></div>
<pre><code>##  [1] 20.462234 17.357879 14.648487  9.806538 19.834041 12.033833 16.281254
##  [8] 17.093424 12.511102 15.224255</code></pre>
<p></p>
</div>
<div id="sec:erros_ajuda" class="section level2" number="1.5">
<h2 number="1.5"><span class="header-section-number">1.5</span> Erros e ajuda: como e onde obter</h2>
<p>Ao começar a aplicar o conhecimento exposto neste livro, você rapidamente irá enfrentar situações adversas, onde vão surgir muitas perguntas das quais eu não ofereço uma resposta aqui. Por isso, é muito importante que você conheça o máximo de recursos possíveis, dos quais você pode consultar e pedir por ajuda <span class="citation">(<a href="#ref-wickham2017" role="doc-biblioref">Wickham and Grolemund 2017</a>)</span>.</p>
<p>Hoje, a comunidade internacional de R, é muito grande, e há diversos locais onde você pode encontrar ajuda, e aprender cada vez mais sobre a linguagem. Nessa seção, vamos explicar como utilizar os guias internos do R e do RStudio, além de algumas técnicas de pesquisa e de perguntas que podem te ajudar a responder as suas dúvidas.</p>
<div id="ajuda-interna-do-r-help-e" class="section level3" number="1.5.1">
<h3 number="1.5.1"><span class="header-section-number">1.5.1</span> Ajuda Interna do R: <code>help()</code> e <code>?</code></h3>
<p>Toda função no R, possui uma documentação interna, que contém uma descrição completa (ou quase sempre completa) da função. Essas documentações são muitas vezes úteis, especialmente para descobrirmos os argumentos de uma função, ou para compreendermos que tipo de valores devemos utilizar em um certo argumento, ou então, em ocasiões mais específicas, para adquirirmos um conhecimento mais completo sobre o comportamento de uma função.</p>
<p>Para acessar essa documentação, você pode anteceder o nome da função com o operador <code>?</code>, ou então, utilizar a função <code>help()</code> sobre o nome da função de interesse. Como exemplo, com os comandos abaixo, você pode consultar a documentação interna da função <code>mean()</code>.</p>
<p></p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Usando `help()`</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="fu">help</span>(<span class="st">&quot;mean&quot;</span>)</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Usando `?`</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>?mean</span></code></pre></div>
<p></p>
<p>Se você estiver no programa padrão do R, ao executar um desses comandos, um arquivo HTML contendo a documentação será aberto em seu navegador. Mas se você estiver no RStudio, a documentação será aberta na janela de <code>Help</code> do próprio RStudio, localizada no quadrante direito e inferior de sua tela, como mostrado na figura 1.7.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/ajuda_mean_rstudio.png" alt="Documentação interna da função de média no RStudio" width="70%" />
<p class="caption">
(#fig:unnamed-chunk-27)Documentação interna da função de média no RStudio
</p>
</div>
<p></p>
<p>A documentação interna de uma função, lhe dá uma descrição completa sobre quais tipos de valores devem (ou podem) ser inseridos em cada argumento da função. Entretanto, caso você esteja apenas em dúvida sobre os nomes dos argumentos de uma função, você pode rapidamente sanar essa dúvida, ao utilizar a função <code>args()</code> sobre o nome da função. Com essa função, uma estrutura é retornada, contendo a palavra chave <code>function</code>, e a lista de argumentos da função dentro de um par de parênteses. Porém, se a função de interesse possui diferentes métodos (como é o caso da função <code>mean()</code>, e de muitas outras funções), é muito provável que o resultado da função <code>args()</code> será de pouca utilidade, a menos que você pesquise por um método específico da função.</p>
<p></p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">args</span>(<span class="st">&quot;mean&quot;</span>)</span></code></pre></div>
<pre><code>## function (x, ...) 
## NULL</code></pre>
<p></p>
<p>Veja no exemplo abaixo, que ao selecionarmos o “método padrão” da função de média (<code>mean.default()</code>), dois novos argumentos foram retornados (<code>trim</code> e <code>na.rm</code>) pela função <code>args()</code>.</p>
<p></p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">args</span>(<span class="st">&quot;mean.default&quot;</span>)</span></code></pre></div>
<pre><code>## function (x, trim = 0, na.rm = FALSE, ...) 
## NULL</code></pre>
<p></p>
<p>Por esses motivos, a documentação interna representa uma fonte mais completa e segura de consulta sobre uma função. Como exemplo, na figura 1.8 podemos ver a seção de <code>Arguments</code>, da documentação interna da função <code>mean()</code>. Nessa seção, podemos encontrar uma descrição sobre o que cada argumento faz e, principalmente, sobre que tipo de valor cada um desses argumentos é capaz de receber. Vemos abaixo, pela descrição do argumento <code>x</code>, que a função <code>mean()</code> possui métodos específicos para vetores numéricos, lógicos, de data, de data-hora e de intervalos de tempo. Com essas informações, nós sabemos, por exemplo, que a função não possui métodos para vetores de texto. Também podemos deduzir dessa descrição, que a função <code>mean()</code> é capaz de lidar apenas com vetores, e, portanto, o uso de <code>data.frame</code>’s e listas está fora de cogitação.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/arguments_mean.png" alt="Seção de argumentos da documentação interna da função de média" width="80%" />
<p class="caption">
(#fig:unnamed-chunk-30)Seção de argumentos da documentação interna da função de média
</p>
</div>
<p></p>
</div>
<div id="um-exemplo-clássico-de-ajuda-interna" class="section level3" number="1.5.2">
<h3 number="1.5.2"><span class="header-section-number">1.5.2</span> Um exemplo clássico de ajuda interna</h3>
<p>Um exemplo clássico em que a ajuda interna do R é bem útil, se encontra na função <code>round()</code>, que utilizamos para arredondar valores numéricos de acordo com um número de casas decimais.</p>
<p></p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Arredondar 3.1455 para duas casas decimais</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fl">3.1455</span>, <span class="at">digits =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] 3.15</code></pre>
<p></p>
<p>Porém, há diversas maneiras de se arredondar um número, e você talvez se pergunte quais desses métodos estão disponíveis no R. Para responder a essa pergunta, você talvez pense em procurar por mais detalhes sobre a função <code>round()</code> em sua documentação interna. Temos o início dessa documentação na figura 1.9, e a primeira coisa que chama atenção é a lista de funções irmãs de <code>round()</code>. Ou seja, possuímos nessa lista, 5 funções diferentes (<code>ceiling()</code>, <code>floor()</code>, <code>trunc()</code>, <code>round()</code> e <code>signif()</code>), que buscam aplicar diferentes métodos de arredondamento.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/round_ajuda.png" alt="Documentação interna da função `round()`" width="80%" />
<p class="caption">
(#fig:unnamed-chunk-32)Documentação interna da função <code>round()</code>
</p>
</div>
<p></p>
<p>Ao olharmos para a descrição da função <code>floor()</code> (<em>“takes the largest integer not greater than the corresponding value of x”</em>, ou “seleciona o maior número inteiro que não é maior do que o valor correspondente em x”), podemos compreender que essa função busca sempre arredondar um número para baixo, independentemente de qual número esteja presente na última casa decimal. Também podemos entender pela descrição da função <code>ceiling()</code>, que ela executa justamente o processo contrário (<em>“takes the smallest integer not less than the corresponding value of x”</em>, ou “seleciona o menor número inteiro que não é menor que o valor correspondente de x”), e arredonda qualquer número sempre para cima.</p>
<p></p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>vec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.4</span>, <span class="fl">2.5</span>, <span class="fl">3.7</span>, <span class="fl">3.2</span>, <span class="fl">1.8</span>)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="fu">floor</span>(vec)</span></code></pre></div>
<pre><code>## [1] 0 2 3 3 1</code></pre>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ceiling</span>(vec)</span></code></pre></div>
<pre><code>## [1] 1 3 4 4 2</code></pre>
<p></p>
<p>A seção de detalhes dessa documentação (mostrada na figura 1.10) é particularmente útil. Pois ela nos oferece uma boa descrição das implicações do padrão adotado pela função (IEC 60559). Além disso, a descrição presente na seção de detalhes também nos aponta uma particularidade importante sobre a função <code>round()</code>. Pois ao arredondar um decimal igual ao número 5, a função <code>round()</code> normalmente irá buscar o número inteiro par mais próximo.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/details_round.png" alt="Seção de detalhes da documentação interna da função `round()`" width="80%" />
<p class="caption">
(#fig:unnamed-chunk-34)Seção de detalhes da documentação interna da função <code>round()</code>
</p>
</div>
<p></p>
<p>A importância deste ponto, emerge do fato de que algumas funções de arredondamento muito utilizadas possuem um comportamento diferente de <code>round()</code>, em uma situação como essa. Um exemplo está na função <code>ARRED()</code> do Excel, que sempre arredonda um número para cima, a partir do momento em que a sua última casa decimal atinge um valor igual ou acima de 5. Se os nossos números são arredondados de formas distintas ao longo de certos programas, diferentes valores ou resultados podem ser estimados. Em geral, nós desejamos evitar isso.</p>
<p>Para que essa diferença fique clara, se eu arredondar os números 9,5 e 6,5, a função <code>round()</code> vai gerar como resultado, os números 10 e 6. Pois durante o processo de arredondamento, a função <code>round()</code> está preocupada em encontrar o número par mais próximo do valor em questão, e não sobre qual direção o arredondamento vai assumir.</p>
<p></p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>vec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">9.5</span>, <span class="fl">6.5</span>, <span class="fl">4.5</span>, <span class="fl">1.5</span>, <span class="fl">2.5</span>)</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(vec, <span class="at">digits =</span> <span class="dv">0</span>)</span></code></pre></div>
<pre><code>## [1] 10  6  4  2  2</code></pre>
<p></p>
</div>
<div id="ajuda-externa-referências-documentação-oficial-e-canais-úteis" class="section level3" number="1.5.3">
<h3 number="1.5.3"><span class="header-section-number">1.5.3</span> Ajuda Externa: referências, documentação oficial e canais úteis</h3>
<p>Apesar de útil, a documentação interna de uma função é limitada. Essa situação tende a se confirmar especialmente em pacotes externos aos pacotes básicos do R, ao encontrarmos em suas documentações, seções de <code>Details</code> rasas e de pouca utilidade. Por isso, é interessante se aprofundar e conhecer outras referências externas ao R, produzidas por autores/usuários (livros-texto, cursos online, etc) que oferecem o seu conhecimento sobre a linguagem como um suporte à comunidade.</p>
<p>Ao longo desse livro, vamos descrever diversas funções que provêm dos pacotes do <code>tidyverse</code>. Por isso, é interessante que você se familiarize com os sites desses pacotes<a href="#fn5" class="footnote-ref" id="fnref5"><sup>5</sup></a>. Todos esses sites possuem uma página de <em>“Reference”</em>, que contém a documentação de todas as funções do pacote. Uma outra fonte rápida de informação, são as “colas” (ou <em>“cheatsheets”</em>) produzidas pela equipe do RStudio, chamadas de <a href="https://rstudio.com/resources/cheatsheets/">RStudio Cheatsheets</a>.</p>
<p>Além disso, temos diversos livros-textos importantes sobre a linguagem, que oferecem diversos conhecimentos extremamente valiosos, como as obras de <span class="citation">(<a href="#ref-wickham2017" role="doc-biblioref">Wickham and Grolemund 2017</a>; <a href="#ref-gillespie2017" role="doc-biblioref">Gillespie and Lovelace 2017</a>; <a href="#ref-peng2015" role="doc-biblioref">Peng 2015</a>; <a href="#ref-grolemund2014" role="doc-biblioref">Grolemund 2014</a>; <a href="#ref-chambers2008" role="doc-biblioref">Chambers 2008</a>; <a href="#ref-adler2010" role="doc-biblioref">Adler 2010</a>)</span>, além da documentação oficial da linguagem presente em <span class="citation">(<a href="#ref-Rintroduction" role="doc-biblioref">R Core Team 2020a</a>, <a href="#ref-Rlanguage" role="doc-biblioref">2020b</a>)</span>.</p>
<p>Também há diversos cursos e materiais disponíveis, que podem ser boas fontes de informação. Dentre eles, temos o curso <a href="https://www.datacamp.com/courses/free-introduction-to-r">Introduction to R</a>, da plataforma Datacamp. Além disso, temos um bom material de consulta em português, construído pela equipe do <a href="http://material.curso-r.com">Curso-R</a>, além do material produzido pelo professor Walmes Marques Zeviani, intitulado <a href="http://leg.ufpr.br/~walmes/cursoR/data-vis/">Manipulação e Visualização de Dados</a>.</p>
<p>Para mais, temos alguns blogs que fazem boas reflexões e sempre trazem um bom conteúdo sobre a linguagem. Esse é o caso do site <a href="https://www.r-bloggers.com">R-Bloggers</a>, que possui uma boa discussão sobre os mais diversos assuntos no R. Um outro exemplo, é o <a href="https://www.tidyverse.org/blog/">blog do Tidyverse</a>, que constantemente descreve novos pacotes, novas funções disponíveis e novas aplicações para o R que podem ser muito interessantes para o seu trabalho.</p>
<p>Além dessas referências, é muito importante que você se familiarize com os canais de dúvida disponíveis, como o <a href="https://stackoverflow.com">Stackoverflow</a>. Pois esses canais serão, com certeza, a sua principal fonte de ajuda no R. Em síntese, o StackOverflow funciona da seguinte maneira: 1) alguém envia uma pergunta; 2) cada pergunta, é marcada por um conjunto de <em>tags</em>, que definem a linguagem de programação, ou pacote, ou assunto específico a que se refere a dúvida; 3) qualquer pessoa, pode postar uma resposta nessa pergunta, ou algum comentário que seja útil; 4) as respostas mais úteis e completas, serão votadas para cima, pelos próprios usuários do site; 5) dessa forma, as respostas mais úteis e completas, vão sempre aparecer primeiro na postagem da dúvida em questão.</p>
<p>Para encontrar perguntas especificamente voltadas para a linguagem R no StackOverflow, você deve sempre procurar por perguntas marcadas com a <em>tag</em> <code>[r]</code>, ou por algum pacote específico da linguagem. Por exemplo, o StackOverflow contém um estoque enorme de dúvidas marcadas com a <em>tag</em> <code>ggplot2</code>, que se refere ao pacote <code>ggplot2</code>, que vamos discutir mais à frente. Logo, o StackOverflow representa uma fonte extremamente importante sobre esse pacote.</p>
<p>Além do StackOverflow, nós também possuímos o <a href="https://community.rstudio.com/">RStudio Community</a>, que também é um canal de dúvidas bastante ativo, e que funciona de maneira muito similar ao StackOverflow. Onde pessoas fazem uma pergunta, que é marcada por <em>tags</em> que definem o pacote ou o assunto específico que a pergunta se refere. Porém, as perguntas no RStudio Community, tendem a assumir um aspecto mais parecido com uma discussão (ao invés de um caráter de pergunta-resposta presente no StackOverflow). Ou seja, uma pergunta abre de certa forma, uma discussão. Uma pessoa fornece uma resposta, depois outra fornece um outro olhar sobre a pergunta, o autor descreve novas dúvidas, novas respostas surgem, podendo assim, criar uma discussão infindável em torno da dúvida inicial.</p>
<p>As fontes de ajuda externas ao R, serão a sua maior ajuda, e a sua principal referência. Pois como foi destacado por <span class="citation"><a href="#ref-chase2020" role="doc-biblioref">Chase</a> (<a href="#ref-chase2020" role="doc-biblioref">2020</a>)</span>, ninguém é completamente autodidata. Todos nós cometemos erros, e uma das grandes vantagens de uma comunidade como a do R, é que muito conhecimento é produzido e compartilhado em torno desses erros. Por essa razão, ao invés de autodidatas (<em>self-taught</em>), <span class="citation"><a href="#ref-chase2020" role="doc-biblioref">Chase</a> (<a href="#ref-chase2020" role="doc-biblioref">2020</a>)</span>, assim como os autores desta obra, prefirímos nos caracterizar como seres instruídos pela comunidade (<em>community-taught</em>).</p>
</div>
<div id="um-exemplo-clássico-de-ajuda-externa" class="section level3" number="1.5.4">
<h3 number="1.5.4"><span class="header-section-number">1.5.4</span> Um exemplo clássico de ajuda externa</h3>
<p>Uma das primeiras dúvidas que atingem os iniciantes, diz respeito aos objetos criados, ou melhor dizendo, aos objetos não criados em sua sessão. Você já viu na seção <a href="#sec:objetos">Introdução a objetos</a>, qual a estrutura básica necessária para criarmos um objeto (<code>nome_do_objeto &lt;- valor_do_objeto</code>). Porém, você pode acabar se perdendo durante o seu trabalho, de forma a não saber quais objetos você criou em sua sessão. Em situações como essa, você pode executar a função <code>ls()</code>. Essa função irá listar o nome de todos os objetos que estão criados em sua sessão atual do R.</p>
<p></p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span>()</span></code></pre></div>
<pre><code>##  [1] &quot;casa&quot;              &quot;cAsa&quot;              &quot;def.chunk.hook&quot;   
##  [4] &quot;idade_pedro&quot;       &quot;load_packages&quot;     &quot;numero_importante&quot;
##  [7] &quot;pckgs&quot;             &quot;soma&quot;              &quot;vec&quot;              
## [10] &quot;vec_num&quot;</code></pre>
<p></p>
<p>Com isso, caso você esteja em dúvida se você já criou ou não, um certo objeto em sua sessão, você pode conferir se o nome deste objeto aparece nessa lista resultante da função <code>ls()</code>. Caso o nome do objeto não se encontre nela, você sabe que o objeto em questão ainda não foi criado.</p>
<p>Por outro lado, você pode estar interessado em apagar um certo objeto de sua sessão. Tal resultado, pode ser atingido através da função <code>rm()</code>. Logo, se eu possuo um objeto chamado <code>dados_2007</code>, e eu desejo eliminá-lo de minha sessão, eu preciso apenas fornecer o nome deste objeto à função <code>rm()</code>.</p>
<p></p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Removendo o objeto chamado</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="co"># dados_2007 de minha sessão</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(dados_2007)</span></code></pre></div>
<p></p>
<p>Na próxima seção, vamos abordar o uso de <em>scripts</em> no R, e um erro muito comum quando você está começando a utilizar <em>scripts</em>, é se esquecer de executar os comandos para criar um objeto. Ou seja, muitos iniciantes escrevem no <em>script</em>, os comandos necessários para criar o seu objeto, mas acabam se esquecendo de enviar esses comandos para o Console, onde eles serão avaliados e executados.</p>
<p>A função <code>ls()</code> oferece uma forma rápida de consulta, que pode sanar a sua dúvida em ocasiões como essa. Mas uma outra forma ainda mais efetiva de sanarmos essa dúvida, consiste em chamar pelo nome deste objeto no console. Se algum erro for retornado, há grandes chances de que você ainda não criou esse objeto em sua sessão. Veja o exemplo abaixo na figura 1.11, em que chamo por um objeto chamado <code>microdados_pnad_2020</code>, e um erro é retornado.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/console_erro.png" alt="Mensagem de erro - Console" width="70%" />
<p class="caption">
(#fig:unnamed-chunk-38)Mensagem de erro - Console
</p>
</div>
<p></p>
<p>Sempre que você não souber o que um erro significa, ou a que termo ele está se referindo, faça uma pesquisa rápida sobre esse erro no Google. Se o seu erro está sendo gerado, ao executar uma função específica, você pode anteceder o erro gerado, por um “R” e pelo nome da função utilizada, na barra de pesquisa do Google. No nosso caso, talvez seja melhor pesquisarmos apenas pelo erro antecedido por um “R,” como na figura abaixo. Há alguma chance de você encontrar referências de ajuda em português. Porém, as chances são infinitamente maiores se você pesquisar por artigos e perguntas escritas em inglês. Por isso, se a sua mensagem de erro estiver em português (como é o caso da mensagem na figura acima), é melhor que você tente traduzi-la para o inglês, caso você tente pesquisar por ela no Google.</p>
<p>Podemos encontrar no primeiro link da página mostrada na figura 1.12, uma pergunta postada no StackOverflow. Como o StackOverflow é geralmente uma boa referência de ajuda, há uma boa chance de encontrarmos o que estamos necessitando nesse link.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/pesquisa_alternativa_google.png" alt="Pesquisa Google sobre mensagem de erro" width="85%" />
<p class="caption">
(#fig:unnamed-chunk-39)Pesquisa Google sobre mensagem de erro
</p>
</div>
<p></p>
<p>Ao acessarmos uma pergunta do StackOverflow, a primeira parte que aparece em sua tela, é a pergunta em si. Perguntas que são muito úteis, e que traduzem uma dúvida muito comum dos usuários, tendem a ser “votadas para cima.” A pergunta exposta na figura 1.13, possui 37 votos. Ou seja, essa pergunta foi útil o suficiente para ajudar no mínimo 37 pessoas.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/pergunta_stackoverflow.png" alt="Pergunta StackOverflow - Parte 1" width="85%" />
<p class="caption">
(#fig:unnamed-chunk-40)Pergunta StackOverflow - Parte 1
</p>
</div>
<p></p>
<p>Logo abaixo da pergunta em si, temos as respostas de usuários que se dispuseram a respondê-la. As respostas mais úteis para a pergunta em questão, tendem a ter maiores votos dos usuários e, por isso, tendem a aparecer primeiro na página em relação as outras respostas menos úteis. Como podemos ver na figura 1.14, a primeira resposta possui 33 votos.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/resposta_stackoverflow.png" alt="Pergunta StackOverflow - Parte 2" width="85%" />
<p class="caption">
(#fig:unnamed-chunk-41)Pergunta StackOverflow - Parte 2
</p>
</div>
<p></p>
<p>A resposta mostrada na figura 1.14, é bem esclarecedora. Como o autor pontua, um erro do tipo “objeto x não foi encontrado” (ou <em>“object x not found”</em>) ocorre quando tentamos utilizar um objeto que ainda não existe, um objeto que ainda não foi definido. A partir do momento em que você define esse objeto, esse erro não ocorre mais.</p>
<p>Como pontuei anteriormente, é muito comum de um aluno escrever os comandos necessários para criar um objeto em seu <em>script</em>, mas se esquecer de enviar esses comandos do <em>script</em> para o Console, onde serão avaliados e executados. Por isso, sempre que ocorrer esse erro, confira se você conseguiu enviar os comandos para o Console. Também confira se os comandos utilizados para criar o objeto, foram de fato executados, isto é, confirme se nenhum erro apareceu durante a execução desses comandos. Pois a depender da gravidade do erro gerado, a execução dos comandos pode ter sido comprometida e, portanto, o objeto não pôde ser criado.</p>
<p>Por isso, sempre que enfrentar algum erro no R, tente fazer uma pesquisa rápida no Google. Em geral, você pode copiar e colar diretamente a mensagem, ou citar apenas trechos, ou a oração principal da mensagem de erro na pesquisa. É interessante sempre colocar um “r” antes da mensagem de erro, para definir um pouco melhor a sua pesquisa e encontrar links referentes à linguagem R.</p>
<p>Uma boa referência externa para compreender e solucionar erros no R, é o StackOverflow. Você pode encontrar todas as perguntas referentes à linguagem R disponíveis nesse site, ao pesquisar pela tag <code>[r]</code>, ou, acessando diretamente o link dessas perguntas: <a href="https://stackoverflow.com/questions/tagged/r">https://stackoverflow.com/questions/tagged/r</a>. Perceba na figura 1.15, que no momento de captura dessa imagem, existiam 432.084 perguntas disponíveis que descrevem alguma dúvida sobre a linguagem R. Hoje, esse número provavelmente é maior.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/stackoverflow_rtag.png" alt="Pesquisando por todas as perguntas referentes à linguagem R" width="80%" />
<p class="caption">
(#fig:unnamed-chunk-42)Pesquisando por todas as perguntas referentes à linguagem R
</p>
</div>
<p></p>
</div>
</div>
<div id="sec:scripts" class="section level2" number="1.6">
<h2 number="1.6"><span class="header-section-number">1.6</span> Scripts</h2>
<p>Até o momento, estivemos utilizando diretamente o console para executarmos os nossos comandos. Porém, você provavelmente se sentiu um pouco perdido ao procurar pelos últimos comandos que você executou e, se sentiu um pouco frustrado ao ter que digitar novamente o comando caso queira executá-lo uma segunda vez. Por essa razão, à medida que você trabalha com o R, a necessidade de guardar os seus comandos anteriores em algum lugar, se torna cada vez mais urgente. Para isso, você pode utilizar um <em>script</em>.</p>
<p>Um <em>script</em> é um simples arquivo de texto, que contém a extensão <code>.R</code>, para indicar que todo o texto contido neste arquivo, representam comandos do R. Portanto, um <em>script</em> contém um conjunto de códigos e comandos do R que podem ser facilmente acessados, editados e executados através das ferramentas e atalhos do RStudio, tornando o seu fluxo de trabalho com o R mais eficiente. Ao utilizar o RStudio, os códigos contidos nos scripts podem ser executados individualmente ou em conjunto.</p>
<p>Para criar um script no RStudio, você possui duas opções: 1) clicar em <em>File</em> <span class="math inline">\(\rightarrow\)</span> <em>New File</em> <span class="math inline">\(\rightarrow\)</span> <em>R Script</em>; ou 2) utilizar o atalho <code>Ctrl</code> + <code>Shift</code> + <code>N</code>. Após criar o <em>script</em>, o quadrante esquerdo do RStudio será dividido verticalmente em dois: a parte superior comporta o editor de <em>script</em>’s e a inferior o Console. Como resultado, o seu ambiente do RStudio ficará semelhante ao ambiente exibido na figura 1.16.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/quadrantes_script_mod.png" alt="Quadrantes da área de trabalho do RStudio, após a abertura de um script" width="100%" />
<p class="caption">
(#fig:FIG criar script)Quadrantes da área de trabalho do RStudio, após a abertura de um script
</p>
</div>
<p></p>
<p>Você pode criar títulos que delimitam as áreas, ou as etapas de seu <em>script</em>, e é uma forma muito eficiente de navegar pelo seu <em>script</em>, caso ele seja muito grande. Na figura 1.17, um exemplo destes títulos está identificado pela seta azul. Também na figura 1.17, temos uma caixa vermelha, e dentro dela podemos ver uma referência que aponta qual a seção, ou melhor, qual o título da seção no qual o nosso cursor se encontra atualmente. O meu cursor se encontra no momento, na seção “Importando os dados para o R.” Ao clicar sobre esta referência especificada na caixa vermelha, uma nova caixa de seleção irá aparecer contendo cada um dos títulos que você criou em seu <em>script</em>, e ao clicar sobre um destes títulos, você será redirecionado para o início desta seção no <em>script</em>.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/script_2_mod.png" alt="Títulos e comentários em *scripts*" width="80%" />
<p class="caption">
(#fig:unnamed-chunk-43)Títulos e comentários em <em>scripts</em>
</p>
</div>
<p></p>
<p>Esses títulos especiais, são formados pela união entre o caractere de comentário do R (<code>#</code> - <em>hashtag</em>), o texto que você quer inserir neste título, e vários sinais de menos (<code>-</code>) em sequência, formando assim a seguinte estrutura: <code>### &lt;título desejado&gt; -------</code>. O número de <em>hashtag</em>’s e de sinais de menos que você insere, são arbitrários. Ao invés de escrevê-los a mão, o RStudio oferece um atalho que cria automaticamente esses títulos, através das teclas <code>Ctrl + Shift + R</code>.</p>
<p>Lembre-se que você também pode adicionar pequenas anotações e comentários em seu <em>script</em> com <em>hashtags</em> (<code>#</code>). Nós definimos em seções anteriores, que este é um caractere especial da linguagem, e que qualquer texto que você colocar a frente dele, será ignorado pelo console. Na figura 1.17, temos um exemplo deste comentário que está marcado por uma seta verde.</p>
<p>Esses comentários são uma boa forma de descrever o que os comandos abaixo dele fazem, ou então de apontar configurações e cuidados importantes que você deve ter com esses comandos. Isso é importante especialmente com aquelas funções que você raramente utiliza, pois é menos provável que você se lembre de como elas funcionam, ou de como elas se comportam.</p>
<div id="executando-comandos-de-um-script" class="section level3" number="1.6.1">
<h3 number="1.6.1"><span class="header-section-number">1.6.1</span> Executando comandos de um script</h3>
<p>A essa altura, você já sabe que para executarmos qualquer comando do R, ele precisa ser enviado para o console, onde será avaliado e executado. Por isso, ao utilizarmos um <em>script</em>, desejamos uma forma rápida de enviarmos esses comandos que estão guardados neste <em>script</em>, para o console do R. O RStudio oferece um atalho para isso, que é o <code>Ctrl + Enter</code>. Veja a figura 1.18, se o cursor de seu mouse estiver sobre o retângulo vermelho desenhado no <em>script</em>, ao apertar o atalho <code>Ctrl + Enter</code>, o RStudio enviará todo o bloco de comandos que criam o objeto <code>dados_selecionados</code>, para o console. Agora, se o cursor de seu mouse estivesse sobre o retângulo verde desenhado no <em>script</em>, o RStudio enviaria o bloco de comandos que formam o objeto <code>media_estados</code>.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/script_comand_mod.png" alt="Executando comandos de um *script*" width="70%" />
<p class="caption">
(#fig:unnamed-chunk-44)Executando comandos de um <em>script</em>
</p>
</div>
<p></p>
<p>Após enviar um bloco de comandos para o console, através deste atalho, o RStudio irá automaticamente mover o cursor de seu mouse para o próximo bloco de comandos. Desta maneira, você pode executar parte por parte de seu <em>script</em> em sequência e, conferir os resultados de cada bloco no console.</p>
<p>Além disso, o RStudio também oferece um outro atalho para caso você queira executar todos os comandos de um <em>script</em> de uma vez só. Para isso, você pode apertar as teclas <code>Crtl + Alt + R</code>.</p>
</div>
<div id="salvando-um-script" class="section level3" number="1.6.2">
<h3 number="1.6.2"><span class="header-section-number">1.6.2</span> Salvando um <em>script</em></h3>
<p>Ao salvar o seu <em>script</em>, você está salvando os comandos necessários para gerar os seus resultados. Isto é, através de <em>script</em>’s você possui uma poderosa ferramenta para a reprodutibilidade de sua análise. Em outras palavras, com um <em>script</em>, você é capaz de salvar <strong>os comandos necessários para se obter o resultado desejado</strong>, no lugar dos próprios resultados em si. Dito de outra forma, é muito mais prático carregarmos a metodologia necessária para se obter um resultado, do que o resultado em si. Pois você pode gerar repetidamente os mesmos resultados através dos comandos salvos em seu <em>script</em>, quantas vezes forem necessárias. Por outro lado, você não é capaz de gerar o <em>script</em>, ou os comandos necessários, ou a metodologia de cálculo utilizada, a partir de seus resultados.</p>
<p>Para salvar um <em>script</em> que está aberto em seu RStudio, você pode clicar em <em>File</em> <span class="math inline">\(\rightarrow\)</span> <em>Save As…</em>, e escolher o diretório em que o arquivo será guardado. Você também pode salvar esse <em>script</em>, ao clicar sobre o símbolo de disquete, presente logo abaixo do nome desse <em>script</em>, no canto superior direito. Uma vez definido o nome do <em>script</em> e o local onde ele será guardado, você pode clicar em <em>File</em> <span class="math inline">\(\rightarrow\)</span> <em>Save</em>, ou utilizar o atalho <code>Ctrl + S</code> para salvar o <em>script</em> corrente a medida em que você for editando-o.</p>
<p>Além desses pontos, lembre-se que um <em>script</em> é nada mais do que um arquivo de texto com uma extensão <code>.R</code> e, por isso, ele pode ser aberto normalmente por editores de texto padrão (como o Bloco de Notas do Windows, ou por programas como Notepad ++ e Sublime Text).</p>
</div>
</div>
<div id="sec:pacotes" class="section level2" number="1.7">
<h2 number="1.7"><span class="header-section-number">1.7</span> Pacotes</h2>
<p>Como descrevemos anteriormente na seção <a href="#sec:sistema_universo_r">O sistema e universo do R</a>, o R pode ser divido em duas partes: os pacotes básicos da linguagem; e todos os demais pacotes externos que foram criados e ofertados pela comunidade do R. Um pacote (<em>package</em>) corresponde a unidade fundamental de compartilhamento de códigos e funções no R <span class="citation">(<a href="#ref-wickham2015_packages" role="doc-biblioref">Wickham 2015b</a>)</span>. Dito de outra forma, segundo as palavras de <span class="citation"><a href="#ref-wickham2017" role="doc-biblioref">Wickham and Grolemund</a> (<a href="#ref-wickham2017" role="doc-biblioref">2017</a>)</span>, um pacote do R é uma coleção de funções, dados e documentação que estendem as funcionalidades do R.</p>
<p>No momento de escrita desta obra (novembro de 2020), existem mais de <a href="https://cran.r-project.org/web/packages/">16.000 pacotes disponíveis no CRAN</a>. Segundo <span class="citation"><a href="#ref-wickham2015_packages" role="doc-biblioref">Wickham</a> (<a href="#ref-wickham2015_packages" role="doc-biblioref">2015b</a>)</span>, esta grande variedade de pacotes representa uma das principais razões para o sucesso do R nos anos recentes, e ressalta o seguinte pensamento: <strong>é bastante provável que algum usuário já tenha enfrentado o mesmo problema que você, e após solucioná-lo, tenha ofertado um pacote que possa auxiliar você, na busca dessa solução</strong>. Logo, você pode obter enormes benefícios ao utilizar o conjunto de funções desenvolvidas por outros usuários para resolver os seus problemas.</p>
<div id="como-utilizar-um-pacote" class="section level3" number="1.7.1">
<h3 number="1.7.1"><span class="header-section-number">1.7.1</span> Como utilizar um pacote</h3>
<p>Como é descrito por <span class="citation"><a href="#ref-adler2010" role="doc-biblioref">Adler</a> (<a href="#ref-adler2010" role="doc-biblioref">2010</a>)</span>, para utilizarmos um pacote no R, precisamos “carregá-lo” para a nossa sessão. Porém, para “carregarmos” um pacote para a nossa sessão, esse pacote precisa estar instalado em nosso computador. Logo, em resumo, nós devemos realizar os seguintes passos:<a href="#fn6" class="footnote-ref" id="fnref6"><sup>6</sup></a></p>
<ol style="list-style-type: decimal">
<li>Instalar o pacote a partir do servidor do CRAN: <code>install.packages("nome_do_pacote")</code>.</li>
<li>Carregar o pacote em cada sessão no R: <code>library(nome_do_pacote)</code>.</li>
</ol>
<p>Você precisa executar o primeiro passo (instalar o pacote com a função <code>install.packages()</code>) apenas uma vez. Após instalar o pacote em sua máquina, você precisa carregar esse pacote através da função <code>library()</code> em toda sessão no R que você desejar utilizar as funções desse pacote. Ou seja, toda vez que iniciar o R, você precisa carregar o pacote para ter acesso às suas funções.</p>
<p>Por exemplo, se você desejasse utilizar as funções disponíveis no pacote <code>ggplot2</code>, que possui um conjunto de funções voltadas para a composição de gráficos, você precisaria dos comandos abaixo. Repare que o nome do pacote é fornecido como <em>string</em> à função <code>install.packages()</code>. Logo, sempre que for instalar um pacote, lembre-se de contornar o nome do pacote por aspas (simples ou duplas).</p>
<p></p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Instalar o pacote `ggplot2` em seu computador</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;ggplot2&quot;</span>)</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Carregar o pacote `ggplot2` em sua sessão atual do R</span></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span></code></pre></div>
<p></p>
<p>Como <span class="citation"><a href="#ref-gillespie2017" role="doc-biblioref">Gillespie and Lovelace</a> (<a href="#ref-gillespie2017" role="doc-biblioref">2017</a>)</span> destaca, uma boa prática a ser adotada é carregar todos os pacotes necessários sempre no início de seu <em>script</em>. Dessa forma, você está acoplando a sua sessão, todas as dependências necessárias para aplicar todas as funções dispostas ao longo de seu <em>script</em>.</p>
</div>
<div id="identificando-os-pacotes-instalados-em-sua-máquina-e-aqueles-que-foram-carregados-para-a-sua-sessão" class="section level3" number="1.7.2">
<h3 number="1.7.2"><span class="header-section-number">1.7.2</span> Identificando os pacotes instalados em sua máquina e aqueles que foram carregados para a sua sessão</h3>
<p>Um dos métodos mais diretos de se identificar se um determinado pacote está ou não carregado em sua sessão, consiste em você tentar utilizar uma das funções desse pacote. Se um erro aparecer durante esse processo, indicando que tal função não foi encontrada ou que ela não existe, há grandes chances de que o pacote pelo qual você está preocupado, não se encontra disponível em sua sessão atual.</p>
<p>Por exemplo, eu posso tentar utilizar a função <code>mutate()</code> do pacote <code>dplyr</code> como eu normalmente faria. Pela mensagem de erro abaixo, sabemos que o R não pôde encontrar a função <code>mutate()</code>, logo, o pacote <code>dplyr</code> provavelmente não foi carregado para a minha sessão até o momento.</p>
<p></p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>()</span></code></pre></div>
<p></p>
<pre><code>Error in mutate() : não foi possível encontrar a função &quot;mutate&quot;</code></pre>
<p>Apesar de rápido, este método é um pouco inseguro. Pois, existe a chance de um dos pacotes que já estão carregados em minha sessão, possuir uma função com o mesmo nome <code>mutate()</code>. Em outras palavras, ao tentar executar a função <code>mutate()</code> em minha sessão, pode ser que o R encontre uma função <code>mutate()</code> diferente da que estou procurando. Por isso, um método mais seguro é necessário.</p>
<p>A resposta para tal necessidade se encontra na lista de <em>environments</em> conectados à minha sessão atual do R. Cada pacote que você carrega para a sua sessão, é representado por um <em>environment</em> que está acoplado ao seu <em>environment</em> principal. Logo, para descobrirmos se um pacote foi carregado com sucesso para a nossa sessão, podemos consultar se esse pacote está incluso na lista de todos os <em>environments</em> presentes em nossa sessão. Para obtermos uma lista dos <em>environments</em> presentes em nossa sessão, nós podemos executar a função <code>search()</code>, como abaixo:</p>
<p></p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">search</span>()</span></code></pre></div>
<pre><code>##  [1] &quot;.GlobalEnv&quot;           &quot;package:ragg&quot;         &quot;package:RcppRoll&quot;    
##  [4] &quot;package:glue&quot;         &quot;package:nycflights13&quot; &quot;package:SAScii&quot;      
##  [7] &quot;package:haven&quot;        &quot;package:readxl&quot;       &quot;package:vctrs&quot;       
## [10] &quot;package:lobstr&quot;       &quot;package:lubridate&quot;    &quot;package:knitr&quot;       
## [13] &quot;package:forcats&quot;      &quot;package:stringr&quot;      &quot;package:dplyr&quot;       
## [16] &quot;package:purrr&quot;        &quot;package:readr&quot;        &quot;package:tidyr&quot;       
## [19] &quot;package:tibble&quot;       &quot;package:ggplot2&quot;      &quot;package:tidyverse&quot;   
## [22] &quot;package:fs&quot;           &quot;package:bslib&quot;        &quot;package:bookdown&quot;    
## [25] &quot;tools:rstudio&quot;        &quot;package:stats&quot;        &quot;package:graphics&quot;    
## [28] &quot;package:grDevices&quot;    &quot;package:utils&quot;        &quot;package:datasets&quot;    
## [31] &quot;package:methods&quot;      &quot;Autoloads&quot;            &quot;package:base&quot;</code></pre>
<p></p>
<p>Os valores que estiverem na forma <code>package:nome_do_pacote</code> indicam o <em>environment</em> de um pacote que está carregado em sua sessão atual do R. Já o valor denominado <code>.GlobalEnv</code>, representa o <em>global environment</em>, que é o seu <em>environment</em> principal de trabalho, onde todos os seus objetos criados são salvos. Vamos descrever em mais detalhes esses pontos, na seção <a href="#sec:environments">Noções básicas de <em>environments</em></a>. Por enquanto, perceba pelo resultado acima, que os pacotes <code>tibble</code> e <code>tidyr</code> estão carregados em minha sessão, pois os seus <em>environments</em> (<code>package:tibble</code> e <code>package:tidyr</code>) estão listados no resultado da função <code>search()</code>.</p>
<p>Por outro lado, você talvez enfrente algum erro ao tentar carregar o pacote de seu interesse. Nesse caso, um bom movimento seria se certificar que esse pacote está instalado em sua máquina. Segundo <span class="citation"><a href="#ref-adler2010" role="doc-biblioref">Adler</a> (<a href="#ref-adler2010" role="doc-biblioref">2010</a>)</span>, se você precisa identificar todos os pacotes instalados em sua máquina, você pode executar a função <code>library()</code> sem definir nenhum argumento ou pacote em específico.</p>
<p></p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Uma nova janela será aberta em seu RStudio</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="co"># contendo uma lista de todos os pacotes instalados</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>()</span></code></pre></div>
<p></p>
<p>Caso o pacote que você está tentando carregar não apareça na lista resultante de <code>library()</code>, significa que esse pacote não está instalado em sua máquina. Logo, você precisa instalá-lo com a função <code>install.packages()</code> antes que você possa utilizar as funcionalidades desse pacote em sua sessão do R.</p>
</div>
<div id="acessando-as-funções-de-um-pacote-sem-carregá-lo-para-sua-sessão" class="section level3" number="1.7.3">
<h3 number="1.7.3"><span class="header-section-number">1.7.3</span> Acessando as funções de um pacote sem carregá-lo para sua sessão</h3>
<p>Apesar de ser uma prática ideal na maioria das situações, você talvez não queira carregar um pacote específico e, mesmo assim, utilizar uma de suas funções. Tal opção pode gerar uma importante economia de espaço em sua memória RAM, durante a sua análise. Até porque, se você vai utilizar apenas uma única função do pacote, talvez não haja necessidade de carregar o pacote inteiro.</p>
<p>Para acessarmos uma função de um pacote que não foi carregado ainda em nossa sessão, precisamos chamar primeiro pelo pacote de onde estamos tirando a função, como na estrutura abaixo.</p>
<p></p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Acessar uma função de um pacote sem carregá-lo</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>nome_do_pacote<span class="sc">::</span>nome_da_função()</span></code></pre></div>
<p></p>
<p>Logo, se você quisesse acessar a função <code>filter()</code> do pacote <code>dplyr</code>, por exemplo, você precisa primeiro chamar pelo pacote <code>dplyr</code> e, em seguida, posicionar duas vezes dois pontos (<code>:</code>) para acessar uma função ou objeto presente neste pacote. Por último, basta digitar o nome da função de interesse.</p>
<p></p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Para acessar a função filter() sem chamar</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="co"># pelo pacote dplyr</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">filter</span>()</span></code></pre></div>
<p></p>
</div>
<div id="atualizando-pacotes" class="section level3" number="1.7.4">
<h3 number="1.7.4"><span class="header-section-number">1.7.4</span> Atualizando pacotes</h3>
<p>A linguagem R está o tempo todo evoluindo e se aprimorando e, por essa razão, muitos dos pacotes disponíveis hoje, são constantemente atualizados, com o objetivo de implementar novas funcionalidades e/ou aperfeiçoar a eficiência de suas funções. Logo, é uma boa prática que você mantenha os pacotes instalados em seu computador, constantemente atualizados. Para atualizar um pacote, você precisa apenas instalá-lo novamente, através da função <code>install.packages("nome_do_pacote")</code>, ou acessar a opção <em>Tools</em> <span class="math inline">\(\rightarrow\)</span> <em>Check for Packages Updates…</em> no RStudio, como está demonstrado na figura 1.19. Através dessa opção, o RStudio irá listar todos os pacotes que possuem versões mais recentes e, portanto, podem ser atualizados. A grande vantagem é que você pode atualizar todos os pacotes presentes nessa lista de uma vez só.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/check_updates.png" alt="RStudio: Opção para atualização de pacotes" width="70%" />
<p class="caption">
(#fig:unnamed-chunk-50)RStudio: Opção para atualização de pacotes
</p>
</div>
<p></p>
</div>
</div>
<div id="exercícios" class="section level2 unnumbered">
<h2 class="unnumbered">Exercícios</h2>
<p><strong>Questão 1.1.</strong> Tente calcular algumas operações básicas:</p>
<p>1.1.A) Qual é a soma entre 32397 e 55405?</p>
<p>1.1.B) Calcule a soma total do conjunto de valores dispostos no vetor <code>conj</code> abaixo.</p>
<p></p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>conj <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">290</span>, <span class="dv">34</span>, <span class="dv">512</span>, <span class="dv">54</span>, <span class="dv">89</span>, <span class="dv">10</span>)</span></code></pre></div>
<p></p>
<p>1.1.C) Considerando que, <span class="math inline">\(y = 3x^3 - 12x^2 + \frac{1}{15}x+ 25\)</span>, calcule o valor de <span class="math inline">\(y\)</span> quando <span class="math inline">\(x\)</span> é igual a 5.</p>
<p><strong>Questão 1.2.</strong> Em cada item abaixo, temos uma mensagem de erro específica que supostamente apareceu em seu console. Tente explicar como ou porque essas mensagens podem aparecer em seu console. Em outras palavras, tente explicar o que essas mensagens significam, e qual foi o fato ocorrido que gerou esses erros:</p>
<p>1.2.A) <code>Erro: objeto 'logica' não encontrado</code>.</p>
<p>1.2.B) <code>Error in bind_rows() : não foi possível encontrar a função "bind_rows"</code></p>
<p>1.2.C) <code>Error in library(dplyr) : there is no package called ‘dplyr’</code></p>
<p><strong>Questão 1.3.</strong> As próximas questões vão implicitamente esperar que você utilize algumas dessas funções: <code>sum()</code>, <code>mean()</code>, <code>abs()</code> e <code>sd()</code>. Claro que, o R te oferece a liberdade de escrever as suas próprias funções, ou de desenhar o seu próprio caminho até as soluções dessas questões. Portanto, não se preocupe se você encontrar uma solução para as questões abaixo, que não incluem o uso dessas funções específicas.</p>
<p>1.3.A) Considerando que a variável <span class="math inline">\(X\)</span> segue uma distribuição normal, como você normalizaria (isto é, calcular o índice <span class="math inline">\(Z\)</span> da distribuição) os valores presentes no vetor <code>vec</code> abaixo, que contém uma amostra de valores da variável <span class="math inline">\(X\)</span>.</p>
<p></p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>vec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">1.2</span>, <span class="fl">2.5</span>, <span class="fl">1.3</span>, <span class="fl">2.2</span>, <span class="fl">3.7</span>)</span></code></pre></div>
<p></p>
<p>1.3.B) Utilizando novamente a variável <code>vec</code>, calcule o seu desvio médio.</p>
<p></p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>vec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">1.2</span>, <span class="fl">2.5</span>, <span class="fl">1.3</span>, <span class="fl">2.2</span>, <span class="fl">3.7</span>)</span></code></pre></div>
<p></p>
<!--chapter:end:01-nocoes-basicas.Rmd-->
</div>
</div>
<div id="fundamentos-da-linguagem-r" class="section level1" number="2">
<h1 number="2"><span class="header-section-number">2</span> Fundamentos da Linguagem R</h1>
<div id="sec:fundamentos_R" class="section level2" number="2.1">
<h2 number="2.1"><span class="header-section-number">2.1</span> Introdução</h2>
<p>Nas próximas seções vou abordar os fundamentos da linguagem: os básicos de sua sintaxe, quais são as estruturas e tipos de dados que a linguagem oferece, e como as suas regras de <em>coercion</em> funcionam.</p>
<p>Na maior parte de sua análise, você não vai estar interessado em como o R está estruturando ou interpretando os seus dados em um dado momento. Porém, várias das funções ou ações que você deseja aplicar, exigem que os seus dados estejam estruturados em uma forma específica. Logo, ter familiaridade com os fundamentos do R, com as suas estruturas e suas propriedades, e principalmente, poder reconhecê-las, vai te salvar muito tempo. Com esse conhecimento, será mais fácil de você evitar erros, e será mais fácil de identificar e transformar a estrutura de seus dados para qualquer que seja a sua necessidade em um dado momento de sua análise.</p>
<p>Tendo isso em mente, além de introduzir a linguagem, as próximas seções também tem como objetivo, lhe fornecer uma base sólida desses fundamentos, para que você possa identificar e transitar entre essas diversas estruturas e tipos de dados, de forma fluida.</p>
</div>
<div id="mais-detalhes-sobre-objetos" class="section level2" number="2.2">
<h2 number="2.2"><span class="header-section-number">2.2</span> Mais detalhes sobre objetos</h2>
<p>Uma das principais características do R, é que ele é uma linguagem orientada a objetos (<em>object oriented</em>). Isto significa, que quando você estiver trabalhando com seus dados no R, você estará aplicando operações e transformações sobre os objetos onde seus dados estão guardados.</p>
<p>Os objetos no R, são como as caixas que você utiliza na sua mudança. Você guarda algo dentro dessa caixa, e coloca um adesivo com um nome para essa caixa, para que você se lembre do que está dentro dela. No dia seguinte à mudança, quando você precisar do conteúdo que está guardado naquela caixa, você procura essa caixa pelo nome que você deu a ela.</p>
<p>No exemplo abaixo, eu estou criando um objeto, que dou o nome de <code>data_aniversario</code>, e estou utilizando o símbolo <code>&lt;-</code> para definir o valor deste objeto para a data de aniversário de um amigo importante (20 de maio). O símbolo <code>&lt;-</code> é comumente chamado de <em>assignment</em>, e significa que estamos atribuindo um valor a um objeto (no caso abaixo, <code>data_aniversario</code>). Em outras palavras, os comandos abaixo, podem ser lidos como: eu atribuo ao objeto de nome <code>data_aniversario</code>, o valor de <code>"20 de maio"</code>. Após isso, sempre que eu chamar por esse nome, o R irá procurar por uma caixa (ou um objeto) que possui um adesivo com um nome de <code>data_aniversario</code>. Quando ele encontrar essa caixa, ele irá me retornar no console o que tem dentro dessa caixa (ou desse objeto).</p>
<p></p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>data_aniversario <span class="ot">&lt;-</span> <span class="st">&quot;20 de maio&quot;</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a><span class="do">### Quando eu chamo pelo nome deste objeto</span></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a><span class="do">### no console, o R me retorna o que tem dentro dele.</span></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>data_aniversario</span></code></pre></div>
<pre><code>## [1] &quot;20 de maio&quot;</code></pre>
<p></p>
<p>O conceito de objeto é uma metáfora, ou uma forma útil de enxergarmos este sistema. Pois para o R, o nome <code>data_aniversario</code> se trata apenas uma conexão até o valor (<code>"20 de maio"</code>). Para demonstrarmos essa ideia, vamos utilizar os endereços desses objetos. Isto é, todos os valores contidos nos objetos que você cria em sua sessão do R, vão obrigatoriamente ocupar um espaço, ou um endereço da memória RAM de seu computador. Enquanto este objeto estiver “vivo,” ou seja, enquanto esta conexão entre o nome <code>x</code> e os seus valores permanecer acessível em sua sessão, esses valores vão estar ocupando um endereço específico de sua memória RAM. Para descobrirmos esse endereço, nós podemos utilizar a função <code>ref()</code> do pacote <code>lobstr</code>. Vamos supor por exemplo, que nós criamos um vetor chamado <code>x</code>, que contém três números. Perceba abaixo pelo resultado da função <code>ref()</code>, que ao criar este objeto <code>x</code>, os seus valores foram alocados no endereço <code>0x1ca169c03d8</code> da minha memória RAM.</p>
<p></p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lobstr)</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>)</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ref</span>(x)</span></code></pre></div>
<p></p>
<pre><code>## [1:0x1ca169c03d8] &lt;dbl&gt; </code></pre>
<p>Portanto, um objeto no R, nada mais é do que uma conexão entre um nome e valores que estão guardados em um endereço da memória RAM de seu computador. Os únicos momentos em que este endereço muda, serão todas as vezes em que você reiniciar a sua sessão no R, ou todas vezes em que você executar novamente os códigos necessários para criar os seus objetos. Tendo isso em mente, em uma representação visual, um objeto no R pode ser representado pela figura 2.1.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/objetos_1.png" alt="Representação de um objeto" width="60%" />
<p class="caption">
(#fig:unnamed-chunk-54)Representação de um objeto
</p>
</div>
<p></p>
<p>Para desenvolvermos essa ideia, pense o que ocorreria, se atribuíssemos os valores do objeto <code>x</code>, a um novo objeto. Segundo essa perspectiva, nós estaríamos apenas conectando o vetor com os valores 6, 7 e 8, a um novo nome, no exemplo abaixo, ao nome <code>y</code>. Nós poderíamos utilizar novamente a função <code>ref()</code> para conferirmos o endereço onde os valores do objeto <code>y</code>, se encontram, e perceba que eles estão no mesmo local que os valores do objeto <code>x</code>.</p>
<p></p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> x</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ref</span>(y)</span></code></pre></div>
<p></p>
<pre><code>## [1:0x1ca169c03d8] &lt;dbl&gt; </code></pre>
<p>Logo, se atualizarmos a nossa representação visual, temos o seguinte resultado:</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/objetos_2.png" alt="Conectando mais nomes a um mesmo conjunto de valores" width="60%" />
<p class="caption">
(#fig:unnamed-chunk-56)Conectando mais nomes a um mesmo conjunto de valores
</p>
</div>
<p></p>
<p>Em outras palavras, o R em nenhum momento criou uma cópia do vetor contendo os valores 6, 7 e 8, e alocou essa cópia no objeto <code>y</code>. Ele apenas conectou um novo nome (<code>y</code>) a esse vetor de valores. Por isso, quando você possui um objeto, e atribui um novo valor a este objeto, você está na verdade eliminando a conexão que o nome deste objeto possuía com o valor que estava guardado anteriormente naquele objeto. Ou seja, se você retornar ao vetor <code>x</code>, e definir um novo valor para ele, você estaria eliminando a sua conexão com o vetor que contém os números 6, 7 e 8, e atribuindo essa conexão a um outro conjunto de valores. Por exemplo, caso eu executasse o comando <code>x &lt;- "Hello World"</code>, o resultado seria uma nova conexão como você pode ver pela figura 2.3.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/objetos_3.png" alt="Atribuindo novos valores a seus objetos" width="60%" />
<p class="caption">
(#fig:unnamed-chunk-57)Atribuindo novos valores a seus objetos
</p>
</div>
<p></p>
<p>O R vai jogar fora, qualquer valor que não esteja conectado a um nome, ou a um objeto em sua sessão. Logo, tendo em mente a figura 2.3, caso eu atribuísse um novo valor ao objeto <code>y</code>, a última conexão até o vetor que contém os números 6, 7 e 8, seria eliminada. Com isso, este vetor não possuiria mais nenhuma conexão até um nome e, por isso, seria descartado pelo R. Portanto, se você precisa atribuir um novo valor para um determinado objeto, mas deseja manter o valor que você deu a ele anteriormente, basta que você crie uma nova conexão até o valor antigo. Em outras palavras, se você quer manter este valor, basta conectá-lo a um novo objeto.</p>
<p>No exemplo abaixo, eu crio um objeto (<code>economista_1</code>) contendo o nome de um economista famoso, e em seguida conecto este nome a um novo objeto (<code>economista_anterior</code>). Portanto, o nome de Keynes está agora conectado a dois nomes, ou está contido em dois objetos diferentes em sua sessão no R. Por último, eu sobreponho o nome de Keynes que guardei no primeiro objeto (<code>economista_1</code>), pelo nome de outro economista famoso. Quando faço isso, estou efetivamente eliminando uma das conexões até o nome de Keynes, e atribuindo essa conexão ao nome de Schumpeter. Porém, como o nome de Keynes ainda possui uma conexão existente (<code>economista_anterior</code>), o nome continua “vivo” e presente em nossa sessão, e se quisermos acessar novamente esse nome, basta chamarmos pelo objeto onde o salvamos.</p>
<p></p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Primeiro valor</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>economista_1 <span class="ot">&lt;-</span> <span class="st">&quot;John Maynard Keynes&quot;</span></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Atribuindo o primeiro valor a um novo</span></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a><span class="co"># objeto</span></span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>economista_anterior <span class="ot">&lt;-</span> economista_1</span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Sobrepondo o primeiro valor no</span></span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a><span class="co"># primeiro objeto com um novo nome</span></span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a>economista_1 <span class="ot">&lt;-</span> <span class="st">&quot;Joseph Alois Schumpeter&quot;</span></span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a>economista_1</span></code></pre></div>
<pre><code>## [1] &quot;Joseph Alois Schumpeter&quot;</code></pre>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>economista_anterior</span></code></pre></div>
<pre><code>## [1] &quot;John Maynard Keynes&quot;</code></pre>
<p></p>
</div>
<div id="como-o-r-organiza-e-interpreta-os-seus-dados" class="section level2" number="2.3">
<h2 number="2.3"><span class="header-section-number">2.3</span> Como o R organiza e interpreta os seus dados</h2>
<p>Em resumo, o R possui diferentes formas de estruturar (ou de organizar) os dados que você fornece a ele. Essas formas são o que estou chamando de estruturas de dados. Quando estamos decidindo em qual estrutura devemos armazenar os nossos dados, estamos basicamente fazendo o processo mental descrito na figura 2.4:</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/talvez_um_vetor.png" alt="Estruturas de dados" width="80%" />
<p class="caption">
(#fig:unnamed-chunk-59)Estruturas de dados
</p>
</div>
<p></p>
<p>Além da forma como os nossos dados estão organizados dentro de uma estrutura do R, nós também podemos estar interessados em como o R está interpretando esses dados, em um dado momento. Isso é uma questão extremamente relevante, na medida em que diferentes funções esperam como <em>input</em>, um tipo de dado específico, ou também, pelo fato do R aplicar (em alguns casos) diferentes “versões” de uma mesma função, a depender do tipo associado aos seus dados.</p>
<p>Portanto, estamos nos perguntando qual o tipo de dado que o R está associando a um certo conjunto de valores, e em muitas ocasiões podemos nos surpreender com as escolhas da linguagem. Uma surpresa, que está representada na figura 2.5. Como exemplo, quando eu vejo o valor <code>"20/05/2020"</code>, eu rapidamente o associo à data 20 de maio de 2020, mas será que o R compreende que este valor se trata de uma data? A resposta curta é, não.</p>
<p>Pelo fato das datas não estarem entre os tipos de dados básicos do R, valores como <code>"20/05/2020"</code> são tratados inicialmente como simples textos (isto é, valores do tipo <code>character</code>), enquanto não dissermos explicitamente para o R, que esses valores se tratam de datas. Isso é um ponto importante, pois várias funções ou ações que queremos executar no R, exigem que os seus dados estejam no tipo adequado. Por isso, você vai enfrentar diversas situações onde o console lhe retorna um erro confuso, e depois de alguns minutos, você busca conferir a estrutura de seus dados, e supreendentemente descobre que o R estava o tempo todo interpretando os seus números como textos!</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/tipos_dados.png" alt="Tipos de dados" width="80%" />
<p class="caption">
(#fig:unnamed-chunk-60)Tipos de dados
</p>
</div>
<p></p>
<p>Portanto, vamos começar descrevendo nas próximas seções as estruturas de dados presentes na linguagem e, em seguida, os tipos de dados básicos do R. Nessas seções, não vamos incluir uma estrutura do R em específico, que é o <code>array</code>. Nós veremos mais a frente, as matrizes (<code>matrix</code>), que no fundo são um caso especial de <code>array</code>. Enquanto matrizes são vetores com duas dimensões (uma dimensão para as linhas e outra para as colunas), os <code>array</code> são vetores com “n” dimensões. Em outras palavras, com um <code>array</code> você pode criar um objeto tridimensional (3 dimensões), ou se quiser ir longe, um objeto com 4, 5, ou infinitas dimensões.</p>
</div>
<div id="sec:estruturas_dados" class="section level2" number="2.4">
<h2 number="2.4"><span class="header-section-number">2.4</span> Estruturas de dados</h2>
<div id="sec:vetores_estrutura" class="section level3" number="2.4.1">
<h3 number="2.4.1"><span class="header-section-number">2.4.1</span> Vetores</h3>
<p>Os vetores são a estrutura básica da linguagem R, pois todas as outras estruturas, são construídas a partir desses vetores. Um vetor é simplesmente uma sequência de valores. Valores que podem ser datas, números, textos, índices, ou qualquer outro tipo que você imaginar. Pelo fato de ser uma simples sequência de valores, o vetor é uma estrutura unidimensional. É como se esse vetor fosse composto por apenas uma coluna, que você preenche com quantas linhas você precisar. Ou então, você também pode imaginá-lo como uma corda, que amarra e mantém os seus valores conectados um atrás do outro.</p>
<p>A forma mais simples de se criar um vetor, é através da função <code>c()</code> (abreviação para <em>combine</em>, ou combinar), em que você fornece os valores que quer incluir neste vetor, separando-os por vírgulas. A outra forma (indireta) de se criar um vetor, é através de funções que retornam por padrão este tipo de estrutura. Um exemplo simples, é a função <code>:</code> que serve para criar sequências numéricas no R, no exemplo abaixo, uso essa função para criar uma sequência de 1 a 10. Outro exemplo, seria a função <code>rep()</code> que serve para repetir um conjunto de valores, por quantas vezes você quiser.</p>
<p></p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="dv">48</span>, <span class="dv">24</span>, <span class="dv">12</span>, <span class="dv">6</span>)</span></code></pre></div>
<pre><code>## [1] 48 24 12  6</code></pre>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>, <span class="st">&quot;d&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;a&quot; &quot;b&quot; &quot;c&quot; &quot;d&quot;</code></pre>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">:</span><span class="dv">10</span></span></code></pre></div>
<pre><code>##  [1]  1  2  3  4  5  6  7  8  9 10</code></pre>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;Ana&quot;</span>, <span class="st">&quot;Eduardo&quot;</span>), <span class="at">times =</span> <span class="dv">5</span>)</span></code></pre></div>
<pre><code>##  [1] &quot;Ana&quot;     &quot;Eduardo&quot; &quot;Ana&quot;     &quot;Eduardo&quot; &quot;Ana&quot;     &quot;Eduardo&quot; &quot;Ana&quot;    
##  [8] &quot;Eduardo&quot; &quot;Ana&quot;     &quot;Eduardo&quot;</code></pre>
<p></p>
<p>Como o vetor é uma estrutura unidimensional, eu posso acessar um único valor dentro desse vetor, utilizando apenas um índice. Por exemplo, se eu quero extrair o quarto valor dessa sequência, eu utilizo o número 4, se eu quero o terceiro valor, o número 3, e assim por diante. Para acessar “partes,” ou um único valor de uma estrutura no R, nós utilizamos a função <code>[</code>, e para utilizá-la, basta abrir colchetes após o nome do objeto onde você salvou este vetor, ou após a função que está gerando este vetor.</p>
<p></p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>vetor <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>vetor[<span class="dv">4</span>]</span></code></pre></div>
<pre><code>## [1] 4</code></pre>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>)[<span class="dv">3</span>]</span></code></pre></div>
<pre><code>## [1] &quot;c&quot;</code></pre>
<p></p>
<p>Para acessar mais de um valor dentro deste vetor, você terá que fornecer um novo vetor de índices à função <code>[</code>. Um jeito prático de criar este novo vetor de índices, é criando uma sequência com a função <code>:</code> que vimos anteriormente. Um detalhe, é que o R irá extrair os valores na ordem em que você os dá a <code>[</code>. Logo, se eu dentro de <code>[</code> incluir o vetor <code>c(2,4,6,1)</code>, o R irá lhe retornar um novo vetor, que contém o segundo, quarto, sexto e primeiro item do vetor anterior, respectivamente. Caso você repita algum índice, o R irá repetir o valor dentro do vetor resultante, e não te avisará sobre isso.</p>
<p></p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>vetor <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">25</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>vetor[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]</span></code></pre></div>
<pre><code>## [1] 1 2 3 4</code></pre>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>vetor[<span class="dv">8</span><span class="sc">:</span><span class="dv">13</span>]</span></code></pre></div>
<pre><code>## [1]  8  9 10 11 12 13</code></pre>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>vetor[<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">1</span>)]</span></code></pre></div>
<pre><code>## [1] 2 4 4 1</code></pre>
<p></p>
<p>Os vetores que estamos criando com essas funções são comumente chamados de vetores atômicos (<em>atomic vector</em>). Esses vetores possuem uma propriedade simples e importante: <strong>vetores atômicos possuem apenas um único tipo de dado dentro deles</strong>. Você não consegue guardar dentro de um mesmo vetor, valores de dois tipos de dados diferentes (por exemplo, textos e números) sem que alguma transformação ocorra. Caso você tente burlar essa regra, o R irá automaticamente converter os valores para um único tipo de dado, e pode ser que parte desses dados não possam ser convertidos de forma lógica para este único tipo, e acabam sendo “perdidos” neste processo. Falaremos mais sobre esse processo de conversão, quando chegarmos em tipos de dados.</p>
</div>
<div id="matrizes" class="section level3" number="2.4.2">
<h3 number="2.4.2"><span class="header-section-number">2.4.2</span> Matrizes</h3>
<p>Matrizes nada mais são do que vetores com duas dimensões. Se você possui dados atualmente alocados em um vetor, e deseja organizá-los em colunas e linhas, você pode rapidamente criar uma matriz com este vetor, ao adicionar dimensões a ele, através da função <code>dim()</code>. Você usa a função sobre o vetor desejado à esquerda do símbolo de <em>assignment</em> (<code>&lt;-</code>), e atribui um valor ao resultado dessa função. No caso de matrizes, esse valor será um vetor com dois elementos, o primeiro definindo o número de linhas, e o segundo, o número de colunas.</p>
<p></p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>vetor <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(vetor) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">2</span>)</span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a>vetor</span></code></pre></div>
<pre><code>##      [,1] [,2]
## [1,]    1    4
## [2,]    2    5
## [3,]    3    6</code></pre>
<p></p>
<p>Uma outra forma de criar uma matriz, é através da função <code>matrix()</code>. Você primeiro fornece um vetor à função, e define quantas colunas você deseja em <code>ncol</code>, e quantas linhas em <code>nrow</code>. Um detalhe que fica claro no exemplo abaixo, é que ao criar uma matriz, ela por padrão será preenchida por coluna, e não por linha. Caso você queira que ela seja preenchida por linha, você deve adicionar o valor <code>TRUE</code>, ao argumento <code>byrow</code> na função.</p>
<p></p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Para preencher a matriz, por linha, adicione</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a><span class="co"># byrow = TRUE à função</span></span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a><span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>, <span class="at">nrow =</span> <span class="dv">5</span>, <span class="at">ncol =</span> <span class="dv">4</span>)</span></code></pre></div>
<pre><code>##      [,1] [,2] [,3] [,4]
## [1,]    1    6   11   16
## [2,]    2    7   12   17
## [3,]    3    8   13   18
## [4,]    4    9   14   19
## [5,]    5   10   15   20</code></pre>
<p></p>
<p>Os vetores são estruturas unidimensionais, e com apenas um índice poderíamos acessar um valor contido nele. Porém, as matrizes possuem duas dimensões, logo, temos que fornecer dois índices à função <code>[</code> para acessarmos um único elemento dessa matriz. Basta você separar esses dois índices por uma vírgula, onde o primeiro valor corresponde a linha, e o segundo, a coluna desejada. No exemplo abaixo, estou extraindo o elemento que se encontra na terceira linha da quarta coluna.</p>
<p></p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>matriz <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>, <span class="at">nrow =</span> <span class="dv">5</span>, <span class="at">ncol =</span> <span class="dv">4</span>)</span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>matriz[<span class="dv">3</span>,<span class="dv">4</span>]</span></code></pre></div>
<pre><code>## [1] 18</code></pre>
<p></p>
<p>Eu posso também extrair uma parte dessa matriz, ao fornecer mais valores dentro de um vetor, para cada um dos dois índices. No primeiro exemplo abaixo, eu extraio todos os valores da primeira a terceira linha da segunda coluna da matriz. Agora, caso eu queira extrair todos os valores de uma dimensão (todas as linhas, ou todas as colunas), basta que eu deixe em “branco” ao lado de cada índice. No segundo exemplo abaixo, estou extraindo todos os valores da segunda coluna.</p>
<p></p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>matriz[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">2</span>] <span class="co"># É o mesmo que: matriz[c(1,2,3), 2]</span></span></code></pre></div>
<pre><code>## [1] 6 7 8</code></pre>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>matriz[ , <span class="dv">2</span>]</span></code></pre></div>
<pre><code>## [1]  6  7  8  9 10</code></pre>
<p></p>
<p>Pelo fato de matrizes serem vetores com duas dimensões, elas herdam a propriedade do vetor, e, portanto: <strong>matrizes podem conter dados de apenas um único tipo</strong>. Por essa característica, você provavelmente utilizará essa estrutura poucas vezes. De qualquer forma é útil conhecê-la.</p>
</div>
<div id="sec:estrutura_listas" class="section level3" number="2.4.3">
<h3 number="2.4.3"><span class="header-section-number">2.4.3</span> Listas</h3>
<p>A lista é uma estrutura especial e muito importante do R, pois ela é a exceção da propriedade dos vetores (que podem conter apenas um tipo de dado). <strong>Portanto, uma lista é um vetor, onde cada elemento deste vetor pode ser não apenas de um tipo de dado diferente, mas também de tamanho e estrutura diferentes.</strong> Dito de outra forma, você pode incluir o que você quiser em cada elemento de uma lista.</p>
<p>Uma lista é criada pela função <code>list()</code>, e para utilizá-la, basta fornecer os valores que deseja inserir em cada elemento desta lista, separados por vírgulas. No exemplo abaixo, estou inserindo no primeiro elemento desta lista a data que vimos anteriormente (“20/05/2020”), no segundo, estou incluindo uma matriz, no terceiro, um vetor com nomes, e no quarto, um <code>data.frame</code> (falaremos sobre eles após essa seção).</p>
<p></p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lista nomeada</span></span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a><span class="co"># nome = valor</span></span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>lista <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="st">&quot;20/05/2020&quot;</span>,</span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">matriz =</span> <span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>, <span class="at">ncol =</span> <span class="dv">4</span>, <span class="at">nrow =</span> <span class="dv">5</span>),</span>
<span id="cb109-6"><a href="#cb109-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">vetor =</span> <span class="fu">c</span>(<span class="st">&quot;Belo Horizonte&quot;</span>, <span class="st">&quot;Londrina&quot;</span>, <span class="st">&quot;Macapá&quot;</span>),</span>
<span id="cb109-7"><a href="#cb109-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">tabela =</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="dv">21</span><span class="sc">:</span><span class="dv">30</span>, <span class="at">y =</span> <span class="fu">rnorm</span>(<span class="dv">10</span>))</span>
<span id="cb109-8"><a href="#cb109-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb109-9"><a href="#cb109-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-10"><a href="#cb109-10" aria-hidden="true" tabindex="-1"></a>lista</span></code></pre></div>
<pre><code>## $data
## [1] &quot;20/05/2020&quot;
## 
## $matriz
##      [,1] [,2] [,3] [,4]
## [1,]    1    6   11   16
## [2,]    2    7   12   17
## [3,]    3    8   13   18
## [4,]    4    9   14   19
## [5,]    5   10   15   20
## 
## $vetor
## [1] &quot;Belo Horizonte&quot; &quot;Londrina&quot;       &quot;Macapá&quot;        
## 
## $tabela
##     x           y
## 1  21 -0.18818659
## 2  22  0.39646214
## 3  23  1.97411496
## 4  24 -0.03074268
## 5  25 -0.61555500
## 6  26 -0.90155293
## 7  27  0.02122923
## 8  28  1.93352346
## 9  29 -0.96827884
## 10 30 -1.91225551</code></pre>
<p></p>
<p>Perceba que nós nomeamos cada elemento dessa lista. Isso abre novas possibilidades, pois agora podemos utilizar um sistema diferente da função <code>[</code> para acessarmos os valores específicos de uma lista, utilizando o operador <code>$</code>. Através deste operador, podemos acessar os elementos dessa lista, através do nome que demos para cada um deles. O problema deste sistema, é que ele lhe permite acessar todos os valores contidos em um elemento de sua lista, mas não lhe permite extrair valores específicos contidos em cada um destes elementos da lista.</p>
<p></p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>lista<span class="sc">$</span>matriz</span></code></pre></div>
<pre><code>##      [,1] [,2] [,3] [,4]
## [1,]    1    6   11   16
## [2,]    2    7   12   17
## [3,]    3    8   13   18
## [4,]    4    9   14   19
## [5,]    5   10   15   20</code></pre>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>lista<span class="sc">$</span>vetor</span></code></pre></div>
<pre><code>## [1] &quot;Belo Horizonte&quot; &quot;Londrina&quot;       &quot;Macapá&quot;</code></pre>
<p></p>
<p>Você não precisa nomear cada um dos elementos dessa lista como fizemos acima. Eu nomeie apenas para dar um exemplo do operador <code>$</code>. Porém, neste caso em que você não atribui um nome a esses elementos, você não pode acessá-los mais pelo operador <code>$</code>, e terá que retornar à funçaõ <code>[</code> para tal serviço. Em outras palavras, se você deseja criar uma lista, mas não está muito preocupado em nomear cada um dos elementos que vão estar nessa lista, basta separar esses valores por vírgulas como no exemplo abaixo:</p>
<p></p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>lista <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>),</span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>),</span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(T, F, T)</span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb115-6"><a href="#cb115-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-7"><a href="#cb115-7" aria-hidden="true" tabindex="-1"></a>lista</span></code></pre></div>
<pre><code>## [[1]]
## [1] 6 7 8
## 
## [[2]]
## [1] &quot;a&quot; &quot;b&quot; &quot;c&quot;
## 
## [[3]]
## [1]  TRUE FALSE  TRUE</code></pre>
<p></p>
<p>Antes de prosseguirmos, darei uma nova descrição (dessa vez, uma descrição visual) de uma lista, para que você fixe na sua cabeça o que ela é. Eu espero que eu tenha desejado bem o suficiente, para que você seja capaz de identificar um trem carregando quatro vagões na figura 2.6. Podemos pensar esse trem como uma lista, e os seus vagões como os elementos dessa lista. Tendo isso em mente, temos na figura 2.6 uma representação de uma lista com quatro elementos.</p>
<p>Como disse anteriormente, podemos incluir o que quisermos dentro de cada elemento dessa lista, ou dentro de cada vagão desse trem. Pois cada vagão é capaz de comportar elementos de qualquer dimensão e em qualquer estrutura, e como esses vagões estão separados uns dos outros, esses elementos não precisam compartilhar das mesmas características. Dito de outra forma, eu posso carregar 15 toneladas de ouro no primeiro vagão, 100 Kg de carvão no segundo vagão, e 1 Kg de ferro no terceiro vagão.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/lista.png" alt="Representação de uma lista" width="70%" />
<p class="caption">
(#fig:unnamed-chunk-71)Representação de uma lista
</p>
</div>
<p></p>
<p>Portanto, a lista é uma estrutura que lhe permite transportar todos esses diferentes elementos, em um mesmo objeto no R (ou todos esses diferentes componentes em um mesmo trem). Quando chegarmos em interação, você verá que essa característica torna a lista, uma estrutura extremamente útil.</p>
<p>Agora como eu posso extrair valores dessa lista através da função <code>[</code> ? Bem, a lista é a exceção da propriedade dos vetores, mas ela continua sendo um vetor em sua essência, ou uma estrutura unidimensional. Por isso, você pode acessar um item de uma lista com apenas um índice dentro de <code>[</code>.</p>
<p>Porém, caso você usar apenas um colchete para selecionar o primeiro elemento de sua lista, você percebe que uma pequena descrição (<code>"[[1]]"</code>), ou o nome que você deu aquele elemento, aparece em cima dos valores contidos neste elemento da lista. Por isso, se você deseja extrair apenas os valores desse elemento, sem essa descrição, você deve utilizar o índice dentro de dois colchetes.</p>
<p></p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>lista <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>,</span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;O ano tem 365 dias&quot;</span>,</span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>, <span class="at">ncol =</span> <span class="dv">4</span>, <span class="at">nrow =</span> <span class="dv">5</span>)</span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb117-6"><a href="#cb117-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-7"><a href="#cb117-7" aria-hidden="true" tabindex="-1"></a>lista[<span class="dv">1</span>]</span></code></pre></div>
<pre><code>## [[1]]
##  [1]  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20</code></pre>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>lista[[<span class="dv">1</span>]]</span></code></pre></div>
<pre><code>##  [1]  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20</code></pre>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>lista[[<span class="dv">2</span>]]</span></code></pre></div>
<pre><code>## [1] &quot;O ano tem 365 dias&quot;</code></pre>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>lista[[<span class="dv">3</span>]]</span></code></pre></div>
<pre><code>##      [,1] [,2] [,3] [,4]
## [1,]    1    6   11   16
## [2,]    2    7   12   17
## [3,]    3    8   13   18
## [4,]    4    9   14   19
## [5,]    5   10   15   20</code></pre>
<p></p>
<p>Isso ocorre, porque quando você utiliza apenas um colchete para selecionar o primeiro elemento, o R acaba lhe retornando uma nova lista contendo um elemento, e não apenas o que está dentro deste elemento em si. Dizendo em termos da representação visual que utilizamos na figura 2.6, se eu possuo um trem com quatro vagões, e utilizo um colchete para selecionar o primeiro vagão, o R me retorna um novo trem que contém o primeiro vagão. Mas se eu utilizo dois colchetes, o R me retorna apenas o primeiro vagão, e nada mais.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/colchetes.png" alt="Diferença entre um e dois colchetes em listas" width="70%" />
<p class="caption">
(#fig:unnamed-chunk-73)Diferença entre um e dois colchetes em listas
</p>
</div>
<p></p>
<p>Mas como eu faço para extrair um valor específico de um elemento de uma lista? Para isso você deve abrir um novo colchete após os colchetes duplos que você criou para selecionar o elemento da lista. A partir daí, basta replicar o que vimos anteriormente com os índices. No exemplo abaixo, estou primeiro selecionando o terceiro elemento da nossa lista (que é uma matriz), e selecionando o item da terceira linha da primeira coluna desta matriz.</p>
<p></p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>lista[[<span class="dv">3</span>]][<span class="dv">3</span>,<span class="dv">1</span>]</span></code></pre></div>
<pre><code>## [1] 3</code></pre>
<p></p>
</div>
<div id="sec:estrutura_data_frames" class="section level3" number="2.4.4">
<h3 number="2.4.4"><span class="header-section-number">2.4.4</span> Tabelas no R: <code>data.frame</code></h3>
<p>O <code>data.frame</code> é a principal estrutura utilizada para guardar tabelas e bases de dados no R. Na grande maioria das vezes que você importar os seus dados para o R, eles serão alocados dentro de um <code>data.frame</code>. Essa estrutura é no fundo, uma lista com algumas propriedades a mais. Por isso, o <code>data.frame</code> herda uma de suas principais propriedades: <strong>cada uma das colunas da tabela formada por um <code>data.frame</code>, pode conter um tipo de dado diferente das demais colunas deste <code>data.frame</code>.</strong></p>
<p>Esta é uma das principais características que tornam o <code>data.frame</code>, uma estrutura adequada para guardar a grande maioria das bases de dados. Pois é muito comum, que você possua em sua base, diversas colunas contendo dados de diferentes tipos. Por exemplo, você pode ter uma base que possui uma coluna contendo datas, outras duas contendo valores numéricos, e uma última coluna contendo textos, ou rótulos indicando a qual indicador ou grupo, os valores numéricos da linha se referem. E ao importar uma base como essa para o R, é de seu desejo que o R interprete essas colunas corretamente e mantenha os tipos desses dados intactos.</p>
<p>Os <code>data.frame</code>’s são criados pela função <code>data.frame()</code>. Você deve preencher essa função com os valores que você deseja alocar em cada coluna separados por vírgulas. Você pode escolher não dar um nome a cada coluna, neste caso a função se ocupará de dar um nome genérico para elas. Caso opte por definir esses nomes, você deve fornecê-los antes dos valores da coluna, seguindo a seguinte estrutura:</p>
<p></p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Estrutura Básica:</span></span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a><span class="co"># data.frame(</span></span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   &lt;nome_coluna&gt; = &lt;valor_coluna&gt; </span></span>
<span id="cb127-4"><a href="#cb127-4" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb127-5"><a href="#cb127-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-6"><a href="#cb127-6" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(</span>
<span id="cb127-7"><a href="#cb127-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">nomes =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;Ana&quot;</span>, <span class="st">&quot;Eduardo&quot;</span>), <span class="at">times =</span> <span class="dv">5</span>),</span>
<span id="cb127-8"><a href="#cb127-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">numeros =</span> <span class="fu">rnorm</span>(<span class="dv">10</span>),</span>
<span id="cb127-9"><a href="#cb127-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">constante =</span> <span class="dv">25</span></span>
<span id="cb127-10"><a href="#cb127-10" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>##      nomes    numeros constante
## 1      Ana  0.5449040        25
## 2  Eduardo  1.5168843        25
## 3      Ana -2.9752495        25
## 4  Eduardo -0.9573145        25
## 5      Ana  0.5424920        25
## 6  Eduardo  0.9860387        25
## 7      Ana -0.8367505        25
## 8  Eduardo -1.1847641        25
## 9      Ana  0.1437904        25
## 10 Eduardo  0.2599497        25</code></pre>
<p></p>
<p>Caso você esteja em dúvida, tudo o que a função <code>rnorm()</code> faz é gerar valores aleatórios seguindo uma distribuição normal. Vemos que no exemplo acima, geramos uma tabela com 3 colunas e 10 linhas, e aqui chego a segunda principal propriedade de um <code>data.frame</code>, que é: <strong>todas as colunas de um <code>data.frame</code> devem possuir o mesmo número de linhas</strong>. O motivo dessa propriedade é um pouco óbvio, pois se estamos tentando formar uma tabela de dados, é natural pensarmos que ela deve formar um retângulo uniforme.</p>
<p>Isso significa, que se eu pedisse para a função <code>rep()</code> repetir os valores 6 vezes (ao invés de 5), gerando assim um vetor de 12 elementos (ou 12 linhas), a função <code>data.frame()</code> me retornaria um erro, indicando que o número de linhas criadas pelos diferentes vetores não possuem o mesmo número de linhas.</p>
<p>Caso não tivéssemos essa propriedade, estaríamos permitindo que alguma dessas colunas deste <code>data.frame</code>, fosse mais longa do que as outras. Neste caso, como você lidaria com as observações “sobressalentes” da tabela ? Você possui um valor na coluna x que não possui um valor correspondente na coluna y, será que você considera o valor da coluna y como vazio ? Não disponível ? Não existente ? Enfim, uma confusão que é desnecessária.</p>
<p>Essa propriedade nos garante que para cada observação (ou linha) da nossa tabela, deve <strong>sempre</strong> existir um valor na coluna y correspondente ao valor da coluna x, mesmo que o valor da coluna y seja um valor <code>NA</code> (não disponível), ou algo indicando que não foi possível coletar esse valor no plano físico de nossa atividade.</p>
<p>Ao voltar para o exemplo acima, você pode perceber que na terceira coluna que definimos em <code>data.frame()</code>, demos uma simples constante (25) à função. Como resultado, a função acaba preenchendo toda a coluna por essa constante. Isso ocorre sempre que você fornece um único valor a uma coluna de seu <code>data.frame</code>, seja este valor, uma data, um texto, um número ou qualquer outro tipo que imaginar.</p>
<p>A partir daqui, é interessante criarmos um modelo visual em nossa cabeça, sobre o que um <code>data.frame</code> representa. Como disse anteriormente, um <code>data.frame</code>, é basicamente uma lista, com algumas propriedades a mais, em especial a propriedade de que todos os seus elementos devem possuir o mesmo número de linhas. Portanto, se você quer imaginar um <code>data.frame</code> em sua mente, você pode imaginar uma lista, onde cada um de seus elementos, representa uma coluna desse <code>data.frame</code>. Em conjunto, essas colunas (ou os elementos dessa lista) formam uma tabela, sendo essa tabela, comumente referida como um <code>data.frame</code>.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/data_frame_representacao.png" alt="Representação de um `data.frame` a partir de uma lista" width="80%" />
<p class="caption">
(#fig:unnamed-chunk-76)Representação de um <code>data.frame</code> a partir de uma lista
</p>
</div>
<p></p>
<p>Vale destacar um outro comportamento da função <code>data.frame()</code>. Ela transforma por padrão, todos os textos em fatores (<em>factor</em>), ou em outras palavras, valores de uma variável categórica que possui um conjunto limitado de valores possíveis. Vamos aprender mais sobre este tipo de dados nas próximas seções. Inicialmente, isso não tem grandes implicações sobre os seus dados. Eles vão continuar sendo apresentados como textos, e a única grande mudança será sobre a forma como o R irá ordenar esses valores caso você peça isso a ele. Mas é importante saber deste detalhe, pois você vai querer suprimir esse comportamento na maioria das vezes. Para isso, basta adicionar o valor <code>FALSE</code> para o argumento <code>stringsAsFactors</code>.</p>
<p></p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>tabela <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">cidade =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;Belo Horizonte&quot;</span>, <span class="st">&quot;Londrina&quot;</span>, <span class="st">&quot;Macapá&quot;</span>), <span class="at">times =</span> <span class="dv">4</span>),</span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">valor =</span> <span class="fu">rnorm</span>(<span class="dv">12</span>),</span>
<span id="cb129-4"><a href="#cb129-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb129-5"><a href="#cb129-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb129-6"><a href="#cb129-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-7"><a href="#cb129-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Estou utilizando a função is.character()</span></span>
<span id="cb129-8"><a href="#cb129-8" aria-hidden="true" tabindex="-1"></a><span class="co"># para confirmar que data.frame() manteve</span></span>
<span id="cb129-9"><a href="#cb129-9" aria-hidden="true" tabindex="-1"></a><span class="co"># a coluna de cidades como texto (characters)</span></span>
<span id="cb129-10"><a href="#cb129-10" aria-hidden="true" tabindex="-1"></a><span class="fu">is.character</span>(tabela<span class="sc">$</span>cidade)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p></p>
<p>No exemplo acima, você também percebe que eu utilizei dentro da função <code>is.character()</code>, o operador <code>$</code> para acessar os valores da coluna <code>cidade</code> da nossa tabela. Em <code>data.frame</code>’s você sempre pode utilizar este mecanismo para acessar os valores de uma das colunas de sua tabela, pois <code>data.frame()</code> irá sempre se preocupar em nomear as colunas caso você não o faça. Portanto, mesmo que <code>data.frame()</code> invente um nome completamente esquisito para as suas colunas, elas sempre terão um nome para o qual você pode se referir com <code>$</code>.</p>
<p>Isso não significa que você deixará de utilizar o sistema <code>[</code>, pois essa função é muito mais flexível do que você imagina. Uma de suas principais e mais poderosas ferramentas, é um sistema que é comumente chamado de <em>logical subsetting</em>. Com ele, podemos usar a função <code>[</code> para extrair valores de um objeto, de acordo com o resultado de testes lógicos. Em diversas funções de pacotes que você utilizar, se você visitar o código fonte dessas funções, você irá encontrar este sistema sendo utilizado em algum momento, sendo portanto, uma ferramenta extremamente útil dentro do R.</p>
<p>Em resumo, se você quer extrair todos os valores de uma coluna de seu <code>data.frame</code>, você pode utilizar o sistema <code>$</code>, ou o mesmo sistema que utilizamos em matrizes, ao deixar o índice das linhas em “branco” dentro de <code>[</code>. Se você quer extrair partes específicas de sua tabela, você terá que usar <code>[</code> da mesma forma que o utilizamos em matrizes. Como as colunas de um <code>data.frame</code> são nomeados, você pode também extrair uma coluna inteira, ao colocar o nome dessa coluna entre aspas dentro dos colchetes. Todos os sistemas utilizados abaixo, nos retorna todos os valores da coluna <code>cidade</code>.</p>
<p></p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a>tabela<span class="sc">$</span>cidade</span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a>tabela[, <span class="dv">1</span>]</span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-5"><a href="#cb131-5" aria-hidden="true" tabindex="-1"></a>tabela[[<span class="st">&quot;cidade&quot;</span>]]</span></code></pre></div>
<p></p>
<p>Você deve ter percebido acima que utilizei novamente os dois colchetes, ao me referir dentro deles pelo nome da coluna desejada. Este sistema funciona exatamente da mesma forma que ele funciona em listas. Se eu utilizar um colchete, o R me retorna um <code>data.frame</code> contendo uma única coluna (neste caso, a coluna <code>cidade</code>), se eu uso dois colchetes, o R me retorna um vetor contendo apenas os valores dessa coluna.</p>
<p>Agora, voltando um pouco em nossa descrição, quando eu disse que um <code>data.frame</code> são listas, pois herdava muitas de suas propriedades, eu acabei omitindo uma dessas propriedades para evitar confusões. Você deve ter percebido pelos exemplos anteriores, que cada elemento de um <code>data.frame</code> é uma coluna de sua tabela. Você talvez tenha percebido também que todos esses elementos nos exemplos anteriores, eram vetores. Isso é uma característica marcante de um <code>data.frame</code>, pois na maioria das vezes em que você ver um, ele estará servindo apenas como um laço, que amarra e mantém diferentes vetores unidos em uma mesma estrutura, vetores esses que juntos formam uma tabela.</p>
<p>Você deve estar pensando: “Mas é claro que cada coluna é um vetor! Não faria sentido se eu incluísse matrizes ou outras tabelas em uma coluna de uma tabela! Um vetor é a estrutura que faz mais sentido para essas colunas!” Bom, eu creio que agora é uma boa hora para “explodir” a sua cabeça!…ou pelo menos metaforicamente falando. <strong>A outra propriedade que <code>data.frame</code>’s herdam de listas, é que cada um de seus elementos também não precisam ser da mesma estrutura. </strong></p>
<p>Essa propriedade significa que eu posso incluir sim, uma matriz, ou um outro <code>data.frame</code>, como uma nova coluna de um <code>data.frame</code> que está salvo em algum objeto. Lembre-se que a principal diferença entre um <code>data.frame</code> e uma lista, é que os elementos de um <code>data.frame</code> precisam obrigatoriamente ter o mesmo número de linhas. No exemplo abaixo, eu estou criando inicialmente um <code>data.frame</code> com 10 linhas e 2 colunas, logo, se eu quiser incluir uma nova tabela como uma nova coluna desse <code>data.frame</code>, essa nova tabela (ou novo <code>data.frame</code>) deve possuir 10 linhas (mas esse novo <code>data.frame</code> pode ter quantas colunas você desejar).</p>
<p>Você pode facilmente adicionar uma nova coluna a um <code>data.frame</code>, utilizando o operador <code>$</code>. Você escreve primeiro o nome do objeto onde o seu <code>data.frame</code> está contido, abre o cifrão (<code>$</code>), e em seguida, coloca um nome de uma coluna que não existe em seu <code>data.frame</code> até aquele momento. Se não há alguma coluna neste <code>data.frame</code> que possui este nome, o R irá adicionar esta coluna a ele, e para você preencher essa coluna com algum valor, basta utilizar o símbolo de <em>assignment</em> (<code>&lt;-</code>), como se você estivesse salvando algum valor em um novo objeto. Após criar essa nova coluna, eu chamo por ela, para que o R me mostre o que tem nessa coluna, e como esperávamos, ele me retorna o novo <code>data.frame</code> que criamos.</p>
<p></p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a>tabela <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">cidade =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;Belo Horizonte&quot;</span>, <span class="st">&quot;Londrina&quot;</span>), <span class="at">times =</span> <span class="dv">5</span>),</span>
<span id="cb132-3"><a href="#cb132-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">valor =</span> <span class="fu">rnorm</span>(<span class="dv">10</span>)</span>
<span id="cb132-4"><a href="#cb132-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb132-5"><a href="#cb132-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-6"><a href="#cb132-6" aria-hidden="true" tabindex="-1"></a>tabela<span class="sc">$</span>novo_dataframe <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb132-7"><a href="#cb132-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">rep</span>(<span class="st">&quot;Ana&quot;</span>, <span class="at">times =</span> <span class="dv">10</span>),</span>
<span id="cb132-8"><a href="#cb132-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="fu">rep</span>(<span class="st">&quot;Eduardo&quot;</span>, <span class="at">times =</span> <span class="dv">10</span>),</span>
<span id="cb132-9"><a href="#cb132-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">z =</span> <span class="dv">25</span></span>
<span id="cb132-10"><a href="#cb132-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb132-11"><a href="#cb132-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-12"><a href="#cb132-12" aria-hidden="true" tabindex="-1"></a>tabela<span class="sc">$</span>novo_dataframe</span></code></pre></div>
<pre><code>##      x       y  z
## 1  Ana Eduardo 25
## 2  Ana Eduardo 25
## 3  Ana Eduardo 25
## 4  Ana Eduardo 25
## 5  Ana Eduardo 25
## 6  Ana Eduardo 25
## 7  Ana Eduardo 25
## 8  Ana Eduardo 25
## 9  Ana Eduardo 25
## 10 Ana Eduardo 25</code></pre>
<p></p>
<p>Na figura 2.9, estou utilizando a função <code>str()</code> sobre o objeto <code>tabela</code>. Essa função nos retorna no console, uma descrição da estrutura de um objeto. No retângulo vermelho, temos a estrutura geral do objeto, vemos que o objeto <code>tabela</code> é um <code>data.frame</code> com dez linhas e três colunas. Os nomes de suas três colunas estão especificadas no retângulo verde. A direita do nome da terceira coluna (chamada <code>novo_dataframe</code>), podemos ver uma descrição de sua estrutura marcada por um retângulo azul. Vemos neste retângulo azul, portanto, a estrutura desta terceira coluna, e podemos confirmar que se trata também de um <code>data.frame</code> com 10 linhas e 3 colunas, e no retângulo roxo, podemos ver o nome das três colunas (no caso abaixo, colunas x, y e z) contidas neste segundo <code>data.frame</code>. Os falantes de língua inglesa costumam se referir a esta situação onde inserimos uma nova estrutura dentro de uma mesma estrutura, como uma <em>nested structure</em>, ou uma estrutura “aninhada.” Logo, o exemplo que estou dando, se trata de um <em>nested</em> <code>data.frame</code>. Pois estamos inserindo um <code>data.frame</code>, dentro de um outro <code>data.frame</code>.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/str_dataframe_mod.png" alt="Estrutura de um `data.frame` aninhado" width="80%" />
<p class="caption">
(#fig:unnamed-chunk-80)Estrutura de um <code>data.frame</code> aninhado
</p>
</div>
<p></p>
<p>Se você chamar pelo nome <code>tabela</code> no console, para ver o que tem dentro deste objeto, o console irá lhe mostrar um <code>data.frame</code> com 10 linhas e 5 colunas. Pois ele lhe apresenta tanto as 2 colunas definidas como vetores em <code>tabela</code>, quanto as 3 colunas definidas em <code>tabela$novo_dataframe</code>, tudo em uma mesma tabela. Entretanto, como vimos através da função <code>str()</code>, o R está considerando este objeto como um <code>data.frame</code> com 10 linhas e 3 colunas, onde a terceira coluna contém um novo <code>data.frame</code> de 10 linhas e com outras 3 colunas, e não como um único <code>data.frame</code> com 10 linhas e 5 colunas.</p>
<p>Tendo essas considerações em mente, você pode sim incluir dados que estão em qualquer uma das estruturas anteriormente mencionadas, dentro de uma coluna (ou elemento) de um <code>data.frame</code>. Essa propriedade é mais citada nos manuais originais da linguagem <span class="citation">(<a href="#ref-Rlanguage" role="doc-biblioref">R Core Team 2020b</a>, <a href="#ref-Rintroduction" role="doc-biblioref">2020a</a>)</span>, enquanto é muito pouco mencionada, ou pouco explicada em detalhes em outros livros-texto sobre a linguagem. Pois é uma propriedade que faz pouco sentido, considerando-se as principais aplicações de um <code>data.frame</code>. Porém, com essa propriedade, você pode pensar facilmente em uma outra estrutura que é muito mais útil e muito mais poderosa, para ser incluída em uma nova coluna de seu <code>data.frame</code>. Essa estrutura, é uma lista!</p>
<p>Pense um pouco sobre isso. Uma lista é um vetor em sua essência, e por isso, pode facilmente formar uma nova coluna desse <code>data.frame</code>. A vantagem de se incluir uma lista, é que agora em cada célula (ou em cada linha) dessa nova coluna, eu posso guardar um dado de um tipo, tamanho e estrutura diferentes. Se fossemos utilizar a representação visual da seção anterior, é como se a coluna de seu <code>data.frame</code> tenha se transformado em um trem, e agora cada célula, ou cada linha dessa coluna, tenha se tornado um vagão deste trem. Com essa realidade, você pode por exemplo, facilmente aplicar um modelo de regressão sobre 1.000 bases de dados diferentes, e ainda guardar os resultados em cada linha de uma nova coluna, tudo isso com apenas um comando! Dessa forma, você terá em uma coluna de seu <code>data.frame</code> contendo uma lista, lista essa que está mantendo todos esses 1.000 <code>data.frame</code>’s diferentes juntos.</p>
<p>Se você consegue entender a língua inglesa, mesmo que sutilmente, eu altamente recomendo que assista a palestra de Hadley Wickham, entitulada <em>“Managing many models with R”</em>, que está disponível no YouTube<a href="#fn7" class="footnote-ref" id="fnref7"><sup>7</sup></a>. Nesta palestra, ele dá um exemplo prático de como você pode implementar essa ideia, ao aplicar um modelo de regressão sobre várias bases diferentes, utilizando essa propriedade em um <code>data.frame</code>.</p>
</div>
<div id="sec:fundamentos_tibble" class="section level3" number="2.4.5">
<h3 number="2.4.5"><span class="header-section-number">2.4.5</span> <code>tibble</code>’s como uma alternativa moderna aos <code>data.frame</code>’s</h3>
<p>Um <code>tibble</code> nada mais é do que uma “versão moderna” de um <code>data.frame</code>. Essa estrutura de dado é originária do pacote <code>tibble</code>, logo, se você deseja utilizá-la em algum de seus dados, você terá que chamar obrigatoriamente por esse pacote com o comando <code>library()</code><a href="#fn8" class="footnote-ref" id="fnref8"><sup>8</sup></a>. Lembre-se que o pacote deve estar instalado em sua máquina, para que você seja capaz de chamar por ele com o comando <code>library()</code>.</p>
<p>Portanto, essa estrutura foi criada com o intuito de melhorar alguns comportamentos do <code>data.frame</code>, que eram adequados para a sua época, mas que hoje, são desnecessários e que podem gerar um pouco de dor de cabeça. Tais estruturas podem ser criadas do zero, através da função <code>tibble()</code>, que funciona da mesma maneira que <code>data.frame()</code>. Você dá o nome para cada coluna, e após um igual (<code>=</code>) você define o que irá preencher cada uma dessas colunas.</p>
<p></p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tibble)</span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a>tab_tibble <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Datas =</span> <span class="fu">seq.Date</span>(<span class="fu">as.Date</span>(<span class="st">&quot;2020-12-01&quot;</span>), <span class="fu">as.Date</span>(<span class="st">&quot;2020-12-10&quot;</span>), <span class="at">by =</span> <span class="dv">1</span>),</span>
<span id="cb134-5"><a href="#cb134-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Usuario =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">&quot;Ana&quot;</span>, <span class="st">&quot;Eduardo&quot;</span>), <span class="at">size =</span> <span class="dv">10</span>, <span class="at">replace =</span> T),</span>
<span id="cb134-6"><a href="#cb134-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">Valor =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="dv">2000</span>, <span class="dv">3000</span>, <span class="dv">4000</span>, <span class="dv">5000</span>), <span class="at">size =</span> <span class="dv">10</span>, <span class="at">replace =</span> T)</span>
<span id="cb134-7"><a href="#cb134-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb134-8"><a href="#cb134-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-9"><a href="#cb134-9" aria-hidden="true" tabindex="-1"></a>tab_tibble</span></code></pre></div>
<pre><code>## # A tibble: 10 x 3
##    Datas      Usuario Valor
##    &lt;date&gt;     &lt;chr&gt;   &lt;dbl&gt;
##  1 2020-12-01 Eduardo  5000
##  2 2020-12-02 Ana      2000
##  3 2020-12-03 Ana      3000
##  4 2020-12-04 Eduardo  4000
##  5 2020-12-05 Ana      4000
##  6 2020-12-06 Eduardo  2000
##  7 2020-12-07 Ana      5000
##  8 2020-12-08 Eduardo  5000
##  9 2020-12-09 Eduardo  4000
## 10 2020-12-10 Eduardo  5000</code></pre>
<p></p>
<p>Por outro lado, se você já possui um <code>data.frame</code> e deseja convertê-lo para um <code>tibble</code>, você precisa apenas aplicar a função <code>as_tibble()</code> sobre ele.</p>
<p></p>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a>tabela <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(tabela)</span></code></pre></div>
<p></p>
<p>A primeira melhoria dessas estruturas, se encontra no método de <code>print()</code>, ou em outras palavras, na forma como o R lhe mostra a sua tabela no console. Quando chamamos por um objeto que é um <code>data.frame</code>, o console acaba lhe retornando muito mais linhas do que o necessário (ele pode retornar até 1000 linhas), além de todas as colunas da tabela. Se o seu <code>data.frame</code> possui várias colunas, você pode se sentir frustrado com esse comportamento, pois se alguma coluna de sua tabela não couber ao lado das colunas anteriores, o console acaba quebrando o resultado em várias “linhas,” algo que pode tornar a leitura confusa com certa facilidade.</p>
<p>As origens do R são antigas (&gt; 50 anos), e aparentemente esse não era um comportamento muito ruim na época, talvez porque as dimensões das tabelas dessa época eram muito limitadas. Porém, com as capacidades de processamento atuais, essa atitude é desnecessária ou indesejada em quase todas as situações. Veja no exemplo abaixo, onde eu pego a base <code>flights</code> (que possui 19 variáveis diferentes), e transformo-a em um <code>data.frame</code> com a função <code>as.data.frame()</code>. Para que o resultado não consuma muito espaço deste material, eu ainda limito o resultado às 5 primeiras linhas da tabela com <code>head()</code>. Perceba que a tabela foi dividida em 3 linhas diferentes de <em>output</em>.</p>
<p></p>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(nycflights13)</span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a><span class="fu">as.data.frame</span>(flights) <span class="sc">%&gt;%</span> </span>
<span id="cb137-4"><a href="#cb137-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="at">n =</span> <span class="dv">5</span>)</span></code></pre></div>
<pre><code>##   year month day dep_time sched_dep_time dep_delay arr_time sched_arr_time
## 1 2013     1   1      517            515         2      830            819
## 2 2013     1   1      533            529         4      850            830
## 3 2013     1   1      542            540         2      923            850
## 4 2013     1   1      544            545        -1     1004           1022
## 5 2013     1   1      554            600        -6      812            837
##   arr_delay carrier flight tailnum origin dest air_time distance hour
## 1        11      UA   1545  N14228    EWR  IAH      227     1400    5
## 2        20      UA   1714  N24211    LGA  IAH      227     1416    5
## 3        33      AA   1141  N619AA    JFK  MIA      160     1089    5
## 4       -18      B6    725  N804JB    JFK  BQN      183     1576    5
## 5       -25      DL    461  N668DN    LGA  ATL      116      762    6
##   minute           time_hour
## 1     15 2013-01-01 05:00:00
## 2     29 2013-01-01 05:00:00
## 3     40 2013-01-01 05:00:00
## 4     45 2013-01-01 05:00:00
## 5      0 2013-01-01 06:00:00</code></pre>
<p></p>
<p>Quando as suas tabelas são <code>tibble</code>’s, o console lhe retorna por padrão, apenas as 10 primeiras linhas da tabela (caso a tabela seja muito pequena, ele pode lhe retornar todas as linhas), o que já é o suficiente para vermos a sua estrutura. Além disso, caso as próximas colunas não caibam em uma mesma “linha,” ou ao lado das colunas anteriores, o <code>tibble</code> acaba omitindo essas colunas para não sobrecarregar o seu console de resultados. Lembre-se que você sempre pode ver toda a tabela, em uma janela separada através da função <code>View()</code>.</p>
<p></p>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(flights)</span></code></pre></div>
<p></p>
<p>Veja o exemplo abaixo, onde eu chamo novamente pela base <code>flights</code>. O primeiro detalhe que você percebe, é a dimensão da tabela (algo que não é informado, quando chamamos por um <code>data.frame</code>) no canto superior esquerdo da tabela (336.776 linhas e 19 colunas). O segundo detalhe, é que o tipo de dado contido em cada coluna, está descrito logo abaixo do nome da coluna, de acordo com a abreviação deste tipo. Por exemplo, nas três primeiras colunas estão contidos números inteiros (<em>integer</em>’s - <code>int</code>), enquanto na sexta coluna (<code>dep_delay</code>) temos números decimais (<em>double</em>’s - <code>dbl</code>).</p>
<p>Mesmo que em um <code>tibble</code>, você fique sem a possibilidade de visualizar todas as outras colunas da tabela, que não cabem na mesma linha junto com as colunas anteriores, um <code>tibble</code> sempre lhe retorna logo abaixo da tabela, uma lista contendo o nome de todas as colunas restantes, além do tipo de dado contido em cada coluna, através das mesmas abreviações que vimos nas colunas anteriores.</p>
<p></p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a>flights</span></code></pre></div>
<pre><code>## # A tibble: 336,776 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     1      517            515         2      830
##  2  2013     1     1      533            529         4      850
##  3  2013     1     1      542            540         2      923
##  4  2013     1     1      544            545        -1     1004
##  5  2013     1     1      554            600        -6      812
##  6  2013     1     1      554            558        -4      740
##  7  2013     1     1      555            600        -5      913
##  8  2013     1     1      557            600        -3      709
##  9  2013     1     1      557            600        -3      838
## 10  2013     1     1      558            600        -2      753
## # ... with 336,766 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<p></p>
<p>Além desses pontos, <code>tibble</code>’s vão sempre criar destaques, ou ênfases em certos dados no console, algo que os <code>data.frame</code>’s não fazem em nenhum momento. Por exemplo, <code>tibble</code>’s vão sempre marcar de vermelho, qualquer número que seja negativo, uma funcionalidade que é bem familiar aos usuários de Excel que utilizam formatação condicional. Um outro detalhe, é que essa estrutura também marca as casas dos milhares com um pequeno sublinhado, o que facilita muito a leitura de números muito grandes.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/marcacoes.png" alt="Ênfase em valores numéricos presentes em um `tibble`" width="25%" />
<p class="caption">
(#fig:unnamed-chunk-86)Ênfase em valores numéricos presentes em um <code>tibble</code>
</p>
</div>
<p></p>
<p>Para mais, um comportamento muito comum de um <code>data.frame</code>, é converter os seus dados em textos, para fatores (<code>factor</code>). Este não é um comportamento de todo ruim, e nem sempre ele ocorre. Porém o principal valor dos fatores no R, está no uso de <em>dummies</em> em regressões e análises estatísticas, além da maneira como a ordenação de seus valores é executada. Estas características são importantes, mas também são irrelevantes para uma gama muito grande de situações. Em outras palavras, este é um comportamento desnecessário na maioria de nossas análises.</p>
<p>Por isso, uma outra característica que os <code>tibble</code>’s carregam, é que eles nunca transformam os seus dados para um outro tipo. Isso é um ponto muito importante! As funções com as quais nós trabalhamos no R, geralmente funcionam melhor com (ou são especializadas em) uma estrutura ou tipo de dado específico, e quando nós estruturamos as nossas análises sobre essas funções, nós desejamos evitar mudanças não autorizadas sobre os tipos e estruturas utilizados.</p>
<p>Ou seja, é sempre melhor evitar transformações implícitas de seus dados. Pois essas operações podem muito bem, levantar erros dos quais você não compreende, até que você (depois de muito tempo analisando os resultados) perceba que os seus dados foram convertidos para algo incompatível com o que você deseja realizar.</p>
<p>Dessa forma, em um <code>tibble</code> os seus dados em texto são interpretados como textos (<code>character</code>), a menos que você peça explicitamente ao R que interprete esses dados de uma outra forma. Veja o exemplo abaixo, onde utilizo a função <code>str()</code> para ver um resumo da estrutura de cada tabela. Podemos ver abaixo, que a coluna <code>text</code> na tabela <code>tib</code> contém dados do tipo <code>character</code> (<code>chr</code>), enquanto essa mesma coluna na tabela <code>df</code>, possui dados do tipo <code>factor</code>.</p>
<p></p>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a>tib <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">rnorm</span>(<span class="dv">10</span>),</span>
<span id="cb142-3"><a href="#cb142-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">text =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">&quot;Ana&quot;</span>, <span class="st">&quot;Eduardo&quot;</span>), <span class="at">size =</span> <span class="dv">10</span>, <span class="at">replace =</span> T)</span>
<span id="cb142-4"><a href="#cb142-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb142-5"><a href="#cb142-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-6"><a href="#cb142-6" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb142-7"><a href="#cb142-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">rnorm</span>(<span class="dv">10</span>),</span>
<span id="cb142-8"><a href="#cb142-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">text =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">&quot;Ana&quot;</span>, <span class="st">&quot;Eduardo&quot;</span>), <span class="at">size =</span> <span class="dv">10</span>, <span class="at">replace =</span> T)</span>
<span id="cb142-9"><a href="#cb142-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb142-10"><a href="#cb142-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-11"><a href="#cb142-11" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(tib)</span></code></pre></div>
<p></p>
<pre><code>tibble [10 x 2] (S3: tbl_df/tbl/data.frame)
 $ x   : num [1:10] 0.172 0.315 0.119 -0.155 -0.165 ...
 $ text: chr [1:10] &quot;Eduardo&quot; &quot;Ana&quot; &quot;Eduardo&quot; &quot;Eduardo&quot; ...</code></pre>
<p></p>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(df)</span></code></pre></div>
<p></p>
<pre><code>&#39;data.frame&#39;:   10 obs. of  2 variables:
 $ x   : num  0.0639 -0.4522 0.7528 -1.3353 1.454 ...
 $ text: Factor w/ 2 levels &quot;Ana&quot;,&quot;Eduardo&quot;: 2 2 2 1 2 2 1 1 2 1</code></pre>
<p>Uma última característica de um <code>tibble</code>, é que ele lhe permite criar colunas com nomes que não respeitam as regras usuais do R. Por exemplo, não é permitido criar variáveis que possuam um nome que se inicia por um número, ou então, que possuam algum tipo de espaço ao longo dele. Mas dentro de um <code>tibble</code>, você não possui tais restrições. No exemplo abaixo, eu tento ultrapassar essa regra na função <code>data.frame()</code>, e ela acaba preenchendo o espaço no nome, com um ponto (.), e também coloca uma letra qualquer antes do número da coluna “10_janeiro,” enquanto em um <code>tibble</code>, isso não ocorre. Entretanto, mesmo que você possua essa liberdade em um <code>tibble</code>, ao se referir a essas colunas que não se encaixam nas regras do R, você terá de contornar o nome dessas colunas, com acentos graves ().</p>
<p></p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a>data_frame <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Nome coluna&quot;</span> <span class="ot">=</span> <span class="fu">rnorm</span>(<span class="dv">10</span>),</span>
<span id="cb146-3"><a href="#cb146-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;10_janeiro&quot;</span> <span class="ot">=</span> <span class="fu">rnorm</span>(<span class="dv">10</span>)</span>
<span id="cb146-4"><a href="#cb146-4" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb146-5"><a href="#cb146-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-6"><a href="#cb146-6" aria-hidden="true" tabindex="-1"></a>tibble <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb146-7"><a href="#cb146-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Nome coluna&quot;</span> <span class="ot">=</span> <span class="fu">rnorm</span>(<span class="dv">10</span>),</span>
<span id="cb146-8"><a href="#cb146-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;10_janeiro&quot;</span> <span class="ot">=</span> <span class="fu">rnorm</span>(<span class="dv">10</span>)</span>
<span id="cb146-9"><a href="#cb146-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb146-10"><a href="#cb146-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-11"><a href="#cb146-11" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(data_frame, <span class="dv">10</span>)</span></code></pre></div>
<pre><code>##    Nome.coluna X10_janeiro
## 1   -1.4015185  0.19826934
## 2   -1.2530107 -0.80034394
## 3   -0.6234624 -0.79591731
## 4    1.0180043 -0.20249958
## 5   -1.3253103  0.21657117
## 6   -1.0225496 -1.86001272
## 7    0.1024124 -0.09031293
## 8   -0.3479385 -0.07222356
## 9    0.2325376  2.04936506
## 10   1.0738337  0.68806336</code></pre>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a>tibble</span></code></pre></div>
<pre><code>## # A tibble: 10 x 2
##    `Nome coluna` `10_janeiro`
##            &lt;dbl&gt;        &lt;dbl&gt;
##  1       0.135         0.113 
##  2       1.17         -0.896 
##  3       0.475        -1.44  
##  4      -0.779         1.57  
##  5      -1.43         -0.504 
##  6      -1.34         -2.99  
##  7      -0.829        -0.141 
##  8      -0.839         0.888 
##  9      -0.967         0.309 
## 10      -0.00527      -0.0589</code></pre>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a>tibble<span class="sc">$</span><span class="st">`</span><span class="at">10_janeiro</span><span class="st">`</span></span></code></pre></div>
<pre><code>##  [1]  0.11256438 -0.89579469 -1.43844614  1.56657671 -0.50394038
##  [6] -2.98953888 -0.14146176  0.88842559  0.30948983 -0.05886191</code></pre>
<p></p>
<p>Portanto, os <code>tibble</code>’s foram criados com o intuito de manter as funcionalidades importantes de um <code>data.frame</code>, e ao mesmo tempo, eliminar comportamentos que hoje são desnecessários ou ineficientes. Em resumo, um <code>tibble</code> é uma estrutura preguiçosa. Pois ele nunca converte implicitamente os seus dados para algum outro tipo, ele não altera o nome de suas colunas, e ele também não sobrecarrega o seu console com linhas e linhas de resultados, lhe mostrando apenas o necessário.</p>
</div>
</div>
<div id="sec:fundamentos_tipos_dados" class="section level2" number="2.5">
<h2 number="2.5"><span class="header-section-number">2.5</span> Tipos de dados</h2>
<p>Como foi destacado anteriormente, além das estruturas de dados, o R possui os tipos de dados. Tipos esses que dizem respeito a forma como o R está interpretando os seus dados, em um dado momento. Os cinco tipos de dados básicos da linguagem são:</p>
<ol style="list-style-type: decimal">
<li><p><code>character</code>: valores de texto ou caracteres.</p></li>
<li><p><code>double</code>: valores númericos inclusos no conjunto dos números reais.</p></li>
<li><p><code>integer</code>: valores númericos inclusos no conjunto de números inteiros, ou basicamente, números sem casas decimais.</p></li>
<li><p><code>logical</code>: valores <code>TRUE</code> (verdadeiro) e <code>FALSE</code> (falso), resultantes de testes lógicos.</p></li>
<li><p><code>complex</code>: valores em números complexos.</p></li>
</ol>
<p>Vários outros tipos de dados mais complexos, como datas (<code>Date</code>) e fatores (<code>factor</code>), são construídos a partir desses 5 tipos básicos da linguagem. Tendo isso em mente, o único tipo básico que não irei abordar nas próximas seções, será o tipo <code>complex</code>, pois é um tipo muito específico e extremamente raro na linguagem.</p>
<p>Vale destacar que, diferentes autores denominam essa propriedade de formas diferentes, ou, tendem a misturá-la em outros conceitos. Como exemplo, <span class="citation"><a href="#ref-peng2015" role="doc-biblioref">Peng</a> (<a href="#ref-peng2015" role="doc-biblioref">2015</a>)</span> denomina os “tipos de dados” como “classes atômicas de objetos” (ou, <em>“atomic classes of objects”</em>), enquanto <span class="citation"><a href="#ref-wickham2017" role="doc-biblioref">Wickham and Grolemund</a> (<a href="#ref-wickham2017" role="doc-biblioref">2017</a>)</span>, costuma se referir a essa propriedade como “tipos de vetores” (ou, <em>“vector types”</em>). Todavia, independente da forma como os autores denominam essa propriedade, a lógica permanece a mesma.</p>
<p>O termo utilizado por <span class="citation"><a href="#ref-wickham2017" role="doc-biblioref">Wickham and Grolemund</a> (<a href="#ref-wickham2017" role="doc-biblioref">2017</a>)</span> é mais apropriado para essa situação. Não apenas porque ele representa melhor a forma como esses conceitos são apresentados nos manuais internos da linguagem <span class="citation">(<a href="#ref-Rlanguage" role="doc-biblioref">R Core Team 2020b</a>, <a href="#ref-Rintroduction" role="doc-biblioref">2020a</a>)</span>, mas também, porque o termo utilizado por <span class="citation"><a href="#ref-peng2015" role="doc-biblioref">Peng</a> (<a href="#ref-peng2015" role="doc-biblioref">2015</a>)</span> mistura dois conceitos importantes que são diferentes entre si: a classe e o tipo de um objeto.</p>
<p>O tipo do objeto, (isto é, o que estou chamando aqui de tipo de dado - <code>character</code>, <code>double</code>, etc.), determina a representação interna do objeto. Ou seja, como esse objeto é armazenado internamente em C <code>structs</code> e na memória RAM de seu computador. Já a classe é um atributo do objeto, que determina quais são os métodos de funções a serem aplicados sobre este objeto <span class="citation">(<a href="#ref-chambers2016" role="doc-biblioref">Chambers 2016</a>, p 45)</span>.</p>
<div id="textos-e-caracteres-character" class="section level3" number="2.5.1">
<h3 number="2.5.1"><span class="header-section-number">2.5.1</span> Textos e caracteres (<code>character</code>)</h3>
<p>Variáveis textuais são extremamente comuns nas mais diversas análises. Tais variáveis são geralmente denominadas de variáveis categóricas, pois em geral, elas buscam classificar os seus dados em certas categorias e grupos. Para além dessas variáveis, também é comum utilizarmos textos para definir rótulos e títulos de gráficos, ou ainda, para definir certos argumentos de funções. Para armazenar, interpretar e transformar esse tipo de dado, o R nos oferece o tipo <code>character</code>. Valores do tipo <code>character</code> também são conhecidos pelo termo <em>string</em> (ou <em>string of characters</em>).</p>
<p>Todo valor em texto no R (isto é, todo dado do tipo <code>character</code>), deve ser fornecido entre aspas (simples - <code>'</code>, ou duplas - <code>"</code>), sendo essa uma convenção utilizada em quase todas as linguagens de programação, e no R não é diferente. Esta convenção se torna ainda mais importante no R, pois ela também serve para diferenciar valores em texto de nomes de objetos.</p>
<p>Em outras palavras, quando queremos acessar os valores que estão dentro de um objeto, nós simplesmente escrevemos o nome deste objeto. Entretanto, quando estamos fornecendo um simples texto ao R, é muito comum que nos esqueçamos de contornar esse texto com aspas. Como resultado, o R acaba interpretando esse valor como o nome de um objeto e, por isso, começa a procurar por um objeto que possua um nome igual a este texto que você digitou. Caso o R não encontre um objeto com um nome equivalente a esse texto, ele vai lhe retornar um erro indicando que ele não foi capaz de encontrar um objeto com este nome em sua sessão.</p>
<p>Para mais, caso este texto que você digitou, possua algum espaço, o R vai lhe retornar um erro um pouco diferente, dizendo que o símbolo que você inseriu no console, é inesperado ou inválido. De qualquer forma, o problema desse erro é o mesmo, você provavelmente se esqueceu de contornar o texto por aspas.</p>
<p></p>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a>O_ano_tem_365_dias</span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Erro: objeto &#39;O_ano_tem_365_dias&#39; não encontrado</span></span>
<span id="cb152-3"><a href="#cb152-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-4"><a href="#cb152-4" aria-hidden="true" tabindex="-1"></a>O ano tem <span class="dv">365</span> dias</span>
<span id="cb152-5"><a href="#cb152-5" aria-hidden="true" tabindex="-1"></a><span class="do">## Erro: unexpected symbol in &quot;O ano&quot;</span></span>
<span id="cb152-6"><a href="#cb152-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-7"><a href="#cb152-7" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;O ano tem 365 dias&quot;</span></span>
<span id="cb152-8"><a href="#cb152-8" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;O ano tem 365 dias&quot;</span></span></code></pre></div>
<p></p>
<p>Vale destacar que, um par de aspas, delimita um único valor do tipo <code>character</code>. Portanto, para criar um vetor contendo vários valores do tipo <code>character</code>, você tem que contornar cada um desses valores por aspas. Caso você contorne todos os diferentes valores por um único par de aspas, você vai criar um vetor do tipo <code>character</code> que contém 1 único elemento. Tal problemática está demonstrada abaixo.</p>
<p></p>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a>vec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;a, b, c, d&quot;</span>)</span>
<span id="cb153-2"><a href="#cb153-2" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(vec)</span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a>vec2 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>, <span class="st">&quot;d&quot;</span>)</span>
<span id="cb155-2"><a href="#cb155-2" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(vec2)</span></code></pre></div>
<pre><code>## [1] 4</code></pre>
<p></p>
</div>
<div id="números-reais-double" class="section level3" number="2.5.2">
<h3 number="2.5.2"><span class="header-section-number">2.5.2</span> Números reais (<code>double</code>)</h3>
<p>Em quase todos os momentos que você estiver trabalhando com dados numéricos, esses dados vão estar sendo interpretados pelo tipo <code>double</code>. Pois este tipo básico abarca todo o conjunto dos números reais. E como o conjunto de números inteiros (<code>integer</code>) está incluso no conjunto dos números reais, quando você insere um número inteiro, ou um número sem casas decimais no console, ele será interpretado inicialmente pelo R como um número real (<code>double</code>).</p>
<p>Dito de outra forma, ao inserirmos apenas o número 10 no console, o R vai interpretar este 10 como um <code>double</code>, e não como <code>integer</code>, independente do fato desse número aparecer no console sem casas decimais. Pense como se este 10, fosse na verdade para o R algo como 10,00000000000… No exemplo abaixo, eu utilizo a função <code>is.integer()</code> para perguntar ao R, se ele está interpretando este valor como um <code>integer</code>, e como esperávamos a função nos retorna um <code>FALSE</code>, indicando que não se trata de um número inteiro.</p>
<p></p>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a><span class="co"># O R está basicamente interpretando</span></span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true" tabindex="-1"></a><span class="co"># este 10 como 10.00000000, mesmo</span></span>
<span id="cb157-3"><a href="#cb157-3" aria-hidden="true" tabindex="-1"></a><span class="co"># que ele te mostre</span></span>
<span id="cb157-4"><a href="#cb157-4" aria-hidden="true" tabindex="-1"></a><span class="dv">10</span></span></code></pre></div>
<pre><code>## [1] 10</code></pre>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a><span class="fu">is.double</span>(<span class="dv">10</span>)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a><span class="fu">is.integer</span>(<span class="dv">10</span>)</span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<p></p>
<p>Vale destacar, que o R é uma linguagem centralizada nos padrões americanos, e que, portanto, utiliza o ponto para definir casas decimais, ao invés da vírgula que nós brasileiros utilizamos. Por esse motivo, para criar um vetor de números decimais, você deve utilizar um ponto para delimitar as casas decimais de seus valores. As vírgulas servem apenas para separar os diferentes valores deste vetor.</p>
<p></p>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="fl">1.24</span>, <span class="fl">2.25</span>, <span class="fl">3.62381</span>, <span class="fl">7.05</span>)</span></code></pre></div>
<pre><code>## [1] 1.24000 2.25000 3.62381 7.05000</code></pre>
<p></p>
</div>
<div id="números-inteiros-integer" class="section level3" number="2.5.3">
<h3 number="2.5.3"><span class="header-section-number">2.5.3</span> Números inteiros (<code>integer</code>)</h3>
<p>O tipo <code>integer</code> abarca o conjunto dos números inteiros, ou basicamente todos os números sem casas decimais. Você utilizará muito este tipo, quando estiver utilizando sequências numéricas, seja para extrair partes de um objeto com a função <code>[</code>, ou gerando um índice para as linhas de sua tabela. Como vimos na seção anterior, caso você insira um número sem casas decimais no console, o R vai interpretar inicialmente este número como um <code>double</code>.</p>
<p>Assim sendo, você tem três formas de se criar um <code>integer</code> no R. A primeira é inserindo um L maiúsculo após o número que você está criando. A segunda, é transformando o seu vetor do tipo <code>double</code> para o tipo <code>integer</code>, através da função <code>as.integer()</code>. A terceira, seria através de funções que lhe retornam por padrão este tipo de dado, sendo o principal exemplo, a função <code>:</code> que lhe retorna, por padrão, uma sequência de <code>integer</code>’s. Podemos confirmar se os números criados são de fato <code>integer</code>’s, usando a função <code>is.integer()</code>.</p>
<p></p>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(1L, 2L, 3L, 10L)</span></code></pre></div>
<pre><code>## [1]  1  2  3 10</code></pre>
<div class="sourceCode" id="cb167"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.integer</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="fl">10.2561</span>, <span class="fl">1.55</span>))</span></code></pre></div>
<pre><code>## [1]  1  2 10  1</code></pre>
<div class="sourceCode" id="cb169"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a><span class="fu">is.integer</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p></p>
</div>
<div id="o-tipo-numérico-numeric" class="section level3" number="2.5.4">
<h3 number="2.5.4"><span class="header-section-number">2.5.4</span> O tipo numérico (<code>numeric</code>)</h3>
<p>Em alguns momentos você pode se deparar com o tipo <code>numeric</code>. Ele nada mais é do que um “apelido” para os tipos <code>integer</code> e <code>double</code>. Dito de outra forma, os tipos <code>integer</code> e <code>double</code> são conjuntamente conhecidos como o tipo <code>numeric</code> <span class="citation">(<a href="#ref-wickham2015_advanced" role="doc-biblioref">Wickham 2015a</a>)</span>.</p>
<p>Entretanto, mesmo que <code>numeric</code> seja um sinônimo para os tipos <code>integer</code> e <code>double</code>, o R não costuma empregar esse nome <code>numeric</code> de forma uniforme. Na maioria das ocasiões em que o tipo <code>numeric</code> aparece, o R está na verdade, se referindo especificamente ao tipo <code>double</code>. De qualquer forma, apenas entenda que se um conjunto de dados está associado ao tipo <code>double</code> ou ao tipo <code>integer</code>, ele também está diretamente associado ao tipo <code>numeric</code>.</p>
<p></p>
<div class="sourceCode" id="cb171"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a><span class="fu">is.numeric</span>(1L)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a><span class="fu">is.numeric</span>(<span class="fl">1.25</span>)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p></p>
</div>
<div id="valores-lógicos-logical" class="section level3" number="2.5.5">
<h3 number="2.5.5"><span class="header-section-number">2.5.5</span> Valores lógicos (<code>logical</code>)</h3>
<p>No R, valores lógicos são interpretados pelo tipo de dado <code>logical</code> e, como você já deve ter percebido, este tipo abrange apenas dois valores possíveis, que são verdadeiro - <code>TRUE</code>, e falso - <code>FALSE</code>. Valores lógicos também são muito conhecidos em diversas linguagens de programação pelo termo <code>boolean</code>. Você irá utilizar muito este tipo de dado para filtrar linhas de seu <code>data.frame</code>, para preencher uma coluna de rótulos, ou para identificar valores “não disponíveis” e <em>outliers</em> em sua base de dados.</p>
<p>Temos dois métodos de se obter esse tipo de valor no R. A primeira, é escrevê-los na mão, podendo também se referir apenas a primeira letra maiúscula de cada um, ao invés de escrever toda a palavra.</p>
<p></p>
<div class="sourceCode" id="cb175"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a>vetor_logico <span class="ot">&lt;-</span> <span class="fu">c</span>(T, F, T, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>)</span>
<span id="cb175-2"><a href="#cb175-2" aria-hidden="true" tabindex="-1"></a>vetor_logico</span></code></pre></div>
<pre><code>## [1]  TRUE FALSE  TRUE  TRUE FALSE</code></pre>
<p></p>
<p>A segunda e principal forma, é através de testes lógicos. No exemplo abaixo, eu estou criando um vetor com 5 elementos, e em seguida, peço ao R que me diga se cada elemento deste vetor é maior do que 5. Vemos que apenas o terceiro e o quarto elemento deste vetor, são maiores do que 5.</p>
<p></p>
<div class="sourceCode" id="cb177"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a>vetor <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">2.45</span>, <span class="fl">5.6</span>, <span class="fl">7.2</span>, <span class="fl">1.3</span>)</span>
<span id="cb177-2"><a href="#cb177-2" aria-hidden="true" tabindex="-1"></a>vetor <span class="sc">&gt;</span> <span class="dv">5</span></span></code></pre></div>
<pre><code>## [1] FALSE FALSE  TRUE  TRUE FALSE</code></pre>
<p></p>
<p>O que acabamos de fazer acima, se trata de um teste lógico, pois estamos testando uma hipótese (maior do que 5) sobre cada um dos elementos deste vetor. Como resultado, o R lhe retorna um vetor com o mesmo comprimento do primeiro, porém agora, este vetor está preenchido com <code>TRUE</code>’s e <code>FALSE</code>’s, lhe indicando quais dos elementos do primeiro vetor se encaixam na hipótese que você definiu.</p>
<p>Este vetor contendo apenas valores lógicos, não é tão útil em sua singularidade. Porém, ao utilizarmos ele sobre à função <code>[</code>, podemos utilizar o sistema que mencionei anteriormente, chamado de <em>logical subsetting</em>, que é uma forma extremamente útil de extrairmos partes de um objeto. A ideia, é extrairmos qualquer elemento deste objeto que possua um valor <code>TRUE</code> correspondente em um teste lógico específico que podemos definir. Consequentemente, poderíamos utilizar o teste anterior que criamos, para extrair todos os elementos do vetor, que são maiores do que 5, desta forma:</p>
<p></p>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb179-1"><a href="#cb179-1" aria-hidden="true" tabindex="-1"></a>vetor[vetor <span class="sc">&gt;</span> <span class="dv">5</span>]</span></code></pre></div>
<pre><code>## [1] 5.6 7.2</code></pre>
<p></p>
<p>Para criar um teste lógico, você precisa utilizar algum operador lógico (como os operadores <code>&gt;</code> e <code>==</code>), ou então, alguma função que aplique este tipo de teste e lhe retorne um valor lógico como resultado (por exemplo, a função <code>is.integer()</code>).</p>
</div>
</div>
<div id="sec:funcoes_str_is" class="section level2" number="2.6">
<h2 number="2.6"><span class="header-section-number">2.6</span> Identificando tipos e estruturas com a função <code>str()</code> e as funções <code>is.*()</code></h2>
<p>Na linguagem Python, a função <code>str()</code> serve para convertermos um objeto para o tipo <em>string</em>. Porém, na linguagem R, essa mesma função <code>str()</code> exerce um papel completamente diferente. No R, o nome <code>str</code> representa na realidade uma abreviação para <em>structure</em> (ou “estrutura”). Por isso, a função <code>str()</code> nos fornece uma pequena descrição da estrutura de um objeto específico.</p>
<p>Como um primeiro exemplo, quando aplicamos a função <code>str()</code> sobre a tabela <code>diamonds</code> do pacote <code>ggplot2</code>, o R nos retorna uma descrição contendo: a estrutura na qual esse objeto se encontra (<code>tibble</code>); as dimensões dessa tabela (<code>53,940 x 10</code>); as classes associadas a esse objeto (<code>S3: tbl_df/tbl/data.frame</code>); os nomes das colunas dessa tabela (<code>$ carat</code>, <code>$ cut</code>, <code>$ color</code>, etc); além de uma abreviação que indica o tipo de dado associado a cada uma dessas colunas (<code>num</code> para <code>numeric</code>, <code>int</code> para <code>integer</code>, etc.).</p>
<p></p>
<div class="sourceCode" id="cb181"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb181-2"><a href="#cb181-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(diamonds)</span></code></pre></div>
<pre><code>## tibble [53,940 x 10] (S3: tbl_df/tbl/data.frame)
##  $ carat  : num [1:53940] 0.23 0.21 0.23 0.29 0.31 0.24 0.24 0.26 0.22 0.23 ...
##  $ cut    : Ord.factor w/ 5 levels &quot;Fair&quot;&lt;&quot;Good&quot;&lt;..: 5 4 2 4 2 3 3 3 1 3 ...
##  $ color  : Ord.factor w/ 7 levels &quot;D&quot;&lt;&quot;E&quot;&lt;&quot;F&quot;&lt;&quot;G&quot;&lt;..: 2 2 2 6 7 7 6 5 2 5 ...
##  $ clarity: Ord.factor w/ 8 levels &quot;I1&quot;&lt;&quot;SI2&quot;&lt;&quot;SI1&quot;&lt;..: 2 3 5 4 2 6 7 3 4 5 ...
##  $ depth  : num [1:53940] 61.5 59.8 56.9 62.4 63.3 62.8 62.3 61.9 65.1 59.4 ...
##  $ table  : num [1:53940] 55 61 65 58 58 57 57 55 61 61 ...
##  $ price  : int [1:53940] 326 326 327 334 335 336 336 337 337 338 ...
##  $ x      : num [1:53940] 3.95 3.89 4.05 4.2 4.34 3.94 3.95 4.07 3.87 4 ...
##  $ y      : num [1:53940] 3.98 3.84 4.07 4.23 4.35 3.96 3.98 4.11 3.78 4.05 ...
##  $ z      : num [1:53940] 2.43 2.31 2.31 2.63 2.75 2.48 2.47 2.53 2.49 2.39 ...</code></pre>
<p></p>
<p>Como um segundo exemplo, ao aplicarmos a função <code>str()</code> sobre uma lista, a descrição resultante me confirma que o objeto se trata de uma lista de 5 elementos (<code>List of 5</code>). Devido à abreviação <code>chr</code> presente nos elementos <code>produto_vendido</code> e <code>data_de_registro</code>, nós também identificamos que os valores armazenados nesses elementos da lista estão associados ao tipo <code>character</code>.</p>
<p></p>
<div class="sourceCode" id="cb183"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a>registro_venda <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb183-2"><a href="#cb183-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">produto_vendido =</span> <span class="st">&quot;Leite Mua 1L&quot;</span>,</span>
<span id="cb183-3"><a href="#cb183-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">unidades_vendidas =</span> <span class="dv">5</span>,</span>
<span id="cb183-4"><a href="#cb183-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">preco_por_unidade =</span> <span class="fl">3.45</span>,</span>
<span id="cb183-5"><a href="#cb183-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">valor_venda =</span> <span class="dv">5</span> <span class="sc">*</span> <span class="fl">3.45</span>,</span>
<span id="cb183-6"><a href="#cb183-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">data_de_registro =</span> <span class="st">&quot;2021-08-22&quot;</span></span>
<span id="cb183-7"><a href="#cb183-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb183-8"><a href="#cb183-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-9"><a href="#cb183-9" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(registro_venda)</span></code></pre></div>
<pre><code>## List of 5
##  $ produto_vendido  : chr &quot;Leite Mua 1L&quot;
##  $ unidades_vendidas: num 5
##  $ preco_por_unidade: num 3.45
##  $ valor_venda      : num 17.2
##  $ data_de_registro : chr &quot;2021-08-22&quot;</code></pre>
<p></p>
<p>Como um terceiro exemplo, quando aplicamos a função <code>str()</code> sobre um vetor, podemos identificar o tipo de dado associado àquele vetor além de suas dimensões. Pela demonstração abaixo, sabemos através da abreviação <code>int</code> que o vetor <code>sequencia</code> contém dados do tipo <code>integer</code>, e que este vetor possui 100 elementos (<code>[1:100]</code>).</p>
<p></p>
<div class="sourceCode" id="cb185"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a>sequencia <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span></span>
<span id="cb185-2"><a href="#cb185-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(sequencia)</span></code></pre></div>
<pre><code>##  int [1:100] 1 2 3 4 5 6 7 8 9 10 ...</code></pre>
<p></p>
<p>Portanto, a função <code>str()</code> é a forma mais prática e visual de se identificar as características principais de um objeto no R. Entretanto, futuramente você vai enfrentar situações onde você deve construir um programa (isto é, um <em>script</em>) que executa determinadas ações a depender da estrutura de um objeto ou dos tipos de dados associados a ele. Ou seja, haverá momentos em que você precisa inserir dentro de seu programa, testes que realizam essas verificações de forma automática. O primeiro passo para a construção desses testes são as funções <code>is.*()</code>.</p>
<p>Em geral, toda função <code>is.*()</code> retorna um único valor do tipo <code>logical</code>, informando se o objeto em questão pertence ou não ao tipo ou estrutura definido no nome dessa função. O tipo ou estrutura para a qual você está testando é definido no próprio nome da função. Por exemplo, se eu utilizo a função <code>is.character(x)</code>, eu estou querendo testar se o objeto <code>x</code> está associado ao tipo <code>character</code>. Como demonstrado abaixo, a função <code>is.character()</code> me retorna um valor <code>TRUE</code> para o objeto <code>nome</code>, entretanto, o mesmo não ocorre para o objeto <code>idade</code>.</p>
<p></p>
<div class="sourceCode" id="cb187"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a>nome <span class="ot">&lt;-</span> <span class="st">&quot;Pedro Faria&quot;</span></span>
<span id="cb187-2"><a href="#cb187-2" aria-hidden="true" tabindex="-1"></a>idade <span class="ot">&lt;-</span> <span class="dv">23</span></span>
<span id="cb187-3"><a href="#cb187-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb187-4"><a href="#cb187-4" aria-hidden="true" tabindex="-1"></a><span class="fu">is.character</span>(nome)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a><span class="fu">is.character</span>(idade)</span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<p></p>
<p>Em resumo, se você deseja testar se um objeto possui uma certa propriedade, procure por uma função cujo nome comece por <code>"is."</code> seguido pelo nome dessa estrutura ou tipo no qual você está interessado. Como uma lista inicial, as funções para os tipos de dados são:</p>
<ul>
<li><code>is.integer()</code>.</li>
<li><code>is.character()</code>.</li>
<li><code>is.numeric()</code>.</li>
<li><code>is.double()</code>.</li>
<li><code>is.logical()</code>.</li>
<li><code>is.atomic()</code>.</li>
<li><code>is.complex()</code>.</li>
</ul>
<p>Já para o caso das estruturas de dados, estamos nos referindo às seguintes funções:</p>
<ul>
<li><code>is.vector()</code>.</li>
<li><code>is.list()</code>.</li>
<li><code>is.data.frame()</code>.</li>
<li><code>is.matrix()</code>.</li>
<li><code>is.array()</code>.</li>
<li><code>tibble::is_tibble()</code></li>
</ul>
<p>Uma outra forma (mais informal) de se identificar o tipo de dado associado a um objeto (ou a uma parte desse objeto) é através da função <code>typeof()</code>. Ao aplicar essa função sobre um objeto específico (ou sobre uma parte desse objeto), a função nos retorna o nome do tipo de dado associado a este objeto.</p>
<p></p>
<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a>vec <span class="ot">&lt;-</span> <span class="fu">c</span>(1L, 2L, 3L)</span>
<span id="cb191-2"><a href="#cb191-2" aria-hidden="true" tabindex="-1"></a><span class="fu">typeof</span>(vec)</span></code></pre></div>
<pre><code>## [1] &quot;integer&quot;</code></pre>
<p></p>
<div id="tome-muito-cuidado-com-is.vector-e-is.numeric" class="section level3" number="2.6.1">
<h3 number="2.6.1"><span class="header-section-number">2.6.1</span> Tome muito cuidado com <code>is.vector()</code> e <code>is.numeric()</code></h3>
<p>A função <code>is.vector()</code> testa se um objeto é um vetor atômico. Porém, o principal problema dessa função é que ela baseia o seu teste na ausência de atributos, ao invés de se preocupar se o objeto se encaixa ou não na descrição de um vetor. Você pode encontrar mais detalhes sobre isso ao ler atentamente a documentação interna da função, com o comando <code>?is.vector</code>. Mas em resumo, a função <code>is.vector()</code> testa se o objeto em questão, é um vetor que não possui atributos (exceto o atributo <code>names</code>).</p>
<p>Vamos descrever o que são atributos mais a frente, mas devido a essa especificação, a função <code>is.vector()</code> retorna <code>FALSE</code> para diversos tipos de vetores “não-atômicos,” como os tipos <code>factor</code>, <code>Date</code>, <code>POSIXct</code> e <code>POSIXlt</code> (vamos descrever esses tipos em capítulos posteriores), pois todos eles possuem um atributo chamado <code>class</code>. Para mais, saiba que <code>is.vector()</code> retorna <code>TRUE</code> para listas, pois como descrevemos na seção <a href="#sec:estrutura_listas">Listas</a>, listas são no fundo, vetores. Além disso, listas geralmente contém no máximo um atributo <code>names</code> (o qual é permitido por <code>is.vector()</code>).
Para demonstrar os resultados gerados por cada função que vou apresentar nessa seção, estou criando abaixo alguns objetos de teste, além de uma função que será responsável por aplicar a função sobre cada um desses objetos.</p>
<p></p>
<div class="sourceCode" id="cb193"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb193-1"><a href="#cb193-1" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">1</span>)</span>
<span id="cb193-2"><a href="#cb193-2" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="dv">1</span>, <span class="at">dim =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb193-3"><a href="#cb193-3" aria-hidden="true" tabindex="-1"></a>l <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="dv">1</span>)</span>
<span id="cb193-4"><a href="#cb193-4" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="dv">1</span>)</span>
<span id="cb193-5"><a href="#cb193-5" aria-hidden="true" tabindex="-1"></a>v1 <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">&quot;2021-01-01&quot;</span>)</span>
<span id="cb193-6"><a href="#cb193-6" aria-hidden="true" tabindex="-1"></a>v2 <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="st">&quot;a&quot;</span>)</span>
<span id="cb193-7"><a href="#cb193-7" aria-hidden="true" tabindex="-1"></a>vec <span class="ot">&lt;-</span> <span class="fu">double</span>(<span class="dv">1</span>)</span>
<span id="cb193-8"><a href="#cb193-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-9"><a href="#cb193-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-10"><a href="#cb193-10" aria-hidden="true" tabindex="-1"></a>aplicar_teste <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb193-11"><a href="#cb193-11" aria-hidden="true" tabindex="-1"></a>  objs <span class="ot">&lt;-</span> <span class="fu">list</span>(m, a, l, d, v1, v2, vec, <span class="cn">NULL</span>)</span>
<span id="cb193-12"><a href="#cb193-12" aria-hidden="true" tabindex="-1"></a>  r <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_lgl</span>(objs, x)</span>
<span id="cb193-13"><a href="#cb193-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(r) <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb193-14"><a href="#cb193-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;matrix&quot;</span>, <span class="st">&quot;array&quot;</span>, <span class="st">&quot;list&quot;</span>,</span>
<span id="cb193-15"><a href="#cb193-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;data.frame&quot;</span>, <span class="st">&quot;Date&quot;</span>, </span>
<span id="cb193-16"><a href="#cb193-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;factor&quot;</span>, <span class="st">&quot;double&quot;</span>, </span>
<span id="cb193-17"><a href="#cb193-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;NULL&quot;</span></span>
<span id="cb193-18"><a href="#cb193-18" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb193-19"><a href="#cb193-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(r)</span>
<span id="cb193-20"><a href="#cb193-20" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p></p>
<p>Perceba pelo resultado abaixo, que a função <code>is.vector()</code> nos retorna <code>TRUE</code> para uma lista (<code>list</code>), mas nos retorna <code>FALSE</code> para diversos vetores associados a tipos “não-atômicos” da linguagem, como os tipos <code>Date</code> e <code>factor</code>.</p>
<p></p>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb194-1"><a href="#cb194-1" aria-hidden="true" tabindex="-1"></a><span class="fu">aplicar_teste</span>(is.vector)</span></code></pre></div>
<pre><code>##     matrix      array       list data.frame       Date     factor 
##      FALSE      FALSE       TRUE      FALSE      FALSE      FALSE 
##     double       NULL 
##       TRUE      FALSE</code></pre>
<p></p>
<p>Devido a essas características, caso você deseje testar se um objeto <code>x</code> é um vetor atômico de forma mais restrita (isto é, que retorna <code>FALSE</code> para listas e <code>FALSE</code> para tipos de dados “não-atômicos” como <code>Date</code> e <code>factor</code>), você pode utilizar o teste lógico <code>is.vector(x) &amp; !is.list(x)</code>. Como demonstrado abaixo, esse teste retorna <code>TRUE</code> para <code>vec</code>, mas <code>FALSE</code> para <code>l</code> e para <code>v1</code>.</p>
<p></p>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb196-1"><a href="#cb196-1" aria-hidden="true" tabindex="-1"></a><span class="fu">is.vector</span>(l) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.list</span>(l) <span class="co"># lista</span></span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb198-1"><a href="#cb198-1" aria-hidden="true" tabindex="-1"></a><span class="fu">is.vector</span>(v1) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.list</span>(v1) <span class="co"># Vetor do tipo Date</span></span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb200-1"><a href="#cb200-1" aria-hidden="true" tabindex="-1"></a><span class="fu">is.vector</span>(vec) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.list</span>(vec) <span class="co"># Vetor do tipo double</span></span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p></p>
<p>Dentro dos pacotes básicos do R nós temos a função <code>is.atomic()</code>, mas o pacote <code>purrr</code> nos oferece uma função “irmã” chamada de <code>is_atomic()</code> . A única diferença entre essas duas funções, é que <code>is_atomic()</code> retorna <code>FALSE</code> para um valor <code>NULL</code>, enquanto <code>is.atomic()</code> retorna <code>TRUE</code>. Para além desse detalhe, você pode reparar abaixo, que ambas as funções retornam um valor <code>TRUE</code> para matrizes (<code>matrix</code>) e <em>arrays</em> (<code>array</code>).</p>
<p></p>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb202-1"><a href="#cb202-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span></code></pre></div>
<p></p>
<p></p>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb203-1"><a href="#cb203-1" aria-hidden="true" tabindex="-1"></a><span class="fu">aplicar_teste</span>(is_atomic)</span></code></pre></div>
<pre><code>##     matrix      array       list data.frame       Date     factor 
##       TRUE       TRUE      FALSE      FALSE       TRUE       TRUE 
##     double       NULL 
##       TRUE      FALSE</code></pre>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb205-1"><a href="#cb205-1" aria-hidden="true" tabindex="-1"></a><span class="fu">aplicar_teste</span>(is.atomic)</span></code></pre></div>
<pre><code>##     matrix      array       list data.frame       Date     factor 
##       TRUE       TRUE      FALSE      FALSE       TRUE       TRUE 
##     double       NULL 
##       TRUE       TRUE</code></pre>
<p></p>
<p>Com esses detalhes em mente, se você deseja adotar um conceito levemente mais abrangente de vetor, de forma a testar se um objeto é um vetor e incluir os diversos tipos “não-atômicos” como <code>Date</code> e <code>factor</code>, você pode utilizar a função <code>is_atomic()</code> do pacote <code>purrr</code>. Mas também é necessário contornar o comportamento de <code>is_atomic()</code> para matrizes e <em>arrays</em>, ao aplicar o teste lógico <code>is_atomic(x) &amp; is.null(dim(x))</code>.</p>
<p></p>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb207-1"><a href="#cb207-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span></code></pre></div>
<p></p>
<p></p>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb208-1"><a href="#cb208-1" aria-hidden="true" tabindex="-1"></a><span class="fu">is_atomic</span>(m) <span class="sc">&amp;</span> <span class="fu">is.null</span>(<span class="fu">dim</span>(m)) <span class="co"># Matriz</span></span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="#cb210-1" aria-hidden="true" tabindex="-1"></a><span class="fu">is_atomic</span>(a) <span class="sc">&amp;</span> <span class="fu">is.null</span>(<span class="fu">dim</span>(a)) <span class="co"># Array</span></span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb212-1"><a href="#cb212-1" aria-hidden="true" tabindex="-1"></a><span class="fu">is_atomic</span>(v1) <span class="sc">&amp;</span> <span class="fu">is.null</span>(<span class="fu">dim</span>(v1)) <span class="co"># Vetor do tipo Date</span></span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb214-1"><a href="#cb214-1" aria-hidden="true" tabindex="-1"></a><span class="fu">is_atomic</span>(vec) <span class="sc">&amp;</span> <span class="fu">is.null</span>(<span class="fu">dim</span>(vec)) <span class="co"># Vetor do tipo double</span></span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p></p>
<p>Para além de <code>is_atomic()</code>, o pacote <code>purrr</code> também nos oferece a função <code>is_vector()</code>. Ao invés de se preocupar com os atributos que um objeto carrega, a função <code>is_vector()</code> verifica se o objeto <code>x</code> é armazenado (na camada mais profunda da linguagem) a partir de um vetor. Entretanto, como os vetores atômicos são a unidade fundamental das demais estruturas de dados presentes na linguagem, este conceito de vetor adotado por <code>is_vector()</code> é bastante abrangente, de modo que a função nos retorna <code>TRUE</code> para todas as estruturas e tipos de dados, como está demonstrado abaixo. Portanto, de certa forma, <code>is_vector()</code> busca identificar se um dado objeto é construído a partir de um vetor, mas não necessariamente se ele é um vetor <em>per se</em>.</p>
<p></p>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb216-1"><a href="#cb216-1" aria-hidden="true" tabindex="-1"></a><span class="fu">aplicar_teste</span>(is_vector)</span></code></pre></div>
<pre><code>##     matrix      array       list data.frame       Date     factor 
##       TRUE       TRUE       TRUE       TRUE       TRUE       TRUE 
##     double       NULL 
##       TRUE      FALSE</code></pre>
<p></p>
<p>Por último, como o tipo <code>numeric</code> é um sinônimo para os tipos <code>integer</code> e <code>double</code>, ao aplicar a função <code>is.numeric()</code> sobre um objeto, você está na verdade testando se esse objeto específico está associado ao tipo <code>double</code> ou ao tipo <code>integer</code>. Se você precisa que esse objeto esteja associado a apenas um desses dois tipos, utilize a função correspondente a esse tipo (<code>is.integer()</code> ou <code>is.double()</code>) ao invés de <code>is.numeric()</code>.</p>
</div>
</div>
<div id="sec:coercion_R_fundamentos" class="section level2" number="2.7">
<h2 number="2.7"><span class="header-section-number">2.7</span> Coerção no R</h2>
<p>Quando discuti sobre vetores e sua principal propriedade (<strong>vetores podem manter apenas um tipo de dado dentro dele</strong>), eu mencionei que caso você tentasse burlar essa regra, o R automaticamente converteria todos os valores para um único tipo de dado. Este processo é usualmente chamado por <em>coercion</em>, ou coerção, e iremos explicar como ele funciona nesta seção.</p>
<p>Em resumo, coerção é o processo em que o R converte automaticamente e, <strong>implicitamente</strong>, valores de um tipo de dado para um outro tipo. Esse processo é bem semelhante ao processo de coerção que ocorre na linguagem JavaScript, sendo a soma entre um número e um <em>string</em>, o exemplo mais clássico de coerção em JavaScript. Reproduzindo esse exemplo abaixo, nós estamos somando um valor numérico a um texto. Ao perceber essa diferença entre os tipos de dados, o JavaScript converte automaticamente o valor <code>10</code> para o tipo <em>string</em>, antes de executar a soma. Logo, ao realizar essa conversão, o JavaScript transforma uma soma entre um número e um <em>string</em>, em uma soma entre dois <em>strings</em> e, como resultado, o JavaScript apenas concatena os dois números um do lado do outro, como demonstrado abaixo:</p>
<p></p>
<div class="sourceCode" id="cb218"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb218-1"><a href="#cb218-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Em JavaScript:</span></span>
<span id="cb218-2"><a href="#cb218-2" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> x <span class="op">=</span> <span class="dv">10</span> <span class="op">+</span> <span class="st">&quot;20&quot;</span></span>
<span id="cb218-3"><a href="#cb218-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(x)</span></code></pre></div>
<script type="text/javascript">
// Em JavaScript:
var x = 10 + "20"
print(x)
</script>
<p></p>
<pre><code>1020</code></pre>
<p></p>
<div class="sourceCode" id="cb220"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb220-1"><a href="#cb220-1" aria-hidden="true" tabindex="-1"></a><span class="kw">typeof</span>(x)</span></code></pre></div>
<p></p>
<pre><code>&quot;string&quot;</code></pre>
<p>Apesar da semelhança, processos de coerção no R, ocorrem geralmente quando estamos lidando com vetores de alguma maneira, especialmente quando estamos alterando partes de um vetor específico, ou também, quando estamos calculando um vetor a partir de uma função, e essa função nos retorna mais de 1 tipo de dado em seus resultados. Provavelmente, o exemplo mais clássico de coerção no R, está na concatenação entre um número e um texto. Perceba abaixo, que independente do vetor <code>vec</code> possuir valores do tipo <code>integer</code> (<code>1L</code> e <code>2L</code>), todo o vetor foi automaticamente convertido para o tipo <code>character</code>.</p>
<p></p>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb222-1"><a href="#cb222-1" aria-hidden="true" tabindex="-1"></a>vec <span class="ot">&lt;-</span> <span class="fu">c</span>(1L, 2L, <span class="st">&quot;Texto&quot;</span>)</span>
<span id="cb222-2"><a href="#cb222-2" aria-hidden="true" tabindex="-1"></a><span class="fu">typeof</span>(vec)</span></code></pre></div>
<pre><code>## [1] &quot;character&quot;</code></pre>
<p></p>
<p>Um outro exemplo bem comum de coerção no R, é quando inserimos valores de um tipo “y” em um vetor que contém valores de um tipo “x.” Repare abaixo que, inicialmente, o vetor <code>a</code> possuía 3 elementos que pertenciam ao tipo <code>integer</code>. Porém, ao inserirmos um texto como quarto elemento desse vetor, todos os elementos desse vetor foram automaticamente convertidos para o tipo <code>character</code>:</p>
<p></p>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb224-1"><a href="#cb224-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">c</span>(1L, 2L, 3L)</span>
<span id="cb224-2"><a href="#cb224-2" aria-hidden="true" tabindex="-1"></a><span class="fu">typeof</span>(a)</span></code></pre></div>
<pre><code>## [1] &quot;integer&quot;</code></pre>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb226-1"><a href="#cb226-1" aria-hidden="true" tabindex="-1"></a>a[<span class="dv">4</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Texto&quot;</span></span>
<span id="cb226-2"><a href="#cb226-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(a)</span></code></pre></div>
<pre><code>## [1] &quot;1&quot;     &quot;2&quot;     &quot;3&quot;     &quot;Texto&quot;</code></pre>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb228-1"><a href="#cb228-1" aria-hidden="true" tabindex="-1"></a><span class="fu">typeof</span>(a)</span></code></pre></div>
<pre><code>## [1] &quot;character&quot;</code></pre>
<p></p>
<p>Os exemplos acima são ilustrativos, pois na prática, você geralmente não provoca um processo coerção de forma proposital. Na grande maioria das vezes, você será surpreendido por tal evento. Um exemplo bastante comum no dia-a-dia de coerção ocorre durante a importação de bases de dados mal formatadas. Isso significa que, um processo de coerção pode representar, em muitos momentos, um sinal vermelho para você, lhe indicando que há algo mal formatado na sua base de dados, ou que, você não está incluindo alguma configuração importante no comando de importação da base, ou ainda, que algum de seus comandos no R está gerando um <em>bug</em>, ou um resultado que os demais comandos de seu <em>script</em> não são capazes de lidar com.</p>
<p>Por outro lado, uma situação em que é extremamente útil nos aproveitarmos dessa coerção, é quando queremos somar um vetor lógico. Pois ao convertermos um vetor <code>logical</code> para um vetor <code>integer</code>, os valores <code>TRUE</code> são automaticamente convertidos para 1, enquanto valores <code>FALSE</code> são convertidos para 0. Com isso, você pode aplicar a função <code>sum()</code> sobre um teste lógico para descobrir, por exemplo, quantos elementos de um vetor são maiores do que 5. Para mais, ao calcularmos a média desse vetor lógico, com a função <code>mean()</code>, estamos na verdade calculando a proporção de <code>TRUE</code>’s neste vetor.</p>
<p></p>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb230-1"><a href="#cb230-1" aria-hidden="true" tabindex="-1"></a>vec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">1.2</span>, <span class="fl">3.6</span>, <span class="fl">7.8</span>, <span class="fl">1.9</span>, <span class="fl">5.2</span>, <span class="fl">9.6</span>)</span>
<span id="cb230-2"><a href="#cb230-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(vec <span class="sc">&gt;</span> <span class="dv">5</span>)</span></code></pre></div>
<pre><code>## [1] 3</code></pre>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb232-1"><a href="#cb232-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(vec <span class="sc">&gt;</span> <span class="dv">5</span>)</span></code></pre></div>
<pre><code>## [1] 0.5</code></pre>
<p></p>
<p>Um processo de coerção ocorre apenas sobre vetores atômicos. Porém, lembre-se que todas as outras estruturas são construídas a partir desses vetores, ou todas as outras estruturas podem conter esses vetores dentro delas. Por isso, uma coluna de seu <code>data.frame</code>, ou toda uma matriz, podem sofrer uma coerção, independentemente de você ter ou não requisitado por tal transformação.</p>
<div id="a-árvore-de-coerção" class="section level3" number="2.7.1">
<h3 number="2.7.1"><span class="header-section-number">2.7.1</span> A árvore de coerção</h3>
<p>Quando o processo de coerção ocorre, o R segue uma regra bem simples para escolher o tipo de dado para o qual os seus valores serão convertidos. Em resumo, o R irá sempre transformar os seus dados para o tipo de dado mais flexível, seguindo uma espécie de árvore ou hierarquia, a qual está referenciada na figura 2.11. Você pode ver que o tipo <code>character</code>, está no topo da árvore e, portanto, é o tipo mais flexível de todos, enquanto o <code>logical</code> que está na base, é o tipo mais restrito de todos.</p>
<p>Isso significa, que se você criar um vetor com valores <code>integer</code> e <code>logical</code>, todos esses valores serão convertidos para <code>integer</code>’s. Por outro lado, se for um vetor com valores <code>integer</code> e <code>character</code>, esses valores serão convertidos para <code>character</code>’s. E assim por diante. Ou seja, você é capaz de prever para qual tipo esse vetor será convertido, ao olhar para os dois tipos que estão sendo misturados neste vetor, e identificar qual deles é tipo de dado mais flexível.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Introducao_R_files/figure-html/unnamed-chunk-119-1.png" alt="Árvore de coerção" width="65%" />
<p class="caption">
(#fig:unnamed-chunk-119)Árvore de coerção
</p>
</div>
<p></p>
</div>
<div id="coerções-explícitas-com-as-funções-as." class="section level3" number="2.7.2">
<h3 number="2.7.2"><span class="header-section-number">2.7.2</span> Coerções explícitas com as funções <code>as.*()</code></h3>
<p>Na seção <a href="#sec:funcoes_str_is">Identificando tipos e estruturas com a função <code>str()</code> e as funções <code>is.*()</code></a>, mostramos as funções <code>is.*()</code> que servem para identificarmos se um objeto pertence ou não a uma estrutura ou um tipo de dado específicos. Para além dessas funções, o R também nos oferece as funções <code>as.*()</code>.</p>
<p>Em suma, as funções <code>as.*()</code> servem para convertermos explicitamente os valores de um objeto para um tipo de dado específico. Ou seja, você aplica uma dessas funções quando você deseja provocar explicitamente um processo de coerção sobre um objeto. Como exemplo, se eu tenho um vetor contendo valores do tipo <code>double</code>, e desejo transformá-los em valores do tipo <code>character</code>, eu preciso apenas fornecer este vetor à função <code>as.character()</code>. Veja o exemplo abaixo:</p>
<p></p>
<div class="sourceCode" id="cb234"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb234-1"><a href="#cb234-1" aria-hidden="true" tabindex="-1"></a>vetor <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.5</span>, <span class="sc">-</span><span class="dv">2</span>, <span class="dv">20</span>)</span>
<span id="cb234-2"><a href="#cb234-2" aria-hidden="true" tabindex="-1"></a><span class="fu">as.character</span>(vetor)</span></code></pre></div>
<pre><code>## [1] &quot;0&quot;   &quot;1&quot;   &quot;0.5&quot; &quot;-2&quot;  &quot;20&quot;</code></pre>
<p></p>
<p>Da mesma forma como ocorre com as funções <code>is.*()</code>, o nome da função <code>as.*()</code> que você está utilizando, determina o tipo de dado com o qual essa função trabalha. Logo, a função <code>as.logical()</code> busca converter um objeto para o tipo <code>logical</code>, enquanto a função <code>as.integer()</code>, converte um objeto para o tipo <code>integer</code>, e assim por diante. Abaixo temos uma lista dessas funções.</p>
<ul>
<li><code>as.character()</code>.</li>
<li><code>as.double()</code>.</li>
<li><code>as.integer()</code>.</li>
<li><code>as.logical()</code>.</li>
<li><code>as.numeric()</code>.</li>
</ul>
<p>Apesar de serem funções extremamente úteis, o R não é capaz de fazer mágica. Quando uma função <code>as.*()</code> encontra algum elemento que ela não consegue converter (de alguma forma lógica) para o tipo especificado, a função acaba inserindo um valor <code>NA</code> (valor não disponível) no lugar deste elemento. Por exemplo, se eu possuo o objeto <code>D</code> abaixo, e tento convertê-lo para o tipo <code>double</code>, apenas o terceiro elemento deste objeto é de fato convertido, pois o R <strong>não sabe como</strong> converter os outros dois elementos para o tipo <code>double</code>.</p>
<p></p>
<div class="sourceCode" id="cb236"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb236-1"><a href="#cb236-1" aria-hidden="true" tabindex="-1"></a>D <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;R$2,45&quot;</span>, <span class="st">&quot;Texto&quot;</span>, <span class="st">&quot;8.90&quot;</span>)</span>
<span id="cb236-2"><a href="#cb236-2" aria-hidden="true" tabindex="-1"></a><span class="fu">as.double</span>(D)</span></code></pre></div>
<pre><code>## Warning: NAs introduced by coercion</code></pre>
<pre><code>## [1]  NA  NA 8.9</code></pre>
<p></p>
<p>Como um outro exemplo, ao utilizarmos a função <code>as.logical()</code> sobre um objeto <code>x</code>, se esse objeto <code>x</code> se encontra no tipo <code>double</code> ou <code>integer</code>, todos os valores que forem iguais a 0, serão convertidos para <code>FALSE</code>, enquanto todos os demais valores (diferentes de 0) serão convertidos para <code>TRUE</code>. Contudo, se o objeto <code>x</code> se encontra no tipo <code>character</code>, apenas textos explícitos dos valores lógicos (<code>FALSE</code> e <code>TRUE</code>), podem ser convertidos. Perceba pelo exemplo abaixo, que o R consegue converter apenas os elementos 1, 5 e 6 do vetor.</p>
<p></p>
<div class="sourceCode" id="cb239"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb239-1"><a href="#cb239-1" aria-hidden="true" tabindex="-1"></a>vetor <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;TRUE&quot;</span>, <span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>, <span class="st">&quot;F&quot;</span>, <span class="st">&quot;T&quot;</span>)</span>
<span id="cb239-2"><a href="#cb239-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb239-3"><a href="#cb239-3" aria-hidden="true" tabindex="-1"></a><span class="fu">as.logical</span>(vetor)</span></code></pre></div>
<pre><code>## [1]  TRUE    NA    NA    NA FALSE  TRUE</code></pre>
<p></p>
</div>
<div id="também-podemos-converter-estruturas-de-dados-com-as-funções-as." class="section level3" number="2.7.3">
<h3 number="2.7.3"><span class="header-section-number">2.7.3</span> Também podemos converter estruturas de dados com as funções <code>as.*()</code></h3>
<p>Apesar do processo de coerção ocorrer (de forma automática e implícita) apenas sobre os tipos de dados associados a um objeto, nós também temos a capacidade de provocar um “processo de coerção” sobre a estrutura de dado empregada por um objeto, com as funções <code>as.*()</code>. Ou seja, da mesma forma que temos uma função <code>as.*()</code> para cada tipo de dado, nós também temos uma função <code>as.*()</code> para cada estrutura de dado do R. Como uma lista inicial, temos as seguintes funções:</p>
<ul>
<li><code>as.vector()</code>.</li>
<li><code>as.list()</code>.</li>
<li><code>as.matrix()</code>.</li>
<li><code>as.array()</code>.</li>
<li><code>as.data.frame()</code>.</li>
<li><code>tibble::as_tibble()</code>.</li>
</ul>
<p>Algumas conversões são bem diretas, e simples de se compreender. Por exemplo, uma lista (<code>list</code>) pode ser facilmente convertida para um <code>data.frame</code>, pois como descrevemos na seção <a href="#sec:estrutura_data_frames">Tabelas no R: <code>data.frame</code></a>, um <code>data.frame</code> é no fundo, uma lista nomeada com elementos de mesmo comprimento. Tal conversão é demonstrada no exemplo abaixo.</p>
<p></p>
<div class="sourceCode" id="cb241"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb241-1"><a href="#cb241-1" aria-hidden="true" tabindex="-1"></a>lista <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb241-2"><a href="#cb241-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">produtoid =</span> <span class="fu">c</span>(<span class="dv">1335</span>, <span class="dv">1335</span>, <span class="dv">1242</span>, <span class="dv">1198</span>),</span>
<span id="cb241-3"><a href="#cb241-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">preco =</span> <span class="fu">c</span>(<span class="fl">2.4</span>, <span class="fl">2.4</span>, <span class="fl">5.6</span>, <span class="fl">1.9</span>),</span>
<span id="cb241-4"><a href="#cb241-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">unidades =</span> <span class="fu">c</span>(<span class="dv">200</span>, <span class="dv">100</span>, <span class="dv">430</span>, <span class="dv">90</span>)</span>
<span id="cb241-5"><a href="#cb241-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb241-6"><a href="#cb241-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-7"><a href="#cb241-7" aria-hidden="true" tabindex="-1"></a>data_frame <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(lista)</span>
<span id="cb241-8"><a href="#cb241-8" aria-hidden="true" tabindex="-1"></a>data_frame</span></code></pre></div>
<pre><code>##   produtoid preco unidades
## 1      1335   2.4      200
## 2      1335   2.4      100
## 3      1242   5.6      430
## 4      1198   1.9       90</code></pre>
<p></p>
<p>Por outro lado, algumas conversões podem ser estranhas. Por exemplo, ao convertermos uma matriz para uma lista, cada elemento dessa matriz é transformada em um elemento dessa nova lista. Esse mesmo processo ocorre se convertermos um vetor em uma lista. Lembre-se que, uma matriz é no fundo, um vetor com duas dimensões. Logo, ao requisitarmos a conversão de uma matriz para uma lista, é como se essa matriz fosse convertida primeiro para um vetor e, a partir desse vetor, fosse convertida para uma lista.</p>
<p></p>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb243-1"><a href="#cb243-1" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb243-2"><a href="#cb243-2" aria-hidden="true" tabindex="-1"></a>m</span></code></pre></div>
<pre><code>##      [,1] [,2]
## [1,]    1    3
## [2,]    2    4</code></pre>
<div class="sourceCode" id="cb245"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb245-1"><a href="#cb245-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.list</span>(m)</span></code></pre></div>
<pre><code>## [[1]]
## [1] 1
## 
## [[2]]
## [1] 2
## 
## [[3]]
## [1] 3
## 
## [[4]]
## [1] 4</code></pre>
<p></p>
</div>
</div>
<div id="um-estudo-de-caso-importando-os-dados-da-pintec-ibge-para-o-r" class="section level2" number="2.8">
<h2 number="2.8"><span class="header-section-number">2.8</span> Um estudo de caso: importando os dados da PINTEC-IBGE para o R</h2>
<p>Como um exemplo prático de coerção, durante um determinado dia eu (Pedro) estava analisando os dados da PINTEC-IBGE (Pesquisa de Inovação), mais especificamente, a tabela 1 da pesquisa referente à edição de 2000. Com os comandos abaixo, você pode baixar o arquivo dessa tabela em Excel para um diretório temporário de seu computador e importá-la para dentro de seu R, de modo que você possa acompanhar os próximos comandos que vou mostrar.</p>
<p></p>
<div class="sourceCode" id="cb247"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb247-1"><a href="#cb247-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb247-2"><a href="#cb247-2" aria-hidden="true" tabindex="-1"></a>github <span class="ot">&lt;-</span> <span class="st">&quot;https://github.com/pedropark99/&quot;</span></span>
<span id="cb247-3"><a href="#cb247-3" aria-hidden="true" tabindex="-1"></a>pasta <span class="ot">&lt;-</span> <span class="st">&quot;Curso-R/raw/master/Dados/&quot;</span></span>
<span id="cb247-4"><a href="#cb247-4" aria-hidden="true" tabindex="-1"></a>arquivo <span class="ot">&lt;-</span> <span class="st">&quot;tab01_2000.xls&quot;</span></span>
<span id="cb247-5"><a href="#cb247-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb247-6"><a href="#cb247-6" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="fu">paste0</span>(github, pasta, arquivo)</span>
<span id="cb247-7"><a href="#cb247-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb247-8"><a href="#cb247-8" aria-hidden="true" tabindex="-1"></a>dir <span class="ot">&lt;-</span> <span class="fu">tempdir</span>()</span>
<span id="cb247-9"><a href="#cb247-9" aria-hidden="true" tabindex="-1"></a>caminho <span class="ot">&lt;-</span> <span class="fu">paste</span>(dir, arquivo, <span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\\</span><span class="st">&quot;</span>)</span>
<span id="cb247-10"><a href="#cb247-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb247-11"><a href="#cb247-11" aria-hidden="true" tabindex="-1"></a><span class="fu">download.file</span>(url, <span class="at">destfile =</span> caminho, <span class="at">mode =</span> <span class="st">&quot;wb&quot;</span>)</span>
<span id="cb247-12"><a href="#cb247-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb247-13"><a href="#cb247-13" aria-hidden="true" tabindex="-1"></a>tab1 <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(</span>
<span id="cb247-14"><a href="#cb247-14" aria-hidden="true" tabindex="-1"></a>  caminho, </span>
<span id="cb247-15"><a href="#cb247-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">range =</span> <span class="st">&quot;A9:R57&quot;</span>,</span>
<span id="cb247-16"><a href="#cb247-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">col_names =</span> <span class="fu">paste0</span>(<span class="st">&quot;X&quot;</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">18</span>)</span>
<span id="cb247-17"><a href="#cb247-17" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p></p>
<p>Neste dia, eu estava tentado calcular uma simples soma das colunas <code>X5</code> e <code>X6</code>, porém, o R estava me retornando o erro abaixo, me indicando que alguma dessas colunas estava associada a um tipo de dado não-numérico.</p>
<p></p>
<div class="sourceCode" id="cb248"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb248-1"><a href="#cb248-1" aria-hidden="true" tabindex="-1"></a>tab1<span class="sc">$</span>X6 <span class="sc">+</span> tab1<span class="sc">$</span>X5</span></code></pre></div>
<p></p>
<pre><code>Error in tab1$X6 + tab1$X5 : non-numeric argument to binary operator</code></pre>
<p>Este é um erro inesperado, pois quando abrimos o arquivo Excel da tabela, podemos observar que praticamente todas as colunas da tabela (incluindo as colunas <code>X6</code> e <code>X5</code>) são claramente colunas numéricas e, portanto, deveriam estar sendo interpretadas por tipos numéricos. Ao analisarmos mais de perto a estrutura do objeto <code>tab1</code> com a função <code>str()</code>, podemos perceber que diversas colunas da tabela (incluindo a coluna <code>X6</code>) estão sendo interpretadas pelo tipo <code>character</code>, ao invés do tipo <code>double</code>.</p>
<p></p>
<div class="sourceCode" id="cb250"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb250-1"><a href="#cb250-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(tab1)</span></code></pre></div>
<p></p>
<pre><code>tibble [49 x 18] (S3: tbl_df/tbl/data.frame)
 $ X1 : chr [1:49] &quot;Total&quot; &quot;Indústrias extrativas&quot; ...
 $ X2 : num [1:49] 72005 1729 70277 10253 9491 ...
 $ X3 : num [1:49] 22698 297 22401 3024 2773 ...
 $ X4 : num [1:49] 12658.5 92.5 12566 1683.5 1559 ...
 $ X5 : num [1:49] 10355.5 68.1 10287.3 1553.2 1439.4 ...
 $ X6 : chr [1:49] &quot;2974.6496207720083&quot; &quot;27.740643394384399&quot; ...
 $ X7 : num [1:49] 18160 285 17874 2558 2320 ...
 $ X8 : num [1:49] 16753 254 16499 2331 2099 ...
 $ X9 : num [1:49] 2000 36 1964 327 318 ...
 $ X10: num [1:49] 8120.3 80.7 8039.6 1216.7 1105.9 ...
 $ X11: num [1:49] 8944 146 8798 1325 1221 ...
 $ X12: chr [1:49] &quot;3427.0471614397024&quot; &quot;25.137011567518176&quot; ...
 $ X13: chr [1:49] &quot;2996.0692977925214&quot; &quot;91.851470771912076&quot; ...
 $ X14: num [1:49] 2520.6 28.6 2492 355.6 322.8 ...
 $ X15: chr [1:49] &quot;4276.5049681355704&quot; &quot;62.304616808180924&quot; ...
 $ X16: chr [1:49] &quot;2264.1329981437439&quot; &quot;6.021725515719007&quot; ...
 $ X17: chr [1:49] &quot;1175.6811947066112&quot; &quot;51.283169365446376&quot; ...
 $ X18: chr [1:49] &quot;836.69077528521564&quot; &quot;4.99972192701554&quot; ...</code></pre>
<p>Podemos confirmar esse cenário, ao aplicarmos a função <code>is.character()</code> sobre a coluna <code>X6</code>, como demonstrado abaixo:</p>
<p></p>
<div class="sourceCode" id="cb252"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb252-1"><a href="#cb252-1" aria-hidden="true" tabindex="-1"></a><span class="fu">is.character</span>(tab1<span class="sc">$</span>X6)</span></code></pre></div>
<p></p>
<pre><code>[1] TRUE</code></pre>
<p>Portanto, identificamos a origem do erro: a coluna <code>X6</code> está sendo interpretada pelo tipo <code>character</code> e, consequentemente, não pode ser somada diretamente a uma coluna do tipo <code>numeric</code>. Poderíamos utilizar a função <code>as.numeric()</code> sobre a coluna <code>X6</code> e somar o resultado à coluna <code>X5</code> para contornarmos esse problema. Todavia, seria útil identificarmos o porquê dessa coluna estar sendo interpretada desde o início como uma coluna de texto.</p>
<p>Se no arquivo original <code>tab01_2000.xls</code>, essas colunas estão configuradas como colunas numéricas, o mesmo deveria ocorrer dentro do R. Porque o R decidiu aplicar o tipo <code>character</code> sobre essas colunas? Podemos encontrar a resposta para essa pergunta ao olharmos mais atentamente para o intervalo da linha 15 à linha 24 dessa coluna <code>X6</code>. Abaixo, estou justamente selecionando esse intervalo de linhas da coluna. Perceba que na sexta linha do resultado, temos um símbolo de menos (<code>-</code>).</p>
<p></p>
<div class="sourceCode" id="cb254"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb254-1"><a href="#cb254-1" aria-hidden="true" tabindex="-1"></a>tab1[<span class="dv">15</span><span class="sc">:</span><span class="dv">24</span>, <span class="st">&quot;X6&quot;</span>]</span></code></pre></div>
<p></p>
<pre><code>### A tibble: 10 x 1
##    X6                
##    &lt;chr&gt;             
##  1 47.766222201789986
##  2 53.292711161353139
##  3 0                 
##  4 1.222975124981859 
##  5 0                 
##  6 -                 
##  7 1.222975124981859 
##  8 452.69478203700271
##  9 384.49410807956616
## 10 68.200673957436564</code></pre>
<p>Pense sobre “como o R deveria interpretar esse sinal de menos?” Considerando apenas as 10 primeiras linhas da coluna <code>X6</code>, o R claramente optaria por um tipo de dado numérico para interpretar essa coluna. Contudo, ao se deparar com esse sinal de menos, como o R converteria esse símbolo para um número? A resposta é: ele simplesmente não sabe como realizar essa conversão! Logo, como o R não sabe como converter esse sinal de menos para um número, ele optou por interpretar esse símbolo pelo tipo de dado mais flexível de todos. Isto é, o tipo <code>characater</code>. Ao interpretar esse símbolo pelo tipo <code>character</code>, o R percebeu que teria de converter toda a coluna <code>X6</code> para o tipo <code>character</code> para manter esses dados juntos em uma mesma coluna.</p>
<p>Concluindo, este é um exemplo onde uma formatação ruim da base de dados, pode levar a coerções implícitas e inesperadas no R. Como um exercício, você pode abrir o arquivo <code>tab01_2000.xls</code> no Excel, e eliminar manualmente esse símbolo de menos da coluna <code>X6</code>, e tentar importar novamente o arquivo para o R. Ao fazer isso, você vai perceber que o tipo <code>double</code> será empregado sobre a coluna <code>X6</code>, ao invés do tipo <code>character</code>, pois justamente o R não enfrentou o entrave de encontrar um símbolo ou um texto, em uma coluna que é claramente numérica.</p>
</div>
<div id="subsetting" class="section level2" number="2.9">
<h2 number="2.9"><span class="header-section-number">2.9</span> <em>Subsetting</em></h2>
<p>As operações de <em>subsetting</em>, são extremamente importantes no R, e você irá utilizá-las com grande frequência ao longo de seu trabalho. Ao longo das seções de <a href="#sec:estruturas_dados">Estruturas de Dados</a>, eu dei exemplos sobre como utilizar o <em>subsetting</em> com cada tipo de estrutura. Tendo isso em mente, essa seção busca explicitar (ou formalizar) algumas características importantes dessas operações. Como o próprio nome dá a entender, as operações de <em>subsetting</em> servem para extrairmos ou modificarmos <em>subsets</em> (partes) de seus objetos <span class="citation">(<a href="#ref-Rlanguage" role="doc-biblioref">R Core Team 2020b</a>)</span>. Como vimos anteriormente, essas operações são realizadas pelas funções <code>[</code> e <code>[[</code>.</p>
<p>Para utilizar a função <code>[</code>, você precisa abrir um par de colchetes (<code>[ ]</code>) após o nome do objeto (ou função) com o qual está trabalhando. Já para a função <code>[[</code>, você necessita abrir dois pares de colchetes (<code>[[ ]]</code>) após o nome (ou função) com o qual você está trabalhando. Também já vimos ao longo das seções de <a href="#sec:estruturas_dados">Estruturas de Dados</a>, que para extrairmos partes de estruturas unidimensionais como vetores e listas, precisamos de apenas um índice, ou de um único conjunto de índices. Mas para extrairmos partes de estruturas bidimensionais, como matrizes e <code>data.frame</code>’s, precisamos de dois índices, ou de dois conjuntos de índices.</p>
<p>Além disso, lembre-se que como definimos anteriormente, as listas são estruturas especiais, pois podem conter diversas outras estruturas em seus elementos. Portanto, apesar das listas serem estruturas unidimensionais, elas podem conter outras estruturas bidimensionais dentro delas. Por isso, caso você esteja interessado em extrair partes de uma estrutura bidimensional, que está dentro de algum elemento de uma lista, por exemplo, você irá precisar de uma combinação entre um único índice (para acessar o elemento da lista) e outros dois conjuntos de índices (para acessar uma parte específica da estrutura bidimensional).</p>
<div id="principais-diferenças-entre-as-funções-e" class="section level3" number="2.9.1">
<h3 number="2.9.1"><span class="header-section-number">2.9.1</span> Principais diferenças entre as funções <code>[</code> e <code>[[</code>:</h3>
<ol style="list-style-type: decimal">
<li><p>A função <code>[</code> é capaz de trabalhar com todas as dimensões disponíveis de um objeto. Quais serão essas dimensões disponíveis depende da estrutura em que o objeto se encontra. Por outro lado, a função <code>[[</code> pode trabalhar apenas com uma dessas dimensões disponíveis.</p></li>
<li><p>A função <code>[</code> nos permite extrair um conjunto de elementos (ou seções) de um objeto (Ex: da 1° a 100° linha de um <code>data.frame</code>; os elementos 4, 5 e 8 de um vetor; do 3° ao 6° elemento de uma lista). Já a função <code>[[</code> nos permite extrair uma única parte, ou um único elemento de um objeto (Ex: o 5° elemento de uma lista; a 2° coluna de um <code>data.frame</code>; o 10° elemento de um vetor).</p></li>
<li><p>A função <code>[</code> geralmente lhe retorna um resultado na mesma estrutura de seu objeto original. Em outras palavras, se você utilizar a função <code>[</code> sobre uma lista, ela irá lhe retornar uma lista como resultado. Já a função <code>[[</code>, geralmente lhe retorna um resultado em uma estrutura diferente. Dito de outra forma, se você utilizar a função <code>[[</code> sobre um <code>data.frame</code>, por exemplo, ela geralmente vai lhe retornar um vetor como resultado.</p></li>
</ol>
</div>
<div id="dimensões-disponíveis-em-subsetting" class="section level3" number="2.9.2">
<h3 number="2.9.2"><span class="header-section-number">2.9.2</span> Dimensões disponíveis em <em>subsetting</em></h3>
<p>A estrutura em que um objeto se encontra, define as dimensões que estão disponíveis para as funções <code>[</code> e <code>[[</code> . Logo, se você está trabalhando com um <code>data.frame</code>, por exemplo, você possui duas dimensões (linhas e colunas) com as quais você pode trabalhar com a função <code>[</code>. Mas se você está trabalhando com uma estrutura unidimensional, como um vetor atômico, você terá apenas uma única dimensão (os elementos desse vetor) para trabalhar em ambas às funções de <em>subsetting</em> (<code>[</code> e <code>[[</code>).</p>
<p>Uma das diferenças básicas entre as funções <code>[</code> e <code>[[</code>, se encontra no número de dimensões com as quais elas podem trabalhar. A função <code>[</code>, seria uma forma mais “geral” de <em>subsetting</em>, pois ela pode trabalhar com todas as dimensões disponíveis segundo a estrutura que um objeto se encontra. Já a função <code>[[</code>, representa uma forma mais restritiva de <em>subsetting</em>, pois ela trabalha em geral com apenas uma única dimensão de seu objeto (independentemente de qual seja a sua estrutura).</p>
<p>Portanto, se temos uma estrutura bidimensional como um <code>data.frame</code>, a função <code>[</code> pode trabalhar com as suas duas dimensões (linhas e colunas). Porém, a função <code>[[</code> pode trabalhar apenas com uma dessas dimensões, sendo no caso de <code>data.frame</code>’s, a dimensão das colunas. Agora, quando estamos trabalhando com uma estrutura unidimensional, como nós possuímos apenas uma dimensão (elementos) disponível, não há diferença entre as funções <code>[</code> e <code>[[</code> no sentido estabelecido anteriormente. De qualquer maneira, a função <code>[</code> continuará sendo a forma mais geral e flexível de <em>subsetting</em> para objetos unidimensionais. Pois a função <code>[</code> lhe permite selecionar um conjunto, ou uma sequência de elementos de uma estrutura unidimensional, enquanto que com a função <code>[[</code>, você poderá selecionar apenas um único elemento dessa estrutura. Um resumo das dimensões disponíveis em cada estrutura, se encontra na tabela 2.1.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/subsetting_table.png" alt="Resumo das dimensões disponíveis em cada estrutura" width="80%" />
<p class="caption">
(#fig:unnamed-chunk-130)Resumo das dimensões disponíveis em cada estrutura
</p>
</div>
<p></p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/subsetting_table2.png" alt="Notação matemática das dimensões disponíveis em cada estrutura" width="80%" />
<p class="caption">
(#fig:unnamed-chunk-131)Notação matemática das dimensões disponíveis em cada estrutura
</p>
</div>
<p></p>
<p>Nós também podemos ver essas diferenças entre as dimensões disponíveis em cada estrutura e para cada função de <em>subsetting</em>, sob uma perspectiva mais matemática, ao formar uma notação matemática de cada estrutura, incluindo subscritos que representem as suas respectivas dimensões. Essa visão está exposta na tabela 2.2. Por exemplo, pegando um <code>data.frame</code> chamado <span class="math inline">\(DF\)</span>, com <span class="math inline">\(i\)</span> linhas e <span class="math inline">\(j\)</span> colunas (<span class="math inline">\(DF_{i,j}\)</span>), temos que o comando <code>DF[2,4]</code> busca extrair o valor (ou valores) localizados na 2° linha da 4° coluna da tabela. Por outro lado, considerando-se uma lista chamada <span class="math inline">\(L\)</span>, contendo <span class="math inline">\(e\)</span> elementos (<span class="math inline">\(L_e\)</span>), o comando <code>L[[4]]</code>, traz como resultado, o 4° elemento dessa lista.</p>
</div>
<div id="tipos-de-índices" class="section level3" number="2.9.3">
<h3 number="2.9.3"><span class="header-section-number">2.9.3</span> Tipos de índices</h3>
<p>Os índices que você fornece às funções <code>[</code> e <code>[[</code>, podem ser de três tipos: 1) índices de texto - <code>character</code>; 2) índices numéricos - <code>integer</code>; 3) índices lógicos - <code>logical</code>. Logo abaixo, temos um exemplo do uso de índices numéricos sobre um vetor qualquer. Lembre-se que no caso de vetores, nós podemos utilizar um único índice para extrairmos um único valor do objeto em questão, e nós utilizamos dois ou mais índices, para extrairmos um conjunto de valores deste mesmo vetor.</p>
<p></p>
<div class="sourceCode" id="cb256"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb256-1"><a href="#cb256-1" aria-hidden="true" tabindex="-1"></a>vec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">2.2</span>, <span class="fl">1.3</span>, <span class="fl">4.5</span>, <span class="fl">3.7</span>, <span class="fl">5.2</span>)</span>
<span id="cb256-2"><a href="#cb256-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb256-3"><a href="#cb256-3" aria-hidden="true" tabindex="-1"></a>vec[<span class="dv">4</span>]</span></code></pre></div>
<pre><code>## [1] 3.7</code></pre>
<div class="sourceCode" id="cb258"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb258-1"><a href="#cb258-1" aria-hidden="true" tabindex="-1"></a>vec[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]</span></code></pre></div>
<pre><code>## [1] 2.2 1.3 4.5 3.7</code></pre>
<div class="sourceCode" id="cb260"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb260-1"><a href="#cb260-1" aria-hidden="true" tabindex="-1"></a>vec[<span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">5</span>,<span class="dv">1</span>)]</span></code></pre></div>
<pre><code>## [1] 4.5 5.2 2.2</code></pre>
<p></p>
<p>Para utilizar um índice de texto (<code>character</code>), o objeto sobre o qual você está trabalhando, deve ser uma estrutura nomeada. Todas as estruturas (vetor, lista, matriz e <code>data.frame</code>) permitem o uso de nomes, que você pode acessar e definir através de funções como <code>colnames()</code>, <code>row.names()</code> e <code>names()</code>. Sendo que algumas estruturas, mais especificamente os <code>data.frame</code>’s, vão sempre nomear automaticamente os seus elementos. Ou seja, você sempre poderá utilizar um índice de texto em um <code>data.frame</code>, para selecionar alguma de suas colunas. Pois mesmo que você se esqueça de nomear alguma coluna, ao criar o seu <code>data.frame</code>, a função que cria essa estrutura irá automaticamente criar um nome qualquer para cada coluna não nomeada.</p>
<p></p>
<div class="sourceCode" id="cb262"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb262-1"><a href="#cb262-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb262-2"><a href="#cb262-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">id =</span> LETTERS[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>],</span>
<span id="cb262-3"><a href="#cb262-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">nome =</span> <span class="st">&quot;Ana&quot;</span>,</span>
<span id="cb262-4"><a href="#cb262-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">valor =</span> <span class="fu">rnorm</span>(<span class="dv">10</span>),</span>
<span id="cb262-5"><a href="#cb262-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Belo Horizonte&quot;</span></span>
<span id="cb262-6"><a href="#cb262-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb262-7"><a href="#cb262-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb262-8"><a href="#cb262-8" aria-hidden="true" tabindex="-1"></a>df</span></code></pre></div>
<pre><code>##    id nome      valor X.Belo.Horizonte.
## 1   A  Ana  0.9222787    Belo Horizonte
## 2   B  Ana -0.2383853    Belo Horizonte
## 3   C  Ana -0.1323328    Belo Horizonte
## 4   D  Ana  2.1110304    Belo Horizonte
## 5   E  Ana  1.3883470    Belo Horizonte
## 6   F  Ana -0.7651441    Belo Horizonte
## 7   G  Ana  0.3903723    Belo Horizonte
## 8   H  Ana -0.1488965    Belo Horizonte
## 9   I  Ana  0.8879246    Belo Horizonte
## 10  J  Ana  0.1321532    Belo Horizonte</code></pre>
<div class="sourceCode" id="cb264"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb264-1"><a href="#cb264-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(df)[<span class="dv">4</span>] <span class="ot">&lt;-</span> <span class="st">&quot;cidade&quot;</span></span>
<span id="cb264-2"><a href="#cb264-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb264-3"><a href="#cb264-3" aria-hidden="true" tabindex="-1"></a>df[[<span class="st">&quot;cidade&quot;</span>]]</span></code></pre></div>
<pre><code>##  [1] &quot;Belo Horizonte&quot; &quot;Belo Horizonte&quot; &quot;Belo Horizonte&quot; &quot;Belo Horizonte&quot;
##  [5] &quot;Belo Horizonte&quot; &quot;Belo Horizonte&quot; &quot;Belo Horizonte&quot; &quot;Belo Horizonte&quot;
##  [9] &quot;Belo Horizonte&quot; &quot;Belo Horizonte&quot;</code></pre>
<div class="sourceCode" id="cb266"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb266-1"><a href="#cb266-1" aria-hidden="true" tabindex="-1"></a>df[<span class="fu">c</span>(<span class="st">&quot;id&quot;</span>, <span class="st">&quot;valor&quot;</span>)]</span></code></pre></div>
<pre><code>##    id      valor
## 1   A  0.9222787
## 2   B -0.2383853
## 3   C -0.1323328
## 4   D  2.1110304
## 5   E  1.3883470
## 6   F -0.7651441
## 7   G  0.3903723
## 8   H -0.1488965
## 9   I  0.8879246
## 10  J  0.1321532</code></pre>
<div class="sourceCode" id="cb268"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb268-1"><a href="#cb268-1" aria-hidden="true" tabindex="-1"></a>df[[<span class="st">&quot;valor&quot;</span>]]</span></code></pre></div>
<pre><code>##  [1]  0.9222787 -0.2383853 -0.1323328  2.1110304  1.3883470 -0.7651441
##  [7]  0.3903723 -0.1488965  0.8879246  0.1321532</code></pre>
<div class="sourceCode" id="cb270"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb270-1"><a href="#cb270-1" aria-hidden="true" tabindex="-1"></a>df[[<span class="st">&quot;nome&quot;</span>]]</span></code></pre></div>
<pre><code>##  [1] &quot;Ana&quot; &quot;Ana&quot; &quot;Ana&quot; &quot;Ana&quot; &quot;Ana&quot; &quot;Ana&quot; &quot;Ana&quot; &quot;Ana&quot; &quot;Ana&quot; &quot;Ana&quot;</code></pre>
<p></p>
<p>Em outras estruturas como um vetor, nomes não são atribuídos automaticamente a cada um de seus elementos, e por isso, você deve nomear os elementos deste vetor, para que você seja capaz de utilizar um índice de texto nele. Para isso, basta igualar esses elementos a um valor em texto (valor entre aspas) que representa esse nome, como no exemplo abaixo:</p>
<p></p>
<div class="sourceCode" id="cb272"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb272-1"><a href="#cb272-1" aria-hidden="true" tabindex="-1"></a>vec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;a&quot;</span> <span class="ot">=</span> <span class="dv">1</span>, <span class="st">&quot;b&quot;</span> <span class="ot">=</span> <span class="dv">2</span>, <span class="st">&quot;c&quot;</span> <span class="ot">=</span> <span class="dv">3</span>, <span class="st">&quot;d&quot;</span> <span class="ot">=</span> <span class="dv">4</span>)</span>
<span id="cb272-2"><a href="#cb272-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-3"><a href="#cb272-3" aria-hidden="true" tabindex="-1"></a>vec[<span class="st">&quot;c&quot;</span>]</span></code></pre></div>
<pre><code>## c 
## 3</code></pre>
<div class="sourceCode" id="cb274"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb274-1"><a href="#cb274-1" aria-hidden="true" tabindex="-1"></a>vec[<span class="fu">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;c&quot;</span>, <span class="st">&quot;b&quot;</span>)]</span></code></pre></div>
<pre><code>## a c b 
## 1 3 2</code></pre>
<div class="sourceCode" id="cb276"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb276-1"><a href="#cb276-1" aria-hidden="true" tabindex="-1"></a>vec[[<span class="st">&quot;b&quot;</span>]]</span></code></pre></div>
<pre><code>## [1] 2</code></pre>
<p></p>
<p>Por último, os índices lógicos (<code>TRUE</code> ou <code>FALSE</code>) são extremamente úteis em diversas aplicações, especialmente quando desejamos realizar um <em>subsetting</em> mais “complexo.” Porém, pelo fato de que a função <code>[[</code> nos permite extrair apenas uma única parte de um objeto, os índices lógicos são de certa forma inúteis com essa função. Portanto, sempre que utilizar índices do tipo lógico para selecionar os seus dados, você muito provavelmente quer utilizá-los com a função <code>[</code>. Por padrão, as funções <code>[</code> e <code>[[</code>, vão extrair todas as partes de um objeto, que possuírem um valor <code>TRUE</code> correspondente.</p>
<p>Portanto, no exemplo abaixo, caso eu utilize o vetor lógico <code>vlog</code>, para selecionar valores do vetor <code>vec</code>, a função <code>[</code> irá selecionar o 2°, 3° e 5° valor do vetor <code>vec</code>. Pois são essas as posições no vetor <code>vlog</code> que contém <code>TRUE</code>’s. Porém, a principal forma de gerarmos esses vetores lógicos a serem utilizados na função <code>[</code>, é através de testes lógicos. Por exemplo, podemos testar quais valores do vetor <code>vec</code>, são maiores do que 3, através do operador lógico <code>&gt;</code> (maior que).</p>
<p></p>
<div class="sourceCode" id="cb278"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb278-1"><a href="#cb278-1" aria-hidden="true" tabindex="-1"></a>vec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">2.2</span>, <span class="fl">1.5</span>, <span class="fl">3.4</span>, <span class="fl">6.7</span>, <span class="fl">8.9</span>)</span>
<span id="cb278-2"><a href="#cb278-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb278-3"><a href="#cb278-3" aria-hidden="true" tabindex="-1"></a>vlog <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="cn">FALSE</span>, <span class="cn">TRUE</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>, <span class="cn">TRUE</span>)</span>
<span id="cb278-4"><a href="#cb278-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb278-5"><a href="#cb278-5" aria-hidden="true" tabindex="-1"></a>vec[vlog]</span></code></pre></div>
<pre><code>## [1] 1.5 3.4 8.9</code></pre>
<div class="sourceCode" id="cb280"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb280-1"><a href="#cb280-1" aria-hidden="true" tabindex="-1"></a>vec[vec <span class="sc">&gt;</span> <span class="dv">3</span>]</span></code></pre></div>
<pre><code>## [1] 3.4 6.7 8.9</code></pre>
<p></p>
<p>O R possui vários operadores lógicos diferentes, e o operador <code>&gt;</code> é apenas um deles. Um outro operador muito conhecido, é o de negação <code>"!"</code>. Este operador é utilizado, quando você deseja inverter um teste lógico, ou de certa forma, inverter o comportamento da função <code>[</code> quando fornecemos índices lógicos. O que o operador <code>!</code> faz na verdade, é inverter os valores de um vetor lógico. Logo, se eu aplicar este operador ao vetor <code>vlog</code>, esse será o resultado:</p>
<p></p>
<div class="sourceCode" id="cb282"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb282-1"><a href="#cb282-1" aria-hidden="true" tabindex="-1"></a><span class="sc">!</span>vlog</span></code></pre></div>
<pre><code>## [1]  TRUE FALSE FALSE  TRUE FALSE</code></pre>
<p></p>
<p>Portanto, os valores que antes eram <code>TRUE</code>, passam a ser <code>FALSE</code>, e vice-versa. Por isso, ao utilizarmos o operador <code>!</code> sobre um teste lógico qualquer, nós invertemos o teste em questão. Pois o operador <code>!</code> inverte os valores do vetor lógico resultante desse teste. Com isso, se eu utilizar esse operador sobre o teste anterior, onde testamos quais valores do vetor <code>vec</code> são maiores do que 3, nós estaremos efetivamente testando a hipótese contrária, de que esses valores são menores ou iguais a 3. Vale ressaltar, que esse operador deve ser posicionado antes do objeto que você deseja inverter, ou antes do teste lógico a ser realizado.</p>
<p></p>
<div class="sourceCode" id="cb284"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb284-1"><a href="#cb284-1" aria-hidden="true" tabindex="-1"></a>vec[<span class="sc">!</span>vec <span class="sc">&gt;</span> <span class="dv">3</span>]</span></code></pre></div>
<pre><code>## [1] 2.2 1.5</code></pre>
<p></p>
<p>Um uso muito comum deste operador, é em conjunto com a função <code>is.na()</code>. Essa função, aplica um teste lógico sobre cada valor de um vetor, testando a hipótese de que esse valor se trata de um valor não-disponível (<code>NA</code>). Por isso, caso o valor em questão, seja de fato um valor não-disponível, a função <code>is.na()</code> irá retornar um <code>TRUE</code> correspondente, caso contrário, a função vai lhe retornar um <code>FALSE</code>. Logo, caso eu utilize a função <code>is.na()</code> dentro da função <code>[</code>, estaremos selecionando todos os valores não-disponíveis de um vetor. Porém, é muito mais comum que as pessoas queiram fazer justamente o contrário, que é eliminar esses valores não-disponíveis de seus dados. Por essa razão, é muito comum que se utilize o operador <code>!</code> em conjunto com a função <code>is.na()</code>, pois dessa forma, estaremos selecionando justamente os valores que se encaixam na hipótese contrária a testada por <code>is.na()</code>.</p>
<p></p>
<div class="sourceCode" id="cb286"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb286-1"><a href="#cb286-1" aria-hidden="true" tabindex="-1"></a>vec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">2.2</span>, <span class="fl">1.3</span>, <span class="cn">NA_real_</span>, <span class="cn">NA_real_</span>, <span class="fl">2.5</span>)</span>
<span id="cb286-2"><a href="#cb286-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb286-3"><a href="#cb286-3" aria-hidden="true" tabindex="-1"></a>vec</span></code></pre></div>
<pre><code>## [1] 2.2 1.3  NA  NA 2.5</code></pre>
<div class="sourceCode" id="cb288"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb288-1"><a href="#cb288-1" aria-hidden="true" tabindex="-1"></a>vec[<span class="fu">is.na</span>(vec)]</span></code></pre></div>
<pre><code>## [1] NA NA</code></pre>
<div class="sourceCode" id="cb290"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb290-1"><a href="#cb290-1" aria-hidden="true" tabindex="-1"></a>vec[<span class="sc">!</span><span class="fu">is.na</span>(vec)]</span></code></pre></div>
<pre><code>## [1] 2.2 1.3 2.5</code></pre>
<p></p>
<p>Vamos pensar no caso de um <code>data.frame</code>. Como definimos anteriormente, temos duas dimensões com as quais podemos trabalhar na função <code>[</code>, com este tipo de estrutura. Podemos por exemplo, utilizar o operador <code>!</code> e a função <code>is.na()</code> sobre a dimensão das linhas desse <code>data.frame</code>. Dessa forma, podemos eliminar todas as linhas dessa tabela, que possuam algum valor não-disponível em uma coluna. Veja o exemplo abaixo, em que uma tabela chamada <code>df</code>, contém três valores não-disponíveis na coluna <code>valor</code>.</p>
<p></p>
<div class="sourceCode" id="cb292"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb292-1"><a href="#cb292-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb292-2"><a href="#cb292-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">id =</span> LETTERS[<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>],</span>
<span id="cb292-3"><a href="#cb292-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">valor =</span> <span class="fu">c</span>(<span class="fl">1.2</span>, <span class="fl">2.5</span>, <span class="cn">NA_real_</span>, <span class="fl">5.5</span>, <span class="cn">NA_real_</span>, <span class="cn">NA_real_</span>, <span class="fl">3.5</span>, <span class="fl">1.3</span>),</span>
<span id="cb292-4"><a href="#cb292-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">nome =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">&quot;Ana&quot;</span>, <span class="st">&quot;Luiza&quot;</span>, <span class="st">&quot;João&quot;</span>), <span class="at">size =</span> <span class="dv">8</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb292-5"><a href="#cb292-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb292-6"><a href="#cb292-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb292-7"><a href="#cb292-7" aria-hidden="true" tabindex="-1"></a>df</span></code></pre></div>
<pre><code>##   id valor  nome
## 1  A   1.2 Luiza
## 2  B   2.5 Luiza
## 3  C    NA   Ana
## 4  D   5.5 Luiza
## 5  E    NA  João
## 6  F    NA Luiza
## 7  G   3.5  João
## 8  H   1.3  João</code></pre>
<div class="sourceCode" id="cb294"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb294-1"><a href="#cb294-1" aria-hidden="true" tabindex="-1"></a>nao_e_NA <span class="ot">&lt;-</span> <span class="sc">!</span>(<span class="fu">is.na</span>(df<span class="sc">$</span>valor))</span>
<span id="cb294-2"><a href="#cb294-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb294-3"><a href="#cb294-3" aria-hidden="true" tabindex="-1"></a>df[nao_e_NA, ]</span></code></pre></div>
<pre><code>##   id valor  nome
## 1  A   1.2 Luiza
## 2  B   2.5 Luiza
## 4  D   5.5 Luiza
## 7  G   3.5  João
## 8  H   1.3  João</code></pre>
<p></p>
</div>
<div id="o-operador-e-a-estrutura-do-resultado" class="section level3" number="2.9.4">
<h3 number="2.9.4"><span class="header-section-number">2.9.4</span> O operador <code>$</code> e a estrutura do resultado</h3>
<p>Você provavelmente se lembra do operador <code>$</code>, que se trata de um atalho à função <code>[[</code>. Porém, você talvez tenha percebido também, que utilizamos o operador <code>$</code> apenas em estruturas nomeadas. Logo, apesar de o operador <code>$</code> ser um “irmão” da função <code>[[</code>, ele não herda todas as características dessa função. Por exemplo, nós não podemos utilizar índices numéricos ou lógicos com este operador, para selecionarmos alguma parte de um objeto. Isto significa, que o operador <code>$</code> se trata de uma versão ainda mais restrita de <em>subsetting</em>, em relação à função <code>[[</code>. As únicas estruturas nomeadas com as quais este operador funciona, são listas e <code>data.frame</code>’s. Em outras palavras, mesmo que você nomeie os elementos de um vetor atômico, você não poderá utilizar o operador <code>$</code> para selecionar um desses elementos.</p>
<p></p>
<div class="sourceCode" id="cb296"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb296-1"><a href="#cb296-1" aria-hidden="true" tabindex="-1"></a>vec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;a&quot;</span> <span class="ot">=</span> <span class="fl">2.5</span>, <span class="st">&quot;b&quot;</span> <span class="ot">=</span> <span class="fl">4.3</span>, <span class="st">&quot;c&quot;</span> <span class="ot">=</span> <span class="fl">1.2</span>)</span>
<span id="cb296-2"><a href="#cb296-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb296-3"><a href="#cb296-3" aria-hidden="true" tabindex="-1"></a>vec<span class="sc">$</span>a</span></code></pre></div>
<p></p>
<p></p>
<pre class="text"><code>Error in vec$a : $ operator is invalid for atomic vectors</code></pre>
<p></p>
<p>Dentre as características da função <code>[[</code> herdadas pelo operador <code>$</code>, está o fato de que este operador pode trabalhar apenas com uma dimensão de um objeto. Em listas, podemos utilizar o operador <code>$</code> para selecionarmos algum dos elementos nomeados dessa lista. Já em <code>data.frame</code>’s, o operador <code>$</code> pode ser utilizado para selecionarmos uma das colunas desse <code>data.frame</code><a href="#fn9" class="footnote-ref" id="fnref9"><sup>9</sup></a>.</p>
<p>Um outro ponto a ser discutido, é que tanto o operador <code>$</code>, quanto a função <code>[[</code>, geram um resultado em uma estrutura diferente da estrutura do objeto original. Ou seja, quando realizamos um <em>subsetting</em> por meio desses operadores, o resultado geralmente possui uma estrutura com menos componentes do que a estrutura do objeto original, de onde estamos retirando esta parte. Dito de outra forma, se utilizarmos o operador <code>$</code>, ou a função <code>[[</code> para selecionarmos a coluna <code>valor</code> do <code>data.frame df</code> abaixo, o resultado de ambas as funções, serão um vetor atômico contendo os valores dessa coluna, e não um <code>data.frame</code> contendo apenas a coluna <code>valor</code>.</p>
<p>Logo, o uso da função <code>[[</code> (ou do operador <code>$</code>) sobre <code>data.frame</code>’s, vão lhe trazer a coluna (ou o elemento) em si do <code>data.frame</code>, e não um novo <code>data.frame</code> contendo essa coluna. Podemos confirmar isso, com o uso da função <code>str()</code>, que nos traz um resumo da estrutura de um objeto. Perceba nos exemplos abaixo, que em ambos os casos, o resultado da função <code>str()</code> está nos dizendo que o objeto resultante do uso de <code>$</code> ou de <code>[[</code>, se trata de um vetor atômico contendo dados do tipo numérico (<code>num</code>).</p>
<p></p>
<div class="sourceCode" id="cb298"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb298-1"><a href="#cb298-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb298-2"><a href="#cb298-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">id =</span> LETTERS[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>],</span>
<span id="cb298-3"><a href="#cb298-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">valor =</span> <span class="fu">rnorm</span>(<span class="dv">10</span>),</span>
<span id="cb298-4"><a href="#cb298-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">nome =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">&quot;Ana&quot;</span>, <span class="st">&quot;Luiza&quot;</span>, <span class="st">&quot;João&quot;</span>), <span class="at">size =</span> <span class="dv">10</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb298-5"><a href="#cb298-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb298-6"><a href="#cb298-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-7"><a href="#cb298-7" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(df<span class="sc">$</span>valor)</span></code></pre></div>
<pre><code>##  num [1:10] 0.556 -1.285 -0.313 0.458 0.919 ...</code></pre>
<div class="sourceCode" id="cb300"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb300-1"><a href="#cb300-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(df[[<span class="st">&quot;valor&quot;</span>]])</span></code></pre></div>
<pre><code>##  num [1:10] 0.556 -1.285 -0.313 0.458 0.919 ...</code></pre>
<p></p>
<p>Essa característica é definida em detalhes no capítulo 4 de <span class="citation"><a href="#ref-wickham2015_advanced" role="doc-biblioref">Wickham</a> (<a href="#ref-wickham2015_advanced" role="doc-biblioref">2015a</a>)</span>. Sendo exatamente esta característica, que eu estava querendo destacar na figura 2.7, quando estávamos descrevendo as listas. Se você utilizar a função <code>[</code> para selecionar um elemento de uma lista, o resultado será uma nova lista contendo esse elemento. Mas se você utilizar a função <code>[[</code> para fazer este trabalho, o resultado será apenas o elemento em si.</p>
<p>Você pode entender essa característica como uma “simplificação do resultado,” como se as funções <code>[[</code> e <code>$</code> gerassem um resultado em uma estrutura mais simples do que a do objeto original. Porém, eu creio que essa é uma forma equivocada de se enxergar esse sistema, pois estruturas não são usualmente comparadas em níveis de complexidade, mas sim por suas propriedades e características.</p>
<p>Por isso, uma forma mais útil e fiel de se enxergar essa característica, é através da representação apresentada pela figura 2.7, onde através da função <code>[[</code>, podemos selecionar o elemento em si, e não uma nova estrutura contendo este elemento. Além disso, uma outra forma útil de enxergarmos essa característica no resultado das funções <code>[[</code> e <code>$</code>, é como uma forma de eliminarmos componentes da estrutura do objeto original. Em outras palavras, podemos enxergar o operador <code>$</code> ou a função <code>[[</code>, como uma forma de gerarmos um resultado com menos componentes do que a estrutura do objeto original.</p>
<p>Por exemplo, se temos um <code>data.frame</code> chamado <code>df</code>, onde temos duas colunas simples (que são vetores atômicos), e em seguida, adicionamos duas novas colunas, uma contendo uma lista, e outra contendo um outro <code>data.frame</code> de duas colunas (<code>y</code> e <code>z</code>), nós temos uma estrutura razoavelmente complexa. Se utilizarmos a função <code>str()</code>, para nos fornecer um resumo da estrutura de <code>df</code>, vemos que esse objeto tem pelo menos três componentes: 1) os vetores representados pelas colunas <code>x</code> e <code>nome</code>; 2) os cinco elementos da lista alocada na coluna <code>lista</code>; 3) e as duas colunas contidas no <code>data.frame</code> da coluna <code>outro_df</code>.</p>
<p></p>
<div class="sourceCode" id="cb302"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb302-1"><a href="#cb302-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb302-2"><a href="#cb302-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">rnorm</span>(<span class="dv">5</span>),</span>
<span id="cb302-3"><a href="#cb302-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">nome =</span> <span class="st">&quot;Ana&quot;</span></span>
<span id="cb302-4"><a href="#cb302-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb302-5"><a href="#cb302-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb302-6"><a href="#cb302-6" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>lista <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>)</span>
<span id="cb302-7"><a href="#cb302-7" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>outro_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">y =</span> <span class="fu">rnorm</span>(<span class="dv">5</span>), <span class="at">z =</span> <span class="fu">rnorm</span>(<span class="dv">5</span>))</span>
<span id="cb302-8"><a href="#cb302-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb302-9"><a href="#cb302-9" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(df)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    5 obs. of  4 variables:
##  $ x       : num  1.0758 -0.7986 0.7649 -0.9688 -0.0349
##  $ nome    : chr  &quot;Ana&quot; &quot;Ana&quot; &quot;Ana&quot; &quot;Ana&quot; ...
##  $ lista   :List of 5
##   ..$ : num 1
##   ..$ : num 2
##   ..$ : num 3
##   ..$ : num 4
##   ..$ : num 5
##  $ outro_df:&#39;data.frame&#39;:    5 obs. of  2 variables:
##   ..$ y: num  1.747 -2.147 1.556 -1.415 0.478
##   ..$ z: num  -1.901 -0.77 0.975 1.108 -2.075</code></pre>
<p></p>
<p>Caso eu utilize as funções <code>[[</code> e <code>$</code> para selecionarmos alguma das colunas de <code>df</code>, podemos aplicar novamente a função <code>str()</code> sobre o resultado, para compreendermos sua estrutura. Veja pelo exemplo abaixo, que o resultado da função <code>str()</code> nos descreve uma estrutura com menos componentes do que a estrutura original. Com isso, eu quero destacar que a estrutura desse resultado não necessariamente será menos “complexa” do que a original, mas sim que essa estrutura terá menos componentes. Portanto, pelo menos um dos componentes da estrutura original, será eliminado com o uso de <code>[[</code> ou de <code>$</code>.</p>
<p></p>
<div class="sourceCode" id="cb304"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb304-1"><a href="#cb304-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(df[[<span class="st">&quot;lista&quot;</span>]])</span></code></pre></div>
<pre><code>## List of 5
##  $ : num 1
##  $ : num 2
##  $ : num 3
##  $ : num 4
##  $ : num 5</code></pre>
<div class="sourceCode" id="cb306"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb306-1"><a href="#cb306-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(df[[<span class="st">&quot;outro_df&quot;</span>]])</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    5 obs. of  2 variables:
##  $ y: num  1.747 -2.147 1.556 -1.415 0.478
##  $ z: num  -1.901 -0.77 0.975 1.108 -2.075</code></pre>
<div class="sourceCode" id="cb308"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb308-1"><a href="#cb308-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(df<span class="sc">$</span>outro_df)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    5 obs. of  2 variables:
##  $ y: num  1.747 -2.147 1.556 -1.415 0.478
##  $ z: num  -1.901 -0.77 0.975 1.108 -2.075</code></pre>
<p></p>
</div>
</div>
<div id="valores-especiais-do-r" class="section level2" number="2.10">
<h2 number="2.10"><span class="header-section-number">2.10</span> Valores especiais do R</h2>
<p>Na linguagem R, possuímos alguns valores especiais, que não apenas são tratados de maneira diferente em relação a outros valores, mas que também efetivamente alteram o comportamento de algumas operações importantes na linguagem. Por exemplo, se você tentar dividir qualquer número por zero no console, ao invés do R lhe retornar um erro, lhe indicando que essa divisão é indefinida, o console vai lhe retornar o valor <code>Inf</code>, que se refere a infinito (ou <em>infinite</em>).</p>
<p>Por outro lado, de forma ainda mais estranha, se você tentar dividir zero por ele mesmo, o console vai lhe retornar o valor <code>NaN</code>, que significa <em>“not a number”</em>, ou em outras palavras, que o valor resultante da divisão não é um número.</p>
<p>Assim como várias outras linguagens de programação, o R também possui um valor “nulo,” ou, em outras palavras, um valor que representa o “vazio” ou o “nada.” Este valor é o <code>NULL</code>. Você encontra esse valor, sempre que a função ou expressão que você executou não possui um valor de retorno definido.</p>
<p>Esses são alguns exemplos de valores especiais que você pode adquirir. Porém, o valor especial mais comum, é o valor <code>NA</code>, que significa <em>not avaliable</em>, ou “não-disponível.” Este valor geralmente é resultado de uma dessas duas situações: 1) ao importar a sua base de dados para o R, a linguagem vai preencher automaticamente todas as células em sua base que estiverem vazias, com um valor <code>NA</code>; 2) quando você executa (ou causa de maneira indireta) um processo de coerção, no qual o R não consegue realizar. Ou seja, se o R não souber como converter um valor específico, para o tipo de dado ao qual você requisitou, ele vai lhe retornar um valor <code>NA</code> correspondente àquele valor.</p>
<p>Portanto, a primeira situação ocorre durante o processo de importação de dados, em todas as ocasiões em que você possuir alguma observação vazia na base de dados que você está importando. Logo, se em uma planilha do Excel, por exemplo, você possuir alguma célula vazia em sua tabela, ao importar essa planilha para o R, essas células vazias serão preenchidas com valores <code>NA</code> no R. Lembre-se que um valor <code>NA</code> indica uma observação não-disponível, o que significa que o valor correspondente aquela observação não pôde ser observado, ou não pôde ser registrado no momento de coleta dos dados.</p>
<p>Já a segunda situação, ocorre sempre quando o R não sabe como realizar o processo de coerção, pelo qual requisitamos, de uma forma lógica. Por exemplo, isso ocorre ao tentarmos converter valores de texto para números com <code>as.double()</code>. Pois o R não sabe como, ou não sabe qual a maneira mais adequada de se converter esses valores em texto para números. Por isso, a linguagem vai lhe retornar como resultado, valores <code>NA</code>.</p>
<div id="sec:impactos_valores_especiais" class="section level3" number="2.10.1">
<h3 number="2.10.1"><span class="header-section-number">2.10.1</span> Os impactos desses valores especiais</h3>
<p>Por que estamos falando desses valores especiais? Porque eles alteram o comportamento de certas operações importantes do R e, com isso, podem deixar você desorientado! Por exemplo, se você tentar calcular a soma de uma coluna (de um <code>data.frame</code>) que contém um valor <code>NA</code>, o resultado dessa operação será um valor <code>NA</code>. Da mesma forma, se a coluna possuir um valor <code>NaN</code>, o resultado dessa soma será um valor <code>NaN</code>. Para que isso ocorra, o valor especial pode estar em qualquer linha que seja, basta que ele ocorra uma única vez, que a sua soma não vai funcionar.</p>
<p></p>
<div class="sourceCode" id="cb310"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb310-1"><a href="#cb310-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="cn">NA</span>, <span class="dv">4</span>))</span></code></pre></div>
<pre><code>## [1] NA</code></pre>
<div class="sourceCode" id="cb312"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb312-1"><a href="#cb312-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="cn">NaN</span>, <span class="dv">4</span>))</span></code></pre></div>
<pre><code>## [1] NaN</code></pre>
<p></p>
<p>Isso não significa que esses valores especiais serão uma dor de cabeça para você, pois cada um deles tem o seu propósito, e eles o cumprem muito bem. Mas é importante que você saiba do quão especiais eles são, e dos efeitos que eles causam em certas operações no R. Com isso, se em alguma situação uma função lhe retornar um valor <code>NA</code>, quando ela deveria lhe retornar algum valor definido, ou se essa função se comportar de maneira inesperada, você pode desconfiar que algum valor especial presente em seus dados, possa ser a fonte de sua surpresa.</p>
<p>Em geral, todas as funções que são afetadas por esses valores especiais, como as funções <code>sum()</code> e <code>mean()</code>, possuem um argumento <code>na.rm</code>, que define se a função deve ignorar esses valores especiais em seus cálculos. Portanto, caso uma coluna de seu <code>data.frame</code> possua esses valores especiais, e você precisa ignorá-los durante o cálculo de uma soma, lembre-se de configurar este argumento para verdadeiro (<code>TRUE</code>).</p>
<p></p>
<div class="sourceCode" id="cb314"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb314-1"><a href="#cb314-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="cn">NA</span>, <span class="dv">4</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## [1] 10</code></pre>
<p></p>
<p>Um outro tipo de operação importante que é afetada por esses valores especiais, são os testes lógicos. Como exemplo, vamos criar um teste lógico sobre os dados apresentados pela tabela <code>compras</code>. Nós temos nessa tabela, o nome da composição química dos principais remédios que estão em falta nos estoques de três grandes hospitais. Os três remédios presentes nessa tabela, são remédios bem comuns, como o valor <code>AA</code> que se refere à composição química da Aspirina (Ácido Acetilsalicílico).</p>
<p></p>
<div class="sourceCode" id="cb316"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb316-1"><a href="#cb316-1" aria-hidden="true" tabindex="-1"></a>compras <span class="ot">&lt;-</span> <span class="fu">structure</span>(<span class="fu">list</span>(<span class="at">ano =</span> <span class="fu">c</span>(<span class="dv">2019</span>, <span class="dv">2019</span>, <span class="dv">2019</span>, <span class="dv">2019</span>, <span class="dv">2019</span>, <span class="dv">2019</span>, <span class="dv">2019</span>, </span>
<span id="cb316-2"><a href="#cb316-2" aria-hidden="true" tabindex="-1"></a><span class="dv">2019</span>, <span class="dv">2019</span>, <span class="dv">2019</span>), <span class="at">mes =</span> <span class="fu">c</span>(2L, 4L, 5L, 6L, 8L, 8L, 10L, 10L, </span>
<span id="cb316-3"><a href="#cb316-3" aria-hidden="true" tabindex="-1"></a>10L, 12L), <span class="at">hospital1 =</span> <span class="fu">c</span>(<span class="st">&quot;AA&quot;</span>, <span class="cn">NA</span>, <span class="st">&quot;dexametasona&quot;</span>, <span class="st">&quot;AA&quot;</span>, <span class="cn">NA</span>, </span>
<span id="cb316-4"><a href="#cb316-4" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;doxiciclina&quot;</span>, <span class="cn">NA</span>, <span class="st">&quot;AA&quot;</span>, <span class="st">&quot;doxiciclina&quot;</span>, <span class="cn">NA</span>), <span class="at">hospital2 =</span> <span class="fu">c</span>(<span class="st">&quot;AA&quot;</span>, </span>
<span id="cb316-5"><a href="#cb316-5" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;doxiciclina&quot;</span>, <span class="st">&quot;dexametasona&quot;</span>, <span class="st">&quot;dexametasona&quot;</span>, <span class="st">&quot;AA&quot;</span>, <span class="cn">NA</span>, <span class="st">&quot;dexametasona&quot;</span>, </span>
<span id="cb316-6"><a href="#cb316-6" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;AA&quot;</span>, <span class="st">&quot;dexametasona&quot;</span>, <span class="st">&quot;AA&quot;</span>), <span class="at">hospital3 =</span> <span class="fu">c</span>(<span class="st">&quot;AA&quot;</span>, <span class="st">&quot;AA&quot;</span>, <span class="st">&quot;dexametasona&quot;</span>, </span>
<span id="cb316-7"><a href="#cb316-7" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span>, <span class="st">&quot;dexametasona&quot;</span>, <span class="st">&quot;doxiciclina&quot;</span>, <span class="st">&quot;dexametasona&quot;</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="st">&quot;AA&quot;</span></span>
<span id="cb316-8"><a href="#cb316-8" aria-hidden="true" tabindex="-1"></a>)), <span class="at">row.names =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="at">class =</span> <span class="st">&quot;data.frame&quot;</span>)</span>
<span id="cb316-9"><a href="#cb316-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb316-10"><a href="#cb316-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb316-11"><a href="#cb316-11" aria-hidden="true" tabindex="-1"></a>compras</span></code></pre></div>
<pre><code>##     ano mes    hospital1    hospital2    hospital3
## 1  2019   2           AA           AA           AA
## 2  2019   4         &lt;NA&gt;  doxiciclina           AA
## 3  2019   5 dexametasona dexametasona dexametasona
## 4  2019   6           AA dexametasona         &lt;NA&gt;
## 5  2019   8         &lt;NA&gt;           AA dexametasona
## 6  2019   8  doxiciclina         &lt;NA&gt;  doxiciclina
## 7  2019  10         &lt;NA&gt; dexametasona dexametasona
## 8  2019  10           AA           AA         &lt;NA&gt;
## 9  2019  10  doxiciclina dexametasona         &lt;NA&gt;
## 10 2019  12         &lt;NA&gt;           AA           AA</code></pre>
<p></p>
<p>Por exemplo, se nós quiséssemos identificar todas as linhas na tabela <code>compras</code>, em que a composição química da Aspirina (valor <code>AA</code>) aparece em pelo menos um dos hospitais (ou dito de outra forma, em pelo menos uma das colunas), poderíamos aplicar um teste lógico sobre a tabela <code>compras</code>. O teste lógico abaixo, serve para esse propósito, mas se olharmos para o resultado desse teste, podemos identificar que algo está errado.</p>
<p></p>
<div class="sourceCode" id="cb318"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb318-1"><a href="#cb318-1" aria-hidden="true" tabindex="-1"></a>teste <span class="ot">&lt;-</span> compras<span class="sc">$</span>hospital1 <span class="sc">==</span> <span class="st">&quot;AA&quot;</span> <span class="sc">|</span></span>
<span id="cb318-2"><a href="#cb318-2" aria-hidden="true" tabindex="-1"></a>  compras<span class="sc">$</span>hospital2 <span class="sc">==</span> <span class="st">&quot;AA&quot;</span> <span class="sc">|</span></span>
<span id="cb318-3"><a href="#cb318-3" aria-hidden="true" tabindex="-1"></a>  compras<span class="sc">$</span>hospital3 <span class="sc">==</span> <span class="st">&quot;AA&quot;</span> </span>
<span id="cb318-4"><a href="#cb318-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb318-5"><a href="#cb318-5" aria-hidden="true" tabindex="-1"></a>teste</span></code></pre></div>
<pre><code>##  [1]  TRUE  TRUE FALSE  TRUE  TRUE    NA    NA  TRUE    NA  TRUE</code></pre>
<p></p>
<p>Perceba acima, que o teste lógico detectou com sucesso todas as linhas da tabela <code>compras</code>, que possuem um valor <code>AA</code> em pelo menos uma de suas colunas. Mais especificamente, as linhas de posição 1°, 2°, 4°, 5°, 8° e 10°. Porém, podemos também identificar, que para as linhas de posição 6°, 7° e 9° na tabela, o teste lógico <code>teste</code> nos retornou valores <code>NA</code>. Ou seja, ao invés do teste lógico nos retornar um valor <code>FALSE</code>, para as linhas que não possuem um valor <code>AA</code> ao longo de suas colunas, ele acaba nos retornando um valor <code>NA</code>, pelo simples fato de que temos um valor <code>NA</code> em pelo menos uma das colunas. Isso se torna um grande problema, a partir do momento em que desejamos filtrar a nossa tabela <code>compras</code>, ao fornecer o nosso vetor <code>teste</code>, à função de <em>subsetting</em>.</p>
<p></p>
<div class="sourceCode" id="cb320"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb320-1"><a href="#cb320-1" aria-hidden="true" tabindex="-1"></a>compras[teste, ]</span></code></pre></div>
<pre><code>##       ano mes hospital1    hospital2    hospital3
## 1    2019   2        AA           AA           AA
## 2    2019   4      &lt;NA&gt;  doxiciclina           AA
## 4    2019   6        AA dexametasona         &lt;NA&gt;
## 5    2019   8      &lt;NA&gt;           AA dexametasona
## NA     NA  NA      &lt;NA&gt;         &lt;NA&gt;         &lt;NA&gt;
## NA.1   NA  NA      &lt;NA&gt;         &lt;NA&gt;         &lt;NA&gt;
## 8    2019  10        AA           AA         &lt;NA&gt;
## NA.2   NA  NA      &lt;NA&gt;         &lt;NA&gt;         &lt;NA&gt;
## 10   2019  12      &lt;NA&gt;           AA           AA</code></pre>
<p></p>
<p>Portanto, o problema gerado pelos valores <code>NA</code> presentes no resultado do teste lógico, é que eles geram indiretamente um novo problema a ser resolvido. O objetivo principal está em identificar as linhas da tabela <code>compras</code>, que possuem um valor <code>AA</code>, em pelo menos uma de suas colunas, e filtrá-las da tabela. Porém, ao fornecermos esse vetor <code>teste</code> à função de <em>subsetting</em>, a função <code>[</code> acaba adicionando uma nova linha ao resultado, para cada valor <code>NA</code> presente no vetor <code>teste</code>. Logo, o resultado que era para ter 6 linhas, acaba tendo 9. Com isso, teríamos um novo trabalho de eliminar essas novas linhas de <code>NA</code>’s, para chegarmos às linhas que queremos filtrar da nossa tabela <code>compras</code>.</p>
</div>
<div id="valores-especiais-também-estão-associados-a-algum-tipo-de-dado" class="section level3" number="2.10.2">
<h3 number="2.10.2"><span class="header-section-number">2.10.2</span> Valores especiais também estão associados a algum tipo de dado</h3>
<p>Vale destacar que, assim como qualquer outro valor no R, os valores especiais do R também estão associados a algum dos 5 tipos básicos de dados apresentados na seção <a href="#sec:fundamentos_tipos_dados">Tipos de dados</a>. Como exemplo, os valores <code>Inf</code>, <code>-Inf</code> e <code>NaN</code> são valores associados ao tipo <code>double</code>.</p>
<p></p>
<div class="sourceCode" id="cb322"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb322-1"><a href="#cb322-1" aria-hidden="true" tabindex="-1"></a><span class="fu">typeof</span>(<span class="cn">Inf</span>)</span></code></pre></div>
<pre><code>## [1] &quot;double&quot;</code></pre>
<div class="sourceCode" id="cb324"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb324-1"><a href="#cb324-1" aria-hidden="true" tabindex="-1"></a><span class="fu">typeof</span>(<span class="sc">-</span><span class="cn">Inf</span>)</span></code></pre></div>
<pre><code>## [1] &quot;double&quot;</code></pre>
<div class="sourceCode" id="cb326"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb326-1"><a href="#cb326-1" aria-hidden="true" tabindex="-1"></a><span class="fu">typeof</span>(<span class="cn">NaN</span>)</span></code></pre></div>
<pre><code>## [1] &quot;double&quot;</code></pre>
<p></p>
<p>Por outro lado, o valor <code>NA</code> é por padrão, um valor do tipo <code>logical</code>. Porém, diferentemente de <code>Inf</code>, <code>-Inf</code> e <code>NaN</code>, o valor <code>NA</code> possui diferentes “versões” para cada um dos 5 tipos de dados. Essas versões são <code>NA_character_</code>, <code>NA_real_</code>, <code>NA_complex_</code> e <code>NA_integer_</code>. Temos também outras “versões” referentes a tipos de dados mais complexos, como <code>NA_POSIXct_</code> e <code>NA_Date_</code> que se referem aos tipos <code>POSIXct</code> e <code>Date</code>, os quais vamos descrever no capítulo <a href="#sec:lubridate_var_tempo">Introdução à variáveis de tempo com <code>lubridate</code></a>.</p>
<p></p>
<div class="sourceCode" id="cb328"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb328-1"><a href="#cb328-1" aria-hidden="true" tabindex="-1"></a><span class="fu">typeof</span>(<span class="cn">NA</span>)</span></code></pre></div>
<pre><code>## [1] &quot;logical&quot;</code></pre>
<div class="sourceCode" id="cb330"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb330-1"><a href="#cb330-1" aria-hidden="true" tabindex="-1"></a><span class="fu">typeof</span>(<span class="cn">NA_character_</span>)</span></code></pre></div>
<pre><code>## [1] &quot;character&quot;</code></pre>
<div class="sourceCode" id="cb332"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb332-1"><a href="#cb332-1" aria-hidden="true" tabindex="-1"></a><span class="fu">typeof</span>(<span class="cn">NA_real_</span>)</span></code></pre></div>
<pre><code>## [1] &quot;double&quot;</code></pre>
<p></p>
<p>Portanto, valores como <code>Inf</code>, <code>-Inf</code> e <code>NaN</code> estão presentes apenas no tipo <code>double</code>, enquanto o valor <code>NA</code> possui uma “versão” para cada tipo de dado no R. Tanto que, se tentarmos converter um valor como <code>NaN</code> para algum outro tipo, como o tipo <code>logical</code>, ele será automaticamente convertido para um valor <code>NA</code> do tipo <code>logical</code>, como demonstrado abaixo.</p>
<p></p>
<div class="sourceCode" id="cb334"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb334-1"><a href="#cb334-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.logical</span>(<span class="cn">NaN</span>)</span></code></pre></div>
<pre><code>## [1] NA</code></pre>
<p></p>
</div>
<div id="como-identificar-valores-especiais" class="section level3" number="2.10.3">
<h3 number="2.10.3"><span class="header-section-number">2.10.3</span> Como identificar valores especiais</h3>
<p>Por serem valores especiais, o R nos oferece um conjunto de funções para cada um desses valores especiais, as quais estão listadas abaixo:</p>
<ul>
<li><code>is.na()</code>.</li>
<li><code>is.finite()</code>.</li>
<li><code>is.infinite()</code>.</li>
<li><code>is.nan()</code></li>
</ul>
<p>A função <code>is.finite()</code> busca identificar se um valor numérico é finito, o que significa basicamente, um valor do tipo <code>numeric</code> diferente de <code>Inf</code>, <code>-Inf</code>, <code>NaN</code> e de <code>NA</code>. Perceba abaixo que, quando digo que a função <code>is.finite()</code> busca testar valores numéricos, estou querendo dizer que essa função é irrelevante para testar valores do tipo <code>character</code>, dado que ela nos retorna <code>FALSE</code> para qualquer valor textual. Repare também que essa função nos retorna <code>TRUE</code> para dados do tipo <code>logical</code>, dado que, no fundo, valores do tipo <code>logical</code> são armazenados através de 1’s e 0’s do tipo <code>integer</code>.</p>
<p></p>
<div class="sourceCode" id="cb336"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb336-1"><a href="#cb336-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span>
<span id="cb336-2"><a href="#cb336-2" aria-hidden="true" tabindex="-1"></a>objs <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="cn">Inf</span>, <span class="cn">NaN</span>, <span class="cn">NA</span>, <span class="st">&quot;texto&quot;</span>, <span class="fl">1.25</span>, 1L, <span class="cn">TRUE</span>)</span>
<span id="cb336-3"><a href="#cb336-3" aria-hidden="true" tabindex="-1"></a>r <span class="ot">&lt;-</span> <span class="fu">map_lgl</span>(objs, is.finite)</span>
<span id="cb336-4"><a href="#cb336-4" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(r) <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb336-5"><a href="#cb336-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Inf&quot;</span>, <span class="st">&quot;NaN&quot;</span>, <span class="st">&quot;NA&quot;</span>,</span>
<span id="cb336-6"><a href="#cb336-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;character&quot;</span>, <span class="st">&quot;double&quot;</span>,</span>
<span id="cb336-7"><a href="#cb336-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;integer&quot;</span>, <span class="st">&quot;logical&quot;</span></span>
<span id="cb336-8"><a href="#cb336-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb336-9"><a href="#cb336-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb336-10"><a href="#cb336-10" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(r)</span></code></pre></div>
<pre><code>##       Inf       NaN        NA character    double   integer   logical 
##     FALSE     FALSE     FALSE     FALSE      TRUE      TRUE      TRUE</code></pre>
<p></p>
<p>Ao descobrir o valor <code>NA</code>, você talvez tenha pensado que você seria capaz de identificar esse valor especial por um simples teste de igualdade. Entretanto, como descrevemos na seção <a href="#sec:impactos_valores_especiais">Os impactos desses valores especiais</a>, valores especiais alteram o comportamento de testes lógicos tradicionais, de modo que, um teste de igualdade como <code>x == NA</code> vai sempre resultar em um novo valor <code>NA</code>.</p>
<p></p>
<div class="sourceCode" id="cb338"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb338-1"><a href="#cb338-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb338-2"><a href="#cb338-2" aria-hidden="true" tabindex="-1"></a>x <span class="sc">==</span> <span class="cn">NA</span></span></code></pre></div>
<pre><code>## [1] NA</code></pre>
<p>
Portanto, a forma adequada de se testar se um determinado objeto no R contém um valor <code>NA</code>, é aplicar a função <code>is.na()</code> sobre o objeto em questão. Caso o seu objetivo seja justamente o contrário (isto é, testar se o objeto não contém um valor <code>NA</code>), você precisa apenas inverter o teste lógico ao adicionar o operador <code>!</code> sobre a função.</p>
<p></p>
<div class="sourceCode" id="cb340"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb340-1"><a href="#cb340-1" aria-hidden="true" tabindex="-1"></a><span class="fu">is.na</span>(x)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb342"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb342-1"><a href="#cb342-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fazendo o teste inverso:</span></span>
<span id="cb342-2"><a href="#cb342-2" aria-hidden="true" tabindex="-1"></a><span class="sc">!</span><span class="fu">is.na</span>(x)</span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<p></p>
<p>Já as funções <code>is.infinite()</code> e <code>is.nan()</code> funcionam exatamente da mesma forma, com a diferença que, essas funções testam se o objeto contém valores infinitos (<code>Inf</code> e <code>-Inf</code>) e valores <code>NaN</code>, respectivamente.</p>
<p></p>
<div class="sourceCode" id="cb344"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb344-1"><a href="#cb344-1" aria-hidden="true" tabindex="-1"></a><span class="fu">is.infinite</span>(<span class="cn">Inf</span>)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb346"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb346-1"><a href="#cb346-1" aria-hidden="true" tabindex="-1"></a><span class="fu">is.nan</span>(<span class="cn">NaN</span>)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p></p>
</div>
</div>
<div id="exercícios-1" class="section level2 unnumbered">
<h2 class="unnumbered">Exercícios</h2>
<p><strong>Questão 2.1.</strong> Em cada item desta questão, temos um simples <code>print()</code> de um objeto qualquer. Com base apenas nessa primeira imagem do objeto, tente identificar a estrutura (vetor, matriz, lista, <code>data.frame</code>) na qual esse objeto se encontra:</p>
<p>2.1.A) Objeto 1:</p>
<p></p>
<pre><code>## [[1]]
##  [1]  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15</code></pre>
<p></p>
<p>2.1.B) Objeto 2:</p>
<p></p>
<pre><code>##  [1]  1  2  3  4  5  6  7  8  9 10</code></pre>
<p></p>
<p>2.1.C) Objeto 3:</p>
<p></p>
<pre><code>##      [,1] [,2] [,3] [,4] [,5]
## [1,] &quot;MG&quot; &quot;MG&quot; &quot;DF&quot; &quot;SP&quot; &quot;MG&quot;
## [2,] &quot;MS&quot; &quot;DF&quot; &quot;DF&quot; &quot;SP&quot; &quot;DF&quot;
## [3,] &quot;DF&quot; &quot;DF&quot; &quot;MG&quot; &quot;SP&quot; &quot;MG&quot;
## [4,] &quot;MG&quot; &quot;SP&quot; &quot;MG&quot; &quot;SP&quot; &quot;MG&quot;
## [5,] &quot;SP&quot; &quot;SP&quot; &quot;MG&quot; &quot;DF&quot; &quot;MG&quot;</code></pre>
<p></p>
<p>2.1.D) Objeto 4:</p>
<p></p>
<pre><code>##    id valor
## 1   1 -0.29
## 2   2 -0.30
## 3   3 -0.41
## 4   4  0.25
## 5   5 -0.89
## 6   6  0.44
## 7   7 -1.24
## 8   8 -0.22
## 9   9  0.38
## 10 10  0.13</code></pre>
<p></p>
<p>2.1.E) Objeto 5:</p>
<p></p>
<pre><code>## $estado
## [1] &quot;MG&quot;
## 
## $cidade
## [1] &quot;Belo Horizonte&quot;
## 
## $n_municipios
## [1] 853
## 
## $regiao
## [1] &quot;Sudeste&quot;</code></pre>
<p></p>
<p>2.1.F) Objeto 6:</p>
<p></p>
<pre><code>##  [1] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA</code></pre>
<p></p>
<p><strong>Questão 2.2.</strong> Em cada item abaixo, você deve criar um teste lógico que seja capaz de testar as condições postas no enunciado. Em alguns itens, será fornecido o código necessário para que você crie certos objetos (como <code>v_seq</code>, <code>v_rep</code>, <code>lst</code>, etc.), pois os testes lógicos se baseiam nesses objetos, ou devem ser aplicados diretamente sobre esses objetos. Portanto, lembre-se de copiar o código fornecido pela questão, colar em seu console, e apertar <code>Enter</code> para recriar esses objetos em sua sessão do R.</p>
<p>2.2.A) Crie um teste lógico que seja capaz de identificar quais dos cinco objetos abaixo, são um vetor atômico.</p>
<p></p>
<div class="sourceCode" id="cb354"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb354-1"><a href="#cb354-1" aria-hidden="true" tabindex="-1"></a>      v_seq <span class="ot">&lt;-</span> <span class="dv">10</span><span class="sc">:</span><span class="dv">25</span></span>
<span id="cb354-2"><a href="#cb354-2" aria-hidden="true" tabindex="-1"></a>      v_rep <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="st">&quot;abc&quot;</span>, <span class="at">times =</span> <span class="dv">30</span>)</span>
<span id="cb354-3"><a href="#cb354-3" aria-hidden="true" tabindex="-1"></a>      lst <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span>
<span id="cb354-4"><a href="#cb354-4" aria-hidden="true" tabindex="-1"></a>      mt <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>, <span class="at">nrow =</span> <span class="dv">4</span>, <span class="at">ncol =</span> <span class="dv">5</span>)</span>
<span id="cb354-5"><a href="#cb354-5" aria-hidden="true" tabindex="-1"></a>      dt <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="dv">15</span>, <span class="st">&quot;A&quot;</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span></code></pre></div>
<p></p>
<p>2.2.B) Imagine que você receba em sua sessão do R, o objeto <code>lst</code> abaixo. Tente criar um teste lógico que possa confirmar se esse objeto é uma lista. Pelo código abaixo, você já sabe que este objeto é sim uma lista. Entretanto, nem sempre você terá acesso fácil ao código que criou certo objeto, ou, nem sempre você consegue prever que tipos de objetos serão criados a partir dos comandos escritos por outras pessoas. Por isso, quando você não conhece o <em>input</em> que você vai receber, é sempre importante se basear em teste lógicos que possam lhe assegurar que os seus objetos estão na estrutura desejada.</p>
<p></p>
<div class="sourceCode" id="cb355"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb355-1"><a href="#cb355-1" aria-hidden="true" tabindex="-1"></a>      lst <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb355-2"><a href="#cb355-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">estado =</span> <span class="st">&quot;MG&quot;</span>,</span>
<span id="cb355-3"><a href="#cb355-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">cidade =</span> <span class="st">&quot;Belo Horizonte&quot;</span>,</span>
<span id="cb355-4"><a href="#cb355-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">n_municipios =</span> <span class="dv">853</span>,</span>
<span id="cb355-5"><a href="#cb355-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">regiao =</span> <span class="st">&quot;Sudeste&quot;</span></span>
<span id="cb355-6"><a href="#cb355-6" aria-hidden="true" tabindex="-1"></a>      )</span></code></pre></div>
<p></p>
<p>2.2.C) Utilizando a mesma lista <code>lst</code> do exercício acima, crie um teste lógico capaz de identificar se essa lista possui um item chamado “estado.” Primeiro, aplique o seu teste lógico sobre <code>lst</code>, e confira se o resultado do teste é <code>TRUE</code>. Em seguida, aplique esse mesmo teste lógico sobre a lista <code>lst_sem_estado</code> abaixo, e veja se o resultado do teste é de fato <code>FALSE</code>.</p>
<p></p>
<div class="sourceCode" id="cb356"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb356-1"><a href="#cb356-1" aria-hidden="true" tabindex="-1"></a>      lst_sem_estado <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb356-2"><a href="#cb356-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">regiao =</span> <span class="st">&quot;Sudeste&quot;</span>,</span>
<span id="cb356-3"><a href="#cb356-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">n_municipios =</span> <span class="dv">853</span></span>
<span id="cb356-4"><a href="#cb356-4" aria-hidden="true" tabindex="-1"></a>      )</span></code></pre></div>
<p></p>
<p>2.2.D) Suponha que você possua a tabela <code>tab</code> abaixo. Crie um teste lógico que possa identificar se a coluna <code>total</code> é do tipo <code>double</code>.</p>
<p></p>
<div class="sourceCode" id="cb357"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb357-1"><a href="#cb357-1" aria-hidden="true" tabindex="-1"></a>      tab <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb357-2"><a href="#cb357-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">unidade =</span> <span class="fu">c</span>(<span class="st">&quot;Centro&quot;</span>, <span class="st">&quot;Gameleira&quot;</span>, <span class="st">&quot;Santa Efigênia&quot;</span>, <span class="st">&quot;Centro&quot;</span>,</span>
<span id="cb357-3"><a href="#cb357-3" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&quot;Barro Preto&quot;</span>, <span class="st">&quot;Centro&quot;</span>, <span class="st">&quot;Gameleira&quot;</span>, <span class="st">&quot;Centro&quot;</span>,</span>
<span id="cb357-4"><a href="#cb357-4" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&quot;Barro Preto&quot;</span>, <span class="st">&quot;Santa Efigênia&quot;</span>),</span>
<span id="cb357-5"><a href="#cb357-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">mes =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">4</span>),</span>
<span id="cb357-6"><a href="#cb357-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">vendas =</span> <span class="fu">c</span>(<span class="dv">1502</span>, <span class="dv">1430</span>, <span class="dv">1100</span>, <span class="dv">1200</span>, <span class="dv">1443</span>, <span class="dv">1621</span>, <span class="dv">1854</span>, <span class="dv">2200</span>,</span>
<span id="cb357-7"><a href="#cb357-7" aria-hidden="true" tabindex="-1"></a>                  <span class="dv">1129</span>, <span class="dv">1872</span>),</span>
<span id="cb357-8"><a href="#cb357-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">total =</span> <span class="fu">c</span>(<span class="fl">5362.14</span>, <span class="fl">5105.1</span>, <span class="dv">3927</span>, <span class="dv">4284</span>, <span class="fl">5151.51</span>, <span class="fl">5786.97</span>, </span>
<span id="cb357-9"><a href="#cb357-9" aria-hidden="true" tabindex="-1"></a>                  <span class="fl">6618.78</span>, <span class="dv">7854</span>, <span class="fl">4030.53</span>, <span class="fl">6683.04</span>)</span>
<span id="cb357-10"><a href="#cb357-10" aria-hidden="true" tabindex="-1"></a>      )</span></code></pre></div>
<p></p>
<p>2.2.E) Utilizando a mesma tabela <code>tab</code> acima, crie um teste lógico que possa identificar se a tabela possui exatamente 10 linhas, <strong>E</strong>, se essa tabela possui uma coluna chamada “vendas,” <strong>E</strong>, se a 3° coluna da tabela é do tipo <code>character</code>. Perceba no enunciado desta questão, os E’s separando cada condição a ser testada. Esses E’s estão indicando que essas condições são dependentes, ou, em outras palavras, elas precisam ser satisfeitas ao mesmo tempo.</p>
<p>2.2.F) Se eu te der um número qualquer, referente a um ano específico (por exemplo, 2005 ou 1997), crie um teste lógico capaz de atestar se esse ano fornecido é um ano bissexto. Um ano bissexto é definido pelas seguintes condições: 1) a cada 4 anos, temos um ano bissexto; 2) a cada 100 anos, nós não devemos ter um ano bissexto; 3) a cada 400 anos temos um ano bissexto. Um detalhe: as últimas regras são mais importantes do que as primeiras, ou seja, a regra 3 prevalece sobre as regras 1 e 2, da mesma forma que a regra 2, prevalece sobre a regra 1. Caso essas definições não estejam muito claras, elas basicamente significam o seguinte: 1) o ano deve ser múltiplo de 4; 2) o ano não deve ser múltiplo de 100 a não ser que ele seja múltiplo de 400; 3) se o ano é múltiplo de 400, ele é obrigatoriamente um ano bissexto.</p>
<p><strong>Questão 2.3.</strong> Em cada item abaixo, fornecemos um vetor formado pela função <code>c()</code>. Perceba que em cada um desses vetores, valores de diferentes tipos são misturados. Como definimos na seção <a href="#sec:coercion_R_fundamentos">Coerção no R</a>, quando dados de diferentes tipos são colocados dentro de um vetor atômico, o R automaticamente realiza um processo de coerção, ao converter todos esses dados para um único tipo. O seu objetivo nessa questão é simplesmente adivinhar o tipo (<code>double</code>, <code>integer</code>, <code>logical</code>, ou <code>character</code>) de dado, para o qual esses dados serão convertidos. Caso esteja na dúvida, basta copiar e colar o código em seu console que você terá uma visão do resultado.</p>
<p>2.3.A)</p>
<p></p>
<div class="sourceCode" id="cb358"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb358-1"><a href="#cb358-1" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(<span class="fl">1.2</span>, <span class="fl">2.4</span>, <span class="st">&quot;3.1&quot;</span>, <span class="fl">1.9</span>)</span></code></pre></div>
<p></p>
<p>2.3.B)</p>
<p></p>
<div class="sourceCode" id="cb359"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb359-1"><a href="#cb359-1" aria-hidden="true" tabindex="-1"></a>      integers <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span></span>
<span id="cb359-2"><a href="#cb359-2" aria-hidden="true" tabindex="-1"></a>      doubles <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">2.23</span>, <span class="fl">9.87</span>, <span class="fl">3.2</span>)</span>
<span id="cb359-3"><a href="#cb359-3" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb359-4"><a href="#cb359-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(integers, doubles)</span></code></pre></div>
<p></p>
<p>2.3.C)</p>
<p></p>
<div class="sourceCode" id="cb360"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb360-1"><a href="#cb360-1" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(<span class="fl">1.56</span>, 3L, 1L, 5L,  <span class="fl">2.32</span>, <span class="fl">9.87</span>)</span></code></pre></div>
<p></p>
<p>2.3.D)</p>
<p></p>
<div class="sourceCode" id="cb361"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb361-1"><a href="#cb361-1" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="fl">1.5</span>, <span class="cn">FALSE</span>)</span></code></pre></div>
<p></p>
<p>2.3.E)</p>
<p></p>
<div class="sourceCode" id="cb362"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb362-1"><a href="#cb362-1" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(<span class="st">&quot;p&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>, <span class="cn">TRUE</span>, 2L, <span class="fl">4.318</span>)</span></code></pre></div>
<p></p>
<p><strong>Questão 2.4.</strong> Os próximos exercícios serão voltados para <em>subsetting</em>. Ao longo desses exercícios, estaremos utilizando o <code>data.frame</code> <code>flights</code>, que provêm do pacote <code>nycflights13</code>. Por isso, lembre-se que para ter acesso a essa tabela, é necessário que você chame por esse pacote em sua sessão, com o comando <code>library()</code>. Caso você não tenha o pacote instalado em sua máquina, execute o comando <code>install.packages()</code> mostrado abaixo.</p>
<p></p>
<div class="sourceCode" id="cb363"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb363-1"><a href="#cb363-1" aria-hidden="true" tabindex="-1"></a>      <span class="do">### Caso você não possua o pacote nycflights13</span></span>
<span id="cb363-2"><a href="#cb363-2" aria-hidden="true" tabindex="-1"></a>      <span class="do">### instalado, execute o comando:</span></span>
<span id="cb363-3"><a href="#cb363-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb363-4"><a href="#cb363-4" aria-hidden="true" tabindex="-1"></a>      <span class="do">### install.packages(&quot;nycflights13&quot;)</span></span>
<span id="cb363-5"><a href="#cb363-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb363-6"><a href="#cb363-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">library</span>(nycflights13)</span>
<span id="cb363-7"><a href="#cb363-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb363-8"><a href="#cb363-8" aria-hidden="true" tabindex="-1"></a>      <span class="do">### Após o comando library() você</span></span>
<span id="cb363-9"><a href="#cb363-9" aria-hidden="true" tabindex="-1"></a>      <span class="do">### terá acesso à tabela flights</span></span>
<span id="cb363-10"><a href="#cb363-10" aria-hidden="true" tabindex="-1"></a>      flights</span></code></pre></div>
<p></p>
<p>2.4.A) Encontre todas as linhas da tabela <code>flights</code> em que <code>carrier</code> seja igual a <code>"B6"</code>, e que <code>month</code> seja igual a 5.</p>
<p>2.4.B) Todos os voos descritos na tabela <code>flights</code>, correspondem a voos que ocorreram no aeroporto de Nova York, ao longo do ano de 2013. A coluna <code>dep_delay</code> apresenta o tempo de atraso (em minutos) no momento de partida do aeroporto, e a coluna <code>arr_delay</code> apresenta o tempo de atraso (em minutos) no momento de chegada ao aeroporto. Tendo isso em mente, no ano de 2013, quantos voos obtiveram um tempo de atraso total acima do tempo médio de atraso?</p>
<p>2.4.C) Selecione as linhas da tabela <code>flights</code> que se encaixam em pelo menos uma dessas duas condições: 1) possuem um <code>arr_delay</code> abaixo de 2 minutos, e que o aeroporto de destino (<code>dest</code>) seja <code>"BOS"</code>; 2) cujo horário de partida programado (<code>sched_dep_time</code>) seja de 6:00 (ou <code>600</code>), e que o mês de ocorrência do voô seja igual a 1.</p>
<!--chapter:end:02-fundamentos.Rmd-->
</div>
</div>
<div id="part-importando-organizando-e-transformando-dados" class="section level1 unnumbered">
<h1 class="unnumbered">(PART) Importando, organizando e transformando dados</h1>
</div>
<div id="introduzindo-o-universo-do-tidyverse" class="section level1" number="3">
<h1 number="3"><span class="header-section-number">3</span> Introduzindo o universo do <code>tidyverse</code></h1>
<p>Os próximos capítulos buscam introduzir os diversos pacotes que compõe o <em>core</em> (ou o centro) do universo do <code>tidyverse</code>. Em suma, o <code>tidyverse</code> é uma coleção de pacotes que compartilham de uma mesma filosofia, gramática e estrutura de dados, de modo que, ao aprender um de seus pacotes você tem mais facilidade de aprender o próximo deles <span class="citation">(<a href="#ref-wickham2019" role="doc-biblioref">Wickham et al. 2019</a>)</span>. Em outras palavras, cada um dos diferentes pacotes inclusos no <code>tidyverse</code> é focado em uma atividade específica (importação, transformação, formatação, visualização, etc.), porém, todos eles compartilham de uma mesma “base,” de forma que, juntos, esses pacotes se complementam.</p>
<p>Grande parte da filosofia do universo <code>tidyverse</code> é tornar a análise de dados no R mais rápida e prática. Nesse sentido, o <code>tidyverse</code> se assemelha e muito ao principal módulo da linguagem Python voltado para análise de dados, o <code>pandas</code>. Uma outra parte importante da filosofia do <code>tidyverse</code> está intrinsicamente conectada ao fluxo da ciência de dados introduzido por <span class="citation"><a href="#ref-wickham2017" role="doc-biblioref">Wickham and Grolemund</a> (<a href="#ref-wickham2017" role="doc-biblioref">2017</a>)</span>. Esse fluxo está reproduzido na figura 3.1. A ideia básica desse fluxo, é que todo projeto de análise de dados pode ser resumido a produção de um programa que executa 6 etapas específicas. Perceba que, eu listei (em azul escuro) os nomes dos pacotes geralmente empregados em cada uma dessas 6 etapas desse fluxo. Parte desses pacotes listados não serão descritos nessa obra e, portanto, estão apenas como referências no fluxo.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/ciclo.png" alt="Fluxo de trabalho da ciência de dados" width="100%" />
<p class="caption">
(#fig:unnamed-chunk-158)Fluxo de trabalho da ciência de dados
</p>
</div>
<p></p>
<p>Portanto, seguindo o fluxo, para que você possa realizar qualquer análise sobre um conjunto qualquer de dados, você precisa primeiro, importar essa base de dados para dentro do R. Ou seja, você precisa tornar esse conjunto de dados acessível ao R. Por isso, o fluxo se inicia com a etapa “Importar.” Em seguida, temos a etapa “Arrumar,” onde você geralmente aplica diversas correções e preenchimentos sobre esse conjunto de dados. Pois são extremamente raros os casos em que uma base de dados chega a você, no exato formato que você precisa para a sua análise e, por isso, você quase sempre precisa gastar um certo tempo “arrumando” essa base.</p>
<p>Após arrumar sua base de dados, você em geral inicia um ciclo de análises, o qual envolve quase sempre 3 etapas: “Transformar,” “Visualizar” e “Modelar”: você adiciona novas colunas, filtra as observações de seu interesse, calcula certos indicadores e produz estatísticas sumárias desses dados. Depois, você visualiza esses resultados em algum gráfico, para que você possa visualizar e identificar padrões e características que os seus dados carregam. Mais tarde, ao conter uma compreensão melhor de seus dados, você começa a aplicar modelos que possam explicar esses padrões. Porém, talvez o primeiro modelo que você aplique se mostre ineficiente e, por essa razão, você acaba aplicando novas transformações e ajustes, calculando novos indicadores e filtrando novas observações com o objetivo de gerar melhores visualizações e modelos desses dados, reiniciando assim o ciclo.</p>
<p>Dentro desse ciclo, haverá um momento em que você vai chegar ao modelo desejado, e com ele, às conclusões de sua análise. Após ter essas conclusões em mãos, você provavelmente deseja publicar ou apresentar esses resultados para um público específico. A partir daí temos a etapa “Comunicar,” que conciste em produzir artigos, apresentações e materiais pelos quais você é capaz de descrever e apresentar concisamente os seus resultados. Finalizando assim, o fluxo da ciência de dados.</p>
<div id="os-diferentes-pacotes-do-tidyverse" class="section level2" number="3.1">
<h2 number="3.1"><span class="header-section-number">3.1</span> Os diferentes pacotes do <code>tidyverse</code></h2>
<p>A lista abaixo contém os pacotes que formam o <em>core</em> do <code>tidyverse</code>. Para cada pacote, temos uma breve descrição de sua especialidade. Não se preocupe em entender exatamente o que eles fazem, pois isso ficará mais claro a medida em que você caminhar por este livro.</p>
<ol style="list-style-type: decimal">
<li><p><code>ggplot2</code>: visualização de dados, ou produção de gráficos.</p></li>
<li><p><code>dplyr</code>: verbos para manipulação de tabelas.</p></li>
<li><p><code>readr</code>: importação e exportação de dados em arquivos de texto.</p></li>
<li><p><code>tibble</code>: <code>data.frame</code>’s modernos.</p></li>
<li><p><code>stringr</code>: manipulação de texto (<code>character</code>).</p></li>
<li><p><code>forcats</code>: trabalhando com fatores (<code>factor</code>).</p></li>
<li><p><code>tidyr</code>: formatar e limpar os seus dados.</p></li>
<li><p><code>purrr</code>: repita você mesmo com <em>functional programming</em>.</p></li>
</ol>
</div>
<div id="acessando-o-tidyverse" class="section level2" number="3.2">
<h2 number="3.2"><span class="header-section-number">3.2</span> Acessando o <code>tidyverse</code></h2>
<p>Portanto, o <code>tidyverse</code> nada mais é do que um pacote que estende as funcionalidades do R, ao trazer junto dele, um conjunto de importantes pacotes que vão facilitar e muito o seu trabalho. Para ter acesso a qualquer pacote no R, você precisa primeiro, se certificar que este pacote está instalado no seu computador. Para instalar um determinado pacote em sua máquina, você deve executar a função <code>install.packages()</code>, com o nome do pacote desejado entre aspas.</p>
<p></p>
<div class="sourceCode" id="cb364"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb364-1"><a href="#cb364-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;tidyverse&quot;</span>)</span></code></pre></div>
<p></p>
<p>Você realiza essa etapa apenas uma vez, ou então, sempre que você troca de computador, ou quando você atualiza a sua versão do R. Após instalar o pacote, você precisa apenas “chamar” por ele, através da função <code>library()</code>. Essa etapa deve ser feita sempre que você inicia o R, e deseja utilizar as funcionalidades deste pacote.</p>
<p>Ao executar o comando <code>library(tidyverse)</code>, uma caixa vai aparecer, contendo uma lista de todos os principais pacotes importados para a sua sessão. Os símbolos verdes de “v” no início do nome de cada pacote, nos indica que ele foi corretamente anexado à nossa sessão atual do R. Na parte inferior dessa caixa, temos uma lista de conflitos (<em>Conflicts</em>). Essa caixa está apenas listando quais funções do <code>tidyverse</code> possuem o mesmo nome de alguma função que já está presente em sua sessão atual do R.</p>
<p>Ou seja, a parte inferior dessa caixa não é um erro, mas sim uma mensagem lhe indicando quais funções possuem um “irmão bastardo,” que está presente em sua sessão. Quase sempre, as funções do pacote <code>tidyverse</code> vão estar a frente dessa função “bastarda,” logo, quando você chamar por essa função, você vai estar utilizando a função do <code>tidyverse</code>, ao invés da função “bastarda.” De qualquer forma, apenas entenda que, ao executar o comando <code>library()</code>, se aparecer uma caixa como a da imagem abaixo, você tem acesso aos pacotes do <code>tidyverse</code> em sua sessão do R e, que com isso, você está pronto para continuar.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/tidyverse.png" alt="Chamando pelo pacote `tidyverse`" width="90%" />
<p class="caption">
(#fig:unnamed-chunk-160)Chamando pelo pacote <code>tidyverse</code>
</p>
</div>
<p></p>
<!--chapter:end:03-tidyverse.Rmd-->
</div>
</div>
<div id="importando-e-exportando-dados-com-readr-readxl-e-haven" class="section level1" number="4">
<h1 number="4"><span class="header-section-number">4</span> Importando e exportando dados com <code>readr</code>, <code>readxl</code> e <code>haven</code></h1>
<div id="sec:importando_dados" class="section level2" number="4.1">
<h2 number="4.1"><span class="header-section-number">4.1</span> Introdução e pré-requisitos</h2>
<p>Em algum ponto, você vai trabalhar com os seus próprios dados no R e, para isso, você precisa obrigatoriamente importar esses dados para dentro do R. Neste capítulo, vamos aprender como utilizar as funções dos pacotes <code>readr</code>, <code>readxl</code> e <code>haven</code>, para ler e importar dados presentes em arquivos de texto (<em>plain text files</em> - <code>.txt</code> ou <code>.csv</code>), em planilhas do Excel (<code>.xlsx</code>) e em arquivos produzidos por programas estatísticos como o Stata (<code>.dta</code>), SPSS (<code>.sav</code>; <code>.zsav</code> e <code>.por</code>) e SAS (<code>.sas</code>).</p>
<p>Para que você tenha acesso as funções e possa acompanhar os exemplos desse capítulo você precisa chamar pelos pacotes <code>readr</code>, <code>readxl</code> e <code>haven</code>, através do comando <code>library()</code>. O pacote <code>readr</code> especificamente, está incluso dentro do <code>tidyverse</code> e, por isso, você também pode chamar por ele.</p>
<p></p>
<div class="sourceCode" id="cb365"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb365-1"><a href="#cb365-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb365-2"><a href="#cb365-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb365-3"><a href="#cb365-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb365-4"><a href="#cb365-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb365-5"><a href="#cb365-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(haven)</span></code></pre></div>
<p></p>
</div>
<div id="fontes-de-dados" class="section level2" number="4.2">
<h2 number="4.2"><span class="header-section-number">4.2</span> Fontes de dados</h2>
<p>Os seus dados podem vir de diferentes tipos de fontes. Com isso, os métodos necessários para acessar e importar esses dados para o R, mudam. Em resumo, os seus dados podem provir de três tipos de fontes diferentes:</p>
<ol style="list-style-type: decimal">
<li><p>Arquivo estático salvo no disco rígido de seu computador.</p></li>
<li><p>Servidor local ou <em>online</em>.</p></li>
<li><p>Página da internet.</p></li>
</ol>
<p>Nós normalmente transportamos os nossos dados através de um arquivo estático, que pode ser salvo em nosso computador. Por isso, ao importar os nossos dados para o R, vamos estar preocupados na grande maioria das vezes, em ler um arquivo que se encontra salvo em nosso computador. Por este motivo, os métodos que serão mostrados nesse capítulo, buscam ler e importar diferentes tipos de arquivos estáticos. Em um processo como esse, a localização desse arquivo no disco rígido é um fator importante. Além disso, diferentes tipos de arquivos são estruturados de maneiras distintas e, por essa razão, você vai precisar de uma função no R que seja capaz de ler esse tipo de arquivo, ou em outras palavras, que seja capaz de reconhecer a estrutura desse arquivo.</p>
<p>Por outro lado, se você está importando os seus dados a partir de um servidor, você muito provavelmente estará extraindo dados de um DBMS (<em>database management system</em>). Os sistemas DBMS mais famosos e mais utilizados no mundo, são os sistemas que utilizam a linguagem SQL (<em>Structured Query Language</em>). Para extrair um conjunto de dados desse tipo de fonte, você em geral necessita de uma chave, ou uma API (<em>Application Programming Interface</em>) que lhe garanta acesso ao servidor e, portanto, acesso aos dados que você deseja importar. Esse processo de importação não será tratado aqui, mas você vai precisar das funções disponíveis em pacotes como <code>jsonlite</code>, <code>odbc</code> e <code>DBI</code> para tal processo.</p>
<p>Além dessas alternativas, você pode estar interessado em coletar dados de uma página da internet. Não estou me referindo a um arquivo estático que esteja disponível para <em>download</em> através dessa página da internet, mas sim, de coletar o conteúdo dessa página, de coletar os dados que formam a própria página da internet em si. Esse tipo de coleta, e os métodos envolvidos nesse processo, são comumente chamados de <em>web scraping</em>, e hoje, representam uma área importante em análise de dados. Esse processo de importação também não será mostrado aqui, mas você pode consultar as funções dos pacotes <code>httr</code>, <code>xml2</code> e <code>rvest</code> para executar tal processo.</p>
</div>
<div id="diretório-de-trabalho" class="section level2" number="4.3">
<h2 number="4.3"><span class="header-section-number">4.3</span> Diretório de trabalho</h2>
<p>A linguagem R possui uma forte noção de diretórios de trabalho <span class="citation">(<a href="#ref-wickham2017" role="doc-biblioref">Wickham and Grolemund 2017</a>, p 113)</span>. O diretório de trabalho (<em>working directory</em>) é o local de seu computador onde o R vai procurar pelos arquivos que você demanda, e será onde o R vai guardar todos os arquivos que você pede a ele que salve.</p>
<p>Isso significa que em todas as ocasiões em que você estiver no R, ele estará trabalhando com alguma pasta específica de seu computador. No RStudio, você pode identificar o seu diretório de trabalho atual na parte esquerda e superior do console, logo abaixo do nome de sua guia (<code>Console</code>), como mostrado na figura 3.1. Repare abaixo, que no momento em que a foto presente na figura 3.1 foi tirada, eu estava trabalhando com uma pasta de meu computador chamada <code>Curso-R</code>, que por sua vez, se encontrava dentro de uma pasta chamada <code>Projeto curso R</code>.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/diretorio_console.png" alt="Diretório de trabalho - Console RStudio" width="70%" />
<p class="caption">
(#fig:unnamed-chunk-162)Diretório de trabalho - Console RStudio
</p>
</div>
<p></p>
<p>Nós também podemos descobrir o diretório de trabalho atual em nossa sessão do R, através da função <code>getwd()</code>.</p>
<p></p>
<div class="sourceCode" id="cb366"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb366-1"><a href="#cb366-1" aria-hidden="true" tabindex="-1"></a><span class="fu">getwd</span>()</span></code></pre></div>
<p></p>
<pre><code>## [1] &quot;C:/Users/Pedro/Documents/Projeto curso R/Curso-R&quot;</code></pre>
<p>Dessa forma, supondo que o meu diretório de trabalho atual seja a pasta <code>Curso-R</code>, se eu pedir por algum arquivo chamado <code>frase.txt</code>, o R vai procurar por esse arquivo dentro dessa pasta <code>Curso-R</code>. Isso tem duas implicações muito importantes. Primeiro, o arquivo <code>frase.txt</code> deve estar dentro dessa pasta <code>Curso-R</code>, caso contrário o R não poderá encontrar o arquivo. Segundo, temos uma maneira muito simples e poderosa de acessarmos qualquer arquivo que esteja presente na pasta <code>Curso-R</code>, pois precisamos apenas do nome desse arquivo, como no exemplo abaixo.</p>
<p></p>
<div class="sourceCode" id="cb368"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb368-1"><a href="#cb368-1" aria-hidden="true" tabindex="-1"></a><span class="fu">read_lines</span>(<span class="st">&quot;frase.txt&quot;</span>)</span></code></pre></div>
<p></p>
<p></p>
<pre><code>## [1] &quot;Aristóteles foi um filósofo da Grécia Antiga&quot;</code></pre>
<p></p>
<p>Um ponto muito importante é que a extensão do arquivo (que traduz o seu tipo) também faz parte do nome do arquivo. No exemplo acima, o arquivo se chama <code>frase</code> e possui a extensão <code>.txt</code>, logo, o nome do arquivo a ser fornecido ao R é <code>frase.txt</code>.</p>
</div>
<div id="sec:enderecos_disco_rigido" class="section level2" number="4.4">
<h2 number="4.4"><span class="header-section-number">4.4</span> Definindo endereços do disco rígido no R</h2>
<p>Portanto, o mecanismo de diretórios de trabalho apenas limita o escopo de busca do R. Dito de outra forma, ele define onde o R irá procurar pelos seus arquivos e, onde esses arquivos serão salvos através do R. Entretanto, isso não quer dizer que você não possa acessar arquivos que se encontram em outras áreas do seu computador. Porém, para acessarmos qualquer arquivo que esteja fora de seu diretório de trabalho atual, nós precisamos obrigatoriamente fornecer o endereço até esse arquivo para o R.</p>
<div id="cuidados-ao-definir-endereços" class="section level3" number="4.4.1">
<h3 number="4.4.1"><span class="header-section-number">4.4.1</span> Cuidados ao definir endereços</h3>
<p>Alguns cuidados no R são necessários ao definir um endereço até um arquivo. Primeiro, endereços de seu disco rígido devem sempre ser fornecidos como textos (<em>strings</em>), por isso, lembre-se de contornar o seu endereço com aspas duplas ou simples no R. Segundo, o Windows utiliza por padrão a barra inclinada à esquerda (<code>\</code>) para separar cada diretório presente no caminho até um certo arquivo. Todavia, a barra inclinada à esquerda possui um significado especial para o R.</p>
<p>Abordando especificamente o segundo ponto, você tem duas alternativas para contornar as particularidades das barras inclinadas utilizadas nos endereços de seus arquivos: 1) utilizar o estilo dos sistemas Mac e Linux, que utilizam a barra inclinada à direita (<code>/</code>) para separar os diretórios; 2) ou contornar o comportamento especial de uma barra inclinada à esquerda, com duas barras inclinadas à esquerda (<code>\\</code>). Ou seja, é como se essas duas barras <code>\\</code> significassem apenas uma barra <code>\</code> para o R. Eu particularmente prefiro utilizar o estilo dos sistemas Mac e Linux para resolver esse problema, pois ele incorre em um trabalho menor de digitação.</p>
<p>Por exemplo, eu possuo um arquivo chamado <code>livros.txt</code> localizado dentro da pasta <code>Lista de compras</code>, que por sua vez, se encontra dentro da minha pasta de <code>Documentos</code> do Windows. Segundo o padrão do Windows, o endereço até esse arquivo seria: <code>"C:\Users\Pedro\Documents\Lista de compras\livros.txt"</code>. Porém, levando-se em conta os pontos que acabamos de abordar, nós poderíamos fornecer um dos dois endereços abaixo para me referir a este arquivo no R:</p>
<p></p>
<div class="sourceCode" id="cb370"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb370-1"><a href="#cb370-1" aria-hidden="true" tabindex="-1"></a>livros <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;C:</span><span class="sc">\\</span><span class="st">Users</span><span class="sc">\\</span><span class="st">Pedro</span><span class="sc">\\</span><span class="st">Documents</span><span class="sc">\\</span><span class="st">Lista de compras</span><span class="sc">\\</span><span class="st">livros.txt&quot;</span>)</span>
<span id="cb370-2"><a href="#cb370-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb370-3"><a href="#cb370-3" aria-hidden="true" tabindex="-1"></a>livros <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;C:/Users/Pedro/Documents/Lista de compras/livros.txt&quot;</span>)</span></code></pre></div>
<p></p>
<p></p>
<div class="sourceCode" id="cb371"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb371-1"><a href="#cb371-1" aria-hidden="true" tabindex="-1"></a>livros</span></code></pre></div>
<pre><code>## # A tibble: 4 x 3
##   Titulo                               Autor                          Preco
##   &lt;chr&gt;                                &lt;chr&gt;                          &lt;dbl&gt;
## 1 O Hobbit                             J. R. R. Tolkien                40.7
## 2 Matemática para Economistas          Carl P. Simon e Lawrence Blume 140. 
## 3 Microeconomia: uma Abordagem Moderna Hal R. Varian                  141. 
## 4 A Luneta Âmbar                       Philip Pullman                  42.9</code></pre>
<p></p>
</div>
<div id="endereços-relativos-e-absolutos" class="section level3" number="4.4.2">
<h3 number="4.4.2"><span class="header-section-number">4.4.2</span> Endereços relativos e absolutos</h3>
<p>A depender do seu diretório de trabalho atual, e de onde o seu arquivo de interesse se encontra, você pode utilizar dois estilos diferentes de endereços (relativo e absoluto) para se referir a um dado arquivo. Vamos utilizar como exemplo, o conjunto de arquivos mostrados na figura 3.2 que se encontram dentro de uma pasta chamada <code>Dados</code>.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/arquivos.png" alt="Exemplo de arquivos" width="80%" />
<p class="caption">
(#fig:unnamed-chunk-169)Exemplo de arquivos
</p>
</div>
<p></p>
<p>Caso o seu diretório de trabalho atual fosse, por exemplo, a pasta <code>Projeto curso R</code>, você poderia fornecer um endereço relativo para qualquer um desses arquivos presentes na pasta <code>Dados</code>. Pois a pasta <code>Dados</code> se encontra dentro da pasta <code>Projeto curso R</code>. Em outras palavras, a pasta <code>Dados</code> é uma subpasta da pasta <code>Projeto curso R</code>.</p>
<p>Logo, um endereço relativo possui como ponto inicial, o seu diretório de trabalho atual. Por isso, você pode acessar qualquer arquivo que esteja dentro de seu diretório de trabalho, ou dentro de alguma de suas subpastas, através de um endereço relativo. No caso dos arquivos da pasta <code>Dados</code>, nós poderíamos fornecer o endereço <code>"Curso-R/Dados/"</code> para chegarmos a pasta <code>Dados</code>. Em seguida, precisaríamos apenas acrescentar o nome do arquivo de nosso desejo. Por exemplo, se fôssemos ler o arquivo de nome <code>covid.csv</code>, o endereço resultante seria <code>"Curso-R/Dados/covid.csv"</code>.</p>
<p>Por outro lado, se o seu diretório de trabalho atual for uma pasta posterior à pasta <code>Dados</code> (ou seja, uma subpasta da pasta <code>Dados</code>), e você quiser acessar um dos arquivos da pasta <code>Dados</code>, você terá que fornecer um endereço absoluto até o arquivo em questão. Um endereço absoluto é um endereço que parte desde o disco rígido de seu computador até o arquivo de interesse. Por isso, um endereço absoluto sempre aponta para o mesmo local de seu computador, independente de qual seja o seu diretório de trabalho atual.</p>
<p>Para coletarmos o endereço absoluto de um arquivo no Windows, podemos clicar com o botão direito do mouse sobre o arquivo de interesse, e selecionar a opção <code>Propriedades</code>. Uma caixa vai abrir em sua tela, contendo diversas informações sobre o arquivo em questão. Logo a sua frente, temos a seção chamada <code>Local</code> na parte inicial dessa caixa, onde podemos encontrar o endereço absoluto até a pasta onde o seu arquivo de interesse está localizado.</p>
<p>Logo, se eu utilizasse esse recurso sobre um dos arquivos mostrados na figura 3.2, eu encontraria o seguinte endereço nessa seção <code>Local</code>: <code>"C:\Users\Pedro\Documents\Projeto curso R\Curso-R\Dados"</code>. Com esse endereço, precisamos apenas adicionar o nome do arquivo desejado, e ajustar as barras inclinadas à esquerda de acordo com as alternativas apresentadas na seção anterior. Por exemplo, se o nosso arquivo de interesse fosse o <code>covid.csv</code>, o endereço absoluto a ser fornecido ao R seria: <code>"C:/Users/Pedro/Documents/Projeto curso R/Curso-R/Dados/covid.csv"</code>.</p>
<p>Segundo <span class="citation"><a href="#ref-wickham2017" role="doc-biblioref">Wickham and Grolemund</a> (<a href="#ref-wickham2017" role="doc-biblioref">2017</a>)</span>, é recomendável que você evite endereços absolutos, especialmente se você trabalha em conjunto. Pois é muito provável que os computadores de seus parceiros de trabalho não possuem exatamente a mesma estrutura de diretórios que o seu computador. Por isso, o ideal é que você sempre organize todos os arquivos referentes a um certo projeto ou a uma certa análise, dentro de uma pasta específica de seu computador. Dessa forma, você pode tornar essa pasta específica o seu diretório de trabalho no R, e a partir daí, fornecer endereços relativos até cada arquivo.</p>
</div>
</div>
<div id="plataforma-de-projetos-do-rstudio" class="section level2" number="4.5">
<h2 number="4.5"><span class="header-section-number">4.5</span> Plataforma de Projetos do RStudio</h2>
<p>No R, você pode configurar o seu diretório de trabalho atual, através da função <code>setwd()</code>. Basta fornecer o endereço absoluto até a pasta com a qual você deseja trabalhar. Veja o exemplo abaixo, em que eu escolho a pasta de <code>Documentos</code> do Windows como o meu diretório de trabalho:</p>
<p></p>
<div class="sourceCode" id="cb373"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb373-1"><a href="#cb373-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(<span class="st">&quot;C:/Users/Pedro/Documents&quot;</span>)</span></code></pre></div>
<p></p>
<p>Porém, esse não é um método recomendado de se configurar o seu diretório de trabalho, especialmente porque nós precisamos realizar essa configuração toda vez em que acessamos o R, sendo algo contraproducente. Por isso, <span class="citation"><a href="#ref-wickham2017" role="doc-biblioref">Wickham and Grolemund</a> (<a href="#ref-wickham2017" role="doc-biblioref">2017</a>)</span> caracterizam a plataforma de Projetos do RStudio, como uma forma mais adequada e eficiente de realizarmos essa configuração.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/projetos_menu.png" alt="Plataforma de Projetos do RStudio - Parte 1" width="75%" />
<p class="caption">
(#fig:unnamed-chunk-171)Plataforma de Projetos do RStudio - Parte 1
</p>
</div>
<p></p>
<p>Ao criar um projeto no RStudio, você está apenas criando um arquivo com o nome desse projeto e que possui uma extensão <code>.Rproj</code>. Esse arquivo <code>.Rproj</code> funciona como um link até a pasta onde você o guardou. Dessa forma, ao acessarmos esse projeto no RStudio, o seu console já vai estar trabalhando com a pasta onde o arquivo <code>.Rproj</code> foi salvo. Em termos técnicos, toda vez que você acessar esse projeto, o RStudio vai automaticamente configurar essa pasta como o seu diretório de trabalho atual do R.</p>
<p>Para criarmos um projeto no RStudio, você pode acessar um pequeno menu localizado na parte superior e direita de sua tela, mostrado na figura 3.3. Ao selecionar a opção <code>New Project...</code>, o seu RStudio vai abrir uma aba que está exposta na figura 3.4. Nessa aba, você vai selecionar como deseja criar o novo arquivo <code>.Rproj</code>. Caso você já tenha organizado todos os arquivos de seu projeto uma pasta específica, você pode selecionar a opção <code>Existing Directory</code> para salvar o arquivo <code>.Rproj</code> nessa pasta já existente. Por outro lado, caso você esteja iniciando a sua análise do zero, você pode selecionar a opção <code>New Directory</code> para criar um novo diretório em seu computador, onde você vai guardar todos os arquivos referentes ao seu projeto.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/projetos_caixa.png" alt="Plataforma de Projetos do RStudio - Parte 2" width="70%" />
<p class="caption">
(#fig:unnamed-chunk-172)Plataforma de Projetos do RStudio - Parte 2
</p>
</div>
<p></p>
<p>Ao selecionar uma dessas opções, o RStudio também vai lhe questionar sobre o tipo desse projeto, ou dito de outra maneira, qual o tipo de produto que você busca gerar com esse projeto, através da aba mostrada na figura 3.5. Ou seja, se você está planejando construir um novo pacote para o R, é interessante que você selecione a segunda opção (<code>R Package</code>) dessa aba. Pois assim, o próprio RStudio vai automaticamente criar para você, os principais arquivos que um pacote do R precisa ter. Em geral, você vai selecionar a primeira opção (<code>New Project</code>) para criar um projeto padrão.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/tipo_projeto_mod.png" alt="Plataforma de Projetos do RStudio - Parte 3" width="70%" />
<p class="caption">
(#fig:unnamed-chunk-173)Plataforma de Projetos do RStudio - Parte 3
</p>
</div>
<p></p>
<p>No exemplo apresentado pela figura 3.6, eu estou criando um projeto padrão chamado <code>projeto_mortalidade</code> na pasta <code>Desktop</code> (que corresponde a área de trabalho) de meu computador. Com isso, uma nova pasta chamada <code>projeto_mortalidade</code> será criada, e sempre que eu acessar novamente o projeto <code>projeto_mortalidade</code> no RStudio, através do pequeno menu mostrado na figura 3.3, o RStudio vai automaticamente configurar a pasta <code>projeto_mortalidade</code> como o diretório de trabalho atual do R.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/diretorio_projeto.png" alt="Plataforma de Projetos do RStudio - Parte 4" width="70%" />
<p class="caption">
(#fig:unnamed-chunk-174)Plataforma de Projetos do RStudio - Parte 4
</p>
</div>
<p></p>
</div>
<div id="importando-arquivos-de-texto-com-readr" class="section level2" number="4.6">
<h2 number="4.6"><span class="header-section-number">4.6</span> Importando arquivos de texto com <code>readr</code></h2>
<p>Arquivos de texto, também conhecidos como <em>plain text files</em>, ou <em>flat files</em>, estão entre os formatos de arquivo mais utilizados em todo o mundo para transportar e armazenar dados. Por isso é muito importante que você conheça esses arquivos e saiba reconhecê-los.</p>
<p>Um arquivo de texto, normalmente assume a extensão <code>.txt</code>, e contém apenas cadeias de textos ou cadeias de valores numéricos que são organizados em linhas. Apesar de simples, os dados armazenados podem ser organizados de diferentes formas em cada linha do arquivo. Por essa razão, um arquivo de texto pode assumir diferentes extensões que identificam o tipo de arquivo de texto ao qual ele pertence.</p>
<p>Em outras palavras, nós possuímos diferentes tipos de arquivos de texto, e a diferença básica entre eles, está na forma como os valores são organizados em cada linha do arquivo. Um dos tipos de arquivo de texto mais famosos é o arquivo CSV (<em>comma separated file</em>), que utiliza vírgulas (ou pontos e vírgulas como é o caso brasileiro) para separar os valores de diferentes colunas em cada linha do arquivo. Por isso, não basta que você identifique se o seu arquivo de interesse é um arquivo de texto, pois você também precisa identificar o <strong>tipo</strong> de arquivo de texto no qual ele se encaixa.</p>
<p>Para importarmos os dados presentes nesses arquivos, vamos utilizar as funções do pacote <code>readr</code>, que oferece um conjunto de funções especializadas em arquivos de texto. Logo abaixo, temos uma lista que associa os respectivos tipos de arquivos de texto a cada uma das funções desse pacote.</p>
<ol style="list-style-type: decimal">
<li><p><code>read_delim()</code>: essa é uma função geral, que é capaz de ler qualquer tipo de arquivo de texto em que os valores estão delimitados por algum caractere especial.</p></li>
<li><p><code>read_csv2()</code>: lê arquivos CSV (<em>comma separated file</em>) que seguem o padrão adotado por alguns países europeus. Arquivos <code>.txt</code> ou <code>.csv</code>, em que os valores são separados por ponto e vírgula (;).</p></li>
<li><p><code>read_csv()</code>: lê arquivos CSV (<em>comma separated file</em>) que seguem o padrão americano. Arquivos <code>.txt</code> ou <code>.csv</code> onde os valores são separados por vírgula (,).</p></li>
<li><p><code>read_tsv()</code>: lê arquivos TSV (<em>tab separated values</em>). Arquivos <code>.txt</code> ou <code>.tsv</code> onde os valores são separados por tabulação (<code>\t</code>).</p></li>
<li><p><code>read_fwf()</code>: lê arquivos FWF (<em>fixed width file</em>). Arquivos <code>.txt</code> ou <code>.fwf</code> onde cada coluna do arquivo possui uma largura fixa de valores.</p></li>
</ol>
<p>Perceba que o nome de todas as funções acima segue o padrão <code>read_*()</code>, onde a palavra presente no ponto <code>*</code> corresponde a extensão que identifica o tipo de arquivo no qual a função é especializada. Nós sempre iniciamos qualquer uma das funções acima, pelo endereço até o arquivo que desejamos ler. Como exemplo inicial, eu possuo um arquivo CSV chamado <code>Censo_2010.csv</code>, que se encontra dentro da pasta <code>6 - Importacao</code>.</p>
<p></p>
<div class="sourceCode" id="cb374"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb374-1"><a href="#cb374-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb374-2"><a href="#cb374-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb374-3"><a href="#cb374-3" aria-hidden="true" tabindex="-1"></a>Censo_2010 <span class="ot">&lt;-</span> <span class="fu">read_csv2</span>(<span class="st">&quot;Parte 1/6 - Importacao/Censo_2010.csv&quot;</span>)</span></code></pre></div>
<p></p>
<pre><code>## ‐‐ Column specification ‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐
## cols(
## `Região metropolitana` = col_character(),
## `População residente` = col_double(),
## `População em área urbana` = col_double(),
## `População em área não urbanizada` = col_double(),
## `População em área isolada` = col_double(),
## `Área rural` = col_double(),
## `Aglomerado urbano` = col_double(),
## Povoado = col_double(),
## Núcleo = col_double(),
## `Outros aglomerados` = col_double(),
## `Código unidade` = col_double()
## )
</code></pre>
<p>Perceba também no exemplo acima, que eu salvo o resultado da função <code>read_csv2()</code> em um objeto chamado <code>Censo_2010</code>. Isso é muito importante! Lembre-se sempre de salvar o resultado das funções <code>read_*()</code> em algum objeto. Pois a função <code>read_csv2()</code> busca apenas ler o arquivo <code>Censo_2010.csv</code> e encaixar o seu conteúdo em uma tabela (ou um <code>data.frame</code>) do R. Ou seja, em nenhum momento, a função <code>read_csv2()</code> se preocupa em salvar os dados que ela coletou do arquivo <code>Censo_2010.csv</code>, em algum lugar que podemos acessar futuramente. É por essa razão, que eu salvo a tabela gerada pela função <code>read_csv2()</code> em um objeto. Pois dessa forma, eu posso acessar novamente os dados que coletamos do arquivo <code>Censo_2010.csv</code>, através do objeto <code>Censo_2010</code>.</p>
<p></p>
<div class="sourceCode" id="cb376"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb376-1"><a href="#cb376-1" aria-hidden="true" tabindex="-1"></a>Censo_2010</span></code></pre></div>
<pre><code>## # A tibble: 2,013 x 11
##    `Região metropol~ `População resid~ `População em ár~ `População em áre~
##    &lt;chr&gt;                         &lt;dbl&gt;             &lt;dbl&gt;              &lt;dbl&gt;
##  1 Manaus  AM                  2106322           1972885               3011
##  2 Homens                      1036676            964041               2018
##  3 Mulheres                    1069646           1008844                993
##  4 Careiro da Várzea             23930              1000                 NA
##  5 Homens                        12688               481                 NA
##  6 Mulheres                      11242               519                 NA
##  7 Iranduba                      40781             28979                 NA
##  8 Homens                        20996             14662                 NA
##  9 Mulheres                      19785             14317                 NA
## 10 Itacoatiara                   86839             57863                294
## # ... with 2,003 more rows, and 7 more variables:
## #   População em área isolada &lt;dbl&gt;, Área rural &lt;dbl&gt;,
## #   Aglomerado urbano &lt;dbl&gt;, Povoado &lt;dbl&gt;, Núcleo &lt;dbl&gt;,
## #   Outros aglomerados &lt;dbl&gt;, Código unidade &lt;dbl&gt;</code></pre>
<p></p>
<p>Mesmo que o arquivo <code>Censo_2010.csv</code> seja claramente um arquivo CSV, nós precisamos identificar qual o padrão que ele está adotando. Nos EUA, um arquivo CSV utiliza vírgulas (<code>,</code>) para separar os valores de cada coluna. Porém, pelo fato de nós, brasileiros, usarmos a vírgula para delimitar casas decimais em números reais, nós empregamos o padrão de um arquivo CSV adotado por alguns países europeus, que utilizam o ponto e vírgula (<code>;</code>) como separador. Logo abaixo, temos as linhas iniciais do arquivo <code>Censo_2010.csv</code> e, podemos rapidamente identificar que esse arquivo utiliza o padrão europeu. É por este motivo que eu utilizo a função <code>read_csv2()</code>, e não a função <code>read_csv()</code> para ler o arquivo.</p>
<pre><code>Manaus  AM;2106322;1972885;3011;;108160;;22266;;;30
Homens;1036676;964041;2018;;59024;;11593;;;30
Mulheres;1069646;1008844;993;;49136;;10673;;;30
Careiro da Várzea;23930;1000;;;21089;;1841;;;1301159
Homens;12688;481;;;11281;;926;;;1301159
Mulheres;11242;519;;;9808;;915;;;1301159</code></pre>
<p>Apesar de ser esse o padrão adotado por nós brasileiros, você enfrentará ocasiões em que o seu arquivo de texto possui separadores diferentes do esperado. Por exemplo, talvez os seus dados sejam separados por cifrões (<code>$</code>).</p>
<p></p>
<div class="sourceCode" id="cb379"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb379-1"><a href="#cb379-1" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> <span class="st">&quot;Ano$Código$Dia$Valor</span></span>
<span id="cb379-2"><a href="#cb379-2" aria-hidden="true" tabindex="-1"></a><span class="st">2020$P.A22$01$4230.45</span></span>
<span id="cb379-3"><a href="#cb379-3" aria-hidden="true" tabindex="-1"></a><span class="st">2020$B.34$02$1250.28</span></span>
<span id="cb379-4"><a href="#cb379-4" aria-hidden="true" tabindex="-1"></a><span class="st">2020$S.T4$03$3510.90&quot;</span></span>
<span id="cb379-5"><a href="#cb379-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb379-6"><a href="#cb379-6" aria-hidden="true" tabindex="-1"></a><span class="do">### Pelo fato do meu computador utilizar o sistema ISO-8859-1,</span></span>
<span id="cb379-7"><a href="#cb379-7" aria-hidden="true" tabindex="-1"></a><span class="do">### eu tenho que utilizar a função iconv() para garantir</span></span>
<span id="cb379-8"><a href="#cb379-8" aria-hidden="true" tabindex="-1"></a><span class="do">### que o texto que eu escrevi acima esteja no encoding UTF-8.</span></span>
<span id="cb379-9"><a href="#cb379-9" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> <span class="fu">iconv</span>(t, <span class="at">from =</span> <span class="st">&quot;ISO-8859-1&quot;</span>, <span class="at">to =</span> <span class="st">&quot;UTF-8&quot;</span>)</span>
<span id="cb379-10"><a href="#cb379-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb379-11"><a href="#cb379-11" aria-hidden="true" tabindex="-1"></a><span class="fu">writeLines</span>(t)</span></code></pre></div>
<pre><code>## Ano$Código$Dia$Valor
## 2020$P.A22$01$4230.45
## 2020$B.34$02$1250.28
## 2020$S.T4$03$3510.90</code></pre>
<p></p>
<p>Em casos como esse, você será obrigado a definir explicitamente o separador utilizado no arquivo. Para isso, você pode utilizar a função <code>read_delim()</code>, que possui o argumento <code>delim</code>, onde podemos determinar o caractere que delimita as colunas no arquivo.</p>
<p></p>
<div class="sourceCode" id="cb381"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb381-1"><a href="#cb381-1" aria-hidden="true" tabindex="-1"></a><span class="fu">read_delim</span>(t, <span class="at">delim =</span> <span class="st">&quot;$&quot;</span>)</span></code></pre></div>
<pre><code>## Rows: 3 Columns: 4</code></pre>
<pre><code>## -- Column specification ---------------------------------------------------
## Delimiter: &quot;$&quot;
## chr (2): Código, Dia
## dbl (2): Ano, Valor</code></pre>
<pre><code>## 
## i Use `spec()` to retrieve the full column specification for this data.
## i Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<pre><code>## # A tibble: 3 x 4
##     Ano Código Dia   Valor
##   &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt; &lt;dbl&gt;
## 1  2020 P.A22  01    4230.
## 2  2020 B.34   02    1250.
## 3  2020 S.T4   03    3511.</code></pre>
<p></p>
<p>Como um outro exemplo, arquivos TSV são simplificadamente um arquivo CSV que utiliza um caractere especial de tabulação como separador, representado pelos caracteres <code>\t</code>. Ou seja, nós podemos recriar a função <code>read_tsv()</code> através da função <code>read_delim()</code>, ao configurarmos o argumento <code>delim</code>, como no exemplo abaixo.</p>
<p></p>
<div class="sourceCode" id="cb386"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb386-1"><a href="#cb386-1" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> <span class="st">&quot;Ano</span><span class="sc">\t</span><span class="st">Código</span><span class="sc">\t</span><span class="st">Dia</span><span class="sc">\t</span><span class="st">Valor</span></span>
<span id="cb386-2"><a href="#cb386-2" aria-hidden="true" tabindex="-1"></a><span class="st">2020</span><span class="sc">\t</span><span class="st">P.A22</span><span class="sc">\t</span><span class="st">01</span><span class="sc">\t</span><span class="st">4.230,45</span></span>
<span id="cb386-3"><a href="#cb386-3" aria-hidden="true" tabindex="-1"></a><span class="st">2020</span><span class="sc">\t</span><span class="st">B.34</span><span class="sc">\t</span><span class="st">02</span><span class="sc">\t</span><span class="st">1.250,28</span></span>
<span id="cb386-4"><a href="#cb386-4" aria-hidden="true" tabindex="-1"></a><span class="st">2020</span><span class="sc">\t</span><span class="st">S.T4</span><span class="sc">\t</span><span class="st">03</span><span class="sc">\t</span><span class="st">3.510,90&quot;</span></span>
<span id="cb386-5"><a href="#cb386-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb386-6"><a href="#cb386-6" aria-hidden="true" tabindex="-1"></a><span class="do">### Pelo fato do meu computador utilizar o sistema ISO-8859-1,</span></span>
<span id="cb386-7"><a href="#cb386-7" aria-hidden="true" tabindex="-1"></a><span class="do">### eu tenho que utilizar a função iconv() para garantir</span></span>
<span id="cb386-8"><a href="#cb386-8" aria-hidden="true" tabindex="-1"></a><span class="do">### que o texto que eu escrevi acima esteja no encoding UTF-8.</span></span>
<span id="cb386-9"><a href="#cb386-9" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> <span class="fu">iconv</span>(t, <span class="at">from =</span> <span class="st">&quot;ISO-8859-1&quot;</span>, <span class="at">to =</span> <span class="st">&quot;UTF-8&quot;</span>)</span>
<span id="cb386-10"><a href="#cb386-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb386-11"><a href="#cb386-11" aria-hidden="true" tabindex="-1"></a><span class="fu">writeLines</span>(t)</span></code></pre></div>
<pre><code>## Ano  Código  Dia Valor
## 2020 P.A22   01  4.230,45
## 2020 B.34    02  1.250,28
## 2020 S.T4    03  3.510,90</code></pre>
<div class="sourceCode" id="cb388"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb388-1"><a href="#cb388-1" aria-hidden="true" tabindex="-1"></a><span class="fu">read_delim</span>(t, <span class="at">delim =</span> <span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Rows: 3 Columns: 4</code></pre>
<pre><code>## -- Column specification ---------------------------------------------------
## Delimiter: &quot;\t&quot;
## chr (2): Código, Dia
## dbl (1): Ano</code></pre>
<pre><code>## 
## i Use `spec()` to retrieve the full column specification for this data.
## i Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<pre><code>## # A tibble: 3 x 4
##     Ano Código Dia   Valor
##   &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt; &lt;dbl&gt;
## 1  2020 P.A22  01     4.23
## 2  2020 B.34   02     1.25
## 3  2020 S.T4   03     3.51</code></pre>
<p></p>
<div id="definindo-os-tipos-de-dados-em-cada-coluna" class="section level3" number="4.6.1">
<h3 number="4.6.1"><span class="header-section-number">4.6.1</span> Definindo os tipos de dados em cada coluna</h3>
<p>Caso nós não informarmos em qualquer uma das funções <code>read_*()</code>, qual o tipo de dado contido em cada coluna de nosso arquivo de texto, essas funções vão por padrão, ler as 1000 primeiras linhas de seu arquivo, e com base nessas 1000 linhas, vão tentar adivinhar qual o tipo de dado contido em cada coluna. Após esse processo, a função <code>read_*()</code> vai ler as linhas restantes do arquivo, se baseando nos tipos identificados pela função.</p>
<p>Tendo isso em mente, todas as funções <code>read_*()</code> sempre nos fornecem uma pequena descrição, contendo a especificação de cada coluna (<code>Column specification</code>). Essa descrição está nos informando justamente qual foi o “chute” da função, ou qual o tipo de dado que a função utilizou em cada coluna. Veja no exemplo abaixo, que a função <code>read_csv()</code> interpretou que as colunas <code>Título</code> e <code>Autor</code> continham dados textuais e, por isso, utilizou colunas do tipo <code>character</code> (<code>col_character()</code>) para guardar esses dados. Por outro lado, a função percebeu que a coluna <code>Preço</code> continha dados numéricos e, por essa razão, preferiu utilizar uma coluna do tipo <code>double</code> (<code>col_double()</code>) para alocar esses dados na tabela.</p>
<p></p>
<div class="sourceCode" id="cb393"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb393-1"><a href="#cb393-1" aria-hidden="true" tabindex="-1"></a>livros <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;C:/Users/Pedro/Documents/Lista de compras/livros.txt&quot;</span>)</span></code></pre></div>
<p></p>
<pre><code>-- Column specification --------------------------------
cols(
  Título = col_character(),
  Autor = col_character(),
  Preço = col_double()
)</code></pre>
<p>Isso é uma característica importante e útil das funções <code>read_*()</code>, pois podemos contar com esse sistema para definir os tipos de cada coluna do arquivo. Porém, esse é um sistema que se torna cada vez mais frágil a medida em que o tamanho de nosso arquivo aumenta. Pois essas 1000 primeiras linhas começam a representar uma parte cada vez menor do arquivo e, portanto, as suas chances de demonstrarem fielmente os tipos de dados presentes em todo arquivo, ficam cada vez menores.</p>
<p>Por isso, é provável que em algum momento, você terá de contornar esse comportamento, e definir explicitamente os tipos de dados contidos em cada coluna por meio do argumento <code>col_types</code> de qualquer função <code>read_*()</code>.</p>
<p>Para construirmos essa definição, nós utilizamos a função <code>cols()</code> e suas variantes <code>col_*()</code>. Dentro da função <code>cols()</code>, precisamos igualar o nome da coluna presente no arquivo de texto à função <code>col_*()</code> que corresponde ao tipo de dado desejado. No exemplo abaixo, ao igualar as colunas <code>year</code>, <code>month</code> e <code>day</code> à função <code>col_integer()</code>, eu estou definindo que essas colunas devem ser interpretadas como colunas do tipo <code>integer</code>. Enquanto isso, ao igualar as colunas <code>carrier</code> e <code>tailnum</code> à função <code>col_character()</code>, eu estou requisitando que essas colunas sejam lidas como colunas do tipo <code>character</code>.</p>
<p>Por outro lado, a função <code>cols()</code> nos oferece um atalho chamado <code>.default</code>. Mediante esse atalho, podemos nos referir a todas as colunas do arquivo de uma vez. Por isso, no exemplo abaixo, ao igualar esse atalho à função <code>col_double()</code>, eu estou dizendo à função <code>cols()</code>, que qualquer outra coluna do arquivo que não tenha sido definida explicitamente na função <code>cols()</code>, deve ser interpretada como uma coluna do tipo <code>double</code>. Por este motivo, as colunas <code>dep_time</code> e <code>dep_delay</code> (e várias outras), que não foram configuradas explicitamente na função <code>cols()</code>, acabaram sendo interpretadas como colunas do tipo <code>double</code>.</p>
<p></p>
<div class="sourceCode" id="cb395"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb395-1"><a href="#cb395-1" aria-hidden="true" tabindex="-1"></a>tipos_col <span class="ot">&lt;-</span> <span class="fu">cols</span>(</span>
<span id="cb395-2"><a href="#cb395-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">.default =</span> <span class="fu">col_double</span>(),</span>
<span id="cb395-3"><a href="#cb395-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">year =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb395-4"><a href="#cb395-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">month =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb395-5"><a href="#cb395-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">day =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb395-6"><a href="#cb395-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">carrier =</span> <span class="fu">col_character</span>(),</span>
<span id="cb395-7"><a href="#cb395-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">tailnum =</span> <span class="fu">col_character</span>(),</span>
<span id="cb395-8"><a href="#cb395-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">origin =</span> <span class="fu">col_character</span>(),</span>
<span id="cb395-9"><a href="#cb395-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">dest =</span> <span class="fu">col_character</span>(),</span>
<span id="cb395-10"><a href="#cb395-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">time_hour =</span> <span class="fu">col_datetime</span>(<span class="at">format =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb395-11"><a href="#cb395-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb395-12"><a href="#cb395-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb395-13"><a href="#cb395-13" aria-hidden="true" tabindex="-1"></a>flights <span class="ot">&lt;-</span> <span class="fu">read_csv2</span>(</span>
<span id="cb395-14"><a href="#cb395-14" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;flights.csv&quot;</span>,</span>
<span id="cb395-15"><a href="#cb395-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">col_types =</span> tipos_col</span>
<span id="cb395-16"><a href="#cb395-16" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p></p>
<p></p>
<div class="sourceCode" id="cb396"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb396-1"><a href="#cb396-1" aria-hidden="true" tabindex="-1"></a>flights</span></code></pre></div>
<pre><code>## # A tibble: 336,776 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;dbl&gt;          &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
##  1  2013     1     1      517            515         2      830
##  2  2013     1     1      533            529         4      850
##  3  2013     1     1      542            540         2      923
##  4  2013     1     1      544            545        -1     1004
##  5  2013     1     1      554            600        -6      812
##  6  2013     1     1      554            558        -4      740
##  7  2013     1     1      555            600        -5      913
##  8  2013     1     1      557            600        -3      709
##  9  2013     1     1      557            600        -3      838
## 10  2013     1     1      558            600        -2      753
## # ... with 336,766 more rows, and 12 more variables: sched_arr_time &lt;dbl&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;dbl&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<p></p>
</div>
<div id="sec:readr_locale" class="section level3" number="4.6.2">
<h3 number="4.6.2"><span class="header-section-number">4.6.2</span> Compreendendo o argumento <code>locale</code></h3>
<p>O argumento <code>locale</code> está presente em todas as funções <code>read_*()</code>, e é responsável por definir as especificações do arquivo de texto que mudam de país para país. No Brasil, por exemplo, datas são definidas no formato “Dia/Mês/Ano,” enquanto nos EUA, datas se encontram no formato “Ano-Mês-Dia.” No Brasil, utilizamos vírgulas para separar a parte decimal de um número, enquanto nos EUA, essa separação é definida por um ponto final. Uma diferença ainda mais importante, se encontra no sistema de <em>encoding</em> adotado, que varia de maneira muito violenta ao longo dos países.</p>
<p>O R, é uma linguagem centrada nos padrões americanos, por isso, sempre que você estiver tentando ler algum arquivo de texto que não se encaixa de alguma forma neste padrão, você terá que ajustar o <code>locale</code> da função <code>read_*()</code> que você está utilizando. Algumas funções já preveem e adotam essas diferenças, um exemplo disso, é a função <code>read_csv2()</code>, que é na verdade um atalho para o padrão adotado por nós brasileiros, e por alguns países europeus.</p>
<p>Como exemplo inicial, vamos tentar ler o arquivo <code>pib_per_capita.csv</code>, que novamente se encontra dentro da pasta <code>6 - Importacao</code>. Dessa vez, vamos utilizar a função geral do pacote, a <code>read_delim()</code>. Lembre-se que nessa função, você deve sempre indicar qual o caractere separador do arquivo, através do argumento <code>delim</code>.</p>
<p></p>
<div class="sourceCode" id="cb398"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb398-1"><a href="#cb398-1" aria-hidden="true" tabindex="-1"></a>pib <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(<span class="st">&quot;Parte 1/6 - Importacao/pib_per_capita.csv&quot;</span>, <span class="at">delim =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb398-2"><a href="#cb398-2" aria-hidden="true" tabindex="-1"></a>pib</span></code></pre></div>
<p></p>
<pre><code>## # A tibble: 853 x 7
##  IBGE2   IBGE `Munic\xedpio`        `Popula\xe7\xe3o`   Ano PIB
##  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;                             &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;
## 1   10 310010 &quot;Abadia dos Dourados&quot;              6972  2017 33.389.769,00
## 2   20 310020 &quot;Abaet\xe9&quot;                       23223  2017 96.201.158,00
## 3   30 310030 &quot;Abre Campo&quot;                      13465  2017 29.149.429,00
## 4   40 310040 &quot;Acaiaca&quot;                          3994  2017 2.521.892,00
## 5   50 310050 &quot;A\xe7ucena&quot;                       9575  2017 15.250.077,00
## 6   60 310060 &quot;\xc1gua Boa&quot;                     13600  2017 29.988.906,00
## 7   70 310070 &quot;\xc1gua Comprida&quot;                 2005  2017 74.771.408,00
## 8   80 310080 &quot;Aguanil&quot;                          4448  2017 15.444.038,00
## 9   90 310090 &quot;\xc1guas Formosas&quot;               19166  2017 11.236.696,00
## 10 100 310100 &quot;\xc1guas Vermelhas&quot;              13477  2017 48.088.397,00
## # ... with 843 more rows, and 1 more variable: PIB per capita &lt;chr&gt;</code></pre>
<p>Algo deu errado durante a importação, pois as colunas <code>PIB</code> e <code>PIB per capita</code> foram importadas como colunas de texto (<code>character</code>), sendo que elas são claramente numéricas. Em momentos como esse, é interessante que você consulte as primeiras linhas do arquivo, para compreender melhor a sua estrutura e identificar o que deu errado. Por isso, temos logo abaixo, as três primeiras linhas do arquivo <code>pib_per_capita.csv</code>. Perceba que os dois últimos valores em cada linha, representam os dados das colunas <code>PIB</code> e <code>PIB per capita</code>. Ao olharmos, por exemplo, para o número 33.389.769,00 nós podemos identificar qual o problema que está ocorrendo em nossa importação.</p>
<pre><code>10;310010;Abadia dos Dourados;6972;2017;33.389.769,00;4.789,12
20;310020;Abaeté;23223;2017;96.201.158,00;4.142,49
30;310030;Abre Campo;13465;2017;29.149.429,00;2.164,83</code></pre>
<p>O motivo para tal conflito, se encontra justamente no uso do ponto final como separador de milhares, e da vírgula para marcar a parte decimal dos números dispostos nas colunas <code>PIB</code> e <code>PIB_per_capita</code>. Ou seja, como não informamos nada sobre as particularidades do arquivo, a função <code>read_delim()</code> está imaginando que o arquivo <code>pib_per_capita.csv</code> se encontra no padrão americano. Por isso, para que esse problema seja corrigido, nós precisamos avisar a função <code>read_delim()</code>, sobre essas particularidades de nosso arquivo.</p>
<p>Para fornecer tais informações, utilizamos a função <code>locale()</code>, como no exemplo abaixo. No nosso caso, precisamos ajustar o caractere responsável por separar os milhares, e o caractere que separa a parte decimal dos nossos números, que correspondem aos argumentos <code>grouping_mark</code> e <code>decimal_mark</code> da função <code>locale()</code>, respectivamente. Perceba no exemplo abaixo, que após provermos essas informações à função <code>read_delim()</code> através da função <code>locale()</code>, as colunas <code>PIB</code> e <code>PIB per capita</code> foram corretamente interpretadas como colunas numéricas (<code>double</code>).</p>
<p></p>
<div class="sourceCode" id="cb401"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb401-1"><a href="#cb401-1" aria-hidden="true" tabindex="-1"></a>pib <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(</span>
<span id="cb401-2"><a href="#cb401-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Parte 1/6 - Importacao/pib_per_capita.csv&quot;</span>,</span>
<span id="cb401-3"><a href="#cb401-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">delim =</span> <span class="st">&quot;;&quot;</span>,</span>
<span id="cb401-4"><a href="#cb401-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">locale =</span> <span class="fu">locale</span>(<span class="at">decimal_mark =</span> <span class="st">&quot;,&quot;</span>, <span class="at">grouping_mark =</span> <span class="st">&quot;.&quot;</span>)</span>
<span id="cb401-5"><a href="#cb401-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb401-6"><a href="#cb401-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb401-7"><a href="#cb401-7" aria-hidden="true" tabindex="-1"></a>pib</span></code></pre></div>
<p></p>
<pre><code>## # A tibble: 853 x 7
##  IBGE2   IBGE `Munic\xedpio`        `Popula\xe7\xe3o`   Ano      PIB
##  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;                             &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;
## 1   10 310010 &quot;Abadia dos Dourados&quot;              6972  2017 33389769
## 2   20 310020 &quot;Abaet\xe9&quot;                       23223  2017 96201158
## 3   30 310030 &quot;Abre Campo&quot;                      13465  2017 29149429
## 4   40 310040 &quot;Acaiaca&quot;                          3994  2017  2521892
## 5   50 310050 &quot;A\xe7ucena&quot;                       9575  2017 15250077
## 6   60 310060 &quot;\xc1gua Boa&quot;                     13600  2017 29988906
## 7   70 310070 &quot;\xc1gua Comprida&quot;                 2005  2017 74771408
## 8   80 310080 &quot;Aguanil&quot;                          4448  2017 15444038
## 9   90 310090 &quot;\xc1guas Formosas&quot;               19166  2017 11236696
## 10 100 310100 &quot;\xc1guas Vermelhas&quot;              13477  2017 48088397
## # ... with 843 more rows, and 1 more variable: PIB per capita &lt;dbl&gt;</code></pre>
<p>Apesar de resolvermos o problema gerado anteriormente nas colunas <code>PIB</code> e <code>PIB per capita</code>, ainda há algo que precisamos corrigir nessa importação. O problema remanescente, se encontra em colunas textuais e no título de algumas colunas. Perceba que alguns desses textos (especialmente em letras acentuadas) estão esquisitos. Por exemplo, a coluna que deveria se chamar <code>Município</code> está denominada como <code>Munic\xedpio</code>.</p>
<p>Esse é um típico problema de <em>encoding</em>, onde a função <code>read_delim()</code> imagina que o arquivo <code>pib_per_capita.csv</code> se encontra em um sistema de <em>encoding</em> específico, quando na verdade, ele se encontra em um outro sistema. Ou seja, tudo o que precisamos fazer, é informar qual o sistema correto de leitura do arquivo à função <code>read_delim()</code>. Por padrão, todas as funções do pacote <code>readr</code> vão pressupor que os seus arquivos se encontram no sistema UTF-8 de <em>encoding</em>. Porém, a enorme maioria dos computadores brasileiros utilizam um outro sistema, chamado de ISO-8859-1, que também é conhecido pelo termo “Latin1.”</p>
<p>Nas funções do pacote <code>readr</code>, nós podemos definir o <em>encoding</em> de leitura do arquivo, através do argumento <code>encoding</code> presente na função <code>locale()</code>. Nesse argumento, você pode fornecer tanto o nome oficial do sistema (<code>ISO-8859-1</code>) quanto o seu apelido (<code>Latin1</code>). Repare no exemplo abaixo, que ao definirmos o <em>encoding</em> correto de leitura, os problemas em elementos textuais foram resolvidos. Para ter uma melhor compreensão desse problema, por favor, leia a seção <a href="#sec:encoding"><em>Encoding</em> de caracteres</a>.</p>
<p></p>
<div class="sourceCode" id="cb403"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb403-1"><a href="#cb403-1" aria-hidden="true" tabindex="-1"></a>pib <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(</span>
<span id="cb403-2"><a href="#cb403-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Parte 1/6 - Importacao/pib_per_capita.csv&quot;</span>,</span>
<span id="cb403-3"><a href="#cb403-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">delim =</span> <span class="st">&quot;;&quot;</span>,</span>
<span id="cb403-4"><a href="#cb403-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">locale =</span> <span class="fu">locale</span>(</span>
<span id="cb403-5"><a href="#cb403-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">decimal_mark =</span> <span class="st">&quot;,&quot;</span>,</span>
<span id="cb403-6"><a href="#cb403-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">grouping_mark =</span> <span class="st">&quot;.&quot;</span>,</span>
<span id="cb403-7"><a href="#cb403-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">encoding =</span> <span class="st">&quot;Latin1&quot;</span></span>
<span id="cb403-8"><a href="#cb403-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb403-9"><a href="#cb403-9" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p></p>
<p></p>
<div class="sourceCode" id="cb404"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb404-1"><a href="#cb404-1" aria-hidden="true" tabindex="-1"></a>pib</span></code></pre></div>
<pre><code>## # A tibble: 853 x 7
##    IBGE2   IBGE Município           População   Ano    PIB `PIB per capita`
##    &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;                   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;            &lt;dbl&gt;
##  1    10 310010 Abadia dos Dourados      6972  2017 3.34e7            4789.
##  2    20 310020 Abaeté                  23223  2017 9.62e7            4142.
##  3    30 310030 Abre Campo              13465  2017 2.91e7            2165.
##  4    40 310040 Acaiaca                  3994  2017 2.52e6             631.
##  5    50 310050 Açucena                  9575  2017 1.53e7            1593.
##  6    60 310060 Água Boa                13600  2017 3.00e7            2205.
##  7    70 310070 Água Comprida            2005  2017 7.48e7           37292.
##  8    80 310080 Aguanil                  4448  2017 1.54e7            3472.
##  9    90 310090 Águas Formosas          19166  2017 1.12e7             586.
## 10   100 310100 Águas Vermelhas         13477  2017 4.81e7            3568.
## # ... with 843 more rows</code></pre>
<p></p>
</div>
<div id="sobre-o-erro-ncharx-width-invalid-multibyte-string" class="section level3" number="4.6.3">
<h3 number="4.6.3"><span class="header-section-number">4.6.3</span> Sobre o erro <code>nchar(x, "width") : invalid multibyte string</code></h3>
<p>O exemplo do arquivo <code>pib_per_capita.csv</code> da seção anterior, é bastante útil, pois o arquivo possui três características distintas que não se encaixam no padrão americano de um CSV: 1) o arquivo é delimitado por pontos e vírgulas (<code>;</code>); 2) o arquivo utiliza pontos para separar os milhares, e vírgulas para separar a parte decimal de números; 3) o arquivo utiliza o <em>encoding</em> <code>ISO-8859-1</code> ao invés do sistema <code>UTF-8</code>.</p>
<p>Porém, em versões mais recentes do R e do pacote <code>readr</code>, o <em>encoding</em> do arquivo passou a ser uma configuração ainda mais importante durante o processo de importação. Como destacamos anteriormente, todas as funções <code>read_*()</code> do pacote <code>readr</code>, vão sempre ler os seus arquivos com o pressuposto de que eles utilizam o sistema <code>UTF-8</code> de <em>encoding</em>.</p>
<p>Em versões passadas, caso você tentasse ler um arquivo que estivesse em um <em>encoding</em> diferente do <code>UTF-8</code>, as funções <code>read_*()</code> leriam o arquivo normalmente. Devido à diferença entre o <em>encoding</em> do arquivo e o <em>encoding</em> utilizado pela função <code>read_*()</code>, certas palavras como <code>"Município"</code> seriam trocadas por <code>"Munic\xedpio"</code>. Ou seja, os comandos mostrados na seção anterior mostram como esse processo funcionava antigamente.</p>
<p>Contudo, em versões mais atuais do pacote <code>readr</code>, os comandos apresentados na seção anterior costumam resultar no erro <code>nchar(x, "width") : invalid multibyte string</code>. Tal erro, ocorre justamente pela diferença de <em>encodings</em>. Portanto, enquanto em versões mais antigas, as funções <code>read_*()</code> costumavam ser mais permissivas, hoje, nas versões mais atuais, essas funções costumam reclamar com maior facilidade caso o arquivo em questão não esteja utilizando o <em>encoding</em> <code>UTF-8</code>.</p>
<p>Sendo assim, mesmo que os códigos apresentados na seção anterior sejam um retrato do passado, eles ainda assim são bastante úteis para demonstrar como certas configurações de seu arquivo podem afetar o seu processo de importação para dentro do R.</p>
<p>De qualquer forma, caso você enfrente o erro <code>nchar(x, "width") : invalid multibyte string</code> ao utilizar uma das funções <code>read_*()</code>, tente definir o <em>encoding</em> correto do arquivo que você está tentando ler, com a função <code>locale()</code>. Por exemplo, o arquivo <code>pib_per_capita.csv</code> utiliza o sistema <code>ISO-8859-1</code>, logo, o comando para importar esse arquivo nos dias atuais seria:</p>
<p></p>
<div class="sourceCode" id="cb406"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb406-1"><a href="#cb406-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Funciona em todas as versões:</span></span>
<span id="cb406-2"><a href="#cb406-2" aria-hidden="true" tabindex="-1"></a>pib <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(</span>
<span id="cb406-3"><a href="#cb406-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Parte 1/6 - Importacao/pib_per_capita.csv&quot;</span>,</span>
<span id="cb406-4"><a href="#cb406-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">delim =</span> <span class="st">&quot;;&quot;</span>,</span>
<span id="cb406-5"><a href="#cb406-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">locale =</span> <span class="fu">locale</span>(</span>
<span id="cb406-6"><a href="#cb406-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">decimal_mark =</span> <span class="st">&quot;,&quot;</span>,</span>
<span id="cb406-7"><a href="#cb406-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">grouping_mark =</span> <span class="st">&quot;.&quot;</span>,</span>
<span id="cb406-8"><a href="#cb406-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">encoding =</span> <span class="st">&quot;ISO-8859-1&quot;</span></span>
<span id="cb406-9"><a href="#cb406-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb406-10"><a href="#cb406-10" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p></p>
<p>Isso também se estende aos exemplos que dei com o objeto <code>t</code>. Um desses exemplos está reproduzido abaixo. Perceba que nesses exemplos, eu sempre utilizo a função <code>iconv()</code>, para garantir que o texto escrito esteja no encoding <code>UTF-8</code>, antes de repassá-lo para a função <code>read_delim()</code>.</p>
<p></p>
<div class="sourceCode" id="cb407"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb407-1"><a href="#cb407-1" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> <span class="st">&quot;Ano</span><span class="sc">\t</span><span class="st">Código</span><span class="sc">\t</span><span class="st">Dia</span><span class="sc">\t</span><span class="st">Valor</span></span>
<span id="cb407-2"><a href="#cb407-2" aria-hidden="true" tabindex="-1"></a><span class="st">2020</span><span class="sc">\t</span><span class="st">P.A22</span><span class="sc">\t</span><span class="st">01</span><span class="sc">\t</span><span class="st">4.230,45</span></span>
<span id="cb407-3"><a href="#cb407-3" aria-hidden="true" tabindex="-1"></a><span class="st">2020</span><span class="sc">\t</span><span class="st">B.34</span><span class="sc">\t</span><span class="st">02</span><span class="sc">\t</span><span class="st">1.250,28</span></span>
<span id="cb407-4"><a href="#cb407-4" aria-hidden="true" tabindex="-1"></a><span class="st">2020</span><span class="sc">\t</span><span class="st">S.T4</span><span class="sc">\t</span><span class="st">03</span><span class="sc">\t</span><span class="st">3.510,90&quot;</span></span>
<span id="cb407-5"><a href="#cb407-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb407-6"><a href="#cb407-6" aria-hidden="true" tabindex="-1"></a><span class="do">### Pelo fato do meu computador utilizar o sistema ISO-8859-1,</span></span>
<span id="cb407-7"><a href="#cb407-7" aria-hidden="true" tabindex="-1"></a><span class="do">### eu tenho que utilizar a função iconv() para garantir</span></span>
<span id="cb407-8"><a href="#cb407-8" aria-hidden="true" tabindex="-1"></a><span class="do">### que o texto que eu escrevi acima esteja no encoding UTF-8.</span></span>
<span id="cb407-9"><a href="#cb407-9" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> <span class="fu">iconv</span>(t, <span class="at">from =</span> <span class="st">&quot;ISO-8859-1&quot;</span>, <span class="at">to =</span> <span class="st">&quot;UTF-8&quot;</span>)</span>
<span id="cb407-10"><a href="#cb407-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb407-11"><a href="#cb407-11" aria-hidden="true" tabindex="-1"></a><span class="fu">writeLines</span>(t)</span></code></pre></div>
<pre><code>## Ano  Código  Dia Valor
## 2020 P.A22   01  4.230,45
## 2020 B.34    02  1.250,28
## 2020 S.T4    03  3.510,90</code></pre>
<div class="sourceCode" id="cb409"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb409-1"><a href="#cb409-1" aria-hidden="true" tabindex="-1"></a><span class="fu">read_delim</span>(t, <span class="at">delim =</span> <span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Rows: 3 Columns: 4</code></pre>
<pre><code>## -- Column specification ---------------------------------------------------
## Delimiter: &quot;\t&quot;
## chr (2): Código, Dia
## dbl (1): Ano</code></pre>
<pre><code>## 
## i Use `spec()` to retrieve the full column specification for this data.
## i Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<pre><code>## # A tibble: 3 x 4
##     Ano Código Dia   Valor
##   &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt; &lt;dbl&gt;
## 1  2020 P.A22  01     4.23
## 2  2020 B.34   02     1.25
## 3  2020 S.T4   03     3.51</code></pre>
<p></p>
<p>Caso eu não utilize essa função, o texto vai estar utilizando o <em>encoding</em> <code>ISO-8859-1</code> e, por isso, a função <code>read_delim()</code> vai levantar o erro de <code>invalid multibyte string</code>, como demonstrado abaixo:</p>
<p></p>
<div class="sourceCode" id="cb414"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb414-1"><a href="#cb414-1" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> <span class="st">&quot;Ano</span><span class="sc">\t</span><span class="st">Código</span><span class="sc">\t</span><span class="st">Dia</span><span class="sc">\t</span><span class="st">Valor</span></span>
<span id="cb414-2"><a href="#cb414-2" aria-hidden="true" tabindex="-1"></a><span class="st">2020</span><span class="sc">\t</span><span class="st">P.A22</span><span class="sc">\t</span><span class="st">01</span><span class="sc">\t</span><span class="st">4.230,45</span></span>
<span id="cb414-3"><a href="#cb414-3" aria-hidden="true" tabindex="-1"></a><span class="st">2020</span><span class="sc">\t</span><span class="st">B.34</span><span class="sc">\t</span><span class="st">02</span><span class="sc">\t</span><span class="st">1.250,28</span></span>
<span id="cb414-4"><a href="#cb414-4" aria-hidden="true" tabindex="-1"></a><span class="st">2020</span><span class="sc">\t</span><span class="st">S.T4</span><span class="sc">\t</span><span class="st">03</span><span class="sc">\t</span><span class="st">3.510,90&quot;</span></span>
<span id="cb414-5"><a href="#cb414-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb414-6"><a href="#cb414-6" aria-hidden="true" tabindex="-1"></a><span class="fu">read_delim</span>(t, <span class="at">delim =</span> <span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>)</span></code></pre></div>
<p></p>
<pre><code>Rows: 3 Columns: 4
Error in nchar(x, &quot;width&quot;) : invalid multibyte string, element 1</code></pre>
<p>Por essa razão, aplico a função <code>iconv()</code> sobre o objeto <code>t</code> antes de entregá-lo para a função <code>read_delim()</code>. Uma outra forma de solucionarmos esse problema seria avisarmos sobre o <em>encoding</em> utilizado pelo arquivo, com a função <code>locale()</code>.</p>
<p></p>
<div class="sourceCode" id="cb416"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb416-1"><a href="#cb416-1" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> <span class="st">&quot;Ano</span><span class="sc">\t</span><span class="st">Código</span><span class="sc">\t</span><span class="st">Dia</span><span class="sc">\t</span><span class="st">Valor</span></span>
<span id="cb416-2"><a href="#cb416-2" aria-hidden="true" tabindex="-1"></a><span class="st">2020</span><span class="sc">\t</span><span class="st">P.A22</span><span class="sc">\t</span><span class="st">01</span><span class="sc">\t</span><span class="st">4.230,45</span></span>
<span id="cb416-3"><a href="#cb416-3" aria-hidden="true" tabindex="-1"></a><span class="st">2020</span><span class="sc">\t</span><span class="st">B.34</span><span class="sc">\t</span><span class="st">02</span><span class="sc">\t</span><span class="st">1.250,28</span></span>
<span id="cb416-4"><a href="#cb416-4" aria-hidden="true" tabindex="-1"></a><span class="st">2020</span><span class="sc">\t</span><span class="st">S.T4</span><span class="sc">\t</span><span class="st">03</span><span class="sc">\t</span><span class="st">3.510,90&quot;</span></span>
<span id="cb416-5"><a href="#cb416-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb416-6"><a href="#cb416-6" aria-hidden="true" tabindex="-1"></a><span class="fu">read_delim</span>(</span>
<span id="cb416-7"><a href="#cb416-7" aria-hidden="true" tabindex="-1"></a>  t, <span class="at">delim =</span> <span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>,</span>
<span id="cb416-8"><a href="#cb416-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">locale =</span> <span class="fu">locale</span>(<span class="at">encoding =</span> <span class="st">&quot;ISO-8859-1&quot;</span>)</span>
<span id="cb416-9"><a href="#cb416-9" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## Rows: 3 Columns: 4</code></pre>
<pre><code>## -- Column specification ---------------------------------------------------
## Delimiter: &quot;\t&quot;
## chr (2): Código, Dia
## dbl (1): Ano</code></pre>
<pre><code>## 
## i Use `spec()` to retrieve the full column specification for this data.
## i Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<pre><code>## # A tibble: 3 x 4
##     Ano Código Dia   Valor
##   &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt; &lt;dbl&gt;
## 1  2020 P.A22  01     4.23
## 2  2020 B.34   02     1.25
## 3  2020 S.T4   03     3.51</code></pre>
<p></p>
</div>
<div id="outras-configurações-envolvendo-linhas-e-colunas" class="section level3" number="4.6.4">
<h3 number="4.6.4"><span class="header-section-number">4.6.4</span> Outras configurações envolvendo linhas e colunas</h3>
<p>Nessa seção, vamos utilizar como exemplo base, o arquivo CSV que forma o objeto <code>t</code> abaixo. Perceba que esse arquivo utiliza pontos e vírgulas como separador, e que ele não possui cabeçalho aparente. Ou seja, aparentemente os nomes das colunas não estão definidos no arquivo.</p>
<p></p>
<div class="sourceCode" id="cb421"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb421-1"><a href="#cb421-1" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> <span class="st">&quot;2020;P.A22;01;4230.45</span></span>
<span id="cb421-2"><a href="#cb421-2" aria-hidden="true" tabindex="-1"></a><span class="st">2020;B.34;02;1250.28</span></span>
<span id="cb421-3"><a href="#cb421-3" aria-hidden="true" tabindex="-1"></a><span class="st">2020;S.T4;03;3510.90</span></span>
<span id="cb421-4"><a href="#cb421-4" aria-hidden="true" tabindex="-1"></a><span class="st">2020;B.35;04;1200.25</span></span>
<span id="cb421-5"><a href="#cb421-5" aria-hidden="true" tabindex="-1"></a><span class="st">2020;F.J4;05;1542.20</span></span>
<span id="cb421-6"><a href="#cb421-6" aria-hidden="true" tabindex="-1"></a><span class="st">2020;A.12;06;9854.09</span></span>
<span id="cb421-7"><a href="#cb421-7" aria-hidden="true" tabindex="-1"></a><span class="st">2020;B.Q2;07;7654.10</span></span>
<span id="cb421-8"><a href="#cb421-8" aria-hidden="true" tabindex="-1"></a><span class="st">2020;G.T4;08;4328.36</span></span>
<span id="cb421-9"><a href="#cb421-9" aria-hidden="true" tabindex="-1"></a><span class="st">2020;E.7A;09;2310.25&quot;</span></span>
<span id="cb421-10"><a href="#cb421-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb421-11"><a href="#cb421-11" aria-hidden="true" tabindex="-1"></a><span class="co">#t &lt;- iconv(t, from = &quot;ISO-8859-1&quot;, to = &quot;UTF-8&quot;)</span></span>
<span id="cb421-12"><a href="#cb421-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb421-13"><a href="#cb421-13" aria-hidden="true" tabindex="-1"></a><span class="fu">writeLines</span>(t)</span></code></pre></div>
<pre><code>## 2020;P.A22;01;4230.45
## 2020;B.34;02;1250.28
## 2020;S.T4;03;3510.90
## 2020;B.35;04;1200.25
## 2020;F.J4;05;1542.20
## 2020;A.12;06;9854.09
## 2020;B.Q2;07;7654.10
## 2020;G.T4;08;4328.36
## 2020;E.7A;09;2310.25</code></pre>
<div class="sourceCode" id="cb423"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb423-1"><a href="#cb423-1" aria-hidden="true" tabindex="-1"></a><span class="fu">read_delim</span>(t, <span class="at">delim =</span> <span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Rows: 8 Columns: 1</code></pre>
<pre><code>## -- Column specification ---------------------------------------------------
## Delimiter: &quot;\t&quot;
## chr (1): 2020;P.A22;01;4230.45</code></pre>
<pre><code>## 
## i Use `spec()` to retrieve the full column specification for this data.
## i Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<pre><code>## # A tibble: 8 x 1
##   `2020;P.A22;01;4230.45`
##   &lt;chr&gt;                  
## 1 2020;B.34;02;1250.28   
## 2 2020;S.T4;03;3510.90   
## 3 2020;B.35;04;1200.25   
## 4 2020;F.J4;05;1542.20   
## 5 2020;A.12;06;9854.09   
## 6 2020;B.Q2;07;7654.10   
## 7 2020;G.T4;08;4328.36   
## 8 2020;E.7A;09;2310.25</code></pre>
<div class="sourceCode" id="cb428"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb428-1"><a href="#cb428-1" aria-hidden="true" tabindex="-1"></a><span class="fu">read_delim</span>(t, <span class="at">delim =</span> <span class="st">&quot;;&quot;</span>)</span></code></pre></div>
<pre><code>## Rows: 8 Columns: 4</code></pre>
<pre><code>## -- Column specification ---------------------------------------------------
## Delimiter: &quot;;&quot;
## chr (2): P.A22, 01
## dbl (2): 2020, 4230.45</code></pre>
<pre><code>## 
## i Use `spec()` to retrieve the full column specification for this data.
## i Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<pre><code>## # A tibble: 8 x 4
##   `2020` P.A22 `01`  `4230.45`
##    &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;     &lt;dbl&gt;
## 1   2020 B.34  02        1250.
## 2   2020 S.T4  03        3511.
## 3   2020 B.35  04        1200.
## 4   2020 F.J4  05        1542.
## 5   2020 A.12  06        9854.
## 6   2020 B.Q2  07        7654.
## 7   2020 G.T4  08        4328.
## 8   2020 E.7A  09        2310.</code></pre>
<p></p>
<p>Por padrão, as funções <code>read_*()</code> utilizam a primeira linha do arquivo para construir o nome de cada coluna presente. Mas se você deseja evitar esse comportamento, você pode configurar o argumento <code>col_names</code> para <code>FALSE</code>. Dessa forma, a função <code>read_*()</code> vai gerar nomes genéricos para cada coluna. Uma outra alternativa é fornecer um vetor ao argumento <code>col_names</code>, contendo os nomes de cada coluna na ordem em que elas aparecem no arquivo, como no exemplo abaixo.</p>
<p></p>
<div class="sourceCode" id="cb433"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb433-1"><a href="#cb433-1" aria-hidden="true" tabindex="-1"></a>col <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Ano&quot;</span>, <span class="st">&quot;Código&quot;</span>, <span class="st">&quot;Dia&quot;</span>, <span class="st">&quot;Valor&quot;</span>)</span>
<span id="cb433-2"><a href="#cb433-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb433-3"><a href="#cb433-3" aria-hidden="true" tabindex="-1"></a><span class="fu">read_delim</span>(t, <span class="at">delim =</span> <span class="st">&quot;;&quot;</span>, <span class="at">col_names =</span> col)</span></code></pre></div>
<pre><code>## Rows: 9 Columns: 4</code></pre>
<pre><code>## -- Column specification ---------------------------------------------------
## Delimiter: &quot;;&quot;
## chr (2): Código, Dia
## dbl (2): Ano, Valor</code></pre>
<pre><code>## 
## i Use `spec()` to retrieve the full column specification for this data.
## i Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<pre><code>## # A tibble: 9 x 4
##     Ano Código Dia   Valor
##   &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt; &lt;dbl&gt;
## 1  2020 P.A22  01    4230.
## 2  2020 B.34   02    1250.
## 3  2020 S.T4   03    3511.
## 4  2020 B.35   04    1200.
## 5  2020 F.J4   05    1542.
## 6  2020 A.12   06    9854.
## 7  2020 B.Q2   07    7654.
## 8  2020 G.T4   08    4328.
## 9  2020 E.7A   09    2310.</code></pre>
<p></p>
<p>Além disso, as funções <code>read_*()</code> nos permite determinar o número máximo de linhas que desejamos ler de um arquivo, através do argumento <code>n_max</code>. Logo, mesmo que um arquivo de texto qualquer possua 500 mil linhas, nós podemos ler apenas as 10 primeiras linhas desse arquivo, ao configurarmos esse argumento. No exemplo abaixo, eu estou lendo apenas as 5 primeiras linhas do arquivo <code>t</code>.</p>
<p></p>
<div class="sourceCode" id="cb438"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb438-1"><a href="#cb438-1" aria-hidden="true" tabindex="-1"></a><span class="fu">read_delim</span>(t, <span class="at">delim =</span> <span class="st">&quot;;&quot;</span>, <span class="at">n_max =</span> <span class="dv">5</span>, <span class="at">col_names =</span> col)</span></code></pre></div>
<pre><code>## Rows: 5 Columns: 4</code></pre>
<pre><code>## -- Column specification ---------------------------------------------------
## Delimiter: &quot;;&quot;
## chr (2): Código, Dia
## dbl (2): Ano, Valor</code></pre>
<pre><code>## 
## i Use `spec()` to retrieve the full column specification for this data.
## i Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<pre><code>## # A tibble: 5 x 4
##     Ano Código Dia   Valor
##   &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt; &lt;dbl&gt;
## 1  2020 P.A22  01    4230.
## 2  2020 B.34   02    1250.
## 3  2020 S.T4   03    3511.
## 4  2020 B.35   04    1200.
## 5  2020 F.J4   05    1542.</code></pre>
<p></p>
<p>Para mais, também podemos indiretamente definir a linha pela qual a função deve iniciar a leitura, por meio do argumento <code>skip</code>. Nesse argumento, você vai determinar quantas linhas do início do arquivo devem ser desconsideradas pela função. Portanto, no exemplo abaixo, eu estou ignorando as 2 primeiras linhas do arquivo <code>t</code>.</p>
<p></p>
<div class="sourceCode" id="cb443"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb443-1"><a href="#cb443-1" aria-hidden="true" tabindex="-1"></a><span class="fu">read_delim</span>(t, <span class="at">delim =</span> <span class="st">&quot;;&quot;</span>, <span class="at">skip =</span> <span class="dv">2</span>, <span class="at">col_names =</span> col)</span></code></pre></div>
<pre><code>## Rows: 7 Columns: 4</code></pre>
<pre><code>## -- Column specification ---------------------------------------------------
## Delimiter: &quot;;&quot;
## chr (2): Código, Dia
## dbl (2): Ano, Valor</code></pre>
<pre><code>## 
## i Use `spec()` to retrieve the full column specification for this data.
## i Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<pre><code>## # A tibble: 7 x 4
##     Ano Código Dia   Valor
##   &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt; &lt;dbl&gt;
## 1  2020 S.T4   03    3511.
## 2  2020 B.35   04    1200.
## 3  2020 F.J4   05    1542.
## 4  2020 A.12   06    9854.
## 5  2020 B.Q2   07    7654.
## 6  2020 G.T4   08    4328.
## 7  2020 E.7A   09    2310.</code></pre>
<p></p>
</div>
</div>
<div id="sec:estudo_pnad_continua" class="section level2" number="4.7">
<h2 number="4.7"><span class="header-section-number">4.7</span> Um estudo de caso: lendo os microdados da PNAD Contínua com <code>read_fwf()</code></h2>
<p>A PNAD Contínua é uma pesquisa amostral, e vem sendo realizada desde janeiro de 2012 pelo Instituto Brasileiro de Geografia e Estatística <span class="citation">(<a href="#ref-ibge_pnad" role="doc-biblioref"><em>Pesquisa Nacional Por Amostra de Domicílios Contínua: Notas técnicas</em> 2019</a>)</span>. Os principais indicadores periódicos do mercado de trabalho são extraídos dessa pesquisa, e por isso, ela representa uma das principais fontes de informação econômica e demográfica do país. Nessa seção, vamos utilizar as funções do pacote <code>readr</code> para importarmos os microdados da divulgação trimestral dessa pesquisa para o R.</p>
<p>A PNAD Contínua, é organizada em três pesquisas que possuem periodicidades diferentes, são elas: PNAD Contínua Anual, PNAD Contínua Mensal e PNAD Contínua Trimestral. Em outras palavras, ao longo do ano, existem três pesquisas da PNAD Contínua, sendo construídas ao mesmo tempo. Porém, essas três pesquisas são divulgadas em períodos diferentes do ano, empregam níveis de agregação diferentes, e buscam medir variáveis demográficas diferentes. Nessa seção, vamos focar nos microdados da divulgação trimestral da PNAD Contínua, sendo essa a principal parte da PNAD Contínua, e a mais utilizada. Você pode encontrar os microdados da PNAD Contínua Trimestral, na <a href="https://www.ibge.gov.br/estatisticas/sociais/trabalho/9171-pesquisa-nacional-por-amostra-de-domicilios-continua-mensal.html?=&amp;t=microdados">página oficial da pesquisa</a>, ou no endereço da <a href="ftp://ftp.ibge.gov.br/Trabalho_e_Rendimento/Pesquisa_Nacional_por_Amostra_de_Domicilios_continua/Trimestral/">página do servidor</a>, onde esses microdados estão hospedados.</p>
<p>Para que você possa acompanhar os comandos mostrados nessa seção, lembre-se de chamar pelo pacote <code>readr</code>, ou pelo <code>tidyverse</code> (que contém o pacote <code>readr</code>), através do comando <code>library()</code>.</p>
<p></p>
<div class="sourceCode" id="cb448"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb448-1"><a href="#cb448-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb448-2"><a href="#cb448-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code></pre></div>
<p></p>
<div id="conhecendo-a-estrutura-dos-microdados" class="section level3" number="4.7.1">
<h3 number="4.7.1"><span class="header-section-number">4.7.1</span> Conhecendo a estrutura dos microdados</h3>
<p>Antes de importarmos esses dados, precisamos conhecer a estrutura do arquivo que contém esses dados. Ou seja, precisamos saber qual a extensão desse arquivo, e de que maneira os dados estão organizados dentro desse arquivo. Como exemplo, eu fui até a <a href="https://www.ibge.gov.br/estatisticas/sociais/trabalho/9171-pesquisa-nacional-por-amostra-de-domicilios-continua-mensal.html?=&amp;t=microdados">página oficial da pesquisa</a>, e baixei os microdados do primeiro trimestre de 2020. O arquivo veio compactado (<code>.zip</code>), e por isso, eu o descompactei para que tivéssemos acesso ao arquivo bruto que contém os microdados, mostrado na figura 3.7.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/arquivos_PNAD.png" alt="Arquivo contendo os microdados da PNAD Contínua - 1° Trimestre de 2020" width="75%" />
<p class="caption">
(#fig:unnamed-chunk-200)Arquivo contendo os microdados da PNAD Contínua - 1° Trimestre de 2020
</p>
</div>
<p></p>
<p>Como podemos ver pela figura 3.7, o arquivo é um simples documento de texto (extensão <code>.txt</code>), e todas as funções de importação do pacote <code>readr</code> são capazes de ler este tipo de arquivo. Porém, ainda temos que identificar o tipo, ou a estrutura desse documento de texto. Em outras palavras, precisamos compreender como esses dados estão organizados dentro desse arquivo. Será que os valores de cada coluna são separados por vírgulas (<code>.csv</code>)? por ponto e vírgula (<code>.csv</code>)? por tabulação (<code>.tsv</code>)? Para descobrirmos, precisamos dar uma olhada no arquivo.</p>
<p>Porém, o tamanho do arquivo é considerável (aproximadamente 222 MB). Isso nos dá a entender que a base de dados contida nesse arquivo, é relativamente grande. Como nós queremos dar apenas uma olhada, talvez seja mais interessante lermos apenas as 5 primeiras linhas do arquivo. As funções de importação do pacote <code>readr</code>, geralmente possuem um argumento <code>n_max</code>, onde podemos configurar o número máximo de linhas a serem lidas do arquivo. Portanto, ao aplicarmos a função <code>read_csv()</code> abaixo, podemos ver as cinco primeiras linhas do arquivo. A primeira coisa que podemos abstrair do resultado, é que o arquivo de texto parece uma muralha de números, e aparentemente não se encaixa em nenhuma das hipóteses anteriores.</p>
<p></p>
<div class="sourceCode" id="cb449"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb449-1"><a href="#cb449-1" aria-hidden="true" tabindex="-1"></a><span class="fu">read_csv</span>(</span>
<span id="cb449-2"><a href="#cb449-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;C:/Users/Pedro/Downloads/PNADC_012020/PNADC_012020.txt&quot;</span>,</span>
<span id="cb449-3"><a href="#cb449-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_max =</span> <span class="dv">5</span></span>
<span id="cb449-4"><a href="#cb449-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p></p>
<pre><code>## # A tibble: 5 x 1
##   `202011111  11000001611100110107511000098.75663631000139.734222300005349~
##   &lt;chr&gt;                                              
## 1 202011111  11000001611100110107511000098.75663631000139.7342223000053491~
## 2 202011111  11000001611100110107511000098.75663631000139.7342223000053491~
## 3 202011111  11000001611100110107511000098.75663631000139.7342223000053491~
## 4 202011111  11000001611100110307511000098.75663631000139.7342223000053491~
## 5 202011111  11000001611100110307511000098.75663631000139.7342223000053491~</code></pre>
<p>Esse é um exemplo de arquivo chamado de <em>fixed width file</em> (<code>.fwf</code>), ou “arquivo de largura fixa.” Provavelmente, o principal motivo pelo qual o IBGE decidiu adotar esse formato de arquivo na divulgação de seus dados, está no fato de que arquivos desse tipo, são muito mais rápidos de se ler em programas, do que um arquivo CSV tradicional. Pois os valores de cada coluna em um arquivo <em>fixed width file</em>, se encontram sempre nos mesmos lugares ao longo do arquivo. Em contrapartida, esse tipo de arquivo, torna a sua vida mais difícil, pois você precisa especificar a largura, ou o número de caracteres presentes em cada coluna, para a função que será responsável por ler esse arquivo.</p>
<p>Ou seja, nesse tipo arquivo, não há qualquer tipo de valor ou especificação responsável por delimitar as colunas da base de dados. O arquivo simplesmente contém todos os valores, um do lado do outro. Será sua tarefa, dizer ao programa (no nosso caso, o R) quantos caracteres estão presentes em cada coluna, ou em outras palavras, definir em quais caracteres estão as “quebras” de colunas.</p>
<p>Isso significa, que você irá precisar de um dicionário desses dados, contendo as especificações de cada coluna dessa base de dados. No caso da PNAD Contínua, são oferecidos: 1) o dicionário das variáveis (geralmente em uma planilha do Excel, com extensão <code>.xls</code>), que contém uma descrição completa de cada variável (ou coluna) presente na base; 2) e o arquivo de texto <code>input</code>, que contém as especificações para a importação da base. Você pode baixar esses arquivos separadamente, na <a href="ftp://ftp.ibge.gov.br/Trabalho_e_Rendimento/Pesquisa_Nacional_por_Amostra_de_Domicilios_continua/Trimestral/">página do servidor</a> em que os microdados são hospedados, ou então, você pode baixar um ZIP (<code>Dicionario_input.zip</code>) desses arquivos neste <a href="https://www.ibge.gov.br/estatisticas/downloads-estatisticas.html?caminho=Trabalho_e_Rendimento/Pesquisa_Nacional_por_Amostra_de_Domicilios_continua/Trimestral/Microdados/Documentacao">link</a>. Logo abaixo, na figura 3.8, temos uma foto desses arquivos em meu computador.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/arquivos_input_pnad.png" alt="Arquivos input e dicionário da PNAD Contínua" width="75%" />
<p class="caption">
(#fig:unnamed-chunk-202)Arquivos input e dicionário da PNAD Contínua
</p>
</div>
<p></p>
<p>Entretanto, para surpresa de muitos, o arquivo de texto <code>input</code> (que geralmente assume o nome de <code>input_PNADC_trimestral.txt</code>), é na verdade, um <em>script</em> de importação utilizado pelo programa estatístico SAS<a href="#fn10" class="footnote-ref" id="fnref10"><sup>10</sup></a>. O SAS é um programa estatístico pago, parecido com o seu concorrente SPSS<a href="#fn11" class="footnote-ref" id="fnref11"><sup>11</sup></a>, sendo um programa mais popular no mercado americano. Logo, se você estivesse trabalhando com o programa SAS, você já teria um <em>script</em> pronto para importar os microdados da PNAD Contínua. Como não é o nosso caso, temos que extrair, a partir desse <em>script</em> de SAS, as especificações de cada coluna.</p>
</div>
<div id="extraindo-especificações-de-um-script-sas" class="section level3" number="4.7.2">
<h3 number="4.7.2"><span class="header-section-number">4.7.2</span> Extraindo especificações de um <em>script</em> SAS</h3>
<p>Como veremos mais a frente, extrair as especificações desse <em>script</em> é uma tarefa simples, e existem hoje, diversas ferramentas que podemos utilizar para rapidamente extrairmos essas informações do <em>script</em>, sem a necessidade de um trabalho manual. Porém, antes de partirmos para a prática, precisamos primeiro, compreender a estrutura do <em>script</em> de SAS, presente nesse arquivo <em>input</em> (<code>input_PNADC_trimestral</code>). Na figura 3.9, temos um resumo que descreve essa estrutura.</p>
<p>O <em>script</em>, ou mais especificamente, os comandos que definem a importação dos dados, se inicia pelo termo <code>input</code>, logo, estamos interessados em todas as configurações feitas após esse termo. As especificações de cada coluna, são compostas por 3 itens principais: 1) a posição inicial dessa coluna (ou a posição do caractere que inicia essa coluna); 2) o nome dessa coluna; e 3) a largura dessa coluna, ou em outras palavras, a quantidade de caracteres presentes em cada linha dessa coluna. Para o nosso objetivo, precisamos extrair os dois últimos componentes (o nome e a largura da coluna), além de definirmos se essa coluna é numérica ou textual, que é determinado pela presença ou não de um cifrão (<code>$</code>) ao lado da largura da coluna, no <em>script</em>.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/estrutura_script_sas.png" alt="Resumo da estrutura de um script de importação do SAS" width="85%" />
<p class="caption">
(#fig:unnamed-chunk-203)Resumo da estrutura de um script de importação do SAS
</p>
</div>
<p></p>
<p>A melhor forma de organizarmos essas especificações, é criarmos uma tabela, onde cada linha corresponde a uma coluna dos microdados, e cada coluna dessa tabela contém uma das especificações (nome da coluna, largura da coluna, é numérica ou textual?) de cada coluna dos microdados. Para construir essa tabela, eu costumo utilizar macros de um programa de edição de texto (como o Notepad++<a href="#fn12" class="footnote-ref" id="fnref12"><sup>12</sup></a>) sobre o arquivo <code>input</code> (<code>input_PNADC_trimestral.txt</code>), de forma a eliminar os textos irrelevantes, e arrumar as especificações na estrutura de um arquivo CSV (<code>.csv</code>). Dessa forma, eu posso importar esse arquivo CSV resultante para o R, e adquirir a tabela que desejo. Como um guia, você pode ter acesso a esse arquivo CSV, através da cópia que deixei no .</p>
<p>Portanto, após extrair as especificações de cada coluna do arquivo <code>input</code>, eu tenho como resultado, um arquivo CSV chamado <code>widths.txt</code>, que eu posso ler através da função <code>read_csv()</code>. Veja pelo resultado abaixo, que eu defini três colunas nesse arquivo CSV. A coluna <code>variavel</code> possui os nomes da colunas, na ordem em que elas aparecem no <em>script</em> do arquivo <code>input</code>, e portanto, nos microdados. A coluna <code>width</code> possui o número de caracteres presentes em cada uma dessas colunas. Já a coluna <code>char</code>, possui um valor lógico, indicando se os dados contidos nessa coluna, devem ser interpretados como texto (<code>TRUE</code>), ou como números (<code>FALSE</code>).</p>
<p></p>
<div class="sourceCode" id="cb451"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb451-1"><a href="#cb451-1" aria-hidden="true" tabindex="-1"></a>col_width <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(</span>
<span id="cb451-2"><a href="#cb451-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;C:/Users/Pedro/Downloads/PNADC_012020/widths.txt&quot;</span>, </span>
<span id="cb451-3"><a href="#cb451-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">col_names =</span> <span class="fu">c</span>(<span class="st">&quot;variavel&quot;</span>, <span class="st">&quot;width&quot;</span>, <span class="st">&quot;char&quot;</span>)</span>
<span id="cb451-4"><a href="#cb451-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p></p>
<pre><code>## -- Column specification --------------------------------
## cols(
##   variavel = col_character(),
##   width = col_double(),
##   char = col_logical()
## )</code></pre>
<p></p>
<div class="sourceCode" id="cb453"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb453-1"><a href="#cb453-1" aria-hidden="true" tabindex="-1"></a>col_width</span></code></pre></div>
<p></p>
<pre><code>## # A tibble: 217 x 3
##    variavel  width char 
##    &lt;chr&gt;     &lt;dbl&gt; &lt;lgl&gt;
##  1 Ano           4 TRUE 
##  2 Trimestre     1 TRUE 
##  3 UF            2 TRUE 
##  4 Capital       2 TRUE 
##  5 RM_RIDE       2 TRUE 
##  6 UPA           9 TRUE 
##  7 Estrato       7 TRUE 
##  8 V1008         2 TRUE 
##  9 V1014         2 TRUE 
## 10 V1016         1 TRUE 
## # ... with 207 more rows</code></pre>
</div>
<div id="o-pacote-sascii-como-um-atalho-útil" class="section level3" number="4.7.3">
<h3 number="4.7.3"><span class="header-section-number">4.7.3</span> O pacote <code>SAScii</code> como um atalho útil</h3>
<p>O pacote <code>SAScii</code> nos oferece um conjunto de funções voltadas para a importação de arquivos <em>fixed width file</em>. Porém, o pacote também nos oferece uma função capaz de converter <em>scripts</em> de importação do programa SAS, e extrair as especificações de cada coluna em um <code>data.frame</code>. Ou seja, podemos utilizar a função <code>parse.SAScii()</code> para extrairmos as especificações de cada coluna do <em>script</em> presente no arquivo <code>input</code>.</p>
<p>Essa função é bem simples, e possui dois argumentos principais: 1) <code>sas_ri</code>, o endereço até o arquivo contendo o <em>script</em> de SAS a ser convertido; 2) <code>beginline</code>, a linha do arquivo em que o <em>script</em> de importação se inicia, ou em outras palavras, a linha do <em>script</em> onde o termo <code>input</code> aparece. Como podemos ver pela figura 3.10, eu abri o arquivo <code>input</code> em meu Notepad++, que possui na lateral esquerda, a numeração de cada linha. Dessa forma, eu posso rapidamente identificar que o termo <code>input</code> aparece na linha 18 do arquivo.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/input_PNAD_linha_mod.png" alt="Início do script de importação" width="70%" />
<p class="caption">
(#fig:unnamed-chunk-207)Início do script de importação
</p>
</div>
<p></p>
<p>Com essas informações em mente, eu poderia gerar a tabela <code>col_width</code>, através dos seguintes comandos:</p>
<p></p>
<div class="sourceCode" id="cb455"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb455-1"><a href="#cb455-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(SAScii)</span>
<span id="cb455-2"><a href="#cb455-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tibble)</span></code></pre></div>
<p></p>
<p></p>
<div class="sourceCode" id="cb456"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb456-1"><a href="#cb456-1" aria-hidden="true" tabindex="-1"></a>col_width <span class="ot">&lt;-</span> <span class="fu">parse.SAScii</span>(</span>
<span id="cb456-2"><a href="#cb456-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;C:/Users/Pedro/Downloads/PNADC_012020/input_PNADC_trimestral.txt&quot;</span>,</span>
<span id="cb456-3"><a href="#cb456-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">beginline =</span> <span class="dv">18</span></span>
<span id="cb456-4"><a href="#cb456-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p></p>
<p></p>
<div class="sourceCode" id="cb457"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb457-1"><a href="#cb457-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as_tibble</span>(col_width)</span></code></pre></div>
<pre><code>## # A tibble: 217 x 4
##    varname   width char  divisor
##    &lt;chr&gt;     &lt;dbl&gt; &lt;lgl&gt;   &lt;dbl&gt;
##  1 ANO           4 TRUE        1
##  2 TRIMESTRE     1 TRUE        1
##  3 UF            2 TRUE        1
##  4 CAPITAL       2 TRUE        1
##  5 RM_RIDE       2 TRUE        1
##  6 UPA           9 TRUE        1
##  7 ESTRATO       7 TRUE        1
##  8 V1008         2 TRUE        1
##  9 V1014         2 TRUE        1
## 10 V1016         1 TRUE        1
## # ... with 207 more rows</code></pre>
<p></p>
</div>
<div id="importando-os-microdados-da-pnad-contínua" class="section level3" number="4.7.4">
<h3 number="4.7.4"><span class="header-section-number">4.7.4</span> Importando os microdados da PNAD Contínua</h3>
<p>Agora que possuímos as especificações necessárias de cada coluna, podemos começar o processo de importação dos microdados da PNAD Contínua. Como esses microdados estão estruturados em um arquivo de texto do tipo <em>fixed width file</em> (<code>.fwf</code>), podemos utilizar a função <code>read_fwf()</code> para ler o arquivo. Pois como o próprio nome dessa função dá a entender, ela é especializada nesse tipo de arquivo.</p>
<p>O primeiro argumento (<code>file</code>) dessa função, é o caminho até o arquivo a ser importado. Já o segundo argumento (<code>col_positions</code>), será o local onde vamos fornecer as especificações de cada coluna. Entretanto, nós precisamos utilizar uma função como a <code>fwf_widths()</code>, para definirmos essas especificações no argumento <code>col_positions</code>. Na função <code>fwf_widths()</code> temos apenas dois argumentos, que são <code>widths</code> e <code>col_names</code>. Basta fornecermos ao argumento <code>widths</code>, as larguras de cada coluna, e ao argumento <code>col_names</code>, os nomes de cada coluna, como no exemplo abaixo.</p>
<p></p>
<div class="sourceCode" id="cb459"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb459-1"><a href="#cb459-1" aria-hidden="true" tabindex="-1"></a>pnad_continua <span class="ot">&lt;-</span> <span class="fu">read_fwf</span>(</span>
<span id="cb459-2"><a href="#cb459-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;C:/Users/Pedro/Downloads/PNADC_012020/PNADC_012020.txt&quot;</span>,</span>
<span id="cb459-3"><a href="#cb459-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">col_positions =</span> <span class="fu">fwf_widths</span>(col_width<span class="sc">$</span>width, <span class="at">col_names =</span> col_width<span class="sc">$</span>variavel)</span>
<span id="cb459-4"><a href="#cb459-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p></p>
<pre><code>## -- Column specification -------------------------------------
## cols(
##   .default = col_double(),
##   RM_RIDE = col_logical(),
##   V1008 = col_character(),
##   V1014 = col_character(),
##   V1027 = col_character(),
##   V1028 = col_character(),
##   V1029 = col_character(),
##   V2001 = col_character(),
##   V2003 = col_character(),
##   V2005 = col_character(),
##   V2008 = col_character(),
##   V20081 = col_character(),
##   V2009 = col_character(),
##   `3003` = col_logical(),
##   V3003A = col_character(),
##   V3004 = col_logical(),
##   V3005 = col_logical(),
##   V3006 = col_character(),
##   V3009 = col_logical(),
##   V3009A = col_character(),
##   V3011 = col_logical()
## # ... with 87 more columns
## )
## i Use `spec()` for the full column specifications.
## Warning: 156486 parsing failures.
## row  col               expected actual   file
## 1670 V40431  1/0/T/F/TRUE/FALSE 2        &#39;C:/Users/Pedro/Downloads/PNADC~&#39;
## 2194 V4057   1/0/T/F/TRUE/FALSE 2        &#39;C:/Users/Pedro/Downloads/PNADC_~&#39;
## 2194 V405811 1/0/T/F/TRUE/FALSE 3        &#39;C:/Users/Pedro/Downloads/PNADC~&#39;
## 2194 V405812 1/0/T/F/TRUE/FALSE 00001200 &#39;C:/Users/Pedro/Downloads/PNADC~&#39;
## 2194 V405912 1/0/T/F/TRUE/FALSE 00000000 &#39;C:/Users/Pedro/Downloads/PNADC~&#39;
## .... ....... .................. ........ .........................
## See problems(...) for more details.</code></pre>
<p>Como podemos ver acima, pela mensagem de <em>parsing failures</em>, obtivemos alguns problemas durante a importação. Isso ocorre, pois a função <code>read_fwf()</code> está tendo que adivinhar sozinha, quais são os tipos de dados contidos em cada coluna dos microdados. Lembre-se que por padrão, se não fornecemos uma descrição dos tipos de dados de cada coluna a qualquer função do pacote <code>readr</code>, essas funções vão automaticamente ler as 1000 primeiras linhas de cada coluna, e se basear nesses 1000 valores para determinar o tipo de dado incluso em cada coluna do arquivo.</p>
<p>Esse sistema automático, apesar de útil, se torna frágil a medida em que o tamanho da nossa base cresce. Pois essas 1000 linhas vão representar uma parte cada vez menor da base, e, portanto, podem não ser suficientes para determinar com precisão o tipo de dado contido em cada coluna. No nosso exemplo, a base da PNAD possui 487 mil linhas, logo, essas 1000 linhas representam apenas 0,2% da base. Se a função não está sendo capaz de adivinhar corretamente, os tipos de dados de cada coluna, nós precisamos dizer a ela exatamente quais são esses tipos. Para isso, vamos utilizar os dados contidos na coluna <code>char</code>, da nossa tabela <code>col_width</code>.</p>
<p>As funções de importação do pacote <code>readr</code>, possuem o argumento <code>col_types</code>, onde podemos definir os tipos de cada coluna. Essa definição pode ser fornecida, utilizando-se a função <code>cols()</code>. Porém, para o nosso caso, creio que será mais prático, utilizarmos um método alternativo que o argumento <code>col_types</code> disponibiliza. Esse método alternativo, consiste em fornecermos um vetor de letras, contendo a primeira letra de cada tipo. Essas letras devem estar na ordem em que as colunas aparecem em seus dados. Logo, se eu fornecer o vetor <code>"ccdlcdd"</code>, a função irá interpretar a primeira e a segunda coluna como dados do tipo <code>character</code>, enquanto a terceira e a quarta coluna serão interpretadas como dados dos tipos <code>double</code> e <code>logical</code>, respectivamente.</p>
<p>Primeiro, precisamos construir esse vetor de letras, que indicam o tipo de cada coluna. Com os dados da nossa tabela <code>col_width</code>, nós já sabemos que todo valor <code>TRUE</code> na coluna <code>char</code>, indica uma coluna de texto, e, portanto, essa coluna deve ser interpretada como uma coluna do tipo <code>character</code>. Já os valores <code>FALSE</code> indicam uma coluna numérica, e por isso, essa coluna deve ser interpretada como uma coluna do tipo <code>double</code>. Com isso, podemos utilizar a função <code>ifelse()</code>, para construírmos um vetor inicial de letras, baseado nos valores da coluna <code>char</code>. Em seguida, podemos juntar todas essas letras em um <em>string</em> só, com a função <code>paste()</code>.</p>
<p></p>
<div class="sourceCode" id="cb461"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb461-1"><a href="#cb461-1" aria-hidden="true" tabindex="-1"></a>tipos <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(col_width<span class="sc">$</span>char <span class="sc">==</span> <span class="cn">TRUE</span>, <span class="st">&quot;c&quot;</span>, <span class="st">&quot;d&quot;</span>)</span>
<span id="cb461-2"><a href="#cb461-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb461-3"><a href="#cb461-3" aria-hidden="true" tabindex="-1"></a>tipos <span class="ot">&lt;-</span> <span class="fu">paste</span>(tipos, <span class="at">collapse =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb461-4"><a href="#cb461-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb461-5"><a href="#cb461-5" aria-hidden="true" tabindex="-1"></a>tipos</span></code></pre></div>
<p></p>
<pre><code>[1] &quot;ccccccccccccdddcdccccccdcccccccccccccccccccccccccccccccccccccccccccc
cccccccccccccccccccccccccccdccdcccccdccdddcdddccccccccccccdccdcccccdccddd
ccccdccdccccccdcddcccccccccccccdddcccccdcccccccccccccccccccddcddccdddddcc&quot;</code></pre>
<p>Agora com o vetor <code>tipos</code>, podemos fornecê-lo ao argumento <code>col_types</code> e realizar novamente o processo de importação, com os tipos das colunas sendo corretamente interpretados. Porém, repare que mesmo definindo os tipos das colunas, obtivemos novamente erros durante o processo de importação. Dessa vez, foram mais de 2 milhões de erros. Isso não significa necessariamente que o nosso processo de importação esteja incorretamente especificado. Porém, nós deveríamos pelo menos compreender o porquê esses erros ocorrem.</p>
<p></p>
<div class="sourceCode" id="cb463"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb463-1"><a href="#cb463-1" aria-hidden="true" tabindex="-1"></a>pnad_continua <span class="ot">&lt;-</span> <span class="fu">read_fwf</span>(</span>
<span id="cb463-2"><a href="#cb463-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;C:/Users/Pedro/Downloads/PNADC_012020/PNADC_012020.txt&quot;</span>,</span>
<span id="cb463-3"><a href="#cb463-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">col_positions =</span> <span class="fu">fwf_widths</span>(col_width<span class="sc">$</span>width, <span class="at">col_names =</span> col_width<span class="sc">$</span>variavel), </span>
<span id="cb463-4"><a href="#cb463-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">col_types =</span> tipos</span>
<span id="cb463-5"><a href="#cb463-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p></p>
<pre><code>## Warning: 2032039 parsing failures.
## row    col expected actual                                              file
##   1 VD4032 a double      . &#39;C:/Users/Pedro/Downloads/PNADC_012020/PNADC_01~&#39;
##   1 VD4033 a double      . &#39;C:/Users/Pedro/Downloads/PNADC_012020/PNADC_01~&#39;
##   1 VD4034 a double      . &#39;C:/Users/Pedro/Downloads/PNADC_012020/PNADC_01~&#39;
##   2 VD4031 a double      . &#39;C:/Users/Pedro/Downloads/PNADC_012020/PNADC_01~&#39;
##   2 VD4032 a double      . &#39;C:/Users/Pedro/Downloads/PNADC_012020/PNADC_01~&#39;
## ... ...... ........ ...... ................................................
## See problems(...) for more details.</code></pre>
</div>
<div id="analisando-erros-de-importação" class="section level3" number="4.7.5">
<h3 number="4.7.5"><span class="header-section-number">4.7.5</span> Analisando erros de importação</h3>
<p>Nós podemos obter através da função <code>problems()</code>, uma tabela contendo todos os erros que ocorreram durante esse processo de importação. Precisamos apenas fornecer a essa função, os comandos que geraram esses problemas, como no exemplo abaixo.</p>
<p></p>
<div class="sourceCode" id="cb465"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb465-1"><a href="#cb465-1" aria-hidden="true" tabindex="-1"></a>problemas <span class="ot">&lt;-</span> <span class="fu">problems</span>(</span>
<span id="cb465-2"><a href="#cb465-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_fwf</span>(</span>
<span id="cb465-3"><a href="#cb465-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;C:/Users/Pedro/Downloads/PNADC_012020/PNADC_012020.txt&quot;</span>,</span>
<span id="cb465-4"><a href="#cb465-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">col_positions =</span> <span class="fu">fwf_widths</span>(col_width<span class="sc">$</span>width, <span class="at">col_names =</span> col_width<span class="sc">$</span>variavel), </span>
<span id="cb465-5"><a href="#cb465-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">col_types =</span> tipos</span>
<span id="cb465-6"><a href="#cb465-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb465-7"><a href="#cb465-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb465-8"><a href="#cb465-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb465-9"><a href="#cb465-9" aria-hidden="true" tabindex="-1"></a>problemas</span></code></pre></div>
<p></p>
<pre><code>## # A tibble: 2,032,039 x 5
##      row col    expected   actual file
##    &lt;int&gt; &lt;chr&gt;  &lt;chr&gt;      &lt;chr&gt;  &lt;chr&gt;        
##  1     1 VD4032 a double   .      &#39;C:/Users/Pedro/Downloads/PNADC_012020/PNAD~
##  2     1 VD4033 a double   .      &#39;C:/Users/Pedro/Downloads/PNADC_012020/PNAD~
##  3     1 VD4034 a double   .      &#39;C:/Users/Pedro/Downloads/PNADC_012020/PNAD~
##  4     2 VD4031 a double   .      &#39;C:/Users/Pedro/Downloads/PNADC_012020/PNAD~
##  5     2 VD4032 a double   .      &#39;C:/Users/Pedro/Downloads/PNADC_012020/PNAD~
##  6     2 VD4033 a double   .      &#39;C:/Users/Pedro/Downloads/PNADC_012020/PNAD~
##  7     2 VD4034 a double   .      &#39;C:/Users/Pedro/Downloads/PNADC_012020/PNAD~
##  8     2 VD4035 a double   .      &#39;C:/Users/Pedro/Downloads/PNADC_012020/PNAD~
##  9     3 VD4031 a double   .      &#39;C:/Users/Pedro/Downloads/PNADC_012020/PNAD~
## 10     3 VD4032 a double   .      &#39;C:/Users/Pedro/Downloads/PNADC_012020/PNAD~
## # ... with 2,032,029 more rows</code></pre>
<p>Pelo que podemos ver da coluna <code>actual</code>, parece que os erros estão ocorrendo, pela presença de um ponto final (“.”), nos locais em que deveriam estar números (<code>double</code>). Podemos utilizar a função <code>unique()</code> sobre a coluna <code>actual</code> para identificarmos se há algum outro problema que precisamos analisar. Pelo resultado abaixo, percebemos que todos os mais de 2 milhões de erros gerados, estão sendo causados por essa presença de pontos finais na base. Também podemos utilizar a função <code>unique()</code> sobre a coluna <code>col</code>, para descobrirmos em quais colunas esse erro ocorre. Vemos abaixo, que esses erros estão concentrados em cinco das últimas colunas de toda a base (a última coluna da base é VD4037).</p>
<p></p>
<div class="sourceCode" id="cb467"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb467-1"><a href="#cb467-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(problemas<span class="sc">$</span>actual)</span></code></pre></div>
<p></p>
<pre><code>## [1] &quot;.&quot;</code></pre>
<p></p>
<div class="sourceCode" id="cb469"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb469-1"><a href="#cb469-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(problemas<span class="sc">$</span>col)</span></code></pre></div>
<p></p>
<pre><code>## [1] &quot;VD4032&quot; &quot;VD4033&quot; &quot;VD4034&quot; &quot;VD4031&quot; &quot;VD4035&quot;</code></pre>
<p>Seria uma boa ideia, olharmos mais de perto como essas colunas aparecem no arquivo de microdaddos. Para determinarmos a parte do arquivo que diz respeito a essas colunas, precisamos descobrir o intervalo de caracteres que cobrem essas colunas, através dos dados da tabela <code>col_width</code>. Para isso, vamos precisar descobrir o número total de caracteres em cada linha (ou em outras palavras, a largura total da base), ao somarmos a largura de todas as colunas na tabela <code>col_width</code>. Ao longo do caminho, teremos que subtrair uma faixa desse total, para descobrirmos o caractere que inicia o intervalo de colunas que estamos interessados.</p>
<p></p>
<div class="sourceCode" id="cb471"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb471-1"><a href="#cb471-1" aria-hidden="true" tabindex="-1"></a>(total_caracteres <span class="ot">&lt;-</span> <span class="fu">sum</span>(col_width<span class="sc">$</span>width))</span></code></pre></div>
<pre><code>## [1] 464</code></pre>
<p></p>
<p>Em seguida, podemos aplicar a função <code>tail()</code> sobre a tabela <code>col_width</code>, para extrairmos as últimas linhas dessa tabela, e verificarmos as especificações das colunas que cobrem essa faixa. Pois nós sabemos que as variáveis que geraram problemas na importação, estão entre as últimas colunas dos microdados, logo, as especificações dessas colunas vão se encontrar nas últimas linhas da tabela <code>col_width</code>. Vemos abaixo, que as duas últimas colunas da base (VD4036 e VD4037), das quais não estamos interessados, possuem juntas, 2 caracteres de largura. Portanto, o intervalo que cobre as colunas que geraram os problemas na importação (VD4031-VD4035), termina no 462° caractere, como vemos abaixo. Pelo resultado de <code>tail()</code>, vemos que as colunas das quais estamos interessados (VD4031-VD4035), somam 15 caracteres de largura. Tendo isso em mente, o intervalo que cobre essas colunas, se inicia no 448° caractere.</p>
<p></p>
<div class="sourceCode" id="cb473"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb473-1"><a href="#cb473-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(col_width, <span class="dv">7</span>)</span></code></pre></div>
<pre><code>##     varname width  char divisor
## 211  VD4031     3 FALSE       1
## 212  VD4032     3 FALSE       1
## 213  VD4033     3 FALSE       1
## 214  VD4034     3 FALSE       1
## 215  VD4035     3 FALSE       1
## 216  VD4036     1  TRUE       1
## 217  VD4037     1  TRUE       1</code></pre>
<div class="sourceCode" id="cb475"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb475-1"><a href="#cb475-1" aria-hidden="true" tabindex="-1"></a>(fim_intervalo <span class="ot">&lt;-</span> total_caracteres <span class="sc">-</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] 462</code></pre>
<div class="sourceCode" id="cb477"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb477-1"><a href="#cb477-1" aria-hidden="true" tabindex="-1"></a>(inicio_intervalo <span class="ot">&lt;-</span> fim_intervalo <span class="sc">-</span> <span class="dv">15</span> <span class="sc">+</span> <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## [1] 448</code></pre>
<p></p>
<p>Portanto, nós temos agora a posição dos caracteres que iniciam e terminam o intervalo de caracteres que dizem respeito as colunas que estamos interessados. Porém, ainda precisamos calcular os caracteres de início e de fim de cada uma das cinco colunas (VD4031-VD4035), que cobrem esse intervalor. Para esse trabalho, podemos aplicar uma simples aritmética, como a aplicada pelo código abaixo.</p>
<p></p>
<div class="sourceCode" id="cb479"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb479-1"><a href="#cb479-1" aria-hidden="true" tabindex="-1"></a>(inicio <span class="ot">&lt;-</span> (<span class="dv">0</span><span class="sc">:</span><span class="dv">4</span> <span class="sc">*</span> <span class="dv">3</span>) <span class="sc">+</span> inicio_intervalo)</span></code></pre></div>
<pre><code>## [1] 448 451 454 457 460</code></pre>
<div class="sourceCode" id="cb481"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb481-1"><a href="#cb481-1" aria-hidden="true" tabindex="-1"></a>(fim <span class="ot">&lt;-</span> (<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span> <span class="sc">*</span> <span class="dv">3</span>) <span class="sc">+</span> inicio_intervalo <span class="sc">-</span> <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## [1] 450 453 456 459 462</code></pre>
<p></p>
<p>Agora que nós temos as posições dos caracteres que iniciam e que terminam cada uma das cinco colunas, podemos importar apenas essas cinco colunas ao R. Para isso, podemos usar novamente a função <code>read_fwf()</code>, aliada à função <code>fwf_positions()</code>. Ou seja, utilizamos anteriormente a função <code>fwf_widths()</code> para determinarmos as especificações de todas as colunas da base. Porém, como nós queremos importar apenas uma parte dessa base, vamos utilizar a função <code>fwf_positions()</code> para determinarmos as especificações dessas colunas desejadas.</p>
<p>Na função <code>fwf_positions()</code>, temos três argumentos principais: 1) <code>start</code>, um vetor contendo as posições dos caracteres que iniciam cada coluna; 2) <code>end</code>, um vetor contendo as posições dos caracteres que terminam cada coluna; 3) <code>col_names</code>, um vetor contendo os nomes dessas colunas selecionadas. Tendo esses argumentos em mente, podemos importar as cinco colunas da seguinte maneira:</p>
<p></p>
<div class="sourceCode" id="cb483"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb483-1"><a href="#cb483-1" aria-hidden="true" tabindex="-1"></a>colunas <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;VD4031&quot;</span>,<span class="st">&quot;VD4032&quot;</span>,<span class="st">&quot;VD4033&quot;</span>,<span class="st">&quot;VD4034&quot;</span>,<span class="st">&quot;VD4035&quot;</span>)</span>
<span id="cb483-2"><a href="#cb483-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb483-3"><a href="#cb483-3" aria-hidden="true" tabindex="-1"></a>conferir <span class="ot">&lt;-</span> <span class="fu">read_fwf</span>(</span>
<span id="cb483-4"><a href="#cb483-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;C:/Users/Pedro/Downloads/PNADC_012020/PNADC_012020.txt&quot;</span>,</span>
<span id="cb483-5"><a href="#cb483-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">col_positions =</span> <span class="fu">fwf_positions</span>(</span>
<span id="cb483-6"><a href="#cb483-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">start =</span> inicio,</span>
<span id="cb483-7"><a href="#cb483-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">end =</span> fim,</span>
<span id="cb483-8"><a href="#cb483-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">col_names =</span> colunas</span>
<span id="cb483-9"><a href="#cb483-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb483-10"><a href="#cb483-10" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p></p>
<pre><code>## -- Column specification ------------------------------------
## cols(
##   VD4031 = col_character(),
##   VD4032 = col_character(),
##   VD4033 = col_character(),
##   VD4034 = col_character(),
##   VD4035 = col_character()
## )</code></pre>
<p>Logo abaixo, temos o resultado do intervalo que selecionamos do arquivo, em que podemos ver o grupo de pontos finais que estão causando o problema. Agora, temos que identificar o motivo desses pontos estarem aí. Se nós retornarmos às especificações dessas colunas apresentadas na tabela <code>col_width</code>, nós sabemos que essas colunas são colunas numéricas. Será que esses pontos estão aí, para marcar as casas decimais dos números dessa coluna?</p>
<p>Talvez não seja esse o caso. Pois se esses pontos estivessem de fato, marcando as casas decimais, porque eles não aparecem na primeira linha das colunas VD4031 e VD4035? Isto é, por que o valor 040 que aparece nessas colunas, não se apresenta como 0.40, ou 04.0, ou 40.0 na tabela <code>conferir</code>? Lembre-se que os valores da tabela <code>conferir</code>, são apresentados exatamente da forma como eles se apresentam no arquivo dos microdados, pois todas essas colunas estão sendo interpretadas como <code>character</code>. Ou seja, esses valores que eram meros textos no arquivo dos microdados, continuam sendo textos no R, de forma que não houve nenhuma conversão desses valores.</p>
<p></p>
<div class="sourceCode" id="cb485"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb485-1"><a href="#cb485-1" aria-hidden="true" tabindex="-1"></a>conferir</span></code></pre></div>
<p></p>
<pre><code>## # A tibble: 487,937 x 5
##    VD4031 VD4032 VD4033 VD4034 VD4035
##    &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt; 
##  1 040    .      .      .      040   
##  2 .      .      .      .      .     
##  3 .      .      .      .      .     
##  4 .      .      .      .      .     
##  5 .      .      .      .      .     
##  6 040    .      .      .      040   
##  7 .      .      .      .      .     
##  8 .      .      .      .      .     
##  9 .      .      .      .      .     
## 10 040    .      .      .      040   
## # ... with 487,927 more rows</code></pre>
<p>Pela visão que temos até o momento, parece que as colunas VD4032, VD4033 e VD4034, estão vazias, de forma que elas possuem apenas pontos finais em toda a sua extensão. Talvez seja o momento de verificarmos essa hipótese. Podemos fazer isso, novamente por meio da função <code>unique()</code>. Pelos resultados abaixo, as colunas VD4032, VD4033 e VD4034 estão de fato vazias. Com isso, temos a seguinte questão: por que uma coluna numérica está preenchida com pontos? Se esses pontos não estão marcando as casas decimais em cada linha, é mais provável que esses pontos estejam ali simplesmente para marcar um valor vazio, ou uma observação que não pôde ser mensurada.</p>
<p></p>
<div class="sourceCode" id="cb487"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb487-1"><a href="#cb487-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(conferir<span class="sc">$</span>VD4032)</span></code></pre></div>
<p></p>
<pre><code>## [1] &quot;.&quot;</code></pre>
<p></p>
<div class="sourceCode" id="cb489"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb489-1"><a href="#cb489-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(conferir<span class="sc">$</span>VD4033)</span></code></pre></div>
<p></p>
<pre><code>## [1] &quot;.&quot;</code></pre>
<p></p>
<div class="sourceCode" id="cb491"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb491-1"><a href="#cb491-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(conferir<span class="sc">$</span>VD4034)</span></code></pre></div>
<p></p>
<pre><code>## [1] &quot;.&quot;</code></pre>
<p>Em resumo, nós sabemos pelas especificações das colunas presentes no arquivo <code>input</code>, que as colunas VD4032, VD4033 e VD4034 devem ser interpretadas como colunas numéricas. Ao que tudo indica, esses pontos não possuem o propósito de delimitar as casas decimais. Seria apropriado encontrarmos alguma documentação que nos pudesse guiar sobre esses questionamentos. Porém, até onde pesquisei, não há qualquer menção a esses pontos ao longo da documentação do IBGE sobre esses microdados. Com as informações que possuímos, só podemos inferir que esses valores estão servindo para marcar valores não-disponíveis (em outras palavras, estão cumprindo o papel de um valor <code>NA</code>) nessas colunas.</p>
<p>Tendo essas considerações em mente, todos esses pontos presentes nessas colunas, devido ao erro que eles incorrem durante o processo de importação, serão convertidos para valores <code>NA</code> ao importarmos a base, e, portanto, vão representar observações não-disponíveis na base. Ou seja, se a função <code>read_fwf()</code> não consegue interpretar corretamente um valor, ele acaba sendo convertido para um valor <code>NA</code>.</p>
<p></p>
<div class="sourceCode" id="cb493"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb493-1"><a href="#cb493-1" aria-hidden="true" tabindex="-1"></a>pnad_continua <span class="ot">&lt;-</span> <span class="fu">read_fwf</span>(</span>
<span id="cb493-2"><a href="#cb493-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;C:/Users/Pedro/Downloads/PNADC_012020/PNADC_012020.txt&quot;</span>,</span>
<span id="cb493-3"><a href="#cb493-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">col_positions =</span> <span class="fu">fwf_widths</span>(col_width<span class="sc">$</span>width, <span class="at">col_names =</span> col_width<span class="sc">$</span>variavel), </span>
<span id="cb493-4"><a href="#cb493-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">col_types =</span> tipos</span>
<span id="cb493-5"><a href="#cb493-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p></p>
</div>
</div>
<div id="exportando-os-seus-dados-com-o-pacote-readr" class="section level2" number="4.8">
<h2 number="4.8"><span class="header-section-number">4.8</span> Exportando os seus dados com o pacote <code>readr</code></h2>
<p>Mais do que importar os seus dados para dentro do R, haverá um momento em que você deseja exportar os seus resultados para fora do R, de forma que você possa enviá-los para os seus colegas de trabalho ou para utilizá-los em outros programas. Em um momento como esse, você deseja escrever um arquivo estático em seu computador, contendo esses resultados. O pacote <code>readr</code> oferece funções que permitem a escrita de um conjunto de arquivos de texto. Logo abaixo, temos uma lista relacionando os tipos de arquivos de texto às respectivas funções do pacote:</p>
<ol style="list-style-type: decimal">
<li><p><code>write_csv2()</code>: constrói um arquivo CSV, segundo o padrão adotado por alguns países europeus; utilizando pontos e vírgulas (<code>;</code>) como separador.</p></li>
<li><p><code>write_csv()</code>: constrói um arquivo CSV, segundo o padrão americano; utilizando vírgulas (<code>,</code>) como separador.</p></li>
<li><p><code>write_tsv()</code>: constrói um arquivo TSV.</p></li>
<li><p><code>write_delim()</code>: função geral onde você pode definir o caractere a ser utilizado como separador no arquivo de texto construído.</p></li>
</ol>
<p>Um fator muito importante sobre o pacote <code>readr</code> em geral, é que todas as suas funções utilizam o <em>encoding</em> UTF-8 o tempo todo. Logo, ao utilizar essas funções para exportar os seus dados, lembre-se sempre que os arquivos construídos por essas funções vão estar utilizando o <em>encoding</em> UTF-8. Isso significa que ao utilizar esses arquivos em outros programas como o Excel, você precisa informar ao programa para utilizar o <em>encoding</em> UTF-8 ao ler o arquivo.</p>
<p>Para além disso, você não terá nenhum outro problema com esses arquivos. Porém, caso você se sinta incomodado com esse comportamento, você pode utilizar as variantes dessas funções presentes nos pacotes básicos do R (<code>write.csv2()</code>, <code>write.csv()</code>, <code>write.table()</code>). Pois essas funções variantes vão escrever o arquivo definido, de acordo com o <em>encoding</em> padrão de seu sistema.</p>
<p>O primeiro argumento (<code>x</code>) dessas funções, se trata do nome do objeto em sua sessão que contém os dados que você deseja exportar. Já no segundo argumento (<code>file</code>) dessas funções, você deve definir o nome do novo arquivo estático que será construído. Por exemplo, se eu possuo uma tabela chamada, e desejo salvá-la em um arquivo chamado <code>transf.csv</code>, eu preciso construir os seguintes comandos:</p>
<p></p>
<div class="sourceCode" id="cb494"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb494-1"><a href="#cb494-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv2</span>(transf, <span class="at">file =</span> <span class="st">&quot;transf.csv&quot;</span>)</span></code></pre></div>
<p></p>
<p>Após executar os comandos acima, você irá encontrar na pasta que representa o seu diretório de trabalho atual no R, um novo arquivo chamado <code>transf.csv</code> que contém os seus dados. Vale destacar, que você pode salvar esse novo arquivo em diferentes áreas de seu computador. Basta que você forneça um endereço (absoluto ou relativo) até a pasta desejada, em conjunto com o nome do novo arquivo. Como exemplo, eu posso salvar a tabela <code>Censo_2010</code> dentro da minha área de trabalho da seguinte forma:</p>
<p></p>
<div class="sourceCode" id="cb495"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb495-1"><a href="#cb495-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv2</span>(Censo_2010, <span class="at">file =</span> <span class="st">&quot;C:/Users/Pedro/Desktop/Censo_2010.csv&quot;</span>)</span></code></pre></div>
<p></p>
</div>
<div id="sec:read_excel" class="section level2" number="4.9">
<h2 number="4.9"><span class="header-section-number">4.9</span> Importando planilhas do Excel com <code>readxl</code></h2>
<p>O Excel continua sendo um dos programas mais populares no mundo e, por essa razão, muitas pessoas ainda o utilizam para analisar dados e gerar gráficos. Tendo isso em vista, nessa seção, vamos aprender como podemos importar para o R, dados que se encontram em planilhas do Excel (<code>.xlsx</code>), através da função <code>read_excel()</code> que pertence ao pacote <code>readxl</code>.</p>
<p>O principal argumento da função <code>read_excel()</code> corresponde novamente ao endereço até o arquivo que você deseja ler, ou apenas o seu nome caso esse arquivo se encontre em seu diretório de trabalho atual.</p>
<p></p>
<div class="sourceCode" id="cb496"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb496-1"><a href="#cb496-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb496-2"><a href="#cb496-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb496-3"><a href="#cb496-3" aria-hidden="true" tabindex="-1"></a>codigos <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">&quot;codigos.xlsx&quot;</span>)</span></code></pre></div>
<p></p>
<p></p>
<div class="sourceCode" id="cb497"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb497-1"><a href="#cb497-1" aria-hidden="true" tabindex="-1"></a>codigos</span></code></pre></div>
<pre><code>## # A tibble: 853 x 4
##     IBGE1 IBGE2   SEF Municípios         
##     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;              
##  1 310010    10     1 ABADIA DOS DOURADOS
##  2 310020    20     2 ABAETÉ             
##  3 310030    30     3 ABRE CAMPO         
##  4 310040    40     4 ACAIACA            
##  5 310050    50     5 AÇUCENA            
##  6 310060    60     6 ÁGUA BOA           
##  7 310070    70     7 ÁGUA COMPRIDA      
##  8 310080    80     8 AGUANIL            
##  9 310090    90     9 ÁGUAS FORMOSAS     
## 10 310100   100    10 ÁGUAS VERMELHAS    
## # ... with 843 more rows</code></pre>
<p></p>
<div id="delimitando-a-parte-de-seu-arquivo-.xlsx" class="section level3" number="4.9.1">
<h3 number="4.9.1"><span class="header-section-number">4.9.1</span> Delimitando a parte de seu arquivo <code>.xlsx</code></h3>
<p>Um único arquivo <code>.xlsx</code> pode conter várias planilhas, ou várias abas (<em>sheet</em>’s) diferentes. Por padrão, a função <code>read_excel()</code> sempre lê a primeira planilha de seu arquivo <code>.xlsx</code>. Porém, você pode ler diferentes planilhas de seu arquivo por meio do argumento <code>sheet</code>. Somos capazes de selecionar a planilha desejada de acordo com a sua ordem (1, 2, 3, …), ou de acordo com o nome dado à aba que a contém.</p>
<p></p>
<div class="sourceCode" id="cb499"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb499-1"><a href="#cb499-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Lê a terceira planilha do arquivo</span></span>
<span id="cb499-2"><a href="#cb499-2" aria-hidden="true" tabindex="-1"></a><span class="fu">read_excel</span>(<span class="st">&quot;datasets.xlsx&quot;</span>, <span class="at">sheet =</span> <span class="dv">3</span>)</span></code></pre></div>
<p></p>
<p></p>
<pre><code>## # A tibble: 71 x 2
##    weight feed     
##     &lt;dbl&gt; &lt;chr&gt;    
##  1    179 horsebean
##  2    160 horsebean
##  3    136 horsebean
##  4    227 horsebean
##  5    217 horsebean
##  6    168 horsebean
##  7    108 horsebean
##  8    124 horsebean
##  9    143 horsebean
## 10    140 horsebean
## # ... with 61 more rows</code></pre>
<p></p>
<p></p>
<div class="sourceCode" id="cb501"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb501-1"><a href="#cb501-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Lê a planilha presente na aba denominada mtcars</span></span>
<span id="cb501-2"><a href="#cb501-2" aria-hidden="true" tabindex="-1"></a><span class="fu">read_excel</span>(<span class="st">&quot;datasets.xlsx&quot;</span>, <span class="at">sheet =</span> <span class="st">&quot;mtcars&quot;</span>)</span></code></pre></div>
<p></p>
<p></p>
<pre><code>## # A tibble: 32 x 11
##      mpg   cyl  disp    hp  drat    wt  qsec    vs    am  gear  carb
##    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1  21       6  160    110  3.9   2.62  16.5     0     1     4     4
##  2  21       6  160    110  3.9   2.88  17.0     0     1     4     4
##  3  22.8     4  108     93  3.85  2.32  18.6     1     1     4     1
##  4  21.4     6  258    110  3.08  3.22  19.4     1     0     3     1
##  5  18.7     8  360    175  3.15  3.44  17.0     0     0     3     2
##  6  18.1     6  225    105  2.76  3.46  20.2     1     0     3     1
##  7  14.3     8  360    245  3.21  3.57  15.8     0     0     3     4
##  8  24.4     4  147.    62  3.69  3.19  20       1     0     4     2
##  9  22.8     4  141.    95  3.92  3.15  22.9     1     0     4     2
## 10  19.2     6  168.   123  3.92  3.44  18.3     1     0     4     4
## # ... with 22 more rows</code></pre>
<p></p>
<p>Além dessas configurações, conseguimos delimitar o intervalo de células a serem lidas pela função, através do argumento <code>range</code>. Podemos fornecer esse intervalo em dois estilos diferentes. Nós podemos utilizar o sistema tradicional do Excel (CL:CL), como no exemplo abaixo, em que estamos lendo da célula A1 à célula C150 através da notação <code>A1:C150</code>.</p>
<p></p>
<div class="sourceCode" id="cb503"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb503-1"><a href="#cb503-1" aria-hidden="true" tabindex="-1"></a><span class="fu">read_excel</span>(<span class="st">&quot;datasets.xlsx&quot;</span>, <span class="at">range =</span> <span class="st">&quot;A1:C150&quot;</span>)</span></code></pre></div>
<p></p>
<p></p>
<pre><code>## # A tibble: 149 x 3
##    Sepal.Length Sepal.Width Petal.Length
##           &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;
##  1          5.1         3.5          1.4
##  2          4.9         3            1.4
##  3          4.7         3.2          1.3
##  4          4.6         3.1          1.5
##  5          5           3.6          1.4
##  6          5.4         3.9          1.7
##  7          4.6         3.4          1.4
##  8          5           3.4          1.5
##  9          4.4         2.9          1.4
## 10          4.9         3.1          1.5
## # ... with 139 more rows</code></pre>
<p></p>
<p>Uma outra possibilidade é utilizarmos as funções <code>cell_cols()</code> e <code>cell_rows()</code> que limitam o intervalo para apenas uma das dimensões da planilha. Ou seja, nós empregamos a função <code>cell_cols()</code>, quando desejamos ler todas as linhas, e, apenas algumas colunas da planilha. Enquanto com a função <code>cell_rows()</code>, desejamos ler todas as colunas da tabela, porém, queremos extrair apenas uma parte das linhas.</p>
<p>As colunas de uma planilha do Excel, são identificadas por uma letra ou por um conjunto de letras (ex: A; E; F; BC). Por isso, ao utilizar a função <code>cell_cols()</code> você pode delimitar as colunas a serem lidas de duas formas: 1) utilizando a notação do Excel (C:C), com as letras que representam as colunas desejadas; 2) ou através de um vetor numérico que representa a ordem das colunas, e contém o intervalo desejado.</p>
<p></p>
<div class="sourceCode" id="cb505"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb505-1"><a href="#cb505-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Da coluna A até a coluna C</span></span>
<span id="cb505-2"><a href="#cb505-2" aria-hidden="true" tabindex="-1"></a><span class="fu">read_excel</span>(<span class="st">&quot;datasets.xlsx&quot;</span>, <span class="at">range =</span> <span class="fu">cell_cols</span>(<span class="st">&quot;A:C&quot;</span>))</span>
<span id="cb505-3"><a href="#cb505-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb505-4"><a href="#cb505-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Da 1° até a 3° coluna</span></span>
<span id="cb505-5"><a href="#cb505-5" aria-hidden="true" tabindex="-1"></a><span class="fu">read_excel</span>(<span class="st">&quot;datasets.xlsx&quot;</span>, <span class="at">range =</span> <span class="fu">cell_cols</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>))</span></code></pre></div>
<p></p>
<p>Por outro lado, para delimitarmos o intervalo de linhas em <code>cell_rows()</code> precisamos apenas fornecer um vetor de dois elementos, contendo os limites superior e inferior do intervalo, ou então, uma sequência que cobre esses limites.</p>
<p></p>
<div class="sourceCode" id="cb506"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb506-1"><a href="#cb506-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Da 1° até a 140° linha</span></span>
<span id="cb506-2"><a href="#cb506-2" aria-hidden="true" tabindex="-1"></a><span class="fu">read_excel</span>(<span class="st">&quot;datasets.xlsx&quot;</span>, <span class="at">range =</span> <span class="fu">cell_rows</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">140</span>))</span>
<span id="cb506-3"><a href="#cb506-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb506-4"><a href="#cb506-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Da 10° até a 400° linha</span></span>
<span id="cb506-5"><a href="#cb506-5" aria-hidden="true" tabindex="-1"></a><span class="fu">read_excel</span>(<span class="st">&quot;datasets.xlsx&quot;</span>, <span class="at">range =</span> <span class="fu">cell_rows</span>(<span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">400</span>)))</span></code></pre></div>
<p></p>
<p>O argumento <code>range</code> é tão flexível que nós podemos utilizá-lo para executar o trabalho do argumento <code>sheet</code>. Isto é, além do intervalo de células, nós também podemos selecionar a aba do arquivo <code>.xlsx</code> a ser lida pela função, através do argumento <code>range</code>. No Excel, quando você está utilizando em sua planilha, algum valor que é proveniente de uma outra planilha do mesmo arquivo <code>.xlsx</code>, o Excel cria uma referência até esse valor. Essa referência possui o nome da planilha em conjunto com a referência da célula onde o valor se encontra, separados por um ponto de exclamação (<code>!</code>). Logo, se eu quisesse ler da célula A1 até a célula C150, da planilha denominada <code>mtcars</code>, do arquivo <code>datasets.xlsx</code>, eu precisaria criar a seguinte referência no argumento <code>range</code>:</p>
<p></p>
<div class="sourceCode" id="cb507"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb507-1"><a href="#cb507-1" aria-hidden="true" tabindex="-1"></a><span class="fu">read_excel</span>(<span class="st">&quot;datasets.xlsx&quot;</span>, <span class="at">range =</span> <span class="st">&quot;mtcars!A1:C150&quot;</span>) </span></code></pre></div>
<p></p>
<p></p>
<pre><code>## # A tibble: 149 x 3
##      mpg   cyl  disp
##    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1  21       6  160 
##  2  21       6  160 
##  3  22.8     4  108 
##  4  21.4     6  258 
##  5  18.7     8  360 
##  6  18.1     6  225 
##  7  14.3     8  360 
##  8  24.4     4  147.
##  9  22.8     4  141.
## 10  19.2     6  168.
## # ... with 139 more rows</code></pre>
<p></p>
<p>Apesar de sua flexibilidade, o argumento <code>range</code> pressupõe que você conheça exatamente as células que compõe os limites de sua tabela, ou então, que você pelo menos tenha uma boa compreensão de onde eles se encontram. Por isso, você também possui na função <code>read_excel()</code> os argumentos <code>skip</code> e <code>n_max</code>, que funcionam exatamente da mesma forma empregada pelas funções do pacote <code>readr</code>. Logo, esses argumentos representam uma alternativa menos flexível, mas, talvez sejam mais ideais para as suas necessidades, especialmente se você deseja apenas pular algumas linhas de metadados que se encontram no início de sua planilha.</p>
<p></p>
<div class="sourceCode" id="cb509"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb509-1"><a href="#cb509-1" aria-hidden="true" tabindex="-1"></a><span class="fu">read_excel</span>(<span class="st">&quot;datasets.xlsx&quot;</span>, <span class="at">sheet =</span> <span class="dv">2</span>, <span class="at">n_max =</span> <span class="dv">50</span>, <span class="at">skip =</span> <span class="dv">10</span>, <span class="at">col_names =</span> <span class="cn">FALSE</span>) </span></code></pre></div>
<p></p>
<pre><code>## # A tibble: 23 x 11
##     ...1  ...2  ...3  ...4  ...5  ...6  ...7  ...8  ...9 ...10 ...11
##    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1  19.2     6 168.    123  3.92  3.44  18.3     1     0     4     4
##  2  17.8     6 168.    123  3.92  3.44  18.9     1     0     4     4
##  3  16.4     8 276.    180  3.07  4.07  17.4     0     0     3     3
##  4  17.3     8 276.    180  3.07  3.73  17.6     0     0     3     3
##  5  15.2     8 276.    180  3.07  3.78  18       0     0     3     3
##  6  10.4     8 472     205  2.93  5.25  18.0     0     0     3     4
##  7  10.4     8 460     215  3     5.42  17.8     0     0     3     4
##  8  14.7     8 440     230  3.23  5.34  17.4     0     0     3     4
##  9  32.4     4  78.7    66  4.08  2.2   19.5     1     1     4     1
## 10  30.4     4  75.7    52  4.93  1.62  18.5     1     1     4     2
## # ... with 13 more rows</code></pre>
</div>
<div id="definindo-os-tipos-de-dados-contidos-em-cada-coluna" class="section level3" number="4.9.2">
<h3 number="4.9.2"><span class="header-section-number">4.9.2</span> Definindo os tipos de dados contidos em cada coluna</h3>
<p>Por padrão, a função <code>read_excel()</code> vai automaticamente decifrar os tipos de dados contidos em cada coluna. Porém, diferentemente das funções do pacote <code>readr</code>, que constroem essa suposição com base nos dados em si do arquivo, a função <code>read_excel()</code> adivinha os dados contidos em cada coluna, com base nos tipos associados a cada célula da planilha. Ou seja, se as células de uma coluna estão associadas ao tipo <code>Texto</code>, essa coluna será transformada no R em uma coluna do tipo <code>character</code>.</p>
<p>Pelo fato do Excel tratar cada célula de forma individual, você possui uma liberdade muito grande no programa. Por exemplo, você pode misturar dados de diferentes tipos em uma mesma coluna, ou em uma mesma linha de uma planilha do Excel. Porém, essa liberdade tem o seu preço. Um programa que trata as suas células dessa maneira, gera uma estrutura inconsistente em seus dados. Esse fato é importante, pois você tem um trabalho muito maior ao replicar cálculos em sua tabela. Com uma estrutura inconsistente, você precisa pensar não apenas em quais tipos estão associados a cada coluna de sua tabela, mas também, em quais tipos estão associados a cada célula de cada coluna. As chances de erros serem gerados durante o processo, são bem maiores.</p>
<p>Portanto, o sistema que a função <code>read_excel()</code> adota, está de acordo com essa característica. Pois se diversas células em uma mesma coluna possuírem tipos diferentes associados a elas, a função será capaz de reconhecer essa inconsistência, e agir adequadamente. Nós sabemos que o R leva muito a sério a consistência de seus dados, especialmente se tratando de vetores com suas regras de coerção e, por isso, tal liberdade presente em programas como o Excel, representam um desafio para a importação de dados provenientes dessa plataforma.</p>
<p>No R, há duas maneiras principais de lidarmos com essa possível inconsistência de uma planilha do Excel. Uma está no uso do tipo <code>character</code>, pois esse é o tipo de dado mais flexível de todos e, portanto, consegue guardar qualquer outro tipo de dado. Outra está na adoção de listas para qualquer coluna que apresente essa inconstância.</p>
<p>Portanto, em toda coluna que possui dados de diferentes tipos em suas células, a função <code>read_excel()</code> vai geralmente transformar essa coluna, em uma coluna do tipo <code>character</code>. Veja no exemplo abaixo, mais especificamente, na coluna <code>value</code> que contém ao menos três tipos de dados diferentes.</p>
<p></p>
<div class="sourceCode" id="cb511"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb511-1"><a href="#cb511-1" aria-hidden="true" tabindex="-1"></a><span class="fu">read_excel</span>(<span class="fu">readxl_example</span>(<span class="st">&quot;clippy.xlsx&quot;</span>))</span></code></pre></div>
<pre><code>## # A tibble: 4 x 2
##   name                 value    
##   &lt;chr&gt;                &lt;chr&gt;    
## 1 Name                 Clippy   
## 2 Species              paperclip
## 3 Approx date of death 39083    
## 4 Weight in grams      0.9</code></pre>
<p></p>
<p>Como destacamos, uma outra alternativa, seria transformarmos essa coluna em uma lista. Dessa forma, nós podemos incluir qualquer tipo de dado em cada elemento dessa lista (ou em cada “célula” dessa coluna). Porém, teremos que pedir explicitamente a função <code>read_excel()</code> que realize esse tipo de transformação, através do argumento <code>col_types</code>.</p>
<p>Portanto, em todas as ocasiões que você precisar evitar que a função <code>read_excel()</code> decifre os tipos os tipos de cada coluna, você pode definir de forma explícita esses tipos no argumento <code>col_types</code>. Você precisa apenas fornecer um vetor a esse argumento, contendo rótulos que representam os tipos de cada coluna na ordem em que elas aparecem na planilha. Os rótulos possíveis nesse argumento são : <code>"skip"</code>, <code>"guess"</code>, <code>"logical"</code>, <code>"numeric"</code>, <code>"date"</code>, <code>"text"</code> e <code>"list"</code>.</p>
<p></p>
<div class="sourceCode" id="cb513"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb513-1"><a href="#cb513-1" aria-hidden="true" tabindex="-1"></a><span class="fu">read_excel</span>(<span class="fu">readxl_example</span>(<span class="st">&quot;clippy.xlsx&quot;</span>), <span class="at">col_types =</span> <span class="fu">c</span>(<span class="st">&quot;text&quot;</span>, <span class="st">&quot;list&quot;</span>))</span></code></pre></div>
<pre><code>## # A tibble: 4 x 2
##   name                 value     
##   &lt;chr&gt;                &lt;list&gt;    
## 1 Name                 &lt;chr [1]&gt; 
## 2 Species              &lt;chr [1]&gt; 
## 3 Approx date of death &lt;dttm [1]&gt;
## 4 Weight in grams      &lt;dbl [1]&gt;</code></pre>
<p></p>
</div>
</div>
<div id="importando-arquivos-do-spss-stata-e-sas-com-o-pacote-haven" class="section level2" number="4.10">
<h2 number="4.10"><span class="header-section-number">4.10</span> Importando arquivos do SPSS, Stata e SAS com o pacote <code>haven</code></h2>
<p>Apesar de serem programas mais populares em mercados específicos, especialmente o mercado americano, algumas pessoas no Brasil ainda utilizam programas como o Stata para produzirem as suas pesquisas. Por isso, nessa seção, vamos utilizar as funções do pacote <code>haven</code>, com o objetivo de importarmos dados que estejam presentes em arquivos produzidos por um desses três programas: SPSS (<code>.sav</code>, <code>.zsav</code>, <code>.por</code>), Stata (<code>.dta</code>) e SAS (<code>.sas7bdat</code>, <code>.sas7bcat</code>). Logo abaixo, temos uma lista relacionando as funções do pacote com os respectivos formatos de arquivo.</p>
<ol style="list-style-type: decimal">
<li><p><code>read_dta()</code> - Stata (<code>.dta</code>).</p></li>
<li><p><code>read_spss()</code> - SPSS (<code>.sav</code>, <code>.zsav</code>, <code>.por</code>).</p></li>
<li><p><code>read_sas()</code> - SAS (<code>.sas7bdat</code>, <code>.sas7bcat</code>).</p></li>
</ol>
<p>Assim como as funções de importações vistas até o momento, o primeiro argumento das três funções acima, se trata do endereço ou do nome do arquivo (caso ele se encontre em seu diretório de trabalho atual) que você deseja ler.</p>
<p></p>
<div class="sourceCode" id="cb515"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb515-1"><a href="#cb515-1" aria-hidden="true" tabindex="-1"></a><span class="fu">read_spss</span>(<span class="st">&quot;survey.sav&quot;</span>)</span>
<span id="cb515-2"><a href="#cb515-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb515-3"><a href="#cb515-3" aria-hidden="true" tabindex="-1"></a><span class="fu">read_sas</span>(<span class="st">&quot;survey.sas7bdat&quot;</span>)</span>
<span id="cb515-4"><a href="#cb515-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb515-5"><a href="#cb515-5" aria-hidden="true" tabindex="-1"></a><span class="fu">read_dta</span>(<span class="st">&quot;pnad_2015.dta&quot;</span>)</span></code></pre></div>
<p></p>
<div id="tratando-variáveis-rotuladas" class="section level3" number="4.10.1">
<h3 number="4.10.1"><span class="header-section-number">4.10.1</span> Tratando variáveis rotuladas</h3>
<p>Os programas SPSS, SAS e Stata permitem, e muitas vezes utilizam, um sistema de rótulos sobre seus valores. O uso desses rótulos é especialmente comum em colunas que representam variáveis qualitativas (cor, sexo, faixa etária, etc.). Nessas colunas, os dados são representados por valores numéricos, porém, esses valores são rotulados com um valor textual que corresponde a faixa, ou a categoria a qual aquele valor numérico corresponde.</p>
<p>Como exemplo, veja a tabela abaixo, ou mais especificamente, as colunas <code>sex</code>, <code>marital</code> e <code>child</code>. Perceba que essas três colunas, estão sendo tratadas como colunas do tipo <code>double + labelled</code> (<code>dbl + lbl</code>). Ou seja, os dados presentes nessas colunas, são dados numéricos (<code>double</code>). Porém, certos rótulos (<code>labelled</code>) estão associados a cada um desses valores. Por exemplo, todo valor igual a 1 na coluna <code>child</code>, indica que a pessoa entrevistada naquela linha é responsável por alguma criança (<code>YES</code>), enquanto todo valor igual a 2, representa uma pessoa que não possui uma criança sobre a sua tutela (<code>NO</code>).</p>
<p></p>
<div class="sourceCode" id="cb516"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb516-1"><a href="#cb516-1" aria-hidden="true" tabindex="-1"></a>pesquisa <span class="ot">&lt;-</span> <span class="fu">read_spss</span>(<span class="st">&quot;survey.sav&quot;</span>)</span>
<span id="cb516-2"><a href="#cb516-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb516-3"><a href="#cb516-3" aria-hidden="true" tabindex="-1"></a>pesquisa</span></code></pre></div>
<p></p>
<p></p>
<pre><code>## # A tibble: 439 x 9
##       id      sex   age  marital   child     educ   source   smoke smokenum
##    &lt;dbl&gt; &lt;dbl+lb&gt; &lt;dbl&gt; &lt;dbl+lb&gt; &lt;dbl+l&gt; &lt;dbl+lb&gt; &lt;dbl+lb&gt; &lt;dbl+l&gt;    &lt;dbl&gt;
##  1   415 2 [FEMA~    24 4 [MARR~ 1 [YES] 5 [COMP~  7 [LIF~ 2 [NO]        NA
##  2     9 1 [MALE~    39 3 [LIVI~ 1 [YES] 5 [COMP~  1 [WOR~ 1 [YES]        2
##  3   425 2 [FEMA~    48 4 [MARR~ 1 [YES] 2 [SOME~  4 [CHI~ 2 [NO]        NA
##  4   307 1 [MALE~    41 5 [REMA~ 1 [YES] 2 [SOME~  1 [WOR~ 2 [NO]         0
##  5   440 1 [MALE~    23 1 [SING~ 2 [NO]  5 [COMP~  1 [WOR~ 2 [NO]         0
##  6   484 2 [FEMA~    31 4 [MARR~ 1 [YES] 5 [COMP~  7 [LIF~ 2 [NO]        NA
##  7   341 2 [FEMA~    30 6 [SEPA~ 2 [NO]  4 [SOME~  8 [MON~ 2 [NO]         0
##  8   300 1 [MALE~    23 2 [STEA~ 2 [NO]  5 [COMP~  1 [WOR~ 1 [YES]      100
##  9    61 2 [FEMA~    18 2 [STEA~ 2 [NO]  2 [SOME~  2 [SPO~ 1 [YES]       40
## 10    24 1 [MALE~    23 1 [SING~ 2 [NO]  6 [POST~ NA       2 [NO]         0
## # ... with 429 more rows</code></pre>
<p></p>
<p>Toda coluna que estiver rotulada no arquivo, será importada dessa maneira para o R, criando um tipo misto. Porém, após a importação dos dados, o ideal é que você sempre transforme essas colunas “mistas” para o tipo <code>factor</code>, pois esse tipo de dado apresenta um suporte muito melhor ao longo da linguagem R. Tal transformação pode ser facilmente gerada através da função <code>as_factor()</code>, que provêm do pacote <code>forcats</code>.</p>
<p></p>
<div class="sourceCode" id="cb518"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb518-1"><a href="#cb518-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forcats)</span>
<span id="cb518-2"><a href="#cb518-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb518-3"><a href="#cb518-3" aria-hidden="true" tabindex="-1"></a>pesquisa <span class="ot">&lt;-</span> <span class="fu">as_factor</span>(pesquisa)</span>
<span id="cb518-4"><a href="#cb518-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb518-5"><a href="#cb518-5" aria-hidden="true" tabindex="-1"></a>pesquisa</span></code></pre></div>
<pre><code>## # A tibble: 439 x 9
##       id sex       age marital     child educ       source   smoke smokenum
##    &lt;dbl&gt; &lt;fct&gt;   &lt;dbl&gt; &lt;fct&gt;       &lt;fct&gt; &lt;fct&gt;      &lt;fct&gt;    &lt;fct&gt;    &lt;dbl&gt;
##  1   415 FEMALES    24 MARRIED FI~ YES   COMPLETED~ LIFE IN~ NO          NA
##  2     9 MALES      39 LIVING WIT~ YES   COMPLETED~ WORK     YES          2
##  3   425 FEMALES    48 MARRIED FI~ YES   SOME SECO~ CHILDREN NO          NA
##  4   307 MALES      41 REMARRIED   YES   SOME SECO~ WORK     NO           0
##  5   440 MALES      23 SINGLE      NO    COMPLETED~ WORK     NO           0
##  6   484 FEMALES    31 MARRIED FI~ YES   COMPLETED~ LIFE IN~ NO          NA
##  7   341 FEMALES    30 SEPARATED   NO    SOME ADDI~ MONEY/F~ NO           0
##  8   300 MALES      23 STEADY REL~ NO    COMPLETED~ WORK     YES        100
##  9    61 FEMALES    18 STEADY REL~ NO    SOME SECO~ SPOUSE ~ YES         40
## 10    24 MALES      23 SINGLE      NO    POSTGRADU~ &lt;NA&gt;     NO           0
## # ... with 429 more rows</code></pre>
<p></p>
</div>
<div id="delimitando-partes-do-arquivo" class="section level3" number="4.10.2">
<h3 number="4.10.2"><span class="header-section-number">4.10.2</span> Delimitando partes do arquivo</h3>
<p>Todas as três funções do pacote <code>haven</code> possuem os argumentos <code>skip</code> e <code>n_max</code>, que novamente, funcionam da mesma forma que é empregado pelas funções do pacote <code>readr</code>. Portanto, o argumento <code>skip</code> e <code>n_max</code> definem o número de linhas a serem ignoradas no início do arquivo, e o número máximo de linhas do arquivo a serem lidas, respectivamente.</p>
<p></p>
<div class="sourceCode" id="cb520"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb520-1"><a href="#cb520-1" aria-hidden="true" tabindex="-1"></a><span class="fu">read_spss</span>(<span class="st">&quot;survey.sav&quot;</span>, <span class="at">skip =</span> <span class="dv">5</span>)</span></code></pre></div>
<p></p>
<p></p>
<pre><code>## # A tibble: 434 x 9
##       id      sex   age  marital   child     educ   source   smoke smokenum
##    &lt;dbl&gt; &lt;dbl+lb&gt; &lt;dbl&gt; &lt;dbl+lb&gt; &lt;dbl+l&gt; &lt;dbl+lb&gt; &lt;dbl+lb&gt; &lt;dbl+l&gt;    &lt;dbl&gt;
##  1   484 2 [FEMA~    31 4 [MARR~ 1 [YES] 5 [COMP~  7 [LIF~ 2 [NO]        NA
##  2   341 2 [FEMA~    30 6 [SEPA~ 2 [NO]  4 [SOME~  8 [MON~ 2 [NO]         0
##  3   300 1 [MALE~    23 2 [STEA~ 2 [NO]  5 [COMP~  1 [WOR~ 1 [YES]      100
##  4    61 2 [FEMA~    18 2 [STEA~ 2 [NO]  2 [SOME~  2 [SPO~ 1 [YES]       40
##  5    24 1 [MALE~    23 1 [SING~ 2 [NO]  6 [POST~ NA       2 [NO]         0
##  6   138 1 [MALE~    27 1 [SING~ 2 [NO]  3 [COMP~  1 [WOR~ 1 [YES]      100
##  7   184 2 [FEMA~    34 4 [MARR~ 1 [YES] 5 [COMP~  5 [FAM~ 2 [NO]         0
##  8   183 1 [MALE~    35 1 [SING~ 2 [NO]  4 [SOME~  7 [LIF~ 2 [NO]         0
##  9   144 2 [FEMA~    43 4 [MARR~ 1 [YES] 2 [SOME~  2 [SPO~ 2 [NO]        NA
## 10    57 1 [MALE~    50 4 [MARR~ 1 [YES] 4 [SOME~  1 [WOR~ 2 [NO]         0
## # ... with 424 more rows</code></pre>
<p></p>
<p></p>
<div class="sourceCode" id="cb522"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb522-1"><a href="#cb522-1" aria-hidden="true" tabindex="-1"></a><span class="fu">read_spss</span>(<span class="st">&quot;survey.sav&quot;</span>, <span class="at">n_max =</span> <span class="dv">10</span>)</span></code></pre></div>
<p></p>
<p></p>
<pre><code>## # A tibble: 434 x 9
##       id      sex   age  marital   child     educ   source   smoke smokenum
##    &lt;dbl&gt; &lt;dbl+lb&gt; &lt;dbl&gt; &lt;dbl+lb&gt; &lt;dbl+l&gt; &lt;dbl+lb&gt; &lt;dbl+lb&gt; &lt;dbl+l&gt;    &lt;dbl&gt;
##  1   484 2 [FEMA~    31 4 [MARR~ 1 [YES] 5 [COMP~  7 [LIF~ 2 [NO]        NA
##  2   341 2 [FEMA~    30 6 [SEPA~ 2 [NO]  4 [SOME~  8 [MON~ 2 [NO]         0
##  3   300 1 [MALE~    23 2 [STEA~ 2 [NO]  5 [COMP~  1 [WOR~ 1 [YES]      100
##  4    61 2 [FEMA~    18 2 [STEA~ 2 [NO]  2 [SOME~  2 [SPO~ 1 [YES]       40
##  5    24 1 [MALE~    23 1 [SING~ 2 [NO]  6 [POST~ NA       2 [NO]         0
##  6   138 1 [MALE~    27 1 [SING~ 2 [NO]  3 [COMP~  1 [WOR~ 1 [YES]      100
##  7   184 2 [FEMA~    34 4 [MARR~ 1 [YES] 5 [COMP~  5 [FAM~ 2 [NO]         0
##  8   183 1 [MALE~    35 1 [SING~ 2 [NO]  4 [SOME~  7 [LIF~ 2 [NO]         0
##  9   144 2 [FEMA~    43 4 [MARR~ 1 [YES] 2 [SOME~  2 [SPO~ 2 [NO]        NA
## 10    57 1 [MALE~    50 4 [MARR~ 1 [YES] 4 [SOME~  1 [WOR~ 2 [NO]         0
## # ... with 424 more rows</code></pre>
<p></p>
<p>Além dessas opções, as funções também oferecem o argumento <code>col_select</code>, pelo qual você pode definir quais colunas do arquivo devem ser importadas. Esse recurso é particularmente interessante quando você possui um arquivo muito grande, como os microdados da PNAD contínua, e você deseja utilizar apenas algumas colunas, ou apenas algumas variáveis da pesquisa. Para selecionar colunas no argumento <code>col_select</code>, você pode fornecer um vetor contendo os nomes das colunas desejadas, porém, uma outra alternativa mais útil é utilizar um vetor de índices que representam a ordem das colunas desejadas.</p>
<p></p>
<div class="sourceCode" id="cb524"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb524-1"><a href="#cb524-1" aria-hidden="true" tabindex="-1"></a><span class="fu">read_spss</span>(<span class="st">&quot;survey_complete.sav&quot;</span>, <span class="at">col_select =</span> <span class="dv">45</span><span class="sc">:</span><span class="dv">52</span>)</span></code></pre></div>
<p></p>
<p></p>
<pre><code>## # A tibble: 439 x 8
##    lifsat3 lifsat4 lifsat5  pss1  pss2  pss3  pss4  pss5
##      &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1       5       4       3     3     3     4     3     4
##  2       5       7       5     2     2     3     5     4
##  3       7       6       6     1     2     2     4     4
##  4       7       7       6     4     3     5     5     4
##  5       4       3       3     2     2     3     2     3
##  6       2       2       2     1     1     3     4     3
##  7       1       1       1     4     4     4     2     2
##  8       5       4       6     3     3     5     3     2
##  9       2       1       1     4     4     5     2     1
## 10       1       1       1     4     5     5     1     1
## # ... with 429 more rows</code></pre>
<p></p>
<p></p>
<div class="sourceCode" id="cb526"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb526-1"><a href="#cb526-1" aria-hidden="true" tabindex="-1"></a><span class="fu">read_dta</span>(<span class="st">&quot;pnad_2015.dta&quot;</span>, <span class="at">col_select =</span> <span class="fu">c</span>(<span class="st">&quot;uf&quot;</span>, <span class="st">&quot;v0102&quot;</span>, <span class="st">&quot;v0103&quot;</span>, <span class="st">&quot;cor&quot;</span>, <span class="st">&quot;sexo&quot;</span>))</span></code></pre></div>
<p></p>
<p></p>
<pre><code>## # A tibble: 164,204 x 5
##       uf    v0102 v0103        cor          sexo
##    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl+lbl&gt;     &lt;dbl+lbl&gt;
##  1    31 31001718    14 8 [parda]  1 [masculino]
##  2    15 15003760     1 8 [parda]  1 [masculino]
##  3    35 35002425     8 2 [branca] 1 [masculino]
##  4    43 43000126    15 4 [preta]  0 [feminino] 
##  5    33 33001812    18 8 [parda]  1 [masculino]
##  6    17 17000440     3 8 [parda]  1 [masculino]
##  7    15 15002683     3 8 [parda]  1 [masculino]
##  8    15 15003639     6 2 [branca] 1 [masculino]
##  9    22 22000194     7 8 [parda]  0 [feminino] 
## 10    26 26005808     4 8 [parda]  1 [masculino]
## # ... with 164,194 more rows</code></pre>
<p></p>
</div>
</div>
<div id="sec:encoding" class="section level2" number="4.11">
<h2 number="4.11"><span class="header-section-number">4.11</span> <em>Encoding</em> de caracteres</h2>
<p>Quando nós estamos trabalhando com dados em um computador, estamos lidando com registros digitalizados de informação, e esses registros quase sempre contêm letras e palavras, ou simplesmente, variáveis textuais (<em>strings</em> ou caracteres). Dados geográficos, por exemplo, usualmente vem acompanhado de certas informações textuais, como partes de um endereço (cidade, região, rua, etc.), que dão suporte à identificação e localização de certa informação. Como um outro exemplo, dados de uma pesquisa amostral comumente possuem variáveis qualitativas que funcionam como rótulos, e que categorizam cada pessoa entrevistada em um certo grupo (homem ou mulher; branco, pardo, preto, amarelo ou indígena; etc.).</p>
<p>Em uma escala microscópica, as informações presentes em um computador são armazenadas como <em>bytes</em> de informação, que por sua vez são formados por <em>bits</em> de informação, que nada mais são do que combinações específicas de 0’s e 1’s. Com esse fato, eu quero destacar que os nossos computadores não são capazes de guardar diretamente letras, palavras e outros valores textuais. Na verdade, o que os nossos computadores são capazes de guardar, são os códigos binários que em conjunto formam os <em>bytes</em> de informação que representam cada uma das letras, ou cada um dos caracteres que formam a sua palavra, o seu parágrafo ou o seu capítulo. Como exemplo, o nome “Belo Horizonte,” é representado em meu computador através da seguinte sequência de <em>bytes</em>:</p>
<p></p>
<div class="sourceCode" id="cb528"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb528-1"><a href="#cb528-1" aria-hidden="true" tabindex="-1"></a><span class="fu">charToRaw</span>(<span class="st">&quot;Belo Horizonte&quot;</span>)</span></code></pre></div>
<pre><code>##  [1] 42 65 6c 6f 20 48 6f 72 69 7a 6f 6e 74 65</code></pre>
<p></p>
<p>Cada um dos <em>bytes</em> acima, representam uma letra, e para que o seu computador seja capaz de relacionar cada um desses <em>bytes</em> às respectivas letras que eles representam, ele utiliza um sistema que nós chamamos de <em>encoding</em>. É possível que o sistema operacional de seu computador utilize um sistema de <em>encoding</em> diferente do meu. Com isso, os <em>bytes</em> que representam o nome “Belo Horizonte” em seu computador, podem ser diferentes dos <em>bytes</em> acima.</p>
<div id="sec:fontes_encoding_tipografia" class="section level3" number="4.11.1">
<h3 number="4.11.1"><span class="header-section-number">4.11.1</span> Um pouco sobre fontes, <em>encoding</em> e tipografia</h3>
<p>Para apresentar visualmente em sua tela, uma palavra ou um texto, o seu computador precisa relacionar caracteres (<em>characters</em>) com os seus respectivos <em>glyphs</em> <span class="citation">(<a href="#ref-haralambous2007" role="doc-biblioref">Haralambous 2007</a>)</span>. Uma fonte que se encontra em seu computador, representa um conjunto de <em>glyphs</em>. Um <em>glyph</em> é uma imagem ou um desenho de cada letra que está definida dentro dessa fonte. Quando você está, por exemplo, escrevendo um novo documento no Word, e você aperta a tecla “A,” um caractere (que corresponde a letra A) é enviado para o seu computador. Após o seu computador descobrir o <em>glyph</em> da fonte que você está utilizando, que corresponde ao caractere A, o Word vai desenhar a palavra A em seu documento, através do <em>glyph</em> que corresponde a esse caractere <span class="citation">(<a href="#ref-haralambous2007" role="doc-biblioref">Haralambous 2007</a>)</span>.</p>
<p>Ou seja, quando as letras A e <code>A</code> aparecem em sua tela, elas representam o mesmo caractere, mas utilizam diferentes <em>glyphs</em> para serem desenhadas na tela de seu computador, pois ambos os caracteres utilizam fontes diferentes. Por um outro ângulo, nós podemos escrever uma frase de mesmo significado em diferentes línguas, porém, muito provavelmente vamos utilizar diferentes caracteres em cada língua. Por exemplo, ao escrevermos “Olá,” “Hello,” “Bonjour” ou “你好,” estamos dizendo a mesma coisa, porém, estamos utilizando caracteres ou letras bem diferentes para tal ato.</p>
<p>Portanto, quando importamos os nossos dados para dentro do R, qualquer informação ou variável textual que esteja presente nesses dados, são guardadas em nosso computador como <em>bytes</em> de informação; e o sistema que o nosso computador utiliza, para traduzir esses <em>bytes</em> de informação, em caracteres, que futuramente serão renderizados em nossa tela, através dos <em>glyphs</em> que os representa, é chamado de <em>encoding</em> <span class="citation">(<a href="#ref-haralambous2007" role="doc-biblioref">Haralambous 2007</a>)</span>.</p>
<p>Os primeiros sistemas de <em>encoding</em> eram capazes de representar apenas as letras de línguas anglo-saxônicas. Porém, a medida em que os chineses precisavam escrever um relatório em sua língua, ou a partir do momento em que o povo nórdico precisava representar em seus computadores os diferentes acentos presentes em seu alfabeto, diversos outros sistemas de <em>encoding</em> foram sendo desenvolvidos ao longo do tempo. Por isso, nós temos hoje uma miscelânia muito grande de sistemas em uso no mundo. Sendo essa confusão, a principal motivação por trás do desenvolvimento do sistema Unicode, que busca universalizar todos esses sistemas em um só <span class="citation">(<a href="#ref-haralambous2007" role="doc-biblioref">Haralambous 2007</a>)</span>.</p>
</div>
<div id="problemas-que-emergem-do-encoding" class="section level3" number="4.11.2">
<h3 number="4.11.2"><span class="header-section-number">4.11.2</span> Problemas que emergem do <em>encoding</em></h3>
<p>Por que esse assunto é importante dentro da leitura e escrita de arquivos? Porque diferentes arquivos podem utilizar diferentes sistemas de <em>encoding</em>, e se quisermos trabalhar corretamente com os dados textuais presentes nesses arquivos, nós devemos interpretá-los através do sistema de <em>encoding</em> correto.</p>
<p>Quando você lê um arquivo de acordo com um sistema de <em>encoding</em> diferente do sistema que o arquivo de fato utiliza, uma troca de caracteres (ou de letras) ocorre. Com isso, os textos presentes em seu arquivo, ou no nosso caso, em nossos dados, podem ficar bem estapafúrdios. Devido a essa troca de caracteres, há grandes chances de que uma simples pesquisa por algum caractere específico, fique prejudicada.</p>
<p>Como exemplo, eu possuo abaixo um vetor <code>t</code> contendo algumas palavras. Ao utilizar a função <code>grep()</code> para pesquisar por qualquer palavra que contenha a letra “Á.” Como resultado, a função nos retorna o número 1, indicando que o primeiro elemento do vetor (a palavra “Árabe”) possui essa letra.</p>
<p></p>
<div class="sourceCode" id="cb530"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb530-1"><a href="#cb530-1" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Árabe&quot;</span>, <span class="st">&quot;Francês&quot;</span> ,<span class="st">&quot;Japonês&quot;</span>, <span class="st">&quot;Chinês&quot;</span>)</span>
<span id="cb530-2"><a href="#cb530-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb530-3"><a href="#cb530-3" aria-hidden="true" tabindex="-1"></a><span class="fu">grep</span>(<span class="st">&quot;Á&quot;</span>, <span class="at">x =</span> t)</span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<p></p>
<p>Agora, se eu pedir ao R, que interprete o vetor <code>t</code> segundo um <em>encoding</em> diferente, perceba que a função <code>grep()</code> não é mais capaz de encontrar uma palavra que contenha a letra “Á.”</p>
<p></p>
<div class="sourceCode" id="cb532"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb532-1"><a href="#cb532-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Encoding</span>(t) <span class="ot">&lt;-</span> <span class="st">&quot;UTF-8&quot;</span></span>
<span id="cb532-2"><a href="#cb532-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb532-3"><a href="#cb532-3" aria-hidden="true" tabindex="-1"></a>t</span></code></pre></div>
<pre><code>## [1] &quot;&lt;c1&gt;rabe&quot;   &quot;Franc&lt;ea&gt;s&quot; &quot;Japon&lt;ea&gt;s&quot; &quot;Chin&lt;ea&gt;s&quot;</code></pre>
<div class="sourceCode" id="cb534"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb534-1"><a href="#cb534-1" aria-hidden="true" tabindex="-1"></a><span class="fu">grep</span>(<span class="st">&quot;Á&quot;</span>, <span class="at">x =</span> t)</span></code></pre></div>
<pre><code>## integer(0)</code></pre>
<p></p>
<p>Na hipótese de você abrir um arquivo e estar utilizando o <em>encoding</em> incorreto, desde de que você não salve esse arquivo, você não vai corrompê-lo. Em resumo, se algum caractere de seu texto não estiver da forma como você esperava, não salve o seu arquivo! Antes, você precisa ajustar o <em>encoding</em> de leitura do arquivo, até o momento em que a leitura dos textos presentes em seu arquivo esteja correta.</p>
<p>Apenas para que esse problema fique claro, vamos pegar como exemplo, o arquivo <code>livros.txt</code>, que utiliza o sistema de <em>encoding</em> UTF-8.</p>
<p></p>
<div class="sourceCode" id="cb536"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb536-1"><a href="#cb536-1" aria-hidden="true" tabindex="-1"></a>livros <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;livros.txt&quot;</span>)</span>
<span id="cb536-2"><a href="#cb536-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb536-3"><a href="#cb536-3" aria-hidden="true" tabindex="-1"></a>livros</span></code></pre></div>
<p></p>
<pre><code># A tibble: 4 x 3
  Titulo                             Autor                       Preco
  &lt;chr&gt;                              &lt;chr&gt;                       &lt;dbl&gt;
1 O Hobbit                           J. R. R. Tolkien             40.7
2 Matemática para Economistas        Carl P. Simon e Lawrence B~ 140. 
3 Microeconomia: uma Abordagem Mode~ Hal R. Varian               141. 
4 A Luneta Âmbar                     Philip Pullman               42.9</code></pre>
<p>Agora, veja abaixo o que acontece se utilizarmos o <em>encoding</em> errado na leitura do arquivo. Alguns sistemas de <em>encoding</em> são relativamente próximos e, por isso, menos trocas tendem a ocorrer em seus textos quando utilizamos o <em>encoding</em> errado. Porém, alguns sistemas são muito divergentes e, portanto, os seus textos podem ficar bem bizarros. Perceba abaixo, que ao utilizarmos o <em>encoding</em> Latin1, apenas as letras acentuadas foram trocadas.</p>
<p></p>
<div class="sourceCode" id="cb538"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb538-1"><a href="#cb538-1" aria-hidden="true" tabindex="-1"></a>livros <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;livros.txt&quot;</span>, <span class="at">locale =</span> <span class="fu">locale</span>(<span class="at">encoding =</span> <span class="st">&quot;Latin1&quot;</span>))</span>
<span id="cb538-2"><a href="#cb538-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb538-3"><a href="#cb538-3" aria-hidden="true" tabindex="-1"></a>livros</span></code></pre></div>
<p></p>
<pre><code># A tibble: 4 x 3
  Titulo                              Autor                      Preco
  &lt;chr&gt;                               &lt;chr&gt;                      &lt;dbl&gt;
1 &quot;O Hobbit&quot;                          J. R. R. Tolkien            40.7
2 &quot;MatemÃ¡tica para Economistas&quot;      Carl P. Simon e Lawrence ~ 140. 
3 &quot;Microeconomia: uma Abordagem Mode~ Hal R. Varian              141. 
4 &quot;A Luneta Ã\u0082mbar&quot;              Philip Pullman              42.9</code></pre>
<p>Portanto, tudo o que precisamos fazer aqui, é voltar para o <em>encoding</em> correto de leitura, ao ajustar o valor utilizado no argumento <code>encoding</code> de <code>locale()</code>, como vimos na seção <a href="#sec:readr_locale">Compreendendo o argumento locale</a>. Em geral, no Brasil se utiliza o sistema ISO-8859-1, ou simplesmente Latin1. Já as funções do pacote <code>readr</code> utilizam por padrão, o sistema UTF-8, por isso, você terá de ajustar o <em>encoding</em> de leitura com certa frequência.</p>
</div>
<div id="a-função-guess_encoding-como-um-possível-guia" class="section level3" number="4.11.3">
<h3 number="4.11.3"><span class="header-section-number">4.11.3</span> A função <code>guess_encoding()</code> como um possível guia</h3>
<p>Nem sempre temos a sorte de sabermos o <em>encoding</em> utilizado por um certo arquivo. Por isso, o pacote <code>readr</code> oferece a função <code>guess_encoding()</code>, que pode descobrir o <em>encoding</em> utilizado por certo arquivo. Como foi destacado por <span class="citation"><a href="#ref-wickham2017" role="doc-biblioref">Wickham and Grolemund</a> (<a href="#ref-wickham2017" role="doc-biblioref">2017</a>, p 133)</span>, essa função funciona melhor quando você possui uma quantidade grande de texto no qual ela pode se basear. Além disso, ela não é certeira 100% do tempo, porém, ela lhe oferece um início razoável caso você esteja perdido.</p>
<p>Para utilizar essa função, você precisa fornecer o seu texto como <em>bytes</em>. Ou seja, antes de utilizar essa função, você muito provavelmente terá de converter o seu texto para <em>bytes</em><a href="#fn13" class="footnote-ref" id="fnref13"><sup>13</sup></a>. Para isso, você pode utilizar a função <code>charToRaw()</code>, entretanto, essa função busca transformar um vetor de comprimento 1, logo, para utilizarmos essa função, temos de inserir todos os nossos valores textuais em um único <em>string</em>.</p>
<p>Como exemplo, vamos utilizar a coluna <code>Municípios</code> do arquivo <code>Cod_IBGE.txt</code>, que possui os nomes dos municípios do estado de Minas Gerais. Perceba abaixo, que o arquivo utiliza um <em>encoding</em> diferente do padrão utilizado pela função <code>read_csv2()</code>, pois a quarta coluna que deveria se chamar <code>Municípios</code>, foi interpretada como <code>Munic&lt;U+653C&gt;&lt;U+3E64&gt;pios</code>.</p>
<p></p>
<div class="sourceCode" id="cb540"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb540-1"><a href="#cb540-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">read_csv2</span>(<span class="st">&quot;Cod_IBGE.txt&quot;</span>, <span class="at">locale =</span> <span class="fu">locale</span>(<span class="at">encoding =</span> <span class="st">&quot;Latin1&quot;</span>))</span></code></pre></div>
<p></p>
<pre><code>-- Column specification -----------------------------------
cols(
  IBGE = col_double(),
  IBGE2 = col_double(),
  SEF = col_double(),
  `Munic&lt;U+653C&gt;&lt;U+3E64&gt;pios` = col_character()
)</code></pre>
<p>Para unir todos os nomes de municípios, presentes na coluna <code>Munic&lt;U+653C&gt;&lt;U+3E64&gt;pios</code>, nós podemos utilizar a função <code>paste()</code>, de acordo com as especificações abaixo. Em seguida, podemos transformar o resultado de <code>paste()</code> em um vetor de <em>bytes</em>, e fornecê-lo para a função <code>guess_encoding()</code>.</p>
<p></p>
<div class="sourceCode" id="cb542"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb542-1"><a href="#cb542-1" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> <span class="fu">paste</span>(df[[<span class="dv">4</span>]], <span class="at">collapse =</span> <span class="st">&quot; &quot;</span>)</span>
<span id="cb542-2"><a href="#cb542-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb542-3"><a href="#cb542-3" aria-hidden="true" tabindex="-1"></a>raw <span class="ot">&lt;-</span> <span class="fu">charToRaw</span>(t)</span>
<span id="cb542-4"><a href="#cb542-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb542-5"><a href="#cb542-5" aria-hidden="true" tabindex="-1"></a><span class="fu">guess_encoding</span>(raw)</span></code></pre></div>
<pre><code>## # A tibble: 3 x 2
##   encoding     confidence
##   &lt;chr&gt;             &lt;dbl&gt;
## 1 UTF-8              1   
## 2 windows-1252       0.56
## 3 windows-1250       0.28</code></pre>
<p></p>
<p>Repare que a função nos deu 57% de chance do arquivo <code>Cod_IBGE.txt</code> estar utilizando o <em>encoding</em> ISO-8859-1, que é de fato o <em>encoding</em> utilizado pelo arquivo.</p>
</div>
</div>
<div id="exercícios-2" class="section level2 unnumbered">
<h2 class="unnumbered">Exercícios</h2>
<blockquote>
<p>Lembre-se que, um arquivo de texto, nada mais é do que um arquivo simples contendo um conjunto de textos. Esses textos são organizados em linhas (onde cada linha representa uma observação diferente), e em cada linha desse arquivo, esses textos são separados em diferentes colunas, através de algum caractere especial, como vírgulas (<code>,</code>), ou pontos e vírgulas (<code>;</code>).</p>
</blockquote>
<p><strong>Questão 3.1.</strong> Como descrevemos ao longo desse capítulo, arquivos de texto são talvez o principal formato de arquivo utilizado hoje para o compartilhamento de dados. Por isso, os próximos exercícios buscam reforçar os conhecimentos a respeito desses arquivos.</p>
<p>3.1.A) Considerando o arquivo de texto contido no objeto <code>t</code> abaixo, qual é o caractere especial que define as colunas desse arquivo? Dado que você tenha identificado esse caractere especial, quais comandos você utilizaria para ler esse arquivo?</p>
<p></p>
<div class="sourceCode" id="cb544"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb544-1"><a href="#cb544-1" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> <span class="st">&quot;</span></span>
<span id="cb544-2"><a href="#cb544-2" aria-hidden="true" tabindex="-1"></a><span class="st">ID~Valor/Grupo~Unidade</span></span>
<span id="cb544-3"><a href="#cb544-3" aria-hidden="true" tabindex="-1"></a><span class="st">1~2,5488/Marketing~Kg</span></span>
<span id="cb544-4"><a href="#cb544-4" aria-hidden="true" tabindex="-1"></a><span class="st">2~4,0101/Análise~Kg</span></span>
<span id="cb544-5"><a href="#cb544-5" aria-hidden="true" tabindex="-1"></a><span class="st">3~1097/Vendas~g</span></span>
<span id="cb544-6"><a href="#cb544-6" aria-hidden="true" tabindex="-1"></a><span class="st">4~12,76/Logísitica~Kg&quot;</span></span></code></pre></div>
<p></p>
<p>3.1.B) Perceba abaixo, que os objetos <code>pac1</code> e <code>pac2</code> são praticamente iguais. Perceba também, que estamos utilizando os mesmos comandos de importação para ambos os objetos. Porém, os resultados gerados pela função são diferentes em cada objeto. Tente identificar o que está causando essa diferença. Dado que você tenha identificado a fonte de tal diferença, como você ajustaria os comandos aplicados sobre cada objeto, de forma que os seus resultados sejam exatamente iguais?</p>
<p></p>
<div class="sourceCode" id="cb545"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb545-1"><a href="#cb545-1" aria-hidden="true" tabindex="-1"></a>pac1 <span class="ot">&lt;-</span> <span class="st">&quot;Setor;Produção;Receita;Gasto em P&amp;D</span></span>
<span id="cb545-2"><a href="#cb545-2" aria-hidden="true" tabindex="-1"></a><span class="st">Produtos alimentícios;10828,37;199907,55;3358,36</span></span>
<span id="cb545-3"><a href="#cb545-3" aria-hidden="true" tabindex="-1"></a><span class="st">Bebidas;759,53;28093,21;</span></span>
<span id="cb545-4"><a href="#cb545-4" aria-hidden="true" tabindex="-1"></a><span class="st">Produtos do fumo;69,99;8863,5;121,35</span></span>
<span id="cb545-5"><a href="#cb545-5" aria-hidden="true" tabindex="-1"></a><span class="st">Produtos têxteis;4153,97;25804,16;746,83</span></span>
<span id="cb545-6"><a href="#cb545-6" aria-hidden="true" tabindex="-1"></a><span class="st">Produtos de madeira;5088,78;15320,69;279,54</span></span>
<span id="cb545-7"><a href="#cb545-7" aria-hidden="true" tabindex="-1"></a><span class="st">Celulose e outras pastas;26,95;4245,19;216,7</span></span>
<span id="cb545-8"><a href="#cb545-8" aria-hidden="true" tabindex="-1"></a><span class="st">Refino de petróleo;75,48;114316,31;1550,73</span></span>
<span id="cb545-9"><a href="#cb545-9" aria-hidden="true" tabindex="-1"></a><span class="st">Produtos químicos;3179,52;133582,8;2914,09</span></span>
<span id="cb545-10"><a href="#cb545-10" aria-hidden="true" tabindex="-1"></a><span class="st">Produtos farmacêuticos;621,82;24972,07;1038,73&quot;</span></span>
<span id="cb545-11"><a href="#cb545-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb545-12"><a href="#cb545-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb545-13"><a href="#cb545-13" aria-hidden="true" tabindex="-1"></a>pac2 <span class="ot">&lt;-</span> <span class="st">&quot;Setor;Produção;Receita;Gasto em P&amp;D</span></span>
<span id="cb545-14"><a href="#cb545-14" aria-hidden="true" tabindex="-1"></a><span class="st">Produtos alimentícios;10.828,37;199907,55;3358,36</span></span>
<span id="cb545-15"><a href="#cb545-15" aria-hidden="true" tabindex="-1"></a><span class="st">Bebidas;759,53;28093,21;x</span></span>
<span id="cb545-16"><a href="#cb545-16" aria-hidden="true" tabindex="-1"></a><span class="st">Produtos do fumo;69,99;8863,5;121,35</span></span>
<span id="cb545-17"><a href="#cb545-17" aria-hidden="true" tabindex="-1"></a><span class="st">Produtos têxteis;4.153,97;25804,16;746,83</span></span>
<span id="cb545-18"><a href="#cb545-18" aria-hidden="true" tabindex="-1"></a><span class="st">Produtos de madeira;5.088,78;15320,69;279,54</span></span>
<span id="cb545-19"><a href="#cb545-19" aria-hidden="true" tabindex="-1"></a><span class="st">Celulose e outras pastas;26,95;4245,19;216,7</span></span>
<span id="cb545-20"><a href="#cb545-20" aria-hidden="true" tabindex="-1"></a><span class="st">Refino de petróleo;75,48;114316,31;1550,73</span></span>
<span id="cb545-21"><a href="#cb545-21" aria-hidden="true" tabindex="-1"></a><span class="st">Produtos químicos;3.179,52;133582,8;2914,09</span></span>
<span id="cb545-22"><a href="#cb545-22" aria-hidden="true" tabindex="-1"></a><span class="st">Produtos farmacêuticos;621,82;24972,07;1038,73&quot;</span></span>
<span id="cb545-23"><a href="#cb545-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb545-24"><a href="#cb545-24" aria-hidden="true" tabindex="-1"></a>readr<span class="sc">::</span><span class="fu">read_delim</span>(pac1, <span class="at">delim =</span> <span class="st">&quot;;&quot;</span>)</span></code></pre></div>
<pre><code>## Rows: 9 Columns: 4</code></pre>
<pre><code>## -- Column specification ---------------------------------------------------
## Delimiter: &quot;;&quot;
## chr (1): Setor</code></pre>
<pre><code>## 
## i Use `spec()` to retrieve the full column specification for this data.
## i Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<pre><code>## # A tibble: 9 x 4
##   Setor                       `Produ\xe7\xe3o`  Receita `Gasto em P&amp;D`
##   &lt;chr&gt;                                  &lt;dbl&gt;    &lt;dbl&gt;          &lt;dbl&gt;
## 1 &quot;Produtos aliment\xedcios&quot;           1082837 19990755         335836
## 2 &quot;Bebidas&quot;                              75953  2809321             NA
## 3 &quot;Produtos do fumo&quot;                      6999    88635          12135
## 4 &quot;Produtos t\xeaxteis&quot;                 415397  2580416          74683
## 5 &quot;Produtos de madeira&quot;                 508878  1532069          27954
## 6 &quot;Celulose e outras pastas&quot;              2695   424519           2167
## 7 &quot;Refino de petr\xf3leo&quot;                 7548 11431631         155073
## 8 &quot;Produtos qu\xedmicos&quot;                317952  1335828         291409
## 9 &quot;Produtos farmac\xeauticos&quot;            62182  2497207         103873</code></pre>
<div class="sourceCode" id="cb550"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb550-1"><a href="#cb550-1" aria-hidden="true" tabindex="-1"></a>readr<span class="sc">::</span><span class="fu">read_delim</span>(pac2, <span class="at">delim =</span> <span class="st">&quot;;&quot;</span>)</span></code></pre></div>
<pre><code>## Rows: 9 Columns: 4</code></pre>
<pre><code>## -- Column specification ---------------------------------------------------
## Delimiter: &quot;;&quot;
## chr (2): Setor, Gasto em P&amp;D</code></pre>
<pre><code>## 
## i Use `spec()` to retrieve the full column specification for this data.
## i Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<pre><code>## # A tibble: 9 x 4
##   Setor                       `Produ\xe7\xe3o`  Receita `Gasto em P&amp;D`
##   &lt;chr&gt;                                  &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;         
## 1 &quot;Produtos aliment\xedcios&quot;             10.8  19990755 3358,36       
## 2 &quot;Bebidas&quot;                           75953     2809321 x             
## 3 &quot;Produtos do fumo&quot;                   6999       88635 121,35        
## 4 &quot;Produtos t\xeaxteis&quot;                   4.15  2580416 746,83        
## 5 &quot;Produtos de madeira&quot;                   5.09  1532069 279,54        
## 6 &quot;Celulose e outras pastas&quot;           2695      424519 216,7         
## 7 &quot;Refino de petr\xf3leo&quot;              7548    11431631 1550,73       
## 8 &quot;Produtos qu\xedmicos&quot;                  3.18  1335828 2914,09       
## 9 &quot;Produtos farmac\xeauticos&quot;         62182     2497207 1038,73</code></pre>
<p></p>
<p>3.1.C) Considerando que você tenha chamado com sucesso pelo pacote <code>readr</code>, com o comando <code>library()</code>, você será capaz de executar os comandos mostrados abaixo sem problemas. Tais comandos buscam importar para o R, um arquivo chamado <code>challenge.csv</code> (a função <code>readr_example()</code> nos traz a localização desse arquivo <code>challenge.csv</code> em seu computador). Porém, perceba pelo resultado abaixo, que erros de importação ocorreram em 1000 linhas do arquivo.</p>
<p></p>
<div class="sourceCode" id="cb555"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb555-1"><a href="#cb555-1" aria-hidden="true" tabindex="-1"></a>import <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">readr_example</span>(<span class="st">&quot;challenge.csv&quot;</span>))</span></code></pre></div>

<p>Ao navegar por todo o conteúdo desse arquivo <code>challenge.csv</code>, você pode perceber que os dados contidos nesse arquivo foram incorretamente interpretados pela função <code>read_csv()</code>. Com isso, o seu trabalho será descobrir o que deu errado nesse processo, e ajustar os comandos de importação desse arquivo para que esse erro não ocorra.</p>
<p>Como uma dica, abra o arquivo <code>readr_example("challenge.csv")</code> e veja o seu conteúdo com cuidado. Com os comandos abaixo, você pode navegar por esse arquivo em uma janela de seu próprio RStudio. Portanto, tente descobrir o que está acontecendo de errado, e crie um comando que possa corrigir esse problema de importação.</p>
<p></p>
<div class="sourceCode" id="cb556"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb556-1"><a href="#cb556-1" aria-hidden="true" tabindex="-1"></a><span class="fu">file.edit</span>(<span class="fu">readr_example</span>(<span class="st">&quot;challenge.csv&quot;</span>))</span></code></pre></div>
<p></p>
<p>3.1.D) Considerando o objeto <code>t</code> abaixo, como você faria para importar corretamente esse arquivo? Vale ressaltar, que temos uma coluna contendo datas dentro do objeto <code>t</code>, e, até o momento, nós ainda não discutimos como o R interpreta ou lida com esse tipo de variável. Tal discussão é feita no capítulo 12 (<a href="#sec:lubridate_var_tempo">Introdução à variáveis de tempo com <code>lubridate</code></a>). Portanto, não se preocupe caso você não consiga importar especificamente essa coluna da maneira correta. De qualquer maneira, ao final desse livro, nós fornecemos todo o código necessário para interpretar corretamente essa coluna.</p>
<p></p>
<div class="sourceCode" id="cb557"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb557-1"><a href="#cb557-1" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> <span class="st">&quot;Data_execução*Unidades*Valor_compra</span></span>
<span id="cb557-2"><a href="#cb557-2" aria-hidden="true" tabindex="-1"></a><span class="st">20/01/2020*21*R$ 3049,50</span></span>
<span id="cb557-3"><a href="#cb557-3" aria-hidden="true" tabindex="-1"></a><span class="st">23/01/2020*502*R$ 1289,03</span></span>
<span id="cb557-4"><a href="#cb557-4" aria-hidden="true" tabindex="-1"></a><span class="st">25/01/2020*90*R$ 678,00</span></span>
<span id="cb557-5"><a href="#cb557-5" aria-hidden="true" tabindex="-1"></a><span class="st">02/02/2020*123*R$ 5401</span></span>
<span id="cb557-6"><a href="#cb557-6" aria-hidden="true" tabindex="-1"></a><span class="st">05/02/2020*45*R$ 1450,10</span></span>
<span id="cb557-7"><a href="#cb557-7" aria-hidden="true" tabindex="-1"></a><span class="st">07/02/2020*67*R$ 2320,97</span></span>
<span id="cb557-8"><a href="#cb557-8" aria-hidden="true" tabindex="-1"></a><span class="st">09/02/2020*187*R$ 6231,76&quot;</span></span></code></pre></div>
<p></p>
<p><strong>Questão 3.2.</strong> Copie e cole o endereço URL abaixo em seu navegador de preferência. Com esse link, uma planilha em Excel será baixada. Nessa planilha, temos alguns dados referentes aos municípios de Minas Gerais, ou, mais especificamente, a como esses municípios se encaixam no critério de Produção de Alimentos no âmbito da lei estadual 18.030/2009. Tente criar um comando que possa importar corretamente os dados dessa planilha para o R.</p>
<p>(<a href="https://github.com/pedropark99/Curso-R/blob/master/Dados/emater_icms_solidario.xlsx?raw=true" class="uri">https://github.com/pedropark99/Curso-R/blob/master/Dados/emater_icms_solidario.xlsx?raw=true</a>)</p>
<!--chapter:end:03-importacao.Rmd-->
</div>
</div>
<div id="transformando-dados-com-dplyr" class="section level1" number="5">
<h1 number="5"><span class="header-section-number">5</span> Transformando dados com <code>dplyr</code></h1>
<div id="introdução-e-pré-requisitos" class="section level2" number="5.1">
<h2 number="5.1"><span class="header-section-number">5.1</span> Introdução e pré-requisitos</h2>
<p>São raras as ocasiões em que os seus dados já se encontram no formato exato que você precisa para realizar as suas análises, ou para gerar os gráficos que você deseja <span class="citation">(<a href="#ref-wickham2017" role="doc-biblioref">Wickham and Grolemund 2017</a>)</span>. Por essa razão, você irá passar uma parte considerável de seu tempo, aplicando transformações sobre os seus dados, e calculando novas variáveis, e como os seus dados estarão, na maioria das situações, alocados em um <code>data.frame</code>, você precisa de ferramentas que sejam eficientes com tal estrutura <span class="citation">(<a href="#ref-peng2015" role="doc-biblioref">Peng 2015</a>)</span>. Esse é o objetivo do pacote <code>dplyr</code> com o qual vamos trabalhar neste capítulo.</p>
<p>Para que você tenha acesso as funções e possa acompanhar os exemplos desse capítulo, você precisa chamar pelo pacote <code>dplyr</code>. Porém, vamos utilizar algumas bases de dados que estão disponíveis através de outros pacotes presentes no <code>tidyverse</code>. Por isso, é preferível que você chame pelo <code>tidyverse</code> por meio do comando <code>library()</code>.</p>
<p></p>
<div class="sourceCode" id="cb558"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb558-1"><a href="#cb558-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb558-2"><a href="#cb558-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code></pre></div>
<p></p>
</div>
<div id="panorama-e-padrões-do-pacote-dplyr" class="section level2" number="5.2">
<h2 number="5.2"><span class="header-section-number">5.2</span> Panorama e padrões do pacote <code>dplyr</code></h2>
<p>Segundo a <a href="https://dplyr.tidyverse.org/">página oficial</a>, o pacote <code>dplyr</code> busca oferecer um conjunto de “verbos” (i.e. funções) voltados para as operações mais comumente aplicadas em tabelas. Ou seja, as funções desse pacote em geral aceitam um <code>data.frame</code> como <em>input</em>, e retornam um novo <code>data.frame</code> como <em>output</em>. Dito de forma menos técnica, você fornece uma tabela para essas funções, e elas lhe retornam como resultado uma nova tabela.</p>
<p>Se você possui alguma experiência com <em>relational database management systems</em> (RDBMS), você vai acabar percebendo ao longo deste capítulo, que o pacote <code>dplyr</code> é profundamente inspirado nos verbos da linguagem SQL. Por esse motivo, muitos usuários tendem a chamar as funções do pacote <code>dplyr</code> de “verbos.” Logo abaixo, temos uma lista das principais funções oferecidas pelo pacote, além de uma descrição rápida da ação realizada por cada um desses verbos.</p>
<ol style="list-style-type: decimal">
<li><p><code>select()</code>: busca selecionar ou extrair colunas de seu <code>data.frame</code>.</p></li>
<li><p><code>filter()</code>: busca filtrar linhas de seu <code>data.frame</code>.</p></li>
<li><p><code>arrange()</code>: busca ordenar (ou organizar) as linhas de seu <code>data.frame</code>.</p></li>
<li><p><code>mutate()</code>: busca adicionar ou calcular novas colunas em seu <code>data.frame</code>.</p></li>
<li><p><code>summarise()</code>: busca sintetizar múltiplos valores de seu <code>data.frame</code> em um único valor.</p></li>
<li><p><code>group_by()</code>: permite que as operações sejam executadas dentro de cada “grupo” de seu <code>data.frame</code>; em outras palavras, a função busca definir os grupos existentes em seu <code>data.frame</code>, e deixar essa definição explícita e disponível para os outros verbos, de modo que eles possam respeitar esses grupos em suas operações.</p></li>
</ol>
<p>Dentre os verbos acima, o <code>group_by()</code> é definitivamente o mais difícil de se explicar de uma maneira clara e, ao mesmo tempo, resumida. De qualquer maneira, vamos discutir ele por extenso na seção <a href="#sec:group_by_summarise">Agrupando dados e gerando estatísticas sumárias com <code>group_by()</code> e <code>summarise()</code></a>. Além disso, também vamos abordar nesse capítulo, o uso do operador <em>pipe</em> (<code>%&gt;%</code>) que provêm do pacote <code>magrittr</code>, e que hoje, faz parte da identidade do pacote <code>dplyr</code>, e do <code>tidyverse</code> como um todo.</p>
<p><span class="citation"><a href="#ref-peng2015" role="doc-biblioref">Peng</a> (<a href="#ref-peng2015" role="doc-biblioref">2015</a>)</span> destacou algumas características compartilhadas pelas funções do pacote <code>dplyr</code>:</p>
<ol style="list-style-type: decimal">
<li><p>Possuem como primeiro argumento (<code>.data</code>), o <code>data.frame</code> no qual você deseja aplicar a função que você está utilizando.</p></li>
<li><p>Os argumentos subsequentes buscam descrever como e onde aplicar a função sobre o <code>data.frame</code> definido no primeiro argumento.</p></li>
<li><p>Geram um novo <code>data.frame</code> como resultado.</p></li>
<li><p>Como você definiu o <code>data.frame</code> a ser utilizando no primeiro argumento da função, você pode se referir às colunas desse <code>data.frame</code> apenas pelo seus nomes. Ou seja, dentro das funções do pacote <code>dplyr</code>, você não precisa mais do operador <code>$</code> para acessar as colunas do <code>data.frame</code> utilizado.</p></li>
</ol>
<p>No momento, essas características podem parecer difusas. Porém, você irá rapidamente reconhecê-las ao longo deste capítulo.</p>
</div>
<div id="operador-pipe" class="section level2" number="5.3">
<h2 number="5.3"><span class="header-section-number">5.3</span> Operador <em>pipe</em> (<code>%&gt;%</code>)</h2>
<p>Hoje, o operador <em>pipe</em> (<code>%&gt;%</code>) faz parte da identidade dos pacotes que compõe o <code>tidyverse</code> e, por isso, você irá encontrar esse operador em praticamente qualquer <em>script</em> que utilize algum desses pacotes. Grande parte dessa identidade foi construída nos últimos anos, em especial, com a obra de <span class="citation"><a href="#ref-wickham2017" role="doc-biblioref">Wickham and Grolemund</a> (<a href="#ref-wickham2017" role="doc-biblioref">2017</a>)</span> que se tornou um importante livro-texto da linguagem R como um todo.</p>
<p>O operador <em>pipe</em> provêm do pacote <code>magrittr</code>, e o seu único objetivo é tornar o seu código mais claro e compreensível. Ou seja, o <em>pipe</em> em nada altera o resultado ou as configurações de seus comandos, ele apenas os organiza em uma estrutura mais limpa e arranjada. Apesar de sua origem ser o pacote <code>magrittr</code>, o <em>pipe</em> é carregado automaticamente quando chamamos pelo <code>tidyverse</code>, através do comando <code>library()</code>. Com isso, temos duas opções para termos acesso a esse operador: chamar pelo pacote <code>magrittr</code>, ou chamar pelo <code>tidyverse</code>.</p>
<p></p>
<div class="sourceCode" id="cb559"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb559-1"><a href="#cb559-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Com um desses comandos você</span></span>
<span id="cb559-2"><a href="#cb559-2" aria-hidden="true" tabindex="-1"></a><span class="do">## pode utilizar o operador %&gt;% </span></span>
<span id="cb559-3"><a href="#cb559-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb559-4"><a href="#cb559-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Ou</span></span>
<span id="cb559-5"><a href="#cb559-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span></code></pre></div>
<p></p>
<p><strong>ATALHO:</strong> No RStudio, você pode criar um <em>pipe</em> através do atalho <code>Ctrl + Shift + M</code>.</p>
<p>Mesmo que esse efeito seja simples, ele é extremamente importante. A estrutura em “cadeia” construída pelo <em>pipe</em> gera uma grande economia em seu tempo de trabalho, pois você não precisa mais se preocupar em salvar o resultado de vários passos intermediários em algum objeto. Dessa maneira, você pode focar mais tempo nas próprias transformações em si, e no resultado que você deseja atingir. Além disso, essa estrutura também vai salvar muito de seu tempo, nos momentos em que você retornar ao seu trabalho no dia seguinte. Pois se o seu código nessa estrutura está mais claro e fácil de se ler, você pode recuperar com maior rapidez a compreensão do ponto em que você parou no dia anterior.</p>
<p>Isso é muito importante, pois você nunca está trabalhando sozinho! Você sempre está, no mínimo, trabalhando com o seu futuro eu <span class="citation">(<a href="#ref-wickham2017" role="doc-biblioref">Wickham and Grolemund 2017</a>)</span>. Por isso, qualquer quantidade de tempo que você emprega para tornar os seus comandos mais legíveis e eficientes, você estará automaticamente economizando o seu tempo no dia seguinte, quando você terá de retornar a esses comandos, e prosseguir com o seu trabalho. Para mais, os seus possíveis colegas de trabalho, ou outras pessoas que estiverem envolvidas no desenvolvimento de seu <em>script</em>, vão compreender de maneira mais eficiente as transformações que você está aplicando e, portanto, vão ser capazes de contribuir com o seu trabalho de maneira mais rápida.</p>
<div id="o-que-o-pipe-faz" class="section level3" number="5.3.1">
<h3 number="5.3.1"><span class="header-section-number">5.3.1</span> O que o <em>pipe</em> faz ?</h3>
<p>Em qualquer análise, temos em geral diversas etapas ou transformações a serem executadas, e em sua maioria, essas etapas assumem uma ordem específica. Quando realizamos essas etapas no R, nós comumente salvamos os resultados de cada passo em novos objetos, e utilizamos esses objetos “intermediários” em cada operação adicional para chegarmos ao resultado final que desejamos. Perceba no exemplo abaixo, o trabalho que temos ao salvarmos os resultados de cada passo em um objeto, e utilizarmos esse objeto na próxima transformação.</p>
<p></p>
<div class="sourceCode" id="cb560"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb560-1"><a href="#cb560-1" aria-hidden="true" tabindex="-1"></a>dados <span class="ot">&lt;-</span> mpg</span>
<span id="cb560-2"><a href="#cb560-2" aria-hidden="true" tabindex="-1"></a>agrupamento <span class="ot">&lt;-</span> <span class="fu">group_by</span>(<span class="at">.data =</span> dados, class)</span>
<span id="cb560-3"><a href="#cb560-3" aria-hidden="true" tabindex="-1"></a>base_ordenada <span class="ot">&lt;-</span> <span class="fu">arrange</span>(<span class="at">.data =</span> agrupamento, hwy)</span>
<span id="cb560-4"><a href="#cb560-4" aria-hidden="true" tabindex="-1"></a>base_completa <span class="ot">&lt;-</span> <span class="fu">mutate</span>(</span>
<span id="cb560-5"><a href="#cb560-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">.data =</span> base_ordenada,</span>
<span id="cb560-6"><a href="#cb560-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">media =</span> <span class="fu">mean</span>(hwy),</span>
<span id="cb560-7"><a href="#cb560-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">desvio =</span> hwy <span class="sc">-</span> media</span>
<span id="cb560-8"><a href="#cb560-8" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p></p>
<p>Aqui se encontra uma vantagem importante do operador <em>pipe</em>, pois ele elimina essa necessidade de objetos “intermediários,” ao “carregar” os resultados ao longo de diversas funções. Em outras palavras, esse operador funciona como uma ponte entre cada etapa, ou entre cada função aplicada. Dito de uma maneira mais específica, quando conectamos duas funções por um <em>pipe</em>, o operador carrega o resultado da primeira função, e o insere como o primeiro argumento da segunda função. Com isso, eu posso reescrever os comandos anteriores da seguinte forma:</p>
<p></p>
<div class="sourceCode" id="cb561"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb561-1"><a href="#cb561-1" aria-hidden="true" tabindex="-1"></a>mpg <span class="sc">%&gt;%</span> </span>
<span id="cb561-2"><a href="#cb561-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(class) <span class="sc">%&gt;%</span> </span>
<span id="cb561-3"><a href="#cb561-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(hwy) <span class="sc">%&gt;%</span> </span>
<span id="cb561-4"><a href="#cb561-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb561-5"><a href="#cb561-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">media =</span> <span class="fu">mean</span>(hwy),</span>
<span id="cb561-6"><a href="#cb561-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">desvio =</span> hwy <span class="sc">-</span> media</span>
<span id="cb561-7"><a href="#cb561-7" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p></p>
<p>Além das vantagens destacadas até o momento, ao evitar o uso de objetos “intermediários,” o <em>pipe</em> acaba evitando que você use desnecessariamente a memória de seu computador. Pois cada objeto criado no R, precisa ocupar um espaço de sua memória RAM para permanecer “vivo” e disponível em sua sessão. Como evitamos a criação desses objetos “intermediários,” estamos utilizando menos memória para realizar exatamente as mesmas etapas e gerar os mesmos resultados.</p>
<p>Apenas para que o uso do <em>pipe</em> fique claro, se eu possuo as funções <code>x()</code>, <code>y()</code> e <code>z()</code>, e desejo calcular a expressão <code>z(y(x(10), times = 1), n = 20, replace = TRUE)</code>, nós podemos reescrever essa expressão do modo exposto abaixo. Dessa maneira, o <em>pipe</em> vai pegar o resultado de <code>x(10)</code>, e inseri-lo como o primeiro argumento da função <code>y()</code>; depois de calcular o resultado da função <code>y()</code>, o próximo <em>pipe</em> vai passá-lo para a função <code>z()</code>; e como a função <code>z()</code> é a última função da cadeia, o console vai lhe mostrar o resultado final desse processo.</p>
<p></p>
<div class="sourceCode" id="cb562"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb562-1"><a href="#cb562-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Expressão original</span></span>
<span id="cb562-2"><a href="#cb562-2" aria-hidden="true" tabindex="-1"></a><span class="fu">z</span>(<span class="fu">y</span>(<span class="fu">x</span>(<span class="dv">10</span>), <span class="at">times =</span> <span class="dv">1</span>), <span class="at">n =</span> <span class="dv">20</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb562-3"><a href="#cb562-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb562-4"><a href="#cb562-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Com o uso do pipe %&gt;% </span></span>
<span id="cb562-5"><a href="#cb562-5" aria-hidden="true" tabindex="-1"></a><span class="fu">x</span>(<span class="dv">10</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb562-6"><a href="#cb562-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">y</span>(<span class="at">times =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb562-7"><a href="#cb562-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">z</span>(<span class="at">n =</span> <span class="dv">20</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p></p>
</div>
<div id="o-que-o-pipe-não-é-capaz-de-fazer" class="section level3" number="5.3.2">
<h3 number="5.3.2"><span class="header-section-number">5.3.2</span> O que o <em>pipe</em> não é capaz de fazer ?</h3>
<p>O <em>pipe</em> não é capaz de trabalhar perfeitamente com qualquer função, e a principal característica que você precisa observar para identificar se essa afirmação é verdadeira ou não para uma dada função, é o seu primeiro argumento.</p>
<p>Como o <em>pipe</em> insere o <strong>resultado</strong> da expressão anterior no primeiro argumento da próxima função, esse primeiro argumento precisa corresponder ao argumento no qual você deseja utilizar esse <strong>resultado</strong>. Na maior parte do tempo, desejamos utilizar esse <strong>resultado</strong> como os dados sobre os quais vamos aplicar a nossa próxima função. Este é um dos principais motivos pelos quais praticamente todas as funções de todos os pacotes que compõe o <code>tidyverse</code>, trabalham perfeitamente bem com o operador <em>pipe</em>. Pois todas essas funções possuem como primeiro argumento, algo parecido com <code>.data</code>, <code>data</code> ou <code>x</code>, que busca definir o objeto sobre o qual vamos aplicar a função.</p>
<p>Caso o argumento a ser utilizado, esteja em uma posição diferente (se trata do segundo, terceiro ou quarto argumento da função), você pode utilizar um ponto final (<code>.</code>) para alterar a posição em que o resultado das etapas anteriores será introduzido. Basta posicionar o ponto final no argumento em que você deseja inserir esse resultado.</p>
<p>Um clássico exemplo que se encaixa nessa hipótese, é a função <code>lm()</code>, que é a principal função empregada no cálculo de uma regressão linear no R. Nessa função, o primeiro argumento corresponde a fórmula a ser utilizada na regressão; já os dados a serem usados na regressão, são delimitados no segundo argumento da função (<code>data</code>). Veja no exemplo abaixo, que eu utilizo um ponto final sobre o argumento <code>data</code>, para dizer ao <em>pipe</em> que ele deve inserir o resultado anterior especificamente nesse argumento.</p>
<p></p>
<div class="sourceCode" id="cb563"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb563-1"><a href="#cb563-1" aria-hidden="true" tabindex="-1"></a>mpg <span class="sc">%&gt;%</span> </span>
<span id="cb563-2"><a href="#cb563-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lm</span>(hwy <span class="sc">~</span> cyl, <span class="at">data =</span> .) <span class="sc">%&gt;%</span> </span>
<span id="cb563-3"><a href="#cb563-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>()</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = hwy ~ cyl, data = .)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -8.7579 -2.4968  0.2421  2.4379 15.2421 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  40.0190     0.9591   41.72   &lt;2e-16 ***
## cyl          -2.8153     0.1571  -17.92   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 3.865 on 232 degrees of freedom
## Multiple R-squared:  0.5805, Adjusted R-squared:  0.5787 
## F-statistic: 321.1 on 1 and 232 DF,  p-value: &lt; 2.2e-16</code></pre>
<p></p>
</div>
<div id="duas-dicas-rápidas-sobre-o-pipe" class="section level3" number="5.3.3">
<h3 number="5.3.3"><span class="header-section-number">5.3.3</span> Duas dicas rápidas sobre o <em>pipe</em></h3>
<p>O <em>pipe</em> cria uma espécie de efeito em cadeia, e muitas vezes nos preocupamos demais com as etapas dessa cadeia, e nos esquecemos de definir o local em que o resultado dessa cadeia deve ocupar. Portanto, lembre-se que para salvar o resultado final da cadeia formada pelos seus <em>pipe</em>’s, você necessita salvar esse resultado em algum objeto. Para isso, você deve posicionar o nome do objeto, e o símbolo de <em>assignment</em> (<code>&lt;-</code>), logo no início dessa cadeia, como no exemplo abaixo.</p>
<p></p>
<div class="sourceCode" id="cb565"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb565-1"><a href="#cb565-1" aria-hidden="true" tabindex="-1"></a>resultado <span class="ot">&lt;-</span> mpg <span class="sc">%&gt;%</span> </span>
<span id="cb565-2"><a href="#cb565-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(class) <span class="sc">%&gt;%</span> </span>
<span id="cb565-3"><a href="#cb565-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(hwy) <span class="sc">%&gt;%</span> </span>
<span id="cb565-4"><a href="#cb565-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb565-5"><a href="#cb565-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">media =</span> <span class="fu">mean</span>(hwy),</span>
<span id="cb565-6"><a href="#cb565-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">desvio =</span> hwy <span class="sc">-</span> media</span>
<span id="cb565-7"><a href="#cb565-7" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p></p>
<p>Uma outra dica, seria não formar cadeias muito longas. Como um guia, uma cadeia de <em>pipe</em>’s não deveria passar de 7 etapas. Caso você precise aplicar mais do que 7 etapas, é melhor que você salve o resultado da 7° etapa em um objeto, e inicie uma nova cadeia a partir deste objeto.</p>
</div>
</div>
<div id="selecionando-colunas-com-select" class="section level2" number="5.4">
<h2 number="5.4"><span class="header-section-number">5.4</span> Selecionando colunas com <code>select()</code></h2>
<p>Como definimos anteriormente, a função <code>select()</code> busca selecionar colunas de seu <code>data.frame</code>. Você já possui uma boa ideia de como realizar essa ação através da função de <em>subsetting</em> (<code>[</code>). Porém, nós podemos usufruir da flexibilidade oferecida pela função <code>select()</code>, que lhe permite realizar essa mesma operação de diversas maneiras intuitivas.</p>
<p>No geral, temos ao menos 5 métodos diferentes que podemos utilizar na função <code>select()</code>:</p>
<ol style="list-style-type: decimal">
<li><p>simplesmente listar o nome das colunas que desejamos;</p></li>
<li><p>fornecer um vetor externo, contendo os nomes das colunas a serem extraídas;</p></li>
<li><p>selecionar um conjunto de colunas com base em seu tipo (<code>integer</code>, <code>double</code>, <code>character</code>, <code>logical</code>);</p></li>
<li><p>selecionar um conjunto de colunas com base em padrões que aparecem nos nomes dessas colunas (nome começa por y, ou termina em z, ou contém x);</p></li>
<li><p>selecionar um conjunto de colunas com base em seus índices numéricos (1° colunas, 2° coluna, 3° coluna, etc.).</p></li>
</ol>
<p>Como exemplo inicial, vamos utilizar a tabela <code>billboard</code>, que apresenta a posição de diversas músicas na lista Billboard Top 100, ao longo do ano de 2000. Se você chamou com sucesso pelo <code>tidyverse</code>, você tem acesso a essa tabela. Perceba que a posição de cada música descrita na tabela, é apresentada de forma semanal, onde cada semana possui a sua coluna própria. Por essa razão, temos uma quantidade exorbitante de colunas na tabela.</p>
<p></p>
<div class="sourceCode" id="cb566"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb566-1"><a href="#cb566-1" aria-hidden="true" tabindex="-1"></a>billboard</span></code></pre></div>
<pre><code>## # A tibble: 317 x 79
##    artist   track    date.entered   wk1   wk2   wk3   wk4   wk5   wk6   wk7
##    &lt;chr&gt;    &lt;chr&gt;    &lt;date&gt;       &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 2 Pac    Baby Do~ 2000-02-26      87    82    72    77    87    94    99
##  2 2Ge+her  The Har~ 2000-09-02      91    87    92    NA    NA    NA    NA
##  3 3 Doors~ Krypton~ 2000-04-08      81    70    68    67    66    57    54
##  4 3 Doors~ Loser    2000-10-21      76    76    72    69    67    65    55
##  5 504 Boyz Wobble ~ 2000-04-15      57    34    25    17    17    31    36
##  6 98^0     Give Me~ 2000-08-19      51    39    34    26    26    19     2
##  7 A*Teens  Dancing~ 2000-07-08      97    97    96    95   100    NA    NA
##  8 Aaliyah  I Don&#39;t~ 2000-01-29      84    62    51    41    38    35    35
##  9 Aaliyah  Try Aga~ 2000-03-18      59    53    38    28    21    18    16
## 10 Adams, ~ Open My~ 2000-08-26      76    76    74    69    68    67    61
## # ... with 307 more rows, and 69 more variables: wk8 &lt;dbl&gt;, wk9 &lt;dbl&gt;,
## #   wk10 &lt;dbl&gt;, wk11 &lt;dbl&gt;, wk12 &lt;dbl&gt;, wk13 &lt;dbl&gt;, wk14 &lt;dbl&gt;,
## #   wk15 &lt;dbl&gt;, wk16 &lt;dbl&gt;, wk17 &lt;dbl&gt;, wk18 &lt;dbl&gt;, wk19 &lt;dbl&gt;,
## #   wk20 &lt;dbl&gt;, wk21 &lt;dbl&gt;, wk22 &lt;dbl&gt;, wk23 &lt;dbl&gt;, wk24 &lt;dbl&gt;,
## #   wk25 &lt;dbl&gt;, wk26 &lt;dbl&gt;, wk27 &lt;dbl&gt;, wk28 &lt;dbl&gt;, wk29 &lt;dbl&gt;,
## #   wk30 &lt;dbl&gt;, wk31 &lt;dbl&gt;, wk32 &lt;dbl&gt;, wk33 &lt;dbl&gt;, wk34 &lt;dbl&gt;,
## #   wk35 &lt;dbl&gt;, wk36 &lt;dbl&gt;, wk37 &lt;dbl&gt;, wk38 &lt;dbl&gt;, wk39 &lt;dbl&gt;, ...</code></pre>
<p></p>
<p>O método 5 citado acima é um dos métodos mais práticos e eficientes de se utilizar a função <code>select()</code>. Por exemplo, se desejássemos extrair todas as colunas entre a 1° e 4° colunas da tabela, poderíamos fornecer um vetor à função, contendo uma sequência de 1 a 4, que representa os índices das colunas que desejamos, como no exemplo abaixo.</p>
<p></p>
<div class="sourceCode" id="cb568"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb568-1"><a href="#cb568-1" aria-hidden="true" tabindex="-1"></a>billboard_sel <span class="ot">&lt;-</span> <span class="fu">select</span>(billboard, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)</span>
<span id="cb568-2"><a href="#cb568-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb568-3"><a href="#cb568-3" aria-hidden="true" tabindex="-1"></a>billboard_sel</span></code></pre></div>
<pre><code>## # A tibble: 317 x 4
##    artist         track                   date.entered   wk1
##    &lt;chr&gt;          &lt;chr&gt;                   &lt;date&gt;       &lt;dbl&gt;
##  1 2 Pac          Baby Don&#39;t Cry (Keep... 2000-02-26      87
##  2 2Ge+her        The Hardest Part Of ... 2000-09-02      91
##  3 3 Doors Down   Kryptonite              2000-04-08      81
##  4 3 Doors Down   Loser                   2000-10-21      76
##  5 504 Boyz       Wobble Wobble           2000-04-15      57
##  6 98^0           Give Me Just One Nig... 2000-08-19      51
##  7 A*Teens        Dancing Queen           2000-07-08      97
##  8 Aaliyah        I Don&#39;t Wanna           2000-01-29      84
##  9 Aaliyah        Try Again               2000-03-18      59
## 10 Adams, Yolanda Open My Heart           2000-08-26      76
## # ... with 307 more rows</code></pre>
<p></p>
<p>Agora, e se você precisasse selecionar todas as colunas que representam as semanas? Nesse caso, o método 5 ainda seria uma boa alternativa, pois você precisaria apenas fornecer uma sequência que represente a posição dessas colunas na tabela (de 4 a 79 para ser mais preciso).</p>
<p>Porém, todas essas colunas possuem um padrão em seus nomes. Elas se iniciam pelos caracteres <code>"wk"</code>, acrescidos de um número que representa o índice da semana que essa coluna corresponde. Portanto, em todas as ocasiões que houver algum padrão presente nos nomes das colunas que você deseja selecionar, o método 4 que citamos configura-se como uma ótima solução. Nesse método, devemos utilizar as funções de suporte <code>starts_with()</code>, <code>ends_with()</code>, <code>matches()</code>.</p>
<p>Como os seus próprios nomes dão a entender, as funções <code>starts_with()</code> e <code>ends_with()</code> vão selecionar qualquer coluna de sua tabela que comece (<em>start</em>) ou termine (<em>end</em>) por uma determinada cadeia de caracteres, respectivamente. Como exemplo, eu posso selecionar todas as colunas que apresentam as posições semanais na tabela <code>billboard</code>, ao encontrar todas as colunas que começam pelas letras <code>"wk"</code>, com a função <code>starts_with()</code>.</p>
<p></p>
<div class="sourceCode" id="cb570"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb570-1"><a href="#cb570-1" aria-hidden="true" tabindex="-1"></a>billboard_sel <span class="ot">&lt;-</span> <span class="fu">select</span>(billboard, <span class="fu">starts_with</span>(<span class="st">&quot;wk&quot;</span>))</span>
<span id="cb570-2"><a href="#cb570-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb570-3"><a href="#cb570-3" aria-hidden="true" tabindex="-1"></a>billboard_sel</span></code></pre></div>
<pre><code>## # A tibble: 317 x 76
##      wk1   wk2   wk3   wk4   wk5   wk6   wk7   wk8   wk9  wk10  wk11  wk12
##    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1    87    82    72    77    87    94    99    NA    NA    NA    NA    NA
##  2    91    87    92    NA    NA    NA    NA    NA    NA    NA    NA    NA
##  3    81    70    68    67    66    57    54    53    51    51    51    51
##  4    76    76    72    69    67    65    55    59    62    61    61    59
##  5    57    34    25    17    17    31    36    49    53    57    64    70
##  6    51    39    34    26    26    19     2     2     3     6     7    22
##  7    97    97    96    95   100    NA    NA    NA    NA    NA    NA    NA
##  8    84    62    51    41    38    35    35    38    38    36    37    37
##  9    59    53    38    28    21    18    16    14    12    10     9     8
## 10    76    76    74    69    68    67    61    58    57    59    66    68
## # ... with 307 more rows, and 64 more variables: wk13 &lt;dbl&gt;, wk14 &lt;dbl&gt;,
## #   wk15 &lt;dbl&gt;, wk16 &lt;dbl&gt;, wk17 &lt;dbl&gt;, wk18 &lt;dbl&gt;, wk19 &lt;dbl&gt;,
## #   wk20 &lt;dbl&gt;, wk21 &lt;dbl&gt;, wk22 &lt;dbl&gt;, wk23 &lt;dbl&gt;, wk24 &lt;dbl&gt;,
## #   wk25 &lt;dbl&gt;, wk26 &lt;dbl&gt;, wk27 &lt;dbl&gt;, wk28 &lt;dbl&gt;, wk29 &lt;dbl&gt;,
## #   wk30 &lt;dbl&gt;, wk31 &lt;dbl&gt;, wk32 &lt;dbl&gt;, wk33 &lt;dbl&gt;, wk34 &lt;dbl&gt;,
## #   wk35 &lt;dbl&gt;, wk36 &lt;dbl&gt;, wk37 &lt;dbl&gt;, wk38 &lt;dbl&gt;, wk39 &lt;dbl&gt;,
## #   wk40 &lt;dbl&gt;, wk41 &lt;dbl&gt;, wk42 &lt;dbl&gt;, wk43 &lt;dbl&gt;, wk44 &lt;dbl&gt;, ...</code></pre>
<p></p>
<p>Já a função <code>matches()</code> se trata de um caso muito mais flexível das funções <code>starts_with()</code> e <code>ends_with()</code>, pois ela lhe permite selecionar qualquer coluna cujo o nome se encaixa em uma dada expressão regular. Expressões regulares são uma poderosa ferramenta para processamento de texto, a qual vamos discutir no capítulo 11 deste livro, especialmente na seção <a href="#sec:stringr_regex">Expressões regulares (ou <em>regex</em>) com <code>str_detect()</code></a>. Outras duas referências úteis sobre o assunto, se encontram no <a href="https://r4ds.had.co.nz/strings.html">capítulo 14</a> de <span class="citation"><a href="#ref-wickham2017" role="doc-biblioref">Wickham and Grolemund</a> (<a href="#ref-wickham2017" role="doc-biblioref">2017</a>)</span>, que provê uma visão mais direta, além da obra de <span class="citation"><a href="#ref-friedl2006" role="doc-biblioref">Friedl</a> (<a href="#ref-friedl2006" role="doc-biblioref">2006</a>)</span> que oferece uma visão técnica e aprofundada sobre o assunto. Veja alguns exemplos abaixo:</p>
<p></p>
<div class="sourceCode" id="cb572"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb572-1"><a href="#cb572-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Seleciona todas as semanas que são</span></span>
<span id="cb572-2"><a href="#cb572-2" aria-hidden="true" tabindex="-1"></a><span class="do">## maiores do que 9 e menores do que 100.</span></span>
<span id="cb572-3"><a href="#cb572-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Ou seja, toda semana com dois dígitos</span></span>
<span id="cb572-4"><a href="#cb572-4" aria-hidden="true" tabindex="-1"></a>billboard <span class="sc">%&gt;%</span> </span>
<span id="cb572-5"><a href="#cb572-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">matches</span>(<span class="st">&quot;wk[0-9]{2}&quot;</span>)) <span class="sc">%&gt;%</span> <span class="fu">print</span>(<span class="at">n =</span> <span class="dv">5</span>)</span></code></pre></div>
<pre><code>## # A tibble: 317 x 67
##    wk10  wk11  wk12  wk13  wk14  wk15  wk16  wk17  wk18  wk19  wk20  wk21
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA
## 2    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA
## 3    51    51    51    47    44    38    28    22    18    18    14    12
## 4    61    61    59    61    66    72    76    75    67    73    70    NA
## 5    57    64    70    75    76    78    85    92    96    NA    NA    NA
## # ... with 312 more rows, and 55 more variables: wk22 &lt;dbl&gt;, wk23 &lt;dbl&gt;,
## #   wk24 &lt;dbl&gt;, wk25 &lt;dbl&gt;, wk26 &lt;dbl&gt;, wk27 &lt;dbl&gt;, wk28 &lt;dbl&gt;,
## #   wk29 &lt;dbl&gt;, wk30 &lt;dbl&gt;, wk31 &lt;dbl&gt;, wk32 &lt;dbl&gt;, wk33 &lt;dbl&gt;,
## #   wk34 &lt;dbl&gt;, wk35 &lt;dbl&gt;, wk36 &lt;dbl&gt;, wk37 &lt;dbl&gt;, wk38 &lt;dbl&gt;,
## #   wk39 &lt;dbl&gt;, wk40 &lt;dbl&gt;, wk41 &lt;dbl&gt;, wk42 &lt;dbl&gt;, wk43 &lt;dbl&gt;,
## #   wk44 &lt;dbl&gt;, wk45 &lt;dbl&gt;, wk46 &lt;dbl&gt;, wk47 &lt;dbl&gt;, wk48 &lt;dbl&gt;,
## #   wk49 &lt;dbl&gt;, wk50 &lt;dbl&gt;, wk51 &lt;dbl&gt;, wk52 &lt;dbl&gt;, wk53 &lt;dbl&gt;, ...</code></pre>
<div class="sourceCode" id="cb574"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb574-1"><a href="#cb574-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Seleciona todas as colunas cujo nome</span></span>
<span id="cb574-2"><a href="#cb574-2" aria-hidden="true" tabindex="-1"></a><span class="do">## possua um ponto final antecedido por</span></span>
<span id="cb574-3"><a href="#cb574-3" aria-hidden="true" tabindex="-1"></a><span class="do">## 4 letras</span></span>
<span id="cb574-4"><a href="#cb574-4" aria-hidden="true" tabindex="-1"></a>billboard <span class="sc">%&gt;%</span> </span>
<span id="cb574-5"><a href="#cb574-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">matches</span>(<span class="st">&quot;[a-z]{4}[.]&quot;</span>)) <span class="sc">%&gt;%</span> <span class="fu">print</span>(<span class="at">n =</span> <span class="dv">5</span>)</span></code></pre></div>
<pre><code>## # A tibble: 317 x 1
##   date.entered
##   &lt;date&gt;      
## 1 2000-02-26  
## 2 2000-09-02  
## 3 2000-04-08  
## 4 2000-10-21  
## 5 2000-04-15  
## # ... with 312 more rows</code></pre>
<p></p>
<p>Essas são maneiras eficientes de selecionarmos um grande conjunto de colunas, porém, muitas vezes as nossas necessidades são pequenas e, portanto, não exigem mecanismos tão poderosos. Nessas situações, o método 1 se torna útil pois ele consiste em simplesmente listarmos o nome das colunas desejadas. Como exemplo, eu posso selecionar as colunas <code>artist</code>, <code>track</code> e <code>wk5</code> da tabela <code>billboard</code> pelo comando abaixo.</p>
<p></p>
<div class="sourceCode" id="cb576"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb576-1"><a href="#cb576-1" aria-hidden="true" tabindex="-1"></a>billboard <span class="sc">%&gt;%</span> <span class="fu">select</span>(artist, track, wk5)</span></code></pre></div>
<pre><code>## # A tibble: 317 x 3
##    artist         track                     wk5
##    &lt;chr&gt;          &lt;chr&gt;                   &lt;dbl&gt;
##  1 2 Pac          Baby Don&#39;t Cry (Keep...    87
##  2 2Ge+her        The Hardest Part Of ...    NA
##  3 3 Doors Down   Kryptonite                 66
##  4 3 Doors Down   Loser                      67
##  5 504 Boyz       Wobble Wobble              17
##  6 98^0           Give Me Just One Nig...    26
##  7 A*Teens        Dancing Queen             100
##  8 Aaliyah        I Don&#39;t Wanna              38
##  9 Aaliyah        Try Again                  21
## 10 Adams, Yolanda Open My Heart              68
## # ... with 307 more rows</code></pre>
<p></p>
<p>Vale destacar que a ordem dos índices utilizados importa para a função <code>select()</code>. Logo, se no exemplo acima, eu listasse as colunas na ordem <code>track</code>, <code>wk5</code> e <code>artist</code>, o novo <code>data.frame</code> resultante de <code>select()</code>, iria conter essas colunas precisamente nessa ordem. O mesmo efeito seria produzido, caso eu utilizasse novamente o método 5, e fornecesse o vetor <code>c(3, 2, 4)</code> à função. Dessa forma, <code>select()</code> iria me retornar um novo <code>data.frame</code> contendo 3 colunas, que correspondem a 3°, 2° e 4° colunas da tabela <code>billboard</code>, exatamente nessa ordem.</p>
<p>Por outro lado, não há uma maneira de variarmos a ordem dos resultados gerados nos métodos 3 e 4, especificamente. Por isso, caso você utilize um desses dois métodos, as colunas selecionadas serão apresentadas no novo <code>data.frame</code>, precisamente na ordem em que eles aparecem no <code>data.frame</code> inicial.</p>
<p>Visto esses pontos, ao invés de selecionar colunas, você também pode utilizar o método 1 para rapidamente eliminar algumas colunas de seu <code>data.frame</code>, ao posicionar um sinal negativo (<code>-</code>) antes do nome da coluna que você deseja retirar. Por exemplo, eu posso selecionar todas as colunas da tabela <code>mpg</code>, exceto as colunas <code>hwy</code> e <code>manufacturer</code> por meio do seguinte comando:</p>
<p></p>
<div class="sourceCode" id="cb578"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb578-1"><a href="#cb578-1" aria-hidden="true" tabindex="-1"></a>mpg <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>hwy, <span class="sc">-</span>manufacturer)</span></code></pre></div>
<pre><code>## # A tibble: 234 x 9
##    model      displ  year   cyl trans      drv     cty fl    class  
##    &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;      &lt;chr&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt;  
##  1 a4           1.8  1999     4 auto(l5)   f        18 p     compact
##  2 a4           1.8  1999     4 manual(m5) f        21 p     compact
##  3 a4           2    2008     4 manual(m6) f        20 p     compact
##  4 a4           2    2008     4 auto(av)   f        21 p     compact
##  5 a4           2.8  1999     6 auto(l5)   f        16 p     compact
##  6 a4           2.8  1999     6 manual(m5) f        18 p     compact
##  7 a4           3.1  2008     6 auto(av)   f        18 p     compact
##  8 a4 quattro   1.8  1999     4 manual(m5) 4        18 p     compact
##  9 a4 quattro   1.8  1999     4 auto(l5)   4        16 p     compact
## 10 a4 quattro   2    2008     4 manual(m6) 4        20 p     compact
## # ... with 224 more rows</code></pre>
<p></p>
<p>Em contrapartida, o método 3 busca selecionar um conjunto de colunas com base em seu tipo de dado, através da função <code>where()</code> e das funções de teste lógico <code>is.*()</code> (<code>is.double</code>, <code>is.character</code>, <code>is.integer</code>, …). Como exemplo, nós podemos selecionar todas as colunas da tabela <code>billboard</code> que contém dados textuais, através do comando abaixo. Portanto, para utilizar esse método você precisa apenas se referir a função <code>is.*()</code> que corresponde ao tipo de dado no qual você está interessado, dentro da função <code>where()</code>.</p>
<p></p>
<div class="sourceCode" id="cb580"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb580-1"><a href="#cb580-1" aria-hidden="true" tabindex="-1"></a>billboard <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">where</span>(is.character))</span></code></pre></div>
<pre><code>## # A tibble: 317 x 2
##    artist         track                  
##    &lt;chr&gt;          &lt;chr&gt;                  
##  1 2 Pac          Baby Don&#39;t Cry (Keep...
##  2 2Ge+her        The Hardest Part Of ...
##  3 3 Doors Down   Kryptonite             
##  4 3 Doors Down   Loser                  
##  5 504 Boyz       Wobble Wobble          
##  6 98^0           Give Me Just One Nig...
##  7 A*Teens        Dancing Queen          
##  8 Aaliyah        I Don&#39;t Wanna          
##  9 Aaliyah        Try Again              
## 10 Adams, Yolanda Open My Heart          
## # ... with 307 more rows</code></pre>
<p></p>
<p>Com isso, você possui não apenas uma boa variedade de métodos disponíveis na função <code>select()</code>, mas você também é capaz de misturá-los livremente dentro da função. Ou seja, se for de meu desejo, eu posso utilizar os métodos 2, 4 e 5 ao mesmo tempo, como no exemplo abaixo. Tratando especificamente do método 2, eu preciso fornecer dentro da função <code>all_of()</code>, um vetor contendo os nomes das colunas desejadas. Como exemplo, eu posso novamente extrair as colunas <code>artist</code>, <code>track</code> e <code>wk5</code> através desse método. O método 2, em particular, se torna um método interessante quando ainda não conhecemos o conjunto de colunas a serem extraídas. Talvez você precise aplicar previamente diversos testes sobre o seu <code>data.frame</code>, para identificar essas colunas. Logo, um vetor contendo os nomes das colunas desejadas seria o resultado ideal para tais testes.</p>
<p></p>
<div class="sourceCode" id="cb582"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb582-1"><a href="#cb582-1" aria-hidden="true" tabindex="-1"></a>vec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;artist&quot;</span>, <span class="st">&quot;track&quot;</span>, <span class="st">&quot;wk5&quot;</span>)</span>
<span id="cb582-2"><a href="#cb582-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb582-3"><a href="#cb582-3" aria-hidden="true" tabindex="-1"></a>billboard <span class="sc">%&gt;%</span> <span class="fu">select</span>(</span>
<span id="cb582-4"><a href="#cb582-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">all_of</span>(vec),  <span class="do">## Método 2</span></span>
<span id="cb582-5"><a href="#cb582-5" aria-hidden="true" tabindex="-1"></a>  <span class="dv">3</span><span class="sc">:</span><span class="dv">5</span>,  <span class="do">## Método 5</span></span>
<span id="cb582-6"><a href="#cb582-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">matches</span>(<span class="st">&quot;wk[0-9]{2}&quot;</span>)  <span class="do">## Método 4</span></span>
<span id="cb582-7"><a href="#cb582-7" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## # A tibble: 317 x 73
##    artist   track      wk5 date.entered   wk1   wk2  wk10  wk11  wk12  wk13
##    &lt;chr&gt;    &lt;chr&gt;    &lt;dbl&gt; &lt;date&gt;       &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 2 Pac    Baby Do~    87 2000-02-26      87    82    NA    NA    NA    NA
##  2 2Ge+her  The Har~    NA 2000-09-02      91    87    NA    NA    NA    NA
##  3 3 Doors~ Krypton~    66 2000-04-08      81    70    51    51    51    47
##  4 3 Doors~ Loser       67 2000-10-21      76    76    61    61    59    61
##  5 504 Boyz Wobble ~    17 2000-04-15      57    34    57    64    70    75
##  6 98^0     Give Me~    26 2000-08-19      51    39     6     7    22    29
##  7 A*Teens  Dancing~   100 2000-07-08      97    97    NA    NA    NA    NA
##  8 Aaliyah  I Don&#39;t~    38 2000-01-29      84    62    36    37    37    38
##  9 Aaliyah  Try Aga~    21 2000-03-18      59    53    10     9     8     6
## 10 Adams, ~ Open My~    68 2000-08-26      76    76    59    66    68    61
## # ... with 307 more rows, and 63 more variables: wk14 &lt;dbl&gt;, wk15 &lt;dbl&gt;,
## #   wk16 &lt;dbl&gt;, wk17 &lt;dbl&gt;, wk18 &lt;dbl&gt;, wk19 &lt;dbl&gt;, wk20 &lt;dbl&gt;,
## #   wk21 &lt;dbl&gt;, wk22 &lt;dbl&gt;, wk23 &lt;dbl&gt;, wk24 &lt;dbl&gt;, wk25 &lt;dbl&gt;,
## #   wk26 &lt;dbl&gt;, wk27 &lt;dbl&gt;, wk28 &lt;dbl&gt;, wk29 &lt;dbl&gt;, wk30 &lt;dbl&gt;,
## #   wk31 &lt;dbl&gt;, wk32 &lt;dbl&gt;, wk33 &lt;dbl&gt;, wk34 &lt;dbl&gt;, wk35 &lt;dbl&gt;,
## #   wk36 &lt;dbl&gt;, wk37 &lt;dbl&gt;, wk38 &lt;dbl&gt;, wk39 &lt;dbl&gt;, wk40 &lt;dbl&gt;,
## #   wk41 &lt;dbl&gt;, wk42 &lt;dbl&gt;, wk43 &lt;dbl&gt;, wk44 &lt;dbl&gt;, wk45 &lt;dbl&gt;, ...</code></pre>
<p></p>
</div>
<div id="filtrando-linhas-com-filter" class="section level2" number="5.5">
<h2 number="5.5"><span class="header-section-number">5.5</span> Filtrando linhas com <code>filter()</code></h2>
<p>Você também já possui conhecimento para realizar essa operação através da função de <em>subsetting</em> (<code>[</code>). Porém, novamente o pacote <code>dplyr</code> nos oferece uma alternativa mais intuitiva. A função <code>filter()</code> busca filtrar linhas de uma tabela de acordo com uma condição lógica que nós devemos definir. Ou seja, os operadores lógicos são primordiais para essa função. Por isso, temos abaixo na tabela 4.1, um resumo de cada um deles.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/tab_operadores.png" alt="Lista de operadores lógicos" width="80%" />
<p class="caption">
(#fig:unnamed-chunk-285)Lista de operadores lógicos
</p>
</div>
<p></p>
<p>Portanto, ao utilizar a função <code>filter()</code> você deve construir uma condição lógica que seja capaz de identificar as linhas que você deseja filtrar. Como exemplo inicial, nós podemos retornar à tabela <code>mpg</code>, que contém dados de consumo de diversos modelos de carro. Por exemplo, nós podemos filtrar todas as linhas que dizem respeito a modelos da Toyota, através do comando abaixo. Como um paralelo, temos mais abaixo a mesma operação segundo a função de <em>subsetting</em>.</p>
<p></p>
<div class="sourceCode" id="cb584"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb584-1"><a href="#cb584-1" aria-hidden="true" tabindex="-1"></a>mpg <span class="sc">%&gt;%</span> <span class="fu">filter</span>(manufacturer <span class="sc">==</span> <span class="st">&quot;toyota&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 34 x 11
##    manufacturer model displ  year   cyl trans drv     cty   hwy fl    class
##    &lt;chr&gt;        &lt;chr&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt;
##  1 toyota       4run~   2.7  1999     4 manu~ 4        15    20 r     suv  
##  2 toyota       4run~   2.7  1999     4 auto~ 4        16    20 r     suv  
##  3 toyota       4run~   3.4  1999     6 auto~ 4        15    19 r     suv  
##  4 toyota       4run~   3.4  1999     6 manu~ 4        15    17 r     suv  
##  5 toyota       4run~   4    2008     6 auto~ 4        16    20 r     suv  
##  6 toyota       4run~   4.7  2008     8 auto~ 4        14    17 r     suv  
##  7 toyota       camry   2.2  1999     4 manu~ f        21    29 r     mids~
##  8 toyota       camry   2.2  1999     4 auto~ f        21    27 r     mids~
##  9 toyota       camry   2.4  2008     4 manu~ f        21    31 r     mids~
## 10 toyota       camry   2.4  2008     4 auto~ f        21    31 r     mids~
## # ... with 24 more rows</code></pre>
<p></p>
<p></p>
<div class="sourceCode" id="cb586"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb586-1"><a href="#cb586-1" aria-hidden="true" tabindex="-1"></a><span class="do">## -------------------------------------</span></span>
<span id="cb586-2"><a href="#cb586-2" aria-hidden="true" tabindex="-1"></a><span class="do">## A mesma operação por subsetting:</span></span>
<span id="cb586-3"><a href="#cb586-3" aria-hidden="true" tabindex="-1"></a><span class="do">##</span></span>
<span id="cb586-4"><a href="#cb586-4" aria-hidden="true" tabindex="-1"></a>clog <span class="ot">&lt;-</span> mpg<span class="sc">$</span>manufacturer <span class="sc">==</span> <span class="st">&quot;toyota&quot;</span></span>
<span id="cb586-5"><a href="#cb586-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb586-6"><a href="#cb586-6" aria-hidden="true" tabindex="-1"></a>mpg[clog, ]</span></code></pre></div>
<p></p>
<p>Múltiplas condições lógicas podem ser construídas dentro da função <code>filter()</code>. Por exemplo, podemos ser um pouco mais específicos e selecionarmos apenas os modelos da Toyota que possuem um motor de 4 cilindradas com o comando abaixo. Repare abaixo, que ao acrescentarmos novas condições na função <code>filter()</code>, elas acabam se tornando dependentes. Ou seja, ambas as condições devem ser atendidas ao mesmo tempo em cada linha retornada pela função <code>filter()</code>.</p>
<p></p>
<div class="sourceCode" id="cb587"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb587-1"><a href="#cb587-1" aria-hidden="true" tabindex="-1"></a>mpg <span class="sc">%&gt;%</span> <span class="fu">filter</span>(manufacturer <span class="sc">==</span> <span class="st">&quot;toyota&quot;</span>, cyl <span class="sc">==</span> <span class="dv">4</span>)</span></code></pre></div>
<pre><code>## # A tibble: 18 x 11
##    manufacturer model displ  year   cyl trans drv     cty   hwy fl    class
##    &lt;chr&gt;        &lt;chr&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt;
##  1 toyota       4run~   2.7  1999     4 manu~ 4        15    20 r     suv  
##  2 toyota       4run~   2.7  1999     4 auto~ 4        16    20 r     suv  
##  3 toyota       camry   2.2  1999     4 manu~ f        21    29 r     mids~
##  4 toyota       camry   2.2  1999     4 auto~ f        21    27 r     mids~
##  5 toyota       camry   2.4  2008     4 manu~ f        21    31 r     mids~
##  6 toyota       camry   2.4  2008     4 auto~ f        21    31 r     mids~
##  7 toyota       camr~   2.2  1999     4 auto~ f        21    27 r     comp~
##  8 toyota       camr~   2.2  1999     4 manu~ f        21    29 r     comp~
##  9 toyota       camr~   2.4  2008     4 manu~ f        21    31 r     comp~
## 10 toyota       camr~   2.4  2008     4 auto~ f        22    31 r     comp~
## 11 toyota       coro~   1.8  1999     4 auto~ f        24    30 r     comp~
## 12 toyota       coro~   1.8  1999     4 auto~ f        24    33 r     comp~
## 13 toyota       coro~   1.8  1999     4 manu~ f        26    35 r     comp~
## 14 toyota       coro~   1.8  2008     4 manu~ f        28    37 r     comp~
## 15 toyota       coro~   1.8  2008     4 auto~ f        26    35 r     comp~
## 16 toyota       toyo~   2.7  1999     4 manu~ 4        15    20 r     pick~
## 17 toyota       toyo~   2.7  1999     4 auto~ 4        16    20 r     pick~
## 18 toyota       toyo~   2.7  2008     4 manu~ 4        17    22 r     pick~</code></pre>
<p></p>
<p></p>
<div class="sourceCode" id="cb589"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb589-1"><a href="#cb589-1" aria-hidden="true" tabindex="-1"></a><span class="do">## -------------------------------------</span></span>
<span id="cb589-2"><a href="#cb589-2" aria-hidden="true" tabindex="-1"></a><span class="do">## A mesma operação por subsetting:</span></span>
<span id="cb589-3"><a href="#cb589-3" aria-hidden="true" tabindex="-1"></a><span class="do">##</span></span>
<span id="cb589-4"><a href="#cb589-4" aria-hidden="true" tabindex="-1"></a>clog <span class="ot">&lt;-</span> mpg<span class="sc">$</span>manufacturer <span class="sc">==</span> <span class="st">&quot;toyota&quot;</span> <span class="sc">&amp;</span> mpg<span class="sc">$</span>cyl <span class="sc">==</span> <span class="dv">4</span></span>
<span id="cb589-5"><a href="#cb589-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb589-6"><a href="#cb589-6" aria-hidden="true" tabindex="-1"></a>mpg[clog, ]</span></code></pre></div>
<p></p>
<p>Nós tradicionalmente estabelecemos relações de dependência entre condições lógicas, por meio do operador <code>&amp;</code>. Mas a função <code>filter()</code> busca ser prática e, por isso, ela automaticamente realiza esse trabalho por nós. Porém, isso implica que se as suas condições forem independentes, ajustes precisam ser feitos, através do operador <code>|</code>.</p>
<p>Visto esse ponto, você pode estar interessado em filtrar a sua tabela, de acordo com um conjunto de valores. Por exemplo, ao invés de selecionar apenas os modelos pertencentes à Toyota, podemos selecionar um conjunto maior de marcas. Em ocasiões como essa, o operador <code>%in%</code> se torna útil, pois você está pesquisando se o valor presente em cada linha de sua tabela, pertence ou não a um dado conjunto de valores.</p>
<p></p>
<div class="sourceCode" id="cb590"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb590-1"><a href="#cb590-1" aria-hidden="true" tabindex="-1"></a>marcas <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;volkswagen&quot;</span>, <span class="st">&quot;audi&quot;</span>, <span class="st">&quot;toyota&quot;</span>, <span class="st">&quot;honda&quot;</span>)</span>
<span id="cb590-2"><a href="#cb590-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb590-3"><a href="#cb590-3" aria-hidden="true" tabindex="-1"></a>mpg <span class="sc">%&gt;%</span> </span>
<span id="cb590-4"><a href="#cb590-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(manufacturer <span class="sc">%in%</span> marcas)</span></code></pre></div>
<pre><code>## # A tibble: 88 x 11
##    manufacturer model displ  year   cyl trans drv     cty   hwy fl    class
##    &lt;chr&gt;        &lt;chr&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt;
##  1 audi         a4      1.8  1999     4 auto~ f        18    29 p     comp~
##  2 audi         a4      1.8  1999     4 manu~ f        21    29 p     comp~
##  3 audi         a4      2    2008     4 manu~ f        20    31 p     comp~
##  4 audi         a4      2    2008     4 auto~ f        21    30 p     comp~
##  5 audi         a4      2.8  1999     6 auto~ f        16    26 p     comp~
##  6 audi         a4      2.8  1999     6 manu~ f        18    26 p     comp~
##  7 audi         a4      3.1  2008     6 auto~ f        18    27 p     comp~
##  8 audi         a4 q~   1.8  1999     4 manu~ 4        18    26 p     comp~
##  9 audi         a4 q~   1.8  1999     4 auto~ 4        16    25 p     comp~
## 10 audi         a4 q~   2    2008     4 manu~ 4        20    28 p     comp~
## # ... with 78 more rows</code></pre>
<p></p>
<p></p>
<div class="sourceCode" id="cb592"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb592-1"><a href="#cb592-1" aria-hidden="true" tabindex="-1"></a><span class="do">## -------------------------------------</span></span>
<span id="cb592-2"><a href="#cb592-2" aria-hidden="true" tabindex="-1"></a><span class="do">## A mesma operação por subsetting:</span></span>
<span id="cb592-3"><a href="#cb592-3" aria-hidden="true" tabindex="-1"></a><span class="do">##</span></span>
<span id="cb592-4"><a href="#cb592-4" aria-hidden="true" tabindex="-1"></a>marcas <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;volkswagen&quot;</span>, <span class="st">&quot;audi&quot;</span>, <span class="st">&quot;toyota&quot;</span>, <span class="st">&quot;honda&quot;</span>)</span>
<span id="cb592-5"><a href="#cb592-5" aria-hidden="true" tabindex="-1"></a>clog <span class="ot">&lt;-</span> mpg<span class="sc">$</span>manufacturer <span class="sc">%in%</span> marcas</span>
<span id="cb592-6"><a href="#cb592-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb592-7"><a href="#cb592-7" aria-hidden="true" tabindex="-1"></a>mpg[clog, ]</span></code></pre></div>
<p></p>
<div id="cuidados-com-o-operador-de-igualdade" class="section level3" number="5.5.1">
<h3 number="5.5.1"><span class="header-section-number">5.5.1</span> Cuidados com o operador de igualdade</h3>
<p>Quando você estiver filtrando as linhas de sua tabela de acordo com uma condição de igualdade, é importante que você tome alguns cuidados, especialmente se valores textuais estiverem envolvidos nessa condição. O primeiro ponto a ser abordado é o uso do operador <code>==</code>, que para além de igualdade, ele busca encontrar valores <strong>exatamente</strong> iguais.</p>
<p>O “exatamente” é importante aqui, pois certos valores numéricos podem ser aparentemente idênticos aos nossos olhos, mas ainda assim, diferentes segundo a visão de <code>==</code>. Isso ocorre especialmente com valores numéricos do tipo <code>double</code>. Pois os nossos computadores utilizam precisão aritmética finita para guardar esse tipo de valor <span class="citation">(<a href="#ref-wickham2017" role="doc-biblioref">Wickham and Grolemund 2017</a>, p 47)</span>. Isso significa que os nossos computadores guardam apenas as casas decimais significantes de um valor <code>double</code>, e a perda de casas decimais que ocorre nesse processo, pode ser a fonte de alguma diferença em operações aritméticas. Por exemplo, se testarmos a igualdade entre <span class="math inline">\((\sqrt{2})^2 = 2\)</span>, o R vai nos indicar alguma diferença existente entre esses dois valores.</p>
<p></p>
<div class="sourceCode" id="cb593"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb593-1"><a href="#cb593-1" aria-hidden="true" tabindex="-1"></a>(<span class="fu">sqrt</span>(<span class="dv">2</span>)<span class="sc">^</span><span class="dv">2</span>) <span class="sc">==</span> <span class="dv">2</span></span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<p></p>
<p>Por essa razão, quando você estiver testando a igualdade entre valores do tipo <code>double</code>, é interessante que você utilize a função <code>near()</code> ao invés do operador <code>==</code>. Por padrão, a função <code>near()</code> possui uma tolerância próxima de <span class="math inline">\(1,49 \times 10^{-8}\)</span>, mas você pode ajustar esse valor pelo argumento <code>tol</code> da função.</p>
<p></p>
<div class="sourceCode" id="cb595"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb595-1"><a href="#cb595-1" aria-hidden="true" tabindex="-1"></a><span class="fu">near</span>(<span class="fu">sqrt</span>(<span class="dv">2</span>)<span class="sc">^</span><span class="dv">2</span>, <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p></p>
<p>Para mais, você também deve estar atento ao uso do operador <code>==</code>, quando estiver testando a igualdade entre palavras, ou valores textuais. Pois uma palavra pode ser escrita de múltiplas maneiras sem que ela perca o seu sentido, e a mínima diferença presente nos caracteres utilizados pode torná-las valores completamente diferentes aos olhos do operador <code>==</code>. Logo, os valores <code>"Isabela"</code> e <code>"isabela"</code> são diferentes na visão de <code>==</code>, mesmo que na prática, esses valores muito provavelmente se referem ao mesmo indivíduo.</p>
<p></p>
<div class="sourceCode" id="cb597"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb597-1"><a href="#cb597-1" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;Isabela&quot;</span> <span class="sc">==</span> <span class="st">&quot;isabela&quot;</span></span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<p></p>
<p>Se você possui em sua coluna, uma variedade maior de valores textuais, que são diferentes, mas que dizem respeito ao mesmo indivíduo (por exemplo, você possui seis variedades de “Isabela”: <code>Isabela</code>; <code>ISABELA</code>; <code>IsAbElA</code>; <code>Ísabela</code>; <code>ísabela</code>; <code>i\@abela</code>), você muito provavelmente necessita de uma expressão regular. Para acessar esse mecanismo e utilizá-lo dentro da função <code>filter()</code>, você precisa de uma função que utilize essa funcionalidade para pesquisar os textos que se encaixam em sua expressão, e que retorne como resultado, um vetor de valores lógicos que indicam as linhas de sua tabela em que esses textos ocorrem. Sendo os principais indivíduos dessa categoria, a função <code>grepl()</code>, e a função <code>str_detect()</code> que pertence ao pacote <code>stringr</code>.</p>
<p>Por outro lado, pode ser que você não precise ir tão longe, caso as diferenças presentes em seus textos se apresentem na forma de capitalização das letras (maiúsculo ou minúsculo). Por exemplo, suponha que a sua variedade de “Isabela” fosse: <code>Isabela</code>; <code>ISABELA</code>; <code>IsAbElA</code> e <code>isabela</code>. Para tornar esses valores iguais, você precisaria apenas de um método de pesquisa que seja capaz de ignorar a capitalização das letras. Para isso, você pode utilizar a função <code>grepl()</code> que possui o argumento <code>ignore.case</code>, no qual você pode pedir a função que ignore essas diferenças na capitalização, como no exemplo abaixo.</p>
<p></p>
<div class="sourceCode" id="cb599"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb599-1"><a href="#cb599-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2</span>)</span>
<span id="cb599-2"><a href="#cb599-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb599-3"><a href="#cb599-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">usuario =</span> <span class="fu">c</span>(<span class="st">&quot;Ana&quot;</span>, <span class="st">&quot;Isabela&quot;</span>, <span class="st">&quot;isabela&quot;</span>, <span class="st">&quot;Julia&quot;</span>),</span>
<span id="cb599-4"><a href="#cb599-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">id =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>,</span>
<span id="cb599-5"><a href="#cb599-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">valor =</span> <span class="fu">round</span>(<span class="fu">rnorm</span>(<span class="dv">4</span>), <span class="dv">2</span>)</span>
<span id="cb599-6"><a href="#cb599-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb599-7"><a href="#cb599-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb599-8"><a href="#cb599-8" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> </span>
<span id="cb599-9"><a href="#cb599-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">&quot;Isabela&quot;</span>, usuario, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
<pre><code>##   usuario id valor
## 1 Isabela  2  0.18
## 2 isabela  3  1.59</code></pre>
<p></p>
</div>
<div id="estabelecendo-intervalos-com-a-função-between" class="section level3" number="5.5.2">
<h3 number="5.5.2"><span class="header-section-number">5.5.2</span> Estabelecendo intervalos com a função <code>between()</code></h3>
<p>Para estabelecermos uma condição de intervalo no R, precisamos de duas condições lógicas que definam os limites deste intervalo. Em seguida, nós devemos tornar essas duas condições dependentes. Por exemplo, se desejássemos filtrar todas as linhas de <code>mpg</code> que possuem um valor na coluna <code>hwy</code> entre 18 e 24, precisaríamos do seguinte teste lógico:</p>
<p></p>
<div class="sourceCode" id="cb601"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb601-1"><a href="#cb601-1" aria-hidden="true" tabindex="-1"></a>mpg <span class="sc">%&gt;%</span> </span>
<span id="cb601-2"><a href="#cb601-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(hwy <span class="sc">&gt;=</span> <span class="dv">18</span>, hwy <span class="sc">&lt;=</span> <span class="dv">24</span>)</span>
<span id="cb601-3"><a href="#cb601-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb601-4"><a href="#cb601-4" aria-hidden="true" tabindex="-1"></a><span class="do">## -------------------------------------</span></span>
<span id="cb601-5"><a href="#cb601-5" aria-hidden="true" tabindex="-1"></a><span class="do">## A mesma operação por subsetting:</span></span>
<span id="cb601-6"><a href="#cb601-6" aria-hidden="true" tabindex="-1"></a><span class="do">##</span></span>
<span id="cb601-7"><a href="#cb601-7" aria-hidden="true" tabindex="-1"></a>clog <span class="ot">&lt;-</span> mpg<span class="sc">$</span>hwy <span class="sc">&gt;=</span> <span class="dv">18</span> <span class="sc">&amp;</span> mpg<span class="sc">$</span>hwy <span class="sc">&lt;=</span> <span class="dv">24</span></span>
<span id="cb601-8"><a href="#cb601-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb601-9"><a href="#cb601-9" aria-hidden="true" tabindex="-1"></a>mpg[clog, ]</span></code></pre></div>
<p></p>
<p>Porém, de uma maneira mais prática, podemos utilizar a função <code>between()</code> que consiste em um atalho para essa metodologia. A função possui três argumentos: 1) <code>x</code>, a coluna ou o vetor sobre o qual você deseja aplicar o teste de intervalo; 2) <code>left</code>, o limite “inferior” (ou “esquerdo”) do intervalo; 3) <code>right</code>, o limite “superior” (ou “direito”) do intervalo. Logo, se fôssemos traduzir o teste de intervalo anterior para a função <code>between()</code>, faríamos da seguinte maneira:</p>
<p></p>
<div class="sourceCode" id="cb602"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb602-1"><a href="#cb602-1" aria-hidden="true" tabindex="-1"></a>mpg <span class="sc">%&gt;%</span> </span>
<span id="cb602-2"><a href="#cb602-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">between</span>(hwy, <span class="dv">18</span>, <span class="dv">24</span>))</span></code></pre></div>
<pre><code>## # A tibble: 63 x 11
##    manufacturer model displ  year   cyl trans drv     cty   hwy fl    class
##    &lt;chr&gt;        &lt;chr&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt;
##  1 audi         a6 q~   2.8  1999     6 auto~ 4        15    24 p     mids~
##  2 audi         a6 q~   4.2  2008     8 auto~ 4        16    23 p     mids~
##  3 chevrolet    c150~   5.3  2008     8 auto~ r        14    20 r     suv  
##  4 chevrolet    c150~   5.3  2008     8 auto~ r        14    20 r     suv  
##  5 chevrolet    corv~   5.7  1999     8 auto~ r        15    23 p     2sea~
##  6 chevrolet    corv~   7    2008     8 manu~ r        15    24 p     2sea~
##  7 chevrolet    k150~   5.3  2008     8 auto~ 4        14    19 r     suv  
##  8 dodge        cara~   2.4  1999     4 auto~ f        18    24 r     mini~
##  9 dodge        cara~   3    1999     6 auto~ f        17    24 r     mini~
## 10 dodge        cara~   3.3  1999     6 auto~ f        16    22 r     mini~
## # ... with 53 more rows</code></pre>
<p></p>
</div>
<div id="sec:ataque_terrorista" class="section level3" number="5.5.3">
<h3 number="5.5.3"><span class="header-section-number">5.5.3</span> Ataque terrorista</h3>
<p>Vamos dar um pouco de contexto para as nossas operações. Nessa seção, vamos utilizar os dados disponíveis na tabela <code>transf</code>, que podem ser importados para o seu R através dos comandos abaixo. A tabela <code>transf</code> contém informações sobre diversas transferências bancárias realizadas por uma instituição bancária. Algumas informações presentes nessa tabela incluem: a data e o horário da transferência (<code>Data</code>); O <em>username</em> do usuário do banco responsável por realizar a transferência (<code>Usuario</code>); o país de destino da transferência (<code>Pais</code>); um código de identificação da transferência (<code>TransferID</code>); e o valor transferido (<code>Valor</code>).</p>
<p></p>
<div class="sourceCode" id="cb604"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb604-1"><a href="#cb604-1" aria-hidden="true" tabindex="-1"></a>github <span class="ot">&lt;-</span> <span class="st">&quot;https://raw.githubusercontent.com/pedropark99/&quot;</span></span>
<span id="cb604-2"><a href="#cb604-2" aria-hidden="true" tabindex="-1"></a>pasta <span class="ot">&lt;-</span> <span class="st">&quot;Curso-R/master/Dados/&quot;</span></span>
<span id="cb604-3"><a href="#cb604-3" aria-hidden="true" tabindex="-1"></a>arquivo <span class="ot">&lt;-</span> <span class="st">&quot;transf_reform.csv&quot;</span></span>
<span id="cb604-4"><a href="#cb604-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb604-5"><a href="#cb604-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb604-6"><a href="#cb604-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb604-7"><a href="#cb604-7" aria-hidden="true" tabindex="-1"></a>transf <span class="ot">&lt;-</span> <span class="fu">read_csv2</span>(<span class="fu">paste0</span>(github, pasta, arquivo))</span></code></pre></div>
<p></p>
<p></p>
<div class="sourceCode" id="cb605"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb605-1"><a href="#cb605-1" aria-hidden="true" tabindex="-1"></a>transf</span></code></pre></div>
<pre><code>## # A tibble: 20,006 x 6
##    Data                Usuario   Valor TransferID Pais     Descricao
##    &lt;dttm&gt;              &lt;chr&gt;     &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;    &lt;lgl&gt;    
##  1 2018-12-06 22:19:19 Eduardo    599.  116241629 Alemanha NA       
##  2 2018-12-06 22:10:34 Júlio     4611.  115586504 Alemanha NA       
##  3 2018-12-06 21:59:50 Nathália  4418.  115079280 Alemanha NA       
##  4 2018-12-06 21:54:13 Júlio     2740.  114972398 Alemanha NA       
##  5 2018-12-06 21:41:27 Ana       1408.  116262934 Alemanha NA       
##  6 2018-12-06 21:18:40 Nathália  5052.  115710402 Alemanha NA       
##  7 2018-12-06 20:54:32 Eduardo   5665.  114830203 Alemanha NA       
##  8 2018-12-06 20:15:46 Sandra    1474.  116323455 Alemanha NA       
##  9 2018-12-06 20:04:35 Armando   8906.  115304382 Alemanha NA       
## 10 2018-12-22 20:00:56 Armando  18521.  114513684 Alemanha NA       
## # ... with 19,996 more rows</code></pre>
<p></p>
<p>Vamos supor que no dia 24 de dezembro de 2018, tenha ocorrido um ataque terrorista na cidade de Berlim (Alemanha). Suponha também, que você faz parte do setor de <em>compliance</em> da instituição financeira responsável pelas transferências descritas na tabela <code>transf</code>. Em geral, um dos principais papéis de um setor de <em>compliance</em> é garantir que a sua instituição não esteja contribuindo com práticas ilícitas (dentre elas está o terrorismo).</p>
<p>Segundo o relatório da polícia, há fortes indícios de que a munição utilizada no ato, foi comprada durante os dias 20 e 23. Além disso, a polícia também destacou que levando em conta a quantidade utilizada no ataque, somente a munição empregada custou em média mais de $15.000.</p>
<p>Logo, o seu papel seria se certificar de que a instituição a qual você pertence, não realizou alguma transferência que se encaixa nessas características. Pois caso tal transferência exista, vocês teriam de abrir uma investigação em conjunto com a polícia, para apurar as fontes e os destinatários dos recursos dessa transferência.</p>
<p>Portanto, estamos procurando por uma transferência na tabela <code>transf</code> de valor acima de $15.000, que possua a Alemanha como país de destino, e que tenha ocorrido durante os dias 20 e 23 de dezembro de 2018. Perceba que todas essas condições, ou características da transferência devem ser atendidas ao mesmo tempo. Ou seja, essas condições lógicas são dependentes uma da outra.</p>
<p>Lembre-se que quando temos diversas condições lógicas dependentes, nós podemos separá-las por vírgulas na função <code>filter()</code>. Por outro lado, fora do uso da função <code>filter()</code>, nós estabelecemos uma relação de dependência entre várias condições lógicas por meio do operador <code>&amp;</code>, e será esse o método tradicional utilizado nessa seção. Logo, quando temos diversas condições no R que devem ser atendidas ao mesmo tempo, nós devemos conectar cada uma dessas condições pelo operador <code>&amp;</code>, como no exemplo abaixo.</p>
<p></p>
<div class="sourceCode" id="cb607"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb607-1"><a href="#cb607-1" aria-hidden="true" tabindex="-1"></a>transf <span class="sc">%&gt;%</span> </span>
<span id="cb607-2"><a href="#cb607-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb607-3"><a href="#cb607-3" aria-hidden="true" tabindex="-1"></a>    Valor <span class="sc">&gt;</span> <span class="dv">15000</span> <span class="sc">&amp;</span> Pais <span class="sc">==</span> <span class="st">&quot;Alemanha&quot;</span> <span class="sc">&amp;</span></span>
<span id="cb607-4"><a href="#cb607-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">between</span>(<span class="fu">as.Date</span>(Data), <span class="fu">as.Date</span>(<span class="st">&quot;2018-12-20&quot;</span>), <span class="fu">as.Date</span>(<span class="st">&quot;2018-12-23&quot;</span>))</span>
<span id="cb607-5"><a href="#cb607-5" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 132 x 6
##    Data                Usuario      Valor TransferID Pais     Descricao
##    &lt;dttm&gt;              &lt;chr&gt;        &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;    &lt;lgl&gt;    
##  1 2018-12-22 20:00:56 Armando     18521.  114513684 Alemanha NA       
##  2 2018-12-21 18:46:59 Júlio Cesar 16226.  116279014 Alemanha NA       
##  3 2018-12-21 17:41:48 Nathália    17583.  115748273 Alemanha NA       
##  4 2018-12-23 09:46:23 Júlio       15396.  115272184 Alemanha NA       
##  5 2018-12-21 06:38:20 Júlio Cesar 17555.  114983226 Alemanha NA       
##  6 2018-12-23 18:11:27 Eduardo     17219.  115904797 Alemanha NA       
##  7 2018-12-22 13:09:13 Eduardo     16255.  114520578 Alemanha NA       
##  8 2018-12-23 10:59:50 Júlio Cesar 15093.  115919119 Alemanha NA       
##  9 2018-12-23 10:29:34 Sandra      19241.  114665132 Alemanha NA       
## 10 2018-12-21 06:04:49 Júlio Cesar 18938.  116281869 Alemanha NA       
## # ... with 122 more rows</code></pre>
<p></p>
<p></p>
<div class="sourceCode" id="cb609"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb609-1"><a href="#cb609-1" aria-hidden="true" tabindex="-1"></a><span class="do">## -------------------------------------</span></span>
<span id="cb609-2"><a href="#cb609-2" aria-hidden="true" tabindex="-1"></a><span class="do">## A mesma operação por subsetting:</span></span>
<span id="cb609-3"><a href="#cb609-3" aria-hidden="true" tabindex="-1"></a><span class="do">##</span></span>
<span id="cb609-4"><a href="#cb609-4" aria-hidden="true" tabindex="-1"></a>clog <span class="ot">&lt;-</span> transf<span class="sc">$</span>Valor <span class="sc">&gt;</span> <span class="dv">15000</span> <span class="sc">&amp;</span> transf<span class="sc">$</span>Pais <span class="sc">==</span> <span class="st">&quot;Alemanha&quot;</span> <span class="sc">&amp;</span></span>
<span id="cb609-5"><a href="#cb609-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">between</span>(<span class="fu">as.Date</span>(transf<span class="sc">$</span>Data), <span class="fu">as.Date</span>(<span class="st">&quot;2018-12-20&quot;</span>), <span class="fu">as.Date</span>(<span class="st">&quot;2018-12-23&quot;</span>))</span>
<span id="cb609-6"><a href="#cb609-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb609-7"><a href="#cb609-7" aria-hidden="true" tabindex="-1"></a>transf[clog, ]</span></code></pre></div>
<p></p>
<p>No total, 132 linhas foram retornadas pela função, e você teria de conferir cada uma dessas transferências. Um baita trabalho! Porém, vamos supor que em um minuto de reflexão sobre as regras do banco, você se lembre que o remetente da transferência não é obrigado a apresentar uma prova de fundos ou um comprovante de endereço, caso a transferência possua um valor menor do que $200. Em casos como esse, o remetente precisa apresentar apenas a identidade (que ele pode ter falsificado).</p>
<p></p>
<div class="sourceCode" id="cb610"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb610-1"><a href="#cb610-1" aria-hidden="true" tabindex="-1"></a>transf <span class="sc">%&gt;%</span></span>
<span id="cb610-2"><a href="#cb610-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb610-3"><a href="#cb610-3" aria-hidden="true" tabindex="-1"></a>    Valor <span class="sc">&lt;=</span> <span class="dv">200</span> <span class="sc">&amp;</span> Pais <span class="sc">==</span> <span class="st">&quot;Alemanha&quot;</span> <span class="sc">&amp;</span></span>
<span id="cb610-4"><a href="#cb610-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">between</span>(<span class="fu">as.Date</span>(Data), <span class="fu">as.Date</span>(<span class="st">&quot;2018‐12‐20&quot;</span>), <span class="fu">as.Date</span>(<span class="st">&quot;2018‐12‐23&quot;</span>))</span>
<span id="cb610-5"><a href="#cb610-5" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 5 x 6
##   Data                Usuario Valor TransferID Pais     Descricao
##   &lt;dttm&gt;              &lt;chr&gt;   &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;    &lt;lgl&gt;    
## 1 2018-12-20 00:31:17 Júlio     193  115555598 Alemanha NA       
## 2 2018-12-22 06:30:01 Sandra    100  116400001 Alemanha NA       
## 3 2018-12-22 06:35:00 Sandra    200  116400002 Alemanha NA       
## 4 2018-12-22 06:42:12 Eduardo   200  116400005 Alemanha NA       
## 5 2018-12-22 06:55:54 Eduardo   150  116400009 Alemanha NA</code></pre>
<p></p>
<p>Isso é interessante, pois conseguimos reduzir os nossos resultados para apenas 5 transferências. Ao conferirmos as informações da primeira transferência, os recursos estão limpos. Porém, as próximas 4 transferências levantam algumas suspeitas. Pois elas foram realizadas por clientes diferentes, mas com poucos minutos de diferença. Ao conversar com os agentes Sandra e Eduardo, que autorizaram essas transferências, você descobre que todos os diferentes clientes apresentaram transferências francesas. Será que esses clientes estavam testando as regras da instituição para com identidades desse país?</p>
<p>Ao procurar por todas as transferências em que identidades francesas foram apresentadas, e que foram realizadas entre os dias 20 e 23 de dezembro de 2018, e que possuíam a Alemanha como país de destino, você chega a uma estranha transferência de $20.000 efetuada poucos minutos depois das 4 transferências que encontramos anteriormente. Durante a análise das informações dessa transferência, você percebe diversas falhas presentes na prova de fundos que sustentou a decisão de autorização dessa operação. Há uma grande possibilidade de que os chefes e agentes de sua instituição que autorizaram essa operação, estejam em maus lençóis.</p>
<p></p>
<div class="sourceCode" id="cb612"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb612-1"><a href="#cb612-1" aria-hidden="true" tabindex="-1"></a>transf <span class="sc">%&gt;%</span></span>
<span id="cb612-2"><a href="#cb612-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(</span>
<span id="cb612-3"><a href="#cb612-3" aria-hidden="true" tabindex="-1"></a>    identidade,</span>
<span id="cb612-4"><a href="#cb612-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="st">&quot;TransferID&quot;</span></span>
<span id="cb612-5"><a href="#cb612-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb612-6"><a href="#cb612-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb612-7"><a href="#cb612-7" aria-hidden="true" tabindex="-1"></a>    Pais <span class="sc">==</span> <span class="st">&quot;Alemanha&quot;</span> <span class="sc">&amp;</span> Identi_Nacion <span class="sc">==</span> <span class="st">&quot;França&quot;</span> <span class="sc">&amp;</span></span>
<span id="cb612-8"><a href="#cb612-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">between</span>(<span class="fu">as.Date</span>(Data), <span class="fu">as.Date</span>(<span class="st">&quot;2018‐12‐20&quot;</span>), <span class="fu">as.Date</span>(<span class="st">&quot;2018‐12‐23&quot;</span>))</span>
<span id="cb612-9"><a href="#cb612-9" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 5 x 7
##   Data                Usuario Valor TransferID Pais     Descricao
##   &lt;dttm&gt;              &lt;chr&gt;   &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;    &lt;lgl&gt;    
## 1 2018-12-22 06:30:01 Sandra    100  116400001 Alemanha NA       
## 2 2018-12-22 06:35:00 Sandra    200  116400002 Alemanha NA       
## 3 2018-12-22 06:42:12 Eduardo   200  116400005 Alemanha NA       
## 4 2018-12-22 06:55:54 Eduardo   150  116400009 Alemanha NA       
## 5 2018-12-22 06:59:07 Eduardo 20000  116400010 Alemanha NA       
## # ... with 1 more variable: Identi_Nacion &lt;chr&gt;</code></pre>
<p></p>
</div>
<div id="condições-dependentes-ou-independentes" class="section level3" number="5.5.4">
<h3 number="5.5.4"><span class="header-section-number">5.5.4</span> Condições dependentes (&amp;) ou independentes (|) ?</h3>
<p>Na seção anterior, as condições lógicas que guiavam o nosso filtro eram dependentes entre si. Em outras palavras, as condições deveriam ser todas atendidas ao mesmo tempo. Por essa razão, nós conectamos as condições lógicas com o operador <code>&amp;</code>. Porém, em algumas ocasiões as suas condições serão independentes e, por isso, devemos utilizar um outro operador para conectá-las, que é a barra vertical (<code>|</code>).</p>
<p>Por exemplo, se eu quiser encontrar todas as transferências na tabela <code>transf</code> que ocorreram no dia 13 de novembro de 2018, <strong>ou</strong> que possuem um valor menor que $500, <strong>ou</strong> que foram autorizadas pelo agente Eduardo, eu devo construir o comando abaixo. Logo, toda linha da tabela <code>transf</code> que atenda pelo menos uma das condições que estabelecemos, é filtrada pela função <code>filter()</code>.</p>
<p></p>
<div class="sourceCode" id="cb614"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb614-1"><a href="#cb614-1" aria-hidden="true" tabindex="-1"></a>transf <span class="sc">%&gt;%</span> </span>
<span id="cb614-2"><a href="#cb614-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb614-3"><a href="#cb614-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.Date</span>(Data) <span class="sc">==</span> <span class="fu">as.Date</span>(<span class="st">&quot;2018-11-13&quot;</span>) <span class="sc">|</span> Valor <span class="sc">&lt;</span> <span class="dv">500</span> <span class="sc">|</span></span>
<span id="cb614-4"><a href="#cb614-4" aria-hidden="true" tabindex="-1"></a>    Usuario <span class="sc">==</span> <span class="st">&quot;Eduardo&quot;</span></span>
<span id="cb614-5"><a href="#cb614-5" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 5,581 x 6
##    Data                Usuario      Valor TransferID Pais     Descricao
##    &lt;dttm&gt;              &lt;chr&gt;        &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;    &lt;lgl&gt;    
##  1 2018-12-06 22:19:19 Eduardo       599.  116241629 Alemanha NA       
##  2 2018-12-06 20:54:32 Eduardo      5665.  114830203 Alemanha NA       
##  3 2018-12-06 19:07:50 Eduardo      9561.  115917812 Alemanha NA       
##  4 2018-12-06 18:09:15 Júlio Cesar   388.  114894102 Alemanha NA       
##  5 2018-12-06 16:59:38 Eduardo     11759.  115580064 Alemanha NA       
##  6 2018-12-06 15:21:36 Eduardo      4436.  114425893 Alemanha NA       
##  7 2018-12-06 14:47:25 Ana           483.  114387526 Alemanha NA       
##  8 2018-12-06 12:59:58 Ana           207.  115615456 Alemanha NA       
##  9 2018-12-06 10:05:21 Eduardo       708.  114746955 Alemanha NA       
## 10 2018-12-06 09:50:03 Eduardo      1587.  114796170 Alemanha NA       
## # ... with 5,571 more rows</code></pre>
<p></p>
<p></p>
<div class="sourceCode" id="cb616"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb616-1"><a href="#cb616-1" aria-hidden="true" tabindex="-1"></a><span class="do">## -------------------------------------</span></span>
<span id="cb616-2"><a href="#cb616-2" aria-hidden="true" tabindex="-1"></a><span class="do">## A mesma operação por subsetting:</span></span>
<span id="cb616-3"><a href="#cb616-3" aria-hidden="true" tabindex="-1"></a><span class="do">##</span></span>
<span id="cb616-4"><a href="#cb616-4" aria-hidden="true" tabindex="-1"></a>clog <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(transf<span class="sc">$</span>Data) <span class="sc">==</span> <span class="fu">as.Date</span>(<span class="st">&quot;2018-11-13&quot;</span>) <span class="sc">|</span> </span>
<span id="cb616-5"><a href="#cb616-5" aria-hidden="true" tabindex="-1"></a>  transf<span class="sc">$</span>Valor <span class="sc">&lt;</span> <span class="dv">500</span> <span class="sc">|</span> transf<span class="sc">$</span>Usuario <span class="sc">==</span> <span class="st">&quot;Eduardo&quot;</span></span>
<span id="cb616-6"><a href="#cb616-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb616-7"><a href="#cb616-7" aria-hidden="true" tabindex="-1"></a>transf[clog, ]</span></code></pre></div>
<p></p>
</div>
</div>
<div id="ordenando-linhas-com-arrange" class="section level2" number="5.6">
<h2 number="5.6"><span class="header-section-number">5.6</span> Ordenando linhas com <code>arrange()</code></h2>
<p>Algumas operações que realizamos dependem diretamente da forma como as linhas de nossa tabela estão ordenadas. Em outros momentos, desejamos ordenar a nossa tabela, para rapidamente identificarmos as observações que possuem os 10 maiores valores de alguma variável ao longo da base. Ou seja, a ordenação de linhas é uma operação muito comum, e o pacote <code>dplyr</code> oferece a função <code>arrange()</code> para tal ação.</p>
<p>O uso da função <code>arrange()</code> é bem simples. Tudo o que você precisa fazer é listar as colunas pelas quais você deseja ordenar a base. Caso a coluna seja numérica, <code>arrange()</code> vai seguir uma ordenação numérica. Mas se essa coluna for do tipo <code>character</code>, <code>arrange()</code> vai utilizar uma ordenação alfabética para organizar os valores da coluna. Por outro lado, na hipótese dessa coluna ser do tipo <code>factor</code>, <code>arrange()</code> vai seguir a ordem presente nos “níveis” (<code>levels</code>) desse <code>factor</code>, aos quais você pode acessar pela função <code>levels()</code>.</p>
<p></p>
<div class="sourceCode" id="cb617"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb617-1"><a href="#cb617-1" aria-hidden="true" tabindex="-1"></a>mpg <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(displ)</span></code></pre></div>
<pre><code>## # A tibble: 234 x 11
##    manufacturer model displ  year   cyl trans drv     cty   hwy fl    class
##    &lt;chr&gt;        &lt;chr&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt;
##  1 honda        civic   1.6  1999     4 manu~ f        28    33 r     subc~
##  2 honda        civic   1.6  1999     4 auto~ f        24    32 r     subc~
##  3 honda        civic   1.6  1999     4 manu~ f        25    32 r     subc~
##  4 honda        civic   1.6  1999     4 manu~ f        23    29 p     subc~
##  5 honda        civic   1.6  1999     4 auto~ f        24    32 r     subc~
##  6 audi         a4      1.8  1999     4 auto~ f        18    29 p     comp~
##  7 audi         a4      1.8  1999     4 manu~ f        21    29 p     comp~
##  8 audi         a4 q~   1.8  1999     4 manu~ 4        18    26 p     comp~
##  9 audi         a4 q~   1.8  1999     4 auto~ 4        16    25 p     comp~
## 10 honda        civic   1.8  2008     4 manu~ f        26    34 r     subc~
## # ... with 224 more rows</code></pre>
<p></p>
<p>Você pode recorrer a várias colunas para ordenar a sua base. Nessa situação, a função <code>arrange()</code> vai ordenar as colunas na ordem em que você as definiu na função. Ou seja, no exemplo abaixo, a função <code>arrange()</code> primeiro ordena a base de acordo com a coluna <code>displ</code>, em seguida, segundo a coluna <code>hwy</code>, e por último, a coluna <code>trans</code>.</p>
<p></p>
<div class="sourceCode" id="cb619"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb619-1"><a href="#cb619-1" aria-hidden="true" tabindex="-1"></a>mpg <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(displ, hwy, trans)</span></code></pre></div>
<pre><code>## # A tibble: 234 x 11
##    manufacturer model displ  year   cyl trans drv     cty   hwy fl    class
##    &lt;chr&gt;        &lt;chr&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt;
##  1 honda        civic   1.6  1999     4 manu~ f        23    29 p     subc~
##  2 honda        civic   1.6  1999     4 auto~ f        24    32 r     subc~
##  3 honda        civic   1.6  1999     4 auto~ f        24    32 r     subc~
##  4 honda        civic   1.6  1999     4 manu~ f        25    32 r     subc~
##  5 honda        civic   1.6  1999     4 manu~ f        28    33 r     subc~
##  6 audi         a4 q~   1.8  1999     4 auto~ 4        16    25 p     comp~
##  7 audi         a4 q~   1.8  1999     4 manu~ 4        18    26 p     comp~
##  8 audi         a4      1.8  1999     4 auto~ f        18    29 p     comp~
##  9 volkswagen   pass~   1.8  1999     4 auto~ f        18    29 p     mids~
## 10 audi         a4      1.8  1999     4 manu~ f        21    29 p     comp~
## # ... with 224 more rows</code></pre>
<p></p>
<p>Por padrão, a função <code>arrange()</code> utiliza uma ordenação em um sentido crescente (do menor para o maior valor; do primeiro para o último valor), qualquer que seja o tipo de dado contido na coluna que você forneceu a função. Caso você deseja utilizar uma ordenação em um sentido decrescente (do maior para o menor valor; do último para o primeiro valor) em uma dada coluna, você deve encapsular o nome dessa coluna na função <code>desc()</code>. No exemplo abaixo, <code>arrange()</code> primeiro ordena a coluna <code>manufacturer</code> em uma forma decrescente e, em seguida, ordena a coluna <code>hwy</code> de acordo com uma ordem crescente.</p>
<p></p>
<div class="sourceCode" id="cb621"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb621-1"><a href="#cb621-1" aria-hidden="true" tabindex="-1"></a>mpg <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(manufacturer), hwy)</span></code></pre></div>
<pre><code>## # A tibble: 234 x 11
##    manufacturer model displ  year   cyl trans drv     cty   hwy fl    class
##    &lt;chr&gt;        &lt;chr&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt;
##  1 volkswagen   jetta   2.8  1999     6 auto~ f        16    23 r     comp~
##  2 volkswagen   gti     2.8  1999     6 manu~ f        17    24 r     comp~
##  3 volkswagen   jetta   2.8  1999     6 manu~ f        17    24 r     comp~
##  4 volkswagen   gti     2    1999     4 auto~ f        19    26 r     comp~
##  5 volkswagen   jetta   2    1999     4 auto~ f        19    26 r     comp~
##  6 volkswagen   new ~   2    1999     4 auto~ f        19    26 r     subc~
##  7 volkswagen   pass~   2.8  1999     6 auto~ f        16    26 p     mids~
##  8 volkswagen   pass~   2.8  1999     6 manu~ f        18    26 p     mids~
##  9 volkswagen   pass~   3.6  2008     6 auto~ f        17    26 p     mids~
## 10 volkswagen   new ~   2.5  2008     5 manu~ f        20    28 r     subc~
## # ... with 224 more rows</code></pre>
<p></p>
<p>Como estamos basicamente definindo colunas na função <code>arrange()</code>, é natural que você anseie pelos diversos métodos de seleção que aprendemos em <code>select()</code>. Por isso, em versões mais recentes do pacote <code>dplyr</code> tivemos a introdução da função <code>across()</code>, pela qual você tem novamente acesso a todos esses métodos que vimos em <code>select()</code>.</p>
<p></p>
<div class="sourceCode" id="cb623"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb623-1"><a href="#cb623-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Ordenar a base segundo as três primeiras colunas</span></span>
<span id="cb623-2"><a href="#cb623-2" aria-hidden="true" tabindex="-1"></a>mpg <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">across</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>))</span>
<span id="cb623-3"><a href="#cb623-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb623-4"><a href="#cb623-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Ordenar a base segundo o conjunto de colunas</span></span>
<span id="cb623-5"><a href="#cb623-5" aria-hidden="true" tabindex="-1"></a><span class="do">## que possuem um nome que se inicia</span></span>
<span id="cb623-6"><a href="#cb623-6" aria-hidden="true" tabindex="-1"></a><span class="do">## pelos caracteres &quot;dis&quot;</span></span>
<span id="cb623-7"><a href="#cb623-7" aria-hidden="true" tabindex="-1"></a>mpg <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">&quot;dis&quot;</span>)))</span></code></pre></div>
<p></p>
<p>Vale destacar que a função <code>arrange()</code>, por padrão, não respeita os grupos de sua tabela e, portanto, considera toda a sua tabela no momento em que a ordenação ocorre. Ainda veremos em mais detalhes nas próximas seções, a função <code>group_by()</code>, pela qual você pode definir os grupos presentes em sua tabela. Portanto, pode ser de seu desejo que a ordenação executada por <code>arrange()</code> ocorra dentro de cada um dos grupos que você delimitou através da função <code>group_by()</code>. Para isso, você precisa configurar o argumento <code>.by_group</code> para <code>TRUE</code>.</p>
<p></p>
<div class="sourceCode" id="cb624"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb624-1"><a href="#cb624-1" aria-hidden="true" tabindex="-1"></a>mpg <span class="sc">%&gt;%</span> </span>
<span id="cb624-2"><a href="#cb624-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(manufacturer) <span class="sc">%&gt;%</span> </span>
<span id="cb624-3"><a href="#cb624-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(hwy, <span class="at">.by_group =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## # A tibble: 234 x 11
## # Groups:   manufacturer [15]
##    manufacturer model displ  year   cyl trans drv     cty   hwy fl    class
##    &lt;chr&gt;        &lt;chr&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt;
##  1 audi         a6 q~   4.2  2008     8 auto~ 4        16    23 p     mids~
##  2 audi         a6 q~   2.8  1999     6 auto~ 4        15    24 p     mids~
##  3 audi         a4 q~   1.8  1999     4 auto~ 4        16    25 p     comp~
##  4 audi         a4 q~   2.8  1999     6 auto~ 4        15    25 p     comp~
##  5 audi         a4 q~   2.8  1999     6 manu~ 4        17    25 p     comp~
##  6 audi         a4 q~   3.1  2008     6 auto~ 4        17    25 p     comp~
##  7 audi         a4 q~   3.1  2008     6 manu~ 4        15    25 p     comp~
##  8 audi         a6 q~   3.1  2008     6 auto~ 4        17    25 p     mids~
##  9 audi         a4      2.8  1999     6 auto~ f        16    26 p     comp~
## 10 audi         a4      2.8  1999     6 manu~ f        18    26 p     comp~
## # ... with 224 more rows</code></pre>
<p></p>
</div>
<div id="sec:mutate_dplyr" class="section level2" number="5.7">
<h2 number="5.7"><span class="header-section-number">5.7</span> Adicionando variáveis à sua tabela com <code>mutate()</code></h2>
<p>Frequentemente, você deseja adicionar uma nova variável em sua tabela como uma função de outras variáveis já existentes em sua tabela. Para tal fim, o pacote <code>dplyr</code> disponibiliza a função <code>mutate()</code>, que oferta um mecanismo limpo e rápido para executarmos tal ação.</p>
<p>Como um exemplo inicial, vamos voltar a tabela <code>transf</code> que introduzimos na seção <a href="#sec:ataque_terrorista">Ataque terrorista</a>. A coluna <code>Data</code> retém a data e o horário em que cada operação foi registrada no sistema do banco. Entretanto, o horário pode se tornar irrelevante para certos passos e, por essa razão, seria interessante que possuíssemos uma coluna na tabela <code>transf</code>, contendo apenas a data de cada transferência. Com esse objetivo em mente, somos capazes de extrair a data da coluna <code>Data</code> através da função <code>as.Date()</code>, e empregar a função <code>mutate()</code> para armazenarmos o resultado desse procedimento em uma nova coluna chamada <code>Sem_hora</code>, como mostrado abaixo.</p>
<p></p>
<div class="sourceCode" id="cb626"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb626-1"><a href="#cb626-1" aria-hidden="true" tabindex="-1"></a>transf <span class="sc">%&gt;%</span> </span>
<span id="cb626-2"><a href="#cb626-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>Pais, <span class="sc">-</span>Descricao) <span class="sc">%&gt;%</span> </span>
<span id="cb626-3"><a href="#cb626-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb626-4"><a href="#cb626-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">Sem_hora =</span> <span class="fu">as.Date</span>(Data)</span>
<span id="cb626-5"><a href="#cb626-5" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 20,006 x 5
##    Data                Usuario   Valor TransferID Sem_hora  
##    &lt;dttm&gt;              &lt;chr&gt;     &lt;dbl&gt;      &lt;dbl&gt; &lt;date&gt;    
##  1 2018-12-06 22:19:19 Eduardo    599.  116241629 2018-12-06
##  2 2018-12-06 22:10:34 Júlio     4611.  115586504 2018-12-06
##  3 2018-12-06 21:59:50 Nathália  4418.  115079280 2018-12-06
##  4 2018-12-06 21:54:13 Júlio     2740.  114972398 2018-12-06
##  5 2018-12-06 21:41:27 Ana       1408.  116262934 2018-12-06
##  6 2018-12-06 21:18:40 Nathália  5052.  115710402 2018-12-06
##  7 2018-12-06 20:54:32 Eduardo   5665.  114830203 2018-12-06
##  8 2018-12-06 20:15:46 Sandra    1474.  116323455 2018-12-06
##  9 2018-12-06 20:04:35 Armando   8906.  115304382 2018-12-06
## 10 2018-12-22 20:00:56 Armando  18521.  114513684 2018-12-22
## # ... with 19,996 more rows</code></pre>
<p></p>
<p>Portanto, sempre que você recorrer à função <code>mutate()</code>, você deve compor essa estrutura de <code>&lt;nome_coluna&gt; = &lt;expressao&gt;</code> em cada coluna adicionada. Ou seja, como flexibilidade e eficiência são valores que as funções do pacote <code>dplyr</code> carregam, você tem a capacidade de criar múltiplas colunas em um mesmo <code>mutate()</code>. Porém, como um aviso, é ideal que você não crie mais de 7 colunas ao mesmo tempo. Na hipótese dessa recomendação ser ignorada, há uma probabilidade significativa de você enfrentar problemas de memória e mensagens de erro bastante nebulosas.</p>
<p></p>
<div class="sourceCode" id="cb628"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb628-1"><a href="#cb628-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Estrutura básica de um mutate():</span></span>
<span id="cb628-2"><a href="#cb628-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&lt;</span>sua_tabela<span class="sc">&gt;</span> <span class="sc">%&gt;%</span> </span>
<span id="cb628-3"><a href="#cb628-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb628-4"><a href="#cb628-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">nome_coluna1 =</span> expressao1,</span>
<span id="cb628-5"><a href="#cb628-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">nome_coluna2 =</span> expressao2,</span>
<span id="cb628-6"><a href="#cb628-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">nome_coluna3 =</span> expressao3,</span>
<span id="cb628-7"><a href="#cb628-7" aria-hidden="true" tabindex="-1"></a>    ...</span>
<span id="cb628-8"><a href="#cb628-8" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p></p>
<p>Um outro ponto muito importante, é que em um mesmo <code>mutate()</code>, você também pode empregar uma nova coluna que você acaba de criar, no cálculo de uma outra coluna a ser produzida. Por exemplo, eu posso guardar o desvio de <code>Valor</code> em relação à sua média, na coluna <code>Desvio</code>, e logo em seguida, utilizar os valores dessa coluna para produzir a coluna <code>Valor_norm</code>, como exposto abaixo.</p>
<p></p>
<div class="sourceCode" id="cb629"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb629-1"><a href="#cb629-1" aria-hidden="true" tabindex="-1"></a>transf <span class="sc">%&gt;%</span> </span>
<span id="cb629-2"><a href="#cb629-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>Pais, <span class="sc">-</span>Descricao) <span class="sc">%&gt;%</span></span>
<span id="cb629-3"><a href="#cb629-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb629-4"><a href="#cb629-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">Desvio =</span> Valor <span class="sc">-</span> <span class="fu">mean</span>(Valor),</span>
<span id="cb629-5"><a href="#cb629-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">Valor_norm =</span> Desvio <span class="sc">/</span> <span class="fu">sd</span>(Valor)</span>
<span id="cb629-6"><a href="#cb629-6" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 20,006 x 6
##    Data                Usuario   Valor TransferID Desvio Valor_norm
##    &lt;dttm&gt;              &lt;chr&gt;     &lt;dbl&gt;      &lt;dbl&gt;  &lt;dbl&gt;      &lt;dbl&gt;
##  1 2018-12-06 22:19:19 Eduardo    599.  116241629 -2920.     -0.772
##  2 2018-12-06 22:10:34 Júlio     4611.  115586504  1093.      0.289
##  3 2018-12-06 21:59:50 Nathália  4418.  115079280   900.      0.238
##  4 2018-12-06 21:54:13 Júlio     2740.  114972398  -778.     -0.206
##  5 2018-12-06 21:41:27 Ana       1408.  116262934 -2110.     -0.558
##  6 2018-12-06 21:18:40 Nathália  5052.  115710402  1534.      0.405
##  7 2018-12-06 20:54:32 Eduardo   5665.  114830203  2147.      0.568
##  8 2018-12-06 20:15:46 Sandra    1474.  116323455 -2044.     -0.540
##  9 2018-12-06 20:04:35 Armando   8906.  115304382  5387.      1.42 
## 10 2018-12-22 20:00:56 Armando  18521.  114513684 15003.      3.97 
## # ... with 19,996 more rows</code></pre>
<p></p>
<p>Com isso, a parte fundamental de um <code>mutate()</code> é construirmos a expressão que produzirá os valores a serem alocados na nova coluna que estamos criando. Logo abaixo, consta uma lista de várias funções que você pode utilizar para formar a expressão que você deseja. Ademais, essa é uma lista parcial, logo, há diversas outras funções que você pode utilizar para calcular os valores dos quais você necessita.</p>
<ol style="list-style-type: decimal">
<li><p><strong>Somatórios:</strong> soma total de uma coluna - <code>sum()</code>; somatório por linha, ao longo de algumas colunas - operador <code>+</code>; somatório por linha, ao longo de várias colunas - <code>rowSums()</code>.</p></li>
<li><p><strong>Operações cumulativas:</strong> somatório acumulado de uma coluna - <code>cumsum()</code>; média acumulada de uma coluna - <code>cummean()</code>; mínimo acumulado de uma coluna - <code>cummin()</code>; máximo acumulado de uma coluna - <code>cummax()</code>.</p></li>
<li><p><strong>Medidas de posição:</strong> média de uma coluna - <code>mean()</code>; mediana de uma coluna - <code>median()</code>; média por linha, ao longo de várias colunas - <code>rowMeans()</code>; média móvel - <code>roll_mean()</code><a href="#fn14" class="footnote-ref" id="fnref14"><sup>14</sup></a>.</p></li>
<li><p><strong>Medidas de dispersão:</strong> desvio padrão de uma coluna - <code>sd()</code>; variância de uma coluna - <code>var()</code>; intervalo interquartil - <code>IQR()</code>; desvio absoluto da mediana - <code>mad()</code>.</p></li>
<li><p><strong>Operadores aritméticos:</strong> soma (<code>+</code>); subtração (<code>-</code>); divisão (<code>/</code>); multiplicação (<code>*</code>); potência, ou elevar um número a <code>x</code> (<code>^</code>); restante da divisão (<code>%%</code>); apenas o número inteiro resultante da divisão (<code>%/%</code>); logaritmo - <code>log()</code>.</p></li>
<li><p><strong>Operadores lógicos:</strong> aplique um teste lógico em cada linha, e preencha essa linha com <code>x</code> caso o teste resulte em <code>TRUE</code>, ou preencha com <code>y</code> caso o teste resulte em <code>FALSE</code> - <code>if_else()</code>; quando você quer aplicar uma operação parecida com <code>if_else()</code>, mas que há vários casos possíveis, um exemplo típico seria criar uma coluna de faixas etárias - <code>case_when()</code>; você também pode utilizar normalmente todos os operadores que vimos na seção de <code>filter()</code>, para criar um teste lógico sobre cada linha - <code>&lt;, &lt;=, &gt;, &gt;=, ==, !=, !, &amp;, |</code>.</p></li>
<li><p><strong>Funções para discretizar variáveis contínuas:</strong> calcula intervalos de forma a encaixar o mesmo número de observações em cada intervalo (comumente chamados de quantis) - <code>cut_number()</code>; calcula intervalos com o mesmo alcance - <code>cut_interval()</code>; calcula intervalos de largura definida no argumento <code>width</code> - <code>cut_width()</code>.</p></li>
<li><p><strong>Funções de defasagem e liderança:</strong> quando você precisa em algum cálculo naquela linha, utilizar o valor da linha anterior - <code>lag()</code>; ou ao invés do valor da linha anterior, você precisa do valor da linha posterior - <code>lead()</code>.</p></li>
</ol>
<p>Porém, é necessário ter cautela. Como a função <code>mutate()</code> busca trabalhar com <code>data.frame</code>’s, é de suma importância, que você esteja sempre consciente das propriedades que essa estrutura carrega. Em especial, a propriedade de que as suas colunas devem possuir o mesmo número de elementos. Portanto, se o seu <code>data.frame</code> possui exatamente 10 mil linhas, você precisa se certificar de que cada expressão utilizada na função <code>mutate()</code>, vai gerar 10 mil elementos como resultado.</p>
<p>Na hipótese de que alguma dessas expressões produzam, por exemplo, 9.999 elementos, um erro será acionado, pois esses 9,999 mil elementos não podem ser guardados em um <code>data.frame</code> que possui 10 mil linhas. Logo, a função <code>mutate()</code> lhe provê flexibilidade e eficiência, mas ela não é capaz de quebrar regras fundamentais da linguagem R.</p>
<p>Um exemplo prático disso é encontrado quando tentamos calcular uma média móvel de alguma série temporal, ou de algum valor diário utilizando a função <code>mutate()</code>, como no exemplo abaixo. O erro ocorre devido a própria natureza do cálculo de uma média móvel, que gera uma “perda” de observações, e como consequência, um número menor de observações é gerado dentro do resultado. Perceba abaixo, que ao aplicarmos uma janela de cálculo de 5 observações, a função <code>roll_mean()</code> foi capaz de produzir 996 valores, consequentemente, perdemos 4 observações no processo.</p>
<p></p>
<div class="sourceCode" id="cb631"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb631-1"><a href="#cb631-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb631-2"><a href="#cb631-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb631-3"><a href="#cb631-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">dia =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>,</span>
<span id="cb631-4"><a href="#cb631-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">valor =</span> <span class="fu">rnorm</span>(<span class="dv">1000</span>)</span>
<span id="cb631-5"><a href="#cb631-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb631-6"><a href="#cb631-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb631-7"><a href="#cb631-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RcppRoll)</span>
<span id="cb631-8"><a href="#cb631-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb631-9"><a href="#cb631-9" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> </span>
<span id="cb631-10"><a href="#cb631-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb631-11"><a href="#cb631-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">media_movel =</span> <span class="fu">roll_mean</span>(df<span class="sc">$</span>valor, <span class="at">n =</span> <span class="dv">5</span>)</span>
<span id="cb631-12"><a href="#cb631-12" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p></p>
<pre><code>Erro: Problem with `mutate()` input `media_movel`.
x Input `media_movel` can&#39;t be recycled to size 1000.
i Input `media_movel` is `roll_mean(df$valor, n = 5)`.
i Input `media_movel` must be size 1000 or 1, not 996.
Run `rlang::last_error()` to see where the error occurred.</code></pre>
<p>Compreendendo os potenciais problemas fabricados por essa característica do cálculo de uma média móvel, a função <code>roll_mean()</code> oferece o argumento <code>fill</code>, no qual podemos pedir à função que complete as observações restantes com zeros, como no exemplo abaixo. Dessa forma, a função volta a produzir 1000 observações em seu resultado e, consequentemente, nenhum erro é acionado.</p>
<p></p>
<div class="sourceCode" id="cb633"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb633-1"><a href="#cb633-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> </span>
<span id="cb633-2"><a href="#cb633-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb633-3"><a href="#cb633-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">media_movel =</span> <span class="fu">roll_mean</span>(valor, <span class="at">n =</span> <span class="dv">5</span>, <span class="at">fill =</span> <span class="dv">0</span>, <span class="at">align =</span> <span class="st">&quot;right&quot;</span>)</span>
<span id="cb633-4"><a href="#cb633-4" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 1,000 x 3
##      dia  valor media_movel
##    &lt;int&gt;  &lt;dbl&gt;       &lt;dbl&gt;
##  1     1 -0.626      0     
##  2     2  0.184      0     
##  3     3 -0.836      0     
##  4     4  1.60       0     
##  5     5  0.330      0.129 
##  6     6 -0.820      0.0905
##  7     7  0.487      0.151 
##  8     8  0.738      0.466 
##  9     9  0.576      0.262 
## 10    10 -0.305      0.135 
## # ... with 990 more rows</code></pre>
<p></p>
<p>Desse modo, estamos discutindo as possibilidades existentes de sua expressão fornecida à <code>mutate()</code>, produzir múltiplos valores. Todavia, diversas funções extremamente úteis, e que utilizamos com bastante frequência nessas expressões, resultam apenas em um único valor. Grandes exemplos são as funções <code>mean()</code> e <code>sum()</code>, que calculam a média e a soma de uma coluna, respectivamente.</p>
<p>Em todas as ocasiões em que a sua expressão na função <code>mutate()</code> gerar um único valor, qualquer que ele seja, a função <code>mutate()</code> irá automaticamente replicar esse mesmo valor ao longo de toda a coluna que você acaba de criar. Vemos uma demonstração disso, ao criarmos abaixo, as colunas <code>soma</code>, <code>prop</code> e <code>um_numero</code>. Com essa ideia em mente, se temos diversos valores numéricos em uma dada coluna, nós podemos eficientemente calcular uma proporção desses valores em relação ao total de sua coluna, com o uso da função <code>sum()</code>, como no exemplo abaixo. Da mesma forma, nós podemos rapidamente normalizar uma coluna numérica segundo a fórmula de uma estatística Z, por meio das funções <code>sd()</code> e <code>mean()</code>.</p>
<p></p>
<div class="sourceCode" id="cb635"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb635-1"><a href="#cb635-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb635-2"><a href="#cb635-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">id =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,</span>
<span id="cb635-3"><a href="#cb635-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">c</span>(<span class="fl">2.5</span>, <span class="fl">1.5</span>, <span class="fl">3.2</span>, <span class="fl">5.1</span>, <span class="fl">2.2</span>),</span>
<span id="cb635-4"><a href="#cb635-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>)</span>
<span id="cb635-5"><a href="#cb635-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb635-6"><a href="#cb635-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb635-7"><a href="#cb635-7" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb635-8"><a href="#cb635-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb635-9"><a href="#cb635-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">soma =</span> <span class="fu">sum</span>(x),</span>
<span id="cb635-10"><a href="#cb635-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">prop =</span> y <span class="sc">*</span> <span class="dv">100</span> <span class="sc">/</span> <span class="fu">sum</span>(y),</span>
<span id="cb635-11"><a href="#cb635-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">um_numero =</span> <span class="dv">25</span>,</span>
<span id="cb635-12"><a href="#cb635-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">norm =</span> (x <span class="sc">-</span> <span class="fu">mean</span>(x)) <span class="sc">/</span> <span class="fu">sd</span>(x)</span>
<span id="cb635-13"><a href="#cb635-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb635-14"><a href="#cb635-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb635-15"><a href="#cb635-15" aria-hidden="true" tabindex="-1"></a>df</span></code></pre></div>
<pre><code>## # A tibble: 5 x 7
##      id     x     y  soma  prop um_numero   norm
##   &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;  &lt;dbl&gt;
## 1     1   2.5     1  14.5  6.67        25 -0.291
## 2     2   1.5     2  14.5 13.3         25 -1.02 
## 3     3   3.2     3  14.5 20           25  0.219
## 4     4   5.1     4  14.5 26.7         25  1.60 
## 5     5   2.2     5  14.5 33.3         25 -0.510</code></pre>
<p></p>
</div>
<div id="sec:group_by_summarise" class="section level2" number="5.8">
<h2 number="5.8"><span class="header-section-number">5.8</span> Agrupando dados e gerando estatísticas sumárias com <code>group_by()</code> e <code>summarise()</code></h2>
<p>Em diversas áreas, é muito comum que contenhamos variáveis qualitativas em nossa base de dados. Variáveis desse tipo, usualmente definem grupos ou estratos de uma amostra, população ou medida, como faixas etárias ou faixas de valor salarial. Se você está analisando, por exemplo, dados epidemiológicos, você em geral deseja examinar se uma dada doença está ocorrendo com maior ou menor intensidade em um determinado grupo de sua população.</p>
<p>Ou seja, será que fatores como a raça, a idade, o gênero, a orientação sexual ou a localidade de um indivíduo são capazes de afetar as suas chances de ser infectado por essa doença? De outra maneira, será que essas variáveis qualitativas são capazes de gerar, por exemplo, diferenças no salário deste indivíduo? Da mesma forma, quando analisamos a performance de determinadas firmas, desejamos saber se a localidade, o setor, o tamanho, o investimento e a receita total, além do número de funcionários dessa firma são capazes de prover alguma vantagem em relação aos seus concorrentes.</p>
<p>Para esse tipo de estudo, o pacote <code>dplyr</code> nos oferece a função <code>group_by()</code> que fundamentalmente altera o comportamento de funções como <code>mutate()</code> e <code>summarise()</code>, e nos permite calcular estatísticas e aplicarmos operações dentro de cada grupo presente em nossos dados. Como um exemplo inicial, vamos utilizar a tabela <code>minas_pop</code>, que contém dados de população e PIB (Produto Interno Bruto) dos 853 municípios do estado de Minas Gerais.</p>
<p></p>
<div class="sourceCode" id="cb637"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb637-1"><a href="#cb637-1" aria-hidden="true" tabindex="-1"></a>github <span class="ot">&lt;-</span> <span class="st">&quot;https://raw.githubusercontent.com/pedropark99/&quot;</span></span>
<span id="cb637-2"><a href="#cb637-2" aria-hidden="true" tabindex="-1"></a>pasta <span class="ot">&lt;-</span> <span class="st">&quot;Curso-R/master/Dados/&quot;</span></span>
<span id="cb637-3"><a href="#cb637-3" aria-hidden="true" tabindex="-1"></a>arquivo <span class="ot">&lt;-</span> <span class="st">&quot;populacao.csv&quot;</span></span>
<span id="cb637-4"><a href="#cb637-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb637-5"><a href="#cb637-5" aria-hidden="true" tabindex="-1"></a>minas_pop <span class="ot">&lt;-</span> <span class="fu">read_csv2</span>(<span class="fu">paste0</span>(github, pasta, arquivo))</span></code></pre></div>
<p></p>
<p></p>
<pre><code>## # A tibble: 853 x 7
##    IBGE2   IBGE Munic               Populacao   Ano      PIB Intermediaria
##    &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;                   &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;        
##  1    10 310010 Abadia dos Dourados      6972  2017 33389769 Uberlândia   
##  2    20 310020 Abaeté                  23223  2017 96201158 Divinópolis  
##  3    30 310030 Abre Campo              13465  2017 29149429 Juíz de Fora 
##  4    40 310040 Acaiaca                  3994  2017  2521892 Juíz de Fora 
##  5    50 310050 Açucena                  9575  2017 15250077 Ipatinga     
##  6    60 310060 Água Boa                13600  2017 29988906 Teófilo Otoni
##  7    70 310070 Água Comprida            2005  2017 74771408 Uberaba      
##  8    80 310080 Aguanil                  4448  2017 15444038 Varginha     
##  9    90 310090 Águas Formosas          19166  2017 11236696 Teófilo Otoni
## 10   100 310100 Águas Vermelhas         13477  2017 48088397 Teófilo Otoni
## # ... with 843 more rows</code></pre>
<p></p>
<p>Como demonstramos na seção anterior, a função <code>sum()</code> serve para calcularmos o total de uma coluna inteira. Logo, se aplicássemos a função <code>sum()</code> sobre a coluna <code>Populacao</code>, teríamos a população total do estado de Minas Gerais. Porém, e se desejássemos calcular a população total de cada uma das regiões intermediárias (presentes na coluna <code>Intermediaria</code>) que compõe o estado de Minas Gerais?</p>
<p>Para isso, nós podemos utilizar a função <code>group_by()</code> para determinar onde em nossa tabela se encontram os grupos de nossos dados. No nosso caso, esses grupos estão na coluna <code>Intermediaria</code>. Dessa forma, após utilizarmos o <code>group_by()</code>, perceba abaixo que os totais calculados pela função <code>sum()</code>, e que estão apresentados na coluna <code>Pop_total</code>, variam ao longo da tabela de acordo com o valor presente na coluna <code>Intermediaria</code>. Logo, temos agora a população total de cada região intermediária na coluna <code>Pop_total</code>. Da mesma maneira, ao invés de possuírmos uma proporção baseada na população do estado, as proporções de cada município expostas na coluna <code>Prop_pop_mun</code> possuem como denominador, a população total da região intermediária a qual o município pertence.</p>
<p></p>
<div class="sourceCode" id="cb639"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb639-1"><a href="#cb639-1" aria-hidden="true" tabindex="-1"></a>minas_pop <span class="sc">%&gt;%</span> </span>
<span id="cb639-2"><a href="#cb639-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>Ano, <span class="sc">-</span>PIB) <span class="sc">%&gt;%</span> </span>
<span id="cb639-3"><a href="#cb639-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Intermediaria) <span class="sc">%&gt;%</span> </span>
<span id="cb639-4"><a href="#cb639-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb639-5"><a href="#cb639-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">Pop_total =</span> <span class="fu">sum</span>(Populacao),</span>
<span id="cb639-6"><a href="#cb639-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">Prop_pop_mun =</span> Populacao <span class="sc">*</span> <span class="dv">100</span> <span class="sc">/</span> Pop_total</span>
<span id="cb639-7"><a href="#cb639-7" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 853 x 7
## # Groups:   Intermediaria [13]
##    IBGE2   IBGE Munic        Populacao Intermediaria Pop_total Prop_pop_mun
##    &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;            &lt;dbl&gt; &lt;chr&gt;             &lt;dbl&gt;        &lt;dbl&gt;
##  1    10 310010 Abadia dos ~      6972 Uberlândia      1161513        0.600
##  2    20 310020 Abaeté           23223 Divinópolis     1300658        1.79 
##  3    30 310030 Abre Campo       13465 Juíz de Fora    2334530        0.577
##  4    40 310040 Acaiaca           3994 Juíz de Fora    2334530        0.171
##  5    50 310050 Açucena           9575 Ipatinga        1022384        0.937
##  6    60 310060 Água Boa         13600 Teófilo Otoni   1222050        1.11 
##  7    70 310070 Água Compri~      2005 Uberaba          800412        0.250
##  8    80 310080 Aguanil           4448 Varginha        1634643        0.272
##  9    90 310090 Águas Formo~     19166 Teófilo Otoni   1222050        1.57 
## 10   100 310100 Águas Verme~     13477 Teófilo Otoni   1222050        1.10 
## # ... with 843 more rows</code></pre>
<p></p>
<p>Para verificarmos se os grupos em uma dada tabela estão definidos, podemos observar se a descrição <code>Groups</code> se encontra logo abaixo às dimensões da tabela (<code>tibble: 853 x 7</code>). Essa descrição <code>Groups</code>, acaba nos informando a coluna (ou o conjunto de colunas) envolvidas nessa definição, além do número de grupos que estão contidos em nossa tabela. Logo, pelo resultado do exemplo acima, temos 13 grupos, ou 13 regiões intermediárias diferentes presentes na coluna <code>Intermediaria</code>.</p>
<p>Como um outro exemplo, dessa vez, em um contexto mais atual, podemos utilizar os dados de COVID-19 presentes na tabela abaixo, denominada <code>covid</code>. Nessa tabela, temos o acumulado do número de casos confirmados do vírus em cada estado brasileiro, durante o período de 25 de Fevereiro a 27 de Julho de 2020.</p>
<p></p>
<div class="sourceCode" id="cb641"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb641-1"><a href="#cb641-1" aria-hidden="true" tabindex="-1"></a>github <span class="ot">&lt;-</span> <span class="st">&quot;https://raw.githubusercontent.com/pedropark99/&quot;</span></span>
<span id="cb641-2"><a href="#cb641-2" aria-hidden="true" tabindex="-1"></a>pasta <span class="ot">&lt;-</span> <span class="st">&quot;Curso-R/master/Dados/&quot;</span></span>
<span id="cb641-3"><a href="#cb641-3" aria-hidden="true" tabindex="-1"></a>arquivo <span class="ot">&lt;-</span> <span class="st">&quot;covid.csv&quot;</span></span>
<span id="cb641-4"><a href="#cb641-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb641-5"><a href="#cb641-5" aria-hidden="true" tabindex="-1"></a>covid <span class="ot">&lt;-</span> <span class="fu">read_csv2</span>(<span class="fu">paste0</span>(github, pasta, arquivo))</span></code></pre></div>
<p></p>
<p></p>
<pre><code>## # A tibble: 3,625 x 4
##    data       estado casos mortes
##    &lt;date&gt;     &lt;chr&gt;  &lt;dbl&gt;  &lt;dbl&gt;
##  1 2020-03-17 AC         3      0
##  2 2020-03-18 AC         3      0
##  3 2020-03-19 AC         4      0
##  4 2020-03-20 AC         7      0
##  5 2020-03-21 AC        11      0
##  6 2020-03-22 AC        11      0
##  7 2020-03-23 AC        17      0
##  8 2020-03-24 AC        21      0
##  9 2020-03-25 AC        23      0
## 10 2020-03-26 AC        23      0
## # ... with 3,615 more rows</code></pre>
<p></p>
<p>Durante o ano de 2020, a Fundação João Pinheiro (FJP) tem oferecido parte de seu corpo técnico para a Secretaria Estadual de Saúde, com o objetivo de dar suporte técnico à instituição no monitoramento das estatísticas de contaminação e
impacto do vírus no estado de Minas Gerais.</p>
<p>Portanto, uma atividade muito comum com os dados da COVID-19, seria calcularmos a variação diária no número de casos acumulados. Tal cálculo pode ser atingido, através dos valores acumulados na coluna <code>casos</code>, ao subtrairmos do valor da linha corrente, o valor da linha anterior nessa mesma coluna. Para incluirmos o valor da linha anterior em nosso cálculo, podemos usar a função <code>lag()</code>, como no código abaixo:</p>
<p></p>
<div class="sourceCode" id="cb643"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb643-1"><a href="#cb643-1" aria-hidden="true" tabindex="-1"></a>covid <span class="sc">%&gt;%</span></span>
<span id="cb643-2"><a href="#cb643-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb643-3"><a href="#cb643-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">casos_var =</span> casos <span class="sc">-</span> <span class="fu">lag</span>(casos),</span>
<span id="cb643-4"><a href="#cb643-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">mortes_var =</span> mortes <span class="sc">-</span> <span class="fu">lag</span>(mortes)</span>
<span id="cb643-5"><a href="#cb643-5" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p></p>
<p>Porém, temos um problema nessa operação, que emerge do fato de que não delimitamos os grupos da tabela. Por essa razão, a função <code>mutate()</code> vai aplicar a expressão <code>casos - lag(casos)</code> sobre toda a tabela de uma vez só. O correto, seria que nós aplicássemos essa operação separadamente sobre os dados de cada estado.</p>
<p>Dito de outra forma, ao não dizermos que cada estado deveria ser tratado de forma separada dos demais, estamos invadindo os limites de cada estado com o cálculo pertencente a outros estados. Em outras palavras, o problema que emerge do código anterior, em que não definimos os grupos, se encontra nas linhas que definem os limites entre cada estado, ou as linhas que marcam a transição entre os dados do estado A para os dados do estado B. Logo, caso não definirmos esses grupos, estaremos utilizando no cálculo da variação presente na primeira linha referente ao estado de São Paulo, o número acumulado de casos localizado na última linha pertencente ao estado que vem antes de São Paulo na base (o estado de Sergipe).</p>
<p>Por isso, ao utilizarmos a função <code>group_by()</code> sobre a tabela <code>covid</code>, faremos com que a função <code>mutate()</code> esteja consciente dos limites entre os dados de cada estado, e que, portanto, respeite esses limites durante o cálculo dessa variação.</p>
<p></p>
<div class="sourceCode" id="cb644"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb644-1"><a href="#cb644-1" aria-hidden="true" tabindex="-1"></a>covid_novo <span class="ot">&lt;-</span> covid <span class="sc">%&gt;%</span></span>
<span id="cb644-2"><a href="#cb644-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(estado) <span class="sc">%&gt;%</span> </span>
<span id="cb644-3"><a href="#cb644-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb644-4"><a href="#cb644-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">casos_var =</span> casos <span class="sc">-</span> <span class="fu">lag</span>(casos),</span>
<span id="cb644-5"><a href="#cb644-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">mortes_var =</span> mortes <span class="sc">-</span> <span class="fu">lag</span>(mortes)</span>
<span id="cb644-6"><a href="#cb644-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb644-7"><a href="#cb644-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb644-8"><a href="#cb644-8" aria-hidden="true" tabindex="-1"></a>covid_novo </span></code></pre></div>
<pre><code>## # A tibble: 3,625 x 6
## # Groups:   estado [27]
##    data       estado casos mortes casos_var mortes_var
##    &lt;date&gt;     &lt;chr&gt;  &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;
##  1 2020-03-17 AC         3      0        NA         NA
##  2 2020-03-18 AC         3      0         0          0
##  3 2020-03-19 AC         4      0         1          0
##  4 2020-03-20 AC         7      0         3          0
##  5 2020-03-21 AC        11      0         4          0
##  6 2020-03-22 AC        11      0         0          0
##  7 2020-03-23 AC        17      0         6          0
##  8 2020-03-24 AC        21      0         4          0
##  9 2020-03-25 AC        23      0         2          0
## 10 2020-03-26 AC        23      0         0          0
## # ... with 3,615 more rows</code></pre>
<p></p>
<p>Agora que vimos a função <code>group_by()</code>, podemos prosseguir para a função <code>summarise()</code>, que busca sumarizar, sintetizar ou reduzir múltiplos valores de seu <code>data.frame</code> em poucas linhas. Logo, se eu aplicar a função <code>summarise()</code> sobre a tabela <code>minas_pop</code>, um novo <code>data.frame</code> será gerado, e ele irá conter provavelmente uma única linha. O seu trabalho é definir os valores que vão ocupar esse espaço.</p>
<p>Por isso, dentro da função <code>summarise()</code>, devemos fornecer expressões, exatamente da mesma forma que fornecemos em <code>mutate()</code>. Essas expressões vão ser responsáveis por calcular os valores que vão preencher as linhas presentes no novo <code>data.frame</code> criado. Se as expressões delineadas por você gerarem um único valor ou uma única estatística sumária, o novo <code>data.frame</code> resultante de <code>summarise()</code> vai possuir uma única linha, e uma coluna para cada expressão definida. Como exemplo, podemos calcular o somatório total e a média da coluna <code>Populacao</code> da seguinte forma:</p>
<p></p>
<div class="sourceCode" id="cb646"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb646-1"><a href="#cb646-1" aria-hidden="true" tabindex="-1"></a>minas_pop <span class="sc">%&gt;%</span> </span>
<span id="cb646-2"><a href="#cb646-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb646-3"><a href="#cb646-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_pop =</span> <span class="fu">sum</span>(Populacao),</span>
<span id="cb646-4"><a href="#cb646-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">media_pop =</span> <span class="fu">mean</span>(Populacao)</span>
<span id="cb646-5"><a href="#cb646-5" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 1 x 2
##   total_pop media_pop
##       &lt;dbl&gt;     &lt;dbl&gt;
## 1  21040662    24667.</code></pre>
<p></p>
<p>Por outro lado, caso a sua expressão produza <span class="math inline">\(n\)</span> valores como resultado, o novo <code>data.frame</code> fabricado por <code>summarise()</code> vai possuir <span class="math inline">\(n\)</span> linhas para alocar esses valores. Em outras palavras, o número de linhas presente no <code>data.frame</code> resultante, nesse caso, depende diretamente da quantidade de valores produzidos por sua expressão. Como um exemplo disso, podemos utilizar a função <code>quantile()</code> para extrairmos os limites do intervalo interquartil (percentis de número 25 e 75) da coluna <code>Populacao</code>.</p>
<p></p>
<div class="sourceCode" id="cb648"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb648-1"><a href="#cb648-1" aria-hidden="true" tabindex="-1"></a>minas_pop <span class="sc">%&gt;%</span> </span>
<span id="cb648-2"><a href="#cb648-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">iqr =</span> <span class="fu">quantile</span>(Populacao, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">0.75</span>)))</span></code></pre></div>
<pre><code>## # A tibble: 2 x 1
##     iqr
##   &lt;dbl&gt;
## 1  4844
## 2 17739</code></pre>
<p></p>
<p>Apesar dessas características, a função <code>summarise()</code> é normalmente utilizada em conjunto com a função <code>group_by()</code>. Pois ao definirmos os grupos de nossa tabela, a função <code>summarise()</code> passa a produzir uma linha para cada grupo presente em nossa tabela. Logo, o cálculo da população total e da população média anterior, que produzia uma única linha, passa a gerar 13 valores diferentes e, portanto, 13 linhas diferentes ao agruparmos os dados de acordo com a coluna <code>Intermediaria</code>. Podemos ainda aplicar a função <code>n()</code>, com o objetivo de descobrirmos quantas linhas, ou quantos municípios representam cada região intermediária do estado.</p>
<p></p>
<div class="sourceCode" id="cb650"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb650-1"><a href="#cb650-1" aria-hidden="true" tabindex="-1"></a>minas_pop <span class="sc">%&gt;%</span> </span>
<span id="cb650-2"><a href="#cb650-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Intermediaria) <span class="sc">%&gt;%</span> </span>
<span id="cb650-3"><a href="#cb650-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb650-4"><a href="#cb650-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_pop =</span> <span class="fu">sum</span>(Populacao),</span>
<span id="cb650-5"><a href="#cb650-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">media_pop =</span> <span class="fu">mean</span>(Populacao),</span>
<span id="cb650-6"><a href="#cb650-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">numero_municipios =</span> <span class="fu">n</span>()</span>
<span id="cb650-7"><a href="#cb650-7" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 13 x 4
##    Intermediaria        total_pop media_pop numero_municipios
##    &lt;chr&gt;                    &lt;dbl&gt;     &lt;dbl&gt;             &lt;int&gt;
##  1 Barbacena               772694    15769.                49
##  2 Belo Horizonte         6237890    84296.                74
##  3 Divinópolis            1300658    21322.                61
##  4 Governador Valadares    771775    13306.                58
##  5 Ipatinga               1022384    23236                 44
##  6 Juíz de Fora           2334530    15990.               146
##  7 Montes Claros          1673263    19457.                86
##  8 Patos de Minas          819435    24101.                34
##  9 Pouso Alegre           1289415    16118.                80
## 10 Teófilo Otoni          1222050    14210.                86
## 11 Uberaba                 800412    27600.                29
## 12 Uberlândia             1161513    48396.                24
## 13 Varginha               1634643    19935.                82</code></pre>
<p></p>
<p>Neste momento, vale a pena comentar também, a função <code>count()</code>, que se traduz como um atalho para a junção das funções <code>group_by()</code>, <code>summarise()</code> e <code>n()</code>. Logo, ao invés de construirmos toda a estrutura de <code>group_by()</code> e <code>summarise()</code>, nós poderíamos rapidamente contabilizar o número de municípios em cada região intermediária, através da função <code>count()</code>, como no exemplo abaixo. Lembrando que cada coluna fornecida à <code>count()</code>, será repassada a <code>group_by()</code> e, portanto, será responsável por definir os grupos nos quais a contagem será aplicada. Logo, se definíssemos a função como <code>count(minas_pop, Intermediaria, Ano)</code>, estaríamos calculando o número de municípios existentes em cada região intermediária, dentro de um dado ano descrito em nossa tabela.</p>
<p></p>
<div class="sourceCode" id="cb652"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb652-1"><a href="#cb652-1" aria-hidden="true" tabindex="-1"></a>minas_pop <span class="sc">%&gt;%</span> <span class="fu">count</span>(Intermediaria)</span></code></pre></div>
<pre><code>## # A tibble: 13 x 2
##    Intermediaria            n
##    &lt;chr&gt;                &lt;int&gt;
##  1 Barbacena               49
##  2 Belo Horizonte          74
##  3 Divinópolis             61
##  4 Governador Valadares    58
##  5 Ipatinga                44
##  6 Juíz de Fora           146
##  7 Montes Claros           86
##  8 Patos de Minas          34
##  9 Pouso Alegre            80
## 10 Teófilo Otoni           86
## 11 Uberaba                 29
## 12 Uberlândia              24
## 13 Varginha                82</code></pre>
<p></p>
<p></p>
<div class="sourceCode" id="cb654"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb654-1"><a href="#cb654-1" aria-hidden="true" tabindex="-1"></a><span class="do">## ----------------------------------------</span></span>
<span id="cb654-2"><a href="#cb654-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Sem o uso de pipe ( %&gt;% ) teríamos:</span></span>
<span id="cb654-3"><a href="#cb654-3" aria-hidden="true" tabindex="-1"></a><span class="fu">count</span>(minas_pop, Intermediaria)</span></code></pre></div>
<p></p>
<p>Para além desses pontos, vale destacar que certos momentos em que você necessita de várias colunas para identificar um único grupo de sua tabela, não são incomuns. Por isso, você pode incluir mais de uma coluna dentro da função <code>group_by()</code>. Por exemplo, suponha que você possua na tabela <code>covid</code>, uma coluna que apresenta o mês ao qual cada linha se encontra. Suponha ainda, que você deseja calcular a média mensal de novos casos diários em cada estado. Para realizar essa ação, você precisa aplicar o cálculo da média não apenas dentro de cada estado, mas também, dentro de cada mês disponível na base. Logo, precisamos fornecer tanto a coluna <code>estado</code> quanto a coluna <code>mes</code> à função <code>group_by()</code>, como no exemplo abaixo.</p>
<p></p>
<div class="sourceCode" id="cb655"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb655-1"><a href="#cb655-1" aria-hidden="true" tabindex="-1"></a>covid_novo <span class="sc">%&gt;%</span> </span>
<span id="cb655-2"><a href="#cb655-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb655-3"><a href="#cb655-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mes =</span> <span class="fu">as.integer</span>(<span class="fu">format</span>(data, <span class="st">&quot;%m&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb655-4"><a href="#cb655-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(estado, mes) <span class="sc">%&gt;%</span> </span>
<span id="cb655-5"><a href="#cb655-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb655-6"><a href="#cb655-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">media_novos_casos =</span> <span class="fu">mean</span>(casos_var, <span class="at">na.rm =</span> T)</span>
<span id="cb655-7"><a href="#cb655-7" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;estado&#39;. You can override using the `.groups` argument.</code></pre>
<pre><code>## # A tibble: 136 x 3
## # Groups:   estado [27]
##    estado   mes media_novos_casos
##    &lt;chr&gt;  &lt;int&gt;             &lt;dbl&gt;
##  1 AC         3              2.79
##  2 AC         4             12.1 
##  3 AC         5            188.  
##  4 AC         6            234.  
##  5 AC         7            205.  
##  6 AL         3              0.85
##  7 AL         4             34.2 
##  8 AL         5            298.  
##  9 AL         6            856.  
## 10 AL         7            750.  
## # ... with 126 more rows</code></pre>
<p></p>
<p>Perceba também acima, que utilizamos a função <code>ungroup()</code> sobre a tabela <code>covid_novo</code>, antes de aplicarmos a função <code>group_by()</code>. O motivo para tal operação, está no fato de que a tabela <code>covid_novo</code> já se encontrava agrupada desde o momento em que ela foi criada. Por isso, ao aplicarmos novamente a função <code>group_by()</code> com o uso das colunas <code>estado</code> e <code>mes</code>, para redefinirmos os grupos da tabela, precisamos remover a definição anterior desses grupos. Sendo esta a única ação executada pela função <code>ungroup()</code>.</p>
<p>Portanto, a partir do momento em que você “terminou” de utilizar as operações “por grupo” em sua tabela, e deseja ignorar novamente esses grupos em suas próximas etapas, você deve retirar a definição dos grupos de sua tabela, por meio da função <code>ungroup()</code>.</p>
</div>
<div id="a-função-across-como-a-grande-novidade" class="section level2" number="5.9">
<h2 number="5.9"><span class="header-section-number">5.9</span> A função <code>across()</code> como a grande novidade</h2>
<p>A função <code>across()</code> foi uma das grandes novidades introduzidas em uma versão recente do pacote <code>dplyr</code> <span class="citation">(<a href="#ref-wickham_tidyverse2020" role="doc-biblioref">Wickham 2020</a>)</span>. Essa função lhe permite aplicar os métodos de seleção que vimos em <code>select()</code>, dentro dos demais verbos expostos (funções <code>mutate()</code>, <code>summarise()</code> e <code>arrange()</code>). Para mais, o principal objetivo dessa função está em prover uma maneira muito mais prática de empregarmos uma mesma operação ao longo de várias colunas.</p>
<p>Por exemplo, suponha que você desejasse calcular o logaritmo de todas as colunas numéricas da tabela <code>mpg</code>. Temos então, que aplicar a mesma operação sobre 5 colunas diferentes, mais especificamente, as colunas <code>displ</code>, <code>year</code>, <code>cyl</code>, <code>cty</code> e <code>hwy</code>. Com o que vimos até o momento, você provavelmente faria tal ação da seguinte forma:</p>
<p></p>
<div class="sourceCode" id="cb658"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb658-1"><a href="#cb658-1" aria-hidden="true" tabindex="-1"></a>mpg <span class="sc">%&gt;%</span> </span>
<span id="cb658-2"><a href="#cb658-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb658-3"><a href="#cb658-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">displ =</span> <span class="fu">log</span>(displ),</span>
<span id="cb658-4"><a href="#cb658-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">year =</span> <span class="fu">log</span>(year),</span>
<span id="cb658-5"><a href="#cb658-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">cyl =</span> <span class="fu">log</span>(cyl),</span>
<span id="cb658-6"><a href="#cb658-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">cty =</span> <span class="fu">log</span>(cty),</span>
<span id="cb658-7"><a href="#cb658-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">hwy =</span> <span class="fu">log</span>(hwy)</span>
<span id="cb658-8"><a href="#cb658-8" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p></p>
<p>Porém, além de tedioso, a repetição envolvida nesse tipo de solução, incorre em uma grande chance de erro de nossa parte. Pois os nossos olhos tendem a prestar atenção no que é diferente dos demais, no que se destaca do ambiente, e não sobre blocos e blocos de comandos que são basicamente idênticos.</p>
<p>Com isso, a função <code>across()</code> provê um excelente mecanismo para automatizarmos essa aplicação. Nessa função, temos dois argumentos principais a serem preenchidos: 1)<code>.cols</code>, que representa o conjunto de colunas onde a ação desejada será aplicada; 2) <code>.fns</code>, a função ou a expressão que será empregada em cada coluna (neste argumento, você pode fornecer apenas o nome da função). Com isso, poderíamos reescrever a operação anterior como:</p>
<p></p>
<div class="sourceCode" id="cb659"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb659-1"><a href="#cb659-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Aplicar log() na terceira, quarta,</span></span>
<span id="cb659-2"><a href="#cb659-2" aria-hidden="true" tabindex="-1"></a><span class="do">## quinta, oitava e nona coluna da tabela mpg:</span></span>
<span id="cb659-3"><a href="#cb659-3" aria-hidden="true" tabindex="-1"></a>mpg <span class="sc">%&gt;%</span> </span>
<span id="cb659-4"><a href="#cb659-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="at">.cols =</span> <span class="fu">c</span>(<span class="dv">3</span><span class="sc">:</span><span class="dv">5</span>, <span class="dv">8</span><span class="sc">:</span><span class="dv">9</span>), <span class="at">.fns =</span> log))</span></code></pre></div>
<pre><code>## # A tibble: 234 x 11
##    manufacturer model displ  year   cyl trans drv     cty   hwy fl    class
##    &lt;chr&gt;        &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;
##  1 audi         a4    0.588  7.60  1.39 auto~ f      2.89  3.37 p     comp~
##  2 audi         a4    0.588  7.60  1.39 manu~ f      3.04  3.37 p     comp~
##  3 audi         a4    0.693  7.60  1.39 manu~ f      3.00  3.43 p     comp~
##  4 audi         a4    0.693  7.60  1.39 auto~ f      3.04  3.40 p     comp~
##  5 audi         a4    1.03   7.60  1.79 auto~ f      2.77  3.26 p     comp~
##  6 audi         a4    1.03   7.60  1.79 manu~ f      2.89  3.26 p     comp~
##  7 audi         a4    1.13   7.60  1.79 auto~ f      2.89  3.30 p     comp~
##  8 audi         a4 q~ 0.588  7.60  1.39 manu~ 4      2.89  3.26 p     comp~
##  9 audi         a4 q~ 0.588  7.60  1.39 auto~ 4      2.77  3.22 p     comp~
## 10 audi         a4 q~ 0.693  7.60  1.39 manu~ 4      3.00  3.33 p     comp~
## # ... with 224 more rows</code></pre>
<p></p>
<p>Portanto, em <code>across()</code> você é capaz de aplicar qualquer um dos 5 métodos que vimos em <code>select()</code>. Como um outro exemplo, podemos aplicar a função <code>log()</code> sobre qualquer coluna que se inicie pela letra “h,” com o comando abaixo:</p>
<p></p>
<div class="sourceCode" id="cb661"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb661-1"><a href="#cb661-1" aria-hidden="true" tabindex="-1"></a>mpg <span class="sc">%&gt;%</span> </span>
<span id="cb661-2"><a href="#cb661-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="at">.cols =</span> <span class="fu">starts_with</span>(<span class="st">&quot;h&quot;</span>), <span class="at">.fns =</span> log))</span></code></pre></div>
<pre><code>## # A tibble: 234 x 11
##    manufacturer model displ  year   cyl trans drv     cty   hwy fl    class
##    &lt;chr&gt;        &lt;chr&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;
##  1 audi         a4      1.8  1999     4 auto~ f        18  3.37 p     comp~
##  2 audi         a4      1.8  1999     4 manu~ f        21  3.37 p     comp~
##  3 audi         a4      2    2008     4 manu~ f        20  3.43 p     comp~
##  4 audi         a4      2    2008     4 auto~ f        21  3.40 p     comp~
##  5 audi         a4      2.8  1999     6 auto~ f        16  3.26 p     comp~
##  6 audi         a4      2.8  1999     6 manu~ f        18  3.26 p     comp~
##  7 audi         a4      3.1  2008     6 auto~ f        18  3.30 p     comp~
##  8 audi         a4 q~   1.8  1999     4 manu~ 4        18  3.26 p     comp~
##  9 audi         a4 q~   1.8  1999     4 auto~ 4        16  3.22 p     comp~
## 10 audi         a4 q~   2    2008     4 manu~ 4        20  3.33 p     comp~
## # ... with 224 more rows</code></pre>
<p></p>
<p>Por outro lado, caso você necessite aplicar várias funções em cada coluna, é melhor que você crie uma nova função (a partir da palavra-chave <code>function</code>) dentro de <code>across()</code>, contendo as operações que você deseja aplicar. Pois dessa maneira, você possui um melhor controle sobre em que partes do cálculo, os valores de cada coluna serão posicionados.</p>
<p>Por exemplo, podemos normalizar todas as colunas numéricas da tabela <code>mpg</code>, por uma estatística Z. Perceba abaixo, que nesse caso, precisamos utilizar o valor da coluna em 3 ocasiões: duas vezes no numerador, para calcularmos o desvio de cada valor da coluna em relação a sua média; e uma vez no denominador, para calcularmos o desvio padrão. Repare também, que ao menos quatro funções são utilizadas dentro desse cálculo: as funções <code>mean()</code> e <code>sd()</code>, além dos operadores de subtração (<code>-</code>) e de divisão (<code>/</code>).</p>
<p></p>
<div class="sourceCode" id="cb663"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb663-1"><a href="#cb663-1" aria-hidden="true" tabindex="-1"></a>mpg <span class="sc">%&gt;%</span> </span>
<span id="cb663-2"><a href="#cb663-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(</span>
<span id="cb663-3"><a href="#cb663-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">.cols =</span> <span class="fu">where</span>(is.numeric),</span>
<span id="cb663-4"><a href="#cb663-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">.fns =</span> <span class="cf">function</span>(x) x <span class="sc">-</span> <span class="fu">mean</span>(x) <span class="sc">/</span> <span class="fu">sd</span>(x)</span>
<span id="cb663-5"><a href="#cb663-5" aria-hidden="true" tabindex="-1"></a>  ))</span></code></pre></div>
<pre><code>## # A tibble: 234 x 11
##    manufacturer model       displ  year   cyl trans drv     cty   hwy fl   
##    &lt;chr&gt;        &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;
##  1 audi         a4         -0.887 1555. 0.346 auto~ f      14.0  25.1 p    
##  2 audi         a4         -0.887 1555. 0.346 manu~ f      17.0  25.1 p    
##  3 audi         a4         -0.687 1564. 0.346 manu~ f      16.0  27.1 p    
##  4 audi         a4         -0.687 1564. 0.346 auto~ f      17.0  26.1 p    
##  5 audi         a4          0.113 1555. 2.35  auto~ f      12.0  22.1 p    
##  6 audi         a4          0.113 1555. 2.35  manu~ f      14.0  22.1 p    
##  7 audi         a4          0.413 1564. 2.35  auto~ f      14.0  23.1 p    
##  8 audi         a4 quattro -0.887 1555. 0.346 manu~ 4      14.0  22.1 p    
##  9 audi         a4 quattro -0.887 1555. 0.346 auto~ 4      12.0  21.1 p    
## 10 audi         a4 quattro -0.687 1564. 0.346 manu~ 4      16.0  24.1 p    
## # ... with 224 more rows, and 1 more variable: class &lt;chr&gt;</code></pre>
<p></p>
<p>Com isso, a função <code>summarise()</code> também se torna um local extremamente útil para o emprego da função <code>across()</code>. Pois através de <code>across()</code>, nós podemos rapidamente aplicar uma função sobre cada coluna que desejamos sintetizar com <code>summarise()</code>. Por exemplo, somos capazes de extrair o valor total de todas as colunas numéricas da tabela <code>mpg</code>, por meio dos seguintes comandos:</p>
<p></p>
<div class="sourceCode" id="cb665"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb665-1"><a href="#cb665-1" aria-hidden="true" tabindex="-1"></a>mpg <span class="sc">%&gt;%</span> </span>
<span id="cb665-2"><a href="#cb665-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cyl) <span class="sc">%&gt;%</span> </span>
<span id="cb665-3"><a href="#cb665-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(</span>
<span id="cb665-4"><a href="#cb665-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">.cols =</span> <span class="fu">where</span>(is.numeric),</span>
<span id="cb665-5"><a href="#cb665-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">.fns =</span> sum</span>
<span id="cb665-6"><a href="#cb665-6" aria-hidden="true" tabindex="-1"></a>  ))</span></code></pre></div>
<pre><code>## # A tibble: 4 x 5
##     cyl displ   year   cty   hwy
##   &lt;int&gt; &lt;dbl&gt;  &lt;int&gt; &lt;int&gt; &lt;int&gt;
## 1     4  174. 162243  1702  2333
## 2     5   10    8032    82   115
## 3     6  269. 158227  1281  1803
## 4     8  359. 140317   880  1234</code></pre>
<p></p>
</div>
<div id="removendo-duplicatas-com-distinct" class="section level2" number="5.10">
<h2 number="5.10"><span class="header-section-number">5.10</span> Removendo duplicatas com <code>distinct()</code></h2>
<p>Às vezes, os nossos dados chegam com algum erro de registro, e usualmente, esse erro se manifesta na forma de registros duplicados. Nessa seção, veremos o uso da função <code>distinct()</code> como um mecanismo útil para eliminarmos observações duplicadas em sua tabela. Como um exemplo inicial, podemos utilizar a tabela <code>ponto</code>, criada pelos comandos abaixo:</p>
<p></p>
<div class="sourceCode" id="cb667"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb667-1"><a href="#cb667-1" aria-hidden="true" tabindex="-1"></a>ponto <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb667-2"><a href="#cb667-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">usuario =</span> <span class="st">&quot;Ana&quot;</span>,</span>
<span id="cb667-3"><a href="#cb667-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">dia =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>),</span>
<span id="cb667-4"><a href="#cb667-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">hora =</span> <span class="fu">c</span>(<span class="dv">14</span>, <span class="dv">14</span>, <span class="dv">18</span>, <span class="dv">8</span>, <span class="dv">13</span>),</span>
<span id="cb667-5"><a href="#cb667-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">minuto =</span> <span class="fu">c</span>(<span class="dv">30</span>, <span class="dv">30</span>, <span class="dv">50</span>, <span class="dv">0</span>, <span class="dv">30</span>),</span>
<span id="cb667-6"><a href="#cb667-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">tipo =</span> <span class="fu">c</span>(<span class="st">&quot;E&quot;</span>, <span class="st">&quot;E&quot;</span>, <span class="st">&quot;S&quot;</span>, <span class="st">&quot;E&quot;</span>, <span class="st">&quot;E&quot;</span>),</span>
<span id="cb667-7"><a href="#cb667-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">mes =</span> <span class="dv">3</span>,</span>
<span id="cb667-8"><a href="#cb667-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">ano =</span> <span class="dv">2020</span></span>
<span id="cb667-9"><a href="#cb667-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb667-10"><a href="#cb667-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb667-11"><a href="#cb667-11" aria-hidden="true" tabindex="-1"></a>ponto</span></code></pre></div>
<pre><code>## # A tibble: 5 x 7
##   usuario   dia  hora minuto tipo    mes   ano
##   &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 Ana         1    14     30 E         3  2020
## 2 Ana         1    14     30 E         3  2020
## 3 Ana         1    18     50 S         3  2020
## 4 Ana         2     8      0 E         3  2020
## 5 Ana         2    13     30 E         3  2020</code></pre>
<p></p>
<p>Inicialmente, a função <code>distinct()</code> funciona da mesma maneira que a função <code>unique()</code>. Porém, a função <code>unique()</code> pode ser aplicada em praticamente qualquer tipo de estrutura, além do tipo de estrutura adotado em seu resultado, variar em diversas aplicações. Enquanto isso, a função <code>distinct()</code> (assim como as demais funções do pacote <code>dplyr</code>) irá sempre aceitar um <code>data.frame</code> como <em>input</em> e gerar um novo <code>data.frame</code> como <em>output</em>. Logo, se aplicarmos <code>distinct()</code> sobre a tabela <code>ponto</code>, temos o seguinte resultado:</p>
<p></p>
<div class="sourceCode" id="cb669"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb669-1"><a href="#cb669-1" aria-hidden="true" tabindex="-1"></a>ponto_dis <span class="ot">&lt;-</span> <span class="fu">distinct</span>(ponto)</span>
<span id="cb669-2"><a href="#cb669-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb669-3"><a href="#cb669-3" aria-hidden="true" tabindex="-1"></a>ponto_dis</span></code></pre></div>
<pre><code>## # A tibble: 4 x 7
##   usuario   dia  hora minuto tipo    mes   ano
##   &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 Ana         1    14     30 E         3  2020
## 2 Ana         1    18     50 S         3  2020
## 3 Ana         2     8      0 E         3  2020
## 4 Ana         2    13     30 E         3  2020</code></pre>
<p></p>
<p>Repare pelo produto acima, que a função <code>distinct()</code> eliminou a segunda linha da tabela <code>ponto</code>, pois essa era uma duplicata da primeira linha. Para mais, a função <code>distinct()</code> nos permite aplicar a função sobre colunas específicas do <code>data.frame</code> em questão. No exemplo acima, nós omitimos essa funcionalidade, e pedimos para que a função <code>distinct()</code> fosse aplicada sobre a toda a tabela. Isso significa, que ao não definirmos uma coluna ou um conjunto de colunas em particular, <code>distinct()</code> vai utilizar a combinação dos valores de todas as colunas para determinar os valores únicos presentes em sua tabela e, portanto, eliminar os valores duplicados segundo essa abordagem.</p>
<p>Como exemplo, podemos aplicar a função sobre as colunas <code>usuario</code> e <code>tipo</code>. Dessa forma, <code>distinct()</code> nos retorna um novo <code>data.frame</code> contendo os valores únicos presentes nessas colunas. No entanto, perceba que um efeito colateral foi gerado, pois nós perdemos todas as demais colunas da tabela <code>ponto</code> durante o processo. Isso ocorre em todas as ocasiões em que listamos uma combinação de colunas em <code>distinct()</code>. Para evitar esse comportamento, você pode definir o argumento <code>.keep_all</code> para <code>TRUE</code>, como no exemplo abaixo.</p>
<p></p>
<div class="sourceCode" id="cb671"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb671-1"><a href="#cb671-1" aria-hidden="true" tabindex="-1"></a>ponto_dis <span class="ot">&lt;-</span> <span class="fu">distinct</span>(ponto, usuario, tipo)</span>
<span id="cb671-2"><a href="#cb671-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb671-3"><a href="#cb671-3" aria-hidden="true" tabindex="-1"></a>ponto_dis</span></code></pre></div>
<pre><code>## # A tibble: 2 x 2
##   usuario tipo 
##   &lt;chr&gt;   &lt;chr&gt;
## 1 Ana     E    
## 2 Ana     S</code></pre>
<div class="sourceCode" id="cb673"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb673-1"><a href="#cb673-1" aria-hidden="true" tabindex="-1"></a>ponto_dis <span class="ot">&lt;-</span> <span class="fu">distinct</span>(ponto, usuario, tipo, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb673-2"><a href="#cb673-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb673-3"><a href="#cb673-3" aria-hidden="true" tabindex="-1"></a>ponto_dis</span></code></pre></div>
<pre><code>## # A tibble: 2 x 7
##   usuario   dia  hora minuto tipo    mes   ano
##   &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 Ana         1    14     30 E         3  2020
## 2 Ana         1    18     50 S         3  2020</code></pre>
<p></p>
<p>Com isso, se desejamos eliminar os valores duplicados em nossas tabelas, podemos rapidamente aplicar a função <code>distinct()</code> sobre toda a tabela. Contudo, haverá momentos em que combinações específicas de colunas devem ser utilizadas para determinarmos as observações únicas da tabela, ao invés de todas as colunas disponíveis. Para isso, você deve listar os nomes das colunas a serem utilizadas pela função <code>distinct()</code> neste processo. Além disso, você geralmente vai desejar utilizar a configuração <code>.keep_all = TRUE</code> durante essa situação, com o objetivo de conservar as demais colunas da tabela no resultado de <code>distinct()</code>.</p>
<p>Ademais, lembre-se que você pode utilizar a função <code>across()</code> para ter acesso aos mecanismos de seleção de <code>select()</code>, para definir o conjunto de colunas a ser empregado por <code>distinct()</code>. Por exemplo, eu posso encontrar todos os valores únicos criados pela combinação entre as colunas <code>dia</code> e <code>tipo</code>, por meio do seguinte comando:</p>
<p></p>
<div class="sourceCode" id="cb675"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb675-1"><a href="#cb675-1" aria-hidden="true" tabindex="-1"></a><span class="fu">distinct</span>(ponto, <span class="fu">across</span>(<span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">5</span>)), <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## # A tibble: 3 x 7
##   usuario   dia  hora minuto tipo    mes   ano
##   &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 Ana         1    14     30 E         3  2020
## 2 Ana         1    18     50 S         3  2020
## 3 Ana         2     8      0 E         3  2020</code></pre>
<p></p>
</div>
<div id="combinando-tabelas-com-bind_cols-e-bind_rows" class="section level2" number="5.11">
<h2 number="5.11"><span class="header-section-number">5.11</span> Combinando tabelas com <code>bind_cols()</code> e <code>bind_rows()</code></h2>
<p>Os pacotes básicos do R oferecem as funções <code>rbind()</code> e <code>cbind()</code>, que lhe permite combinar objetos. Porém, o pacote <code>dplyr</code> oferece implementações mais rápidas e completas desse mecanismo, através das funções <code>bind_cols()</code> e <code>bind_rows()</code>. Do mesmo modo que as demais funções do pacote, <code>bind_cols()</code> e <code>bind_rows()</code> aceitam um conjunto de <code>data.frame</code>’s como <em>input</em>, e lhe retornam um novo <code>data.frame</code> como <em>output</em>.</p>
<p>Como exemplo inicial, suponha que você possua o conjunto de tabelas abaixo. Essas tabelas contêm dados das vendas de três lojas diferentes.</p>
<p></p>
<div class="sourceCode" id="cb677"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb677-1"><a href="#cb677-1" aria-hidden="true" tabindex="-1"></a>savassi <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb677-2"><a href="#cb677-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">dia =</span> <span class="fu">as.Date</span>(<span class="fu">c</span>(<span class="st">&quot;2020-03-01&quot;</span>, <span class="st">&quot;2020-03-02&quot;</span>, <span class="st">&quot;2020-03-03&quot;</span>,</span>
<span id="cb677-3"><a href="#cb677-3" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&quot;2020-03-04&quot;</span>)),</span>
<span id="cb677-4"><a href="#cb677-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">produtoid =</span> <span class="fu">c</span>(<span class="st">&quot;10241&quot;</span>, <span class="st">&quot;10241&quot;</span>, <span class="st">&quot;10032&quot;</span>, <span class="st">&quot;15280&quot;</span>),</span>
<span id="cb677-5"><a href="#cb677-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">loja =</span> <span class="st">&quot;Savassi&quot;</span>,</span>
<span id="cb677-6"><a href="#cb677-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">unidades =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb677-7"><a href="#cb677-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">valor =</span> <span class="fu">c</span>(<span class="fl">15.5</span>, <span class="dv">31</span>, <span class="fl">12.4</span>, <span class="fl">16.7</span>)</span>
<span id="cb677-8"><a href="#cb677-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb677-9"><a href="#cb677-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb677-10"><a href="#cb677-10" aria-hidden="true" tabindex="-1"></a>prado <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb677-11"><a href="#cb677-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">dia =</span> <span class="fu">as.Date</span>(<span class="fu">c</span>(<span class="st">&quot;2020-03-10&quot;</span>, <span class="st">&quot;2020-03-11&quot;</span>, <span class="st">&quot;2020-03-12&quot;</span>)),</span>
<span id="cb677-12"><a href="#cb677-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">produtoid =</span> <span class="fu">c</span>(<span class="st">&quot;15280&quot;</span>, <span class="st">&quot;10032&quot;</span>, <span class="st">&quot;10032&quot;</span>),</span>
<span id="cb677-13"><a href="#cb677-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">loja =</span> <span class="st">&quot;Prado&quot;</span>,</span>
<span id="cb677-14"><a href="#cb677-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">unidades =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">2</span>),</span>
<span id="cb677-15"><a href="#cb677-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">valor =</span> <span class="fu">c</span>(<span class="fl">50.1</span>, <span class="fl">49.6</span>, <span class="fl">24.8</span>)</span>
<span id="cb677-16"><a href="#cb677-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb677-17"><a href="#cb677-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb677-18"><a href="#cb677-18" aria-hidden="true" tabindex="-1"></a>centro <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb677-19"><a href="#cb677-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">dia =</span> <span class="fu">as.Date</span>(<span class="fu">c</span>(<span class="st">&quot;2020-03-07&quot;</span>, <span class="st">&quot;2020-03-10&quot;</span>, <span class="st">&quot;2020-03-12&quot;</span>)),</span>
<span id="cb677-20"><a href="#cb677-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">produtoid =</span> <span class="fu">c</span>(<span class="st">&quot;15280&quot;</span>, <span class="st">&quot;15280&quot;</span>, <span class="st">&quot;15280&quot;</span>),</span>
<span id="cb677-21"><a href="#cb677-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">loja =</span> <span class="st">&quot;Centro&quot;</span>,</span>
<span id="cb677-22"><a href="#cb677-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">unidades =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb677-23"><a href="#cb677-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">valor =</span> <span class="fu">c</span>(<span class="fl">83.5</span>, <span class="fl">16.7</span>, <span class="fl">16.7</span>)</span>
<span id="cb677-24"><a href="#cb677-24" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p></p>
<p>Supondo que você seja um analista da empresa dona dessas lojas, e que foi delegado a você, a tarefa de analisar os dados dessas tabelas, você terá no mínimo o triplo de trabalho, caso mantenha essas tabelas separadas. Pois cada etapa de sua análise teria de ser replicar em três lugares diferentes. Por isso, a melhor opção é reunir essas tabelas em um lugar só. Pois dessa maneira, você precisa aplicar as suas operações em um único lugar.</p>
<p>Ou seja, a motivação para o uso das funções <code>bind_rows()</code> e <code>bind_cols()</code>, surge em geral, a partir da dificuldade que temos em aplicar a mesma função em diversos pontos de nosso trabalho, além da manutenção e monitoramento dos resultados gerados em cada um desses pontos envolvidos nesse serviço. Portanto, se você possui um grande conjunto de tabelas, que são semelhantes entre si, e você precisa aplicar os mesmos passos sobre cada uma delas, é interessante que você tente juntar essas tabelas em uma só. Dessa maneira, você pode direcionar o seu foco e as suas energias para um só local.</p>
<p>Como as tabelas <code>savassi</code>, <code>prado</code> e <code>centro</code> possuem as mesmas colunas, faz mais sentido unirmos as linhas de cada tabela para formarmos a nossa tabela única. Para isso, basta listarmos essas tabelas dentro da função <code>bind_rows()</code>, como demonstrado abaixo. Uma outra opção, seria provermos uma lista de <code>data.frame</code>’s à função, o que também está demonstrado abaixo:</p>
<p></p>
<div class="sourceCode" id="cb678"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb678-1"><a href="#cb678-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(savassi, prado, centro)</span></code></pre></div>
<pre><code>## # A tibble: 10 x 5
##    dia        produtoid loja    unidades valor
##    &lt;date&gt;     &lt;chr&gt;     &lt;chr&gt;      &lt;dbl&gt; &lt;dbl&gt;
##  1 2020-03-01 10241     Savassi        1  15.5
##  2 2020-03-02 10241     Savassi        2  31  
##  3 2020-03-03 10032     Savassi        1  12.4
##  4 2020-03-04 15280     Savassi        1  16.7
##  5 2020-03-10 15280     Prado          3  50.1
##  6 2020-03-11 10032     Prado          4  49.6
##  7 2020-03-12 10032     Prado          2  24.8
##  8 2020-03-07 15280     Centro         5  83.5
##  9 2020-03-10 15280     Centro         1  16.7
## 10 2020-03-12 15280     Centro         1  16.7</code></pre>
<p></p>
<p></p>
<div class="sourceCode" id="cb680"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb680-1"><a href="#cb680-1" aria-hidden="true" tabindex="-1"></a><span class="do">## ------------------------------------------------</span></span>
<span id="cb680-2"><a href="#cb680-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Uma alternativa seria fornecermos uma lista</span></span>
<span id="cb680-3"><a href="#cb680-3" aria-hidden="true" tabindex="-1"></a><span class="do">## contendo as tabelas a serem unidas:</span></span>
<span id="cb680-4"><a href="#cb680-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb680-5"><a href="#cb680-5" aria-hidden="true" tabindex="-1"></a>lista <span class="ot">&lt;-</span> <span class="fu">list</span>(savassi, prado, centro)</span>
<span id="cb680-6"><a href="#cb680-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb680-7"><a href="#cb680-7" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(lista)</span></code></pre></div>
<p></p>
<p>Portanto, ao unir as linhas de cada tabela, a função <code>bind_rows()</code> está de certa forma “empilhando” uma tabela em cima da outra. Mas para que este tipo de operação ocorra de maneira adequada, é <strong>importante que as colunas de todas as tabelas estejam nomeadas igualmente</strong>. Dito de outra forma, as tabelas envolvidas nesse cálculo, devem ser formadas pelo mesmo grupo de colunas. Essas colunas podem se encontrar em ordens diferentes ao longo das tabelas, mas elas precisam necessariamente estar nomeadas da mesma maneira. Caso alguma coluna em pelo menos uma das tabelas possua um nome diferente de seus pares, a função vai alocar os seus valores em uma coluna separada das demais, e isso geralmente não é o que você deseja.</p>
<p></p>
<div class="sourceCode" id="cb681"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb681-1"><a href="#cb681-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(centro)[<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;ProdutoID&quot;</span>, <span class="st">&quot;Loja&quot;</span>)</span>
<span id="cb681-2"><a href="#cb681-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb681-3"><a href="#cb681-3" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(savassi, prado, centro)</span></code></pre></div>
<pre><code>## # A tibble: 10 x 7
##    dia        produtoid loja    unidades valor ProdutoID Loja  
##    &lt;date&gt;     &lt;chr&gt;     &lt;chr&gt;      &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;     &lt;chr&gt; 
##  1 2020-03-01 10241     Savassi        1  15.5 &lt;NA&gt;      &lt;NA&gt;  
##  2 2020-03-02 10241     Savassi        2  31   &lt;NA&gt;      &lt;NA&gt;  
##  3 2020-03-03 10032     Savassi        1  12.4 &lt;NA&gt;      &lt;NA&gt;  
##  4 2020-03-04 15280     Savassi        1  16.7 &lt;NA&gt;      &lt;NA&gt;  
##  5 2020-03-10 15280     Prado          3  50.1 &lt;NA&gt;      &lt;NA&gt;  
##  6 2020-03-11 10032     Prado          4  49.6 &lt;NA&gt;      &lt;NA&gt;  
##  7 2020-03-12 10032     Prado          2  24.8 &lt;NA&gt;      &lt;NA&gt;  
##  8 2020-03-07 &lt;NA&gt;      &lt;NA&gt;           5  83.5 15280     Centro
##  9 2020-03-10 &lt;NA&gt;      &lt;NA&gt;           1  16.7 15280     Centro
## 10 2020-03-12 &lt;NA&gt;      &lt;NA&gt;           1  16.7 15280     Centro</code></pre>
<p></p>
<p>Por outro lado, quando estamos planejando unir tabelas a partir de suas colunas, a nossa preocupação principal deve ser com o número de linhas de cada tabela. Com isso, quando utilizar a função <code>bind_cols()</code>, é <strong>essencial que as tabelas envolvidas possuam exatamente o mesmo número de linhas</strong>. Ou seja, no caso da função <code>bind_cols()</code>, é primordial que as tabelas fornecidas à função, possuam o mesmo número de linhas, pois caso contrário, um erro será acionado pela função, e você não poderá prosseguir.</p>
<p>Tendo esse ponto em mente, você utiliza a função <code>bind_cols()</code> do mesmo modo que a função <code>bind_rows()</code>. Basta listar as tabelas a serem unidas dentro da função, ou fornecer uma lista contendo os <code>data.frame</code>’s a serem fundidos. Veja abaixo, um exemplo com as tabelas <code>tab1</code> e <code>tab2</code>.</p>
<p></p>
<div class="sourceCode" id="cb683"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb683-1"><a href="#cb683-1" aria-hidden="true" tabindex="-1"></a>tab1 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb683-2"><a href="#cb683-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">dia =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,</span>
<span id="cb683-3"><a href="#cb683-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">valor =</span> <span class="fu">round</span>(<span class="fu">rnorm</span>(<span class="dv">5</span>), <span class="dv">2</span>)</span>
<span id="cb683-4"><a href="#cb683-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb683-5"><a href="#cb683-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb683-6"><a href="#cb683-6" aria-hidden="true" tabindex="-1"></a>tab2 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb683-7"><a href="#cb683-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">id =</span> <span class="fu">c</span>(<span class="st">&quot;104&quot;</span>, <span class="st">&quot;104&quot;</span>, <span class="st">&quot;105&quot;</span>, <span class="st">&quot;106&quot;</span>, <span class="st">&quot;106&quot;</span>),</span>
<span id="cb683-8"><a href="#cb683-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">nome =</span> <span class="st">&quot;Ana&quot;</span></span>
<span id="cb683-9"><a href="#cb683-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb683-10"><a href="#cb683-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb683-11"><a href="#cb683-11" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_cols</span>(tab1, tab2)</span></code></pre></div>
<pre><code>## # A tibble: 5 x 4
##     dia valor id    nome 
##   &lt;int&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;
## 1     1  1.13 104   Ana  
## 2     2  1.11 104   Ana  
## 3     3 -0.87 105   Ana  
## 4     4  0.21 106   Ana  
## 5     5  0.07 106   Ana</code></pre>
<p></p>
<p></p>
<div class="sourceCode" id="cb685"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb685-1"><a href="#cb685-1" aria-hidden="true" tabindex="-1"></a><span class="do">## ------------------------------------------------</span></span>
<span id="cb685-2"><a href="#cb685-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Uma alternativa seria fornecermos uma lista</span></span>
<span id="cb685-3"><a href="#cb685-3" aria-hidden="true" tabindex="-1"></a><span class="do">## contendo as tabelas a serem unidas:</span></span>
<span id="cb685-4"><a href="#cb685-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb685-5"><a href="#cb685-5" aria-hidden="true" tabindex="-1"></a>lista <span class="ot">&lt;-</span> <span class="fu">list</span>(tab1, tab2)</span>
<span id="cb685-6"><a href="#cb685-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb685-7"><a href="#cb685-7" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_cols</span>(lista)</span></code></pre></div>
<p></p>
</div>
<div id="exercícios-3" class="section level2 unnumbered">
<h2 class="unnumbered">Exercícios</h2>
<p>Uma excelente forma de exercitar os conhecimentos adquiridos nesse capítulo é simplesmente brincar com bases de dados diferentes! Simplesmente, brinque! Tente encontrar fatos curiosos sobre cada base de dados. Faça perguntas (quantas pessoas se encaixam nessa categoria? Quantas mensagens foram enviadas durante esse dia? Qual é o custo médio de um curso de Medicina nos EUA?) e tente respondê-las com as funções que você descobriu nesse capítulo.</p>
<p>Por isso, a maioria dos exercícios a seguir são exercícios práticos, que pedem por uma informação específica a respeito dos dados contidos em uma determinada tabela (isto é, um <code>data.frame</code>). Para chegar a essa informação, você pode utilizar as funções do pacote <code>dplyr</code>. O código necessário para ter acesso a cada uma dessas tabelas será fornecido em cada questão.</p>
<p>O projeto <a href="https://github.com/rfordatascience/tidytuesday">TidyTuesday</a> é um ótimo lugar para encontrarmos diferentes bases de dados. Pois todas essas bases estão hospedadas na pasta do projeto no GitHub, e grande parte delas estão guardadas em arquivos de texto (<code>.txt</code>, <code>.csv</code>, <code>.fwf</code>, etc.), os quais podemos ler e importar diretamente da página do GitHub para o R, sem a necessidade de baixar arquivos manualmente. Em resumo, o Tidy Tuesday é um projeto onde os integrantes disponibilizam toda semana, uma base de dados diferente. Qualquer pessoa pode submeter uma base de dados para o projeto, incluindo ou não, artigos e materiais que possam instruir os usuários sobre como analisar e compreender os dados contidos nessa base.</p>
<p><strong>Questão 4.1.</strong> Antes de partirmos para as questões práticas, vamos exercitar o seu conhecimento sobre cada função mostrada nesse capítulo. Em cada item abaixo, eu forneço um conjunto de comandos. Cada conjunto inclui funções do pacote <code>dplyr</code> (como <code>filter()</code>, <code>mutate()</code>, <code>group_by()</code>, etc.) e uma tabela específica logo no início dessa cadeia de comandos, além do operador <em>pipe</em> (<code>%&gt;%</code>) conectando cada uma das funções aplicadas. Seu trabalho é ler esse conjunto de comandos, e descrever mentalmente (ou escrever em algum papel) o que cada uma das funções aplicadas estão fazendo nessa cadeia. Em outras palavras, seu objetivo é descrever o papel que cada função desempenha nessa cadeia de comandos.</p>
<p>4.1.A) Descreva os comandos abaixo:</p>
<p></p>
<div class="sourceCode" id="cb686"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb686-1"><a href="#cb686-1" aria-hidden="true" tabindex="-1"></a>starwars <span class="sc">%&gt;%</span> </span>
<span id="cb686-2"><a href="#cb686-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(sex, eye_color) <span class="sc">%&gt;%</span> </span>
<span id="cb686-3"><a href="#cb686-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(sex <span class="sc">==</span> <span class="st">&quot;male&quot;</span>, eye_color <span class="sc">==</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p></p>
<p>4.1.B) Descreva os comandos abaixo:</p>
<p></p>
<div class="sourceCode" id="cb687"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb687-1"><a href="#cb687-1" aria-hidden="true" tabindex="-1"></a>vec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;species&quot;</span>, <span class="st">&quot;homeworld&quot;</span>, <span class="st">&quot;films&quot;</span>, <span class="st">&quot;vehicles&quot;</span>, <span class="st">&quot;starships&quot;</span>)</span>
<span id="cb687-2"><a href="#cb687-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb687-3"><a href="#cb687-3" aria-hidden="true" tabindex="-1"></a>starwars <span class="sc">%&gt;%</span> </span>
<span id="cb687-4"><a href="#cb687-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">all_of</span>(vec)) <span class="sc">%&gt;%</span> </span>
<span id="cb687-5"><a href="#cb687-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(sex) <span class="sc">%&gt;%</span> </span>
<span id="cb687-6"><a href="#cb687-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">peso_medio =</span> <span class="fu">mean</span>(mass, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
<p></p>
<p>4.1.C) Descreva os comandos abaixo:</p>
<p></p>
<div class="sourceCode" id="cb688"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb688-1"><a href="#cb688-1" aria-hidden="true" tabindex="-1"></a>mpg <span class="sc">%&gt;%</span> </span>
<span id="cb688-2"><a href="#cb688-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb688-3"><a href="#cb688-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">pais_origem =</span> <span class="fu">case_when</span>(</span>
<span id="cb688-4"><a href="#cb688-4" aria-hidden="true" tabindex="-1"></a>      manufacturer <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;audi&quot;</span>, <span class="st">&quot;volkswagen&quot;</span>) <span class="sc">~</span> <span class="st">&quot;Alemanha&quot;</span>,</span>
<span id="cb688-5"><a href="#cb688-5" aria-hidden="true" tabindex="-1"></a>      manufacturer <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;nissan&quot;</span>, <span class="st">&quot;honda&quot;</span>,</span>
<span id="cb688-6"><a href="#cb688-6" aria-hidden="true" tabindex="-1"></a>                          <span class="st">&quot;subaru&quot;</span>, <span class="st">&quot;toyota&quot;</span>) <span class="sc">~</span> <span class="st">&quot;Japão&quot;</span>,</span>
<span id="cb688-7"><a href="#cb688-7" aria-hidden="true" tabindex="-1"></a>      manufacturer <span class="sc">==</span> <span class="st">&quot;hyundai&quot;</span> <span class="sc">~</span> <span class="st">&quot;Coréia do Sul&quot;</span>,</span>
<span id="cb688-8"><a href="#cb688-8" aria-hidden="true" tabindex="-1"></a>      manufacturer <span class="sc">==</span> <span class="st">&quot;land rover&quot;</span> <span class="sc">~</span> <span class="st">&quot;Inglaterra&quot;</span>,</span>
<span id="cb688-9"><a href="#cb688-9" aria-hidden="true" tabindex="-1"></a>      manufacturer <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;dodge&quot;</span>, <span class="st">&quot;jeep&quot;</span>, </span>
<span id="cb688-10"><a href="#cb688-10" aria-hidden="true" tabindex="-1"></a>                          <span class="st">&quot;chevrolet&quot;</span>, <span class="st">&quot;ford&quot;</span>,</span>
<span id="cb688-11"><a href="#cb688-11" aria-hidden="true" tabindex="-1"></a>                          <span class="st">&quot;lincoln&quot;</span>, <span class="st">&quot;pontiac&quot;</span>,</span>
<span id="cb688-12"><a href="#cb688-12" aria-hidden="true" tabindex="-1"></a>                          <span class="st">&quot;mercury&quot;</span>) <span class="sc">~</span> <span class="st">&quot;EUA&quot;</span></span>
<span id="cb688-13"><a href="#cb688-13" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb688-14"><a href="#cb688-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb688-15"><a href="#cb688-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(pais_origem) <span class="sc">%&gt;%</span> </span>
<span id="cb688-16"><a href="#cb688-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb688-17"><a href="#cb688-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">prop =</span> ( n <span class="sc">*</span> <span class="dv">100</span> ) <span class="sc">/</span> <span class="fu">sum</span>(n)</span>
<span id="cb688-18"><a href="#cb688-18" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p></p>
<p><strong>Questão 4.2.</strong> Vamos começar pela base <code>tuition_income.csv</code>, referente a semana 11 do TidyTuesday em 2020. Com os comandos abaixo, você pode rapidamente importar essa base de dados para o seu R. Os dados contidos nessa base, descrevem um conjunto de universidades dos Estados Unidos durante o período de 2010 a 2018, e oferecendo informações como: nome da faculdade/universidade (<code>name</code>); estado em que ela se encontra (<code>state</code>); preço ou custo total (em dólares) exigido pela graduação na instituição (<code>total_price</code>); ano ao qual os valores se referem (<code>year</code>); fica localizada dentro do campus ou fora dele? (<code>campus</code>); custo total líquido (custo total menos bolsas de auxílio e prêmios) pago pela graduação na instituição (<code>net_cost</code>).</p>
<p></p>
<div class="sourceCode" id="cb689"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb689-1"><a href="#cb689-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb689-2"><a href="#cb689-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb689-3"><a href="#cb689-3" aria-hidden="true" tabindex="-1"></a>github <span class="ot">&lt;-</span> <span class="st">&quot;https://raw.githubusercontent.com/rfordatascience/&quot;</span></span>
<span id="cb689-4"><a href="#cb689-4" aria-hidden="true" tabindex="-1"></a>arquivo <span class="ot">&lt;-</span> <span class="st">&quot;tidytuesday/master/data/2020/2020-03-10/tuition_income.csv&quot;</span></span>
<span id="cb689-5"><a href="#cb689-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb689-6"><a href="#cb689-6" aria-hidden="true" tabindex="-1"></a>dados <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">paste0</span>(github, arquivo))</span></code></pre></div>
<p></p>
<p>4.2.A) Com esses dados em mão, tente descobrir as 10 universidades que sofreram os maiores aumentos de preços durante o período descrito na base.</p>
<p>4.2.B) Dado que você descubra a universidade que sofreu o maior aumento de preço dentre as 10 universidades descritas no item anterior, procure pelos dados dessa universidade ao longo da base. Com esses dados, discuta o momento em que houve a variação. Não tem resposta certa ou errada, apenas encontre os dados dessa universidade na base, e dê sua opinião sobre tamanha variação no preço dessa universidade.</p>
<p><strong>Questão 4.3.</strong> Caso você tenha chamado pelo pacote <code>dplyr</code> com sucesso em sua sessão, através do comando <code>library()</code>, você tem acesso à tabela <code>starwars</code>, que é utilizada nessa questão. Tendo a tabela <code>starwars</code> em mãos, da coluna 1 até a coluna 11, descubra qual a coluna do tipo <code>character</code> que possui o maior número de valores únicos (ou o maior número de “grupos”) ao longo da base.</p>
<p></p>
<div class="sourceCode" id="cb690"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb690-1"><a href="#cb690-1" aria-hidden="true" tabindex="-1"></a>starwars</span></code></pre></div>
<pre><code>## # A tibble: 87 x 14
##    name      height  mass hair_color  skin_color eye_color birth_year sex  
##    &lt;chr&gt;      &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;
##  1 Luke Sky~    172    77 blond       fair       blue            19   male 
##  2 C-3PO        167    75 &lt;NA&gt;        gold       yellow         112   none 
##  3 R2-D2         96    32 &lt;NA&gt;        white, bl~ red             33   none 
##  4 Darth Va~    202   136 none        white      yellow          41.9 male 
##  5 Leia Org~    150    49 brown       light      brown           19   fema~
##  6 Owen Lars    178   120 brown, grey light      blue            52   male 
##  7 Beru Whi~    165    75 brown       light      blue            47   fema~
##  8 R5-D4         97    32 &lt;NA&gt;        white, red red             NA   none 
##  9 Biggs Da~    183    84 black       light      brown           24   male 
## 10 Obi-Wan ~    182    77 auburn, wh~ fair       blue-gray       57   male 
## # ... with 77 more rows, and 6 more variables: gender &lt;chr&gt;,
## #   homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;, vehicles &lt;list&gt;,
## #   starships &lt;list&gt;</code></pre>
<p></p>
<p><strong>Questão 4.4.</strong> Vamos agora, voltar rapidamente para a base de dados <code>transf</code> que visitamos ao longo deste capítulo. Lembre-se que você pode importar essa base diretamente para o seu R, ao copiar e colar os comandos abaixo.</p>
<p></p>
<div class="sourceCode" id="cb692"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb692-1"><a href="#cb692-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb692-2"><a href="#cb692-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb692-3"><a href="#cb692-3" aria-hidden="true" tabindex="-1"></a>github <span class="ot">&lt;-</span> <span class="st">&quot;https://raw.githubusercontent.com/pedropark99/&quot;</span></span>
<span id="cb692-4"><a href="#cb692-4" aria-hidden="true" tabindex="-1"></a>pasta <span class="ot">&lt;-</span> <span class="st">&quot;Curso-R/master/Dados/&quot;</span></span>
<span id="cb692-5"><a href="#cb692-5" aria-hidden="true" tabindex="-1"></a>arquivo <span class="ot">&lt;-</span> <span class="st">&quot;transf_reform.csv&quot;</span></span>
<span id="cb692-6"><a href="#cb692-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb692-7"><a href="#cb692-7" aria-hidden="true" tabindex="-1"></a>transf <span class="ot">&lt;-</span> <span class="fu">read_csv2</span>(<span class="fu">paste0</span>(github, pasta, arquivo))</span></code></pre></div>
<p></p>
<p>4.4.A) Qual é a receita média que o atendente Eduardo realiza com transferências destinadas à Alemanha?</p>
<p>4.4.B) Qual é o país de destino com o qual a atendente Ana mais trabalha?</p>
<p>4.4.C) Descubra quais foram as últimas transferências executadas por cada um dos 8 atendentes presentes em <code>transf</code>. Lembre-se que a coluna <code>Data</code> fornece o ponto do tempo em que a transferência foi executada.</p>
<!--chapter:end:04-transformacao.Rmd-->
</div>
</div>
<div id="introdução-a-base-de-dados-relacionais-com-dplyr" class="section level1" number="6">
<h1 number="6"><span class="header-section-number">6</span> Introdução a base de dados relacionais com <code>dplyr</code></h1>
<div id="introdução-e-pré-requisitos-1" class="section level2" number="6.1">
<h2 number="6.1"><span class="header-section-number">6.1</span> Introdução e pré-requisitos</h2>
<p>Segundo <span class="citation"><a href="#ref-nield2016" role="doc-biblioref">Nield</a> (<a href="#ref-nield2016" role="doc-biblioref">2016</a>, p 53)</span>, <em>joins</em> são uma das funcionalidades que definem a linguagem SQL (<em>Structured Query Language</em>). Por isso, <em>joins</em> são um tipo de operação muito relacionado à RDBMS (<em>Relational DataBase Management Systems</em>), que em sua maioria, utilizam a linguagem SQL. Logo, essa seção será muito familiar para aqueles que possuem experiência com essa linguagem.</p>
<p>Para executarmos uma operação de <em>join</em>, os pacotes básicos do R oferecem a função <code>merge()</code>. Entretanto, vamos abordar o pacote <code>dplyr</code> neste capítulo, que também possui funções especializadas neste tipo de operação. Com isso, para ter acesso às funções que vamos mostrar aqui, você pode chamar tanto pelo pacote <code>dplyr</code> quanto pelo <code>tidyverse</code>.</p>
<p></p>
<div class="sourceCode" id="cb693"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb693-1"><a href="#cb693-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb693-2"><a href="#cb693-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code></pre></div>
<p></p>
</div>
<div id="sec:relational_data_keys" class="section level2" number="6.2">
<h2 number="6.2"><span class="header-section-number">6.2</span> Dados relacionais e o conceito de <em>key</em></h2>
<p>Normalmente, trabalhamos com diversas bases de dados diferentes ao mesmo tempo. Pois é muito incomum, que uma única tabela contenha todas as informações das quais necessitamos e, por isso, transportar os dados de uma tabela para outra se torna uma atividade essencial em muitas ocasiões.</p>
<p>Logo, de alguma maneira, os dados presentes nessas diversas tabelas se relacionam entre si. Por exemplo, suponha que você possua uma tabela contendo o PIB dos municípios do estado de Minas Gerais, e uma outra tabela contendo dados demográficos desses mesmos municípios. Se você deseja unir essas duas tabelas em uma só, você precisa de algum mecanismo que possa conectar um valor do município X na tabela A com a linha da tabela B correspondente ao mesmo município X, e através dessa conexão, conduzir o valor da tabela A para esse local específico da tabela B, ou vice-versa. O processo que realiza esse cruzamento entre as informações, e que por fim, mescla ou funde as duas tabelas de acordo com essas conexões, é chamado de <em>join</em>.</p>
<p>Por isso, dizemos que os nossos dados são “relacionais.” Pelo fato de que nós possuímos diversas tabelas que descrevem os mesmos indivíduos, municípios, firmas ou eventos. Mesmo que essas tabelas estejam trazendo variáveis ou informações muito diferentes desses indivíduos, elas possuem essa característica em comum e, com isso, possuem uma relação entre si, e vamos frequentemente nos aproveitar dessa relação para executarmos análises mais completas.</p>
<p>Porém, para transportarmos esses dados de uma tabela a outra, precisamos de alguma chave, ou de algum mecanismo que seja capaz de identificar as relações entre as duas tabelas. Em outras palavras, se temos na tabela A, um valor pertencente ao indivíduo X, e queremos transportar esse valor para a tabela B, nós precisamos de algum meio que possa identificar o local da tabela B que seja referente ao indivíduo X. O mecanismo que permite essa comparação, é o que chamamos de <em>key</em> ou de “chave.”</p>
<p></p>
<div class="sourceCode" id="cb694"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb694-1"><a href="#cb694-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;1943-07-26&quot;</span>, <span class="st">&quot;1940-09-10&quot;</span>, <span class="st">&quot;1942-06-18&quot;</span>, <span class="st">&quot;1943-02-25&quot;</span>, <span class="st">&quot;1940-07-07&quot;</span>)</span>
<span id="cb694-2"><a href="#cb694-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb694-3"><a href="#cb694-3" aria-hidden="true" tabindex="-1"></a>info <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb694-4"><a href="#cb694-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">name =</span> <span class="fu">c</span>(<span class="st">&quot;Mick&quot;</span>, <span class="st">&quot;John&quot;</span>, <span class="st">&quot;Paul&quot;</span>, <span class="st">&quot;George&quot;</span>, <span class="st">&quot;Ringo&quot;</span>),</span>
<span id="cb694-5"><a href="#cb694-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">band =</span> <span class="fu">c</span>(<span class="st">&quot;Rolling Stones&quot;</span>, <span class="st">&quot;Beatles&quot;</span>, <span class="st">&quot;Beatles&quot;</span>, <span class="st">&quot;Beatles&quot;</span>, <span class="st">&quot;Beatles&quot;</span>),</span>
<span id="cb694-6"><a href="#cb694-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">born =</span> <span class="fu">as.Date</span>(d),</span>
<span id="cb694-7"><a href="#cb694-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">children =</span> <span class="fu">c</span>(<span class="cn">TRUE</span>)</span>
<span id="cb694-8"><a href="#cb694-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb694-9"><a href="#cb694-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb694-10"><a href="#cb694-10" aria-hidden="true" tabindex="-1"></a>band_instruments <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb694-11"><a href="#cb694-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">name =</span> <span class="fu">c</span>(<span class="st">&quot;John&quot;</span>, <span class="st">&quot;Paul&quot;</span>, <span class="st">&quot;Keith&quot;</span>),</span>
<span id="cb694-12"><a href="#cb694-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">plays =</span> <span class="fu">c</span>(<span class="st">&quot;guitar&quot;</span>, <span class="st">&quot;bass&quot;</span>, <span class="st">&quot;guitar&quot;</span>)</span>
<span id="cb694-13"><a href="#cb694-13" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p></p>
<p>Como exemplo inicial, vamos utilizar a tabela <code>info</code>, que descreve características pessoais de um conjunto de músicos famosos. Também temos a tabela <code>band_instruments</code>, que apenas indica qual o instrumento musical utilizado por parte dos músicos descritos na tabela <code>info</code>.</p>
<p></p>
<div class="sourceCode" id="cb695"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb695-1"><a href="#cb695-1" aria-hidden="true" tabindex="-1"></a>info</span></code></pre></div>
<pre><code>## # A tibble: 5 x 4
##   name   band           born       children
##   &lt;chr&gt;  &lt;chr&gt;          &lt;date&gt;     &lt;lgl&gt;   
## 1 Mick   Rolling Stones 1943-07-26 TRUE    
## 2 John   Beatles        1940-09-10 TRUE    
## 3 Paul   Beatles        1942-06-18 TRUE    
## 4 George Beatles        1943-02-25 TRUE    
## 5 Ringo  Beatles        1940-07-07 TRUE</code></pre>
<div class="sourceCode" id="cb697"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb697-1"><a href="#cb697-1" aria-hidden="true" tabindex="-1"></a>band_instruments</span></code></pre></div>
<pre><code>## # A tibble: 3 x 2
##   name  plays 
##   &lt;chr&gt; &lt;chr&gt; 
## 1 John  guitar
## 2 Paul  bass  
## 3 Keith guitar</code></pre>
<p></p>
<p>Portanto, precisamos de uma <em>key</em> para detectarmos as relações entre as tabelas <code>info</code> e <code>band_instruments</code>. Uma <em>key</em> consiste em uma variável (ou um conjunto de variáveis), que é capaz de identificar unicamente cada indivíduo descrito em uma tabela, sendo que essa variável (ou esse conjunto de variáveis), deve obrigatoriamente estar presente em ambas as tabelas em que desejamos aplicar o <em>join</em>. Dessa forma, podemos através dessa variável, discernir quais indivíduos estão presentes nas duas tabelas, e quais se encontram em apenas uma delas.</p>
<p>Ao observar as tabelas <code>info</code> e <code>band_instruments</code>, você talvez perceba que ambas possuem uma coluna denominada <code>name</code>. No nosso caso, essa é a coluna que representa a <em>key</em> entre as tabelas <code>info</code> e <code>band_instruments</code>. Logo, ao identificar o músico que está sendo tratado em cada linha, a coluna <code>name</code> nos permite cruzar as informações existentes em ambas tabelas. Com isso, podemos observar que os músicos John e Paul, estão disponíveis em ambas as tabelas, mas os músicos Mick, George e Ringo estão descritos apenas na tabela <code>info</code>, enquanto o músico Keith se encontra apenas na tabela <code>band_instruments</code>.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/keys_comparacao.png" alt="Cruzamento entre as tabelas `info` e \texttt{band\_instruments}" width="100%" />
<p class="caption">
(#fig:unnamed-chunk-354)Cruzamento entre as tabelas <code>info</code> e 
</p>
</div>
<p></p>
<p>Segundo <span class="citation"><a href="#ref-nield2016" role="doc-biblioref">Nield</a> (<a href="#ref-nield2016" role="doc-biblioref">2016</a>)</span>, podemos ter dois tipos de <em>keys</em> existentes em uma tabela:</p>
<ol style="list-style-type: decimal">
<li><p><em>Primary key</em>: uma variável capaz de identificar unicamente cada uma das observações presentes em sua tabela.</p></li>
<li><p><em>Foreign key</em>: uma variável capaz de identificar unicamente cada uma das observações presentes em uma outra tabela.</p></li>
</ol>
<p>Com essas características em mente, podemos afirmar que a coluna <code>name</code> existente nas tabelas <code>info</code> e <code>band_instruments</code>, se trata de uma <em>primary key</em>. Pois em ambas as tabelas, mais especificamente em cada linha dessa coluna, temos um músico diferente, ou em outras palavras, não há um músico duplicado.</p>
<p>Por outro lado, uma <em>foreign key</em> normalmente contém valores repetidos ao longo da base e, por essa razão, não são capazes de identificar unicamente uma observação na tabela em que se encontram. Porém, os valores de uma <em>foreign key</em> certamente fazem referência a uma <em>primary key</em> existente em uma outra tabela. Tendo isso em mente, o objetivo de uma <em>foreign key</em> não é o de identificar cada observação presente em uma tabela, mas sim, de indicar ou explicitar a relação que a sua tabela possui com a <em>primary key</em> presente em uma outra tabela.</p>
<p>Por exemplo, suponha que eu tenha a tabela <code>children</code> abaixo. Essa tabela descreve os filhos de alguns músicos famosos, e a coluna <code>father</code> caracteriza-se como a <em>foreign key</em> dessa tabela. Não apenas porque os valores da coluna <code>father</code> se repetem ao longo da base, mas também, porque essa coluna pode ser claramente cruzada com a coluna <code>name</code> pertencente às tabelas <code>info</code> e <code>band_instruments</code>.</p>
<p></p>
<div class="sourceCode" id="cb699"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb699-1"><a href="#cb699-1" aria-hidden="true" tabindex="-1"></a>children <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb699-2"><a href="#cb699-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">child =</span> <span class="fu">c</span>(<span class="st">&quot;Stella&quot;</span>, <span class="st">&quot;Beatrice&quot;</span>, <span class="st">&quot;James&quot;</span>, <span class="st">&quot;Mary&quot;</span>,</span>
<span id="cb699-3"><a href="#cb699-3" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;Heather&quot;</span>, <span class="st">&quot;Sean&quot;</span>, <span class="st">&quot;Julian&quot;</span>, <span class="st">&quot;Zak&quot;</span>,</span>
<span id="cb699-4"><a href="#cb699-4" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;Lee&quot;</span>, <span class="st">&quot;Jason&quot;</span>, <span class="st">&quot;Dhani&quot;</span>),</span>
<span id="cb699-5"><a href="#cb699-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">sex =</span> <span class="fu">c</span>(<span class="st">&quot;F&quot;</span>, <span class="st">&quot;F&quot;</span>, <span class="st">&quot;M&quot;</span>, <span class="st">&quot;F&quot;</span>, <span class="st">&quot;F&quot;</span>, <span class="st">&quot;M&quot;</span>, <span class="st">&quot;M&quot;</span>, <span class="st">&quot;M&quot;</span>, <span class="st">&quot;F&quot;</span>, <span class="st">&quot;M&quot;</span>, <span class="st">&quot;M&quot;</span>),</span>
<span id="cb699-6"><a href="#cb699-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">father =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">&quot;Paul&quot;</span>, <span class="at">times =</span> <span class="dv">5</span>), <span class="st">&quot;John&quot;</span>, <span class="st">&quot;John&quot;</span>,</span>
<span id="cb699-7"><a href="#cb699-7" aria-hidden="true" tabindex="-1"></a>             <span class="fu">rep</span>(<span class="st">&quot;Ringo&quot;</span>, <span class="at">times =</span> <span class="dv">3</span>), <span class="st">&quot;Harrison&quot;</span>)</span>
<span id="cb699-8"><a href="#cb699-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb699-9"><a href="#cb699-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb699-10"><a href="#cb699-10" aria-hidden="true" tabindex="-1"></a>children</span></code></pre></div>
<pre><code>## # A tibble: 11 x 3
##    child    sex   father  
##    &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;   
##  1 Stella   F     Paul    
##  2 Beatrice F     Paul    
##  3 James    M     Paul    
##  4 Mary     F     Paul    
##  5 Heather  F     Paul    
##  6 Sean     M     John    
##  7 Julian   M     John    
##  8 Zak      M     Ringo   
##  9 Lee      F     Ringo   
## 10 Jason    M     Ringo   
## 11 Dhani    M     Harrison</code></pre>
<p></p>
</div>
<div id="introduzindo-joins" class="section level2" number="6.3">
<h2 number="6.3"><span class="header-section-number">6.3</span> Introduzindo <em>joins</em></h2>
<p>Tendo esses pontos em mente, o pacote <code>dplyr</code> nos oferece quatro funções voltadas para operações de <em>join</em>. Cada uma dessas funções executam um tipo de <em>join</em> diferente, que vamos comentar na próxima seção. Por agora, vamos focar apenas na função <code>inner_join()</code>, que como o seu próprio nome dá a entender, busca aplicar um <em>inner join</em>.</p>
<p>Para utilizar essa função, precisamos nos preocupar com três argumentos principais. Os dois primeiros argumentos (<code>x</code> e <code>y</code>), definem os <code>data.frame</code>’s a serem fundidos pela função. Já no terceiro argumento (<code>by</code>), você deve delimitar a coluna, ou o conjunto de colunas que representam a <em>key</em> entre as tabelas fornecidas em <code>x</code> e <code>y</code>.</p>
<p>Assim como em qualquer outro tipo de <em>join</em>, as duas tabelas envolvidas serão unidas, porém, em um <em>inner join</em>, apenas as linhas de indivíduos que se encontram em ambas as tabelas serão retornadas na nova tabela gerada. Perceba abaixo, que a função <code>inner_join()</code> criou uma nova tabela contendo todas as colunas presentes nas tabelas <code>info</code> e <code>band_instruments</code> como esperávamos, e que ela manteve apenas as linhas referentes aos músicos John e Paul, que são os únicos indivíduos que aparecem em ambas as tabelas.</p>
<p></p>
<div class="sourceCode" id="cb701"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb701-1"><a href="#cb701-1" aria-hidden="true" tabindex="-1"></a><span class="fu">inner_join</span>(info, band_instruments, <span class="at">by =</span> <span class="st">&quot;name&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 2 x 5
##   name  band    born       children plays 
##   &lt;chr&gt; &lt;chr&gt;   &lt;date&gt;     &lt;lgl&gt;    &lt;chr&gt; 
## 1 John  Beatles 1940-09-10 TRUE     guitar
## 2 Paul  Beatles 1942-06-18 TRUE     bass</code></pre>
<p></p>
<p></p>
<div class="sourceCode" id="cb703"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb703-1"><a href="#cb703-1" aria-hidden="true" tabindex="-1"></a><span class="do">## -----------------------------------------------</span></span>
<span id="cb703-2"><a href="#cb703-2" aria-hidden="true" tabindex="-1"></a><span class="do">## A mesma operação com o uso do pipe ( %&gt;% ):</span></span>
<span id="cb703-3"><a href="#cb703-3" aria-hidden="true" tabindex="-1"></a>info <span class="sc">%&gt;%</span> </span>
<span id="cb703-4"><a href="#cb703-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(band_instruments, <span class="at">by =</span> <span class="st">&quot;name&quot;</span>)</span></code></pre></div>
<p></p>
<p>Ao observar esse resultado, você talvez chegue à conclusão de que um processo de <em>join</em> se trata do mesmo processo executado pela função <code>PROCV()</code> do Excel. Essa é uma ótima comparação! Pois a função <code>PROCV()</code> realiza justamente um <em>join</em> parcial, ao trazer para a tabela A, uma coluna pertencente a tabela B, de acordo com uma <em>key</em> que conecta as duas tabelas.</p>
<p>Por outro lado, nós não podemos afirmar que a função <code>PROCV()</code> busca construir um <em>join per se</em>. Pois um <em>join</em> consiste em um processo de união, em que estamos literalmente fundindo duas tabelas em uma só. Já a função <code>PROCV()</code>, é capaz de transportar apenas uma única coluna por tabela, logo, não é de sua filosofia, fundir as tabelas envolvidas. Por isso, se temos cinco colunas em uma tabela A, as quais desejamos levar até a tabela B, nós precisamos de cinco <code>PROCV()</code>’s diferentes no Excel, enquanto no R, precisamos de apenas um <code>inner_join()</code> para realizarmos tal ação.</p>
<p>Por último, vale destacar uma característica muito importante de um <em>join</em>, que é o seu processo de pareamento. Devido a essa característica, a ordem das linhas presentes em ambas as tabelas se torna irrelevante para o resultado. Por exemplo, veja na figura 6.2, um exemplo de <em>join</em>, onde a coluna <code>ID</code> representa a <em>key</em> entre as duas tabelas. Repare que as linhas na tabela à esquerda que se referem, por exemplo, aos indivíduos de ID 105, 107 e 108, se encontram em linhas diferentes na tabela à direita. Mesmo que esses indivíduos estejam em locais diferentes, a função responsável pelo <em>join</em>, vai realizar um pareamento entre as duas tabelas, antes de fundi-las. Dessa maneira, podemos nos certificar que as informações de cada indivíduo são corretamente posicionadas na tabela resultante.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/pareamento1.png" alt="Representação de um join entre duas tabelas" width="100%" />
<p class="caption">
(#fig:unnamed-chunk-358)Representação de um join entre duas tabelas
</p>
</div>
<p></p>
</div>
<div id="sec:config_colunas_keys" class="section level2" number="6.4">
<h2 number="6.4"><span class="header-section-number">6.4</span> Configurações sobre as colunas e <em>keys</em> utilizadas no <em>join</em></h2>
<p>Haverá momentos em que uma única coluna não será o bastante para identificarmos cada observação de nossa base. Por isso, teremos oportunidades em que devemos utilizar a combinação entre várias colunas, com o objetivo de formarmos uma <em>primary key</em> em nossa tabela.</p>
<p>Por exemplo, suponha que você trabalhe diariamente com o registro de entradas no estoque de um supermercado. Imagine que você possua a tabela <code>registro</code> abaixo, que contém dados da seção de bebidas do estoque, e que apresentam o <code>dia</code> e <code>mes</code> em que uma determinada carga chegou ao estoque da empresa, além de uma descrição de seu conteúdo (<code>descricao</code>), seu valor de compra (<code>valor</code>) e as unidades inclusas (<code>unidades</code>).</p>
<p></p>
<div class="sourceCode" id="cb704"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb704-1"><a href="#cb704-1" aria-hidden="true" tabindex="-1"></a>registro <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb704-2"><a href="#cb704-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">dia =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">18</span>, <span class="dv">18</span>, <span class="dv">25</span>, <span class="dv">25</span>),</span>
<span id="cb704-3"><a href="#cb704-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">mes =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>),</span>
<span id="cb704-4"><a href="#cb704-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">ano =</span> <span class="dv">2020</span>,</span>
<span id="cb704-5"><a href="#cb704-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">unidades =</span> <span class="fu">c</span>(<span class="dv">410</span>, <span class="dv">325</span>, <span class="dv">325</span>, <span class="dv">400</span>, <span class="dv">50</span>),</span>
<span id="cb704-6"><a href="#cb704-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">valor =</span> <span class="fu">c</span>(<span class="dv">450</span>, <span class="dv">1400</span>, <span class="dv">1150</span>, <span class="dv">670</span>, <span class="dv">2490</span>),</span>
<span id="cb704-7"><a href="#cb704-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">descricao =</span> <span class="fu">c</span>(<span class="st">&quot;Fanta Laranja 350ml&quot;</span>, </span>
<span id="cb704-8"><a href="#cb704-8" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;Coca Cola 2L&quot;</span>, <span class="st">&quot;Mate Couro 2L&quot;</span>,</span>
<span id="cb704-9"><a href="#cb704-9" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;Kapo Uva 200ml&quot;</span>, <span class="st">&quot;Absolut Vodka 1L&quot;</span>)</span>
<span id="cb704-10"><a href="#cb704-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb704-11"><a href="#cb704-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb704-12"><a href="#cb704-12" aria-hidden="true" tabindex="-1"></a>registro</span></code></pre></div>
<pre><code>## # A tibble: 5 x 6
##     dia   mes   ano unidades valor descricao          
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;              
## 1     3     2  2020      410   450 Fanta Laranja 350ml
## 2    18     2  2020      325  1400 Coca Cola 2L       
## 3    18     2  2020      325  1150 Mate Couro 2L      
## 4    25     2  2020      400   670 Kapo Uva 200ml     
## 5    25     3  2020       50  2490 Absolut Vodka 1L</code></pre>
<p></p>
<p>Nessa tabela, as colunas <code>dia</code>, <code>mes</code>, <code>ano</code>, <code>valor</code>, <code>unidades</code> e <code>descricao</code>, sozinhas, são insuficientes para identificarmos cada carga registrada na tabela. Mesmo que, <strong>atualmente</strong>, cada valor presente na coluna <code>descricao</code> seja único, essa característica provavelmente não vai resistir por muito tempo. Pois o supermercado pode muito bem receber amanhã, por exemplo, uma outra carga de refrigerantes de 2 litros da Mate Couro.</p>
<p>Por outro lado, a combinação dos valores presentes nas colunas <code>dia</code>, <code>mes</code>, <code>ano</code>, <code>valor</code>, <code>unidades</code> e <code>descricao</code>, pode ser o suficiente para criarmos um código de identificação único para cada carga. Por exemplo, ao voltarmos à tabela <code>registro</code>, podemos encontrar duas cargas que chegaram no mesmo dia 18, no mesmo mês 2, no mesmo ano de 2020, e trazendo as mesmas 325 unidades. Todavia, essas duas cargas, possuem descrições diferentes: uma delas incluía garrafas preenchidas com Coca Cola, enquanto a outra, continha Mate Couro. Concluindo, ao aliarmos as informações referentes a data de entrada (18/02/2020), as quantidades inclusas nas cargas (325 unidades), e as suas descrições (Coca Cola 2L e Mate Couro 2L), podemos enfim diferenciar essas duas cargas:</p>
<ol style="list-style-type: decimal">
<li><p>Uma carga que entrou no dia 18/02/2020, incluía 325 unidades de 2 litros de Coca Cola.</p></li>
<li><p>Uma carga que entrou no dia 18/02/2020, incluía 325 unidades de 2 litros de Mate Couro.</p></li>
</ol>
<p>Como um outro exemplo, podemos utilizar as bases <code>flights</code> e <code>weather</code>, provenientes do pacote <code>nycflights13</code>. Perceba abaixo, que a base <code>flights</code> já possui um número grande colunas. Essa tabela apresenta dados diários, referentes a diversos voos que partiram da cidade de Nova York (EUA) durante o ano de 2013. Já a tabela <code>weather</code>, contém dados meteorológicos em uma dada hora, e em diversas datas do mesmo ano, e que foram especificamente coletados nos aeroportos da mesma cidade de Nova York.</p>
<p></p>
<div class="sourceCode" id="cb706"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb706-1"><a href="#cb706-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(nycflights13)</span></code></pre></div>
<p></p>
<p></p>
<div class="sourceCode" id="cb707"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb707-1"><a href="#cb707-1" aria-hidden="true" tabindex="-1"></a>flights</span></code></pre></div>
<pre><code>## # A tibble: 336,776 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;dbl&gt;          &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
##  1  2013     1     1      517            515         2      830
##  2  2013     1     1      533            529         4      850
##  3  2013     1     1      542            540         2      923
##  4  2013     1     1      544            545        -1     1004
##  5  2013     1     1      554            600        -6      812
##  6  2013     1     1      554            558        -4      740
##  7  2013     1     1      555            600        -5      913
##  8  2013     1     1      557            600        -3      709
##  9  2013     1     1      557            600        -3      838
## 10  2013     1     1      558            600        -2      753
## # ... with 336,766 more rows, and 12 more variables: sched_arr_time &lt;dbl&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;dbl&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<div class="sourceCode" id="cb709"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb709-1"><a href="#cb709-1" aria-hidden="true" tabindex="-1"></a>weather</span></code></pre></div>
<pre><code>## # A tibble: 26,115 x 15
##    origin  year month   day  hour  temp  dewp humid wind_dir wind_speed
##    &lt;chr&gt;  &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;      &lt;dbl&gt;
##  1 EWR     2013     1     1     1  39.0  26.1  59.4      270      10.4 
##  2 EWR     2013     1     1     2  39.0  27.0  61.6      250       8.06
##  3 EWR     2013     1     1     3  39.0  28.0  64.4      240      11.5 
##  4 EWR     2013     1     1     4  39.9  28.0  62.2      250      12.7 
##  5 EWR     2013     1     1     5  39.0  28.0  64.4      260      12.7 
##  6 EWR     2013     1     1     6  37.9  28.0  67.2      240      11.5 
##  7 EWR     2013     1     1     7  39.0  28.0  64.4      240      15.0 
##  8 EWR     2013     1     1     8  39.9  28.0  62.2      250      10.4 
##  9 EWR     2013     1     1     9  39.9  28.0  62.2      260      15.0 
## 10 EWR     2013     1     1    10  41    28.0  59.6      260      13.8 
## # ... with 26,105 more rows, and 5 more variables: wind_gust &lt;dbl&gt;,
## #   precip &lt;dbl&gt;, pressure &lt;dbl&gt;, visib &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<p></p>
<p>Ao aplicarmos um <em>join</em> entre essas tabelas, poderíamos analisar as características meteorológicas que um determinado avião enfrentou ao levantar voo. Entretanto, necessitaríamos empregar ao menos cinco colunas diferentes para formarmos uma <em>key</em> adequada entre essas tabelas. Pois cada situação meteorológica descrita na tabela <code>weather</code>, ocorre em um uma dada localidade, e em um horário específico de um determinado dia. Com isso, teríamos de utilizar as colunas: <code>year</code>, <code>month</code> e <code>day</code> para identificarmos a data correspondente a cada situação; mais a coluna <code>hour</code> para determinarmos o momento do dia em que essa situação ocorreu; além da coluna <code>origin</code>, que marca o aeroporto de onde cada voo partiu e, portanto, nos fornece uma localização no espaço geográfico para cada situação meteorológica.</p>
<p>Portanto, em todos os momentos em que você precisar utilizar um conjunto de colunas para formar uma <em>key</em>, como o caso das tabelas <code>weather</code> e <code>flights</code> acima, você deve fornecer um vetor contendo o nome dessas colunas para o argumento <code>by</code> da função de <em>join</em> que está utilizando, assim como no exemplo abaixo.</p>
<p></p>
<div class="sourceCode" id="cb711"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb711-1"><a href="#cb711-1" aria-hidden="true" tabindex="-1"></a><span class="fu">inner_join</span>(</span>
<span id="cb711-2"><a href="#cb711-2" aria-hidden="true" tabindex="-1"></a>  flights,</span>
<span id="cb711-3"><a href="#cb711-3" aria-hidden="true" tabindex="-1"></a>  weather,</span>
<span id="cb711-4"><a href="#cb711-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;year&quot;</span>, <span class="st">&quot;month&quot;</span>, <span class="st">&quot;day&quot;</span>, <span class="st">&quot;hour&quot;</span>, <span class="st">&quot;origin&quot;</span>)</span>
<span id="cb711-5"><a href="#cb711-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## # A tibble: 335,220 x 29
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;dbl&gt;          &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
##  1  2013     1     1      517            515         2      830
##  2  2013     1     1      533            529         4      850
##  3  2013     1     1      542            540         2      923
##  4  2013     1     1      544            545        -1     1004
##  5  2013     1     1      554            600        -6      812
##  6  2013     1     1      554            558        -4      740
##  7  2013     1     1      555            600        -5      913
##  8  2013     1     1      557            600        -3      709
##  9  2013     1     1      557            600        -3      838
## 10  2013     1     1      558            600        -2      753
## # ... with 335,210 more rows, and 22 more variables: sched_arr_time &lt;dbl&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;dbl&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour.x &lt;dttm&gt;, temp &lt;dbl&gt;, dewp &lt;dbl&gt;, humid &lt;dbl&gt;,
## #   wind_dir &lt;dbl&gt;, wind_speed &lt;dbl&gt;, wind_gust &lt;dbl&gt;, precip &lt;dbl&gt;,
## #   pressure &lt;dbl&gt;, visib &lt;dbl&gt;, time_hour.y &lt;dttm&gt;</code></pre>
<p></p>
<p>Porém, a tabela <code>flights</code> já possui um número muito grande colunas e, por essa razão, não conseguimos visualizar no resultado do <em>join</em>, as diversas colunas importadas da tabela <code>weather</code>. Sabemos que um <em>join</em> gera, por padrão, uma nova tabela contendo todas as colunas de ambas as tabelas utilizadas. Contudo, o exemplo acima demonstra que em certas ocasiões, o uso de muitas colunas pode sobrecarregar a sua visão e, com isso, dificultar o seu foco no que é de fato importante em sua análise.</p>
<p>Tendo isso em mente, haverá instantes em que você deseja trazer apenas algumas colunas de uma das tabelas envolvidas no <em>join</em>. Mas não há como alterarmos a natureza de um <em>join</em>, logo, todas as colunas de ambas as tabelas serão sempre incluídas em seu resultado. Por isso, o ideal é que você selecione as colunas desejadas de uma das tabelas antes de empregá-las em um <em>join</em>.</p>
<p>Ou seja, ao invés de fornecer a tabela completa à função, você pode utilizar ferramentas como <code>select()</code> ou <em>subsetting</em>, para extrair a parte desejada de uma das tabelas, e fornecer o resultado dessa seleção para a função <code>inner_join()</code>. Entretanto, . De outra forma, não se esqueça de incluir em sua seleção, as colunas que você proveu ao argumento <code>by</code>.</p>
<p>Por exemplo, supondo que você precisasse em seu resultado apenas das colunas <code>dep_time</code> e <code>dep_delay</code> da tabela <code>flights</code>, você poderia fornecer os comandos a seguir:</p>
<p></p>
<div class="sourceCode" id="cb713"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb713-1"><a href="#cb713-1" aria-hidden="true" tabindex="-1"></a>cols_para_key <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb713-2"><a href="#cb713-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;year&quot;</span>, <span class="co"># Coluna 1 para key</span></span>
<span id="cb713-3"><a href="#cb713-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;month&quot;</span>, <span class="co"># Coluna 2 para key </span></span>
<span id="cb713-4"><a href="#cb713-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;day&quot;</span>, <span class="co"># Coluna 3 para key</span></span>
<span id="cb713-5"><a href="#cb713-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;hour&quot;</span>, <span class="co"># Coluna 4 para key</span></span>
<span id="cb713-6"><a href="#cb713-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;origin&quot;</span> <span class="co"># Coluna 5 para key</span></span>
<span id="cb713-7"><a href="#cb713-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb713-8"><a href="#cb713-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb713-9"><a href="#cb713-9" aria-hidden="true" tabindex="-1"></a>cols_desejadas <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;dep_time&quot;</span>, <span class="st">&quot;dep_delay&quot;</span>)</span>
<span id="cb713-10"><a href="#cb713-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb713-11"><a href="#cb713-11" aria-hidden="true" tabindex="-1"></a>cols_c <span class="ot">&lt;-</span> <span class="fu">c</span>(cols_para_key, cols_desejadas)</span>
<span id="cb713-12"><a href="#cb713-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb713-13"><a href="#cb713-13" aria-hidden="true" tabindex="-1"></a><span class="fu">inner_join</span>(</span>
<span id="cb713-14"><a href="#cb713-14" aria-hidden="true" tabindex="-1"></a>  flights <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">all_of</span>(cols_c)),</span>
<span id="cb713-15"><a href="#cb713-15" aria-hidden="true" tabindex="-1"></a>  weather,</span>
<span id="cb713-16"><a href="#cb713-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">by =</span> cols_para_key</span>
<span id="cb713-17"><a href="#cb713-17" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## # A tibble: 335,220 x 17
##     year month   day  hour origin dep_time dep_delay  temp  dewp humid
##    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1  2013     1     1     5 EWR         517         2  39.0  28.0  64.4
##  2  2013     1     1     5 LGA         533         4  39.9  25.0  54.8
##  3  2013     1     1     5 JFK         542         2  39.0  27.0  61.6
##  4  2013     1     1     5 JFK         544        -1  39.0  27.0  61.6
##  5  2013     1     1     6 LGA         554        -6  39.9  25.0  54.8
##  6  2013     1     1     5 EWR         554        -4  39.0  28.0  64.4
##  7  2013     1     1     6 EWR         555        -5  37.9  28.0  67.2
##  8  2013     1     1     6 LGA         557        -3  39.9  25.0  54.8
##  9  2013     1     1     6 JFK         557        -3  37.9  27.0  64.3
## 10  2013     1     1     6 LGA         558        -2  39.9  25.0  54.8
## # ... with 335,210 more rows, and 7 more variables: wind_dir &lt;dbl&gt;,
## #   wind_speed &lt;dbl&gt;, wind_gust &lt;dbl&gt;, precip &lt;dbl&gt;, pressure &lt;dbl&gt;,
## #   visib &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<p></p>
<p></p>
<div class="sourceCode" id="cb715"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb715-1"><a href="#cb715-1" aria-hidden="true" tabindex="-1"></a><span class="do">## ----------------------------------------</span></span>
<span id="cb715-2"><a href="#cb715-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Ou por subsetting:</span></span>
<span id="cb715-3"><a href="#cb715-3" aria-hidden="true" tabindex="-1"></a><span class="fu">inner_join</span>(</span>
<span id="cb715-4"><a href="#cb715-4" aria-hidden="true" tabindex="-1"></a>  flights[ , cols_c],</span>
<span id="cb715-5"><a href="#cb715-5" aria-hidden="true" tabindex="-1"></a>  weather,</span>
<span id="cb715-6"><a href="#cb715-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">by =</span> cols_para_key</span>
<span id="cb715-7"><a href="#cb715-7" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p></p>
<p>Antes de partirmos para a próxima seção, vale a pena comentar sobre um outro aspecto importante em um <em>join</em>. As colunas que formam a sua <em>key</em> <strong>devem estar nomeadas da mesma maneira em ambas as tabelas</strong>. Por exemplo, se nós voltarmos às tabelas <code>info</code> e <code>band_instruments</code>, e renomearmos a coluna <code>name</code> para <code>member</code> em uma das tabelas, um erro será levantado ao tentarmos aplicar novamente um <em>join</em> sobre as tabelas.</p>
<p></p>
<div class="sourceCode" id="cb716"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb716-1"><a href="#cb716-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(band_instruments)[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="st">&quot;member&quot;</span></span>
<span id="cb716-2"><a href="#cb716-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb716-3"><a href="#cb716-3" aria-hidden="true" tabindex="-1"></a><span class="fu">inner_join</span>(info, band_instruments, <span class="at">by =</span> <span class="st">&quot;name&quot;</span>)</span></code></pre></div>
<p></p>
<pre><code>Erro: Join columns must be present in data.
x Problem with `name`.
Run `rlang::last_error()` to see where the error occurred.</code></pre>
<p>Logo, ajustes são necessários sobre o argumento <code>by</code>, de forma a revelarmos para a função responsável pelo <em>join</em>, a existência dessa diferença existente entre os nomes dados às colunas que representam a <em>key</em> entre as tabelas. Fazendo uso dos argumentos <code>x</code> e <code>y</code> como referências, para realizar esse ajuste, você deve igualar o nome dado à coluna da tabela <code>x</code> ao nome dado à coluna correspondente na tabela <code>y</code>, dentro de um vetor - <code>c()</code>, como está demonstrado abaixo.</p>
<p></p>
<div class="sourceCode" id="cb718"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb718-1"><a href="#cb718-1" aria-hidden="true" tabindex="-1"></a><span class="fu">inner_join</span>(info, band_instruments, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;name&quot;</span> <span class="ot">=</span> <span class="st">&quot;member&quot;</span>))</span></code></pre></div>
<pre><code>## # A tibble: 2 x 5
##   name  band    born       children plays 
##   &lt;chr&gt; &lt;chr&gt;   &lt;date&gt;     &lt;lgl&gt;    &lt;chr&gt; 
## 1 John  Beatles 1940-09-10 TRUE     guitar
## 2 Paul  Beatles 1942-06-18 TRUE     bass</code></pre>
<p></p>
</div>
<div id="diferentes-tipos-de-join" class="section level2" number="6.5">
<h2 number="6.5"><span class="header-section-number">6.5</span> Diferentes tipos de <em>join</em></h2>
<p>Portanto, um <em>join</em> busca construir uma união entre duas tabelas. Porém, podemos realizar essa união de diferentes formas, e até o momento, apresentei apenas uma de suas formas, o <em>inner join</em>, que é executado pela função <code>inner_join()</code>. Nesse método, o <em>join</em> mantém apenas as linhas que puderam ser encontradas em ambas as tabelas. Logo, se um indivíduo está presente na tabela A, mas não se encontra na tabela B, esse indivíduo será descartado em um <em>inner join</em> entre as tabelas A e B. Como foi destacado por <span class="citation"><a href="#ref-wickham2017" role="doc-biblioref">Wickham and Grolemund</a> (<a href="#ref-wickham2017" role="doc-biblioref">2017</a>, p 181)</span>, essa característica torna o <em>inner join</em> pouco apropriado para a maioria das análises, pois uma importante perda de observações pode ser facilmente gerada neste processo.</p>
<p>Os demais tipos de <em>joins</em> dos quais podemos nos aproveitar, são comumente chamados de <em>outer joins</em>. Tal nome se deve ao fato de que esses tipos buscam preservar as linhas de pelo menos uma das tabelas envolvidas no <em>join</em> em questão. Sendo eles:</p>
<ol style="list-style-type: decimal">
<li><p><code>left_join()</code>: mantém todas as linhas da tabela definida no argumento <code>x</code>, ou a tabela à esquerda do <em>join</em>, mesmo que os indivíduos descritos nessa tabela não tenham sido encontrados em ambas as tabelas.</p></li>
<li><p><code>right_join()</code>: mantém todas as linhas da tabela definida no argumento <code>y</code>, ou a tabela à direita do <em>join</em>, mesmo que os indivíduos descritos nessa tabela não tenham sido encontrados em ambas as tabelas.</p></li>
<li><p><code>full_join()</code>: mantém todas as linhas de ambas as tabelas definidas nos argumentos <code>x</code> e <code>y</code>, mesmo que os indivíduos de uma dessas tabelas não tenham sido encontrados em ambas as tabelas.</p></li>
</ol>
<p>Em todas as funções de <em>join</em> mostradas aqui, o primeiro argumento é chamado de <code>x</code>, e o segundo, de <code>y</code>, sendo esses os argumentos que definem as duas tabelas a serem utilizadas no <em>join</em>. Simplificadamente, a diferença entre <code>left_join()</code>, <code>right_join()</code> e <code>full_join()</code> reside apenas em quais linhas das tabelas utilizadas, são conservadas por essas funções no produto final do <em>join</em>. Como essas diferenças são simples, as descrições acima já lhe dão uma boa ideia de quais serão as linhas conservadas em cada função. Todavia, darei a seguir, uma visão mais formal desses comportamentos, com o objetivo principal de fornecer uma segunda visão que pode, principalmente, facilitar a sua memorização do que cada função faz.</p>
<p>Para seguir esse caminho, é interessante que você tente interpretar um <em>join</em> a partir de uma perspectiva mais visual e menos minuciosa do processo. Ao aplicarmos um <em>join</em> entre as tabelas A e B, estamos basicamente, extraindo as colunas da tabela B e as adicionando à tabela A (ou vice-versa). Com isso, temos nessa concepção, a <strong>tabela fonte</strong> (isto é, a tabela <strong>de onde</strong> as colunas são retiradas), e a <strong>tabela destinatária</strong> (ou seja, a tabela <strong>para onde</strong> essas colunas são levadas). Portanto, segundo esse ponto de vista, o <em>join</em> possui sentido e direção, assim como um vetor em um espaço tridimensional. Pois o processo sempre parte da tabela fonte em direção a tabela destinatária. Dessa forma, em um <em>join</em>, estamos resumidamente extraindo as colunas da tabela fonte e as incorporando à tabela destinatária.</p>
<p>Com isso, eu quero criar a perspectiva, de que a tabela fonte e a tabela destinatária, ocupam lados do <em>join</em>, como na figura 6.3. Ou seja, por esse ângulo, estamos compreendendo o <em>join</em> como uma operação que ocorre sempre da direita para esquerda, ou um processo em que estamos sempre carregando um conjunto de colunas da tabela à direita em direção a tabela à esquerda. Se mesclarmos essa visão, com as primeiras descrições dos <em>outer joins</em> que fornecemos, temos que o argumento <code>x</code> corresponde a tabela destinatária, e o argumento <code>y</code>, a tabela fonte. Dessa maneira, a tabela destinatária (ou o argumento <code>x</code>) é sempre a tabela que ocupa o lado esquerdo do <em>join</em>, enquanto a tabela fonte (ou o argumento <code>y</code>) sempre se trata da tabela que ocupa o lado direito da operação.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/direita_esquerda.png" alt="As tabelas ocupam lados em um join" width="100%" />
<p class="caption">
(#fig:unnamed-chunk-370)As tabelas ocupam lados em um join
</p>
</div>
<p></p>
<p>Logo, a função <code>left_join()</code> busca manter as linhas da tabela destinatária (ou a tabela que você definiu no argumento <code>x</code> da função) intactas no resultado do <em>join</em>. Isso significa, que caso a função <code>left_join()</code> não encontre na tabela fonte, uma linha que corresponde a um certo indivíduo presente na tabela destinatária, essa linha será mantida no resultado final do <em>join</em>. Porém, como está demonstrado abaixo, em todas as situações em que a função não pôde encontrar esse indivíduo na tabela fonte, <code>left_join()</code> vai preencher as linhas correspondentes nas colunas que ele transferiu dessa tabela, com valores <code>NA</code>, indicando justamente que não há informações daquele respectivo indivíduo na tabela fonte.</p>
<p></p>
<div class="sourceCode" id="cb720"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb720-1"><a href="#cb720-1" aria-hidden="true" tabindex="-1"></a><span class="fu">left_join</span>(info, band_instruments, <span class="at">by =</span> <span class="st">&quot;name&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 5 x 5
##   name   band           born       children plays 
##   &lt;chr&gt;  &lt;chr&gt;          &lt;date&gt;     &lt;lgl&gt;    &lt;chr&gt; 
## 1 Mick   Rolling Stones 1943-07-26 TRUE     &lt;NA&gt;  
## 2 John   Beatles        1940-09-10 TRUE     guitar
## 3 Paul   Beatles        1942-06-18 TRUE     bass  
## 4 George Beatles        1943-02-25 TRUE     &lt;NA&gt;  
## 5 Ringo  Beatles        1940-07-07 TRUE     &lt;NA&gt;</code></pre>
<p></p>
<p>Em contrapartida, a função <code>right_join()</code> realiza justamente o processo contrário, ao manter as linhas da tabela fonte (ou a tabela que você forneceu ao argumento <code>y</code>). Por isso, para todas as linhas da tabela fonte que se referem a um indivíduo não encontrado na tabela destinatária, <code>right_join()</code> acaba preenchendo os campos provenientes da tabela destinatária, com valores <code>NA</code>, indicando assim que a função não conseguiu encontrar mais dados sobre aquele indivíduo na tabela destinatária. Você pode perceber esse comportamento, pela linha referente ao músico Keith, que está disponível na tabela fonte, mas não na tabela destinatária.</p>
<p></p>
<div class="sourceCode" id="cb722"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb722-1"><a href="#cb722-1" aria-hidden="true" tabindex="-1"></a><span class="fu">right_join</span>(info, band_instruments, <span class="at">by =</span> <span class="st">&quot;name&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 3 x 5
##   name  band    born       children plays 
##   &lt;chr&gt; &lt;chr&gt;   &lt;date&gt;     &lt;lgl&gt;    &lt;chr&gt; 
## 1 John  Beatles 1940-09-10 TRUE     guitar
## 2 Paul  Beatles 1942-06-18 TRUE     bass  
## 3 Keith &lt;NA&gt;    NA         NA       guitar</code></pre>
<p></p>
<p>Por fim, a função <code>full_join()</code> executa o processo inverso da função <code>inner_join()</code>. Ou seja, se por um lado, a função <code>inner_join()</code> mantém as linhas de todos os indivíduos que puderam ser localizados em ambas as tabelas, por outro, a função <code>full_join()</code> sempre traz todos os indivíduos de ambas as tabelas em seu resultado. Em outras palavras, a função <code>full_join()</code> mantém todas as linhas de ambas as tabelas. De certa forma, a função <code>full_join()</code> busca encontrar sempre o maior número possível de combinações entre as tabelas, e em todas as ocasiões que <code>full_join()</code> não encontra um determinado indivíduo, por exemplo, na tabela B, a função vai preencher os campos dessa tabela B com valores <code>NA</code> para as linhas desse indivíduo. Veja o exemplo abaixo.</p>
<p></p>
<div class="sourceCode" id="cb724"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb724-1"><a href="#cb724-1" aria-hidden="true" tabindex="-1"></a><span class="fu">full_join</span>(info, band_instruments, <span class="at">by =</span> <span class="st">&quot;name&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 5
##   name   band           born       children plays 
##   &lt;chr&gt;  &lt;chr&gt;          &lt;date&gt;     &lt;lgl&gt;    &lt;chr&gt; 
## 1 Mick   Rolling Stones 1943-07-26 TRUE     &lt;NA&gt;  
## 2 John   Beatles        1940-09-10 TRUE     guitar
## 3 Paul   Beatles        1942-06-18 TRUE     bass  
## 4 George Beatles        1943-02-25 TRUE     &lt;NA&gt;  
## 5 Ringo  Beatles        1940-07-07 TRUE     &lt;NA&gt;  
## 6 Keith  &lt;NA&gt;           NA         NA       guitar</code></pre>
<p></p>
<p>Como o primeiro <code>data.frame</code> fornecido à função <code>*_join()</code>, será na maioria das situações, a sua principal tabela de trabalho, o ideal é que você adote o <code>left_join()</code> como o seu padrão de <em>join</em> <span class="citation">(<a href="#ref-wickham2017" role="doc-biblioref">Wickham and Grolemund 2017</a>)</span>. Pois dessa maneira, você evita uma possível perda de observações em sua tabela mais importante.</p>
</div>
<div id="relações-entre-keys-primary-keys-são-menos-comuns-do-que-você-pensa" class="section level2" number="6.6">
<h2 number="6.6"><span class="header-section-number">6.6</span> Relações entre <em>keys</em>: <em>primary</em> keys são menos comuns do que você pensa</h2>
<p>Na seção <a href="#sec:relational_data_keys">Dados relacionais e o conceito de <em>key</em></a>, nós estabelecemos que variáveis com a capacidade de identificar unicamente cada observação de sua base, podem ser caracterizadas como <em>primary keys</em>. Mas para que essa característica seja verdadeira para uma dada variável, os seus valores não podem se repetir ao longo da base, e isso não acontece com tanta frequência na realidade.</p>
<p>Como exemplo, podemos voltar ao <em>join</em> entre as tabelas <code>flights</code> e <code>weather</code> que mostramos na seção <a href="#sec:config_colunas_keys">Configurações sobre as colunas e <em>keys</em> utilizadas no <em>join</em></a>. Para realizarmos o <em>join</em> entre essas tabelas, nós utilizamos as colunas <code>year</code>, <code>month</code>, <code>day</code>, <code>hour</code> e <code>origin</code> como <em>key</em>. Porém, a forma como descrevemos essas colunas na seção passada, ficou subentendido que a combinação entre elas foi capaz de formar uma <em>primary key</em>. Bem, porque não conferimos se essas colunas assumem de fato esse atributo:</p>
<p></p>
<div class="sourceCode" id="cb726"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb726-1"><a href="#cb726-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span> </span>
<span id="cb726-2"><a href="#cb726-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(year, month, day, hour, origin) <span class="sc">%&gt;%</span> </span>
<span id="cb726-3"><a href="#cb726-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## # A tibble: 18,906 x 6
##     year month   day  hour origin     n
##    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;  &lt;int&gt;
##  1  2013     1     1     5 EWR        2
##  2  2013     1     1     5 JFK        3
##  3  2013     1     1     6 EWR       18
##  4  2013     1     1     6 JFK       17
##  5  2013     1     1     6 LGA       17
##  6  2013     1     1     7 EWR       12
##  7  2013     1     1     7 JFK       16
##  8  2013     1     1     7 LGA       21
##  9  2013     1     1     8 EWR       20
## 10  2013     1     1     8 JFK       23
## # ... with 18,896 more rows</code></pre>
<p></p>
<p>Como podemos ver acima, há diversas combinações entre as cinco colunas que se repetem ao longo da base. Com isso, podemos afirmar que a combinação entre as colunas <code>year</code>, <code>month</code>, <code>day</code>, <code>hour</code> e <code>origin</code> não formam uma <em>primary key</em>. Perceba abaixo, que o mesmo vale para a tabela <code>weather</code>:</p>
<p></p>
<div class="sourceCode" id="cb728"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb728-1"><a href="#cb728-1" aria-hidden="true" tabindex="-1"></a>weather <span class="sc">%&gt;%</span> </span>
<span id="cb728-2"><a href="#cb728-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(year, month, day, hour, origin) <span class="sc">%&gt;%</span> </span>
<span id="cb728-3"><a href="#cb728-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## # A tibble: 3 x 6
##    year month   day  hour origin     n
##   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;  &lt;int&gt;
## 1  2013    11     3     1 EWR        2
## 2  2013    11     3     1 JFK        2
## 3  2013    11     3     1 LGA        2</code></pre>
<p></p>
<p>Portanto, circunstâncias em que não há uma <em>primary key</em> definida entre duas tabelas, são comuns, inclusive em momentos que você utiliza a combinação de todas as colunas disponíveis em uma das tabelas para formar uma <em>key</em>. Com isso, eu quero destacar principalmente, que não há problema algum em utilizarmos <em>foreign keys</em> em <em>joins</em>.</p>
<p>Isso significa que você deve definir a <em>key</em> mais apropriada para o seu <em>join</em>, baseado no seu conhecimento sobre esses dados, ao invés de procurar por colunas de mesmo nome em ambas as tabelas <span class="citation">(<a href="#ref-wickham2017" role="doc-biblioref">Wickham and Grolemund 2017</a>)</span>. Logo, durante esse processo, nós não estamos perseguindo <em>primary keys</em> de maneira obsessiva, mas sim, pesquisando por relações verdadeiras e lógicas entre as tabelas.</p>
<p>Por exemplo, no caso das tabelas <code>flights</code> e <code>weather</code>, utilizamos as colunas <code>year</code>, <code>month</code>, <code>day</code>, <code>hour</code> e <code>origin</code> como <em>key</em>, pelo fato de que eventos climáticos ocorrem um dado momento (<code>hour</code>) de um dia específico (<code>year</code>, <code>month</code> e <code>day</code>), além de geralmente se restringir a uma dada região geográfica (<code>origin</code>). Curiosamente, essas colunas não foram suficientes para produzirmos uma <em>primary key</em>, mas foram suficientes para representarmos uma conexão lógica entre as tabelas <code>flights</code> e <code>weather</code>.</p>
<p>Assim sendo, qualquer que seja o tipo de <em>key</em> empregado, o processo de <em>join</em> irá ocorrer exatamente da mesma forma. Porém, o tipo que a <em>key</em> assume em cada tabela pode alterar as combinações geradas no resultado do <em>join</em>. Como temos duas tabelas em cada <em>join</em>, temos três possibilidades de relação entre as <em>keys</em> de cada tabela: 1) <em>primary key</em> <span class="math inline">\(\rightarrow\)</span> <em>primary key</em>; 2) <em>primary key</em> <span class="math inline">\(\rightarrow\)</span> <em>foreign key</em>; 3) <em>foreign key</em> <span class="math inline">\(\rightarrow\)</span> <em>foreign key</em>. Ou seja, em cada uma das tabelas envolvidas em um <em>join</em>, as colunas a serem utilizadas como <em>key</em> podem se caracterizar como uma <em>primary key</em> ou como uma <em>foreign key</em>.</p>
<p>Como exemplo, o <em>join</em> formado pelas tabelas <code>info</code> e <code>band_instruments</code>, possui uma relação de <em>primary key</em> <span class="math inline">\(\rightarrow\)</span> <em>primary key</em>. Pois a coluna <code>name</code> é uma <em>primary key</em> em ambas as tabelas. Por outro lado, o <em>join</em> formado pelas tabelas <code>flights</code> e <code>weather</code>, possui uma relação de <em>foreign key</em> <span class="math inline">\(\rightarrow\)</span> <em>foreign key</em>, visto que as cinco colunas utilizadas como <em>key</em> não são capazes de identificar unicamente cada observação nas duas tabelas, como comprovamos acima.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/relacoes_keys.png" alt="Resumo das relações possíveis entre keys, inspirado em  Wickham e Grolemund (2017)" width="80%" />
<p class="caption">
(#fig:unnamed-chunk-376)Resumo das relações possíveis entre keys, inspirado em Wickham e Grolemund (2017)
</p>
</div>
<p></p>
<p>Com isso, temos a opção de compreendermos a relação entre as <em>keys</em>, como uma relação de quantidade de cópias, fazendo referência direta ao fato de que uma <em>primary key</em> não possui valores repetidos ao longo da base, enquanto o mesmo não pode ser dito de uma <em>foreign key</em>. Logo, uma relação <em>primary key</em> <span class="math inline">\(\rightarrow\)</span> <em>primary key</em> pode ser identificada como uma relação de <strong>um para um</strong>, pois sempre vamos contar com uma única chave para cada observação em ambas as tabelas. Para mais, podemos interpretar uma relação <em>primary key</em> <span class="math inline">\(\rightarrow\)</span> <em>foreign key</em>, como uma relação de <strong>um para muitos</strong>, pois para cada chave única presente em uma das tabelas, podemos encontrar múltiplas irmãs gêmeas presentes na outra tabela.</p>
<p>Em contrapartida, se tivermos uma relação <em>foreign key</em> <span class="math inline">\(\rightarrow\)</span> <em>foreign key</em>, ou uma relação de <strong>muitos para muitos</strong>, para cada conjunto de <em>keys</em> repetidas em ambas as tabelas, todas as possibilidades de combinação serão geradas. Em outras palavras, nesse tipo de relação, o resultado do <em>join</em> será uma produto cartesiano como demonstrado pela figura 6.4.</p>
<p>Relações de um para um são raras e, por essa razão, você geralmente irá lidar com relações de um para muitos e de muitos para muitos em suas tabelas. No caso de relações de um para muitos, as <em>primary keys</em> são replicadas no resultado do <em>join</em>, para cada repetição de sua <em>key</em> correspondente na outra tabela, como pode ser visto na figura 6.4.</p>
</div>
<div id="portanto-joins-podem-ser-uma-fonte-de-repetições-indesejadas-em-seus-dados" class="section level2" number="6.7">
<h2 number="6.7"><span class="header-section-number">6.7</span> Portanto, <em>joins</em> podem ser uma fonte de repetições indesejadas em seus dados</h2>
<p>Ao explicar as relações de um para muitos e de muitos para muitos entre <em>keys</em>, eu estava querendo destacar que produtos cartesianos são extremamente comuns em todos os tipos de <em>joins</em>. Quando os alunos são introduzidos pela primeira vez ao mundo dos <em>joins</em>, muitos tendem a interpretar que, por exemplo, a função <code>left_join()</code> produz exatamente o mesmo número de linhas que a tabela destinatária (ou a tabela <code>x</code>) utilizada no <em>join</em>. Ou ainda, que se as duas tabelas utilizadas no <em>join</em> possuírem o mesmo número de linhas, que a função <code>inner_join()</code> vai necessariamente retornar um número menor ou igual de linhas em seu resultado.</p>
<p>Essa é uma confusão tão comum, que Hadley Wickham chegou a escrever <a href="https://twitter.com/hadleywickham/status/1435952016224886784">uma votação no Twitter</a> que demonstra como um produto cartesiano pode ser gerado devido a essa relação entre <em>keys</em>. Como exemplo prático, vamos recriar exatamente a situação que Hadley estava descrevendo nesse tweet. Repare que temos duas tabelas abaixo, <code>df1</code> e <code>df2</code>. Ambas as tabelas, possuem uma coluna chamada de <code>x</code>. Porém, apenas a tabela <code>df1</code> possui uma coluna <code>y</code>, e apenas a tabela <code>df2</code> possui uma coluna <code>z</code>.</p>
<p></p>
<div class="sourceCode" id="cb730"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb730-1"><a href="#cb730-1" aria-hidden="true" tabindex="-1"></a>df1 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>), <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb730-2"><a href="#cb730-2" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>), <span class="at">z =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">4</span>))</span>
<span id="cb730-3"><a href="#cb730-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb730-4"><a href="#cb730-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(df1)</span></code></pre></div>
<pre><code>##   x y
## 1 1 1
## 2 1 2</code></pre>
<div class="sourceCode" id="cb732"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb732-1"><a href="#cb732-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(df2)</span></code></pre></div>
<pre><code>##   x z
## 1 1 3
## 2 1 4</code></pre>
<p></p>
<p>Ao aplicarmos um <code>inner_join()</code> entre essas tabelas, quantas linhas você espera encontrar no resultado do <em>join</em>? Você provavelmente pensou em 2 linhas, mas na realidade, são retornadas 4 linhas diferentes. Vale destacar que, nessa situação, o resultado de <code>inner_join()</code> é equivalente aos resultados produzidos por <code>full_join()</code>, <code>left_join()</code> e <code>right_join()</code>. Ao observarmos atentamente as combinações entre as colunas <code>y</code> e <code>z</code>, podemos compreender melhor o que está acontecendo neste resultado.</p>
<p>Em ambas as tabelas, a coluna <code>x</code> não é capaz de identificar sozinha cada observação única da tabela, logo, a relação criada pela coluna <code>x</code> é uma relação de muitos para muitos entre as duas tabelas. Por essa razão, o <em>join</em> entre as tabelas <code>df1</code> e <code>df2</code> acaba gerando um produto cartesiano entre as duas observações de cada tabela, de modo que, no final, temos <span class="math inline">\(2 \times 2 = 4\)</span> linhas retornadas. Portanto, todas as combinações possíveis entre <span class="math inline">\((y, z)\)</span> foram retornadas, sendo elas: <span class="math inline">\((1,3); (1,4); (2,3); (2,4)\)</span>.</p>
<p></p>
<div class="sourceCode" id="cb734"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb734-1"><a href="#cb734-1" aria-hidden="true" tabindex="-1"></a><span class="fu">inner_join</span>(df1, df2, <span class="at">by =</span> <span class="st">&quot;x&quot;</span>)</span></code></pre></div>
<pre><code>##   x y z
## 1 1 1 3
## 2 1 1 4
## 3 1 2 3
## 4 1 2 4</code></pre>
<p></p>
<p>Sendo assim, caso você esteja trabalhando sobre uma tabela A que contém exatas 1000 linhas, e você aplica diversas transformações sobre essa tabela (incluindo a aplicação de <em>joins</em>), e, no final, acaba gerando uma tabela de 1200 linhas, você pode suspeitar que os <em>joins</em> que você está aplicando e os possíveis produtos cartesianos que eles estejam gerando, sejam a fonte de tal expansão de sua tabela.</p>
<p>Em meu trabalho como analista, estou o tempo todo analisando como diversos usuários estão navegando por um determinado fluxo. E para tal análise estou constantemente aplicando <em>joins</em> entre tabelas, e as relações entre as <em>keys</em> dessas tabelas são parte fundamental desse trabalho. Pois caso eu não tenha cuidado com essas relações, eu posso acabar gerando repetições indesejadas de um mesmo usuário, devido ao produto cartesiano gerado no <em>join</em>, e por causa dessas repetições, eu posso acabar interpretando que 100 usuários passaram por um ponto x do fluxo, quando na verdade, apenas 77 usuários de fato passaram por este ponto.</p>
<p>Portanto, quando estiver trabalhando com <em>joins</em>, é importante que você sempre os interprete como uma relação entre os indivíduos ou categorias descritas em cada tabela, e não como um filtro baseado no número de linhas de cada tabela. Um <em>left join</em> não busca gerar um resultado que tem o mesmo número de linhas da tabela destinatária, mas sim, um resultado que contém os mesmos indivíduos ou categorias descritas na tabela destinatária.</p>
</div>
<div id="utilizando-joins-como-a-base-de-um-filtro" class="section level2" number="6.8">
<h2 number="6.8"><span class="header-section-number">6.8</span> Utilizando <em>joins</em> como a base de um filtro</h2>
<p>Durante as seções anteriores mostramos os <em>joins</em> dos tipos <em>inner</em>, <em>full</em>, <em>left</em> e <em>right</em>. Esses tipos de <em>joins</em> são conjuntamente conhecidos como <em>mutating joins</em>, pois eles adicionam novas variáveis a sua tabela (como se fossem uma cópia da função <code>mutate()</code>) baseando-se em um pareamento com as linhas de outra tabela <span class="citation">(<a href="#ref-wickham2017" role="doc-biblioref">Wickham and Grolemund 2017</a>)</span>.</p>
<p>Para além desses tipos de <em>join</em>, temos o conjunto de <em>filtering joins</em>, o qual abarca os <em>anti joins</em> e os <em>semi joins</em>. Para esses dois tipos de <em>joins</em>, o pacote <code>dplyr</code> nos oferece as funções <code>anti_join()</code> e <code>semi_join()</code>. A principal diferença entre os <em>filtering joins</em> e os <em>mutating joins</em>, é que os <em>filtering joins</em> não adicionam novas variáveis à sua tabela, eles apenas filtram as linhas de sua tabela a depender se elas puderam ou não ser encontradas na outra tabela.</p>
<p>Começando pelo <em>anti join</em>, se você possui uma tabela A e uma tabela B, e aplica um <em>anti join</em> sobre essas tabelas, você vai encontrar todas as linhas da tabela A que não foram encontradas na tabela B. Portanto, a função <code>anti_join()</code> é uma forma prática e eficiente de você descobrir quais indivíduos de uma tabela A não são descritos em uma tabela B. Portanto, se voltarmos às tabelas <code>info</code> e <code>band_instruments</code>, perceba abaixo, que apenas as linhas referentes à Mick, George e Ringo são retornadas em um <em>anti join</em>, pois esses músicos da tabela <code>info</code> não estão presentes na tabela <code>band_instruments</code>.</p>
<p></p>
<div class="sourceCode" id="cb736"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb736-1"><a href="#cb736-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anti_join</span>(</span>
<span id="cb736-2"><a href="#cb736-2" aria-hidden="true" tabindex="-1"></a>  info,</span>
<span id="cb736-3"><a href="#cb736-3" aria-hidden="true" tabindex="-1"></a>  band_instruments,</span>
<span id="cb736-4"><a href="#cb736-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">by =</span> <span class="st">&quot;name&quot;</span></span>
<span id="cb736-5"><a href="#cb736-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## # A tibble: 3 x 4
##   name   band           born       children
##   &lt;chr&gt;  &lt;chr&gt;          &lt;date&gt;     &lt;lgl&gt;   
## 1 Mick   Rolling Stones 1943-07-26 TRUE    
## 2 George Beatles        1943-02-25 TRUE    
## 3 Ringo  Beatles        1940-07-07 TRUE</code></pre>
<p></p>
<p>Por outro lado, um <em>semi join</em> representa justamente a operação contrária. Isto é, um <em>semi join</em> entre as tabelas A e B, lhe retorna todas as linhas da tabela A que foram encontradas na tabela B. Sendo assim, se aplicarmos a função <code>semi_join()</code> sobre as tabelas <code>info</code> e <code>band_instruments</code>, temos como resultado as linhas referentes aos músicos John e Paul, pelo fato destes músicos estarem presentes em ambas as tabelas.</p>
<p></p>
<div class="sourceCode" id="cb738"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb738-1"><a href="#cb738-1" aria-hidden="true" tabindex="-1"></a><span class="fu">semi_join</span>(</span>
<span id="cb738-2"><a href="#cb738-2" aria-hidden="true" tabindex="-1"></a>  info,</span>
<span id="cb738-3"><a href="#cb738-3" aria-hidden="true" tabindex="-1"></a>  band_instruments,</span>
<span id="cb738-4"><a href="#cb738-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">by =</span> <span class="st">&quot;name&quot;</span></span>
<span id="cb738-5"><a href="#cb738-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## # A tibble: 2 x 4
##   name  band    born       children
##   &lt;chr&gt; &lt;chr&gt;   &lt;date&gt;     &lt;lgl&gt;   
## 1 John  Beatles 1940-09-10 TRUE    
## 2 Paul  Beatles 1942-06-18 TRUE</code></pre>
<p></p>
</div>
<div id="exercícios-4" class="section level2 unnumbered">
<h2 class="unnumbered">Exercícios</h2>
<p>O primeiro exercício desse capítulo, envolve duas tabelas publicadas na semana 11 do projeto Tidy Tuesday em 2020. Mais especificamente, as tabelas <code>tuition_cost</code> e <code>salary_potential</code>. A tabela <code>tuition_cost</code> descreve os custos de um curso de graduação em diferentes universidades dos EUA. Em contrapartida, a tabela <code>salary_potential</code> fornece uma estimativa do salário pontencial que um diploma de graduação de diversas universidades dos EUA pode fornecer a um profissional.</p>
<p>No Brasil, as faculdades privadas geralmente cobram por uma mensalidade fixa que abrange todos os custos mínimos. Já algumas universidades privadas, tendem a usar um sistema mais complexo, onde uma mensalidade base é cobrada, além de taxas por aulas práticas (para cobrir gastos com o uso de equipamentos) e taxas por matéria matriculada. Em outras palavras, um aluno de uma universidade privada brasileira que se matricula, por exemplo, em 4 matérias num dado semestre, geralmente paga um valor mensal que segue a estrutura: mensalidade base + taxa por aula prática (se houver alguma aula prática) + (4 <span class="math inline">\(\times\)</span> taxa por matrícula).</p>
<p>Por outro lado, as universidades americanas possuem um sistema mais complexo de cobrança. Primeiro, a maior parte dos estudantes americanos optam por morar e se alimentar nos alojamentos da universidade, ao invés de se manterem na casa dos pais. A universidade cobra uma taxa específica para esses estudantes, que busca pagar justamente os custos deste alojamento e de sua alimentação. Tal custo é geralmente denominado de <em>room and board fees</em>. Segundo, universidades americanas cobram principalmente pelo seu “ensino” (e alguns outros serviços) e, por isso, a maior parte de seus preços envolvem o que chamamos de <em>“tuition fees”</em> (ou “taxa de ensino”). Terceiro, os valores divulgados pelas universidades são geralmente anuais, logo, se o <em>tuition fees</em> (ou <em>room and board fees</em>) de uma universidade qualquer é de $25 mil, isso significa que um curso de 4 anos nessa universidade custaria em torno de $100 mil.</p>
<p>Portanto, as universidades americanas cobram, em geral, dois tipos de custos diferentes (<em>room and board fees</em> e <em>tuition fees</em>) e, esses custos são em sua maioria, anuais. Grande parte dos alunos acabam pagando ambos desses custos, logo, esses custos somados representam, para grande parte da população, o custo total por ano de uma universidade nos EUA.</p>
<p>Para mais, as universidades americanas também cobram taxas de ensino (<em>tuition fees</em>) diferentes de acordo com o estado em que o aluno reside. Ou seja, uma universidade que está sediada no estado do Texas vai cobrar uma taxa mais barata para os alunos que moram no estado do Texas. Porém, os alunos que são originalmente de outros estados, e estão vindo para essa universidade vão pagar taxas maiores.</p>
<p><strong>Questão 6.1.</strong> Suponha que você esteja interessado em realizar um curso de graduação em alguma das universidades descritas na tabela <code>tuition_cost</code>. Como você provavelmente não mora nos Estados Unidos, considere os custos referentes a alunos <em>out of state</em> em seus cálculos. Vale também ressaltar que os salários estimados na tabela <code>salary_potential</code>, assim como os custos na tabela <code>tuition_cost</code>, são anuais. Com base nas estimativas de salário presentes na tabela <code>salary_potential</code> e, com base nos custos descritos na tabela <code>tuition_cost</code>, tente calcular (para cada universidade) o tempo de trabalho necessário (após a graduação) para pagar pelo investimento que você aplicou no curso de graduação.</p>
<p></p>
<div class="sourceCode" id="cb740"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb740-1"><a href="#cb740-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb740-2"><a href="#cb740-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb740-3"><a href="#cb740-3" aria-hidden="true" tabindex="-1"></a>github <span class="ot">&lt;-</span> <span class="st">&quot;https://raw.githubusercontent.com/rfordatascience/&quot;</span></span>
<span id="cb740-4"><a href="#cb740-4" aria-hidden="true" tabindex="-1"></a>pasta <span class="ot">&lt;-</span> <span class="st">&quot;tidytuesday/master/data/2020/2020-03-10/&quot;</span></span>
<span id="cb740-5"><a href="#cb740-5" aria-hidden="true" tabindex="-1"></a>cost <span class="ot">&lt;-</span> <span class="st">&quot;tuition_cost.csv&quot;</span></span>
<span id="cb740-6"><a href="#cb740-6" aria-hidden="true" tabindex="-1"></a>salary <span class="ot">&lt;-</span> <span class="st">&quot;salary_potential.csv&quot;</span></span>
<span id="cb740-7"><a href="#cb740-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb740-8"><a href="#cb740-8" aria-hidden="true" tabindex="-1"></a>tuition_cost <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">paste0</span>(github, pasta, cost))</span>
<span id="cb740-9"><a href="#cb740-9" aria-hidden="true" tabindex="-1"></a>salary_potential <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">paste0</span>(github, pasta, salary))</span></code></pre></div>
<p></p>
<p><strong>Questão 6.2.</strong> Todos os itens abaixo envolvem as tabelas <code>consumidores</code> e <code>vendedores</code>, alguns itens serão teóricos, outros, vão lhe requisitar o cálculo de alguma informação. Como esses cálculos envolvem as informações de ambas as tabelas, você será obrigado a aplicar um <em>join</em> entre elas para realizá-lo:</p>
<p></p>
<div class="sourceCode" id="cb741"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb741-1"><a href="#cb741-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb741-2"><a href="#cb741-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb741-3"><a href="#cb741-3" aria-hidden="true" tabindex="-1"></a>github <span class="ot">&lt;-</span> <span class="st">&quot;https://raw.githubusercontent.com/pedropark99/&quot;</span></span>
<span id="cb741-4"><a href="#cb741-4" aria-hidden="true" tabindex="-1"></a>pasta <span class="ot">&lt;-</span> <span class="st">&quot;Curso-R/master/Dados/&quot;</span></span>
<span id="cb741-5"><a href="#cb741-5" aria-hidden="true" tabindex="-1"></a>arquivo1 <span class="ot">&lt;-</span> <span class="st">&quot;consumidor.csv&quot;</span></span>
<span id="cb741-6"><a href="#cb741-6" aria-hidden="true" tabindex="-1"></a>arquivo2 <span class="ot">&lt;-</span> <span class="st">&quot;vendedores.csv&quot;</span></span>
<span id="cb741-7"><a href="#cb741-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb741-8"><a href="#cb741-8" aria-hidden="true" tabindex="-1"></a>consumidores <span class="ot">&lt;-</span> <span class="fu">read_csv2</span>(<span class="fu">paste0</span>(github, pasta, arquivo1))</span>
<span id="cb741-9"><a href="#cb741-9" aria-hidden="true" tabindex="-1"></a>vendedores <span class="ot">&lt;-</span> <span class="fu">read_csv2</span>(<span class="fu">paste0</span>(github, pasta, arquivo2))</span></code></pre></div>
<p></p>
<p>6.2.A) Quais colunas representam as <em>keys</em> em ambas as tabelas?</p>
<p>6.2.B) Na tabela <code>consumidores</code>, quais colunas representam uma <em>primary key</em>, e quais representam uma <em>foreign key</em>?</p>
<p>6.2.C) Descubra o número de cidades nas quais cada vendedor atendeu os seus clientes.</p>
<p><strong>Questão 6.3.</strong> Dado que você tenha importado as tabelas <code>filmes</code> e <code>filmes_receita</code> abaixo para o seu R, e, tendo em mente o que vimos nesse capítulo, explique porque o comando de <em>join</em> abaixo não funciona sobre essas tabelas. Dado que você encontre e explique o que está errado, como você ajustaria esse comando para que ele funcione normalmente?</p>
<p></p>
<div class="sourceCode" id="cb742"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb742-1"><a href="#cb742-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb742-2"><a href="#cb742-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb742-3"><a href="#cb742-3" aria-hidden="true" tabindex="-1"></a>github <span class="ot">&lt;-</span> <span class="st">&quot;https://raw.githubusercontent.com/pedropark99/&quot;</span></span>
<span id="cb742-4"><a href="#cb742-4" aria-hidden="true" tabindex="-1"></a>pasta <span class="ot">&lt;-</span> <span class="st">&quot;Curso-R/master/Dados/&quot;</span></span>
<span id="cb742-5"><a href="#cb742-5" aria-hidden="true" tabindex="-1"></a>arquivo1 <span class="ot">&lt;-</span> <span class="st">&quot;filmes_dados.csv&quot;</span></span>
<span id="cb742-6"><a href="#cb742-6" aria-hidden="true" tabindex="-1"></a>arquivo2<span class="ot">&lt;-</span> <span class="st">&quot;filmes_receita.csv&quot;</span></span>
<span id="cb742-7"><a href="#cb742-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb742-8"><a href="#cb742-8" aria-hidden="true" tabindex="-1"></a>filmes <span class="ot">&lt;-</span> <span class="fu">read_csv2</span>(<span class="fu">paste0</span>(github, pasta, arquivo1))</span>
<span id="cb742-9"><a href="#cb742-9" aria-hidden="true" tabindex="-1"></a>filmes_receita <span class="ot">&lt;-</span> <span class="fu">read_csv2</span>(<span class="fu">paste0</span>(github, pasta, arquivo2))</span>
<span id="cb742-10"><a href="#cb742-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb742-11"><a href="#cb742-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb742-12"><a href="#cb742-12" aria-hidden="true" tabindex="-1"></a><span class="do">### Porque esse comando de join</span></span>
<span id="cb742-13"><a href="#cb742-13" aria-hidden="true" tabindex="-1"></a><span class="do">### abaixo não funciona?</span></span>
<span id="cb742-14"><a href="#cb742-14" aria-hidden="true" tabindex="-1"></a>filmes <span class="sc">%&gt;%</span> </span>
<span id="cb742-15"><a href="#cb742-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb742-16"><a href="#cb742-16" aria-hidden="true" tabindex="-1"></a>    filmes_receita</span>
<span id="cb742-17"><a href="#cb742-17" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p></p>
<!--chapter:end:06-dados-relacionais.Rmd-->
</div>
</div>
<div id="tidy-data-uma-abordagem-para-organizar-os-seus-dados-com-tidyr" class="section level1" number="7">
<h1 number="7"><span class="header-section-number">7</span> <em>Tidy Data</em>: uma abordagem para organizar os seus dados com <code>tidyr</code></h1>
<div id="sec:chapter_tidy_data" class="section level2" number="7.1">
<h2 number="7.1"><span class="header-section-number">7.1</span> Introdução e pré-requisitos</h2>
<p>Em qualquer análise, o formato no qual os seus dados se encontram, é muito importante. O que vamos discutir neste capítulo, será como reformatar as suas tabelas, corrigir valores não disponíveis, ou “vazios” que se encontram no formato incorreto, ou então, como preencher as suas colunas que estão incompletas de acordo com um certo padrão.</p>
<p>Você rapidamente descobre a importância que o formato de sua tabela carrega para o seu trabalho, na medida em que você possui pensamentos como: “Uhmm…se essa coluna estivesse na forma x, eu poderia simplesmente aplicar a função <code>y()</code> e todos os meus problemas estariam resolvidos”; ou então: “Se o Arnaldo não tivesse colocado os totais junto dos dados desagregados, eu não teria todo esse trabalho!”; ou talvez: “Qual é o sentido de colocar o nome dos países nas colunas? Assim fica muito mais difícil de acompanhar os meus dados!”</p>
<p>Para corrigir o formato das nossas tabelas, vamos utilizar neste capítulo as funções do pacote <code>tidyr</code> que está incluso no <code>tidyverse</code>. Pelo próprio nome do pacote (<em>tidy</em>, que significa “arrumar”), já sabemos que ele inclui diversas funções que tem como propósito, organizar os seus dados. Portanto, lembre-se de chamar pelo pacote (seja pelo <em>tidyr</em> diretamente, ou pelo <em>tidyverse</em>) antes de prosseguir:</p>
<p></p>
<div class="sourceCode" id="cb743"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb743-1"><a href="#cb743-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb743-2"><a href="#cb743-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Ou</span></span>
<span id="cb743-3"><a href="#cb743-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span></code></pre></div>
<p></p>
</div>
<div id="o-que-é-tidy-data" class="section level2" number="7.2">
<h2 number="7.2"><span class="header-section-number">7.2</span> O que é <em>tidy data</em>?</h2>
<p>Em geral, nós passamos grande parte do tempo, reorganizando os nossos dados, para que eles fiquem em um formato adequado para a nossa análise. Logo, aprender técnicas que facilitem o seu trabalho nesta atividade, pode economizar uma grande parte de seu tempo.</p>
<p>Isso é muito importante, pois uma base de dados que está bagunçada, é em geral bagunçada em sua própria maneira. Como resultado, cada base irá exigir um conjunto de operações e técnicas diferentes das outras bases, para que ela seja arrumada. Algumas delas, vão enfrentar problemas simples de serem resolvidos, já outras, podem estar desarrumadas em um padrão não muito bem definido, e por isso, vão dar mais trabalho para você. Por essas razões, aprender técnicas voltadas para esses problemas, se torna uma atividade necessária.</p>
<blockquote>
<p><em>“Tidy datasets are all alike, but every messy dataset is messy in its own way”</em>. <span class="citation">(<a href="#ref-wickham2014" role="doc-biblioref">Wickham 2014</a>, p 2)</span></p>
</blockquote>
<p>Toda essa problemática, ocorre não apenas pelo erro humano, mas também porque podemos representar os nossos dados de diversas maneiras em uma tabela. Sendo que essas maneiras, podem tanto facilitar muito o seu trabalho, quanto tornar o trabalho de outros, num inferno. Veja por exemplo, as tabelas abaixo. Ambas, apresentam os mesmos dados, mas em estruturas diferentes.</p>
<p></p>
<div class="sourceCode" id="cb744"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb744-1"><a href="#cb744-1" aria-hidden="true" tabindex="-1"></a>table2</span></code></pre></div>
<pre><code>## # A tibble: 12 x 4
##    country      year type            count
##    &lt;chr&gt;       &lt;int&gt; &lt;chr&gt;           &lt;int&gt;
##  1 Afghanistan  1999 cases             745
##  2 Afghanistan  1999 population   19987071
##  3 Afghanistan  2000 cases            2666
##  4 Afghanistan  2000 population   20595360
##  5 Brazil       1999 cases           37737
##  6 Brazil       1999 population  172006362
##  7 Brazil       2000 cases           80488
##  8 Brazil       2000 population  174504898
##  9 China        1999 cases          212258
## 10 China        1999 population 1272915272
## 11 China        2000 cases          213766
## 12 China        2000 population 1280428583</code></pre>
<div class="sourceCode" id="cb746"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb746-1"><a href="#cb746-1" aria-hidden="true" tabindex="-1"></a>table3</span></code></pre></div>
<pre><code>## # A tibble: 6 x 3
##   country      year rate             
## * &lt;chr&gt;       &lt;int&gt; &lt;chr&gt;            
## 1 Afghanistan  1999 745/19987071     
## 2 Afghanistan  2000 2666/20595360    
## 3 Brazil       1999 37737/172006362  
## 4 Brazil       2000 80488/174504898  
## 5 China        1999 212258/1272915272
## 6 China        2000 213766/1280428583</code></pre>
<p></p>
<p>Antes de partirmos para a prática, vou fornecer uma base teórica que irá sustentar as suas decisões sobre como padronizar e estruturar os seus dados. Eu expliquei anteriormente, que o <code>tidyverse</code> é um conjunto de pacotes que dividem uma mesma filosofia. Isso significa, que esses pacotes possuem uma conexão forte entre si. Por exemplo, as funções desses pacotes, retornam os seus resultados em <code>tibble</code>’s, e todas as suas funções foram construídas de forma a trabalharem bem com o operador <em>pipe</em> (<code>%&gt;%</code>). Todas essas funções também foram projetadas seguindo as melhores práticas e técnicas em análise de dados. Sendo uma dessas práticas, o que é comumente chamado na comunidade de <em>tidy data</em>.</p>
<p>O conceito de <em>tidy data</em> foi definido por <span class="citation"><a href="#ref-wickham2014" role="doc-biblioref">Wickham</a> (<a href="#ref-wickham2014" role="doc-biblioref">2014</a>)</span>, e remete a forma como você está guardando os dados em sua tabela. Eu não estou dizendo aqui que todas as funções do <code>tidyverse</code> que apresentei até aqui, trabalham apenas com <em>tidy data</em>, mas sim, que essas funções são mais eficientes com essa estrutura <em>tidy</em>. Uma base de dados que está no formato <em>tidy</em>, compartilha das três seguintes características:</p>
<ol style="list-style-type: decimal">
<li><p>Cada variável de sua tabela, deve possuir a sua própria coluna.</p></li>
<li><p>Cada observação de sua tabela, deve possuir a sua própria linha.</p></li>
<li><p>Cada valor de sua tabela, deve possuir a sua própria célula.</p></li>
</ol>
<p>Eu posso pressupor que essas definições acima, já são claras o suficiente para que você entenda o que são dados <em>tidy</em>. Porém, deixar as coisas no ar, é com certeza uma prática tão ruim quanto incluir totais junto de seus dados desagregados. Por isso, vou passar os próximos parágrafos definindo com maior precisão cada parte que compõe essas características.</p>
<p>Primeiro, vou definir o que quero dizer exatamente com linhas, colunas e células de sua tabela. Abaixo temos uma representação de uma base qualquer. O interesse nessa representação, não se trata dos valores e nomes inclusos nessa tabela, mas sim as áreas sombreadas dessa tabela, que estão lhe apresentando cada um dos componentes supracitados.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/coluna_linha_celula.png" alt="Definindo colunas, linhas e células de uma tabela" width="90%" />
<p class="caption">
(#fig:unnamed-chunk-385)Definindo colunas, linhas e células de uma tabela
</p>
</div>
<p></p>
<p>Agora, vamos definir o que são variáveis, observações e valores. Você já deve ter percebido, que toda base de dados, possui uma unidade básica que está sendo descrita ao longo dela. Ou seja, toda base lhe apresenta dados sobre um grupo específico (ou uma amostra) de algo. Esse algo pode ser um conjunto de municípios, empresas, sequências genéticas, animais, clientes, realizações de um evento estocástico, dentre outros.</p>
<p>Logo, se a minha base contém dados sobre os municípios do estado de Minas Gerais (MG), cada um desses municípios são uma observação de minha base. Ao dizer que cada observação deve possuir a sua própria linha, eu estou dizendo que todas as informações referentes a um município específico, devem estar em uma única linha. Em outras palavras, cada uma das 853 (total de municípios em MG) linhas da minha base, contém os dados de um município diferente do estado.</p>
<p>Entretanto, se a minha base descreve a evolução do PIB desses mesmos municípios nos anos de 2010 a 2020, eu não possuo mais um valor para cada município, ao longo da base. Neste momento, eu possuo 10 valores diferentes, para cada município, e mesmo que eu ainda esteja falando dos mesmos municípios, a unidade básica da minha base, se alterou. Cada um desses 10 valores, representa uma observação do PIB deste município em um ano distinto. Logo, cada um desses 10 valores para cada município, deve possuir a sua própria linha. Se o estado de Minas Gerais possui 853 municípios diferentes, isso significa que nossa base deveria ter <span class="math inline">\(10 \times 853 = 8.530\)</span> linhas. Por isso, é importante que você preste atenção em seus dados, e identifique qual é a unidade básica que está sendo tratada.</p>
<p>Agora, quando eu me referir as variáveis de sua base, eu geralmente estou me referindo as colunas de sua base, porque ambos os termos são sinônimos em análises de dados. Porém, alguns cuidados são necessários, pois as variáveis de sua base podem não se encontrar nas colunas de sua tabela. Como eu disse anteriormente, há diversas formas de representar os seus dados, e por isso, há diversas formas de alocar os componentes de seus dados ao longo de sua tabela.</p>
<p>Uma variável de sua base de dados, não é apenas um elemento que (como o próprio nome dá a entender) varia ao longo de sua base, mas também é um elemento que lhe apresenta uma característica das suas observações. Ou seja, cada variável descreve uma característica (cor de pele, população, receita, …) de cada observação (pessoa, município, empresa, …) da minha base. O que é ou não, uma característica de sua unidade básica, irá depender de qual é essa unidade básica que está sendo descrita na base.</p>
<p>A população total, é uma característica geralmente associada a regiões geográficas (municípios, países, etc.), já a cor de pele pode ser uma característica de uma amostra de pessoas entrevistadas em uma pesquisa de campo (como a PNAD contínua), enquanto o número total de empresas é uma característica associada a setores da atividade econômica (CNAE - Classificação Nacional de Atividades Econômicas).</p>
<p>Por último, os valores de sua base, correspondem aos registros das características de cada observação de sua base. Como esse talvez seja o ponto mais claro e óbvio de todos, não vou me prolongar mais sobre ele. Pois as três características de <em>tidy data</em> que citamos anteriormente são interrelacionadas, de forma que você não pode satisfazer apenas duas delas. Logo, se você está satisfazendo as duas primeiras, você não precisa se preocupar com a característica que diz respeito aos valores.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/tidy_data.png" alt="Três propriedades que caracterizam o formato *tidy data*" width="90%" />
<p class="caption">
(#fig:unnamed-chunk-386)Três propriedades que caracterizam o formato <em>tidy data</em>
</p>
</div>
<p></p>
<p>Portanto, sempre inicie o seu trabalho, identificando a unidade básica de sua base. Em seguida, tente encontrar quais são as suas variáveis, ou as características dessa unidade básica que estão sendo descritas na base. Após isso, basta alocar cada variável em uma coluna, e reservar uma linha para cada observação diferente de sua base, que você automaticamente estará deixando uma célula para cada valor da base.</p>
<div id="será-que-você-entendeu-o-que-é-tidy-data" class="section level3" number="7.2.1">
<h3 number="7.2.1"><span class="header-section-number">7.2.1</span> Será que você entendeu o que é tidy data?</h3>
<p>Nessa seção vamos fazer um teste rápido, para saber se você entendeu o que é uma tabela no formato <em>tidy</em>. Olhe por algum tempo para os exemplos abaixo, e reflita sobre qual dessas tabelas está no formato <em>tidy</em>. Tente também descobrir quais são os problemas que as tabelas “não <em>tidy</em>” apresentam, ou em outras palavras, qual das três definições que apresentamos anteriormente, que essas tabelas “não <em>tidy</em>” acabam rompendo.</p>
<p></p>
<div class="sourceCode" id="cb748"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb748-1"><a href="#cb748-1" aria-hidden="true" tabindex="-1"></a>table1</span></code></pre></div>
<pre><code>## # A tibble: 6 x 4
##   country      year  cases population
##   &lt;chr&gt;       &lt;int&gt;  &lt;int&gt;      &lt;int&gt;
## 1 Afghanistan  1999    745   19987071
## 2 Afghanistan  2000   2666   20595360
## 3 Brazil       1999  37737  172006362
## 4 Brazil       2000  80488  174504898
## 5 China        1999 212258 1272915272
## 6 China        2000 213766 1280428583</code></pre>
<div class="sourceCode" id="cb750"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb750-1"><a href="#cb750-1" aria-hidden="true" tabindex="-1"></a>table2</span></code></pre></div>
<pre><code>## # A tibble: 12 x 4
##    country      year type            count
##    &lt;chr&gt;       &lt;int&gt; &lt;chr&gt;           &lt;int&gt;
##  1 Afghanistan  1999 cases             745
##  2 Afghanistan  1999 population   19987071
##  3 Afghanistan  2000 cases            2666
##  4 Afghanistan  2000 population   20595360
##  5 Brazil       1999 cases           37737
##  6 Brazil       1999 population  172006362
##  7 Brazil       2000 cases           80488
##  8 Brazil       2000 population  174504898
##  9 China        1999 cases          212258
## 10 China        1999 population 1272915272
## 11 China        2000 cases          213766
## 12 China        2000 population 1280428583</code></pre>
<div class="sourceCode" id="cb752"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb752-1"><a href="#cb752-1" aria-hidden="true" tabindex="-1"></a>table3</span></code></pre></div>
<pre><code>## # A tibble: 6 x 3
##   country      year rate             
## * &lt;chr&gt;       &lt;int&gt; &lt;chr&gt;            
## 1 Afghanistan  1999 745/19987071     
## 2 Afghanistan  2000 2666/20595360    
## 3 Brazil       1999 37737/172006362  
## 4 Brazil       2000 80488/174504898  
## 5 China        1999 212258/1272915272
## 6 China        2000 213766/1280428583</code></pre>
<p></p>
<p>Como eu disse anteriormente, a primeira coisa que você deve fazer, é identificar a unidade básica que está sendo tratada na tabela. Nos exemplos acima, essas tabelas dizem respeito à dados de três países (Brasil, China e Afeganistão) em dois anos diferentes (1999 e 2000). Logo, a nossa tabela possui <span class="math inline">\(3 \times 2 = 6\)</span> observações diferentes. Se uma das regras, impõe que todas as linhas devem possuir informações de uma única observação, a nossa tabela deveria possuir 6 linhas. Com isso, nós já sabemos que algo está errado com a tabela 2, pois ela possui o dobro de linhas.</p>
<p>Na verdade, o problema na tabela 2 é que ela está quebrando a regra de que cada variável na tabela deve possuir a sua própria coluna. Por causa dessa regra, a tabela 2 acaba extrapolando o número de linhas necessárias. Olhe para as colunas <code>type</code> e <code>count</code>. A coluna <code>count</code> lhe apresenta os principais valores que estamos interessados nessa tabela. Porém, a coluna <code>type</code>, está lhe apresentando duas variáveis diferentes.</p>
<p>Lembre-se de que variáveis, representam características da unidade básica de sua tabela. No nosso caso, essa unidade básica se trata dos dados anuais de países, logo, <code>cases</code> e <code>population</code>, são variáveis ou características diferentes desses países. Uma dessas variáveis está lhe apresentando um dado demográfico (população total), já a outra, está lhe trazendo um indicador epidemiológico (número de casos de alguma doença). Por isso, ambas variáveis deveriam possuir a sua própria coluna.</p>
<p>Ok, mas e as tabelas 1 e 3? Qual delas é a <em>tidy</em>? Talvez, para responder essa pergunta, você deveria primeiro procurar pela tabela “não <em>tidy</em>.” Veja a tabela 3, e se pergunte: “onde se encontram os valores de população e de casos de cada país nessa tabela?” Ao se fazer essa pergunta, você provavelmente já irá descobrir qual é o problema nessa tabela.</p>
<p>A tabela 3, também rompe com a regra de que cada variável deve possuir a sua própria coluna. Pois o número de casos e a população total, estão guardados em uma mesma coluna! Ao separar os valores de população e de número de casos na tabela 3, em duas colunas diferentes, você chega na tabela 1, que é um exemplo de tabela <em>tidy</em>, pois agora todas as três definições estão sendo respeitadas.</p>
</div>
<div id="uma-breve-definição-de-formas" class="section level3" number="7.2.2">
<h3 number="7.2.2"><span class="header-section-number">7.2.2</span> Uma breve definição de formas</h3>
<p>Apenas para que os exemplos das próximas seções, fiquem mais claros e fáceis de se visualizar mentalmente, vou definir dois formatos gerais que a sua tabela pode assumir, que são: <em>long</em> (longa) e <em>wide</em> (larga)<a href="#fn15" class="footnote-ref" id="fnref15"><sup>15</sup></a>. Ou seja, qualquer que seja a sua tabela, ela vai em geral, estar em algum desses dois formatos, de uma forma ou de outra.</p>
<p>Esses termos (<em>long</em> e <em>wide</em>) são bem descritivos por si só. A ideia é que se uma tabela qualquer, está no formato <em>long</em>, ela adquire um aspecto visual de longa, ou em outras palavras, visualmente ela aparenta ter muitas linhas, e poucas colunas. Já uma tabela que está no formato <em>wide</em>, adquire um aspecto visual de larga, como se essa tabela possuísse mais colunas do que o necessário, e poucas linhas. Perceba pelos exemplos apresentados na figura 7.3, que estamos apresentando exatamente os mesmos dados, eles apenas estão organizados de formas diferentes ao longo das duas tabelas.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/long_wide.png" alt="Formas gerais que a sua tabela pode adquirir" width="100%" />
<p class="caption">
(#fig:unnamed-chunk-388)Formas gerais que a sua tabela pode adquirir
</p>
</div>
<p></p>
</div>
</div>
<div id="operações-de-pivô" class="section level2" number="7.3">
<h2 number="7.3"><span class="header-section-number">7.3</span> Operações de pivô</h2>
<p>As operações de pivô são as principais operações que você irá utilizar para reformatar a sua tabela. O que essas operações fazem, é basicamente alterar as dimensões de sua tabela, ou dito de outra maneira, essas operações buscam transformar colunas em linhas, ou vice-versa. Para exemplificar essas operações, vamos utilizar as tabelas que vem do próprio pacote <code>tidyr</code>. Logo, se você chamou pelo <code>tidyverse</code> através de <code>library()</code>, você tem acesso a tabela abaixo. Basta chamar no console pelo objeto <code>relig_income</code>.</p>
<p></p>
<div class="sourceCode" id="cb754"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb754-1"><a href="#cb754-1" aria-hidden="true" tabindex="-1"></a>relig_income</span></code></pre></div>
<pre><code>## # A tibble: 18 x 11
##    religion       `&lt;$10k` `$10-20k` `$20-30k` `$30-40k` `$40-50k` `$50-75k`
##    &lt;chr&gt;            &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
##  1 Agnostic            27        34        60        81        76       137
##  2 Atheist             12        27        37        52        35        70
##  3 Buddhist            27        21        30        34        33        58
##  4 Catholic           418       617       732       670       638      1116
##  5 Don’t know/re~      15        14        15        11        10        35
##  6 Evangelical P~     575       869      1064       982       881      1486
##  7 Hindu                1         9         7         9        11        34
##  8 Historically ~     228       244       236       238       197       223
##  9 Jehovah&#39;s Wit~      20        27        24        24        21        30
## 10 Jewish              19        19        25        25        30        95
## 11 Mainline Prot      289       495       619       655       651      1107
## 12 Mormon              29        40        48        51        56       112
## 13 Muslim               6         7         9        10         9        23
## 14 Orthodox            13        17        23        32        32        47
## 15 Other Christi~       9         7        11        13        13        14
## 16 Other Faiths        20        33        40        46        49        63
## 17 Other World R~       5         2         3         4         2         7
## 18 Unaffiliated       217       299       374       365       341       528
## # ... with 4 more variables: $75-100k &lt;dbl&gt;, $100-150k &lt;dbl&gt;, &gt;150k &lt;dbl&gt;,
## #   Don&#39;t know/refused &lt;dbl&gt;</code></pre>
<p></p>
<p>Essa tabela está nos apresentando o salário médio de pessoas pertencentes a diferentes religiões. Veja que em cada coluna dessa tabela, você possui os dados de um nível (ou faixa) salarial específico. Essa é uma estrutura que pode ser fácil e intuitiva em alguns momentos, mas certamente irá trazer limites importantes para você dentro do R. Devido a especialidade que o R possui sobre operações vetorizadas, o ideal seria transformarmos essa tabela para o formato <em>tidy</em>.</p>
<p>A unidade básica dessa tabela, são os grupos religiosos, e a faixa salarial representa uma característica desses grupos. Há diferentes níveis salariais na tabela, que estão sendo distribuídos ao longo de diferentes colunas. Tendo em vista isso, uma das regras não está sendo respeita, pois todos esses diferentes níveis salarias, representam uma única característica, ou em outras palavras, eles transmitem o mesmo tipo de informação, que é um nível salarial daquele grupo religioso. Por isso, todas essas características da tabela, deve estar em uma única coluna. Em uma representação visual resumida, é isso o que precisamos fazer:</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/pivo1.png" alt="Representação de uma operação de pivô" width="100%" />
<p class="caption">
(#fig:unnamed-chunk-390)Representação de uma operação de pivô
</p>
</div>
<p></p>
<p>Por isso, quando você estiver em um momento como este, em que você deseja reformatar a sua tabela, ou em outras palavras, transformar as suas linhas em colunas, ou vice-versa, você está na verdade, procurando realizar uma operação de pivô.</p>
<p>Nestas situações, você deve primeiro pensar como a sua tabela ficará, após a operação de pivô que você deseja aplicar. Ou seja, após essa operação, a sua tabela ficará com mais linhas/colunas? Ou menos linhas/colunas? Em outras palavras, você precisa identificar se você deseja tornar a sua tabela mais longa (aumentar o número de linhas, e reduzir o número de colunas), ou então, se você deseja torná-la mais larga (reduzir o número de linhas, e aumentar o número de colunas).</p>
<div id="adicionando-linhas-à-sua-tabela-com-pivot_longer" class="section level3" number="7.3.1">
<h3 number="7.3.1"><span class="header-section-number">7.3.1</span> Adicionando linhas à sua tabela com <code>pivot_longer()</code></h3>
<p>Atualmente, a tabela <code>relig_income</code> possui poucas linhas e muitas colunas, e por isso, ela adquire um aspecto visual de “larga.” Como eu disse, seria muito interessante para você, que transformasse essa tabela, de modo a agrupar as diferentes faixas de níveis salarias em menos colunas. Logo, se estamos falando em reduzir o número de colunas, estamos querendo alongar a base, ou dito de outra forma, aumentar o número de linhas da base. Para fazermos isso, devemos utilizar a função <code>pivot_longer()</code>.</p>
<p>Essa função possui três argumentos principais: 1) <code>cols</code>, os nomes das colunas que você deseja transformar em linhas; 2) <code>names_to</code>, o nome da nova coluna onde serão alocados os nomes, ou os rótulos das colunas que você definiu em <code>cols</code>; 3) <code>values_to</code>, o nome da nova coluna onde serão alocados os valores da sua tabela, que se encontram nas colunas que você definiu em <code>cols</code>. Como nós queremos transformar todas as colunas da tabela <code>relig_income</code>, que contém faixas salariais, eu posso simplesmente colocar no argumento <code>cols</code>, um símbolo de menos antes do nome da coluna <code>religion</code>, que é a única coluna da tabela, que não possui esse tipo de informação. Ou seja, dessa forma, eu estou dizendo à <code>pivot_longer()</code>, para transformar todas as colunas (exceto a coluna <code>religion</code>).</p>
<p></p>
<div class="sourceCode" id="cb756"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb756-1"><a href="#cb756-1" aria-hidden="true" tabindex="-1"></a>relig_income <span class="sc">%&gt;%</span> </span>
<span id="cb756-2"><a href="#cb756-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb756-3"><a href="#cb756-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="sc">-</span>religion,</span>
<span id="cb756-4"><a href="#cb756-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">&quot;income&quot;</span>,</span>
<span id="cb756-5"><a href="#cb756-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">&quot;values&quot;</span></span>
<span id="cb756-6"><a href="#cb756-6" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 180 x 3
##    religion income             values
##    &lt;chr&gt;    &lt;chr&gt;               &lt;dbl&gt;
##  1 Agnostic &lt;$10k                  27
##  2 Agnostic $10-20k                34
##  3 Agnostic $20-30k                60
##  4 Agnostic $30-40k                81
##  5 Agnostic $40-50k                76
##  6 Agnostic $50-75k               137
##  7 Agnostic $75-100k              122
##  8 Agnostic $100-150k             109
##  9 Agnostic &gt;150k                  84
## 10 Agnostic Don&#39;t know/refused     96
## # ... with 170 more rows</code></pre>
<p></p>
<p>Vale destacar, que você pode selecionar as colunas que você deseja transformar em linhas (argumento <code>cols</code>), através dos mesmos mecanismos que utilizamos na função <code>select()</code>. Ao eliminarmos a coluna <code>religion</code> com um sinal de menos (<code>-</code>) estávamos utilizando justamente um desses métodos. Mas podemos também, por exemplo, selecionar todas as colunas, que possuem dados de tipo numérico, com a função <code>is.numeric()</code>, atingindo o mesmo resultado anterior. Ou então, poderíamos selecionar todas as colunas que possuem em seu nome, algum dígito numérico, através da expressão regular <code>"\\d"</code> (<em>digit</em>) na função <code>matches()</code>.</p>
<p></p>
<div class="sourceCode" id="cb758"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb758-1"><a href="#cb758-1" aria-hidden="true" tabindex="-1"></a>relig_income <span class="sc">%&gt;%</span> </span>
<span id="cb758-2"><a href="#cb758-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb758-3"><a href="#cb758-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> is.numeric,</span>
<span id="cb758-4"><a href="#cb758-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">&quot;income&quot;</span>,</span>
<span id="cb758-5"><a href="#cb758-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">&quot;values&quot;</span></span>
<span id="cb758-6"><a href="#cb758-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb758-7"><a href="#cb758-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb758-8"><a href="#cb758-8" aria-hidden="true" tabindex="-1"></a>relig_income <span class="sc">%&gt;%</span> </span>
<span id="cb758-9"><a href="#cb758-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb758-10"><a href="#cb758-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">matches</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">d&quot;</span>),</span>
<span id="cb758-11"><a href="#cb758-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">&quot;income&quot;</span>,</span>
<span id="cb758-12"><a href="#cb758-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">&quot;values&quot;</span></span>
<span id="cb758-13"><a href="#cb758-13" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p></p>
<p>Portanto, sempre que utilizar a função <code>pivot_longer()</code>, duas novas colunas serão criadas. Em uma dessas colunas (<code>values_to</code>), a função irá guardar os valores que se encontravam nas colunas que você transformou em linhas. Já na outra coluna (<code>names_to</code>), a função irá criar rótulos em cada linha, que lhe informam de qual coluna (que você transformou em linhas) veio o valor disposto na coluna anterior (<code>values_to</code>). Você sempre deve definir o nome dessas duas novas colunas, como texto, isto é, sempre forneça os nomes dessas colunas, entre aspas duplas ou simples.</p>
<p>Um outro exemplo, seria a tabela <code>billboard</code>, que também está disponível no pacote <code>tidyr</code>. Nessa tabela, temos a posição que diversas músicas ocuparam na lista da Billboard das 100 músicas mais populares no mundo, durante o ano de 2000. Portanto a posição que cada uma dessas músicas ocuparam nessa lista, ao longo do tempo, é a unidade básica que está sendo tratada nessa tabela. Agora, repare que a tabela possui muitas colunas (79 no total), onde em cada uma delas, temos a posição de uma música em uma dada semana desde a sua entrada na lista.</p>
<p></p>
<div class="sourceCode" id="cb759"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb759-1"><a href="#cb759-1" aria-hidden="true" tabindex="-1"></a>billboard</span></code></pre></div>
<pre><code>## # A tibble: 317 x 79
##    artist   track    date.entered   wk1   wk2   wk3   wk4   wk5   wk6   wk7
##    &lt;chr&gt;    &lt;chr&gt;    &lt;date&gt;       &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 2 Pac    Baby Do~ 2000-02-26      87    82    72    77    87    94    99
##  2 2Ge+her  The Har~ 2000-09-02      91    87    92    NA    NA    NA    NA
##  3 3 Doors~ Krypton~ 2000-04-08      81    70    68    67    66    57    54
##  4 3 Doors~ Loser    2000-10-21      76    76    72    69    67    65    55
##  5 504 Boyz Wobble ~ 2000-04-15      57    34    25    17    17    31    36
##  6 98^0     Give Me~ 2000-08-19      51    39    34    26    26    19     2
##  7 A*Teens  Dancing~ 2000-07-08      97    97    96    95   100    NA    NA
##  8 Aaliyah  I Don&#39;t~ 2000-01-29      84    62    51    41    38    35    35
##  9 Aaliyah  Try Aga~ 2000-03-18      59    53    38    28    21    18    16
## 10 Adams, ~ Open My~ 2000-08-26      76    76    74    69    68    67    61
## # ... with 307 more rows, and 69 more variables: wk8 &lt;dbl&gt;, wk9 &lt;dbl&gt;,
## #   wk10 &lt;dbl&gt;, wk11 &lt;dbl&gt;, wk12 &lt;dbl&gt;, wk13 &lt;dbl&gt;, wk14 &lt;dbl&gt;,
## #   wk15 &lt;dbl&gt;, wk16 &lt;dbl&gt;, wk17 &lt;dbl&gt;, wk18 &lt;dbl&gt;, wk19 &lt;dbl&gt;,
## #   wk20 &lt;dbl&gt;, wk21 &lt;dbl&gt;, wk22 &lt;dbl&gt;, wk23 &lt;dbl&gt;, wk24 &lt;dbl&gt;,
## #   wk25 &lt;dbl&gt;, wk26 &lt;dbl&gt;, wk27 &lt;dbl&gt;, wk28 &lt;dbl&gt;, wk29 &lt;dbl&gt;,
## #   wk30 &lt;dbl&gt;, wk31 &lt;dbl&gt;, wk32 &lt;dbl&gt;, wk33 &lt;dbl&gt;, wk34 &lt;dbl&gt;,
## #   wk35 &lt;dbl&gt;, wk36 &lt;dbl&gt;, wk37 &lt;dbl&gt;, wk38 &lt;dbl&gt;, wk39 &lt;dbl&gt;, ...</code></pre>
<p></p>
<p>Repare também, que temos nessa tabela, mais semanas do que o total de semanas contidas em um ano corrido (<span class="math inline">\(365/7 \approx 52\)</span> semanas). Pela descrição das colunas restantes, que se encontra logo abaixo da tabela, vemos que a tabela possui dados até a 76° semana (<code>wk76</code>). Isso provavelmente ocorre, porque algumas músicas que estão sendo descritas nessa tabela, entraram para a lista da Billboard no meio do ano anterior (1999), e, portanto, permaneceram na lista mesmo durante o ano de 2000, ultrapassando o período de 1 ano, e, portanto, de 52 semanas.</p>
<p>Agora, está claro que a forma como essa tabela está organizada, pode lhe trazer um trabalho imenso. Especialmente se você precisar aplicar uma função sobre cada uma dessas 76 colunas separadamente. Por isso, o ideal seria transformarmos todas essas 76 colunas, em novas linhas de sua tabela.</p>
<p>Porém, você não vai querer digitar o nome de cada uma dessas 76 colunas, no argumento <code>cols</code> de <code>pivot_longer()</code>. Novamente, quando há um conjunto muito grande de colunas que desejamos selecionar, podemos utilizar os métodos alternativos de seleção que vimos em <code>select()</code>. Por exemplo, podemos selecionar todas essas colunas pelos seus índices. No primeiro exemplo abaixo, estamos fazendo justamente isso, ao dizer à função em <code>cols</code>, que desejamos transformar todas as colunas entre a 4° e a 79° coluna. Uma outra alternativa, seria selecionarmos todas as colunas que possuem nomes que começam por “wk,” com a função <code>starts_with()</code>. Ambas alternativas, geram o mesmo resultado.</p>
<p></p>
<div class="sourceCode" id="cb761"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb761-1"><a href="#cb761-1" aria-hidden="true" tabindex="-1"></a>billboard_long <span class="ot">&lt;-</span> billboard <span class="sc">%&gt;%</span> </span>
<span id="cb761-2"><a href="#cb761-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb761-3"><a href="#cb761-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="dv">4</span><span class="sc">:</span><span class="dv">79</span>,</span>
<span id="cb761-4"><a href="#cb761-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">&quot;week&quot;</span>,</span>
<span id="cb761-5"><a href="#cb761-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">&quot;position&quot;</span></span>
<span id="cb761-6"><a href="#cb761-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb761-7"><a href="#cb761-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb761-8"><a href="#cb761-8" aria-hidden="true" tabindex="-1"></a>billboard_long <span class="ot">&lt;-</span> billboard <span class="sc">%&gt;%</span> </span>
<span id="cb761-9"><a href="#cb761-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb761-10"><a href="#cb761-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">&quot;wk&quot;</span>),</span>
<span id="cb761-11"><a href="#cb761-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">&quot;week&quot;</span>,</span>
<span id="cb761-12"><a href="#cb761-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">&quot;position&quot;</span></span>
<span id="cb761-13"><a href="#cb761-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb761-14"><a href="#cb761-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb761-15"><a href="#cb761-15" aria-hidden="true" tabindex="-1"></a>billboard_long</span></code></pre></div>
<pre><code>## # A tibble: 24,092 x 5
##    artist track                   date.entered week  position
##    &lt;chr&gt;  &lt;chr&gt;                   &lt;date&gt;       &lt;chr&gt;    &lt;dbl&gt;
##  1 2 Pac  Baby Don&#39;t Cry (Keep... 2000-02-26   wk1         87
##  2 2 Pac  Baby Don&#39;t Cry (Keep... 2000-02-26   wk2         82
##  3 2 Pac  Baby Don&#39;t Cry (Keep... 2000-02-26   wk3         72
##  4 2 Pac  Baby Don&#39;t Cry (Keep... 2000-02-26   wk4         77
##  5 2 Pac  Baby Don&#39;t Cry (Keep... 2000-02-26   wk5         87
##  6 2 Pac  Baby Don&#39;t Cry (Keep... 2000-02-26   wk6         94
##  7 2 Pac  Baby Don&#39;t Cry (Keep... 2000-02-26   wk7         99
##  8 2 Pac  Baby Don&#39;t Cry (Keep... 2000-02-26   wk8         NA
##  9 2 Pac  Baby Don&#39;t Cry (Keep... 2000-02-26   wk9         NA
## 10 2 Pac  Baby Don&#39;t Cry (Keep... 2000-02-26   wk10        NA
## # ... with 24,082 more rows</code></pre>
<p></p>
<p>Tais métodos de seleção são muito eficazes, e trazem grande otimização para o seu trabalho. Entretanto, em muitas ocasiões que utilizar essas funções de pivô, você vai precisar transformar apenas um conjunto pequeno de colunas em sua tabela. Nestes casos, talvez seja mais simples, definir diretamente os nomes das colunas que você deseja transformar, em <code>cols</code>. Veja por exemplo, a tabela <code>df</code> que eu crio logo abaixo.</p>
<p></p>
<div class="sourceCode" id="cb763"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb763-1"><a href="#cb763-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb763-2"><a href="#cb763-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">nome =</span> <span class="fu">c</span>(<span class="st">&quot;Ana&quot;</span>, <span class="st">&quot;Eduardo&quot;</span>, <span class="st">&quot;Paulo&quot;</span>),</span>
<span id="cb763-3"><a href="#cb763-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">2005</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">1800</span>, <span class="dv">2100</span>, <span class="dv">1230</span>),</span>
<span id="cb763-4"><a href="#cb763-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">2006</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">2120</span>, <span class="dv">2100</span>, <span class="dv">1450</span>),</span>
<span id="cb763-5"><a href="#cb763-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">2007</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">2120</span>, <span class="dv">2100</span>, <span class="dv">1980</span>),</span>
<span id="cb763-6"><a href="#cb763-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">2008</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">3840</span>, <span class="dv">2100</span>, <span class="dv">2430</span>)</span>
<span id="cb763-7"><a href="#cb763-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb763-8"><a href="#cb763-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb763-9"><a href="#cb763-9" aria-hidden="true" tabindex="-1"></a>df</span></code></pre></div>
<pre><code>## # A tibble: 3 x 5
##   nome    `2005` `2006` `2007` `2008`
##   &lt;chr&gt;    &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
## 1 Ana       1800   2120   2120   3840
## 2 Eduardo   2100   2100   2100   2100
## 3 Paulo     1230   1450   1980   2430</code></pre>
<p></p>
<p>Essa tabela contém os salários médios de três indivíduos hipotéticos, ao longo de quatro anos diferentes. Note que esses quatro anos, estão distribuídos ao longo de quatro colunas dessa tabela. Nesse exemplo, podemos utilizar novamente a função <code>pivot_longer()</code>, para transformarmos essas colunas em linhas. Dessa forma, temos o seguinte resultado:</p>
<p></p>
<div class="sourceCode" id="cb765"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb765-1"><a href="#cb765-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> </span>
<span id="cb765-2"><a href="#cb765-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb765-3"><a href="#cb765-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(<span class="st">&quot;2005&quot;</span>, <span class="st">&quot;2006&quot;</span>, <span class="st">&quot;2007&quot;</span>, <span class="st">&quot;2008&quot;</span>),</span>
<span id="cb765-4"><a href="#cb765-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">&quot;ano&quot;</span>,</span>
<span id="cb765-5"><a href="#cb765-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">&quot;salario&quot;</span></span>
<span id="cb765-6"><a href="#cb765-6" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 12 x 3
##    nome    ano   salario
##    &lt;chr&gt;   &lt;chr&gt;   &lt;dbl&gt;
##  1 Ana     2005     1800
##  2 Ana     2006     2120
##  3 Ana     2007     2120
##  4 Ana     2008     3840
##  5 Eduardo 2005     2100
##  6 Eduardo 2006     2100
##  7 Eduardo 2007     2100
##  8 Eduardo 2008     2100
##  9 Paulo   2005     1230
## 10 Paulo   2006     1450
## 11 Paulo   2007     1980
## 12 Paulo   2008     2430</code></pre>
<p></p>
</div>
<div id="adicionando-colunas-à-sua-tabela-com-pivot_wider" class="section level3" number="7.3.2">
<h3 number="7.3.2"><span class="header-section-number">7.3.2</span> Adicionando colunas à sua tabela com <code>pivot_wider()</code></h3>
<p>Por outro lado, você talvez deseje realizar a operação contrária. Ou seja, se você deseja transformar linhas de sua tabela, em novas colunas, você deve utilizar a função <code>pivot_wider()</code>, que possui argumentos muito parecidos com os de <code>pivot_longer()</code>.</p>
<p>Vamos começar com um exemplo simples. Veja a tabela <code>df</code> que estou criando logo abaixo. Nessa tabela, temos dados como o peso, a idade e a altura de cinco pessoas diferentes. Porém, perceba que essa tabela, não está no formato <em>tidy</em>. Pois temos três informações (peso, idade e altura) que representam características diferentes da unidade básica da tabela (pessoas), que estão em uma mesma coluna (<code>variavel</code>).</p>
<p></p>
<div class="sourceCode" id="cb767"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb767-1"><a href="#cb767-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">structure</span>(<span class="fu">list</span>(<span class="at">nome =</span> <span class="fu">c</span>(<span class="st">&quot;Ana&quot;</span>, <span class="st">&quot;Ana&quot;</span>, <span class="st">&quot;Ana&quot;</span>, <span class="st">&quot;Eduardo&quot;</span>, <span class="st">&quot;Eduardo&quot;</span>, </span>
<span id="cb767-2"><a href="#cb767-2" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;Eduardo&quot;</span>, <span class="st">&quot;Paulo&quot;</span>, <span class="st">&quot;Paulo&quot;</span>, <span class="st">&quot;Paulo&quot;</span>, <span class="st">&quot;Henrique&quot;</span>, <span class="st">&quot;Henrique&quot;</span>, </span>
<span id="cb767-3"><a href="#cb767-3" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;Henrique&quot;</span>, <span class="st">&quot;Letícia&quot;</span>, <span class="st">&quot;Letícia&quot;</span>, <span class="st">&quot;Letícia&quot;</span>), <span class="at">variavel =</span> <span class="fu">c</span>(<span class="st">&quot;idade&quot;</span>, </span>
<span id="cb767-4"><a href="#cb767-4" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;peso&quot;</span>, <span class="st">&quot;altura&quot;</span>, <span class="st">&quot;idade&quot;</span>, <span class="st">&quot;peso&quot;</span>, <span class="st">&quot;altura&quot;</span>, <span class="st">&quot;idade&quot;</span>, <span class="st">&quot;peso&quot;</span>, </span>
<span id="cb767-5"><a href="#cb767-5" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;altura&quot;</span>, <span class="st">&quot;idade&quot;</span>, <span class="st">&quot;peso&quot;</span>, <span class="st">&quot;altura&quot;</span>, <span class="st">&quot;idade&quot;</span>, <span class="st">&quot;peso&quot;</span>, <span class="st">&quot;altura&quot;</span></span>
<span id="cb767-6"><a href="#cb767-6" aria-hidden="true" tabindex="-1"></a>), <span class="at">valor =</span> <span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">61</span>, <span class="fl">1.67</span>, <span class="dv">18</span>, <span class="dv">90</span>, <span class="fl">1.89</span>, <span class="dv">19</span>, <span class="dv">68</span>, <span class="fl">1.67</span>, <span class="dv">23</span>, <span class="dv">82</span>, </span>
<span id="cb767-7"><a href="#cb767-7" aria-hidden="true" tabindex="-1"></a><span class="fl">1.72</span>, <span class="dv">27</span>, <span class="dv">56</span>, <span class="fl">1.58</span>)), <span class="at">row.names =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="sc">-</span>15L), <span class="at">class =</span> <span class="fu">c</span>(<span class="st">&quot;tbl_df&quot;</span>, </span>
<span id="cb767-8"><a href="#cb767-8" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;tbl&quot;</span>, <span class="st">&quot;data.frame&quot;</span>))</span>
<span id="cb767-9"><a href="#cb767-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb767-10"><a href="#cb767-10" aria-hidden="true" tabindex="-1"></a>df</span></code></pre></div>
<pre><code>## # A tibble: 15 x 3
##    nome     variavel valor
##    &lt;chr&gt;    &lt;chr&gt;    &lt;dbl&gt;
##  1 Ana      idade    20   
##  2 Ana      peso     61   
##  3 Ana      altura    1.67
##  4 Eduardo  idade    18   
##  5 Eduardo  peso     90   
##  6 Eduardo  altura    1.89
##  7 Paulo    idade    19   
##  8 Paulo    peso     68   
##  9 Paulo    altura    1.67
## 10 Henrique idade    23   
## 11 Henrique peso     82   
## 12 Henrique altura    1.72
## 13 Letícia  idade    27   
## 14 Letícia  peso     56   
## 15 Letícia  altura    1.58</code></pre>
<p></p>
<p>Portanto, tendo identificado o problema, precisamos agora, separar as três variáveis contidas na coluna <code>variavel</code>, em três novas colunas da tabela <code>df</code>. Logo, precisamos alargar a nossa base, pois estamos eliminando linhas e adicionando colunas à tabela.</p>
<p>Já sabemos que podemos utilizar a função <code>pivot_wider()</code> para esse trabalho, mas eu ainda não descrevi os seus argumentos, que são os seguintes: 1) <code>id_cols</code>, sendo as colunas que são suficientes para, ou capazes de, identificar uma única observação de sua base; 2) <code>names_from</code>, qual a coluna de sua tabela que contém as linhas a serem dividas, ou transformadas, em várias outras colunas; 3) <code>values_from</code>, qual a coluna, que contém os valores a serem posicionados nas novas células, que serão criadas durante o processo de “alargamento” da sua tabela.</p>
<p>Antes de prosseguirmos para os exemplos práticos, é provavelmente uma boa ideia, refletirmos sobre o que o argumento <code>id_cols</code> significa. Para que você identifique as colunas a serem estipuladas no argumento <code>id_cols</code>, você precisa primeiro identificar a unidade básica que está sendo tratada em sua tabela. No nosso caso, a tabela <code>df</code>, contém dados sobre características físicas ou biológicas, de cinco pessoas diferentes. Logo, a unidade básica dessa tabela, são as pessoas que estão sendo descritas nela, e por isso, a coluna <code>nome</code> é capaz de identificar cada unidade básica, pois ela nos traz justamente um código social de identificação, isto é, o nome dessas pessoas.</p>
<p>Porém, repare que cada pessoa descrita na tabela <code>df</code>, não possui a sua própria linha na tabela. Veja por exemplo, as informações referentes à Ana, que estão definidas ao longo das três primeiras linhas da tabela. Com isso, eu quero apenas destacar que cada unidade básica, ou cada observação de sua tabela, não necessariamente vai se encontrar em uma única linha, e que isso não deve ser uma regra (ou um guia) para selecionarmos as colunas de <code>id_cols</code>. Até porque, nós estamos utilizando uma operação de pivô sobre a nossa tabela, justamente pelo fato dela não estar no formato <em>tidy</em>. Ou seja, se uma das características que definem o formato <em>tidy</em>, não estão sendo respeitados, é muito provável, que cada observação de sua base, não se encontre em uma única linha.</p>
<p>Pensando em um outro exemplo, se você dispõe de uma base que descreve o PIB de cada município do estado de Minas Gerais, você precisa definir em <code>id_cols</code>, a coluna (ou o conjunto de colunas) que é capaz de identificar cada um dos 853 municípios de MG, pois esses municípios são a unidade básica da tabela. Porém, se a sua base está descrevendo o PIB desses mesmos municípios, mas agora ao longo dos anos de 2010 a 2020, a sua unidade básica passa a ter um componente temporal, e se torna a evolução desses municípios ao longo do tempo. Dessa forma, você precisaria não apenas de uma coluna que seja capaz de identificar qual o município que está sendo descrito na base, mas também de uma outra coluna que possa identificar qual o ano que a informação desse município se refere.</p>
<p>Tendo isso em mente, vamos partir para os próximos dois argumentos. No nosso caso, queremos pegar as três variáveis que estão ao longo da coluna <code>variavel</code>, e separá-las em três colunas diferentes. Isso é exatamente o que devemos definir em <code>names_from</code>. O que este argumento está pedindo, é o nome da coluna que contém os valores que vão servir de nome para as novas colunas que <code>pivot_wider()</code> irá criar. Ou seja, ao fornecermos a coluna <code>variavel</code> para <code>names_from</code>, <code>pivot_wider()</code> irá criar uma nova coluna para cada valor único que se encontra na coluna <code>variavel</code>. Como ao longo da coluna <code>variavel</code>, temos três valores diferentes (peso, altura e idade), <code>pivot_wider()</code> irá criar três novas colunas que possuem os nomes de <code>peso</code>, <code>altura</code> e <code>idade</code>.</p>
<p>Ao criar as novas colunas, você precisa preenchê-las de alguma forma, a menos que você deseja deixá-las vazias. Em outras palavras, a função <code>pivot_wider()</code> irá lhe perguntar: “Ok, eu criei as colunas que você me pediu para criar, mas eu devo preenchê-las com que valores?” Você deve responder essa pergunta, através do argumento <code>values_from</code>, onde você irá definir qual é a coluna que contém os valores que você deseja alocar ao longo dessas novas colunas (que foram criadas de acordo com os valores contidos na coluna que você definiu em <code>names_from</code>). Na nossa tabela <code>df</code>, é a coluna <code>valor</code> que contém os registros, ou os valores que cada variável (idade, altura e peso) assume nessa amostra. Logo, é essa coluna que devemos conectar à <code>values_from</code>.</p>
<p></p>
<div class="sourceCode" id="cb769"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb769-1"><a href="#cb769-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> </span>
<span id="cb769-2"><a href="#cb769-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb769-3"><a href="#cb769-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">id_cols =</span> nome,</span>
<span id="cb769-4"><a href="#cb769-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> variavel,</span>
<span id="cb769-5"><a href="#cb769-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> valor</span>
<span id="cb769-6"><a href="#cb769-6" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 5 x 4
##   nome     idade  peso altura
##   &lt;chr&gt;    &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
## 1 Ana         20    61   1.67
## 2 Eduardo     18    90   1.89
## 3 Paulo       19    68   1.67
## 4 Henrique    23    82   1.72
## 5 Letícia     27    56   1.58</code></pre>
<p></p>
<p>Esse foi um exemplo simples de como utilizar a função, e que vai lhe servir de base para praticamente qualquer aplicação de <code>pivot_wider()</code>. Porém, em algumas situações que você utilizar <code>pivot_wider()</code>, pode ser que a sua tabela não possua colunas o suficiente, que possam identificar unicamente cada observação de sua base, e isso, ficará mais claro com um outro exemplo.</p>
<p>Com o código abaixo, você é capaz de recriar a tabela <code>vendas</code>, em seu R. Lembre-se de executar a função <code>set.seed()</code> antes de criar a tabela <code>vendas</code>, pois é essa função que garante que você irá recriar exatamente a mesma tabela que a minha. Nessa tabela <code>vendas</code>, possuímos vendas hipóteticas de diversos produtos (identificados por <code>produtoid</code>), realizadas por alguns vendedores (identificados por <code>usuario</code>) que arrecadaram em cada venda os valores descritos na coluna <code>valor</code>. Perceba também, que essas vendas são diárias, pois possuímos outras três colunas (<code>ano</code>, <code>mes</code> e <code>dia</code>) que definem o dia em que a venda ocorreu.</p>
<p></p>
<div class="sourceCode" id="cb771"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb771-1"><a href="#cb771-1" aria-hidden="true" tabindex="-1"></a>nomes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Ana&quot;</span>, <span class="st">&quot;Eduardo&quot;</span>, <span class="st">&quot;Paulo&quot;</span>, <span class="st">&quot;Henrique&quot;</span>, <span class="st">&quot;Letícia&quot;</span>)</span>
<span id="cb771-2"><a href="#cb771-2" aria-hidden="true" tabindex="-1"></a>produto <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;10032&quot;</span>, <span class="st">&quot;10013&quot;</span>, <span class="st">&quot;10104&quot;</span>, <span class="st">&quot;10555&quot;</span>, <span class="st">&quot;10901&quot;</span>)</span>
<span id="cb771-3"><a href="#cb771-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb771-4"><a href="#cb771-4" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb771-5"><a href="#cb771-5" aria-hidden="true" tabindex="-1"></a>vendas <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb771-6"><a href="#cb771-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">ano =</span> <span class="fu">sample</span>(<span class="dv">2010</span><span class="sc">:</span><span class="dv">2020</span>, <span class="at">size =</span> <span class="dv">10000</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb771-7"><a href="#cb771-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">mes =</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="at">size =</span> <span class="dv">10000</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb771-8"><a href="#cb771-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">dia =</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">31</span>, <span class="at">size =</span> <span class="dv">10000</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb771-9"><a href="#cb771-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">usuario =</span> <span class="fu">sample</span>(nomes, <span class="at">size =</span> <span class="dv">10000</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb771-10"><a href="#cb771-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">valor =</span> <span class="fu">rnorm</span>(<span class="dv">10000</span>, <span class="at">mean =</span> <span class="dv">5000</span>, <span class="at">sd =</span> <span class="dv">1600</span>),</span>
<span id="cb771-11"><a href="#cb771-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">produtoid =</span> <span class="fu">sample</span>(produto, <span class="at">size =</span> <span class="dv">10000</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb771-12"><a href="#cb771-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb771-13"><a href="#cb771-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(ano, mes, dia, usuario)</span>
<span id="cb771-14"><a href="#cb771-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb771-15"><a href="#cb771-15" aria-hidden="true" tabindex="-1"></a>vendas</span></code></pre></div>
<pre><code>## # A tibble: 10,000 x 6
##      ano   mes   dia usuario  valor produtoid
##    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;    
##  1  2010     1     1 Ana      3907. 10104    
##  2  2010     1     1 Henrique 6139. 10104    
##  3  2010     1     2 Henrique 5510. 10013    
##  4  2010     1     3 Ana      5296. 10555    
##  5  2010     1     3 Letícia  3525. 10555    
##  6  2010     1     4 Ana      5102. 10555    
##  7  2010     1     4 Eduardo  6051. 10013    
##  8  2010     1     4 Letícia  4600. 10032    
##  9  2010     1     5 Paulo    5869. 10104    
## 10  2010     1     6 Ana      7188. 10013    
## # ... with 9,990 more rows</code></pre>
<p></p>
<p>Vou antes de mais nada, identificar os níveis (ou valores únicos) contidos nas duas colunas que vão servir de objeto de estudo, para os próximos exemplos. Caso você queira visualizar todos os valores únicos contidos em uma coluna, você pode realizar tal ação através da função <code>unique()</code>. Perceba pelos resultados abaixo, que nós temos cinco vendedores e cinco produtos diferentes que estão sendo descritos ao longo da tabela <code>vendas</code>.</p>
<p></p>
<div class="sourceCode" id="cb773"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb773-1"><a href="#cb773-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(vendas<span class="sc">$</span>usuario)</span></code></pre></div>
<pre><code>## [1] &quot;Ana&quot;      &quot;Henrique&quot; &quot;Letícia&quot;  &quot;Eduardo&quot;  &quot;Paulo&quot;</code></pre>
<div class="sourceCode" id="cb775"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb775-1"><a href="#cb775-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(vendas<span class="sc">$</span>produtoid)</span></code></pre></div>
<pre><code>## [1] &quot;10104&quot; &quot;10013&quot; &quot;10555&quot; &quot;10032&quot; &quot;10901&quot;</code></pre>
<p></p>
<p>Portanto, vamos para o exemplo. Já adianto, que se você tentar distribuir tanto os vendedores (<code>usuario</code>), quanto os produtos vendidos (<code>produtoid</code>), em novas colunas de nossa tabela, utilizando <code>pivot_wider()</code>, um aviso será levantado, e o resultado dessa operação (apesar de correto) será provavelmente, muito estranho para você. Primeiro, veja com os seus próprios olhos, qual é o resultado dessa aplicação, com a coluna <code>usuario</code>:</p>
<p></p>
<div class="sourceCode" id="cb777"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb777-1"><a href="#cb777-1" aria-hidden="true" tabindex="-1"></a>vendas_wide <span class="ot">&lt;-</span> vendas <span class="sc">%&gt;%</span> </span>
<span id="cb777-2"><a href="#cb777-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb777-3"><a href="#cb777-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">id_cols =</span> <span class="fu">c</span>(<span class="st">&quot;ano&quot;</span>, <span class="st">&quot;mes&quot;</span>, <span class="st">&quot;dia&quot;</span>, <span class="st">&quot;produtoid&quot;</span>),</span>
<span id="cb777-4"><a href="#cb777-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> usuario,</span>
<span id="cb777-5"><a href="#cb777-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> valor</span>
<span id="cb777-6"><a href="#cb777-6" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## Warning: Values are not uniquely identified; output will contain list-cols.
## * Use `values_fn = list` to suppress this warning.
## * Use `values_fn = length` to identify where the duplicates arise
## * Use `values_fn = {summary_fun}` to summarise duplicates</code></pre>
<div class="sourceCode" id="cb779"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb779-1"><a href="#cb779-1" aria-hidden="true" tabindex="-1"></a>vendas_wide</span></code></pre></div>
<pre><code>## # A tibble: 7,845 x 9
##      ano   mes   dia produtoid Ana       Henrique  Letícia   Eduardo  Paulo
##    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;     &lt;list&gt;    &lt;list&gt;    &lt;list&gt;    &lt;list&gt;   &lt;lis&gt;
##  1  2010     1     1 10104     &lt;dbl [1]&gt; &lt;dbl [1]&gt; &lt;NULL&gt;    &lt;NULL&gt;   &lt;NUL~
##  2  2010     1     2 10013     &lt;NULL&gt;    &lt;dbl [1]&gt; &lt;NULL&gt;    &lt;NULL&gt;   &lt;NUL~
##  3  2010     1     3 10555     &lt;dbl [1]&gt; &lt;NULL&gt;    &lt;dbl [1]&gt; &lt;NULL&gt;   &lt;NUL~
##  4  2010     1     4 10555     &lt;dbl [1]&gt; &lt;NULL&gt;    &lt;NULL&gt;    &lt;NULL&gt;   &lt;NUL~
##  5  2010     1     4 10013     &lt;NULL&gt;    &lt;NULL&gt;    &lt;NULL&gt;    &lt;dbl [1~ &lt;NUL~
##  6  2010     1     4 10032     &lt;NULL&gt;    &lt;NULL&gt;    &lt;dbl [1]&gt; &lt;NULL&gt;   &lt;NUL~
##  7  2010     1     5 10104     &lt;NULL&gt;    &lt;NULL&gt;    &lt;NULL&gt;    &lt;NULL&gt;   &lt;dbl~
##  8  2010     1     6 10013     &lt;dbl [1]&gt; &lt;NULL&gt;    &lt;NULL&gt;    &lt;NULL&gt;   &lt;NUL~
##  9  2010     1     6 10901     &lt;NULL&gt;    &lt;NULL&gt;    &lt;dbl [1]&gt; &lt;NULL&gt;   &lt;NUL~
## 10  2010     1     7 10013     &lt;NULL&gt;    &lt;dbl [1]&gt; &lt;NULL&gt;    &lt;NULL&gt;   &lt;dbl~
## # ... with 7,835 more rows</code></pre>
<p></p>
<p>Como podemos ver pelo resultado acima, uma mensagem de aviso apareceu, nos informando que os valores não podem ser unicamente identificados através das colunas que fornecemos em <code>id_cols</code> (<em>Values are not uniquely identified</em>), e que por isso, a função <code>pivot_wider()</code>, acabou transformando as novas colunas que criamos, em listas (<em>output will contain list-cols.</em>).</p>
<p>Ou seja, cada uma das colunas que acabamos de criar com <code>pivot_wider()</code>, estão na estrutura de um vetor recursivo (i.e. listas). Isso pode ser estranho para muitos usuários, pois na maioria das vezes, as colunas de suas tabelas serão vetores atômicos<a href="#fn16" class="footnote-ref" id="fnref16"><sup>16</sup></a>. Um outro motivo que provavelmente levantou bastante dúvida em sua cabeça é: “Como assim as colunas que forneci não são capazes de identificar unicamente os valores? Em que sentido elas não são capazes de realizar tal ação?” Bem, essa questão ficará mais clara, se nos questionarmos como, ou por que motivo essas colunas foram transformadas para listas.</p>
<p>Antes de continuarmos, vale ressaltar que as novas colunas criadas por <code>pivot_wider()</code> nunca chegaram a ser colunas comuns, formadas por vetores atômicos. Logo, desde a sua criação, elas já eram listas. Mas se partirmos do pressuposto que inicialmente, essas colunas eram vetores atômicos, tal pensamento se torna útil para identificarmos os motivos para o uso de listas. Estes motivos serão identificados a seguir.</p>
<p>Primeiro, precisamos transformar novamente essas colunas em vetores atômicos, para tentarmos compreender como essas colunas ficariam como simples vetores atômicos. Para isso, vou pegar um pedaço da tabela <code>vendas</code>, mais especificamente, as 10 primeiras linhas da tabela, através da função <code>head()</code>. Em seguida, vou me preocupar em transformar essas colunas novamente em vetores, através dos comandos abaixo.</p>
<p></p>
<div class="sourceCode" id="cb781"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb781-1"><a href="#cb781-1" aria-hidden="true" tabindex="-1"></a>pedaco <span class="ot">&lt;-</span> <span class="fu">head</span>(vendas_wide, <span class="dv">10</span>)</span>
<span id="cb781-2"><a href="#cb781-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb781-3"><a href="#cb781-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">5</span><span class="sc">:</span><span class="dv">9</span>){</span>
<span id="cb781-4"><a href="#cb781-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb781-5"><a href="#cb781-5" aria-hidden="true" tabindex="-1"></a>  id <span class="ot">&lt;-</span> <span class="fu">vapply</span>(pedaco[[i]], <span class="at">FUN =</span> is.null, <span class="at">FUN.VALUE =</span> <span class="cn">TRUE</span>)</span>
<span id="cb781-6"><a href="#cb781-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb781-7"><a href="#cb781-7" aria-hidden="true" tabindex="-1"></a>  pedaco[[i]][id] <span class="ot">&lt;-</span> <span class="cn">NA_real_</span></span>
<span id="cb781-8"><a href="#cb781-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb781-9"><a href="#cb781-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb781-10"><a href="#cb781-10" aria-hidden="true" tabindex="-1"></a>pedaco <span class="ot">&lt;-</span> pedaco <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="dv">5</span><span class="sc">:</span><span class="dv">9</span>, unlist))</span></code></pre></div>
<p></p>
<p>Após executarmos as transformações acima, possuímos agora, uma tabela comum, como qualquer outra que você encontra normalmente no R. Veja o resultado abaixo, quando chamamos pelo nome da tabela no console. Dessa vez, nas células que possuíam uma lista nula <code>&lt;NULL&gt;</code>(uma lista vazia) temos um valor de <code>NA</code> (não disponível). Já nas células que possuíam uma lista com algum valor, vemos agora, o valor exato que estava contido nessa lista, ao invés da descrição <code>&lt;dbl [1]&gt;</code>.</p>
<p></p>
<div class="sourceCode" id="cb782"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb782-1"><a href="#cb782-1" aria-hidden="true" tabindex="-1"></a>pedaco</span></code></pre></div>
<pre><code>## # A tibble: 10 x 9
##      ano   mes   dia produtoid   Ana Henrique Letícia Eduardo Paulo
##    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;     &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;
##  1  2010     1     1 10104     3907.    6139.     NA      NA    NA 
##  2  2010     1     2 10013       NA     5510.     NA      NA    NA 
##  3  2010     1     3 10555     5296.      NA    3525.     NA    NA 
##  4  2010     1     4 10555     5102.      NA      NA      NA    NA 
##  5  2010     1     4 10013       NA       NA      NA    6051.   NA 
##  6  2010     1     4 10032       NA       NA    4600.     NA    NA 
##  7  2010     1     5 10104       NA       NA      NA      NA  5869.
##  8  2010     1     6 10013     7188.      NA      NA      NA    NA 
##  9  2010     1     6 10901       NA       NA    4491.     NA    NA 
## 10  2010     1     7 10013       NA     4407.     NA      NA  2292.</code></pre>
<p></p>
<p>Portanto, se observarmos a primeira linha dessa nova tabela <code>pedaco</code>, vemos que a vendedora Ana, vendeu no dia 01/01/2010, o produto de ID 10104, no valor de 3907 reais (e alguns centavos). Neste mesmo dia, o Henrique vendeu o mesmo produto, por quase 2 mil reais a mais que Ana, totalizando 6139 reais de receita. Podemos perceber também pelas outras colunas, que nenhum outro vendedor conseguiu vender uma unidade do produto de ID 10104, no dia 01/01/2010.</p>
<p>Neste ponto, se pergunte: “Ok, Ana vendeu uma unidade do produto 10104, no dia 01. Mas e se ela tivesse vendido duas unidades desse mesmo produto 10104, no dia 01?” Tente imaginar, como os dados dessas duas vendas ficariam na tabela. Isso não é uma questão trivial, pois temos agora dados de duas vendas diferentes…mas apenas uma célula disponível em nossa tabela, para guardar esses dados. É a partir deste choque, que podemos identificar qual foi o motivo para o uso de listas nas novas colunas.</p>
<p>Dito de outra forma, temos uma única célula na tabela (localizada na primeira linha, e quinta coluna da tabela), que deve conter o valor arrecadado na venda do produto 10104, realizada pela vendedora Ana no dia 01/01/2010. Você poderia pensar: “Bem, por que não somar os valores dessas duas vendas? Dessa forma, temos apenas um valor para encaixar nessa célula.” Essa é uma alternativa possível, porém, ela gera perda de informação, especialmente se o valor arrecadado nas duas operações forem diferentes. Por exemplo, se a receita da primeira venda foi de 3907, e da segunda, de 4530. Com essa alternativa, nós sabemos que a soma das duas vendas ocorridas naquele dia, geraram 8437 reais de receita, mas nós não sabemos mais, qual foi o menor valor arrecadado nas duas operações.</p>
<p>Isso é particularmente importante, pois podemos gerar o mesmo valor (8437 reais) de múltiplas formas. Pode ser que a Ana tenha vendido cinco unidades do produto 10104, tendo arrecadado em cada venda, o valor de 1687,4 reais. Mas ela poderia atingir o mesmo valor, ao vender dez unidades do produto 10104, dessa vez, arrecadando um valor médio bem menor, de 843,7 reais. Portanto, se utilizarmos a soma desses valores, como forma de contornarmos o problema posto anteriormente, os administradores da loja não poderão mais inferir da tabela <code>vendas</code>, se as suas vendas tem se reduzido em quantidade, ou se o valor arrecadado em cada venda, tem caído ao longo dos últimos anos.</p>
<p>Apesar de ser uma alternativa ruim para muitos casos, pode ser desejável agregar as informações dessas vendas em uma só para o seu caso. Nesta situação, as versões mais recentes do pacote <code>tidyr</code>, oferecem na função <code>pivot_wider()</code> o argumento <code>values_fn</code>, onde você pode fornecer o nome de uma função a ser aplicada sobre os valores dispostos em cada célula. Logo, se quiséssemos somar os valores de vendas de cada célula criada na tabela <code>vendas_wide</code>, poderíamos realizar os comandos abaixo:</p>
<p></p>
<div class="sourceCode" id="cb784"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb784-1"><a href="#cb784-1" aria-hidden="true" tabindex="-1"></a>vendas <span class="sc">%&gt;%</span> </span>
<span id="cb784-2"><a href="#cb784-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb784-3"><a href="#cb784-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">id_cols =</span> <span class="fu">c</span>(<span class="st">&quot;ano&quot;</span>, <span class="st">&quot;mes&quot;</span>, <span class="st">&quot;dia&quot;</span>, <span class="st">&quot;produtoid&quot;</span>),</span>
<span id="cb784-4"><a href="#cb784-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> usuario,</span>
<span id="cb784-5"><a href="#cb784-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> valor,</span>
<span id="cb784-6"><a href="#cb784-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_fn =</span> sum</span>
<span id="cb784-7"><a href="#cb784-7" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 7,845 x 9
##      ano   mes   dia produtoid   Ana Henrique Letícia Eduardo Paulo
##    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;     &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;
##  1  2010     1     1 10104     3907.    6139.     NA      NA    NA 
##  2  2010     1     2 10013       NA     5510.     NA      NA    NA 
##  3  2010     1     3 10555     5296.      NA    3525.     NA    NA 
##  4  2010     1     4 10555     5102.      NA      NA      NA    NA 
##  5  2010     1     4 10013       NA       NA      NA    6051.   NA 
##  6  2010     1     4 10032       NA       NA    4600.     NA    NA 
##  7  2010     1     5 10104       NA       NA      NA      NA  5869.
##  8  2010     1     6 10013     7188.      NA      NA      NA    NA 
##  9  2010     1     6 10901       NA       NA    4491.     NA    NA 
## 10  2010     1     7 10013       NA     4407.     NA      NA  2292.
## # ... with 7,835 more rows</code></pre>
<p></p>
<p>Recapitulando, nossa hipótese, é de que tenha ocorrido mais de uma venda de um mesmo produto, por um mesmo vendedor, em um mesmo dia na tabela <code>vendas</code>. Para comprovar se essa hipótese ocorre ou não em nossa tabela, podemos coletar o número de observações contidas em cada célula da coluna <code>Ana</code>, por exemplo, e verificarmos se há algum valor acima de 1. Vale ressaltar que as colunas criadas por <code>pivot_wider()</code> em <code>vendas_wide</code>, são agora listas, e principalmente, que desejamos coletar o número de observações contidas em cada um dos elementos da lista que representa a coluna <code>Ana</code>. Para isso, precisamos de algo como os comandos abaixo:</p>
<p></p>
<div class="sourceCode" id="cb786"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb786-1"><a href="#cb786-1" aria-hidden="true" tabindex="-1"></a>vec <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">&quot;double&quot;</span>, <span class="at">length =</span> <span class="fu">nrow</span>(vendas_wide))</span>
<span id="cb786-2"><a href="#cb786-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb786-3"><a href="#cb786-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_along</span>(vendas_wide<span class="sc">$</span>Ana)){</span>
<span id="cb786-4"><a href="#cb786-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb786-5"><a href="#cb786-5" aria-hidden="true" tabindex="-1"></a>  vec[i] <span class="ot">&lt;-</span> <span class="fu">length</span>(vendas_wide<span class="sc">$</span>Ana[[i]])</span>
<span id="cb786-6"><a href="#cb786-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb786-7"><a href="#cb786-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb786-8"><a href="#cb786-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb786-9"><a href="#cb786-9" aria-hidden="true" tabindex="-1"></a>vec[vec <span class="sc">&gt;</span> <span class="dv">1</span>]</span></code></pre></div>
<pre><code>##  [1] 3 2 2 2 2 2 2 2 2 2 2 2 2 3 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2
## [36] 2 2 2 2 2 2 2 2 3 2 2 2 2 2 2 2 2 2 2 2 3 3 2 2 2 2 2 2 2 2 2 2 2 2 3
## [71] 3 2 2 2 2 2 2 2 2 2 2 3 2 2 2 2 2 2 2 2 2 2 3 3 2 2 2</code></pre>
<p></p>
<p>Podemos ver pelo resultado acima, que sim, possuímos dias em que a vendedora Ana, vendeu mais de uma vez, o mesmo produto. É neste sentido que a função <code>pivot_wider()</code> gerou aquele aviso para nós. A função estava nos informando que ela não possuía meios de identificar cada venda realizada pela vendedora Ana desse mesmo produto, nesses dias que foram provavelmente movimentados na loja. Nós fornecemos ao argumento <code>id_cols</code>, as colunas <code>ano</code>, <code>mes</code>, <code>dia</code> e <code>produtoid</code>. Porém, essas colunas em conjunto não são capazes de diferenciar as três vendas de Ana do produto 10013 que ocorreram no dia 29/02/2010, por exemplo, nem as duas vendas de Henrique do produto 10104 no dia 18/01/2010, e muitas outras. Foi por esse motivo, que listas foram utilizadas nas novas colunas de <code>pivot_wider()</code>.</p>
<p>Você talvez pense: “Por que não fornecemos então todas as colunas da tabela para <code>id_cols</code>?” Primeiro, esse questionamento carrega um pressuposto que não necessariamente se confirma, que é o de que os valores das vendas realizadas por um mesmo vendedor, de um mesmo produto, e no mesmo dia, são diferentes em todas as ocasiões. Algo que é possível, mas não necessariamente ocorre ao longo de toda a base. O segundo problema, é que a coluna <code>valor</code> não está mais disponível para ser utilizada por <code>id_cols</code>, pois se você se lembrar, nós conectamos essa coluna a <code>values_from</code>. Isso significa, que essa coluna já está sendo utilizada para preencher as novas células que estão sendo criadas por <code>pivot_wider()</code>, e, portanto, ela não pode ocupar dois espaços ao mesmo tempo. Tanto que se você tentar adicionar a coluna <code>valor</code> a <code>id_cols</code>, você irá perceber que nada se altera, e o mesmo resultado é gerado.</p>
<p>Portanto, não há uma resposta fácil para uma situação como essa, onde mesmo fornecendo todas as colunas para <code>id_cols</code> em <code>pivot_wider()</code>, a função ainda não é capaz de identificar unicamente cada valor da coluna que você forneceu em <code>value_from</code>. Você pode utilizar uma solução que gera perda de informação, ao aplicar uma função sumária, ou seja, uma função para agregar esses valores de forma que eles se tornem únicos, dados os conjuntos de colunas que você forneceu em <code>id_cols</code>. Uma outra possibilidade, é que você esteja utilizando a operação de pivô errada. Ou seja, a melhor alternativa seria alongar (<code>pivot_longer()</code>) a sua base, ao invés de alargá-la.</p>
<p>Agora, uma última possibilidade mais promissora, é que você esteja realizando a operação correta, e que faz sentido manter essas colunas como listas de acordo com o que você deseja realizar com a base. Isso inclui o uso de um ferramental que está um pouco além desse capítulo. Por outro lado, lidar com <em>nested data</em>, é mais uma questão de experiência, de se acostumar com tal estrutura, e saber as funções adequadas, do que aprender algo muito diferente do que mostramos aqui. Um outro conhecimento que é de extrema importância nessas situações, é conhecer muito bem como as listas funcionam no R. Se você conhecer bem essa estrutura, você não terá dificuldades em navegar por <em>nested data</em>. Para uma visão melhor do potencial que <em>nested data</em> pode trazer para sua análise, eu recomendo que você procure por uma excelente palestra de Hadley Wickham, entitulada <em>“Managing many models with R”</em><a href="#fn17" class="footnote-ref" id="fnref17"><sup>17</sup></a>.</p>
</div>
</div>
<div id="completando-e-expandindo-a-sua-tabela" class="section level2" number="7.4">
<h2 number="7.4"><span class="header-section-number">7.4</span> Completando e expandindo a sua tabela</h2>
<p>A operação que vou mostrar a seguir, serve para completar, ou inserir linhas que estão faltando em sua tabela. Em outras palavras, essa operação busca tornar os valores que estão implicitamente faltando em sua tabela, em valores não disponíveis explícitos. Você também pode enxergar esse processo, como uma forma rápida de expandir a sua tabela, a partir de combinações de valores. Um exemplo lógico do uso dessa operação, seriam datas que você gostaria que estivessem em sua tabela, mas que não se encontram nela no momento. Vamos supor por exemplo, que você possua a tabela abaixo:</p>
<p></p>
<div class="sourceCode" id="cb788"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb788-1"><a href="#cb788-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb788-2"><a href="#cb788-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb788-3"><a href="#cb788-3" aria-hidden="true" tabindex="-1"></a>dias <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;2020-09-01&quot;</span>, <span class="st">&quot;2020-09-05&quot;</span>, <span class="st">&quot;2020-09-07&quot;</span>, <span class="st">&quot;2020-09-10&quot;</span>)</span>
<span id="cb788-4"><a href="#cb788-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb788-5"><a href="#cb788-5" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb788-6"><a href="#cb788-6" aria-hidden="true" tabindex="-1"></a>vendas <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb788-7"><a href="#cb788-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">datas =</span> <span class="fu">as.Date</span>(dias),</span>
<span id="cb788-8"><a href="#cb788-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">nome =</span> <span class="fu">c</span>(<span class="st">&quot;Ana&quot;</span>, <span class="st">&quot;Julia&quot;</span>, <span class="st">&quot;Joao&quot;</span>, <span class="st">&quot;Julia&quot;</span>),</span>
<span id="cb788-9"><a href="#cb788-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">valor =</span> <span class="fu">rnorm</span>(<span class="dv">4</span>, <span class="at">mean =</span> <span class="dv">500</span>, <span class="at">sd =</span> <span class="dv">150</span>)</span>
<span id="cb788-10"><a href="#cb788-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb788-11"><a href="#cb788-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb788-12"><a href="#cb788-12" aria-hidden="true" tabindex="-1"></a>vendas</span></code></pre></div>
<pre><code>## # A tibble: 4 x 3
##   datas      nome  valor
##   &lt;date&gt;     &lt;chr&gt; &lt;dbl&gt;
## 1 2020-09-01 Ana    406.
## 2 2020-09-05 Julia  528.
## 3 2020-09-07 Joao   375.
## 4 2020-09-10 Julia  739.</code></pre>
<p></p>
<p>Portanto, temos nessa tabela <code>vendas</code>, o nome de alguns vendedores e os valores de suas vendas efetuadas em alguns dias diferentes. No momento, temos vendas explicitas apenas nos dias 01, 05, 07 e 10 de setembro de 2020, mas o que ocorreu nos dias que estão entre essas datas (dias 02, 03, 04, 06, 08 e 09 de setembro de 2020)? Caso você estivesse apresentando esses dados para o seu chefe, por exemplo, essa seria uma questão que ele provavelmente faria a você.</p>
<p>Bem, vamos supor que não tenham ocorrido vendas durante esses dias, e que por isso eles não estão sendo descritos na tabela <code>vendas</code>. Talvez seja de seu desejo, introduzir esses dias na tabela para que ninguém fique em dúvida a respeito desses dias. Com isso, precisamos então completar a tabela <code>vendas</code>, com linhas que estão implicitamente faltando nela.</p>
<div id="encontrando-possíveis-combinações-com-a-função-expand" class="section level3" number="7.4.1">
<h3 number="7.4.1"><span class="header-section-number">7.4.1</span> Encontrando possíveis combinações com a função <code>expand()</code></h3>
<p>Apesar não ser exatamente o que desejamos para a tabela <code>vendas</code>, o processo em que buscamos encontrar possíveis combinações de dados que não estão presentes em nossa tabela, também envolve a procura por todas as combinações possíveis dos dados presentes nessa tabela. Nessa seção, vamos introduzir alguns métodos para encontrarmos todas as combinações possíveis de seus dados.</p>
<p>Para isso, podemos utilizar a função <code>expand()</code> do pacote <code>tidyr</code>. Essa função busca expandir uma tabela, de forma que ela inclua todas as possíveis combinações de certos valores. Em maiores detalhes, essa função irá criar (com base nos dados que você fornecer a ela) uma nova tabela, ou um novo <code>tibble</code>, que irá incluir todas as combinações únicas e possíveis dos valores que você definiu. Portanto, se eu fornecer a tabela <code>vendas</code> à função, e pedir a ela que encontre todas as combinações possíveis entre os valores contidos nas colunas <code>datas</code> e <code>nomes</code>, esse será o resultado:</p>
<p></p>
<div class="sourceCode" id="cb790"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb790-1"><a href="#cb790-1" aria-hidden="true" tabindex="-1"></a><span class="fu">expand</span>(vendas, datas, nome)</span></code></pre></div>
<pre><code>## # A tibble: 12 x 2
##    datas      nome 
##    &lt;date&gt;     &lt;chr&gt;
##  1 2020-09-01 Ana  
##  2 2020-09-01 Joao 
##  3 2020-09-01 Julia
##  4 2020-09-05 Ana  
##  5 2020-09-05 Joao 
##  6 2020-09-05 Julia
##  7 2020-09-07 Ana  
##  8 2020-09-07 Joao 
##  9 2020-09-07 Julia
## 10 2020-09-10 Ana  
## 11 2020-09-10 Joao 
## 12 2020-09-10 Julia</code></pre>
<p></p>
<p>Portanto, <code>expand()</code> irá criar uma nova tabela, contendo todas as possíveis combinações entre os valores das colunas <code>datas</code> e <code>nomes</code> da tabela <code>vendas</code>. Incluindo aquelas combinações que não aparecem na tabela inicial. Por exemplo, as combinações <code>(2020-09-01, Julia)</code>, ou <code>(2020-09-05, Joao)</code> e <code>(2020-09-10, Joao)</code> não estão presentes na tabela <code>vendas</code>, e mesmo assim foram introduzidas no resultado de <code>expand()</code>.</p>
<p>Porém, <code>expand()</code> não definiu novas combinações com as datas que estão faltando na tabela <code>vendas</code> (por exemplo, os dias 02, 03, 04 e 08 de setembro de 2020). Ou seja, em nenhum momento <code>expand()</code> irá adicionar algum dado à sua tabela, seja antes ou depois de encontrar todas as combinações únicas. Em outras palavras, <code>expand()</code> irá sempre encontrar todas as combinações possíveis, se baseando nos valores que já se encontram nas variáveis que você forneceu a ela. Por isso, mesmo que a combinação <code>(2020-09-01, Julia)</code> não esteja definida na tabela <code>vendas</code>, ela é uma combinação possível, pois os valores <code>2020-09-01</code> e <code>Julia</code> estão presentes na tabela <code>vendas</code>.</p>
<p>Vale destacar, que você pode combinar as variáveis de sua tabela, com vetores externos. Por exemplo, eu posso utilizar <code>seq.Date()</code> para gerar todas as datas que estão entre o dia 01 e 10 de setembro de 2020. No exemplo abaixo, perceba que <code>expand()</code> pega cada um dos 3 nomes únicos definidos na coluna <code>nome</code> de <code>vendas</code>, e combina eles com cada uma das 10 datas guardadas no vetor <code>vec_d</code>, gerando assim, uma nova tabela com 30 linhas (<span class="math inline">\(3\)</span> nomes <span class="math inline">\(\times 10\)</span> datas <span class="math inline">\(= 30\)</span> combinações).</p>
<p></p>
<div class="sourceCode" id="cb792"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb792-1"><a href="#cb792-1" aria-hidden="true" tabindex="-1"></a>vec_d <span class="ot">&lt;-</span> <span class="fu">seq.Date</span>(<span class="fu">min</span>(vendas<span class="sc">$</span>datas), <span class="fu">max</span>(vendas<span class="sc">$</span>datas), <span class="at">by =</span> <span class="st">&quot;day&quot;</span>)</span>
<span id="cb792-2"><a href="#cb792-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb792-3"><a href="#cb792-3" aria-hidden="true" tabindex="-1"></a><span class="fu">expand</span>(vendas, nome, vec_d)</span></code></pre></div>
<pre><code>## # A tibble: 30 x 2
##    nome  vec_d     
##    &lt;chr&gt; &lt;date&gt;    
##  1 Ana   2020-09-01
##  2 Ana   2020-09-02
##  3 Ana   2020-09-03
##  4 Ana   2020-09-04
##  5 Ana   2020-09-05
##  6 Ana   2020-09-06
##  7 Ana   2020-09-07
##  8 Ana   2020-09-08
##  9 Ana   2020-09-09
## 10 Ana   2020-09-10
## # ... with 20 more rows</code></pre>
<p></p>
<p>Além disso, a função <code>expand()</code> conta com uma função auxiliar útil (<code>nesting()</code>), que restringe quais combinações serão válidas para <code>expand()</code>. Ao incluir variáveis dentro da função <code>nesting()</code>, você está dizendo à <code>expand()</code>, que encontre apenas as combinações únicas (entre os valores dessas variáveis) que já estão presentes em sua base. Ou seja, se eu colocar as colunas <code>datas</code> e <code>nome</code> dentro de <code>nesting()</code>, a função <code>expand()</code> irá basicamente repetir a tabela <code>vendas</code>. Pois cada uma das 4 linhas (ou 4 combinações entre <code>datas</code> e <code>nome</code>), aparecem uma única vez nessa tabela.</p>
<p></p>
<div class="sourceCode" id="cb794"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb794-1"><a href="#cb794-1" aria-hidden="true" tabindex="-1"></a><span class="fu">expand</span>(vendas, <span class="fu">nesting</span>(datas, nome))</span></code></pre></div>
<pre><code>## # A tibble: 4 x 2
##   datas      nome 
##   &lt;date&gt;     &lt;chr&gt;
## 1 2020-09-01 Ana  
## 2 2020-09-05 Julia
## 3 2020-09-07 Joao 
## 4 2020-09-10 Julia</code></pre>
<p></p>
<p>Dessa maneira, o uso de <code>nesting()</code> acima, é análogo ao uso da função <code>unique()</code> que vêm dos pacotes básicos do R. Logo, poderíamos atingir exatamente o mesmo resultado, utilizando qualquer uma das duas funções. Podemos por exemplo, adicionarmos uma quinta linha à tabela <code>vendas</code>, que repete os valores contidos na quarta linha da tabela. Perceba abaixo, que ao utilizarmos <code>unique()</code> ou <code>nesting()</code>, em ambos os casos, essa quinta linha repetida desaparece. Pois ambas as funções buscam encontrar todas as combinações <strong>únicas</strong> que aparecem ao longo da tabela <code>vendas</code>.</p>
<p></p>
<div class="sourceCode" id="cb796"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb796-1"><a href="#cb796-1" aria-hidden="true" tabindex="-1"></a>vendas[<span class="dv">5</span>, ] <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">as.Date</span>(<span class="st">&quot;2020-09-10&quot;</span>), <span class="st">&quot;Julia&quot;</span>, <span class="fl">739.29</span>)</span>
<span id="cb796-2"><a href="#cb796-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb796-3"><a href="#cb796-3" aria-hidden="true" tabindex="-1"></a>vendas</span></code></pre></div>
<pre><code>## # A tibble: 5 x 3
##   datas      nome  valor
##   &lt;date&gt;     &lt;chr&gt; &lt;dbl&gt;
## 1 2020-09-01 Ana    406.
## 2 2020-09-05 Julia  528.
## 3 2020-09-07 Joao   375.
## 4 2020-09-10 Julia  739.
## 5 2020-09-10 Julia  739.</code></pre>
<div class="sourceCode" id="cb798"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb798-1"><a href="#cb798-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Estou aplicando unique() sobre a</span></span>
<span id="cb798-2"><a href="#cb798-2" aria-hidden="true" tabindex="-1"></a><span class="co"># primeira e segunda coluna de vendas</span></span>
<span id="cb798-3"><a href="#cb798-3" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(vendas[ , <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]) </span></code></pre></div>
<pre><code>## # A tibble: 4 x 2
##   datas      nome 
##   &lt;date&gt;     &lt;chr&gt;
## 1 2020-09-01 Ana  
## 2 2020-09-05 Julia
## 3 2020-09-07 Joao 
## 4 2020-09-10 Julia</code></pre>
<div class="sourceCode" id="cb800"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb800-1"><a href="#cb800-1" aria-hidden="true" tabindex="-1"></a><span class="co"># O mesmo resultado pode ser</span></span>
<span id="cb800-2"><a href="#cb800-2" aria-hidden="true" tabindex="-1"></a><span class="co"># atingido com o uso de nesting() em expand()</span></span>
<span id="cb800-3"><a href="#cb800-3" aria-hidden="true" tabindex="-1"></a><span class="fu">expand</span>(vendas, <span class="fu">nesting</span>(datas, nome))</span></code></pre></div>
<pre><code>## # A tibble: 4 x 2
##   datas      nome 
##   &lt;date&gt;     &lt;chr&gt;
## 1 2020-09-01 Ana  
## 2 2020-09-05 Julia
## 3 2020-09-07 Joao 
## 4 2020-09-10 Julia</code></pre>
<p></p>
<p>Vale destacar que você pode combinar o comportamento restrito e irrestrito de <code>expand()</code>. Ou seja, você pode restringir as combinações com o uso de <code>nesting()</code> para algumas variáveis, enquanto outras permanecem de fora dessa função, permitindo uma gama maior de combinações. No exemplo abaixo, <code>expand()</code> vai encontrar primeiro, cada combinação única entre <code>nome</code> e <code>valor</code> que está presente na tabela <code>vendas</code>, em seguida, a função irá encontrar <strong>todas</strong> as combinações possíveis entre as combinações anteriores (entre <code>nome</code> e <code>valor</code>) e todas as datas descritas na base.</p>
<p>Em outras palavras, nós podemos encontrar no resultado abaixo, uma combinação como <code>(2020-09-01, Julia, 528.)</code>. Pois a combinação <code>(Julia, 528.)</code> existe nas colunas <code>nome</code> e <code>valor</code> da tabela <code>vendas</code>, e como deixamos a coluna <code>datas</code> de fora de <code>nesting()</code>, <code>expand()</code> irá combinar <code>(Julia, 528.)</code> com toda e qualquer data disponível na tabela <code>vendas</code>.</p>
<p>Porém, nós não podemos encontrar no resultado abaixo, uma combinação como <code>(2020-09-01, Ana, 739.)</code>. Pois a única combinação entre as colunas <code>nome</code> e <code>valor</code>, presente na tabela <code>vendas</code>, que possui o valor 739 na coluna <code>valor</code>, é a linha que contém a combinação <code>(Julia, 739.)</code>. Logo, se não há nas colunas <code>nome</code> e <code>valor</code> alguma combinação entre <code>Ana</code> e o valor <code>739.</code>, <code>expand()</code> não irá combinar esses valores com todas as datas disponíveis na base. Pois as combinações entre as colunas <code>nome</code> e <code>valor</code> estão sendo restringidas por <code>nesting()</code>.</p>
<p></p>
<div class="sourceCode" id="cb802"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb802-1"><a href="#cb802-1" aria-hidden="true" tabindex="-1"></a>vendas <span class="sc">%&gt;%</span> </span>
<span id="cb802-2"><a href="#cb802-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand</span>(datas, <span class="fu">nesting</span>(nome, valor))</span></code></pre></div>
<pre><code>## # A tibble: 16 x 3
##    datas      nome  valor
##    &lt;date&gt;     &lt;chr&gt; &lt;dbl&gt;
##  1 2020-09-01 Ana    406.
##  2 2020-09-01 Joao   375.
##  3 2020-09-01 Julia  528.
##  4 2020-09-01 Julia  739.
##  5 2020-09-05 Ana    406.
##  6 2020-09-05 Joao   375.
##  7 2020-09-05 Julia  528.
##  8 2020-09-05 Julia  739.
##  9 2020-09-07 Ana    406.
## 10 2020-09-07 Joao   375.
## 11 2020-09-07 Julia  528.
## 12 2020-09-07 Julia  739.
## 13 2020-09-10 Ana    406.
## 14 2020-09-10 Joao   375.
## 15 2020-09-10 Julia  528.
## 16 2020-09-10 Julia  739.</code></pre>
<p></p>
</div>
<div id="a-metodologia-por-detrás-do-processo" class="section level3" number="7.4.2">
<h3 number="7.4.2"><span class="header-section-number">7.4.2</span> A metodologia por detrás do processo</h3>
<p>Apesar de próximo, a função <code>expand()</code> não é suficiente para produzirmos o resultado que desejamos. Lembre-se que nós temos a tabela abaixo, e que desejamos completá-la com os dados referentes aos dias 02, 03, 04, 06, 08 e 09 de setembro de 2020, que estão no momento faltando nessa tabela.</p>
<p></p>
<div class="sourceCode" id="cb804"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb804-1"><a href="#cb804-1" aria-hidden="true" tabindex="-1"></a>vendas</span></code></pre></div>
<pre><code>## # A tibble: 4 x 3
##   datas      nome  valor
##   &lt;date&gt;     &lt;chr&gt; &lt;dbl&gt;
## 1 2020-09-01 Ana    406.
## 2 2020-09-05 Julia  528.
## 3 2020-09-07 Joao   375.
## 4 2020-09-10 Julia  739.</code></pre>
<p></p>
<p>Primeiro, precisamos encontrar todos valores possíveis da variável que está incompleta na tabela <code>vendas</code>. Ou seja, queremos encontrar todas as datas possíveis entre os dias 01 e 10 de setembro de 2020, pois esses dias são os limites da tabela. Dito de outra forma, a tabela <code>vendas</code> descreve dados de vendas que ocorreram do dia 01 até o dia 10 de setembro de 2020. Por isso, queremos encontrar todos os dias possíveis entre esse intervalo de tempo.</p>
<p>Para isso, podemos utilizar a função <code>seq.Date()</code> em conjunto com <code>tibble()</code>. Dessa forma, nos criamos uma nova tabela, que contém uma sequência de datas que vai do dia 01 até o dia 10 de setembro. O mesmo resultado, poderia ser atingido, caso utilizássemos <code>seq.Date()</code> dentro de <code>expand()</code>, já que <code>expand()</code> cria por padrão uma nova tabela com todas as combinações possíveis dos dados que você fornece a ela.</p>
<p></p>
<div class="sourceCode" id="cb806"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb806-1"><a href="#cb806-1" aria-hidden="true" tabindex="-1"></a>nova_tab <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb806-2"><a href="#cb806-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">datas =</span> <span class="fu">seq.Date</span>(<span class="fu">min</span>(vendas<span class="sc">$</span>datas), <span class="fu">max</span>(vendas<span class="sc">$</span>datas), <span class="at">by =</span> <span class="st">&quot;day&quot;</span>)</span>
<span id="cb806-3"><a href="#cb806-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb806-4"><a href="#cb806-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb806-5"><a href="#cb806-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb806-6"><a href="#cb806-6" aria-hidden="true" tabindex="-1"></a>nova_tab</span></code></pre></div>
<pre><code>## # A tibble: 10 x 1
##    datas     
##    &lt;date&gt;    
##  1 2020-09-01
##  2 2020-09-02
##  3 2020-09-03
##  4 2020-09-04
##  5 2020-09-05
##  6 2020-09-06
##  7 2020-09-07
##  8 2020-09-08
##  9 2020-09-09
## 10 2020-09-10</code></pre>
<p></p>
<p></p>
<div class="sourceCode" id="cb808"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb808-1"><a href="#cb808-1" aria-hidden="true" tabindex="-1"></a><span class="co"># O mesmo resultado poderia ser atingido com:</span></span>
<span id="cb808-2"><a href="#cb808-2" aria-hidden="true" tabindex="-1"></a>nova_tab <span class="ot">&lt;-</span> <span class="fu">expand</span>(</span>
<span id="cb808-3"><a href="#cb808-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">datas =</span> <span class="fu">seq.Date</span>(<span class="fu">min</span>(vendas<span class="sc">$</span>datas), <span class="fu">max</span>(vendas<span class="sc">$</span>datas), <span class="at">by =</span> <span class="st">&quot;day&quot;</span>)</span>
<span id="cb808-4"><a href="#cb808-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p></p>
<p>Em seguida, podemos utilizar a função <code>full_join()</code><a href="#fn18" class="footnote-ref" id="fnref18"><sup>18</sup></a> do pacote <code>dplyr</code>, para trazermos os dados disponíveis na tabela <code>vendas</code> para essa nova tabela <code>nova_tab</code>. Agora, nós temos uma nova tabela, que contém todos os dados que já estão definidos na tabela <code>vendas</code>, além dos dias que estavam faltando anteriormente, e que agora também estão definidos.</p>
<p></p>
<div class="sourceCode" id="cb809"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb809-1"><a href="#cb809-1" aria-hidden="true" tabindex="-1"></a>nova_tab <span class="ot">&lt;-</span> nova_tab <span class="sc">%&gt;%</span> </span>
<span id="cb809-2"><a href="#cb809-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">full_join</span>(vendas, <span class="at">by =</span> <span class="st">&quot;datas&quot;</span>)</span>
<span id="cb809-3"><a href="#cb809-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb809-4"><a href="#cb809-4" aria-hidden="true" tabindex="-1"></a>nova_tab</span></code></pre></div>
<pre><code>## # A tibble: 10 x 3
##    datas      nome  valor
##    &lt;date&gt;     &lt;chr&gt; &lt;dbl&gt;
##  1 2020-09-01 Ana    406.
##  2 2020-09-02 &lt;NA&gt;    NA 
##  3 2020-09-03 &lt;NA&gt;    NA 
##  4 2020-09-04 &lt;NA&gt;    NA 
##  5 2020-09-05 Julia  528.
##  6 2020-09-06 &lt;NA&gt;    NA 
##  7 2020-09-07 Joao   375.
##  8 2020-09-08 &lt;NA&gt;    NA 
##  9 2020-09-09 &lt;NA&gt;    NA 
## 10 2020-09-10 Julia  739.</code></pre>
<p></p>
<p>O que resta agora, é preenchermos os campos com valores não-disponíveis (<code>NA</code>) com algum outro valor que seja mais claro, ou que indique de uma forma melhor, que não houve vendas realizadas naquele dia. Visando esse objetivo, temos a função <code>replace_na()</code> do pacote <code>tidyr</code>. Nessa função, você irá fornecer uma lista (<code>list()</code>) contendo os valores que vão substituir os valores <code>NA</code> em cada coluna de sua tabela. Essa lista precisa ser nomeada. Basta nomear cada valor substituto com o nome da coluna em que você deseja utilizar esse valor. Logo, se eu quero substituir todos os valores <code>NA</code> na coluna <code>valor</code>, por um zero, basta eu nomear esse zero com o nome dessa coluna, dentro da lista (<code>list()</code>) que eu forneci à <code>replace_na()</code>.</p>
<p></p>
<div class="sourceCode" id="cb811"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb811-1"><a href="#cb811-1" aria-hidden="true" tabindex="-1"></a>nova_tab <span class="sc">%&gt;%</span> </span>
<span id="cb811-2"><a href="#cb811-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">replace_na</span>(</span>
<span id="cb811-3"><a href="#cb811-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">nome =</span> <span class="st">&quot;Não houve vendas&quot;</span>, <span class="at">valor =</span> <span class="dv">0</span>)</span>
<span id="cb811-4"><a href="#cb811-4" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 10 x 3
##    datas      nome             valor
##    &lt;date&gt;     &lt;chr&gt;            &lt;dbl&gt;
##  1 2020-09-01 Ana               406.
##  2 2020-09-02 Não houve vendas    0 
##  3 2020-09-03 Não houve vendas    0 
##  4 2020-09-04 Não houve vendas    0 
##  5 2020-09-05 Julia             528.
##  6 2020-09-06 Não houve vendas    0 
##  7 2020-09-07 Joao              375.
##  8 2020-09-08 Não houve vendas    0 
##  9 2020-09-09 Não houve vendas    0 
## 10 2020-09-10 Julia             739.</code></pre>
<p></p>
</div>
<div id="a-função-complete-como-um-atalho-útil" class="section level3" number="7.4.3">
<h3 number="7.4.3"><span class="header-section-number">7.4.3</span> A função <code>complete()</code> como um atalho útil</h3>
<p>A função <code>complete()</code> é um <em>wrapper</em>, ou uma função auxiliar do pacote <code>tidyr</code>, que engloba as funções <code>expand()</code>, <code>full_join()</code>, e <code>replace_na()</code>. Ou seja, a função <code>complete()</code> é um atalho para aplicarmos a metodologia que acabamos de descrever na seção anterior. A função possui três argumentos principais: 1) <code>data</code>, o nome do objeto onde a sua tabela está salva; 2) <code>...</code>, a especificação das colunas a serem completadas, ou “expandidas” por <code>complete()</code>; 3) <code>fill</code>, uma lista nomeada (como a que fornecemos em <code>replace_na()</code>), que atribui para cada variável (ou coluna) de sua tabela, um valor a ser utilizado (ao invés de <code>NA</code>) para as combinações faltantes.</p>
<p>Vou explicar o argumento <code>fill</code> mais a frente, por isso, vamos nos concentrar nos outros dois. A tabela que contém os nossos dados se chama <code>vendas</code>, e por isso, é esse valor que devemos atribuir ao argumento <code>data</code>. Porém, como estamos utilizando o <em>pipe</em> (<code>%&gt;%</code>) no exemplo abaixo, ele já está realizando esse serviço para nós. Já o segundo argumento (<code>...</code>), diz respeita a lista de especificações que vão definir como a função <code>complete()</code> deve completar cada coluna da nossa tabela.</p>
<p>Em outras palavras, o segundo argumento (<code>...</code>) é a parte da função <code>complete()</code> que diz respeito ao uso de <code>expand()</code>. Você deve, portanto, preencher este argumento, da mesma forma que você faria com a função <code>expand()</code>. No exemplo abaixo, o primeiro argumento (<code>data</code>), já está sendo definido pelo operador <em>pipe</em> (<code>%&gt;%</code>). Perceba que eu preencho a função <code>complete()</code>, da mesma forma em que preenchi a função <code>expand()</code> na seção anterior. Perceba também, que <code>complete()</code> já me retorna como resultado, a tabela expandida após o uso de <code>full_join()</code>.</p>
<p></p>
<div class="sourceCode" id="cb813"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb813-1"><a href="#cb813-1" aria-hidden="true" tabindex="-1"></a>vendas <span class="sc">%&gt;%</span> </span>
<span id="cb813-2"><a href="#cb813-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">complete</span>(</span>
<span id="cb813-3"><a href="#cb813-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">datas =</span> <span class="fu">seq.Date</span>(<span class="fu">min</span>(datas), <span class="fu">max</span>(datas), <span class="at">by =</span> <span class="st">&quot;day&quot;</span>)</span>
<span id="cb813-4"><a href="#cb813-4" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 10 x 3
##    datas      nome  valor
##    &lt;date&gt;     &lt;chr&gt; &lt;dbl&gt;
##  1 2020-09-01 Ana    406.
##  2 2020-09-02 &lt;NA&gt;    NA 
##  3 2020-09-03 &lt;NA&gt;    NA 
##  4 2020-09-04 &lt;NA&gt;    NA 
##  5 2020-09-05 Julia  528.
##  6 2020-09-06 &lt;NA&gt;    NA 
##  7 2020-09-07 Joao   375.
##  8 2020-09-08 &lt;NA&gt;    NA 
##  9 2020-09-09 &lt;NA&gt;    NA 
## 10 2020-09-10 Julia  739.</code></pre>
<p></p>
<p>O último passo que resta agora, seria o uso de <code>replace_na()</code> para preencher os valores não-disponíveis por algum outro valor mais claro. Nós ainda podemos utilizar a função <code>complete()</code> para executarmos esse passo. Basta você fornecer à <code>complete()</code> através de seu terceiro argumento (<code>fill</code>), a mesma lista que você forneceria à <code>replace_na()</code>. Dessa forma, temos:</p>
<p></p>
<div class="sourceCode" id="cb815"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb815-1"><a href="#cb815-1" aria-hidden="true" tabindex="-1"></a>vendas <span class="sc">%&gt;%</span> </span>
<span id="cb815-2"><a href="#cb815-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">complete</span>(</span>
<span id="cb815-3"><a href="#cb815-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">datas =</span> <span class="fu">seq.Date</span>(<span class="fu">min</span>(datas), <span class="fu">max</span>(datas), <span class="at">by =</span> <span class="st">&quot;day&quot;</span>),</span>
<span id="cb815-4"><a href="#cb815-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="fu">list</span>(<span class="at">nome =</span> <span class="st">&quot;Não houve vendas&quot;</span>, <span class="at">valor =</span> <span class="dv">0</span>)</span>
<span id="cb815-5"><a href="#cb815-5" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 10 x 3
##    datas      nome             valor
##    &lt;date&gt;     &lt;chr&gt;            &lt;dbl&gt;
##  1 2020-09-01 Ana               406.
##  2 2020-09-02 Não houve vendas    0 
##  3 2020-09-03 Não houve vendas    0 
##  4 2020-09-04 Não houve vendas    0 
##  5 2020-09-05 Julia             528.
##  6 2020-09-06 Não houve vendas    0 
##  7 2020-09-07 Joao              375.
##  8 2020-09-08 Não houve vendas    0 
##  9 2020-09-09 Não houve vendas    0 
## 10 2020-09-10 Julia             739.</code></pre>
<p></p>
</div>
</div>
<div id="preenchendo-valores-não-disponíveis-na" class="section level2" number="7.5">
<h2 number="7.5"><span class="header-section-number">7.5</span> Preenchendo valores não-disponíveis (<code>NA</code>)</h2>
<div id="utilizando-se-de-valores-anteriores-ou-posteriores" class="section level3" number="7.5.1">
<h3 number="7.5.1"><span class="header-section-number">7.5.1</span> Utilizando-se de valores anteriores ou posteriores</h3>
<p>As operações que vou mostrar a seguir, servem para preencher linhas com dados não-disponíveis (<code>NA</code>), com valores anteriores ou posteriores que estão disponíveis em sua tabela. Vamos começar com um exemplo simples através da tabela <code>df</code>, que você pode criar em seu R utilizando os comandos abaixo. Nessa tabela, temos algumas vendas anuais hipotéticas. Agora, perceba que por algum motivo, o ano em que as vendas ocorreram, só foram guardadas na primeira linha de cada ID (<code>id</code>). Isso é algo que devemos corrigir nessa tabela.</p>
<p></p>
<div class="sourceCode" id="cb817"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb817-1"><a href="#cb817-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb817-2"><a href="#cb817-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb817-3"><a href="#cb817-3" aria-hidden="true" tabindex="-1"></a>v <span class="ot">&lt;-</span> <span class="dv">2001</span><span class="sc">:</span><span class="dv">2004</span></span>
<span id="cb817-4"><a href="#cb817-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb817-5"><a href="#cb817-5" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb817-6"><a href="#cb817-6" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb817-7"><a href="#cb817-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">id =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="at">each =</span> <span class="dv">3</span>),</span>
<span id="cb817-8"><a href="#cb817-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">ano =</span> <span class="cn">NA_real_</span>,</span>
<span id="cb817-9"><a href="#cb817-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">valor =</span> <span class="fu">rnorm</span>(<span class="dv">12</span>, <span class="at">mean =</span> <span class="dv">1000</span>, <span class="at">sd =</span> <span class="dv">560</span>)</span>
<span id="cb817-10"><a href="#cb817-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb817-11"><a href="#cb817-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb817-12"><a href="#cb817-12" aria-hidden="true" tabindex="-1"></a>df[<span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">12</span>, <span class="at">by =</span> <span class="dv">3</span>), <span class="st">&quot;ano&quot;</span>] <span class="ot">&lt;-</span> v</span>
<span id="cb817-13"><a href="#cb817-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb817-14"><a href="#cb817-14" aria-hidden="true" tabindex="-1"></a>df</span></code></pre></div>
<pre><code>## # A tibble: 12 x 3
##       id   ano valor
##    &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1     1  2001  649.
##  2     1    NA 1103.
##  3     1    NA  532.
##  4     2  2002 1893.
##  5     2    NA 1185.
##  6     2    NA  541.
##  7     3  2003 1273.
##  8     3    NA 1413.
##  9     3    NA 1322.
## 10     4  2004  829.
## 11     4    NA 1847.
## 12     4    NA 1218.</code></pre>
<p></p>
<p>Portanto, o que queremos fazer, é completar as linhas de <code>NA</code>’s, com o ano correspondente a essas vendas. Pelo fato dos anos estarem separados por um número constante de linhas, ou seja, a cada 3 linhas de <code>NA</code>’s, temos um novo ano, podemos pensar em algumas soluções relativamente simples como a definida abaixo. Porém, a simplicidade do problema, depende dos intervalos entre cada valor, serem constantes. A partir do momento em que esses valores começarem a se dispersar em distâncias inconsistentes, uma solução como a definida abaixo, não servirá.</p>
<p></p>
<div class="sourceCode" id="cb819"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb819-1"><a href="#cb819-1" aria-hidden="true" tabindex="-1"></a>niveis <span class="ot">&lt;-</span> <span class="fu">unique</span>(df<span class="sc">$</span>ano)</span>
<span id="cb819-2"><a href="#cb819-2" aria-hidden="true" tabindex="-1"></a>niveis <span class="ot">&lt;-</span> niveis[<span class="sc">!</span><span class="fu">is.na</span>(niveis)]</span>
<span id="cb819-3"><a href="#cb819-3" aria-hidden="true" tabindex="-1"></a>repair_vec <span class="ot">&lt;-</span> df<span class="sc">$</span>ano</span>
<span id="cb819-4"><a href="#cb819-4" aria-hidden="true" tabindex="-1"></a>repair_vec[<span class="fu">is.na</span>(repair_vec)] <span class="ot">&lt;-</span> <span class="fu">rep</span>(niveis, <span class="at">each =</span> <span class="dv">2</span>)</span>
<span id="cb819-5"><a href="#cb819-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb819-6"><a href="#cb819-6" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>ano <span class="ot">&lt;-</span> repair_vec</span>
<span id="cb819-7"><a href="#cb819-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb819-8"><a href="#cb819-8" aria-hidden="true" tabindex="-1"></a>df</span></code></pre></div>
<pre><code>## # A tibble: 12 x 3
##       id   ano valor
##    &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1     1  2001  649.
##  2     1  2001 1103.
##  3     1  2001  532.
##  4     2  2002 1893.
##  5     2  2002 1185.
##  6     2  2002  541.
##  7     3  2003 1273.
##  8     3  2003 1413.
##  9     3  2003 1322.
## 10     4  2004  829.
## 11     4  2004 1847.
## 12     4  2004 1218.</code></pre>
<p></p>
<p>Apesar de ser um problema simples, podemos alcançar uma solução ainda mais simples, ao utilizarmos funções que são especializadas nesses problemas. Esse é o caso da função <code>fill()</code> do pacote <code>tidyr</code>, que foi criada justamente para esse propósito. Portanto, sempre que você possuir em sua tabela, uma coluna onde você deseja substituir uma sequência de <code>NA</code>’s pelo último (ou próximo) valor disponível, você pode utilizar essa função para tal tarefa.</p>
<p>A função <code>fill()</code> possui três argumentos: 1) <code>data</code>, o objeto onde a tabela com que deseja trabalhar, está salva; 2) <code>...</code>, a lista de colunas em que você deseja aplicar a função; 3) <code>.direction</code>, define a direção que a função deve seguir na hora de preencher os valores.</p>
<p></p>
<div class="sourceCode" id="cb821"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb821-1"><a href="#cb821-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb821-2"><a href="#cb821-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb821-3"><a href="#cb821-3" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> <span class="fu">fill</span>(ano)</span></code></pre></div>
<pre><code>## # A tibble: 12 x 3
##       id   ano valor
##    &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1     1  2001  649.
##  2     1  2001 1103.
##  3     1  2001  532.
##  4     2  2002 1893.
##  5     2  2002 1185.
##  6     2  2002  541.
##  7     3  2003 1273.
##  8     3  2003 1413.
##  9     3  2003 1322.
## 10     4  2004  829.
## 11     4  2004 1847.
## 12     4  2004 1218.</code></pre>
<p></p>
<p>A função <code>fill()</code> trabalha a partir de uma dada direção vertical em sua tabela.
Por padrão, a função <code>fill()</code> irá preencher os valores indo para baixo, ou seja, partindo do topo da tabela, até a sua base. Logo, a função irá substituir qualquer <code>NA</code> com o último valor disponível, ou em outras palavras, com o valor disponível anterior ao <code>NA</code> em questão. A função lhe oferece o argumento <code>.direction</code>, caso você deseja alterar esse comportamento. Logo, se você deseja preencher esses valores <code>NA</code>’s com o próximo valor disponível em relação ao <code>NA</code> em questão. Isto é, preencher os valores para cima, partindo da base da tabela, e seguindo para o seu topo. Você precisa definir o argumento da seguinte maneira:</p>
<p></p>
<div class="sourceCode" id="cb823"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb823-1"><a href="#cb823-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> <span class="fu">fill</span>(ano, <span class="at">.direction =</span> <span class="st">&quot;up&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 12 x 3
##       id   ano valor
##    &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1     1  2001  649.
##  2     1  2002 1103.
##  3     1  2002  532.
##  4     2  2002 1893.
##  5     2  2003 1185.
##  6     2  2003  541.
##  7     3  2003 1273.
##  8     3  2004 1413.
##  9     3  2004 1322.
## 10     4  2004  829.
## 11     4    NA 1847.
## 12     4    NA 1218.</code></pre>
<div class="sourceCode" id="cb825"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb825-1"><a href="#cb825-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Caso prefira não utilizar o pipe ( %&gt;% ),</span></span>
<span id="cb825-2"><a href="#cb825-2" aria-hidden="true" tabindex="-1"></a><span class="co"># ficaria dessa forma:</span></span>
<span id="cb825-3"><a href="#cb825-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb825-4"><a href="#cb825-4" aria-hidden="true" tabindex="-1"></a><span class="co"># fill(df, ano, .direction = &quot;up&quot;)</span></span></code></pre></div>
<p></p>
<p>Portanto, se tivéssemos que colocar essas operações em uma representação visual, teríamos algo como a figura 7.5. Lembrando que a função usa por padrão, a direção <em>down</em>, logo, no primeiro caso mostrado na figura, você não precisaria definir explicitamente o argumento <code>.direction</code>.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/fill_1.png" alt="Representação do processo executado pela função `fill`" width="100%" />
<p class="caption">
(#fig:unnamed-chunk-425)Representação do processo executado pela função <code>fill</code>
</p>
</div>
<p></p>
<p>Apesar de serem os exemplos mais claros de aplicação, serão raras as ocasiões em que você terá esse problema posto claramente já de início em sua tabela. Com isso, eu quero dizer que serão raros os momentos em que você desde o início terá uma tabela, onde por algum motivo, os registros aparecem apenas na primeira (ou na última) linha que diz respeito aquele registro.</p>
<p>Usualmente, você irá utilizar a função <code>fill()</code> quando você já estiver realizando diversas outras transformações em sua tabela, para se chegar aonde deseja. Um exemplo claro dessa ideia, seria uma tabela onde os valores são registrados no primeiro dia de cada semana (basicamente você possui dados semanais), mas você precisa calcular uma média móvel diária. Isso significa que para calcular essa média móvel, você teria que completar os dias faltantes de cada semana, e ainda utilizar o <code>fill()</code> para transportar o valor do primeiro dia, para os dias restantes da semana.</p>
<p>Vale ressaltar, que você pode utilizar em <code>fill()</code>, todos os mecanismos de seleção que introduzimos em <code>select()</code>, para selecionar as colunas em que você deseja aplicar a função <code>fill()</code>. Isso também significa, que com <code>fill()</code> você pode preencher várias colunas ao mesmo tempo. Agora, para relembrarmos esses mecanismos, vamos criar uma tabela inicialmente vazia, que contém o total de vendas realizadas nos 6 primeiros meses de 2020, por cada funcionário de uma loja.</p>
<p></p>
<div class="sourceCode" id="cb826"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb826-1"><a href="#cb826-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2</span>)</span>
<span id="cb826-2"><a href="#cb826-2" aria-hidden="true" tabindex="-1"></a>funcionarios <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb826-3"><a href="#cb826-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">mes =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>, <span class="at">times =</span> <span class="dv">4</span>),</span>
<span id="cb826-4"><a href="#cb826-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">vendas =</span> <span class="fu">floor</span>(<span class="fu">rnorm</span>(<span class="dv">24</span>, <span class="at">mean =</span> <span class="dv">60</span>, <span class="at">sd =</span> <span class="dv">24</span>)),</span>
<span id="cb826-5"><a href="#cb826-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">nome =</span> <span class="cn">NA_character_</span>,</span>
<span id="cb826-6"><a href="#cb826-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">salario =</span> <span class="cn">NA_real_</span>,</span>
<span id="cb826-7"><a href="#cb826-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">mes_ent =</span> <span class="cn">NA_real_</span>,</span>
<span id="cb826-8"><a href="#cb826-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">ano_ent =</span> <span class="cn">NA_real_</span>,</span>
<span id="cb826-9"><a href="#cb826-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">unidade =</span> <span class="cn">NA_character_</span></span>
<span id="cb826-10"><a href="#cb826-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb826-11"><a href="#cb826-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb826-12"><a href="#cb826-12" aria-hidden="true" tabindex="-1"></a>funcionarios</span></code></pre></div>
<pre><code>## # A tibble: 24 x 7
##      mes vendas nome  salario mes_ent ano_ent unidade
##    &lt;int&gt;  &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;  
##  1     1     38 &lt;NA&gt;       NA      NA      NA &lt;NA&gt;   
##  2     2     64 &lt;NA&gt;       NA      NA      NA &lt;NA&gt;   
##  3     3     98 &lt;NA&gt;       NA      NA      NA &lt;NA&gt;   
##  4     4     32 &lt;NA&gt;       NA      NA      NA &lt;NA&gt;   
##  5     5     58 &lt;NA&gt;       NA      NA      NA &lt;NA&gt;   
##  6     6     63 &lt;NA&gt;       NA      NA      NA &lt;NA&gt;   
##  7     1     76 &lt;NA&gt;       NA      NA      NA &lt;NA&gt;   
##  8     2     54 &lt;NA&gt;       NA      NA      NA &lt;NA&gt;   
##  9     3    107 &lt;NA&gt;       NA      NA      NA &lt;NA&gt;   
## 10     4     56 &lt;NA&gt;       NA      NA      NA &lt;NA&gt;   
## # ... with 14 more rows</code></pre>
<p></p>
<p>Em seguida, vamos preencher as colunas vazias (<code>nome</code>, <code>salario</code>, <code>mes_ent</code>, …) de forma com que as informações de cada vendedor, apareçam apenas na última linha que diz respeito aquele vendedor. Como exemplo, as informações do vendedor Henrique, aparecem apenas na sexta linha da tabela, que é a última linha da tabela que se refere a ele.</p>
<p></p>
<div class="sourceCode" id="cb828"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb828-1"><a href="#cb828-1" aria-hidden="true" tabindex="-1"></a>valores <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb828-2"><a href="#cb828-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">salario =</span> <span class="fu">c</span>(<span class="dv">1560</span>, <span class="dv">2120</span>, <span class="dv">1745</span>, <span class="dv">1890</span>),</span>
<span id="cb828-3"><a href="#cb828-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">nome =</span> <span class="fu">c</span>(<span class="st">&quot;Henrique&quot;</span>, <span class="st">&quot;Ana&quot;</span>, <span class="st">&quot;João&quot;</span>, <span class="st">&quot;Milena&quot;</span>),</span>
<span id="cb828-4"><a href="#cb828-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">ano_ent =</span> <span class="fu">c</span>(<span class="dv">2000</span>, <span class="dv">2001</span>, <span class="dv">2010</span>, <span class="dv">2015</span>),</span>
<span id="cb828-5"><a href="#cb828-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">mes_ent =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">10</span>, <span class="dv">5</span>, <span class="dv">8</span>),</span>
<span id="cb828-6"><a href="#cb828-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">unidade =</span> <span class="fu">c</span>(<span class="st">&quot;Afonso Pena&quot;</span>, <span class="st">&quot;Savassi&quot;</span>, <span class="st">&quot;São Paulo&quot;</span>, <span class="st">&quot;Amazonas&quot;</span>)</span>
<span id="cb828-7"><a href="#cb828-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb828-8"><a href="#cb828-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb828-9"><a href="#cb828-9" aria-hidden="true" tabindex="-1"></a>colunas <span class="ot">&lt;-</span> <span class="fu">colnames</span>(funcionarios)[<span class="dv">3</span><span class="sc">:</span><span class="dv">7</span>]</span>
<span id="cb828-10"><a href="#cb828-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb828-11"><a href="#cb828-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> colunas){</span>
<span id="cb828-12"><a href="#cb828-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb828-13"><a href="#cb828-13" aria-hidden="true" tabindex="-1"></a>  funcionarios[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span> <span class="sc">*</span> <span class="dv">6</span>, i] <span class="ot">&lt;-</span> valores[[i]]</span>
<span id="cb828-14"><a href="#cb828-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb828-15"><a href="#cb828-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb828-16"><a href="#cb828-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb828-17"><a href="#cb828-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb828-18"><a href="#cb828-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Com isso, temos o seguinte resultado:</span></span>
<span id="cb828-19"><a href="#cb828-19" aria-hidden="true" tabindex="-1"></a>funcionarios <span class="sc">%&gt;%</span> <span class="fu">print</span>(<span class="at">n =</span> <span class="dv">12</span>)</span></code></pre></div>
<pre><code>## # A tibble: 24 x 7
##      mes vendas nome     salario mes_ent ano_ent unidade    
##    &lt;int&gt;  &lt;dbl&gt; &lt;chr&gt;      &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;      
##  1     1     38 &lt;NA&gt;          NA      NA      NA &lt;NA&gt;       
##  2     2     64 &lt;NA&gt;          NA      NA      NA &lt;NA&gt;       
##  3     3     98 &lt;NA&gt;          NA      NA      NA &lt;NA&gt;       
##  4     4     32 &lt;NA&gt;          NA      NA      NA &lt;NA&gt;       
##  5     5     58 &lt;NA&gt;          NA      NA      NA &lt;NA&gt;       
##  6     6     63 Henrique    1560       2    2000 Afonso Pena
##  7     1     76 &lt;NA&gt;          NA      NA      NA &lt;NA&gt;       
##  8     2     54 &lt;NA&gt;          NA      NA      NA &lt;NA&gt;       
##  9     3    107 &lt;NA&gt;          NA      NA      NA &lt;NA&gt;       
## 10     4     56 &lt;NA&gt;          NA      NA      NA &lt;NA&gt;       
## 11     5     70 &lt;NA&gt;          NA      NA      NA &lt;NA&gt;       
## 12     6     83 Ana         2120      10    2001 Savassi    
## # ... with 12 more rows</code></pre>
<p></p>
<p>Portanto, o que precisamos é aplicar a função <code>fill()</code> usando <code>.direction = "up"</code>, em cada uma dessas colunas vazias, de forma a preencher o restante das linhas com as informações de cada vendedor. Dada a natureza dessa tabela, os dois melhores mecanismos que aprendemos em <code>select()</code>, para selecionarmos essas colunas vazias, são: 1) usar os índices dessas colunas; 2) nos basearmos nos tipos de dados contidos em cada coluna; 3) usar um vetor externo com os nomes das colunas que desejamos.</p>
<p>Para utilizar o método 3 que citei acima, podemos utilizar o vetor <code>colunas</code> que criamos agora a pouco ao preenchermos a tabela, e já contém os nomes das colunas que desejamos. Porém, para o exemplo abaixo do método 2, você talvez se pergunte: “Se estamos aplicando a função <code>fill()</code> sobre todas as colunas que contém ou dados de texto (<code>character</code>), ou dados numéricos (<code>numeric</code>), nós também estamos aplicando a função sobre as colunas <code>mes</code> e <code>vendas</code>, das quais não necessitam de ajuste. O que acontece?” Nada irá ocorrer com as colunas <code>mes</code> e <code>vendas</code>, caso elas já estejam corretamente preenchidas, portanto, podemos aplicar a função sobre elas sem medo.</p>
<p></p>
<div class="sourceCode" id="cb830"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb830-1"><a href="#cb830-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Todas as três alternativas abaixo</span></span>
<span id="cb830-2"><a href="#cb830-2" aria-hidden="true" tabindex="-1"></a><span class="co"># geram o mesmo resultado:</span></span>
<span id="cb830-3"><a href="#cb830-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb830-4"><a href="#cb830-4" aria-hidden="true" tabindex="-1"></a>funcionarios <span class="sc">%&gt;%</span> </span>
<span id="cb830-5"><a href="#cb830-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fill</span>(</span>
<span id="cb830-6"><a href="#cb830-6" aria-hidden="true" tabindex="-1"></a>    <span class="dv">3</span><span class="sc">:</span><span class="dv">7</span>,</span>
<span id="cb830-7"><a href="#cb830-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">.direction =</span> <span class="st">&quot;up&quot;</span></span>
<span id="cb830-8"><a href="#cb830-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb830-9"><a href="#cb830-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb830-10"><a href="#cb830-10" aria-hidden="true" tabindex="-1"></a>funcionarios <span class="sc">%&gt;%</span> </span>
<span id="cb830-11"><a href="#cb830-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fill</span>(</span>
<span id="cb830-12"><a href="#cb830-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">all_of</span>(colunas),</span>
<span id="cb830-13"><a href="#cb830-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">.direction =</span> <span class="st">&quot;up&quot;</span></span>
<span id="cb830-14"><a href="#cb830-14" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p></p>
<p></p>
<div class="sourceCode" id="cb831"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb831-1"><a href="#cb831-1" aria-hidden="true" tabindex="-1"></a>funcionarios <span class="sc">%&gt;%</span> </span>
<span id="cb831-2"><a href="#cb831-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fill</span>(</span>
<span id="cb831-3"><a href="#cb831-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">where</span>(is.character),</span>
<span id="cb831-4"><a href="#cb831-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">where</span>(is.numeric),</span>
<span id="cb831-5"><a href="#cb831-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">.direction =</span> <span class="st">&quot;up&quot;</span></span>
<span id="cb831-6"><a href="#cb831-6" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 24 x 7
##      mes vendas nome     salario mes_ent ano_ent unidade    
##    &lt;int&gt;  &lt;dbl&gt; &lt;chr&gt;      &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;      
##  1     1     38 Henrique    1560       2    2000 Afonso Pena
##  2     2     64 Henrique    1560       2    2000 Afonso Pena
##  3     3     98 Henrique    1560       2    2000 Afonso Pena
##  4     4     32 Henrique    1560       2    2000 Afonso Pena
##  5     5     58 Henrique    1560       2    2000 Afonso Pena
##  6     6     63 Henrique    1560       2    2000 Afonso Pena
##  7     1     76 Ana         2120      10    2001 Savassi    
##  8     2     54 Ana         2120      10    2001 Savassi    
##  9     3    107 Ana         2120      10    2001 Savassi    
## 10     4     56 Ana         2120      10    2001 Savassi    
## # ... with 14 more rows</code></pre>
<p></p>
</div>
</div>
<div id="um-estudo-de-caso-sobre-médias-móveis-com-complete-e-fill" class="section level2" number="7.6">
<h2 number="7.6"><span class="header-section-number">7.6</span> Um estudo de caso sobre médias móveis com <code>complete()</code> e <code>fill()</code></h2>
<div id="a-metodologia-de-uma-média-móvel-no-r" class="section level3" number="7.6.1">
<h3 number="7.6.1"><span class="header-section-number">7.6.1</span> A metodologia de uma média móvel no R</h3>
<p>Uma média móvel é calculada ao aplicarmos o cálculo da média aritmética, sobre uma sequência de partes (ou <em>subsets</em>) de seus dados. De certa forma, esse processo se parece com uma rolagem, como se estivéssemos “rolando” o cálculo da média ao longo dos nossos dados. Veja por exemplo, o cálculo abaixo, onde utilizamos a função <code>roll_mean()</code> do pacote <code>RcppRoll</code> para calcularmos uma média móvel que possui uma janela de 3 valores.</p>
<p></p>
<div class="sourceCode" id="cb833"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb833-1"><a href="#cb833-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RcppRoll)</span></code></pre></div>
<p></p>
<p></p>
<div class="sourceCode" id="cb834"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb834-1"><a href="#cb834-1" aria-hidden="true" tabindex="-1"></a>vec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">2.7</span>, <span class="fl">3.0</span>, <span class="fl">1.5</span>, <span class="fl">3.2</span>, <span class="fl">1.6</span>, <span class="fl">2.5</span>)</span>
<span id="cb834-2"><a href="#cb834-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb834-3"><a href="#cb834-3" aria-hidden="true" tabindex="-1"></a><span class="fu">roll_mean</span>(vec, <span class="at">n =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>## [1] 2.400000 2.566667 2.100000 2.433333</code></pre>
<p></p>
<p>A janela (ou <em>window</em>) de uma média móvel, representa o número de observações que serão utilizadas no cálculo da média a cada “transição,” ou a cada “rolagem.” No exemplo acima, aplicamos uma média móvel com uma janela de 3 valores. Isso significa que a cada “rolagem,” são utilizados 3 valores no cálculo da média. Na primeiro rolagem, temos a média do vetor <code>(2.7, 3.0, 1.5)</code>. Já na segunda rolagem, temos a média do vetor <code>(3.0, 2.5, 3.2)</code>. E assim por diante. Portanto, em uma representação visual, o cálculo da média móvel aplicada por <code>roll_mean()</code>, é apresentado na figura 7.6.</p>
<p>Perceba também que o cálculo de uma média móvel implica em perda de observações. Pois no exemplo anterior, o vetor <code>vec</code> possui 6 valores, já o resultado de <code>roll_mean()</code> possui apenas 4 valores. Diversas operações estatísticas como essa, possuem o mesmo efeito. Um outro exemplo, seriam as operações de diferenciação, que são muito utilizadas em análises de séries temporais, e produzem essa mesma perda de informação. Por outro lado, no caso exposto aqui, essa perda de observações, ocorre devido ao tamanho da janela para o cálculo da média móvel.</p>
<p>Ou seja, pelo fato de que definimos uma janela de 3 observações para o cálculo da média móvel acima, as duas primeiras observações do vetor <code>vec</code>, não podem gerar a sua própria média móvel. Dito de outra forma, a função <code>roll_mean()</code> não pode calcular uma média nas duas primeiras rolagens sobre o vetor <code>vec</code>. Pois na primeira rolagem sobre o vetor, <code>roll_mean()</code> possui apenas uma observação (<code>2.7</code>). Já na segunda rolagem, <code>roll_mean()</code> acumula ainda duas observações (<code>2.7, 3.0</code>). Apenas a partir da terceira rolagem, que <code>roll_mean()</code> poderá calcular uma média segundo o tamanho da janela que definimos para ela, pois ela agora possui três observações (<code>2.7, 3.0, 1.5</code>) disponíveis para o cálculo. A partir daí, <code>roll_mean()</code> vai continuar rolando e calculando as médias móveis, até atingir o conjunto final de três observações do vetor <code>vec</code> (<code>3.2, 1.6, 2.5</code>).</p>
<p>Logo, sendo <span class="math inline">\(j\)</span> o número de observações presentes em cada janela de cálculo de sua média móvel, e <span class="math inline">\(lvec\)</span> sendo o número de valores presentes em seu vetor inicial, sobre o qual você irá calcular a sua média móvel. O número de médias móveis resultantes de <code>roll_mean()</code> (<span class="math inline">\(obs\)</span>), será equivalente a: <span class="math inline">\(obs = lvec - (j - 1)\)</span>. Em outras palavras, o número de observações que você irá perder (<span class="math inline">\(perda\)</span>), no cálculo de sua média móvel será equivalente a: <span class="math inline">\(perda = j - 1\)</span>.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/media_movel.png" alt="Representação do cálculo de uma média móvel" width="100%" />
<p class="caption">
(#fig:unnamed-chunk-433)Representação do cálculo de uma média móvel
</p>
</div>
<p></p>
<p>Agora, pode ser de seu desejo, contornar essa perda de observações de alguma maneira. Especialmente se você está calculando essa média móvel com base em uma coluna de sua tabela, pois sendo este o caso, provavelmente será de seu interesse, guardar essas médias calculadas em uma nova coluna dessa tabela. Entretanto, se você criar uma tabela, alocando por exemplo o vetor <code>vec</code> em uma coluna, e tentasse adicionar uma nova coluna contendo as médias móveis de cada ponto do vetor, o R lhe retornaria o erro abaixo. Caso você se lembre das propriedades dos <code>data.frame</code>’s no R, você irá entender o porquê que está motivando esse erro. Pois todas as colunas de um <code>data.frame</code> devem possuir obrigatoriamente o mesmo número de observações. Como nós perdemos duas das seis observações de <code>vec</code>, no cálculo da média móvel, o R não permite alocarmos diretamente essas médias em nossa tabela <code>df</code>.</p>
<p></p>
<div class="sourceCode" id="cb836"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb836-1"><a href="#cb836-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> vec)</span>
<span id="cb836-2"><a href="#cb836-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb836-3"><a href="#cb836-3" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>media_movel <span class="ot">&lt;-</span> <span class="fu">roll_mean</span>(df<span class="sc">$</span>x, <span class="at">n =</span> <span class="dv">3</span>)</span></code></pre></div>
<p></p>
<p></p>
<pre class="text"><code>Error in `$&lt;-.data.frame`(`*tmp*`, media_movel, value = c(2.4, 
2.56666666666667, : replacement has 4 rows, data has 6.</code></pre>
<p></p>
<p>A função <code>roll_mean()</code> oferece duas formas de contornar esse problema: 1) definir o alinhamento da função, para preencher as observações faltantes com valores não-disponíveis (<code>NA</code>); 2) ou preencher essas observações faltantes com um valor pré-definido, através de seu argumento <code>fill</code>. Ambas formas são válidas e possivelmente são o que você deseja.</p>
<p>O primeiro método que citei, envolve o alinhamento da função, que você irá definir através dos sufixos <code>r</code> e <code>l</code> no nome da função. A diferença entre os dois tipos de alinhamento, decide em que parte (no início, ou no final) do vetor resultante de <code>roll_mean()</code>, os valores não-disponíveis (<code>NA</code>) serão posicionados. Se você deseja utilizar o alinhamento à direita (<em>right</em> - <code>r</code>), você deve utilizar a função <code>roll_meanr()</code>. Mas se você quer utilizar o alinhamento à esquerda (<em>left</em> - <code>l</code>), você deve utilizar a função <code>roll_meanl()</code>.</p>
<p>Quanto ao segundo método que citei, que envolve o argumento <code>fill</code>, você pode utilizar o argumento <code>align</code>, para definir em que partes do vetor resultante, o valor que você definiu em <code>fill</code> será posicionado. Por exemplo, caso eu use o valor <em>center</em> em <code>align</code>, o valor definido em <code>fill</code> vai aparecer tanto no início quanto ao fim do vetor que resulta da função <code>roll_mean()</code>. Mas se eu utilizar o valor <em>right</em> em <code>align</code>, esse valor irá aparecer ao início do vetor resultante.</p>
<p></p>
<div class="sourceCode" id="cb838"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb838-1"><a href="#cb838-1" aria-hidden="true" tabindex="-1"></a><span class="fu">roll_meanr</span>(vec, <span class="at">n =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>## [1]       NA       NA 2.400000 2.566667 2.100000 2.433333</code></pre>
<div class="sourceCode" id="cb840"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb840-1"><a href="#cb840-1" aria-hidden="true" tabindex="-1"></a><span class="fu">roll_meanl</span>(vec, <span class="at">n =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>## [1] 2.400000 2.566667 2.100000 2.433333       NA       NA</code></pre>
<div class="sourceCode" id="cb842"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb842-1"><a href="#cb842-1" aria-hidden="true" tabindex="-1"></a><span class="fu">roll_mean</span>(vec, <span class="at">n =</span> <span class="dv">3</span>, <span class="at">fill =</span> <span class="dv">0</span>, <span class="at">align =</span> <span class="st">&quot;center&quot;</span>)</span></code></pre></div>
<pre><code>## [1] 0.000000 2.400000 2.566667 2.100000 2.433333 0.000000</code></pre>
<div class="sourceCode" id="cb844"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb844-1"><a href="#cb844-1" aria-hidden="true" tabindex="-1"></a><span class="fu">roll_mean</span>(vec, <span class="at">n =</span> <span class="dv">3</span>, <span class="at">fill =</span> <span class="dv">0</span>, <span class="at">align =</span> <span class="st">&quot;right&quot;</span>)</span></code></pre></div>
<pre><code>## [1] 0.000000 0.000000 2.400000 2.566667 2.100000 2.433333</code></pre>
<div class="sourceCode" id="cb846"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb846-1"><a href="#cb846-1" aria-hidden="true" tabindex="-1"></a><span class="fu">roll_mean</span>(vec, <span class="at">n =</span> <span class="dv">3</span>, <span class="at">fill =</span> <span class="dv">0</span>, <span class="at">align =</span> <span class="st">&quot;left&quot;</span>)</span></code></pre></div>
<pre><code>## [1] 2.400000 2.566667 2.100000 2.433333 0.000000 0.000000</code></pre>
<p></p>
</div>
<div id="sec:dados_covid" class="section level3" number="7.6.2">
<h3 number="7.6.2"><span class="header-section-number">7.6.2</span> Os dados da Covid-19</h3>
<p>Na próxima seção, busco dar um exemplo prático de como as funções <code>complete()</code> e <code>fill()</code> que vimos nas seções anteriores, podem ser utilizadas em conjunto em um problema real. Para isso, vamos utilizar parte dos dados sobre a Covid-19 (SARS-COV-2) no Brasil. Ao utilizar o código abaixo, lembre-se de renomear a primeira coluna da tabela para <code>dia</code>. Dessa forma, nós evitamos confusões com qualquer função que possua um argumento chamado <code>data</code> (funções como <code>mutate()</code>, <code>select()</code>, <code>complete()</code>, <code>lm()</code> e muitas outras possuem tal argumento).</p>
<p></p>
<div class="sourceCode" id="cb848"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb848-1"><a href="#cb848-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb848-2"><a href="#cb848-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-3"><a href="#cb848-3" aria-hidden="true" tabindex="-1"></a>github <span class="ot">&lt;-</span> <span class="st">&quot;https://raw.githubusercontent.com/pedropark99/&quot;</span></span>
<span id="cb848-4"><a href="#cb848-4" aria-hidden="true" tabindex="-1"></a>arquivo <span class="ot">&lt;-</span> <span class="st">&quot;Curso-R/master/Dados/covid.csv&quot;</span></span>
<span id="cb848-5"><a href="#cb848-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-6"><a href="#cb848-6" aria-hidden="true" tabindex="-1"></a>covid <span class="ot">&lt;-</span> <span class="fu">read_csv2</span>(<span class="fu">paste0</span>(github, arquivo))</span>
<span id="cb848-7"><a href="#cb848-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-8"><a href="#cb848-8" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(covid)[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="st">&quot;dia&quot;</span></span></code></pre></div>
<p></p>
<p>A Fundação João Pinheiro (FJP-MG) tem dado apoio técnico ao governo de Minas Gerais, no acompanhamento da pandemia de COVID-19, ao gerar estatísticas e estimações epidemiológicas para o estado. Eu fiz parte desse esforço por algum tempo, e uma demanda real que havia chegado para mim na época, consistia no cálculo de uma média móvel dos novos casos diários da doença para cada estado do Brasil. Pois era de desejo da Secretaria Estadual de Saúde, comparar a curva dessa média móvel do estado de Minas Gerais, com a de outros estados brasileiros.</p>
<p>Na época em que trabalhei com a base <code>covid</code>, ela possuía algumas barreiras, que superei com o uso de <code>complete()</code> e <code>fill()</code>. São essas barreiras, e suas resoluções que busco mostrar nessa seção, como um exemplo real de uso dessas funções. Porém, a base <code>covid</code> que está disponível hoje, e que você acaba de importar através dos comandos acima, é a base já corrigida e reformatada e, por isso, ela já se encontra em um formato ideal para o cálculo de uma média móvel. Portanto, antes de partirmos para a prática, vou aplicar algumas transformações, com o objetivo de “corromper” a base <code>covid</code> até o seu ponto inicial. Pois o foco nessa seção, se encontra na demonstração dos problemas de formatação da base, e em suas possíveis soluções.</p>
<p>O primeiro ponto a ser discutido, são as datas iniciais da pandemia em cada estado brasileiro. No Brasil, a pandemia de Covid-19 atingiu primeiramente o estado de São Paulo, e chegou posteriormente aos demais estados. Como podemos ver pelo resultado abaixo, a data inicial de cada estado, ao longo da base <code>covid</code> é difusa. Em alguns estados, os registros se iniciam a partir da data do primeiro registro de casos da doença (como os estados do Acre, Alagoas, Bahia, Amazonas e Espírito Santo). Alguns estados, registraram mais de um caso já no primeiro dia (como o Acre, que registrou três casos no dia 17 de março, e o Ceará, que reportou nove casos no dia 16 de março). Porém, outros estados (como a Paraíba) não seguem esse padrão, pois no seu primeiro dia de registro, o número de casos reportados foi igual a zero. Ou seja, a pandemia no estado da Paraíba não se iniciou oficialmente no dia 12 de março, pois não havia casos reportados até este dia.</p>
<p></p>
<div class="sourceCode" id="cb849"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb849-1"><a href="#cb849-1" aria-hidden="true" tabindex="-1"></a>data_inicial <span class="ot">&lt;-</span> covid <span class="sc">%&gt;%</span> </span>
<span id="cb849-2"><a href="#cb849-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(estado) <span class="sc">%&gt;%</span> </span>
<span id="cb849-3"><a href="#cb849-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb849-4"><a href="#cb849-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">data_inicial =</span> <span class="fu">min</span>(dia),</span>
<span id="cb849-5"><a href="#cb849-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">casos_inicial =</span> <span class="fu">min</span>(casos)</span>
<span id="cb849-6"><a href="#cb849-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb849-7"><a href="#cb849-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb849-8"><a href="#cb849-8" aria-hidden="true" tabindex="-1"></a>data_inicial <span class="sc">%&gt;%</span> <span class="fu">print</span>(<span class="at">n =</span> <span class="dv">15</span>)</span></code></pre></div>
<pre><code>## # A tibble: 27 x 3
##    estado data_inicial casos_inicial
##    &lt;chr&gt;  &lt;date&gt;               &lt;dbl&gt;
##  1 AC     2020-03-17               3
##  2 AL     2020-03-08               1
##  3 AM     2020-03-13               2
##  4 AP     2020-03-20               1
##  5 BA     2020-03-06               1
##  6 CE     2020-03-16               9
##  7 DF     2020-03-07               1
##  8 ES     2020-03-05               1
##  9 GO     2020-03-12               3
## 10 MA     2020-03-20               1
## 11 MG     2020-03-08               1
## 12 MS     2020-03-14               2
## 13 MT     2020-03-20               1
## 14 PA     2020-03-18               1
## 15 PB     2020-03-12               0
## # ... with 12 more rows</code></pre>
<p></p>
<p>Isso não representa um grande problema, mas antes das próximas transformações, devemos iniciar os dados de cada estado, no dia de primeiro registro de casos da doença. Isto é, os dados da Paraíba, por exemplo, devem se iniciar no dia em que houve pela primeira vez, um registro de casos maior do que zero. Como a coluna <code>casos</code>, representa o número acumulado de casos da doença, nós podemos realizar esse “nivelamento” entre os estados, ao eliminarmos da base, todas as linhas que possuem um número acumulado de casos igual a zero. Porém, vale a pena olharmos mais atentamente sobre essas linhas antes de eliminá-las, para termos certeza de que não estamos causando mais danos ao processo.</p>
<p>Perceba pelo resultado abaixo, que todos as linhas em que o número acumulado de casos se iguala a zero, pertencem ao estado da Paraíba. Todas essas seis datas, são “inúteis” para o propósito da base <code>covid</code>, pois apresentam um cenário anterior à pandemia no estado da Paraíba. Portanto, antes de prosseguirmos, vamos eliminar essas linhas, com o uso de <code>filter()</code>.</p>
<p></p>
<div class="sourceCode" id="cb851"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb851-1"><a href="#cb851-1" aria-hidden="true" tabindex="-1"></a>covid <span class="sc">%&gt;%</span> <span class="fu">filter</span>(casos <span class="sc">==</span> <span class="dv">0</span>)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 4
##   dia        estado casos mortes
##   &lt;date&gt;     &lt;chr&gt;  &lt;dbl&gt;  &lt;dbl&gt;
## 1 2020-03-12 PB         0      0
## 2 2020-03-13 PB         0      0
## 3 2020-03-14 PB         0      0
## 4 2020-03-15 PB         0      0
## 5 2020-03-16 PB         0      0
## 6 2020-03-17 PB         0      0</code></pre>
<div class="sourceCode" id="cb853"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb853-1"><a href="#cb853-1" aria-hidden="true" tabindex="-1"></a>covid <span class="ot">&lt;-</span> <span class="fu">filter</span>(covid, casos <span class="sc">!=</span> <span class="dv">0</span>)</span></code></pre></div>
<p></p>
<p>A base <code>covid</code> atualmente possui os números de casos diários acumulados de cada estado brasileiro. Mas vamos supor, que a base <code>covid</code> registrasse o número de casos acumulados, somente nos dias em que esse número se alterasse. Ou seja, se o número de casos acumulados da doença em uma segunda-feira qualquer do ano, era de 300, e esse número se manteve constante ao longo da semana, até que na sexta-feira, esse número subiu para 301 casos, a base <code>covid</code> irá registrar os números de casos acumulados apenas para as datas da segunda e da sexta dessa semana. Tal resultado pode ser atingido com os comandos abaixo. Como nós filtramos anteriormente a base, de forma a retirar as linhas com valores iguais a zero na coluna <code>casos</code>, temos que reconstruir o objeto <code>data_inicial</code>, como exposto abaixo.</p>
<p></p>
<div class="sourceCode" id="cb854"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb854-1"><a href="#cb854-1" aria-hidden="true" tabindex="-1"></a>data_inicial <span class="ot">&lt;-</span> covid <span class="sc">%&gt;%</span> </span>
<span id="cb854-2"><a href="#cb854-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(estado) <span class="sc">%&gt;%</span> </span>
<span id="cb854-3"><a href="#cb854-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb854-4"><a href="#cb854-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">data_inicial =</span> <span class="fu">min</span>(dia),</span>
<span id="cb854-5"><a href="#cb854-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">casos_inicial =</span> <span class="fu">min</span>(casos)</span>
<span id="cb854-6"><a href="#cb854-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb854-7"><a href="#cb854-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb854-8"><a href="#cb854-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">dia =</span> <span class="fu">as.Date</span>(data_inicial <span class="sc">-</span> <span class="dv">1</span>),</span>
<span id="cb854-9"><a href="#cb854-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">casos =</span> <span class="cn">NA_real_</span>,</span>
<span id="cb854-10"><a href="#cb854-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">mortes =</span> <span class="cn">NA_real_</span></span>
<span id="cb854-11"><a href="#cb854-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb854-12"><a href="#cb854-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb854-13"><a href="#cb854-13" aria-hidden="true" tabindex="-1"></a>covid <span class="ot">&lt;-</span> covid <span class="sc">%&gt;%</span> </span>
<span id="cb854-14"><a href="#cb854-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(</span>
<span id="cb854-15"><a href="#cb854-15" aria-hidden="true" tabindex="-1"></a>    data_inicial <span class="sc">%&gt;%</span> <span class="fu">select</span>(dia, estado, casos, mortes)</span>
<span id="cb854-16"><a href="#cb854-16" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb854-17"><a href="#cb854-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(estado) <span class="sc">%&gt;%</span> </span>
<span id="cb854-18"><a href="#cb854-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(</span>
<span id="cb854-19"><a href="#cb854-19" aria-hidden="true" tabindex="-1"></a>    dia,</span>
<span id="cb854-20"><a href="#cb854-20" aria-hidden="true" tabindex="-1"></a>    estado,</span>
<span id="cb854-21"><a href="#cb854-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">.by_group =</span> <span class="cn">TRUE</span></span>
<span id="cb854-22"><a href="#cb854-22" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb854-23"><a href="#cb854-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb854-24"><a href="#cb854-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">teste =</span> <span class="fu">lead</span>(casos) <span class="sc">==</span> casos</span>
<span id="cb854-25"><a href="#cb854-25" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb854-26"><a href="#cb854-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(teste <span class="sc">==</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb854-27"><a href="#cb854-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb854-28"><a href="#cb854-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>teste)</span></code></pre></div>
<p></p>
<p>Portanto, temos agora a tabela abaixo, onde podemos perceber que no dia 21 de março de 2020 não houve alteração no número de casos acumulados no estado do Acre. Pois esse dia (<code>2020-03-21</code>) não está mais presente na tabela <code>covid</code>. Dito de outra forma, o número de novos casos de Covid-19 que surgiram no dia 21 de março, foi igual a zero. O mesmo ocorre com os dias 25 e 27 de março no estado, que também não estão mais presentes na base.</p>
<p></p>
<div class="sourceCode" id="cb855"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb855-1"><a href="#cb855-1" aria-hidden="true" tabindex="-1"></a>covid</span></code></pre></div>
<pre><code>## # A tibble: 3,456 x 4
##    dia        estado casos mortes
##    &lt;date&gt;     &lt;chr&gt;  &lt;dbl&gt;  &lt;dbl&gt;
##  1 2020-03-18 AC         3      0
##  2 2020-03-19 AC         4      0
##  3 2020-03-20 AC         7      0
##  4 2020-03-22 AC        11      0
##  5 2020-03-23 AC        17      0
##  6 2020-03-24 AC        21      0
##  7 2020-03-26 AC        23      0
##  8 2020-03-28 AC        25      0
##  9 2020-03-29 AC        34      0
## 10 2020-03-30 AC        41      0
## # ... with 3,446 more rows</code></pre>
<p></p>
<p>Quando trabalhei anteriormente com a base <code>covid</code> anteriormente, ela se encontrava inicialmente em um formato muito próximo deste. Por isso, a base necessitava de ajustes para o cálculo da média móvel. O intuito da próxima seção, é demonstrar como eu fiz esses ajustes necessários, através das funções <code>complete()</code> e <code>fill()</code>.</p>
</div>
<div id="buscando-soluções-com-complete-e-fill" class="section level3" number="7.6.3">
<h3 number="7.6.3"><span class="header-section-number">7.6.3</span> Buscando soluções com <code>complete()</code> e <code>fill()</code></h3>
<p>Considerando que você aplicou as transformações expostas na seção anterior (<a href="#sec:dados_covid">Os dados da Covid-19</a>), você está apto a aplicar os comandos apresentados nessa seção. Agora, em que sentido essa nova tabela que temos, é inapropriada para o cálculo da média móvel diária de novos casos? Porque agora faltam os registros dos dias em que não houve alteração no número acumulado de casos em cada estado. Ou seja, nós retiramos na seção anterior, justamente aquilo que queremos recuperar nessa seção. Como eu disse, o intuito dessas seções, está nos exemplos de uso das funções <code>complete()</code> e <code>fill()</code>, e não no caminho que temos que percorrer para estarmos aptos para a aplicação desses exemplos.</p>
<p>Portanto, o problema que possuímos agora no cálculo da média móvel sobre a base <code>covid</code>, é que faltam os dias onde o número de casos acumulados permaneceu constante. Isso significa que agora temos uma quebra no cálculo da média móvel. Caso o vetor <code>vec</code> abaixo, representasse uma parte da coluna <code>casos</code> da nossa base <code>covid</code>, se aplicássemos uma média móvel, com uma janela de 3 valores, as médias dos dias 03 e 04 não poderiam ser calculadas (ou no mínimo, estariam incorretas), tendo em vista as transformações que aplicamos na seção anterior.</p>
<p>Ou seja, considerando que nós eliminamos na seção anterior, todas as linhas de <code>covid</code>, onde o número acumulado de casos permaneceu constante em relação ao seu valor anterior; se aplicarmos a mesma transformação ao vetor <code>vec</code> abaixo, o valor referente ao dia 02 seria eliminado, e por isso, uma quebra ocorreria sobre o cálculo das médias móveis dos dias 03 e 04. Pois, dentre os valores dos 3 dias anteriores aos dias 03 e 04, estaria faltando o valor referente ao dia 02.</p>
<p></p>
<div class="sourceCode" id="cb857"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb857-1"><a href="#cb857-1" aria-hidden="true" tabindex="-1"></a>vec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Dia 01&quot;</span> <span class="ot">=</span> <span class="dv">1</span>, <span class="st">&quot;Dia 02&quot;</span> <span class="ot">=</span> <span class="dv">1</span>, <span class="st">&quot;Dia 03&quot;</span> <span class="ot">=</span> <span class="dv">3</span>, </span>
<span id="cb857-2"><a href="#cb857-2" aria-hidden="true" tabindex="-1"></a>         <span class="st">&quot;Dia 04&quot;</span> <span class="ot">=</span> <span class="dv">5</span>, <span class="st">&quot;Dia 05&quot;</span> <span class="ot">=</span> <span class="dv">7</span>)</span>
<span id="cb857-3"><a href="#cb857-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb857-4"><a href="#cb857-4" aria-hidden="true" tabindex="-1"></a>vec</span></code></pre></div>
<pre><code>## Dia 01 Dia 02 Dia 03 Dia 04 Dia 05 
##      1      1      3      5      7</code></pre>
<p></p>
<p>São por essas razões, que devemos recuperar os dias perdidos na tabela <code>covid</code>, mesmo que o número de casos nesses dias tenham permanecido constantes. No nosso caso, não podemos utilizar diretamente as colunas da base <code>covid</code>, para expandirmos a tabela, e recuperarmos as datas que foram perdidas. Pois essas datas não se encontram mais na tabela <code>covid</code>. Lembre-se que a função <code>complete()</code> irá sempre trabalhar com as observações que estão presentes em sua base, caso você não forneça algo a mais, com a qual ela possa trabalhar. Por isso, teremos que gerar na função <code>complete()</code>, um vetor externo à base <code>covid</code>, de forma a incluirmos todas as datas que faltam.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Introducao_R_files/figure-html/unnamed-chunk-444-1.png" alt="Representação das séries temporais da base `covid` pré e pós-transformações" width="90%" />
<p class="caption">
(#fig:unnamed-chunk-444)Representação das séries temporais da base <code>covid</code> pré e pós-transformações
</p>
</div>
<p></p>
<p>Antes de prosseguir, vamos compreender exatamente qual é o estado atual da base <code>covid</code>. Nós eliminamos (na seção anterior) parte dos dias da base. Mais especificamente aqueles dias em que o número acumulado de casos da doença, permaneceu constante em relação a seu valor anterior. Portanto, neste momento, as séries temporais do número de casos de cada estado apresentam quebras. Em uma representação visual, essas séries se assemelham no momento às linhas em cor preta, apresentadas no gráfico da figura 7.7. São essas quebras que nos impedem de calcularmos uma média móvel desses casos.</p>
<p>O primeiro passo, será expandir essas séries com a função <code>complete()</code>. Utilizando-se de um vetor (construído pela função <code>seq.Date()</code>), contendo desde o dia 1 da pandemia no país (dia dos primeiros casos no estado de São Paulo, onde a pandemia se iniciou) até o último dia da base. Com isso, a função <code>complete()</code> irá combinar cada uma dessas datas, com cada um dos 27 estados. Após essa expansão da tabela <code>covid</code>, as séries de cada estado vão incluir todas as datas possíveis, incluindo aquelas que originalmente não pertenciam aquele estado. Dessa forma, as séries de cada estado, vão ser equivalentes à junção das linhas pretas, azuis e vermelhas no gráfico da figura 7.7. Formando assim novamente uma série “sólida,” ou completa.</p>
<p></p>
<div class="sourceCode" id="cb859"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb859-1"><a href="#cb859-1" aria-hidden="true" tabindex="-1"></a>menor_data <span class="ot">&lt;-</span> <span class="fu">min</span>(data_inicial<span class="sc">$</span>data_inicial)</span>
<span id="cb859-2"><a href="#cb859-2" aria-hidden="true" tabindex="-1"></a>maior_data <span class="ot">&lt;-</span> <span class="fu">max</span>(covid<span class="sc">$</span>dia)</span>
<span id="cb859-3"><a href="#cb859-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb859-4"><a href="#cb859-4" aria-hidden="true" tabindex="-1"></a>novo_covid <span class="ot">&lt;-</span> covid <span class="sc">%&gt;%</span> </span>
<span id="cb859-5"><a href="#cb859-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">complete</span>(</span>
<span id="cb859-6"><a href="#cb859-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">dia =</span> <span class="fu">seq.Date</span>(menor_data, maior_data, <span class="at">by =</span> <span class="st">&quot;day&quot;</span>),</span>
<span id="cb859-7"><a href="#cb859-7" aria-hidden="true" tabindex="-1"></a>    estado</span>
<span id="cb859-8"><a href="#cb859-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb859-9"><a href="#cb859-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(estado) <span class="sc">%&gt;%</span> </span>
<span id="cb859-10"><a href="#cb859-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(dia, estado, <span class="at">.by_group =</span> T) <span class="sc">%&gt;%</span> </span>
<span id="cb859-11"><a href="#cb859-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb859-12"><a href="#cb859-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb859-13"><a href="#cb859-13" aria-hidden="true" tabindex="-1"></a>novo_covid</span></code></pre></div>
<pre><code>## # A tibble: 4,131 x 4
##    dia        estado casos mortes
##    &lt;date&gt;     &lt;chr&gt;  &lt;dbl&gt;  &lt;dbl&gt;
##  1 2020-02-25 AC        NA     NA
##  2 2020-02-26 AC        NA     NA
##  3 2020-02-27 AC        NA     NA
##  4 2020-02-28 AC        NA     NA
##  5 2020-02-29 AC        NA     NA
##  6 2020-03-01 AC        NA     NA
##  7 2020-03-02 AC        NA     NA
##  8 2020-03-03 AC        NA     NA
##  9 2020-03-04 AC        NA     NA
## 10 2020-03-05 AC        NA     NA
## # ... with 4,121 more rows</code></pre>
<p></p>
<p>O segundo passo, será “nivelar” as séries de acordo com o período inicial de cada estado. Pois, como resultado do passo anterior, as séries de todos os estados serão iguais em comprimento (ou em número de observações). Pois as séries de todos os estados, estarão incluindo desde o dia 1 da pandemia, até o último dia da pandemia. Portanto, seguindo o gráfico da figura 7.7, no segundo passo estaremos eliminando a área vermelha de cada série, de forma que as séries de cada estado vão se equivaler à junção das linhas em preto e azul. Para isso, podemos aplicar os comandos abaixo:</p>
<p></p>
<div class="sourceCode" id="cb861"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb861-1"><a href="#cb861-1" aria-hidden="true" tabindex="-1"></a>novo_covid <span class="ot">&lt;-</span> novo_covid <span class="sc">%&gt;%</span> </span>
<span id="cb861-2"><a href="#cb861-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">right_join</span>(</span>
<span id="cb861-3"><a href="#cb861-3" aria-hidden="true" tabindex="-1"></a>    data_inicial[<span class="fu">c</span>(<span class="st">&quot;estado&quot;</span>, <span class="st">&quot;data_inicial&quot;</span>)],</span>
<span id="cb861-4"><a href="#cb861-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="st">&quot;estado&quot;</span></span>
<span id="cb861-5"><a href="#cb861-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb861-6"><a href="#cb861-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb861-7"><a href="#cb861-7" aria-hidden="true" tabindex="-1"></a>teste <span class="ot">&lt;-</span> novo_covid<span class="sc">$</span>dia <span class="sc">&gt;=</span> novo_covid<span class="sc">$</span>data_inicial</span>
<span id="cb861-8"><a href="#cb861-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb861-9"><a href="#cb861-9" aria-hidden="true" tabindex="-1"></a>novo_covid <span class="ot">&lt;-</span> novo_covid[teste, ]</span>
<span id="cb861-10"><a href="#cb861-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb861-11"><a href="#cb861-11" aria-hidden="true" tabindex="-1"></a>novo_covid</span></code></pre></div>
<pre><code>## # A tibble: 3,670 x 5
##    dia        estado casos mortes data_inicial
##    &lt;date&gt;     &lt;chr&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;date&gt;      
##  1 2020-03-17 AC        NA     NA 2020-03-17  
##  2 2020-03-18 AC         3      0 2020-03-17  
##  3 2020-03-19 AC         4      0 2020-03-17  
##  4 2020-03-20 AC         7      0 2020-03-17  
##  5 2020-03-21 AC        NA     NA 2020-03-17  
##  6 2020-03-22 AC        11      0 2020-03-17  
##  7 2020-03-23 AC        17      0 2020-03-17  
##  8 2020-03-24 AC        21      0 2020-03-17  
##  9 2020-03-25 AC        NA     NA 2020-03-17  
## 10 2020-03-26 AC        23      0 2020-03-17  
## # ... with 3,660 more rows</code></pre>
<p></p>
<p>O terceiro passo, envolve o uso de <code>fill()</code> para completarmos o número de casos em cada data recuperada. Lembre-se que ao expandirmos a tabela com <code>complete()</code>, a função preencheu os campos das colunas <code>casos</code> e <code>mortes</code> com valores não-disponíveis (<code>NA</code>), na linha de cada data que não estava presente anteriormente na base <code>covid</code> (ou seja, as datas que foram perdidas anteriormente). Portanto, todas as linhas que possuem um valor <code>NA</code> nessas colunas, são as linhas que correspondem aos dias em que o número acumulado de casos se manteve constante. Como esse número se manteve constante, tudo o que precisamos fazer, é utilizar <code>fill()</code> para puxar os valores disponíveis anteriores para esses campos.</p>
<p></p>
<div class="sourceCode" id="cb863"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb863-1"><a href="#cb863-1" aria-hidden="true" tabindex="-1"></a>novo_covid <span class="ot">&lt;-</span> novo_covid <span class="sc">%&gt;%</span> </span>
<span id="cb863-2"><a href="#cb863-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fill</span>(casos, mortes, <span class="at">.direction =</span> <span class="st">&quot;up&quot;</span>)</span>
<span id="cb863-3"><a href="#cb863-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb863-4"><a href="#cb863-4" aria-hidden="true" tabindex="-1"></a>novo_covid</span></code></pre></div>
<pre><code>## # A tibble: 3,670 x 5
##    dia        estado casos mortes data_inicial
##    &lt;date&gt;     &lt;chr&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;date&gt;      
##  1 2020-03-17 AC         3      0 2020-03-17  
##  2 2020-03-18 AC         3      0 2020-03-17  
##  3 2020-03-19 AC         4      0 2020-03-17  
##  4 2020-03-20 AC         7      0 2020-03-17  
##  5 2020-03-21 AC        11      0 2020-03-17  
##  6 2020-03-22 AC        11      0 2020-03-17  
##  7 2020-03-23 AC        17      0 2020-03-17  
##  8 2020-03-24 AC        21      0 2020-03-17  
##  9 2020-03-25 AC        23      0 2020-03-17  
## 10 2020-03-26 AC        23      0 2020-03-17  
## # ... with 3,660 more rows</code></pre>
<p></p>
<p>Dessa forma, temos novamente, a tabela corretamente formatada, e pronta para o cálculo de uma média móvel. O número acumulado de casos certamente tende a aumentar com o tempo, mas será que a variação desse número, segue o mesmo padrão? Para calcularmos essa variação, podemos utilizar a função <code>lag()</code> para utilizarmos o valor da linha anterior de uma coluna. Com isso, podemos subtrair o valor da linha anterior, sobre o valor da linha atual, tirando assim, a diferença ou a variação entre elas. Em seguida, basta aplicarmos a função <code>roll_meanr()</code> sobre esta variação, para adquirirmos uma média móvel do número de novos casos diários.</p>
<p></p>
<div class="sourceCode" id="cb865"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb865-1"><a href="#cb865-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RcppRoll)</span>
<span id="cb865-2"><a href="#cb865-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb865-3"><a href="#cb865-3" aria-hidden="true" tabindex="-1"></a>novo_covid <span class="ot">&lt;-</span> novo_covid <span class="sc">%&gt;%</span> </span>
<span id="cb865-4"><a href="#cb865-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(estado) <span class="sc">%&gt;%</span> </span>
<span id="cb865-5"><a href="#cb865-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb865-6"><a href="#cb865-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">novos_casos =</span> casos <span class="sc">-</span> <span class="fu">lag</span>(casos),</span>
<span id="cb865-7"><a href="#cb865-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">media_casos =</span> <span class="fu">roll_meanr</span>(novos_casos, <span class="at">n =</span> <span class="dv">5</span>)</span>
<span id="cb865-8"><a href="#cb865-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb865-9"><a href="#cb865-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb865-10"><a href="#cb865-10" aria-hidden="true" tabindex="-1"></a>novo_covid</span></code></pre></div>
<pre><code>## # A tibble: 3,670 x 7
## # Groups:   estado [27]
##    dia        estado casos mortes data_inicial novos_casos media_casos
##    &lt;date&gt;     &lt;chr&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;date&gt;             &lt;dbl&gt;       &lt;dbl&gt;
##  1 2020-03-17 AC         3      0 2020-03-17            NA        NA  
##  2 2020-03-18 AC         3      0 2020-03-17             0        NA  
##  3 2020-03-19 AC         4      0 2020-03-17             1        NA  
##  4 2020-03-20 AC         7      0 2020-03-17             3        NA  
##  5 2020-03-21 AC        11      0 2020-03-17             4        NA  
##  6 2020-03-22 AC        11      0 2020-03-17             0         1.6
##  7 2020-03-23 AC        17      0 2020-03-17             6         2.8
##  8 2020-03-24 AC        21      0 2020-03-17             4         3.4
##  9 2020-03-25 AC        23      0 2020-03-17             2         3.2
## 10 2020-03-26 AC        23      0 2020-03-17             0         2.4
## # ... with 3,660 more rows</code></pre>
<p></p>
<p></p>
<div class="sourceCode" id="cb867"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb867-1"><a href="#cb867-1" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> <span class="st">&quot;Média móvel de 5 dias para os novos casos de Covid-19 nos estados</span></span>
<span id="cb867-2"><a href="#cb867-2" aria-hidden="true" tabindex="-1"></a><span class="st">da região Sudeste&quot;</span></span>
<span id="cb867-3"><a href="#cb867-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb867-4"><a href="#cb867-4" aria-hidden="true" tabindex="-1"></a>novo_covid <span class="sc">%&gt;%</span> </span>
<span id="cb867-5"><a href="#cb867-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(estado <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;SP&quot;</span>, <span class="st">&quot;MG&quot;</span>, <span class="st">&quot;RJ&quot;</span>, <span class="st">&quot;ES&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb867-6"><a href="#cb867-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb867-7"><a href="#cb867-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(</span>
<span id="cb867-8"><a href="#cb867-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> dia, <span class="at">y =</span> <span class="fu">log</span>(media_casos), <span class="at">color =</span> estado),</span>
<span id="cb867-9"><a href="#cb867-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">1</span></span>
<span id="cb867-10"><a href="#cb867-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb867-11"><a href="#cb867-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb867-12"><a href="#cb867-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>,</span>
<span id="cb867-13"><a href="#cb867-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb867-14"><a href="#cb867-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb867-15"><a href="#cb867-15" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb867-16"><a href="#cb867-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb867-17"><a href="#cb867-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> t,</span>
<span id="cb867-18"><a href="#cb867-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">&quot;Escala logarítmica&quot;</span>,</span>
<span id="cb867-19"><a href="#cb867-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Tempo&quot;</span>,</span>
<span id="cb867-20"><a href="#cb867-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;Unidade da Federação&quot;</span></span>
<span id="cb867-21"><a href="#cb867-21" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## Warning: Removed 20 row(s) containing missing values (geom_path).</code></pre>
<p><img src="Introducao_R_files/figure-html/unnamed-chunk-449-1.png" width="90%" style="display: block; margin: auto;" /></p>
<p></p>
</div>
</div>
<div id="exercícios-5" class="section level2 unnumbered">
<h2 class="unnumbered">Exercícios</h2>
<p><strong>Questão 7.1.</strong> Os itens desta questão vão utilizar a tabela <code>world_bank_pop</code>. Essa tabela advém do pacote <code>tidyr</code>, logo, caso você tenha chamado com sucesso por esse pacote através do comando <code>library()</code> você já possui acesso a essa tabela. A tabela <code>world_bank_pop</code> contém uma série histórica de vários dados populacionais para cada país descrito na base.</p>
<p></p>
<div class="sourceCode" id="cb869"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb869-1"><a href="#cb869-1" aria-hidden="true" tabindex="-1"></a>world_bank_pop</span></code></pre></div>
<pre><code>## # A tibble: 1,056 x 20
##    country indicator   `2000` `2001` `2002` `2003`  `2004`  `2005`   `2006`
##    &lt;chr&gt;   &lt;chr&gt;        &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;
##  1 ABW     SP.URB.TOTL 4.24e4 4.30e4 4.37e4 4.42e4 4.47e+4 4.49e+4  4.49e+4
##  2 ABW     SP.URB.GROW 1.18e0 1.41e0 1.43e0 1.31e0 9.51e-1 4.91e-1 -1.78e-2
##  3 ABW     SP.POP.TOTL 9.09e4 9.29e4 9.50e4 9.70e4 9.87e+4 1.00e+5  1.01e+5
##  4 ABW     SP.POP.GROW 2.06e0 2.23e0 2.23e0 2.11e0 1.76e+0 1.30e+0  7.98e-1
##  5 AFG     SP.URB.TOTL 4.44e6 4.65e6 4.89e6 5.16e6 5.43e+6 5.69e+6  5.93e+6
##  6 AFG     SP.URB.GROW 3.91e0 4.66e0 5.13e0 5.23e0 5.12e+0 4.77e+0  4.12e+0
##  7 AFG     SP.POP.TOTL 2.01e7 2.10e7 2.20e7 2.31e7 2.41e+7 2.51e+7  2.59e+7
##  8 AFG     SP.POP.GROW 3.49e0 4.25e0 4.72e0 4.82e0 4.47e+0 3.87e+0  3.23e+0
##  9 AGO     SP.URB.TOTL 8.23e6 8.71e6 9.22e6 9.77e6 1.03e+7 1.09e+7  1.15e+7
## 10 AGO     SP.URB.GROW 5.44e0 5.59e0 5.70e0 5.76e0 5.75e+0 5.69e+0  4.92e+0
## # ... with 1,046 more rows, and 11 more variables: 2007 &lt;dbl&gt;, 2008 &lt;dbl&gt;,
## #   2009 &lt;dbl&gt;, 2010 &lt;dbl&gt;, 2011 &lt;dbl&gt;, 2012 &lt;dbl&gt;, 2013 &lt;dbl&gt;,
## #   2014 &lt;dbl&gt;, 2015 &lt;dbl&gt;, 2016 &lt;dbl&gt;, 2017 &lt;dbl&gt;</code></pre>
<p></p>
<p>7.1.A) A tabela <code>world_bank_pop</code> não se encontra em um formato <em>tidy</em>. Indique qual (ou quais) dos pressupostos que definem o formato <em>tidy data</em> é (ou são) violado por essa tabela e, explique o porquê disso.</p>
<p>7.1.B) Repare que para além das colunas <code>country</code> e <code>indicator</code>, temos os dados populacionais espalhados ao longo de diversas colunas, onde cada coluna representa o valor dessa série histórica para um determinado ano. Utilize os conhecimentos desse capítulo para reunir essas várias colunas (que se referem a anos específicos da série) de modo que a base fique mais próxima de um formato <em>tidy data</em>.</p>
<p>7.1.C) Filtre todas as linhas da tabela que descrevem a população total de cada país (isto é, as linhas em que o valor na coluna <code>indicator</code> é igual ao código <code>"SP.POP.TOTL"</code>), em seguida, tente calcular a variação da população total entre cada ano da série, para todos os países.</p>
<!--chapter:end:07-tidy-data.Rmd-->
</div>
</div>
<div id="part-visualizando-seus-dados" class="section level1 unnumbered">
<h1 class="unnumbered">(PART) Visualizando seus dados</h1>
</div>
<div id="visualização-de-dados-com-ggplot2" class="section level1" number="8">
<h1 number="8"><span class="header-section-number">8</span> Visualização de dados com <code>ggplot2</code></h1>
<div id="introdução-e-pré-requisitos-2" class="section level2" number="8.1">
<h2 number="8.1"><span class="header-section-number">8.1</span> Introdução e pré-requisitos</h2>
<p>Esse é o primeiro capítulo em que vamos introduzir o pacote <code>ggplot2</code>, ou simplesmente <code>ggplot</code>. O <code>ggplot</code> é um pacote voltado para a visualização de dados, ou em outras palavras, para a construção de gráficos. Para que você possa acompanhar os exemplos dessa seção, você precisa ter o pacote instalado em sua máquina. Após instalá-lo, você pode tanto chamar diretamente pelo pacote <code>ggplot2</code>, quanto pelo <code>tidyverse</code>, que também o inclui, através da função <code>library()</code>.</p>
<p></p>
<div class="sourceCode" id="cb871"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb871-1"><a href="#cb871-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb871-2"><a href="#cb871-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code></pre></div>
<p></p>
</div>
<div id="o-que-é-o-ggplot-e-a-sua-gramática" class="section level2" number="8.2">
<h2 number="8.2"><span class="header-section-number">8.2</span> O que é o <code>ggplot</code> e a sua gramática</h2>
<p>A linguagem R é conhecida por sua capacidade gráfica, e <span class="citation"><a href="#ref-murrell2006" role="doc-biblioref">Murrell</a> (<a href="#ref-murrell2006" role="doc-biblioref">2006</a>)</span> oferece ótimos exemplos que atestam essa afirmação. Mesmo que a linguagem R ofereça “já de fábrica,” o pacote <code>lattice</code>, que já é capaz de muita coisa, o <code>ggplot</code> é sem dúvidas, o pacote mais popular da linguagem no que tange a criação de gráficos, pois ele oferece algo que os outros pacotes não tem, que é a sua <em>flexibilidade</em><a href="#fn19" class="footnote-ref" id="fnref19"><sup>19</sup></a>.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/phases9032.png" alt="phases9032 por Thomas Lin Pedersen" width="70%" />
<p class="caption">
(#fig:unnamed-chunk-453)phases9032 por Thomas Lin Pedersen
</p>
</div>
<p></p>
<p>Flexibilidade é uma das principais características (e a principal vantagem) do <code>ggplot</code>, e é o que amplia a sua utilização para além dos gráficos sérios e frios de um jornal científico, permitindo ao usuário criar gráficos vistosos, e um tanto peculiares. Veja por exemplo, a arte criada por Thomas Lin Pedersen, mostrada na figura 8.1. O que lhe dá essa liberdade dentro do <code>ggplot</code>, é a sua gramática.</p>
<p>O pacote <code>ggplot</code> (ou seu nome oficial - <code>ggplot2</code>) foi inicialmente desenvolvido por <span class="citation"><a href="#ref-wickham2016" role="doc-biblioref">Wickham</a> (<a href="#ref-wickham2016" role="doc-biblioref">2016</a>)</span>, e lançado pela primeira vez no ano de 2005. O pacote representa uma implementação da teoria desenvolvida por <span class="citation"><a href="#ref-wilkinson" role="doc-biblioref">Wilkinson</a> (<a href="#ref-wilkinson" role="doc-biblioref">2005</a>)</span>, chamada de <em>The Grammar of Graphics</em> (ou “a gramática dos gráficos”). Portanto, o <code>ggplot</code> busca abstrair os principais conceitos da teoria de <span class="citation"><a href="#ref-wilkinson" role="doc-biblioref">Wilkinson</a> (<a href="#ref-wilkinson" role="doc-biblioref">2005</a>)</span>, e implementá-los dentro da linguagem R.</p>
<p>Segundo a teoria de <span class="citation"><a href="#ref-wilkinson" role="doc-biblioref">Wilkinson</a> (<a href="#ref-wilkinson" role="doc-biblioref">2005</a>)</span>, todo e qualquer gráfico estatístico, pode ser descrito por um conjunto de camadas, ou componentes, que estão apresentados na figura 8.2. Dessa forma, na visão de <span class="citation"><a href="#ref-wilkinson" role="doc-biblioref">Wilkinson</a> (<a href="#ref-wilkinson" role="doc-biblioref">2005</a>)</span> todos os tipos de gráfico que conhecemos (pizza, barras, dispersão, <em>boxplot</em>, etc.) fazem parte de um mesmo grupo, e a característica que os tornam diferentes entre si, se encontra na forma como as camadas abaixo estão definidas em cada gráfico.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/camadas_grafico.png" alt="Camadas de um gráfico do ggplot, baseado em Wickham (2016)" width="60%" />
<p class="caption">
(#fig:unnamed-chunk-454)Camadas de um gráfico do ggplot, baseado em Wickham (2016)
</p>
</div>
<p></p>
<p>Tendo isso em mente, um gráfico do <code>ggplot</code> é composto por várias camadas, que em conjunto formam o gráfico desejado. A ideia por trás do pacote, portanto, é utilizar uma gramática para descrever de forma concisa, cada uma das camadas apresentadas na figura 8.2. Após definirmos essas camadas, nós podemos somá-las para construirmos o nosso gráfico final. Em outras palavras, você vai adicionando aos poucos, novas camadas ao gráfico, onde cada uma dessas camadas fica responsável por definir um componente específico do gráfico (escalas, formas geométricas, legendas, facetas, anotações, …). Caso seja de seu desejo, você pode deixar o próprio <code>ggplot</code> responsável por definir várias das camadas apresentadas na figura 8.2. Porém, em todo gráfico do <code>ggplot</code>, você deve obrigatoriamente definir as três camadas (em negrito na figura 8.2) apresentadas a seguir, sendo portanto, as camadas <strong>essenciais</strong> que formam a base de todo gráfico do <code>ggplot</code>.</p>
<ol style="list-style-type: decimal">
<li><p>Dados: os dados que o gráfico deve expor.</p></li>
<li><p>Mapeamento estético (<em>aesthetic mapping</em>): uma descrição de como as variáveis dispostas em seus dados devem ser mapeadas para elementos visuais (ou estéticos) de seu gráfico.</p></li>
<li><p>Geometrias: são as formas geométricas do gráfico que representam os seus dados, ou seja, em um gráfico de dispersão, seus dados são representados no gráfico por <em>pontos</em>, enquanto em um gráfico de barras, seus dados são representados por <em>retângulos</em>.</p></li>
</ol>
<p>A gramática do <code>ggplot</code>, representa, portanto, as regras que definem o emprego das funções necessárias, e de seus possíveis parâmetros para acessarmos e controlarmos cada uma das camadas mostradas na figura 8.2. Logo, cada uma dessas camadas, são controladas por uma função (ou por um conjunto de funções) diferente, que lhe permite o uso de diferentes mecanismos e valores em sua definição.</p>
</div>
<div id="iniciando-um-gráfico-do-ggplot" class="section level2" number="8.3">
<h2 number="8.3"><span class="header-section-number">8.3</span> Iniciando um gráfico do <code>ggplot</code></h2>
<div id="dados" class="section level3" number="8.3.1">
<h3 number="8.3.1"><span class="header-section-number">8.3.1</span> Dados</h3>
<p>Primeiro, vamos definir os dados que vamos utilizar em nossos gráficos. A tabela <code>datasus</code>, contém a contagem de mortes por homicídios dolosos em 2018 no Brasil, coletados a partir dos microdados do SIM/DATASUS. Nessa mesma tabela, temos a distribuição dessas mortes, por sexo, por faixa etária, pelo estado (Unidade da Federação - UF) em que as mortes ocorreram, e pela cor de pele dos indivíduos.</p>
<p></p>
<div class="sourceCode" id="cb872"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb872-1"><a href="#cb872-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb872-2"><a href="#cb872-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb872-3"><a href="#cb872-3" aria-hidden="true" tabindex="-1"></a>github <span class="ot">&lt;-</span> <span class="st">&quot;https://raw.githubusercontent.com/pedropark99/&quot;</span></span>
<span id="cb872-4"><a href="#cb872-4" aria-hidden="true" tabindex="-1"></a>pasta <span class="ot">&lt;-</span> <span class="st">&quot;Curso-R/master/Dados/&quot;</span></span>
<span id="cb872-5"><a href="#cb872-5" aria-hidden="true" tabindex="-1"></a>arquivo <span class="ot">&lt;-</span> <span class="st">&quot;datasus.csv&quot;</span></span>
<span id="cb872-6"><a href="#cb872-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb872-7"><a href="#cb872-7" aria-hidden="true" tabindex="-1"></a>datasus <span class="ot">&lt;-</span> <span class="fu">read_csv2</span>(<span class="fu">paste0</span>(github, pasta, arquivo))</span></code></pre></div>
<pre><code>## i Using &quot;&#39;,&#39;&quot; as decimal and &quot;&#39;.&#39;&quot; as grouping mark. Use `read_delim()` for more control.</code></pre>
<pre><code>## Rows: 1836 Columns: 6</code></pre>
<pre><code>## -- Column specification ---------------------------------------------------
## Delimiter: &quot;;&quot;
## chr (5): Faixa etaria, Genero, Cor, Nome UF, UF
## dbl (1): Contagem</code></pre>
<pre><code>## 
## i Use `spec()` to retrieve the full column specification for this data.
## i Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<div class="sourceCode" id="cb877"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb877-1"><a href="#cb877-1" aria-hidden="true" tabindex="-1"></a>datasus</span></code></pre></div>
<pre><code>## # A tibble: 1,836 x 6
##    `Faixa etaria` Genero    Cor      `Nome UF` UF    Contagem
##    &lt;chr&gt;          &lt;chr&gt;     &lt;chr&gt;    &lt;chr&gt;     &lt;chr&gt;    &lt;dbl&gt;
##  1 10 a 14        Feminino  Parda    Acre      AC           4
##  2 10 a 14        Masculino Parda    Acre      AC           4
##  3 15 a 19        Feminino  Branca   Acre      AC           2
##  4 15 a 19        Feminino  Parda    Acre      AC           4
##  5 15 a 19        Masculino Branca   Acre      AC           6
##  6 15 a 19        Masculino Parda    Acre      AC          65
##  7 15 a 19        Masculino Preta    Acre      AC           1
##  8 20 a 24        Feminino  Indígena Acre      AC           1
##  9 20 a 24        Feminino  Parda    Acre      AC           4
## 10 20 a 24        Masculino Branca   Acre      AC           7
## # ... with 1,826 more rows</code></pre>
<p></p>
<p>Vamos começar a montar o nosso gráfico. Você <strong>sempre</strong> inicia um gráfico de <code>ggplot</code>, pela função base do pacote - <code>ggplot()</code>. Essa função é responsável por criar o objeto base para o gráfico, e nela, possuímos dois argumentos que compõe duas das três camadas essenciais (que definimos na seção 8.2) desse gráfico, e que podem ou não ser fornecidos nessa função. Esses dois argumentos são: <em>data</em>, que é o nome da tabela onde estão os dados que serão utilizados no gráfico; e <em>mapping</em>, que é o <em>aesthetic mapping</em>, ou o mapeamento de variáveis de sua tabela, para componentes estéticos do gráfico. Ou seja, você não precisa necessariamente fornecer esses argumentos já na função <code>ggplot()</code>, pois você pode defini-los dentro das funções que formam as figuras geométricas (as funções <code>geom</code>). O importante, é que você sempre deve começar um gráfico <code>ggplot</code>, com a função <code>ggplot()</code>.</p>
<p>Mas então, qual é a diferença entre eu fornecer esses argumentos na função <code>ggplot()</code> ou dentro das funções <code>geom</code>? Pense em um exemplo, no qual você busca mostrar em um mesmo gráfico, duas informações diferentes. Você pode utilizar dois <code>geom</code>’s (ou formas geométricas) diferentes para mostrar e diferenciar essas duas informações no gráfico. Por exemplo, podemos ter um gráfico que contenha barras mostrando a evolução da dívida pública, e linhas mostrando a evolução do salário médio no país.</p>
<p>Caso você forneça os dois argumentos (<em>data</em> e <em>mapping</em>) na função <code>ggplot()</code>, você está dizendo ao programa, que ele deve utilizar a mesma base de dados, e o mesmo <em>aesthetic mapping</em>, em todos os formatos geométricos (<code>geom</code>) do gráfico. Enquanto, ao fornecer esses argumentos dentro de cada função <code>geom</code>, você estaria dizendo ao programa que utilize essa base de dados, e esse <em>aesthetic mapping</em>, apenas naquele formato geométrico (ou <code>geom</code>) especificamente. Tendo isso em mente, não conseguiríamos montar o gráfico descrito no parágrafo anterior, ao dar os argumentos já na função <code>ggplot()</code>. Pois o gráfico mostra duas informações diferentes (salário médio e dívida pública), ao longo dos <code>geom</code>’s do gráfico. Ou seja, os dois formatos geométricos dispostos no gráfico, utilizam dois <em>aesthetic mapping</em> diferentes. Quando chegarmos à seção 8.4 vou explicar isso em mais detalhes.</p>
<p>No nosso caso, os dados que vamos utilizar, estão na tabela <code>datasus</code>, por isso forneço ao argumento <em>data</em> o nome dessa tabela. Ao rodar o código logo abaixo, você vai perceber que ele gera apenas um quadro cinza vazio. Isso ocorre porque definimos apenas uma das camadas essenciais para compor o gráfico, que são os dados utilizados. Temos que definir as outras duas, para completarmos a base de um gráfico, por isso, vamos passar agora para o <em>aesthetic mapping</em>.</p>
<p></p>
<div class="sourceCode" id="cb879"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb879-1"><a href="#cb879-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> datasus)</span></code></pre></div>
<p></p>
</div>
<div id="mapeamento-de-variáveis-aesthetic-mapping" class="section level3" number="8.3.2">
<h3 number="8.3.2"><span class="header-section-number">8.3.2</span> Mapeamento de variáveis (<em>Aesthetic Mapping</em>)</h3>
<p>O <em>aesthetic mapping</em> representa o mapeamento, ou a conexão de variáveis em sua tabela (ou sua base de dados), com os componentes estéticos e visuais do gráfico. Nós controlamos esse mapeamento através da função <code>aes()</code>. Há diversos desses componentes visuais que compõe um gráfico, e os primeiros que vêm a sua mente, são provavelmente as cores e as formas geométricas. Mas também os próprios eixos, ou melhor dizendo, as escalas utilizadas nos eixos, são componentes visuais do gráfico. Pois essas escalas definem como as formas geométricas vão se posicionar dentro do espaço do gráfico.</p>
<p>Pense por exemplo, no globo terrestre. Você pode representar esse globo dentro do <code>ggplot</code>, mas para que os formatos sejam corretamente posicionados em um “globo,” você precisa usar uma escala e um sistema de coordenadas diferentes do plano cartesiano. Um outro exemplo, seria o gráfico de pizza. Ao pesquisar sobre, você irá perceber que um gráfico de pizza no <code>ggplot</code>, é feito a partir do formato geométrico de barras (<code>geom_bar()</code>). Ou seja, um gráfico de barras, é o ponto de partida para gerar um gráfico de pizza no <code>ggplot</code>, e o que diferencia esses dois gráficos, é a escala usada. Em um gráfico de pizza, utilizamos uma coordenada circular, chamada de coordenada polar, ao invés do plano cartesiano.</p>
<p>Agora, vamos continuar montando nosso gráfico. Primeiro, vamos tentar montar um gráfico de barras, que mostre a distribuição do total de mortes ao longo das faixas etárias no país, baseado nos dados apresentados na tabela <code>datasus</code>. Tendo isso em mente, o número de mortes, deve ficar no eixo y de nosso gráfico, enquanto os grupos (faixas etárias), devem ficar no eixo x.</p>
<p>Essa é a base do nosso mapeamento de variáveis. Estamos definindo que o número de mortes deve ficar no eixo y, e as faixas etárias no eixo x, e nós concedemos essa descrição ao <code>ggplot</code>, dentro da função <code>aes()</code> (abreviação para <em>aesthetic mapping</em>). Dessa vez, ao rodar o código abaixo você vai perceber que um plano cartesiano foi montado, onde temos uma escala para a faixa etária no eixo x, e outra escala para o total de mortes no eixo y. Porém, esse plano cartesiano continua vazio, pois ainda não definimos a última camada essencial do gráfico, que é a forma geométrica que deve representar os nossos dados.</p>
<p></p>
<div class="sourceCode" id="cb880"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb880-1"><a href="#cb880-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb880-2"><a href="#cb880-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> datasus,</span>
<span id="cb880-3"><a href="#cb880-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> <span class="st">`</span><span class="at">Faixa etaria</span><span class="st">`</span>, <span class="at">y =</span> Contagem)</span>
<span id="cb880-4"><a href="#cb880-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="Introducao_R_files/figure-html/unnamed-chunk-457-1.png" width="60%" style="display: block; margin: auto;" /></p>
<p></p>
<p>Portanto, vamos adicionar ao nosso código, nossa primeira função <code>geom</code>. Cada função <code>geom</code>, se refere a um formato geométrico diferente. No nosso caso, queremos um gráfico de barras, que é formado pela função <code>geom_bar()</code>. O padrão dessa função (ou formato geométrico) no <code>ggplot</code>, é calcular uma contagem dos dados. Em outras palavras, o gráfico de barras no <code>ggplot</code>, se comporta inicialmente (por padrão) como um histograma. Ao invés de calcular a soma total de certa variável, ele irá contar, quantas vezes cada valor ocorre naquela variável dentro da base de dados.</p>
<p>Entretanto, não queremos uma contagem dos dados, pois a coluna <code>Contagem</code> já representa uma contagem em si. O que queremos é a soma total dessa contagem em cada faixa etária. Por isso, ao invés de fornecer <code>Contagem</code> ao argumento <em>y</em>, eu defino essa coluna para o argumento <em>weight</em>. Todas as funções que adicionarmos às várias camadas do nosso gráfico, devem ser conectadas por um sinal de <code>+</code>, por isso lembre-se de colocar esse sinal sempre que adicionar uma nova função ao seu gráfico.</p>
<p></p>
<div class="sourceCode" id="cb881"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb881-1"><a href="#cb881-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb881-2"><a href="#cb881-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> datasus,</span>
<span id="cb881-3"><a href="#cb881-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> <span class="st">`</span><span class="at">Faixa etaria</span><span class="st">`</span>, <span class="at">weight =</span> Contagem)</span>
<span id="cb881-4"><a href="#cb881-4" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb881-5"><a href="#cb881-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>()</span></code></pre></div>
<p><img src="Introducao_R_files/figure-html/unnamed-chunk-458-1.png" width="60%" style="display: block; margin: auto;" /></p>
<p></p>
<p>Agora que definimos as três camadas essenciais (dados, <em>aesthethic mapping</em> e <code>geom</code>), temos enfim o nosso primeiro gráfico montado. Há várias coisas que poderíamos fazer a partir daqui. Podemos por exemplo, colorir as barras de acordo com a participação do sexo no número de mortes. Ou seja, essas cores irão representar em cada barra, o número de mortes que correspondem ao sexo masculino e ao sexo feminino. Por padrão, o <code>geom_bar()</code> empilha esses agrupamentos um em cima do outro. Dessa forma, essas cores não apenas nos apresenta o número de mortes em cada sexo, mas indiretamente, elas também nos mostram o quanto que aquele grupo representa (qual a sua porcentagem) do total de mortes naquela faixa etária.</p>
<p>Desta maneira, estamos definindo um outro componente visual do gráfico (cores das barras) à uma outra variável de nossos dados (coluna <code>Genero</code>). Logo, estamos falando novamente do <em>aesthethic mapping</em> do gráfico, e por isso, devemos definir essa ligação dentro da função <code>aes()</code>. Há duas formas de você colorir formas geométricas no <code>ggplot</code>, que dependem da forma geométrica e do resultado que você quer atingir. Uma barra (ou retângulo), é tratada como uma forma geométrica de área, enquanto outras formas (como pontos e linhas) são tratadas de uma maneira diferente. Nesses formatos de área, você deve utilizar o argumento <code>fill</code>, para preencher o interior deste formato de uma cor.</p>
<p></p>
<div class="sourceCode" id="cb882"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb882-1"><a href="#cb882-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb882-2"><a href="#cb882-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> datasus,</span>
<span id="cb882-3"><a href="#cb882-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(</span>
<span id="cb882-4"><a href="#cb882-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">`</span><span class="at">Faixa etaria</span><span class="st">`</span>,</span>
<span id="cb882-5"><a href="#cb882-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">weight =</span> Contagem,</span>
<span id="cb882-6"><a href="#cb882-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">fill =</span> Genero</span>
<span id="cb882-7"><a href="#cb882-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb882-8"><a href="#cb882-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb882-9"><a href="#cb882-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>()</span></code></pre></div>
<p><img src="Introducao_R_files/figure-html/unnamed-chunk-459-1.png" width="60%" style="display: block; margin: auto;" /></p>
<p></p>
<p>Conseguimos colorir as barras, e podemos ver que uma parte muito pequena das mortes correspondem ao sexo feminino, em todas as faixas etárias. Agora, e se mudássemos a variável de grupos (faixas etárias) do nosso gráfico? Vamos conectar uma variável diferente ao eixo x, por exemplo, a cor de pele. Perceba, que o restante do <em>aesthetic mapping</em> continua o mesmo, e portanto, o gráfico mantém essas outras “conexões” enquanto modifica a variável ligada ao eixo x.</p>
<p></p>
<div class="sourceCode" id="cb883"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb883-1"><a href="#cb883-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb883-2"><a href="#cb883-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> datasus,</span>
<span id="cb883-3"><a href="#cb883-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(</span>
<span id="cb883-4"><a href="#cb883-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> Cor,</span>
<span id="cb883-5"><a href="#cb883-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">weight =</span> Contagem,</span>
<span id="cb883-6"><a href="#cb883-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">fill =</span> Genero</span>
<span id="cb883-7"><a href="#cb883-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb883-8"><a href="#cb883-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb883-9"><a href="#cb883-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>()</span></code></pre></div>
<p><img src="Introducao_R_files/figure-html/unnamed-chunk-460-1.png" width="60%" style="display: block; margin: auto;" /></p>
<p></p>
<p>Como disse anteriormente, há outros componentes visuais que você pode ligar às variáveis de sua tabela de dados. Você pode por exemplo, em alguns <code>geom</code>’s, conectar o <em>formato</em> desse <code>geom</code> a uma variável. Eu sei, sua cabeça provavelmente deu uma volta com esse exemplo: “Como assim? Eu posso variar o formato de uma forma geométrica ao longo do gráfico?” Na seção 8.4 dou um exemplo dessa estratégia.</p>
</div>
<div id="formatos-geométricos---funções-geom" class="section level3" number="8.3.3">
<h3 number="8.3.3"><span class="header-section-number">8.3.3</span> Formatos geométricos - funções <code>geom</code></h3>
<p>Cada função <code>geom</code> utiliza um formato geométrico e uma forma de desenho diferentes, para desenhar e representar os seus dados. No <code>ggplot</code> há vários <code>geom</code>’s distintos que você pode utilizar. Abaixo estou listando os <code>geom</code>’s mais comuns, mas basta consultar o painel de dicas do RStudio<a href="#fn20" class="footnote-ref" id="fnref20"><sup>20</sup></a>, ou o site oficial de referências do pacote<a href="#fn21" class="footnote-ref" id="fnref21"><sup>21</sup></a>, que você ficará um pouco perdido com tantas opções. Um excelente repositório, com ótimos exemplos de gráficos dos quais você pode tirar inspirações de como e onde utilizar cada <code>geom</code>, é o <em>R Graph Gallery</em><a href="#fn22" class="footnote-ref" id="fnref22"><sup>22</sup></a>.</p>
<ol style="list-style-type: decimal">
<li><p><code>geom_bar()</code>: desenha um gráfico de barras.</p></li>
<li><p><code>geom_point()</code>: desenha um gráfico de pontos (ou um gráfico de dispersão).</p></li>
<li><p><code>geom_line()</code>: desenha um gráfico de linha.</p></li>
<li><p><code>geom_boxplot()</code>: desenha um gráfico de <em>boxplot</em>.</p></li>
<li><p><code>geom_histogram()</code>: desenha um histograma.</p></li>
<li><p><code>geom_sf()</code>: desenha um mapa (<code>geom</code> para dados espaciais).</p></li>
<li><p><code>geom_smooth()</code>: desenha uma linha de média condicional (muito utilizado para desenhar linhas que representam modelos de regressão linear e de outros modelos econométricos).</p></li>
<li><p><code>geom_text()</code>: utilizado para inserir texto.</p></li>
<li><p><code>geom_label()</code>: utilizado para inserir rótulos, ou basicamente, textos envoltos por uma caixa.</p></li>
</ol>
<p>Por exemplo, um gráfico de barras, é geralmente utilizado para apresentar estatísticas descritivas dos nossos dados. Ou seja, esse tipo de gráfico (por padrão) tenta resumir características dos seus dados em poucos números (médias, totais, contagens). Já um gráfico de dispersão (por padrão) nos apresenta diretamente os dados, de forma crua no plano cartesiano. Isto é, diferentes <code>geom</code>’s vão tratar (e principalmente, representar) os seus dados de formas distintas. Vamos por exemplo, adicionar pontos ao nosso gráfico anterior, com o <code>geom_point()</code>.</p>
<p>Para facilitar a visualização, eu limitei os valores do eixo y no gráfico (para o intervalo de 0 a 1500) por meio da função <code>lims()</code>. Dessa forma, estamos dando um <em>zoom</em> em uma área específica do gráfico. Repare que cada ponto representa uma das observações encontradas na nossa base, e que vários deles estão se sobrepondo.</p>
<p></p>
<div class="sourceCode" id="cb884"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb884-1"><a href="#cb884-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb884-2"><a href="#cb884-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> datasus,</span>
<span id="cb884-3"><a href="#cb884-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(</span>
<span id="cb884-4"><a href="#cb884-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> Cor,</span>
<span id="cb884-5"><a href="#cb884-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">weight =</span> Contagem,</span>
<span id="cb884-6"><a href="#cb884-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">fill =</span> Genero</span>
<span id="cb884-7"><a href="#cb884-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb884-8"><a href="#cb884-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb884-9"><a href="#cb884-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb884-10"><a href="#cb884-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> Contagem)) <span class="sc">+</span></span>
<span id="cb884-11"><a href="#cb884-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lims</span>(<span class="at">y =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1500</span>))</span></code></pre></div>
<pre><code>## Warning: Removed 6 rows containing missing values (geom_bar).</code></pre>
<p><img src="Introducao_R_files/figure-html/unnamed-chunk-461-1.png" width="60%" style="display: block; margin: auto;" /></p>
<p></p>
<p>Ao substituirmos as barras por <em>boxplot</em>’s produzimos um gráfico que além de mostrar todas observações da base com o <code>geom_point()</code>, ele também mostra como a distribuição de ambos os sexos se encaixam ao longo do alcance (ou <em>range</em>) desses dados. Podemos perceber que nos indivíduos de cor parda, a maior contagem para o sexo feminino em toda a base, atinge em torno de 175 mortes, enquanto para o sexo masculino, esses valores podem atingir mais de 1000 mortes, apesar de que ambos os valores são <em>outliers</em> em suas respectivas distribuições.</p>
<p></p>
<div class="sourceCode" id="cb886"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb886-1"><a href="#cb886-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb886-2"><a href="#cb886-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> datasus,</span>
<span id="cb886-3"><a href="#cb886-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(</span>
<span id="cb886-4"><a href="#cb886-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> Cor,</span>
<span id="cb886-5"><a href="#cb886-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> Contagem,</span>
<span id="cb886-6"><a href="#cb886-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">fill =</span> Genero</span>
<span id="cb886-7"><a href="#cb886-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb886-8"><a href="#cb886-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb886-9"><a href="#cb886-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb886-10"><a href="#cb886-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code></pre></div>
<p><img src="Introducao_R_files/figure-html/unnamed-chunk-462-1.png" width="60%" style="display: block; margin: auto;" /></p>
<p></p>
<p>Uma outra forma de visualizarmos a diferença entre homens e mulheres nesses dados, seria utilizando <code>geom</code>’s de erro, como as linhas de alcance. Os <code>geom</code>’s de erro são muito úteis para visualizar medidas de variação ao longo dos grupos. O <code>geom_ribbon()</code> por exemplo, é utilizado em gráficos de séries temporais, para desenhar os intervalos de confiança ou desvios padrão ao redor da linha que representa a série. No nosso caso, iremos utilizar o <code>geom_linerange()</code>, para desenharmos a diferença média entre o número de mortes entre os dois gêneros.</p>
<p>O que o <code>geom_linerange()</code> faz é desenhar uma reta de um ponto A a um ponto B. A ideia por traz desse <code>geom</code> é desenharmos um linha que representa (pelo seu comprimento), por exemplo, o desvio padrão de uma variável, ou no nosso caso, a diferença na média de vítimas de homicídios dolosos entre dois gêneros. Isto significa que temos dois novos componentes visuais que podemos controlar no gráfico através do <em>aesthetic mapping</em>, que são as coordenadas do ponto A e do ponto B. Esses componentes (pontos A e B) representam os “limites” (máximo e mínimo) dessa linha, por isso, são controlados pelos argumentos <code>ymax</code> e <code>ymin</code> dentro da função <code>aes()</code>. Há outros <code>geom</code>’s que podem ser controlados por esses argumentos, porém, os que vimos anteriormente (<code>geom_point()</code> e <code>geom_bar()</code>) não possuem esses argumentos.</p>
<p>Primeiro, precisamos calcular o número médio de mortes de cada gênero e em cada cor de pele, e em seguida, modificar a estrutura da tabela, para que possamos mapear os limites (<code>ymin</code> e <code>ymax</code>) do <em>linerange</em> de acordo com o sexo. Para isso utilizo funções do pacote <code>dplyr</code>, portanto lembre-se de chamar por esse pacote com <code>library()</code>, para ter acesso a essas funções. Perceba também que eu inverti o plano cartesiano, utilizando a função <code>coord_flip()</code>.</p>
<p></p>
<div class="sourceCode" id="cb887"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb887-1"><a href="#cb887-1" aria-hidden="true" tabindex="-1"></a>datasus_agrup <span class="ot">&lt;-</span> datasus <span class="sc">%&gt;%</span> </span>
<span id="cb887-2"><a href="#cb887-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Cor, Genero) <span class="sc">%&gt;%</span> </span>
<span id="cb887-3"><a href="#cb887-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Media =</span> <span class="fu">mean</span>(Contagem)) <span class="sc">%&gt;%</span> </span>
<span id="cb887-4"><a href="#cb887-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb887-5"><a href="#cb887-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">id_cols =</span> <span class="fu">c</span>(<span class="st">&quot;Cor&quot;</span>, <span class="st">&quot;Genero&quot;</span>),</span>
<span id="cb887-6"><a href="#cb887-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> <span class="st">&quot;Genero&quot;</span>,</span>
<span id="cb887-7"><a href="#cb887-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> <span class="st">&quot;Media&quot;</span></span>
<span id="cb887-8"><a href="#cb887-8" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;Cor&#39;. You can override using the `.groups` argument.</code></pre>
<div class="sourceCode" id="cb889"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb889-1"><a href="#cb889-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb889-2"><a href="#cb889-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> datasus_agrup,</span>
<span id="cb889-3"><a href="#cb889-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> Cor)</span>
<span id="cb889-4"><a href="#cb889-4" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb889-5"><a href="#cb889-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_linerange</span>(<span class="fu">aes</span>(<span class="at">ymax =</span> Masculino, <span class="at">ymin =</span> Feminino)) <span class="sc">+</span></span>
<span id="cb889-6"><a href="#cb889-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> Feminino, <span class="at">color =</span> <span class="st">&quot;Feminino&quot;</span>)) <span class="sc">+</span></span>
<span id="cb889-7"><a href="#cb889-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> Masculino, <span class="at">color =</span> <span class="st">&quot;Masculino&quot;</span>)) <span class="sc">+</span></span>
<span id="cb889-8"><a href="#cb889-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()</span></code></pre></div>
<p><img src="Introducao_R_files/figure-html/unnamed-chunk-463-1.png" width="60%" style="display: block; margin: auto;" /></p>
<p></p>
<p>Agora, muitas coisas estão ocorrendo neste gráfico. Primeiro, o <code>geom_linerange()</code> constrói uma linha para cada cor de pele, que vai da média de mortes no sexo feminino até a média no sexo masculino. Segundo, dois <code>geom_point()</code> são utilizados, onde cada um deles fica responsável por um dos sexos, e desenha um único ponto para cada cor de pele que indica a média de mortes para o sexo correspondente. Em seguida, eu uso <code>coord_flip()</code> para inverter o plano cartesiano. Ou seja, a variável que estava no eixo y (média de mortes) vai para o eixo x, e a variável que estava no eixo x (cor de pele) vai para o eixo y.</p>
<p>Certamente, esse gráfico dá um pouco mais de trabalho de construir. Porém, é uma forma mais simples de se mostrar essa diferença, e com isso, você consegue atingir um público maior. Pode ser que o seu leitor não saiba o que é um <em>boxplot</em>, e há razões razoáveis para se acreditar nisso. No Brasil, o <em>boxplot</em> não é comumente tratado no ensino básico, e sim no ensino superior, e mais especificamente, em cursos que sejam da área de exatas, ou que possuam matérias de estatística na grade curricular. Nós sabemos também que o acesso da população brasileira ao ensino superior é restrito, sendo considerado um local de “elitismo.”</p>
<p>Por outro lado, os alunos em geral veem as principais medidas estatísticas de posição central (média, mediana e moda) já no ensino básico, e alguns chegam a revê-las no ensino superior. Logo, as chances de seu leitor compreender a mensagem que você quer passar: “em média, os homens são as principais vítimas de homicídios dolosos, entretanto, nas populações indígenas e de cor de pele amarela, esse padrão não parece ser significativo” são maiores. Essa consideração pode ter menor peso a depender de qual seja o público que você busca atingir. Se você está publicando um artigo científico em sua área, é bem provável que os potenciais leitores deste material conheçam um <em>boxplot</em>, e portanto, saibam interpretá-lo corretamente.</p>
</div>
</div>
<div id="uma-outra-forma-de-se-compreender-o-aesthetic-mapping" class="section level2" number="8.4">
<h2 number="8.4"><span class="header-section-number">8.4</span> Uma outra forma de se compreender o <em>aesthetic mapping</em></h2>
<p>Nas seções anteriores, eu defini o <em>aesthetic mapping</em>, como a conexão entre as variáveis de sua tabela, com os componentes visuais de seu gráfico. Porém, temos uma outra forma útil de enxergarmos esse sistema. Podemos entender o <em>aesthetic mapping</em>, como um mecanismo para determinarmos quais componentes visuais vão variar, e quais vão permanecer constantes ao longo do gráfico. Ou seja, se você está definindo, por exemplo, as cores da forma geométrica (<code>geom</code>) que representa os seus dados, você pode utilizar o <em>aesthetic mapping</em> para definir se e como essas cores vão variar ao longo do gráfico.</p>
<p>Por exemplo, vamos voltar ao gráfico de barras que montamos na seção 8.3, que mostra o número total de mortes ao longo das diferentes cores de pele e gênero da base. Perceba, que a cor está variando dentro de cada barra (e não entre cada uma delas), de acordo com a variável <code>Genero</code>.</p>
<p></p>
<div class="sourceCode" id="cb890"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb890-1"><a href="#cb890-1" aria-hidden="true" tabindex="-1"></a>datasus <span class="sc">%&gt;%</span> </span>
<span id="cb890-2"><a href="#cb890-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb890-3"><a href="#cb890-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(</span>
<span id="cb890-4"><a href="#cb890-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> Cor, <span class="at">weight =</span> Contagem, <span class="at">fill =</span> Genero)</span>
<span id="cb890-5"><a href="#cb890-5" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="Introducao_R_files/figure-html/unnamed-chunk-464-1.png" width="60%" style="display: block; margin: auto;" /></p>
<p></p>
<p>Nós podemos modificar a forma como essas cores variam dentro de cada barra, ao mudarmos a variável que define essa variação. Em outras palavras, podemos alterar o comportamento das cores, ao conectar esse componente em <code>aes()</code>, a uma outra variável de nossa tabela. Como exemplo, podemos atribuir às UF’s da base. Perceba que temos agora, uma variação muito maior de cores dentro de cada barra.</p>
<p></p>
<div class="sourceCode" id="cb891"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb891-1"><a href="#cb891-1" aria-hidden="true" tabindex="-1"></a>datasus <span class="sc">%&gt;%</span> </span>
<span id="cb891-2"><a href="#cb891-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb891-3"><a href="#cb891-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(</span>
<span id="cb891-4"><a href="#cb891-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> Cor, <span class="at">weight =</span> Contagem, <span class="at">fill =</span> UF)</span>
<span id="cb891-5"><a href="#cb891-5" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="Introducao_R_files/figure-html/unnamed-chunk-465-1.png" width="60%" style="display: block; margin: auto;" /></p>
<p></p>
<p>Nós podemos ainda, atribuir a mesma variável alocada no eixo x para definir a variação dessas cores ao longo do gráfico. Dessa forma, temos um gráfico onde cada uma das barras terá a sua própria cor. Isso não é particularmente útil, mas talvez você deseja ter uma cor separada para cada barra, e caso você esteja com preguiça de pensar e definir quais cores serão essas, deixar essa tarefa nas mãos do próprio <code>ggplot</code> é uma solução e um atalho simples para atingir um bom resultado.</p>
<p></p>
<div class="sourceCode" id="cb892"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb892-1"><a href="#cb892-1" aria-hidden="true" tabindex="-1"></a>datasus <span class="sc">%&gt;%</span> </span>
<span id="cb892-2"><a href="#cb892-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb892-3"><a href="#cb892-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(</span>
<span id="cb892-4"><a href="#cb892-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> Cor, <span class="at">weight =</span> Contagem, <span class="at">fill =</span> Cor)</span>
<span id="cb892-5"><a href="#cb892-5" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="Introducao_R_files/figure-html/unnamed-chunk-466-1.png" width="60%" style="display: block; margin: auto;" /></p>
<p></p>
<p>Portanto, ao conectarmos diferentes variáveis com o argumento (<code>fill</code>) em <code>aes()</code>, que define como as cores de cada barra são compostas, podemos modificar a forma como essas cores variam ao longo do gráfico. Mas e se nós quisermos manter uma única cor para essas barras, ou seja, e se é de seu desejo manter as cores constantes ao longo de todo o gráfico? Para isso, basta que você defina essas cores, fora de <code>aes()</code>.</p>
<p>Em outras palavras, a função <code>aes()</code> trabalha com <strong>variáveis</strong>, ou atributos de suas observações que tendem a variar ao longo de sua base. Quando você estiver trabalhando com valores constantes, ou com atributos que possuem um único valor possível ao longo de toda a sua base, a função <code>aes()</code> provavelmente não será o lugar ideal para trabalharmos com tais valores.</p>
<p>Por exemplo, o R possui diversas cores pré-programadas em seu sistema, e sempre que você quiser acessar essas cores ao longo do <code>ggplot</code>, você pode se referir a elas, através de seus nomes registrados. Caso queira uma lista com os nomes dessas cores pré-programadas, você pode utilizar a função <code>colors()</code>. Dentre essas diversas cores, temos uma chamada de <code>steelblue</code>. Logo, caso eu queira que todas as barras do meu gráfico estejam coloridas de acordo com essa cor, eu preciso fornecer o nome dessa cor ao argumento <code>fill</code>, de fora da função <code>aes()</code>.</p>
<p></p>
<div class="sourceCode" id="cb893"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb893-1"><a href="#cb893-1" aria-hidden="true" tabindex="-1"></a>datasus <span class="sc">%&gt;%</span> </span>
<span id="cb893-2"><a href="#cb893-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb893-3"><a href="#cb893-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(</span>
<span id="cb893-4"><a href="#cb893-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> Cor, <span class="at">weight =</span> Contagem),</span>
<span id="cb893-5"><a href="#cb893-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">&quot;steelblue&quot;</span></span>
<span id="cb893-6"><a href="#cb893-6" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="Introducao_R_files/figure-html/unnamed-chunk-467-1.png" width="60%" style="display: block; margin: auto;" /></p>
<p></p>
<p>Portanto, você pode aplicar essa metodologia para qualquer outro componente visual de seu gráfico que pode ser definido. Ou seja, se você deseja manter algum dos componentes visuais, definidos por um dos argumentos de <code>aes()</code> (<code>fill</code>, <code>color</code>, <code>size</code>, <code>fontface</code>, <code>linetype</code>, <code>shape</code>, etc.), constantes, você precisa apenas definir esses argumentos fora de <code>aes()</code>. Por outro lado, caso você queira controlar a forma como algum desses componentes visuais variam ao longo do gráfico, você precisa definir esses argumentos dentro de <code>aes()</code>.</p>
<p>Porém, você talvez se pergunte: o que ocorre se eu fornecer a cor <code>steelblue</code> dentro de <code>aes()</code>? Será que o <code>ggplot</code> reconhece que queremos aplicar essa cor sobre as formas geométricas do gráfico? A resposta curta é não, mas o resultado em geral é um pouco estranho, ou no mínimo algo inesperado. Pois em um caso como esse, a função <code>aes()</code> irá entender que você deseja colorir as barras no gráfico, de acordo com uma nova variável em sua tabela, chamada <code>fill</code>, e que possui um único valor possível ao longo da base, mais especificamente, o texto <code>steelblue</code>.</p>
<p>Esse comportamento ocorre sempre que você fornece um valor em texto (um <em>string</em>) à algum argumento de <code>aes()</code>. Em uma situação como essa, o <code>ggplot()</code> parece criar uma nova variável em sua tabela chamada <code>fill</code>, e que contém o valor em texto que você forneceu a esse argumento. Isso não necessariamente é um comportamento inadequado, mas ele certamente surpreende alguns usuários, e como ele tem se mantido ao longo das últimas versões do <code>ggplot</code>, é possível que ele continue a funcionar dessa forma, por um bom tempo.</p>
<p></p>
<div class="sourceCode" id="cb894"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb894-1"><a href="#cb894-1" aria-hidden="true" tabindex="-1"></a>datasus <span class="sc">%&gt;%</span> </span>
<span id="cb894-2"><a href="#cb894-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb894-3"><a href="#cb894-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(</span>
<span id="cb894-4"><a href="#cb894-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> Cor, <span class="at">weight =</span> Contagem, <span class="at">fill =</span> <span class="st">&quot;steelblue&quot;</span>)</span>
<span id="cb894-5"><a href="#cb894-5" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="Introducao_R_files/figure-html/unnamed-chunk-468-1.png" width="60%" style="display: block; margin: auto;" /></p>
<p></p>
</div>
<div id="sobrepondo-o-aesthetic-mapping-inicial-em-diversas-camadas" class="section level2" number="8.5">
<h2 number="8.5"><span class="header-section-number">8.5</span> Sobrepondo o <em>aesthetic mapping</em> inicial em diversas camadas</h2>
<p>Agora, vou explicar em maiores detalhes qual é a diferença entre: preenchermos os argumentos de <code>data</code> e <code>mapping</code> já na função inicial do gráfico (<code>ggplot()</code>), e de preenchê-los nas funções <code>geom</code>.</p>
<p>Para isso, vamos usar outros dados. Na tabela PIB eu possuo uma série histórica mensal do índice de faturamento real da indústria (<code>Faturamento_indus</code>), da porcentagem do PIB que representa a dívida pública líquida (<code>Divida_liq_perc</code>), e a média mensal da taxa de investimento produtivo (taxa de formação bruta de capital fixo - <code>FBCF</code>) na economia brasileira, além de dados de PIB, coletados do IPEAData<a href="#fn23" class="footnote-ref" id="fnref23"><sup>23</sup></a>.</p>
<p></p>
<div class="sourceCode" id="cb895"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb895-1"><a href="#cb895-1" aria-hidden="true" tabindex="-1"></a>PIB</span></code></pre></div>
<pre><code>## # A tibble: 184 x 6
##    Data           PIB PIB_acumulado Divida_liq_perc  FBCF Faturamento_indus
##    &lt;date&gt;       &lt;dbl&gt;         &lt;dbl&gt;           &lt;dbl&gt; &lt;dbl&gt;             &lt;dbl&gt;
##  1 2005-01-01 163540.         100              42.3 103.              102. 
##  2 2005-02-01 160702.          98.3            42.7  99.1              98.9
##  3 2005-03-01 175469.         107.             43.1 112.               98.3
##  4 2005-04-01 177179          108.             42.5 108.              107. 
##  5 2005-05-01 177497.         109.             42.4 113.              100. 
##  6 2005-06-01 180882.         111.             42.8 115.              104. 
##  7 2005-07-01 184074.         113.             43.2 111.               99.8
##  8 2005-08-01 187247.         114.             43.2 120.               97  
##  9 2005-09-01 181539.         111.             43.2 115.               96.1
## 10 2005-10-01 189183          116.             43.6 110.               95.8
## # ... with 174 more rows</code></pre>
<p></p>
<p>Na seção 8.3, expliquei que ao preencher os argumentos já no <code>ggplot()</code> você estaria pedindo ao programa, que utilize a mesma base de dados e/ou o mesmo <em>aesthetic mapping</em> ao longo de todas as camadas do gráfico. Como exemplo, veja o que acontece no gráfico abaixo.</p>
<p>Como o <code>geom_bar()</code> busca resumir os nossos dados em poucas estatísticas, eu coloquei dessa vez o valor <em>“identity”</em> no argumento <code>stat</code>. Isso impede que ele agrupe os dados em alguma medida estatística, fazendo com que o <code>geom</code> apenas identifique os valores que aparecem na base, da mesma forma que um <code>geom_point()</code> faria. Perceba também, que eu estou utilizando três <code>geom</code>’s diferentes no gráfico. Mas como eu não defini um <em>aesthetic mapping</em> específico em cada um deles, todos esses <code>geom</code>’s estão mostrando exatamente a mesma informação. Dito de outra forma, estes <code>geom</code>’s estão utilizando o mesmo <em>aesthetic mapping</em>, o qual definimos na função <code>ggplot()</code>.</p>
<p></p>
<div class="sourceCode" id="cb897"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb897-1"><a href="#cb897-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb897-2"><a href="#cb897-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> PIB,</span>
<span id="cb897-3"><a href="#cb897-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> Data, <span class="at">y =</span> Faturamento_indus)</span>
<span id="cb897-4"><a href="#cb897-4" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb897-5"><a href="#cb897-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;darkgray&quot;</span>) <span class="sc">+</span></span>
<span id="cb897-6"><a href="#cb897-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">&quot;blue&quot;</span>) <span class="sc">+</span></span>
<span id="cb897-7"><a href="#cb897-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><img src="Introducao_R_files/figure-html/unnamed-chunk-471-1.png" width="60%" style="display: block; margin: auto;" /></p>
<p></p>
<p>Você deve estar pensando: “Ok, mas isso não faz sentido! Por que eu usaria três <code>geom</code>’s diferentes para uma mesma informação?” Bem, pode ser que você queira utilizar mais de um <code>geom</code> que mostre a mesma informação, por questões estéticas no gráfico. Um exemplo simples, seria marcar a borda de uma linha criada por <code>geom_line()</code>. Ou seja, não há uma forma direta e simples em <code>geom_line()</code> (algo que já é possível de ser feito no <code>geom_point()</code>), de pintar essas bordas de uma cor mais escura (ou clara) do que o interior da linha, dando assim uma maior ênfase para aquela linha. Portanto, a ideia seria criarmos duas camadas de <code>geom_line()</code>: uma interna, com uma linha mais estreita e de cor mais clara (ou mais escura); e uma externa, com uma linha mais larga (de forma que ela “transborde” para fora da linha interna) e de cor mais escura (ou mais clara).</p>
<p>De qualquer maneira, esses <code>geom</code>’s não fazem muito sentido da forma como estão dispostos no momento, portanto, vamos mudar de estratégia. Por que não utilizamos um só <code>geom</code> para apresentar três informações diferentes?! Para isso, temos que modificar a nossa base levemente. O objetivo é pegar as três colunas com as variáveis que vamos plotar (<code>Faturamento_indus</code>, <code>FBCF</code> e <code>Divida_liq_perc</code>), e agrupá-las em duas colunas: uma com os valores dessas variáveis, e outra coluna com os nomes dessas variáveis, para identificar qual variável o valor na primeira coluna se refere. Realizamos esse trabalho pela função <code>pivot_longer()</code>.</p>
<p></p>
<div class="sourceCode" id="cb898"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb898-1"><a href="#cb898-1" aria-hidden="true" tabindex="-1"></a>PIB_remodelado <span class="ot">&lt;-</span> PIB <span class="sc">%&gt;%</span> </span>
<span id="cb898-2"><a href="#cb898-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Data, Faturamento_indus, FBCF, Divida_liq_perc) <span class="sc">%&gt;%</span> </span>
<span id="cb898-3"><a href="#cb898-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb898-4"><a href="#cb898-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(<span class="st">&quot;Faturamento_indus&quot;</span>, <span class="st">&quot;FBCF&quot;</span>, <span class="st">&quot;Divida_liq_perc&quot;</span>),</span>
<span id="cb898-5"><a href="#cb898-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">&quot;Nome_variavel&quot;</span>,</span>
<span id="cb898-6"><a href="#cb898-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">&quot;Valor&quot;</span></span>
<span id="cb898-7"><a href="#cb898-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb898-8"><a href="#cb898-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb898-9"><a href="#cb898-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb898-10"><a href="#cb898-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> PIB_remodelado,</span>
<span id="cb898-11"><a href="#cb898-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> Data, <span class="at">y =</span> Valor, <span class="at">linetype =</span> Nome_variavel)</span>
<span id="cb898-12"><a href="#cb898-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb898-13"><a href="#cb898-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() </span></code></pre></div>
<p><img src="Introducao_R_files/figure-html/unnamed-chunk-472-1.png" width="60%" style="display: block; margin: auto;" /></p>
<p></p>
<p>Novamente, como não incluímos uma função <code>aes()</code>, ou definimos o argumento <code>data</code> dentro do <code>geom_line()</code>, ele irá utilizar o <code>data</code> e o <em>aesthetic mapping</em> (<code>aes()</code>) que definimos em <code>ggplot()</code>. Lembra de quando eu disse que você poderia controlar o formato de um <code>geom</code> de acordo com uma variável? O gráfico acima é um exemplo prático disso. Estamos utilizando apenas um <code>geom</code> para mostrar três informações diferentes, e o componente estético que utilizamos para diferenciar essas informações no gráfico, é o formato dessas linhas. Portanto, ao definirmos o componente <code>linetype</code> para <em>Nome_variavel</em>, estamos modificando o formato da linha (tracejada ou sólida), de acordo com os valores dessa variável. Poderíamos usar a mesma estratégia em <code>geom_point()</code>, ao definirmos o argumento <code>shape</code> para <em>Nome_variavel</em>. O resultado, seria um gráfico com pontos de três formatos diferentes (triângulos, quadrados e pontos comuns).</p>
<p>Entretanto, para utilizarmos essa estratégia, nós tivemos que reestruturar a nossa base de dados pela função <code>pivot_longer()</code>. E se você não quisesse modificar essa base? Infelizmente, sem essa modificação, não poderíamos mostrar as três variáveis utilizando apenas uma função <code>geom</code>, mas poderíamos realizar o mesmo trabalho com uma função <code>geom</code> para cada variável. Neste caso, teremos que utilizar um <em>aesthetic mapping</em> diferente para cada <code>geom</code>, pois cada um deles, ficará responsável por mostrar os valores de uma variável diferente.</p>
<p>No primeiro gráfico dessa seção, utilizamos três <code>geom</code>’s diferentes para mostrar uma mesma informação. Se você comparar o código desse primeiro gráfico, ao código do gráfico abaixo, você perceberá que eles são quase idênticos, o que mudou, é a presença da função <code>aes()</code> nos dois últimos <code>geom</code>’s.</p>
<p></p>
<div class="sourceCode" id="cb899"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb899-1"><a href="#cb899-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb899-2"><a href="#cb899-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> PIB,</span>
<span id="cb899-3"><a href="#cb899-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> Data, <span class="at">y =</span> Faturamento_indus)</span>
<span id="cb899-4"><a href="#cb899-4" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb899-5"><a href="#cb899-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;darkgray&quot;</span>) <span class="sc">+</span></span>
<span id="cb899-6"><a href="#cb899-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> FBCF), <span class="at">color =</span> <span class="st">&quot;blue&quot;</span>) <span class="sc">+</span></span>
<span id="cb899-7"><a href="#cb899-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> Divida_liq_perc), <span class="at">color =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><img src="Introducao_R_files/figure-html/unnamed-chunk-473-1.png" width="60%" style="display: block; margin: auto;" /></p>
<p></p>
<p>O único <code>geom</code> que não possui uma função <code>aes()</code> definida, é o <code>geom_bar()</code>, logo, esse <code>geom</code> vai seguir o <em>aesthetic mapping</em> que definimos em <code>ggplot()</code>. Já os outros dois <code>geom</code>’s, vão seguir o <em>aesthetic mapping</em> que definimos em seus respectivos <code>aes()</code>. Porém, repare que em ambos <code>geom</code>’s, eu apenas defini a variável mapeada para o eixo y, não cheguei a definir uma nova variável para o eixo x. Quando isso ocorre, a função irá novamente recorrer ao <em>aesthetic mapping</em> que você definiu em <code>ggplot()</code>. Ou seja, como não definimos uma nova variável para o eixo x, todos os <code>geom</code>’s do gráfico acabam utilizando a variável no eixo x definida em <code>ggplot()</code>.</p>
<p>Portanto, você pode sobrepor por completo, ou parcialmente, o <em>aesthetic mapping</em> definido em <code>ggplot()</code> em cada <code>geom</code>, basta omitir os termos dos quais você não deseja sobrepor na nova função <code>aes()</code>. Um outro detalhe, é que não chegamos a definir em nenhum momento, um novo valor para o argumento <em>data</em> em algum <code>geom</code>. Logo, apesar de estarmos utilizando diferentes <em>aesthetic mappings</em>, todos os <code>geom</code>’s estão utilizando a mesma base de dados.</p>
<div id="resumo-da-estrutura-básica-de-um-gráfico-ggplot" class="section level3" number="8.5.1">
<h3 number="8.5.1"><span class="header-section-number">8.5.1</span> Resumo da estrutura básica de um gráfico <code>ggplot()</code></h3>
<p>Em resumo, todo gráfico do <code>ggplot()</code> possui três camadas essenciais, que formam a base do gráfico: 1) <em>data</em>, a base (ou bases) de dados utilizada no gráfico em questão; 2) <em>aesthetic mapping</em>, o mapeamento, ou a ligação de variáveis presentes na base de dados, para componentes estéticos e visuais do gráfico; 3) <em>geom</em>, a forma geométrica (retângulos, pontos, polígonos, linhas, etc) que irá representar os seus dados no gráfico.</p>
<p>Para construir um gráfico do <code>ggplot()</code>, você deve sempre definir esses componentes. Os dois primeiros (<em>data</em> e <em>aesthetic mapping</em>), podem ser definidas dentro da função <code>ggplot()</code>, já o terceiro (<em>geom</em>), você define ao utilizar uma (ou várias) das funções <code>geom</code>, em uma (ou em várias) das camadas do gráfico. Com isso, temos uma estrutura básica como a definida abaixo, para construirmos um gráfico do <code>ggplot</code>:</p>
<p></p>
<div class="sourceCode" id="cb900"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb900-1"><a href="#cb900-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb900-2"><a href="#cb900-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="sc">&lt;</span>sua base de dados<span class="sc">&gt;</span>,</span>
<span id="cb900-3"><a href="#cb900-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="sc">&lt;</span>aesthetic mapping<span class="sc">&gt;</span>)</span>
<span id="cb900-4"><a href="#cb900-4" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb900-5"><a href="#cb900-5" aria-hidden="true" tabindex="-1"></a>  <span class="er">&lt;</span>geom_...<span class="sc">&gt;</span> <span class="co">#uma função geom a seu gosto</span></span></code></pre></div>
<p></p>
<p>Lembre-se que essa é apenas uma estrutura básica. Como mostramos na seção 8.4, podemos sobrepor de diversas formas essa estrutura. E podemos definir diversos outros parâmetros sobre essa estrutura como foi mostrado ao longo do capítulo.</p>
</div>
</div>
<div id="uma-discussão-sobre-os-principais-geoms" class="section level2" number="8.6">
<h2 number="8.6"><span class="header-section-number">8.6</span> Uma discussão sobre os principais <code>geom</code>’s</h2>
<p>Nas próximas seções vamos descrever rapidamente como grande parte dos principais <code>geom</code>’s se comportam, e quais são os argumentos (ou os componentes estéticos) que podemos controlar através da função <code>aes()</code>. Dessa forma, você pode rapidamente se familiarizar com esses <code>geom</code>’s, adquirindo um vocabulário das funções que os representam, e que cobrem a maior parte dos gráficos realizados no dia-a-dia.</p>
<p>Lembre-se que há várias funções <code>geom</code> diferentes, das quais muitas não serão descritas aqui. Muitas deles utilizam o mesmo formato geométrico (linhas, retângulos, …), mas desenham esse formato de uma maneira diferente, além de possuírem outros componentes estéticos que podem ser controlados pelo <em>aesthetic mapping</em> do gráfico.</p>
<p>Caso você não encontre aqui, o formato geométrico que está procurando, ou a função <code>geom</code> que realiza o desenho da forma como você deseja, você pode consultar a página oficial do pacote<a href="#fn24" class="footnote-ref" id="fnref24"><sup>24</sup></a>. A página não possui uma versão em português, porém, você deve se virar razoavelmente bem com ferramentas de tradução (como o Google Tradutor) nessas situações. Se isso não for suficiente, você talvez encontre suas dúvidas em outros materiais construídos por brasileiros, como o blog <em>Curso R</em><a href="#fn25" class="footnote-ref" id="fnref25"><sup>25</sup></a>, o material do departamento de Estatística da UFPR<a href="#fn26" class="footnote-ref" id="fnref26"><sup>26</sup></a>, ou dentro de alguma pergunta postada na página em português do <em>StackOverflow</em><a href="#fn27" class="footnote-ref" id="fnref27"><sup>27</sup></a>. O <em>R Graph Gallery</em><a href="#fn28" class="footnote-ref" id="fnref28"><sup>28</sup></a> é um repositório (em inglês) que possui exemplos dos mais diversos <code>geom</code>’s, e que serve como a referência perfeita para os momentos em que você não lembra qual o <code>geom</code> que desenha o tipo de gráfico que procura.</p>
<div id="gráficos-de-dispersão-e-gráficos-de-bolha" class="section level3" number="8.6.1">
<h3 number="8.6.1"><span class="header-section-number">8.6.1</span> Gráficos de dispersão e gráficos de bolha</h3>
<p>Gráficos de dispersão são formados por <code>geom_point()</code>. Esse <code>geom</code> (por padrão) não transforma os seus dados, ou em outras palavras, ele não busca resumi-los de alguma maneira. Cada ponto desenhado no plano cartesiano representa cada uma das linhas presentes em sua base de dados. Os <code>geom</code>s que possuem este comportamento, são comumente chamados de <code>geom</code>’s individuais. Por este padrão, você deve obrigatoriamente definir as variáveis de ambos os eixos (x e y), neste <code>geom</code>.</p>
<p>Nos exemplos abaixo, estou utilizando a tabela <code>mpg</code> que vêm junto do <code>ggplot</code>, e nos apresenta dados de consumo de combustível de diversos modelos de carro, para mais detalhes desses dados, execute <code>?mpg</code> no console. Os gráficos nos mostram uma relação aparentemente negativa entre volume ocupado pelos pistões no motor (<code>displ</code>), e a quilometragem por litro de gasolina (<code>hwy</code>).</p>
<p>Após definir os eixos, você pode pintar os pontos de acordo com uma terceira variável, por exemplo, a classe do carro (compacto, SUV, minivan, …), através do argumento <em>color</em>. A classe do carro é uma variável categórica, e por isso, o <code>ggplot()</code> irá buscar cores contrastantes para pintar os pontos. Mas você também pode definir uma variável contínua a este argumento, onde neste caso, o <code>ggplot()</code> irá criar um gradiente de cores para pintar os pontos. Uma outra possibilidade deste <code>geom</code>, é variar o formato dos pontos através do argumento <em>shape</em>.</p>
<p>A partir de <code>geom_point()</code> você também pode construir um gráfico de bolha, através do argumento <em>size</em>. Este tipo de gráfico em geral, piora o <em>overplotting</em>, ou a sobreposição dos pontos, já que alguns ficam muito grandes. Nestas situações, o argumento <em>alpha</em> é bem útil, sendo ele definido por um número de 0 a 1, indicando uma porcentagem de opacidade do <code>geom</code>. Por padrão, ele é configurado para 1 (100%), já no exemplo, eu reduzo essa opacidade para 40%.</p>
<p></p>
<div class="sourceCode" id="cb901"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb901-1"><a href="#cb901-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> mpg) <span class="sc">+</span></span>
<span id="cb901-2"><a href="#cb901-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> displ, <span class="at">y =</span> hwy))</span></code></pre></div>
<p><img src="Introducao_R_files/figure-html/unnamed-chunk-475-1.png" width="60%" style="display: block; margin: auto;" /></p>
<p></p>
<p></p>
<div class="sourceCode" id="cb902"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb902-1"><a href="#cb902-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> mpg) <span class="sc">+</span></span>
<span id="cb902-2"><a href="#cb902-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> displ, <span class="at">y =</span> hwy, <span class="at">color =</span> class))</span></code></pre></div>
<p><img src="Introducao_R_files/figure-html/unnamed-chunk-476-1.png" width="60%" style="display: block; margin: auto;" /></p>
<p></p>
<p></p>
<div class="sourceCode" id="cb903"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb903-1"><a href="#cb903-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> mpg) <span class="sc">+</span></span>
<span id="cb903-2"><a href="#cb903-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> displ, <span class="at">y =</span> hwy, <span class="at">color =</span> class, <span class="at">shape =</span> drv))</span></code></pre></div>
<p><img src="Introducao_R_files/figure-html/unnamed-chunk-477-1.png" width="60%" style="display: block; margin: auto;" /></p>
<p></p>
<p></p>
<div class="sourceCode" id="cb904"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb904-1"><a href="#cb904-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> mpg) <span class="sc">+</span></span>
<span id="cb904-2"><a href="#cb904-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> displ, <span class="at">y =</span> hwy, <span class="at">size =</span> cyl), <span class="at">alpha =</span> <span class="fl">0.4</span>)</span></code></pre></div>
<p><img src="Introducao_R_files/figure-html/unnamed-chunk-478-1.png" width="60%" style="display: block; margin: auto;" /></p>
<p></p>
<p>Você pode se aproveitar do componente <em>shape</em> para diferenciar, ou destacar as bordas dos pontos, ao escolher o <em>shape</em> 21. Este método é esteticamente atraente, e fica muito bom em conjunto com linhas. Dessa forma, você pode pintar o interior dos pontos de uma cor, utilizando <em>fill</em>, e a borda desse ponto de outra cor, utilizando <em>color</em>. Lembre-se que isso só é possível, pelo <em>shape</em> que escolhemos para estes pontos, em outras situações, você poderá colorir pontos apenas com uma cor, utilizando o <em>color</em>. No exemplo abaixo, eu deixo todos os três argumentos de fora de <code>aes()</code>, dessa forma, o <code>ggplot</code> mantém os valores que dei a cada um deles, constantes ao longo de todo o gráfico.</p>
<p></p>
<div class="sourceCode" id="cb905"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb905-1"><a href="#cb905-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> mpg) <span class="sc">+</span></span>
<span id="cb905-2"><a href="#cb905-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb905-3"><a href="#cb905-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> displ, <span class="at">y =</span> hwy),</span>
<span id="cb905-4"><a href="#cb905-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">shape =</span> <span class="dv">21</span>,</span>
<span id="cb905-5"><a href="#cb905-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb905-6"><a href="#cb905-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">&quot;steelblue&quot;</span></span>
<span id="cb905-7"><a href="#cb905-7" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="Introducao_R_files/figure-html/unnamed-chunk-479-1.png" width="60%" style="display: block; margin: auto;" /></p>
<p></p>
</div>
<div id="gráficos-de-barra" class="section level3" number="8.6.2">
<h3 number="8.6.2"><span class="header-section-number">8.6.2</span> Gráficos de barra</h3>
<p>Como descrevi anteriormente, os gráficos de barras no <code>ggplot()</code> são formados pelo <code>geom_bar()</code>, e em geral, são utilizados para apresentar estatísticas que resumem os dados em poucos números (como totais, médias, medianas). Em outras palavras, os <code>geom</code>’s que tem este comportamento, buscam representar várias observações de sua base, com um único formato geométrico, e são comumente chamados de <code>geom</code>’s coletivos. Por essa razão, o argumento <em>stat</em> é importante neste <code>geom</code>, pois nele você pode conceder o valor <em>identity</em>, que evita este comportamento, e faz com que o <code>geom</code> apenas identifique os valores que você fornece a ele.</p>
<p>No <code>ggplot</code>, este <code>geom</code> foi criado com o intuito de permitir que o usuário construa rapidamente gráficos de contagens e somatórios. Portanto, este <code>geom</code> possui mecanismos para calcular essas estatísticas, você não precisa calculá-las por conta própria antes de gerar o <code>ggplot</code>. Por padrão, este <code>geom</code> calcula inicialmente uma contagem dos seus dados. Logo, caso você não defina qual a estatística que deseja mostrar, ele irá contar a quantidade que cada valor aparece na base. Por exemplo, o gráfico abaixo nos mostra que dentro da tabela <code>mpg</code>, temos em torno de 80 modelos com motores de 4 ou 6 cilindradas, e menos de 10 modelos com 5 cilindradas.</p>
<p></p>
<div class="sourceCode" id="cb906"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb906-1"><a href="#cb906-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(</span>
<span id="cb906-2"><a href="#cb906-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> mpg,</span>
<span id="cb906-3"><a href="#cb906-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> cyl)</span>
<span id="cb906-4"><a href="#cb906-4" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb906-5"><a href="#cb906-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>()</span></code></pre></div>
<p><img src="Introducao_R_files/figure-html/unnamed-chunk-480-1.png" width="60%" style="display: block; margin: auto;" /></p>
<p></p>
<p>Tendo essas considerações em mente, você tem duas opções básicas ao lidar com este <code>geom</code>: 1) fornecer diretamente os dados, e pedir ao <code>geom</code> que calcule as estatísticas que você deseja mostrar (contagem ou somatório); ou 2) você primeiro calcula as estatísticas que deseja, e pede ao <code>geom</code> que apenas as identifique, sem realizar nenhuma transformação desses dados. Caso opte pela opção 2, você deve <strong>tomar muito cuidado</strong> com o argumento <code>stat = "identity"</code>, por razões que vou explicar abaixo.</p>
<p>Este <code>geom</code> não possui um mecanismo próprio para calcular médias (e muitas outras estatísticas), e portanto, se você quiser mostrá-las utilizando este <code>geom</code>, você terá de calcular separadamente essas médias, e pedir ao <code>geom</code> que apenas as identifique com <code>stat = "identity"</code>.</p>
<p></p>
<div class="sourceCode" id="cb907"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb907-1"><a href="#cb907-1" aria-hidden="true" tabindex="-1"></a>medias <span class="ot">&lt;-</span> mpg <span class="sc">%&gt;%</span> </span>
<span id="cb907-2"><a href="#cb907-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cyl) <span class="sc">%&gt;%</span> </span>
<span id="cb907-3"><a href="#cb907-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">media =</span> <span class="fu">mean</span>(hwy))</span>
<span id="cb907-4"><a href="#cb907-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb907-5"><a href="#cb907-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(</span>
<span id="cb907-6"><a href="#cb907-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> medias,</span>
<span id="cb907-7"><a href="#cb907-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> cyl, <span class="at">y =</span> media)</span>
<span id="cb907-8"><a href="#cb907-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb907-9"><a href="#cb907-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>)</span></code></pre></div>
<p><img src="Introducao_R_files/figure-html/unnamed-chunk-481-1.png" width="60%" style="display: block; margin: auto;" /></p>
<p></p>
<p>Porém, caso você queira calcular o total, ou o somatório em cada grupo, você pode apenas definir a coluna com os valores a serem somados, para o argumento <em>weight</em> dentro de <code>aes()</code>.</p>
<p></p>
<div class="sourceCode" id="cb908"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb908-1"><a href="#cb908-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(</span>
<span id="cb908-2"><a href="#cb908-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> mpg,</span>
<span id="cb908-3"><a href="#cb908-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> cyl, <span class="at">weight =</span> hwy)</span>
<span id="cb908-4"><a href="#cb908-4" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb908-5"><a href="#cb908-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>()</span></code></pre></div>
<p><img src="Introducao_R_files/figure-html/unnamed-chunk-482-1.png" width="60%" style="display: block; margin: auto;" /></p>
<p></p>
<p>Agora, lembra quando eu disse que você pode pedir ao <code>geom</code> que apenas “identifique” os valores de sua base (com <code>stat = "identity"</code>) ? Com este argumento, o <code>geom_bar()</code> irá ter um comportamento diferente, caso os valores em cada grupo não sejam únicos. No exemplo anterior, em que calculei as médias de cada <code>cyl</code> em <code>mpg</code>, o <code>geom</code> apenas identificou as médias de cada <code>cyl</code>, pois há apenas <strong>uma única</strong> média para cada <code>cyl</code>. No exemplo abaixo, estou criando rapidamente uma tabela, e nela você pode perceber que há dois valores para o grupo <code>"c"</code>. Agora, repare o que acontece no gráfico, o <code>geom_bar()</code> acaba somando estes valores.</p>
<p></p>
<div class="sourceCode" id="cb909"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb909-1"><a href="#cb909-1" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb909-2"><a href="#cb909-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">grupo =</span> <span class="fu">c</span>(<span class="st">&quot;a&quot;</span>,<span class="st">&quot;b&quot;</span>,<span class="st">&quot;c&quot;</span>,<span class="st">&quot;c&quot;</span>,<span class="st">&quot;d&quot;</span>),</span>
<span id="cb909-3"><a href="#cb909-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">valor =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">2</span>)</span>
<span id="cb909-4"><a href="#cb909-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb909-5"><a href="#cb909-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb909-6"><a href="#cb909-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(tab, <span class="fu">aes</span>(<span class="at">x =</span> grupo, <span class="at">y =</span> valor)) <span class="sc">+</span></span>
<span id="cb909-7"><a href="#cb909-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>)</span></code></pre></div>
<p><img src="Introducao_R_files/figure-html/unnamed-chunk-483-1.png" width="60%" style="display: block; margin: auto;" /></p>
<p></p>
<p>Em outras palavras, se os seus dados estiverem <strong>agrupados</strong>, o <code>geom_bar()</code> com <code>stat = "identity"</code> irá de fato apenas identificar estes valores. Mas caso os seus dados estiverem desagregados, com mais de um valor por grupo, o <code>geom_bar()</code> irá somar estes valores. Isso significa, que <code>stat = "identity"</code> representa uma outra alternativa (além de <em>weight</em>), para criar gráficos de somatório. Bastaria fornecer a coluna com os valores a serem somados para o eixo y em <code>aes()</code>, e adicionar <code>stat = "identity"</code> à <code>geom_bar()</code>.</p>
<p>Um outro ponto importante neste <code>geom</code>, é o posicionamento das barras. Por padrão, o <code>geom</code> empilha barras que ocupam o mesmo valor no eixo x no gráfico. Isso nos permite visualizarmos a participação dos grupos de uma outra variável categórica (cor de pele, faixa etária, …), em cada valor presente no eixo x. Por outro lado, você talvez esteja interessado na diferença entre os grupos, e não a sua participação. Logo, você talvez queira jogar essas barras uma do lado da outra, e para isso você deve utilizar o argumento <em>position</em>, dando o valor <em>“dodge”</em>. No exemplo abaixo, retorno a base de dados <code>datasus</code>, com o objetivo de mostrar a diferença em cada cor de pele, da média de vítimas para cada sexo.</p>
<p></p>
<div class="sourceCode" id="cb910"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb910-1"><a href="#cb910-1" aria-hidden="true" tabindex="-1"></a>medias <span class="ot">&lt;-</span> datasus <span class="sc">%&gt;%</span> </span>
<span id="cb910-2"><a href="#cb910-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Cor, Genero) <span class="sc">%&gt;%</span> </span>
<span id="cb910-3"><a href="#cb910-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">media =</span> <span class="fu">mean</span>(Contagem))</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;Cor&#39;. You can override using the `.groups` argument.</code></pre>
<div class="sourceCode" id="cb912"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb912-1"><a href="#cb912-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(</span>
<span id="cb912-2"><a href="#cb912-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> medias,</span>
<span id="cb912-3"><a href="#cb912-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> Cor, <span class="at">y =</span> media, <span class="at">fill =</span> Genero)</span>
<span id="cb912-4"><a href="#cb912-4" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb912-5"><a href="#cb912-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">position =</span> <span class="st">&quot;dodge&quot;</span>) </span></code></pre></div>
<p><img src="Introducao_R_files/figure-html/unnamed-chunk-484-1.png" width="60%" style="display: block; margin: auto;" /></p>
<p></p>
<p>Portanto, caso você não definisse <em>position</em> para <em>dodge</em>, o <code>ggplot</code> iria empilhar essas barras (azul e vermelho) uma em cima da outra. Em um gráfico de médias como o acima, não faria muito sentido empilhar essas barras, porém, este posicionamento faz muito sentido em gráficos de somatório, como os que fizemos na seção 8.3. Pois dessa forma você consegue visualizar o quanto que cada grupo representa do total.</p>
<p>Você talvez queira ir um pouco além, e observar as diferenças na participação de cada cor de pele, ao longo dos totais de vários grupos. Para isso, você pode dar o valor <em>fill</em> ao argumento <em>position</em>. Dessa forma, o <code>ggplot</code> calcula qual é a proporção de cada grupo para cada valor do eixo x, em uma escala de 0 a 1. Nesta situação, você deve definir a variável do eixo y, para o argumento <em>weight</em> em <code>aes()</code>.</p>
<p></p>
<div class="sourceCode" id="cb913"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb913-1"><a href="#cb913-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(</span>
<span id="cb913-2"><a href="#cb913-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> datasus,</span>
<span id="cb913-3"><a href="#cb913-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> <span class="st">`</span><span class="at">Faixa etaria</span><span class="st">`</span>, <span class="at">weight =</span> Contagem, <span class="at">fill =</span> Cor)</span>
<span id="cb913-4"><a href="#cb913-4" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb913-5"><a href="#cb913-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">&quot;fill&quot;</span>) </span></code></pre></div>
<p><img src="Introducao_R_files/figure-html/unnamed-chunk-485-1.png" width="60%" style="display: block; margin: auto;" /></p>
<p></p>
</div>
<div id="gráficos-de-linha" class="section level3" number="8.6.3">
<h3 number="8.6.3"><span class="header-section-number">8.6.3</span> Gráficos de linha</h3>
<p>Gráficos de linha são muito utilizados em séries temporais, para mostrar a evolução de algum índice ao longo do tempo. Este tipo de gráfico é criado pelo <code>geom_line()</code>, que possui um comportamento de “conector.”</p>
<p>O <code>geom_line()</code> (diferentemente de seu irmão <code>geom_path()</code>) sempre ordena os valores da base (antes de conectá-los), segundo a variável alocada no eixo x, na ordem que seja mais lógica para essa variável. Veja o exemplo abaixo, onde dou um vetor de datas (fora de ordem) para o eixo x. Independente da ordem em que os valores estiverem em sua base, a função irá reordenar a base antes de conectar os pontos.</p>
<p></p>
<div class="sourceCode" id="cb914"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb914-1"><a href="#cb914-1" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb914-2"><a href="#cb914-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">dia =</span> <span class="fu">as.Date</span>(<span class="fu">c</span>(<span class="st">&quot;2020-01-01&quot;</span>,<span class="st">&quot;2020-01-04&quot;</span>,<span class="st">&quot;2020-01-02&quot;</span>,<span class="st">&quot;2020-01-03&quot;</span>)),</span>
<span id="cb914-3"><a href="#cb914-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">valor =</span> <span class="fu">c</span>(<span class="dv">10</span>,<span class="dv">27</span>,<span class="dv">14</span>,<span class="dv">23</span>)</span>
<span id="cb914-4"><a href="#cb914-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb914-5"><a href="#cb914-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb914-6"><a href="#cb914-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(tab, <span class="fu">aes</span>(dia, valor)) <span class="sc">+</span> <span class="fu">geom_line</span>()</span></code></pre></div>
<p><img src="Introducao_R_files/figure-html/unnamed-chunk-486-1.png" width="60%" style="display: block; margin: auto;" /></p>
<p></p>
<p>Isso significa, que este <code>geom</code> funciona com qualquer variável no eixo x que possua uma ordem lógica, seja ela contínua ou categórica. Veja no exemplo abaixo, onde eu substituo a coluna <code>dia</code>, por um simples vetor de texto. Ao detectar o tipo de dado presente na coluna, a função reordena os valores de acordo com a ordem lógica para este tipo de dado (no exemplo abaixo, ordem alfabética).</p>
<p></p>
<div class="sourceCode" id="cb915"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb915-1"><a href="#cb915-1" aria-hidden="true" tabindex="-1"></a>tab<span class="sc">$</span>dia <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;a&quot;</span>,<span class="st">&quot;c&quot;</span>,<span class="st">&quot;d&quot;</span>,<span class="st">&quot;b&quot;</span>)</span>
<span id="cb915-2"><a href="#cb915-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb915-3"><a href="#cb915-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(tab, <span class="fu">aes</span>(dia, valor, <span class="at">group =</span> <span class="dv">1</span>)) <span class="sc">+</span> <span class="fu">geom_line</span>()</span></code></pre></div>
<p><img src="Introducao_R_files/figure-html/unnamed-chunk-487-1.png" width="60%" style="display: block; margin: auto;" /></p>
<p></p>
<p>Conhecer essa funcionalidade é importante, ao fornecer para o <code>geom</code> dados dos quais ele não consegue reconhecer o formato e a ordem correta. Pense por exemplo, se você fornecesse um vetor de datas, mas no formato “abril/2020.” Como os valores começam por um nome, ele reconhece estes valores como texto, e, portanto, ordena-os em ordem alfabética, ao invés de ordená-los como meses do ano. Nessas situações, transformar esses valores para fatores, e definir a sua ordem em seu atributo <code>levels</code>, é a melhor alternativa.</p>
<p></p>
<div class="sourceCode" id="cb916"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb916-1"><a href="#cb916-1" aria-hidden="true" tabindex="-1"></a>tab<span class="sc">$</span>dia <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Janeiro/2020&quot;</span>, <span class="st">&quot;Abril/2020&quot;</span>, <span class="st">&quot;Fevereiro/2020&quot;</span>, <span class="st">&quot;Março/2020&quot;</span>)</span>
<span id="cb916-2"><a href="#cb916-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb916-3"><a href="#cb916-3" aria-hidden="true" tabindex="-1"></a>ordem <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Janeiro/2020&quot;</span>, <span class="st">&quot;Fevereiro/2020&quot;</span>, <span class="st">&quot;Março/2020&quot;</span>, <span class="st">&quot;Abril/2020&quot;</span>)</span>
<span id="cb916-4"><a href="#cb916-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb916-5"><a href="#cb916-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb916-6"><a href="#cb916-6" aria-hidden="true" tabindex="-1"></a>    tab,</span>
<span id="cb916-7"><a href="#cb916-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="fu">factor</span>(dia, <span class="at">levels =</span> ordem), valor, <span class="at">group =</span> <span class="dv">1</span>)</span>
<span id="cb916-8"><a href="#cb916-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb916-9"><a href="#cb916-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()</span></code></pre></div>
<p><img src="Introducao_R_files/figure-html/unnamed-chunk-488-1.png" width="60%" style="display: block; margin: auto;" /></p>
<p></p>
<p>Eu costumo aumentar a grossura dessas linhas através do argumento <em>size</em>, que por padrão está configurado para 0.5. Geralmente 1 já é um bom nível para mim, mas você pode aumentar o quanto quiser. Como eu quero que a grossura, permaneça constante ao longo de toda a linha, eu mantenho o argumento <em>size</em> de fora do <code>aes()</code>. Isso significa que você poderia variar essa grossura ao longo da linha, apesar de que o resultado seria um tanto esquisito. Tente por exemplo, adicionar ao <code>aes()</code> do exemplo anterior, o valor <code>size = valor</code>, e veja o resultado.</p>
<p>Neste <code>geom</code>, o argumento <em>group</em> em <code>aes()</code> é muito importante. Este argumento controla como o <code>geom</code> considera os grupos da base, na hora de desenhar o formato geométrico em questão. No primeiro exemplo dessa seção, nós não utilizamos este argumento, pois a variável ligado ao eixo x (<code>dia</code>) era uma variável contínua. Entretanto, no instante em que mudamos os valores dessa coluna para texto, tivemos que adicionar um <code>group = 1</code> ao <code>aes()</code>. Logo, quando você ligar uma variável contínua ao eixo x, muito provavelmente você não precisará mexer com o <em>group</em>. Caso a variável seja categórica, é certo que algum valor deve ser dado ao argumento <em>group</em>.</p>
<p>Isso é apenas uma simplificação, que serve como um guia inicial, mas que nem sempre se aplica. Pois o <em>group</em> não diz respeito ao tipo de variável (contínua ou categórica), e sim se você quer separar ou não as linhas por algum agrupamento. Se você está apenas querendo mostrar uma única linha no gráfico, essa simplificação será útil. Mas com o tempo você vai se pegar utilizando o <em>group</em>, para mostrar em um mesmo gráfico a evolução de vários índices diferentes ao longo do tempo, mesmo que a variável no eixo x (datas) seja uma variável contínua. Basta relembrar o exemplo da seção 8.4, em que utilizamos <em>linetype</em> para diferenciar as curvas de três indicadores diferentes em um mesmo <code>geom_line()</code>. Você poderia replicar o mesmo gráfico utilizando <em>group</em>, ao invés do <em>linetype</em>.</p>
<p>Essa questão fica mais clara, ao utilizarmos uma base que possui mais de um valor por grupo. Veja por exemplo a base <code>Oxboys</code>, que vem do pacote <code>mlmRev</code>. Essa base é resultado de uma pesquisa, onde os pesquisadores acompanharam durante vários anos, o crescimento de alguns indivíduos.</p>
<p></p>
<div class="sourceCode" id="cb917"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb917-1"><a href="#cb917-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(mlmRev<span class="sc">::</span>Oxboys, <span class="at">n =</span> <span class="dv">10</span>)</span></code></pre></div>
<pre><code>##    Subject     age height Occasion
## 1        1 -1.0000  140.5        1
## 2        1 -0.7479  143.4        2
## 3        1 -0.4630  144.8        3
## 4        1 -0.1643  147.1        4
## 5        1 -0.0027  147.7        5
## 6        1  0.2466  150.2        6
## 7        1  0.5562  151.7        7
## 8        1  0.7781  153.3        8
## 9        1  0.9945  155.8        9
## 10       2 -1.0000  136.9        1</code></pre>
<p></p>
<p>Portanto, a coluna <code>Subject</code> identifica qual o indivíduo os valores da linha se referem. Repare que várias linhas dizem respeito ao mesmo indivíduo. Agora, pense como o <code>geom_line()</code> trataria esses diversos valores que se encaixam no mesmo grupo (no nosso caso, no mesmo <code>Subject</code>). Neste caso, o <code>geom_line()</code> irá conectar (incorretamente) todos os valores em conjunto da base, pois ele não sabe que cada um desses valores pertence a sujeitos diferentes, o <code>geom</code> pensa que todos esses valores pertencem a um único sujeito. O resultado seria um gráfico com um aspecto de “serra.”</p>
<p></p>
<div class="sourceCode" id="cb919"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb919-1"><a href="#cb919-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb919-2"><a href="#cb919-2" aria-hidden="true" tabindex="-1"></a>  Oxboys,</span>
<span id="cb919-3"><a href="#cb919-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> height)</span>
<span id="cb919-4"><a href="#cb919-4" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb919-5"><a href="#cb919-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()</span></code></pre></div>
<p><img src="Introducao_R_files/figure-html/unnamed-chunk-491-1.png" width="60%" style="display: block; margin: auto;" /></p>
<p></p>
<p>Para que isso fique claro, eu adicionei um <code>geom_point()</code> para que você veja cada um dos valores presentes na base. Primeiro, preste atenção nas variáveis que conectamos aos eixos do gráfico (idade e altura do indivíduo). Ambas as variáveis são contínuas, mas neste momento, não há qualquer variável no gráfico que possa identificar a qual dos indivíduos, cada um desses valores se refere. Logo, o <code>geom_line()</code> acaba conectando todos esses pontos juntos.</p>
<p></p>
<div class="sourceCode" id="cb920"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb920-1"><a href="#cb920-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb920-2"><a href="#cb920-2" aria-hidden="true" tabindex="-1"></a>  Oxboys,</span>
<span id="cb920-3"><a href="#cb920-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> height)</span>
<span id="cb920-4"><a href="#cb920-4" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb920-5"><a href="#cb920-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb920-6"><a href="#cb920-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code></pre></div>
<p><img src="Introducao_R_files/figure-html/unnamed-chunk-492-1.png" width="60%" style="display: block; margin: auto;" /></p>
<p></p>
<p>Ao invés do <code>geom_line()</code> conectar todos esses pontos em conjunto, o <code>geom</code> deveria conectar todos os pontos que dizem respeito ao mesmo indivíduo, e é para isso que o argumento <code>group</code> serve. Você define neste argumento, qual a coluna que identifica qual é o grupo (ou no nosso caso, o indivíduo) que está sendo tratado em cada observação de sua base de dados.</p>
<p></p>
<div class="sourceCode" id="cb921"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb921-1"><a href="#cb921-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb921-2"><a href="#cb921-2" aria-hidden="true" tabindex="-1"></a>  Oxboys,</span>
<span id="cb921-3"><a href="#cb921-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> height, <span class="at">group =</span> Subject)</span>
<span id="cb921-4"><a href="#cb921-4" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb921-5"><a href="#cb921-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb921-6"><a href="#cb921-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code></pre></div>
<p><img src="Introducao_R_files/figure-html/unnamed-chunk-493-1.png" width="60%" style="display: block; margin: auto;" /></p>
<p></p>
<p>Uma outra forma de definirmos esses grupos para o <code>geom</code>, é colorindo as linhas com o argumento <em>color</em>, ou então variando o formato dessas linhas com o argumento <em>linetype</em>. Basta você fornecer a estes argumentos, uma coluna que seja capaz de identificar cada um dos grupos ou indivíduos (no nosso caso, <code>Subject</code>) que estão sendo tratados no gráfico.</p>
<p></p>
<div class="sourceCode" id="cb922"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb922-1"><a href="#cb922-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb922-2"><a href="#cb922-2" aria-hidden="true" tabindex="-1"></a>  Oxboys,</span>
<span id="cb922-3"><a href="#cb922-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> height, <span class="at">color =</span> Subject)</span>
<span id="cb922-4"><a href="#cb922-4" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb922-5"><a href="#cb922-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()</span></code></pre></div>
<p><img src="Introducao_R_files/figure-html/unnamed-chunk-494-1.png" width="60%" style="display: block; margin: auto;" /></p>
<p></p>
<p>Portanto, toda vez em que utilizar este <code>geom</code> em uma base que possui mais de um valor por grupo, você muito provavelmente terá de utilizar <em>group</em>, especialmente se você precisa diferenciar as curvas de cada grupo no gráfico.</p>
<p>Se você quiser mostrar uma única linha no gráfico, você vai mexer obrigatoriamente com o <em>group</em> caso a variável do eixo x seja categórica, onde neste caso, você deve dar uma constante qualquer ao argumento (eu geralmente defino para 1: <code>aes(group = 1)</code>). Isso é necessário, porque <code>geom_line()</code> entende que cada um dos valores dessa variável categórica, representa um grupo diferente. Dessa forma, cada um desses grupos irá possuir apenas um valor em toda a base. Caso você se esqueça de definir este valor para <em>group</em> nesta situação, o seguinte erro irá aparecer:</p>
<p></p>
<pre class="text"><code># Each group consists of only one observation. Do you need to adjust the group
# aesthetic?</code></pre>
<p></p>
</div>
<div id="histogramas-e-outros-gráficos-de-frequência" class="section level3" number="8.6.4">
<h3 number="8.6.4"><span class="header-section-number">8.6.4</span> Histogramas e outros gráficos de frequência</h3>
<p>Histogramas e polígonos de frequência são gráficos “unidimensionais,” ou dito de outra forma, apresentam informações sobre apenas uma variável, mais especificamente uma variável contínua. Por essa razão, você precisa definir apenas um dos eixos do gráfico, geralmente, o eixo x. Estes gráficos são criados por <code>geom_histogram()</code> e <code>geom_freqpoly()</code>.</p>
<p></p>
<div class="sourceCode" id="cb924"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb924-1"><a href="#cb924-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(hwy)) <span class="sc">+</span> <span class="fu">geom_histogram</span>()</span></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="Introducao_R_files/figure-html/unnamed-chunk-496-1.png" width="60%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb926"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb926-1"><a href="#cb926-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(hwy)) <span class="sc">+</span> <span class="fu">geom_freqpoly</span>()</span></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="Introducao_R_files/figure-html/unnamed-chunk-496-2.png" width="60%" style="display: block; margin: auto;" /></p>
<p></p>
<p>Ambos os gráficos funcionam da mesma forma, apenas a forma geométrica utilizada é diferente. Eles pegam a distribuição da variável ligada ao eixo x, e dividem essa distribuição em vários intervalos (chamados de <em>bin</em>’s), e contam quantos valores se encaixam em cada um destes intervalos. Neste <code>geom</code>, é importante que você teste diferentes larguras para estes intervalos, através do argumento <em>binwidth</em>. Por padrão, o <code>geom</code> tenta dividir a distribuição em 30 intervalos diferentes.</p>
<p>Você pode separar as distribuições por alguma variável categórica, dando essa variável ao argumento <em>group</em>. Porém, essas distribuições estarão sobrepostas no gráfico, sendo impossível diferenciá-las. Logo, é necessário que você mostre essas distribuições separadas em diferentes facetas do gráfico (através da função <code>facet_wrap()</code>).</p>
<p></p>
<div class="sourceCode" id="cb928"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb928-1"><a href="#cb928-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(hwy, <span class="at">group =</span> cyl)) <span class="sc">+</span></span>
<span id="cb928-2"><a href="#cb928-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>() <span class="sc">+</span></span>
<span id="cb928-3"><a href="#cb928-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>class)</span></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="Introducao_R_files/figure-html/unnamed-chunk-497-1.png" width="60%" style="display: block; margin: auto;" /></p>
<p></p>
<p>O <code>geom_freqpoly()</code> não sofre seriamente deste problema, pois a sua forma geométrica é “oca.” Mas é interessante de qualquer forma, que você ou separe essas distribuições em diferentes facetas do gráfico, ou então, que colora as distribuições de acordo com a variável categórica utilizada.</p>
<p></p>
<div class="sourceCode" id="cb930"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb930-1"><a href="#cb930-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(hwy, <span class="at">color =</span> class)) <span class="sc">+</span></span>
<span id="cb930-2"><a href="#cb930-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_freqpoly</span>() </span></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="Introducao_R_files/figure-html/unnamed-chunk-498-1.png" width="60%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb932"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb932-1"><a href="#cb932-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(hwy, <span class="at">fill =</span> class)) <span class="sc">+</span></span>
<span id="cb932-2"><a href="#cb932-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>() <span class="sc">+</span></span>
<span id="cb932-3"><a href="#cb932-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>class)</span></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="Introducao_R_files/figure-html/unnamed-chunk-498-2.png" width="60%" style="display: block; margin: auto;" /></p>
<p></p>
<p>Uma alternativa a estes <code>geom</code>’s, é o <code>geom_density()</code> que calcula uma função de densidade para a variável escolhida. Caso esteja interessado em separar essa distribuição de acordo com uma variável categórica, eu recomendo que dê uma olhada no pacote <code>ggridges</code>. Este pacote fornece novos <code>geom</code>’s, que posicionam essas distribuições separadas de uma forma esteticamente atraente, sem a necessidade de construir diferentes facetas do mesmo gráfico, além de fornecer mecanismos para marcar os percentis da distribuição no gráfico. É mais fácil ver com seus próprios olhos,<a href="#fn29" class="footnote-ref" id="fnref29"><sup>29</sup></a> do que eu explicar.</p>
<p>Caso você prefira permanecer com o <code>geom</code> padrão do <code>ggplot</code> e ainda separar a distribuição por uma variável categórica, você pode utilizar o argumento <em>alpha</em> para reduzir a opacidade dessas distribuições, como um meio de combater a sobreposição. Mas o ideal, é que você as separe em diferentes facetas, utilizando <code>facet_wrap()</code> da mesma forma que fizemos para os histogramas.</p>
<p></p>
<div class="sourceCode" id="cb934"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb934-1"><a href="#cb934-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(hwy, <span class="at">fill =</span> class)) <span class="sc">+</span> <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.4</span>)</span></code></pre></div>
<p><img src="Introducao_R_files/figure-html/unnamed-chunk-499-1.png" width="60%" style="display: block; margin: auto;" /></p>
<p></p>
</div>
<div id="adicionando-textos-ao-gráfico" class="section level3" number="8.6.5">
<h3 number="8.6.5"><span class="header-section-number">8.6.5</span> Adicionando textos ao gráfico</h3>
<p>Você pode adicionar rótulos ao seu gráfico com <code>geom_label()</code>, ou adicionar textos simples com <code>geom_text()</code>. Estes <code>geom</code>’s funcionam exatamente como o <code>geom_point()</code>, porém, ao invés de desenharem pontos, eles desenham textos. Em outras palavras, eles são <code>geom</code>’s individuais, em que desenham um texto, ou um rótulo, para cada uma das observações de sua base de dados.</p>
<p>Dessa vez, você deve definir a coluna que contém os rótulos/textos que deseja mostrar no gráfico, no argumento <em>label</em> em <code>aes()</code>. Os rótulos serão posicionados no plano cartesiano de acordo com os valores definidos pelas variáveis ligadas aos eixos x e y.</p>
<p></p>
<div class="sourceCode" id="cb935"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb935-1"><a href="#cb935-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(<span class="at">x =</span> displ, <span class="at">y =</span> hwy, <span class="at">label =</span> model)) <span class="sc">+</span></span>
<span id="cb935-2"><a href="#cb935-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>()</span></code></pre></div>
<p><img src="Introducao_R_files/figure-html/unnamed-chunk-500-1.png" width="60%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb936"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb936-1"><a href="#cb936-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(<span class="at">x =</span> displ, <span class="at">y =</span> hwy, <span class="at">label =</span> model)) <span class="sc">+</span></span>
<span id="cb936-2"><a href="#cb936-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_label</span>()</span></code></pre></div>
<p><img src="Introducao_R_files/figure-html/unnamed-chunk-500-2.png" width="60%" style="display: block; margin: auto;" /></p>
<p></p>
<p>Ao colocar textos em um gráfico, você dificilmente não enfrentará algum nível de sobreposição. O <code>ggplot</code> oferece algumas ferramentas que em muitas ocasiões não resolvem o problema, mas que em outras podem ser suficientes. Ambos os <code>geom</code>’s descritos aqui, possuem o argumento <em>check_overlap</em>. Caso ele seja configurado para <code>TRUE</code>, o <code>ggplot</code> irá criar os rótulos na ordem em que eles aparecem na sua base, e eliminar todos os rótulos consecutivos que sobreporem os anteriores. O código ficaria dessa forma:</p>
<p></p>
<div class="sourceCode" id="cb937"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb937-1"><a href="#cb937-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(<span class="at">x =</span> displ, <span class="at">y =</span> hwy, <span class="at">label =</span> model)) <span class="sc">+</span></span>
<span id="cb937-2"><a href="#cb937-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">check_overlap =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p></p>
<p>Apesar de uma solução, ela pode muito bem eliminar justamente os rótulos que queremos destacar no gráfico, e por isso é pouco desejada. Você poderia também reduzir o tamanho da fonte através de <em>size</em>. Um detalhe é que este argumento trabalha por padrão com valores em milímetros (mm), mas como é um pouco confuso trabalhar com tamanho de fontes nesta unidade, eu geralmente transformo os valores para pontos (pt). No exemplo abaixo, estou reduzindo o tamanho das fontes para 7 pt. O problema dessa opção, é que ela representa um <em>trade-off</em> entre a sobreposição de pontos, e a legibilidade dos rótulos, cabe a você definir o equilíbrio entre essas opções.</p>
<p></p>
<div class="sourceCode" id="cb938"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb938-1"><a href="#cb938-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(<span class="at">x =</span> displ, <span class="at">y =</span> hwy, <span class="at">label =</span> model)) <span class="sc">+</span></span>
<span id="cb938-2"><a href="#cb938-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">size =</span> <span class="dv">7</span><span class="sc">/</span>.pt)</span></code></pre></div>
<p><img src="Introducao_R_files/figure-html/unnamed-chunk-502-1.png" width="60%" style="display: block; margin: auto;" /></p>
<p></p>
<p>A melhor solução possível, seria ajustarmos a posição de cada um dos pontos individualmente. Entretanto, se você tem vários textos que exigem desvios diferentes, essa solução facilmente se torna muito trabalhosa. A ideia, seria criarmos duas novas colunas em nosso <code>data.frame</code>, onde em cada uma você define um valor de desvio vertical (<code>y_desvio</code>), e na outra o valor de desvio horizontal (<code>x_desvio</code>) para o rótulo definido naquela linha. Em seguida, você conecta essas colunas aos argumentos de posição responsáveis por realizar estes deslocamentos de textos (<em>nudge_y</em> e <em>nudge_x</em>) em seu <em>aesthetic mapping</em> (<code>aes()</code>). Veja o código abaixo.</p>
<p></p>
<div class="sourceCode" id="cb939"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb939-1"><a href="#cb939-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb939-2"><a href="#cb939-2" aria-hidden="true" tabindex="-1"></a>  mpg,</span>
<span id="cb939-3"><a href="#cb939-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(</span>
<span id="cb939-4"><a href="#cb939-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> displ,</span>
<span id="cb939-5"><a href="#cb939-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> hwy,</span>
<span id="cb939-6"><a href="#cb939-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> model,</span>
<span id="cb939-7"><a href="#cb939-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">nudge_x =</span> x_desvio,</span>
<span id="cb939-8"><a href="#cb939-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">nudge_y =</span> y_desvio</span>
<span id="cb939-9"><a href="#cb939-9" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb939-10"><a href="#cb939-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>()</span></code></pre></div>
<p></p>
<p>Vamos separar uma seção para descrevermos outras soluções mais eficazes para esse problema. Também vamos separar, uma seção para descrevermos quais são as estratégias possíveis para você trocar a fonte dos textos mostrados no gráfico, algo que ainda é difícil de ser realizado, especialmente se você trabalha no Windows. Agora vou explicar o que os argumentos de posição (<em>nudge_x</em> e <em>nudge_y</em>), e os de justificação (<em>hjust</em> e <em>vjust</em>) fazem.</p>
<p>Durante muito tempo, eu sofri de uma leve confusão entre esses argumentos. Como você muito provavelmente vai querer ajustar o posicionamento desses textos, vou tentar explicar a diferença entre os dois da forma mais clara possível, para que você não sofra do mesmo efeito.</p>
<p>Vamos começar pelos argumentos de justificação, que são <em>hjust</em> (justificação horizontal) e <em>vjust</em> (justificação vertical). Estes argumentos, servem para alterar a justificação, ou o alinhamento da cadeia de texto em relação ao seu ponto de referência (ou de coordenadas).</p>
<p></p>
<div class="sourceCode" id="cb940"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb940-1"><a href="#cb940-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb940-2"><a href="#cb940-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="fl">1.5</span>),</span>
<span id="cb940-3"><a href="#cb940-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="fl">1.5</span>),</span>
<span id="cb940-4"><a href="#cb940-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">text =</span> <span class="fu">c</span>(</span>
<span id="cb940-5"><a href="#cb940-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;bottom-left&quot;</span>, <span class="st">&quot;bottom-right&quot;</span>,</span>
<span id="cb940-6"><a href="#cb940-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;top-left&quot;</span>, <span class="st">&quot;top-right&quot;</span>, <span class="st">&quot;center&quot;</span></span>
<span id="cb940-7"><a href="#cb940-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb940-8"><a href="#cb940-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb940-9"><a href="#cb940-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb940-10"><a href="#cb940-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(x, y)) <span class="sc">+</span></span>
<span id="cb940-11"><a href="#cb940-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">&quot;darkgray&quot;</span>, <span class="at">size =</span> <span class="dv">7</span>) <span class="sc">+</span></span>
<span id="cb940-12"><a href="#cb940-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> text))</span></code></pre></div>
<p><img src="Introducao_R_files/figure-html/unnamed-chunk-504-1.png" width="60%" style="display: block; margin: auto;" /></p>
<p></p>
<p>Por padrão, <em>hjust</em> é configurado para <em>center</em>, e <em>vjust</em> para <em>middle</em>. Logo, todos os rótulos são centralizados (tanto verticalmente, quanto horizontalmente) no ponto que define a sua localização. Para mudar o alinhamento de todos os rótulos de uma vez, você pode configurar estes argumentos, por fora do <code>aes()</code>, fornecendo um dos valores pré-definidos.</p>
<p>No caso de <em>hjust</em>, há outros quatro valores pré-definidos possíveis (<em>left, right, inward, outward</em>). Caso você coloque <em>left</em> ou <em>right</em> neste argumento, todos os rótulos serão alinhados à esquerda, ou à direita dos pontos. Porém, caso você coloque <em>inward</em> ou <em>outward</em>, os textos serão alinhados (horizontalmente em relação aos pontos de sua localização) em um sentido para o para o centro do gráfico, ou se afastando do centro do gráfico. Dito de outra forma, os textos serão alinhados à esquerda, ou à direita do ponto de referência, a depender da sua localização em relação ao centro do plano cartesiano e do sentido escolhido (<em>inward</em> ou <em>outward</em>).</p>
<p>Para <em>vjust</em>, há também quatro outros valores pré-definidos (<em>bottom, top, inward, outward</em>). Os valores <em>bottom</em> e <em>top</em> alinham os textos na base ou no topo do ponto de referência do texto. Enquanto os valores <em>inward</em> e <em>outward</em> funcionam no mesmo sentido que em <em>hjust</em>, porém eles controlam o alinhamento vertical dos textos.</p>
<p></p>
<div class="sourceCode" id="cb941"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb941-1"><a href="#cb941-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(x, y)) <span class="sc">+</span></span>
<span id="cb941-2"><a href="#cb941-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">&quot;gray&quot;</span>, <span class="at">size =</span> <span class="dv">7</span>) <span class="sc">+</span></span>
<span id="cb941-3"><a href="#cb941-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> text), <span class="at">vjust =</span> <span class="st">&quot;inward&quot;</span>, <span class="at">hjust =</span> <span class="st">&quot;inward&quot;</span>)</span></code></pre></div>
<p><img src="Introducao_R_files/figure-html/unnamed-chunk-505-1.png" width="60%" style="display: block; margin: auto;" /></p>
<p></p>
<p>Para deixar claro o que estes argumentos fazem, trago um novo exemplo abaixo que contém cadeias de texto de duas linhas. Caso você queira variar a justificação destes textos, ao longo do gráfico, significa que você deve conectar uma coluna de seu <code>data.frame</code> a estes argumentos em <code>aes()</code>. Porém, estes argumentos não aceitam os valores pré-definidos ao estarem dentro de <code>aes()</code>. Nestas situações, você deve fornecer um número: 0 (justificado à esquerda); 0.5 (centralizado); ou 1 (justificado à direita).</p>
<p></p>
<div class="sourceCode" id="cb942"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb942-1"><a href="#cb942-1" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb942-2"><a href="#cb942-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">times =</span> <span class="dv">3</span>),</span>
<span id="cb942-3"><a href="#cb942-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">each =</span> <span class="dv">3</span>),</span>
<span id="cb942-4"><a href="#cb942-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">texto =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;Um texto alinhado</span><span class="sc">\n</span><span class="st">à esquerda&quot;</span>,</span>
<span id="cb942-5"><a href="#cb942-5" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;Um texto</span><span class="sc">\n</span><span class="st">centralizado&quot;</span>,</span>
<span id="cb942-6"><a href="#cb942-6" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;Um texto alinhado</span><span class="sc">\n</span><span class="st">à direita&quot;</span>),</span>
<span id="cb942-7"><a href="#cb942-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">each =</span> <span class="dv">3</span></span>
<span id="cb942-8"><a href="#cb942-8" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb942-9"><a href="#cb942-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">hjust =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.5</span>, <span class="dv">1</span>), <span class="at">each =</span> <span class="dv">3</span>),</span>
<span id="cb942-10"><a href="#cb942-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">vjust =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.5</span>, <span class="dv">1</span>), <span class="at">times =</span> <span class="dv">3</span>)</span>
<span id="cb942-11"><a href="#cb942-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb942-12"><a href="#cb942-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb942-13"><a href="#cb942-13" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(tab, <span class="fu">aes</span>(x, y)) <span class="sc">+</span></span>
<span id="cb942-14"><a href="#cb942-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">7</span>, <span class="at">color =</span> <span class="st">&quot;darkgray&quot;</span>) <span class="sc">+</span></span>
<span id="cb942-15"><a href="#cb942-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(</span>
<span id="cb942-16"><a href="#cb942-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> texto,</span>
<span id="cb942-17"><a href="#cb942-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">hjust =</span> hjust,</span>
<span id="cb942-18"><a href="#cb942-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">vjust =</span> vjust</span>
<span id="cb942-19"><a href="#cb942-19" aria-hidden="true" tabindex="-1"></a>  ))</span></code></pre></div>
<p><img src="Introducao_R_files/figure-html/unnamed-chunk-506-1.png" width="60%" style="display: block; margin: auto;" /></p>
<p></p>
<p>Eu acredito que é justamente essa opção numérica, que gera toda a confusão sobre a função verdadeira destes argumentos. Pois o <code>ggplot</code> não gera nenhum erro caso você dê valores diferentes, e se você aumentar progressivamente estes valores, você irá perceber que o deslocamento dos textos também aumenta. Muitos que se deparam com este comportamento, podem acreditar que estes argumentos servem para deslocar os textos, e não para alinhá-los em relação ao ponto de suas coordenadas. Por isso eu recomendo nestes argumentos, que você utilize um dos valores pré-definidos que citei anteriormente, e utilize essa escala numérica, apenas em situações em que você precisa dessa variação utilizando <code>aes()</code>.</p>
<p>Uma outra razão pela qual estes argumentos não são apropriados, caso você queira deslocar os textos em um sentido, é que eles não trabalham em sintonia com as escalas dos eixos. No exemplo abaixo, eu configuro o valor de <em>vjust</em> para -4. Porém, o <code>ggplot</code> não deslocou verticalmente os textos em 4 unidades. O texto de valor <em>center</em>, por exemplo, não foi deslocado para as coordenadas (x = 1.5, y = 5.5), e se você quiser que ele chegue nessa coordenada? O que você faz? Triplica? Quadruplica o valor anterior? Tudo isso, significa que não há como você prever o quanto o texto irá deslocar, e por isso, você pode perder muito tempo testando diversos valores em um argumento inadequado para o resultado que deseja.</p>
<p></p>
<div class="sourceCode" id="cb943"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb943-1"><a href="#cb943-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(x, y)) <span class="sc">+</span></span>
<span id="cb943-2"><a href="#cb943-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">&quot;gray&quot;</span>, <span class="at">size =</span> <span class="dv">7</span>) <span class="sc">+</span></span>
<span id="cb943-3"><a href="#cb943-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> text), <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">4</span>)</span></code></pre></div>
<p><img src="Introducao_R_files/figure-html/unnamed-chunk-507-1.png" width="60%" style="display: block; margin: auto;" /></p>
<p></p>
<p>Agora, vou explicar como os argumentos de posição funcionam. Como o próprio sufixo deles dá a entender, o <em>nudge_y</em> irá deslocar verticalmente os textos, e <em>nudge_x</em>, vai deslocá-los horizontalmente. O verbo <em>nudge</em> em inglês se refere ao ato de “cutucar,” ou empurrar gentilmente alguém, logo, estes argumentos servem para “empurrar” os textos de suas posições originais no plano cartesiano. Para demonstrarmos a sua aplicação, vamos tentar rotular um gráfico de barras, que apresente um somatório da quilometragem em cada cilindro.</p>
<p>Como descrevi anteriormente, o <code>geom_bar()</code> é um <code>geom</code> coletivo, enquanto os <code>geom</code>’s de texto são <code>geom</code>’s individuais. Por isso, caso você adicionar diretamente um <code>geom_text()</code> ao <code>geom_bar()</code>, sem levar em conta essa diferença, ele irá rotular cada uma das observações da base resumidas em cada barra, e não o total que ela representa.</p>
<p>Para rotular corretamente essas barras, você tem duas opções: 1) calcular o somatório em um objeto separado, e em seguida fornecer este objeto ao argumento <em>data</em>, e ajustar o <em>aesthetic mapping</em> de acordo com este objeto, em <code>geom_text()</code>; ou 2) usar as transformações estatísticas que o <code>ggplot</code> já disponibiliza para esse trabalho. No exemplo abaixo, estou demonstrando a opção 1, mas darei um exemplo da opção 2 quando chegarmos à seção de transformações estatísticas do <code>ggplot</code>.</p>
<p></p>
<div class="sourceCode" id="cb944"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb944-1"><a href="#cb944-1" aria-hidden="true" tabindex="-1"></a>somatorios <span class="ot">&lt;-</span> mpg <span class="sc">%&gt;%</span> </span>
<span id="cb944-2"><a href="#cb944-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cyl) <span class="sc">%&gt;%</span> </span>
<span id="cb944-3"><a href="#cb944-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">soma =</span> <span class="fu">sum</span>(hwy))</span>
<span id="cb944-4"><a href="#cb944-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb944-5"><a href="#cb944-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb944-6"><a href="#cb944-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(</span>
<span id="cb944-7"><a href="#cb944-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cyl, <span class="at">weight =</span> hwy),</span>
<span id="cb944-8"><a href="#cb944-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> mpg</span>
<span id="cb944-9"><a href="#cb944-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb944-10"><a href="#cb944-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb944-11"><a href="#cb944-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cyl, <span class="at">y =</span> soma, <span class="at">label =</span> soma),</span>
<span id="cb944-12"><a href="#cb944-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> somatorios</span>
<span id="cb944-13"><a href="#cb944-13" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="Introducao_R_files/figure-html/unnamed-chunk-508-1.png" width="60%" style="display: block; margin: auto;" /></p>
<p></p>
<p>Portanto, neste exemplo as duas camadas de <code>geom</code> utilizam não apenas <em>aesthetic mapping</em>’s, mas também fontes de dados, diferentes. Como você pode reparar acima, os rótulos estão sobre o topo da barra. Por isso, eu posso utilizar o <em>nudge_y</em> para adicionar um pequeno desvio vertical nestes rótulos, dando assim um maior espaço entre ele e a barra.</p>
<p>Diferentemente dos argumentos de alinhamento, os argumentos de posição (<em>nudge_y</em> e <em>nudge_x</em>) funcionam em sintonia com a escala dos eixos. Como a escala do eixo y termina em aproximadamente 2500, um desvio de 100 é provavelmente suficiente. Isso significa que caso o limite dessa escala fosse 1 décimo disso (250), por exemplo, um desvio de 100 em <em>nudge_y</em> iria gerar um deslocamento considerável nestes rótulos.</p>
<p></p>
<div class="sourceCode" id="cb945"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb945-1"><a href="#cb945-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb945-2"><a href="#cb945-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(</span>
<span id="cb945-3"><a href="#cb945-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cyl, <span class="at">weight =</span> hwy),</span>
<span id="cb945-4"><a href="#cb945-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> mpg</span>
<span id="cb945-5"><a href="#cb945-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb945-6"><a href="#cb945-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb945-7"><a href="#cb945-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cyl, <span class="at">y =</span> soma, <span class="at">label =</span> soma),</span>
<span id="cb945-8"><a href="#cb945-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> somatorios, </span>
<span id="cb945-9"><a href="#cb945-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">nudge_y =</span> <span class="dv">100</span></span>
<span id="cb945-10"><a href="#cb945-10" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="Introducao_R_files/figure-html/unnamed-chunk-509-1.png" width="60%" style="display: block; margin: auto;" /></p>
<p></p>
<p>Além dessas opções, caso você insira textos de 2 ou mais linhas no gráfico, você pode se interessar em reduzir ou aumentar o espaço entrelinhas destes textos. Neste caso, você pode controlar este espaço pelo argumento <em>lineheight</em> que define a proporção em relação à altura das letras. Um outro ponto possível de customização, é o ângulo dos textos, que é definido pelo argumento <em>angle</em>. Neste argumento, basta fornecer um número (de 0 a 360) que represente o ângulo desejado.</p>
<p></p>
<div class="sourceCode" id="cb946"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb946-1"><a href="#cb946-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb946-2"><a href="#cb946-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(</span>
<span id="cb946-3"><a href="#cb946-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cyl, <span class="at">weight =</span> hwy),</span>
<span id="cb946-4"><a href="#cb946-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> mpg</span>
<span id="cb946-5"><a href="#cb946-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb946-6"><a href="#cb946-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb946-7"><a href="#cb946-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cyl, <span class="at">y =</span> soma, <span class="at">label =</span> soma),</span>
<span id="cb946-8"><a href="#cb946-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> somatorios, </span>
<span id="cb946-9"><a href="#cb946-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">nudge_y =</span> <span class="dv">100</span>,</span>
<span id="cb946-10"><a href="#cb946-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">angle =</span> <span class="dv">45</span></span>
<span id="cb946-11"><a href="#cb946-11" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="Introducao_R_files/figure-html/unnamed-chunk-510-1.png" width="60%" style="display: block; margin: auto;" /></p>
<p></p>
</div>
</div>
<div id="sec:devices_graficos" class="section level2" number="8.7">
<h2 number="8.7"><span class="header-section-number">8.7</span> Exportando os seus gráficos do <code>ggplot</code></h2>
<p>Após gerar os seus gráficos com o <code>ggplot</code>, você provavelmente vai querer exportá-los para algum arquivo de imagem. Dessa forma, você possa inseri-los em seu artigo em Word (<code>.docx</code>), ou no <em>dashboard</em> que você deve apresentar ao seu chefe no dia seguinte. Para realizarmos essa tarefa, precisamos utilizar funções que possam construir esses arquivos de imagem, no qual podemos guardar os nossos gráficos. Com isso, temos duas alternativas mais comuns, que são:</p>
<ol style="list-style-type: decimal">
<li><p>Uma forma mais “moderna” de exportação, através do uso da função <code>ggsave()</code>, que é exposta por .</p></li>
<li><p>A forma tradicional de se exportar gráficos no R, descrita por .</p></li>
</ol>
<p>Uma outra referência que também descreve ambas alternativas, se encontra em . A primeira alternativa, seria uma forma mais “moderna” de exportar os seus gráficos no R, através da função <code>ggsave()</code> (uma função do próprio pacote <code>ggplot</code>), que tem se popularizado bastante nos últimos tempos. Entretanto, essa função nada mais é, do que um <em>wrapper</em> sobre as funções do pacote <code>grDevices</code>, que são utilizadas na segunda alternativa apresentada acima. Ou seja, a função <code>ggsave()</code> é apenas um atalho para o método descrito por <span class="citation"><a href="#ref-murrell2006" role="doc-biblioref">Murrell</a> (<a href="#ref-murrell2006" role="doc-biblioref">2006</a>)</span>, que utiliza as funções disponíveis no pacote <code>grDevices</code>.</p>
<p>Em mais detalhes, o pacote <code>grDevices</code> (que está incluso nos pacotes básicos da linguagem) oferece um conjunto de funções capazes de acessar diversos <em>devices</em> gráficos. Cada <em>device</em> gráfico, representa uma <em>engine</em> diferente que vai ser responsável por construir o arquivo onde o seu gráfico será guardado. Portanto, cada uma dessas <em>engines</em>, vão gerar um tipo arquivo diferente, ou em outras palavras, arquivos de extensões diferentes. Você já utiliza muitos desses <em>devices</em> gráficos, praticamente o tempo todo em sua rotina. Você apenas não sabia, que esse era o nome técnico dado às <em>engines</em>, que normalmente constroem esses tipos de arquivos. Sendo os exemplos mais famosos, os arquivos: JPEG/JPG (<code>.jpeg</code>, <code>.jpg</code>), PNG (<code>.png</code>), SVG (<code>.svg</code>) e PDF (<code>.pdf</code>).</p>
<div id="tipos-de-representação-geométrica-em-devices-gráficos" class="section level3" number="8.7.1">
<h3 number="8.7.1"><span class="header-section-number">8.7.1</span> Tipos de representação geométrica em <em>devices</em> gráficos</h3>
<p>Ao longo das décadas passadas mais recentes, a área da computação gráfica desenvolveu diversos modelos computacionais que fossem capazes de representar visualmente e virtualmente, o nosso mundo real <span class="citation">(<a href="#ref-hughes2014" role="doc-biblioref">Hughes et al. 2014</a>)</span>. Com isso, eu quero destacar que nós possuímos hoje, formas diferentes de se representar uma mesma imagem em nosso computador.</p>
<p>Isso significa, que cada um dos <em>devices</em> gráficos disponíveis, que podemos utilizar para guardar os nossos gráficos no R, em geral, utilizam um tipo, ou um método de representação geométrica diferente para representar a sua imagem. Cada um desses modelos, possuem características diferentes, e com isso, incorrem em diferentes erros na representação virtual de sua imagem. Logo, conhecer, mesmo que de maneira sutil, esses modelos de representação, as suas vantagens e características, se torna importante para fundamentarmos as nossas decisões sobre como vamos salvar os nossos gráficos no R.</p>
<p>Nós temos atualmente, dois modelos principais de representação geométrica que são utilizados para representar imagens, ao longo de toda a indústria da computação gráfica, sendo elas:</p>
<ol style="list-style-type: decimal">
<li><p>Vetorial.</p></li>
<li><p>Matricial.</p></li>
</ol>
<p>A representação vetorial (figura 8.3), como o próprio nome dá a entender, busca conectar um conjunto de vetores (ou de linhas) para formar cada forma geométrica presente em sua imagem. Um arquivo de imagem que utiliza essa representação, possui uma descrição matemática dos elementos geométricos que compõe a sua imagem <span class="citation">(<a href="#ref-murray1996" role="doc-biblioref">Murray and vanRyper 1996</a>)</span>. Essa descrição matemática possui informações como a direção, o comprimento e as coordenadas dos vetores (ou linhas) que formam cada forma geométrica de sua imagem. Em resumo, a representação vetorial funciona como aqueles desenhos infantis de “conecte os pontos.” Nesse sistema, qualquer forma presente em nosso gráfico, seja ela um quadrado, um círculo, uma letra, ou uma garrafa, é formada por um conjunto de linhas que conectam os “vértices” de cada forma.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/vetorial_matricial.png" alt="Diferenças entre as representações vetorial e matricial" width="60%" />
<p class="caption">
(#fig:unnamed-chunk-511)Diferenças entre as representações vetorial e matricial
</p>
</div>
<p></p>
<p>Por outro lado, imagens que se encontram em representação matricial (figura 8.3), são popularmente conhecidas por <em>raster image</em>, ou <em>bitmap image</em>, e utilizam-se de uma malha quadricular (ou de um <em>grid</em>), no qual cada célula é preenchida, a fim de representar cada parte de sua imagem. Uma forma típica de identificarmos esse tipo de representação, está no efeito “escada,” ou no efeito pixelado (ou quadriculado) que adquirimos ao darmos um <em>zoom</em> nesse tipo de imagem.</p>
<p>Os principais <em>devices</em> gráficos disponíveis no R, que utilizam a representação vetorial, são os arquivos PDF (<code>.pdf</code>) e SVG (<code>.svg</code>). Além desses, temos alguns outros <em>devices</em> menos comuns, como os arquivos <em>encapsulated PostScript</em> (<code>.eps</code>) que são mais utilizados em programas da Adobe, como o PhotoShop. Imagens produzidas através de representações vetoriais, são em geral, mais bem definidas do que imagens produzidas por representações matriciais, e mesmo que o usuário dê um <em>zoom</em> grande sobre a imagem, elas são capazes de manter essa definição. Logo, como foi destacado por <span class="citation"><a href="#ref-wickham2016" role="doc-biblioref">Wickham</a> (<a href="#ref-wickham2016" role="doc-biblioref">2016</a>, p 185)</span>, imagens de representações vetoriais parecem mais atraentes em um número maior de lugares. Especialmente pelo fato, de que o sistema vetorial consegue representar formas geométricas (principalmente polígonos), de maneira mais precisa, do que o sistema matricial.</p>
<p>Apesar dessa vantagem, não são todos os programas que suportam o uso de imagens provenientes de representações vetoriais (por exemplo, o Word aceita o uso de arquivos SVG, mas não aceita o uso de PDF’s para inserção de imagens). Em contrapartida, arquivos de <em>raster image</em> (ou <em>bitmap image</em>), são aceitos na grande maioria dos programas, e portanto, representam uma forma mais portátil de transportar os seus gráficos ao longo de diversos programas e sistemas. Tendo isso em mente, os <em>devices</em> gráficos mais conhecidos, que usam a representação matricial, são os arquivos PNG (<code>.png</code>), JPEG/JPG (<code>.jpeg</code>) e TIFF (<code>.tiff</code>).</p>
<p>Logo, ao escolher o <em>device</em> gráfico que irá gerar o seu arquivo de imagem, você deve refletir sobre qual o formato que mais se adequa as suas necessidades. Mesmo que você possa produzir imagens mais fiéis através de uma representação vetorial, isso não se configura na maioria das ocasiões, como uma grande vantagem. Pois, você pode se aproveitar da maior flexibilidade dos <em>devices</em> de representação matricial, e ainda assim, produzir imagens muito bem definidas e de alta resolução. Sobretudo com o uso de um arquivo PNG (<code>.png</code>) ou TIFF (<code>.tiff</code>), que produzem em geral, resultados melhores do que um arquivo JPEG/JPG (<code>.jpeg</code>).</p>
<p>Em resumo, caso o uso de um arquivo PDF (<code>.pdf</code>), ou SVG (<code>.svg</code>), não represente uma limitação para o seu trabalho, você geralmente vai preferi-los em detrimento de outros <em>devices</em> gráficos. Entretanto, caso você precise de uma maior portabilidade de seu gráfico, você ainda pode atingir ótimos resultados com um <em>device</em> gráfico de representação matricial, como um arquivo PNG (<code>.png</code>) ou TIFF (<code>.tiff</code>). Basta que você utilize uma resolução alta, e aplique um <em>anti-aliasing</em> sobre o arquivo em que você irá salvar o gráfico. Um bom nível de resolução para esses tipos de arquivos, se encontra na casa dos 300 dpi, sendo essa a resolução mínima requisitada pela maioria dos jornais e revistas científicas.</p>
<p>Concluindo, podemos utilizar diferentes tipos de representações geométricas para guardarmos informações visuais em nosso computador, com o objetivo de representarmos virtualmente uma mesma imagem. Caso queira conhecer mais a fundo essas representações, você pode consultar  e <span class="citation"><a href="#ref-camara2001" role="doc-biblioref">Câmara and Monteiro</a> (<a href="#ref-camara2001" role="doc-biblioref">2001</a>)</span> para uma introdução útil, e para uma visão mais técnica e aprofundada, você pode consultar  e .</p>
</div>
<div id="sec:anti_aliasing" class="section level3" number="8.7.2">
<h3 number="8.7.2"><span class="header-section-number">8.7.2</span> Pontos importantes sobre <em>anti-alising</em></h3>
<p>O <em>device</em> gráfico utilizado pelo RStudio, em seu painel de <code>Plots</code>, depende do sistema operacional em que você está trabalhando. No caso do Windows, o RStudio irá utilizar o <em>device</em> gráfico nativo do sistema, e infelizmente, como foi pontuado por <span class="citation"><a href="#ref-chase2019" role="doc-biblioref">Chase</a> (<a href="#ref-chase2019" role="doc-biblioref">2019</a>)</span>, esse <em>device</em> não é muito bom. Um de seus principais problemas, é que ele não possui um mecanismo de <em>anti-aliasing</em>.</p>
<p>O <em>anti-aliasing</em>, é um recurso muito utilizado em diversos programas que trabalham com imagens. Um grande exemplo disso, se encontra nos <em>videogames</em>, que quase sempre possuem uma opção em suas configurações gráficas, que lhe permite aplicar esse recurso sobre o gráfico do <em>game</em>. Esse recurso, consiste em um método de suavização de imagens produzidas por representações matriciais, onde o computador tenta preencher certas áreas ao redor dos limites de cada forma geométrica representada na imagem, de forma que os contornos fiquem mais suaves e precisos, eliminando grande parte do efeito pixelado (ou quadriculado) presente em imagens desse tipo.</p>
<p>Portanto, se você, assim como eu, trabalha no Windows, todas as imagens (produzidas por <em>devices</em> gráficos que usam representação matricial) que você exportar no R, não vão incluir o uso de um <em>anti-aliasing</em>, por padrão do <em>device</em> gráfico utilizado pelo sistema. Isso significa, que grande parte das suas imagens, vão apresentar o efeito pixelado, mesmo que você utilize resoluções altas. Por exemplo, você pode ver na figura 8.4, especialmente na imagem com 300 dpi, que aumentar a resolução da imagem, ajuda bastante quanto ao efeito pixelado, mas que ainda não é o suficiente para eliminá-lo (se você der um <em>zoom</em> grande sobre a imagem de 300 dpi, você ainda é capaz de ver alguns resquícios do efeito “escada” que estamos tentando eliminar). Portanto, poderíamos atingir um resultado ainda melhor nessas imagens, com o uso de um <em>anti-aliasing</em>.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/sem_anti_aliasing.png" alt="Aumentar a resolução de uma imagem ajuda, mas ainda não é o suficiente" width="100%" />
<p class="caption">
(#fig:unnamed-chunk-512)Aumentar a resolução de uma imagem ajuda, mas ainda não é o suficiente
</p>
</div>
<p></p>
<p>Isso é um problema particular do Windows, que ocorre sempre que utilizamos algum dos <em>devices</em> gráficos que utilizam representação matricial. Pois os <em>devices</em> gráficos utilizados pelo RStudio em outros sistemas, como Mac e Linux, apresentam “de fábrica” um mecanismo de <em>anti-aliasing</em>. Apesar desse problema, os usuários de Windows possuem uma solução simples, que é descrita por <span class="citation"><a href="#ref-chase2019" role="doc-biblioref">Chase</a> (<a href="#ref-chase2019" role="doc-biblioref">2019</a>)</span>. Isto é, o uso da <em>engine</em> gráfica do Cairo Graphics, que está disponível normalmente nos sistemas Windows e oferece um recurso de anti-aliasing. O uso dessa <em>engine</em> também se torna essencial no Windows, quando desejamos utilizar em nossos gráficos, fontes que estão instaladas no nosso sistema.</p>
<p>Para acessarmos a <em>engine</em> gráfica do Cairo Graphics, podemos utilizar o argumento <code>type</code>, tanto na função <code>ggsave()</code>, quanto nas funções do pacote <code>grDevices</code>. Basta igualar esse argumento ao nome <code>cairo</code>, da seguinte forma: <code>type = "cairo"</code>. No caso da função <code>ggsave()</code>, ela não possui um argumento <code>type</code> definido, mas como essa função utiliza as funções do pacote <code>grDevices</code>, o argumento <code>type</code> será repassado às funções do pacote <code>grDevices</code> durante a sua execução.</p>
<p>Para reforçarmos essa ideia, olhe para a figura 8.5. Ambos os gráficos foram salvos em um arquivo PNG, com as mesmas dimensões, e utilizando a mesma resolução (300 dpi). Se você der um <em>zoom</em> muito grande sobre ambas as imagens, você poderá perceber que o efeito pixelado está muito menor, na imagem em que o <em>anti-aliasing</em> foi aplicado, em relação a outra imagem que não o possui.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/com_anti_aliasing.png" alt="Além de usar resoluções altas, use também anti-aliasing" width="100%" />
<p class="caption">
(#fig:unnamed-chunk-513)Além de usar resoluções altas, use também anti-aliasing
</p>
</div>
<p></p>
</div>
<div id="a-função-ggsave" class="section level3" number="8.7.3">
<h3 number="8.7.3"><span class="header-section-number">8.7.3</span> A função <code>ggsave()</code></h3>
<p>Como definimos anteriormente, a função <code>ggsave()</code> do pacote <code>ggplot</code>, representa apenas um atalho para o método descrito por <span class="citation"><a href="#ref-murrell2006" role="doc-biblioref">Murrell</a> (<a href="#ref-murrell2006" role="doc-biblioref">2006</a>)</span>, sendo portanto, um método menos verboso do que o método tradicional de se exportar gráficos no R. Para utilizar a função <code>ggsave()</code>, você precisa primeiro gerar o seu gráfico, ou melhor dizendo, o seu gráfico deve estar aparecendo na área direita e inferior do seu RStudio, na seção de <code>Plots</code>. Pois é a partir do <em>cache</em> dessa seção, que a função irá extrair o seu gráfico, e portanto, salvá-lo em algum local de seu computador.</p>
<p>Dessa forma, o código necessário para o uso dessa função, vai em geral, ser semelhante ao código abaixo. Você primeiro gera o gráfico, e em seguida, utiliza a função <code>ggsave()</code>, para salvar o gráfico correspondente.</p>
<p></p>
<div class="sourceCode" id="cb947"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb947-1"><a href="#cb947-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(displ, cty)) <span class="sc">+</span> <span class="fu">geom_point</span>()</span>
<span id="cb947-2"><a href="#cb947-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">&quot;output.pdf&quot;</span>)</span></code></pre></div>
<p></p>
<p>O primeiro argumento (<code>filename</code>) da função <code>ggsave()</code>, corresponde ao nome que você deseja dar ao arquivo onde seu gráfico será salvo. O segundo argumento (<code>device</code>), é onde você irá selecionar o <em>device</em> gráfico desejado para o arquivo onde o gráfico será salvo. Vale ressaltar, que você não precisa definir esse argumento. Pois você pode escolher implicitamente o <em>device</em> desejado, através da extensão que você define no nome do arquivo - no primeiro argumento (<code>filename</code>). Ou seja, se no primeiro argumento, eu colocar o nome do arquivo como <code>output.pdf</code>, devido a extensão <code>.pdf</code> ao final do nome, a função <code>ggsave()</code> vai gerar um arquivo PDF para você. Mas caso o nome do arquivo seja <code>output.png</code>, a função <code>ggsave()</code> vai construir um arquivo PNG. E assim por diante. Em resumo, você pode utilizar em todos os sistemas operacionais, através da função <code>ggsave()</code>, as seguintes extensões:</p>
<ol style="list-style-type: decimal">
<li><p><code>eps</code> - <em>encripted PostScript</em>.</p></li>
<li><p><code>ps</code> - <em>PostScript</em>.</p></li>
<li><p><code>tex</code> - PicTex.</p></li>
<li><p><code>pdf</code> - <em>Portable Document Format</em> (PDF).</p></li>
<li><p><code>jpeg</code> - Arquivo JPEG.</p></li>
<li><p><code>tiff</code> - <em>Tag Image File Format</em> (TIFF).</p></li>
<li><p><code>png</code> - <em>Portable Network Graphics</em> (PNG).</p></li>
<li><p><code>bmp</code> - <em>Bitmap Image File</em> (BMP).</p></li>
<li><p><code>svg</code> - <em>Scalable Vector Graphics</em> (SVG).</p></li>
</ol>
<p>Caso você deseje salvar o arquivo do gráfico, em um diretório diferente de seu diretório de trabalho atual do R, você pode utilizar o terceiro argumento (<code>path</code>), para selecionar uma pasta. Basta que você forneça um caminho absoluto até a pasta. Por exemplo, caso eu queira salvar o arquivo em minha pasta de Gráficos, localizada em minha pasta de Pesquisa, eu posso utilizar os seguintes comandos:</p>
<p></p>
<div class="sourceCode" id="cb948"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb948-1"><a href="#cb948-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(displ, cty)) <span class="sc">+</span> <span class="fu">geom_point</span>()</span>
<span id="cb948-2"><a href="#cb948-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(</span>
<span id="cb948-3"><a href="#cb948-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">filename =</span> <span class="st">&quot;output.pdf&quot;</span>,</span>
<span id="cb948-4"><a href="#cb948-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">path =</span> <span class="st">&quot;C:/Users/Pedro/Pesquisa/2020-08/Gráficos/&quot;</span></span>
<span id="cb948-5"><a href="#cb948-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p></p>
<p>Outros argumentos muito importantes a serem utilizados, são os argumentos <code>width</code>, <code>height</code> e <code>dpi</code>, que definem a largura, a altura e a resolução do arquivo resultante, respectivamente. É importante frisar que os argumentos <code>width</code> e <code>height</code>, trabalham com a unidade de polegadas (<code>inches</code> - <code>in</code>), sendo uma unidade menos comum em imagens. Como uma dica, você pode primeiro imaginar a largura e altura de sua imagem, em <em>pixels</em>, que é uma unidade mais comumente utilizada em situações como essa, e em seguida, converter esses <em>pixels</em> para polegadas (1 polegada equivale a 60 <em>pixels</em>), encontrando assim, o valor que você deseja fornecer aos argumentos supracitados.</p>
<p>Dando prosseguimento à descrição, os argumentos <code>width</code> e <code>height</code> são muito importantes, pois eles afetam diretamente a escala (ou o <em>aspect ratio</em>) da imagem. Dito de outra forma, esses argumentos acabam afetando a disposição dos elementos do gráfico, ao longo do espaço da imagem resultante. Com isso, o uso desses argumentos, envolve encontrar um certo equilíbrio, ou uma relação entre a altura e a largura da imagem, que melhor represente o seu gráfico. Por exemplo, os dois gráficos mostrados na figura 8.6, foram salvos utilizando-se a função <code>ggsave()</code>. Ambos os gráficos, foram salvos em um arquivo PNG (<code>.png</code>), e utilizaram uma resolução de 300 de dpi. A única diferença entre esses gráficos, se encontra nos valores de altura e largura utilizados em cada imagem.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/proporcao_altura.png" alt="Efeitos da relação entre altura e largura com ggsave(), sobre uma imagem" width="100%" />
<p class="caption">
(#fig:unnamed-chunk-516)Efeitos da relação entre altura e largura com ggsave(), sobre uma imagem
</p>
</div>
<p></p>
<p>Portanto, ao aumentarmos a altura e a largura da imagem, o gráfico resultante tende a ser mais “disperso,” e os seus elementos, menores. Essa característica é relevante, pois nós geralmente desejamos evitar um gráfico muito “disperso,” e com elementos muito pequenos. Isso se deve à função que um gráfico usualmente cumpre em uma análise. Nós frequentemente utilizamos gráficos, para nos comunicar com o nosso leitor, ao mostrarmos de forma visual, informações que são relevantes e que trazem novas perspectivas e questões sobre uma determinada análise. Se essas informações ficam menores e muito “dispersas” ao longo do espaço do nosso gráfico, o nosso leitor tem maior dificuldade de enxergar o padrão geral (ou a informação principal) do nosso gráfico. Não apenas porque a sua visão precisa cobrir um espaço mais amplo da tela, mas também porque as formas geométricas que representam os nossos dados, podem ficar muito pequenas, e com isso, mais difíceis de se identificar.</p>
<p>Por outro lado, a resolução (argumento <code>dpi</code>) definida na função <code>ggsave()</code>, funciona somente com <em>devices</em> gráficos que utilizam representações matriciais (e.g. PNG, TIFF e JPEG/JPG). A resolução da imagem, é responsável por modificar apenas a dimensão da matriz, ou da malha quadricular que será utilizada para representar a sua imagem. Resoluções maiores, vão utilizar matrizes de maiores dimensões (ou em outras palavras, uma matriz com maior número de células) para representar o seu gráfico, e, portanto, a imagem resultante será mais precisa, e irá sofrer de maneira menos intensa com o efeito “pixelado” produzido por representações matriciais.</p>
<p>Como exemplo prático, veja as imagens dos gráficos na figura 8.7. Ambos os gráficos foram salvos em um arquivo PNG, e utilizaram os mesmos valores de altura e largura. Porém, foi aplicado diferentes valores de resolução em ambas as imagens. Se você der um <em>zoom</em> sobre as imagens, você irá perceber que a imagem de 100 dpi, sofre de maneira muito mais acentuada do efeito granulado (ou pixelado), em relação a imagem de 300 dpi.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/proporcao_resolucao.png" alt="Efeitos da resolução com ggsave() sobre uma imagem" width="100%" />
<p class="caption">
(#fig:unnamed-chunk-517)Efeitos da resolução com ggsave() sobre uma imagem
</p>
</div>
<p></p>
<p>Lembre-se que podemos melhorar ainda mais a aparência dessas imagens, ao utilizarmos um recurso de <em>anti-aliasing</em>. Como já definimos na seção de <a href="#sec:anti_aliasing">Pontos importantes sobre <em>anti-aliasing</em></a>, para utilizarmos tal recurso, precisamos acessar a <em>engine</em> do Cairo Graphics, e para isso, precisamos apenas definir o argumento <code>type</code> para o nome <code>cairo</code>.</p>
<p></p>
<div class="sourceCode" id="cb949"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb949-1"><a href="#cb949-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(displ, cty)) <span class="sc">+</span> <span class="fu">geom_point</span>()</span>
<span id="cb949-2"><a href="#cb949-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(</span>
<span id="cb949-3"><a href="#cb949-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">filename =</span> <span class="st">&quot;output.png&quot;</span>,</span>
<span id="cb949-4"><a href="#cb949-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">path =</span> <span class="st">&quot;C:/Users/Pedro/Pesquisa/2020-08/Gráficos/&quot;</span>,</span>
<span id="cb949-5"><a href="#cb949-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">width =</span> <span class="dv">7</span>,</span>
<span id="cb949-6"><a href="#cb949-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">height =</span> <span class="dv">5</span>,</span>
<span id="cb949-7"><a href="#cb949-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">&quot;cairo&quot;</span></span>
<span id="cb949-8"><a href="#cb949-8" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p></p>
</div>
<div id="a-forma-tradicional-de-se-exportar-gráficos-no-r" class="section level3" number="8.7.4">
<h3 number="8.7.4"><span class="header-section-number">8.7.4</span> A forma tradicional de se exportar gráficos no R</h3>
<p>Apesar da função <code>ggsave()</code> ser um atalho útil, eu (Pedro) particularmente prefiro usar diretamente as funções do pacote <code>grDevices</code>, sempre que desejo exportar algum gráfico produzido no R. Parte dessa preferência, reside no fato de que a função <code>ggsave()</code> não oferece até o momento, suporte para a função <code>cairo_pdf()</code>, que se torna essencial quando desejamos exportar gráficos que utilizam fontes personalizadas, ou que estão instaladas em nosso sistema. Vale lembrar, que o pacote <code>grDevices</code> já está incluso nos pacotes básicos do R, e por essa razão, ele é carregado automaticamente em toda sessão do R que você inicia.</p>
<p>Como é descrito por , o processo tradicional de exportação de gráficos no R, é bem simples, e envolve três passos diferentes: 1) abrir um arquivo construído por algum <em>device</em> gráfico; 2) gerar o seu gráfico; 3) fechar o arquivo produzido pelo <em>device</em> gráfico.</p>
<p>Portanto, no primeiro passo, vamos criar um novo arquivo de imagem (vazio) em nosso computador, de acordo com um <em>device</em> gráfico de nossa preferência. Dessa forma, o arquivo fica em aberto, à espera de algum <em>input</em> gráfico a ser armazenado. Em seguida, nós podemos gerar o nosso gráfico. Sendo que diferentemente da função <code>ggsave()</code>, quando abrimos um arquivo de imagem (como fizemos no passo 1), qualquer gráfico que geramos não será mostrado no painel direito e inferior (seção <code>Plots</code>) do nosso RStudio. Pois ele é diretamente levado para o arquivo que abrimos. Por último, podemos fechar o arquivo que abrimos no primeiro passo, encerrando dessa forma, o processo de exportação.</p>
<p>Para abrirmos um novo arquivo de imagem em nosso computador, temos as funções disponíveis abaixo. Perceba que a lista de arquivos abaixo, é praticamente idêntica à lista que mostramos na seção anterior. Pois como já destacamos anteriormente, a função <code>ggsave()</code> vai utilizar “por trás dos bastidores,” todas essas funções abaixo (exceto a função <code>svg()</code><a href="#fn30" class="footnote-ref" id="fnref30"><sup>30</sup></a>) para construir os seus arquivos de imagem.</p>
<ol style="list-style-type: decimal">
<li><p><code>postscript()</code> - <em>encripted PostScript</em> e <em>PostScript</em>.</p></li>
<li><p><code>pictex()</code> - PicTex.</p></li>
<li><p><code>pdf()</code> e <code>cairo_pdf()</code> - <em>Portable Document Format</em> (PDF).</p></li>
<li><p><code>jpeg()</code> - Arquivo JPEG.</p></li>
<li><p><code>tiff()</code> - <em>Tag Image File Format</em> (TIFF).</p></li>
<li><p><code>png()</code> - <em>Portable Network Graphics</em> (PNG).</p></li>
<li><p><code>bmp()</code> - <em>Bitmap Image File</em> (BMP).</p></li>
<li><p><code>svg()</code> - <em>Scalable Vector Graphics</em> (SVG).</p></li>
</ol>
<p>Independente de qual o <em>device</em> gráfico, ou a função que você escolher para abrir um arquivo em seu computador, você irá fechar esse arquivo (terceiro passo), por meio da função <code>dev.off()</code>. Dessa forma, o código necessário para gerarmos, por exemplo, um arquivo PNG, através desse método de exportação, é semelhante aos comandos abaixo. De certa forma, você utiliza as funções do pacote <code>grDevices</code>, de modo que elas “contornem,” ou “envolvam” os comandos que geram o seu gráfico.</p>
<p></p>
<div class="sourceCode" id="cb950"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb950-1"><a href="#cb950-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Abra um arquivo de imagem</span></span>
<span id="cb950-2"><a href="#cb950-2" aria-hidden="true" tabindex="-1"></a><span class="co"># com algum device gráfico</span></span>
<span id="cb950-3"><a href="#cb950-3" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="st">&quot;output.png&quot;</span>)</span>
<span id="cb950-4"><a href="#cb950-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb950-5"><a href="#cb950-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Construa algum gráfico</span></span>
<span id="cb950-6"><a href="#cb950-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(displ, cty)) <span class="sc">+</span> <span class="fu">geom_point</span>()</span>
<span id="cb950-7"><a href="#cb950-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb950-8"><a href="#cb950-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Feche o arquivo que você criou</span></span>
<span id="cb950-9"><a href="#cb950-9" aria-hidden="true" tabindex="-1"></a><span class="co"># com dev.off()</span></span>
<span id="cb950-10"><a href="#cb950-10" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
<p></p>
<p>Assim como na função <code>ggsave()</code>, o primeiro argumento (<code>filename</code> ou <code>file</code>) de todas as funções do pacote <code>grDevices</code>, é responsável por definir o nome do arquivo onde o seu gráfico será salvo. Porém, as semelhanças com a função <code>ggsave()</code> acabam por aqui.</p>
<p>Diferentemente da função <code>ggsave()</code>, você precisa ficar mais atento ao definir as dimensões de sua imagem nas funções do pacote <code>grDevices</code>, pois as unidades utilizadas nos argumentos <code>height</code> e <code>width</code> ao longo dessas funções, variam. Uma boa forma de guardar essas unidades, é categorizar as funções de acordo com a representação geométrica que elas utilizam. As funções que utilizam representações vetoriais (PDF, SVG e EPS) usam a unidade de polegadas (<em>inches</em>), para definir as dimensões de sua imagem. Já as funções que utilizam representações matriciais (PNG, JPEG/JPG, TIFF, BMP) usam a unidade de <em>pixels</em>.</p>
<p>Uma outra diferença presente nas funções do pacote <code>grDevices</code>, é que o argumento responsável por definir a resolução da imagem, se chama <code>res</code> (abreviação para <em>resolution</em>), ao invés de <code>dpi</code> como ocorre em <code>ggsave()</code>. Entretanto, a unidade utilizada no argumento <code>res</code>, permanece a mesma, em relação ao argumento <code>dpi</code>.</p>
<div id="arquivos-png-jpegjpg-tiff-e-bmp" class="section level4" number="8.7.4.1">
<h4 number="8.7.4.1"><span class="header-section-number">8.7.4.1</span> Arquivos PNG, JPEG/JPG, TIFF e BMP</h4>
<p>Para os exemplos dessa seção, vou utilizar a função <code>png()</code>, com o objetivo de criar um modelo guia, sobre como você pode configurar esse conjunto de funções, que se referem a <em>devices</em> gráficos que utilizam representações matriciais. Ou seja, você pode replicar normalmente o método de uso da função <code>png()</code>, ou os seus argumentos, para as demais funções desse conjunto (que funcionam de maneira idêntica), basta trocar a função <code>png()</code> por uma dessas funções: <code>jpeg()</code>, <code>tiff()</code> e <code>bmp()</code>.</p>
<p>Em todas as ocasiões que você utilizar uma dessas funções, você possui ao menos 5 argumentos que você provavelmente irá definir. O primeiro argumento (<code>file</code> ou <code>filename</code>) de todas essas funções, é onde você irá definir o nome do arquivo, em que você está salvando o seu gráfico. Além dele, temos também os dois argumentos que definem a largura (<code>width</code>) e a altura (<code>height</code>) do arquivo resultante (lembre-se que esses argumentos trabalham com a unidade de <em>pixels</em>). Em seguida, temos o argumento <code>res</code>, que é responsável por definir a resolução do arquivo de imagem. Por último, mas não menos importante, temos o argumento <code>type</code>, que é responsável por definir se o R irá utilizar o <em>device</em> gráfico nativo do sistema, ou a <em>engine</em> do Cairo Graphics para construir a sua imagem.</p>
<p>Tendo esses argumentos em mente, temos logo abaixo um código modelo, sobre como poderíamos configurar essa função. No caso de arquivos PNG, você ainda pode utilizar o valor <code>cairo-png</code> no argumento <code>type</code>, para utilizar uma outra <em>engine</em> interna do Cairo Graphics. Porém, os resultados produzidos por <code>cairo</code> e <code>cairo-png</code> através do argumento <code>type</code>, são virtualmente idênticos (ao menos a olho nu). Você pode encontrar mais detalhes sobre a diferença entre esses dois métodos, na documentação da função <code>png()</code> (execute o comando <code>?png</code> no console para acessar essa documentação).</p>
<p></p>
<div class="sourceCode" id="cb951"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb951-1"><a href="#cb951-1" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(</span>
<span id="cb951-2"><a href="#cb951-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">filename =</span> <span class="st">&quot;um_nome_qualquer.png&quot;</span>, </span>
<span id="cb951-3"><a href="#cb951-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">width =</span> <span class="dv">2800</span>,</span>
<span id="cb951-4"><a href="#cb951-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">height =</span> <span class="dv">1800</span>,</span>
<span id="cb951-5"><a href="#cb951-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">res =</span> <span class="dv">300</span>,</span>
<span id="cb951-6"><a href="#cb951-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">&quot;cairo&quot;</span></span>
<span id="cb951-7"><a href="#cb951-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb951-8"><a href="#cb951-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(displ, cty)) <span class="sc">+</span> <span class="fu">geom_point</span>()</span>
<span id="cb951-9"><a href="#cb951-9" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
<p></p>
<p>Agora, é muito importante destacar que a resolução da imagem (que você define no argumento <code>res</code>) construída por essas funções, possui um efeito diferente do que vimos na função <code>ggsave()</code>. Quando estávamos discutindo a função <code>ggsave()</code>, vimos que a resolução definida no argumento <code>dpi</code> dessa função, cumpria o trabalho para o qual foi desenvolvida, que consistia no aumento ou redução da malha quadricular responsável pela representação da imagem. Em outras palavras, a resolução afetava diretamente a precisão da imagem construída.</p>
<p>Porém, em comparação com a função <code>ggsave()</code>, a resolução definida no argumento <code>res</code>, possui um efeito extra nas funções <code>png()</code>, <code>jpeg()</code>, <code>tiff()</code> e <code>bmp()</code>. Em resumo, ao modificarmos a resolução nessas funções, nós também afetamos o espaço da imagem, da mesma forma como ocorre ao modificarmos a altura e a largura da imagem. Por isso, ao utilizar essas funções, você possui mais um item a considerar, ao procurar pelo equilíbrio que melhor representa o seu gráfico.</p>
<p>Descrevendo esse efeito em mais detalhes, nas funções <code>png()</code>, <code>jpeg()</code>, <code>tiff()</code> e <code>bmp()</code>, caso nós mantivermos a altura e a largura da imagem constantes, ao aumentarmos a sua resolução, estamos de certa forma comprimindo o gráfico a um espaço menor. Por outro lado, ao reduzirmos essa resolução, estamos produzindo o efeito contrário, e como resultado, nós aumentamos o espaço que o gráfico irá ocupar na imagem.</p>
<p>Isto significa, que para você utilizar altos níveis de resolução em suas imagens, você terá que compensar os efeitos dessa resolução, com maiores valores para a altura e largura de sua imagem. Veja por exemplo, as imagens mostradas na figura 8.8. Ambas imagens apresentam exatamente o mesmo gráfico. Sendo que ambos os gráficos foram salvos em um arquivo PNG (construídos pela função <code>png()</code>), e utilizaram as mesmas dimensões (altura = 900 <em>pixels</em>, largura = 1500 <em>pixels</em>). Entretanto, os dois arquivos de imagem usaram resoluções diferentes. Perceba que o gráfico presente na imagem com maior resolução (300 dpi), está mais “comprimido,” enquanto o gráfico com menor resolução (180 dpi) traz um visual mais “natural,” como se o gráfico tivesse um espaço mais ideal para ocupar na imagem.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/resolucao_png.png" alt="Efeitos da resolução em png() sobre uma imagem" width="100%" />
<p class="caption">
(#fig:unnamed-chunk-521)Efeitos da resolução em png() sobre uma imagem
</p>
</div>
<p></p>
</div>
<div id="sec:cairo_pdf" class="section level4" number="8.7.4.2">
<h4 number="8.7.4.2"><span class="header-section-number">8.7.4.2</span> Arquivos PDF e SVG</h4>
<p>Nessa seção, vamos discutir três funções utilizadas para construirmos dois tipos de arquivos de imagem, que utilizam representações vetoriais, mais especificamente PDF (<code>pdf()</code> e <code>cairo_pdf()</code>) e SVG (<code>svg()</code>).</p>
<p>Você pode configurar as funções <code>pdf()</code>, <code>cairo_pdf()</code> e <code>svg()</code>, de maneira muito parecida com a função <code>ggsave()</code>. Dessa forma, você possui três argumentos principais a serem tratados nessas funções. O argumento <code>file</code>, para dar um nome ao arquivo que você está criando. E os argumentos <code>height</code> e <code>width</code> para definir a altura e a largura da imagem. Lembre-se que para as funções de <em>drives</em> gráficos que utilizam representação vetorial, as dimensões da imagem são definidas em polegadas (<em>inches</em>), e não em <em>pixels</em>. Abaixo temos um exemplo de uso dessas funções.</p>
<p></p>
<div class="sourceCode" id="cb952"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb952-1"><a href="#cb952-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pdf</span>(<span class="st">&quot;output.pdf&quot;</span>, <span class="at">width =</span> <span class="dv">8</span>, <span class="at">height =</span> <span class="dv">5</span>)</span>
<span id="cb952-2"><a href="#cb952-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mpg) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> displ, <span class="at">y =</span> hwy))</span>
<span id="cb952-3"><a href="#cb952-3" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb952-4"><a href="#cb952-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb952-5"><a href="#cb952-5" aria-hidden="true" tabindex="-1"></a><span class="fu">cairo_pdf</span>(<span class="st">&quot;output.pdf&quot;</span>, <span class="at">width =</span> <span class="dv">8</span>, <span class="at">height =</span> <span class="dv">5</span>)</span>
<span id="cb952-6"><a href="#cb952-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mpg) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> displ, <span class="at">y =</span> hwy))</span>
<span id="cb952-7"><a href="#cb952-7" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb952-8"><a href="#cb952-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb952-9"><a href="#cb952-9" aria-hidden="true" tabindex="-1"></a><span class="fu">svg</span>(<span class="st">&quot;output.svg&quot;</span>, <span class="at">width =</span> <span class="dv">8</span>, <span class="at">height =</span> <span class="dv">5</span>)</span>
<span id="cb952-10"><a href="#cb952-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mpg) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> displ, <span class="at">y =</span> hwy))</span>
<span id="cb952-11"><a href="#cb952-11" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
<p></p>
<p>Curiosamente, se você está exportando um arquivo PDF, você pode salvar múltiplos gráficos em um mesmo arquivo, de modo que cada gráfico terá a sua própria página. Como <span class="citation"><a href="#ref-chang2012" role="doc-biblioref">Chang</a> (<a href="#ref-chang2012" role="doc-biblioref">2012</a>, p 324)</span> descreve, caso você abra um arquivo PDF (com a função <code>pdf()</code> ou <code>cairo_pdf()</code>), e gere mais de um gráfico antes de encerrar esse arquivo com a função <code>dev.off()</code>, cada gráfico gerado terá a sua própria página no arquivo resultante.</p>
<p>Para fazer isso, nenhuma nova configuração é necessária sobre a função <code>pdf()</code>. Logo, independentemente de quantos gráficos você esteja planejando guardar nesse arquivo, você não precisa alterar nenhum argumento, em relação aos comandos anteriores. Tudo o que você precisa fazer, é abrir um novo arquivo com a função, e criar quantos gráficos você desejar antes de fechar o arquivo.</p>
<p></p>
<div class="sourceCode" id="cb953"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb953-1"><a href="#cb953-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pdf</span>(<span class="st">&quot;output.pdf&quot;</span>, <span class="at">width =</span> <span class="dv">8</span>, <span class="at">height =</span> <span class="dv">5</span>)</span>
<span id="cb953-2"><a href="#cb953-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb953-3"><a href="#cb953-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Gráfico 1</span></span>
<span id="cb953-4"><a href="#cb953-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mpg) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> displ, <span class="at">y =</span> hwy))</span>
<span id="cb953-5"><a href="#cb953-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Gráfico 2</span></span>
<span id="cb953-6"><a href="#cb953-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mpg) <span class="sc">+</span> <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> cyl))</span>
<span id="cb953-7"><a href="#cb953-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Gráfico 3</span></span>
<span id="cb953-8"><a href="#cb953-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mpg) <span class="sc">+</span> <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x =</span> hwy), <span class="at">color =</span> <span class="st">&quot;black&quot;</span>)</span>
<span id="cb953-9"><a href="#cb953-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb953-10"><a href="#cb953-10" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
<p></p>
<p>Porém, para atingir esse mesmo resultado com a função <code>cairo_pdf()</code>, você precisa ainda adicionar um novo argumento, chamado <code>onefile</code>. Tudo o que você deve fazer, é configurar esse argumento para verdadeiro (<code>TRUE</code>), como no exemplo abaixo. Dessa forma, todos os gráficos gerados por você, serão guardados em um mesmo arquivo.</p>
<p></p>
<div class="sourceCode" id="cb954"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb954-1"><a href="#cb954-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cairo_pdf</span>(<span class="st">&quot;output.pdf&quot;</span>, <span class="at">width =</span> <span class="dv">8</span>, <span class="at">height =</span> <span class="dv">5</span>, <span class="at">onefile =</span> <span class="cn">TRUE</span>)</span>
<span id="cb954-2"><a href="#cb954-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb954-3"><a href="#cb954-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Gráfico 1</span></span>
<span id="cb954-4"><a href="#cb954-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mpg) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> displ, <span class="at">y =</span> hwy))</span>
<span id="cb954-5"><a href="#cb954-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Gráfico 2</span></span>
<span id="cb954-6"><a href="#cb954-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mpg) <span class="sc">+</span> <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> cyl))</span>
<span id="cb954-7"><a href="#cb954-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Gráfico 3</span></span>
<span id="cb954-8"><a href="#cb954-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mpg) <span class="sc">+</span> <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x =</span> hwy), <span class="at">color =</span> <span class="st">&quot;black&quot;</span>)</span>
<span id="cb954-9"><a href="#cb954-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb954-10"><a href="#cb954-10" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
<p></p>
<p>Como o próprio nome da função <code>cairo_pdf()</code> dá a entender, essa função utiliza a <em>engine</em> gráfica do Cairo Graphics para construir o seu arquivo PDF. Como o recurso de <em>anti-aliasing</em> só é aplicado sobre imagens produzidas por representações matriciais, o uso do Cairo Graphics possui um papel diferente em representações vetoriais. Em resumo, você só vai precisar da função <code>cairo_pdf()</code>, caso você tenha utilizado em seu gráfico, fontes personalizadas, ou que estão instaladas em seu sistema.</p>
<p>Ao executar a função <code>pdfFonts()</code>, você pode encontrar uma lista, contendo as informações sobre todas as fontes atualmente disponíveis em sua sessão, que podem ser utilizadas ao exportarmos o nosso gráfico através da função <code>pdf()</code>. Em outras palavras, essa lista mostra todas as fontes que você pode utilizar em seu gráfico no R, e que vão estar disponíveis ao salvar esse gráfico em um arquivo PDF. Adicionar novas fontes a essa lista mostrada pela função <code>pdfFonts()</code>, não é algo simples. Por isso, diversos pacotes tem sido desenvolvidos com o objetivo de facilitar o uso de fontes personalizadas em gráficos no R. Dentre eles, o pacote <code>extrafont</code> é o que mais tem se destacado.</p>
<p>No próximo capítulo, vou mostrar como podemos aplicar esse pacote. Mas resumidamente, com o uso do pacote <code>extrafont</code>, o processo para o uso de fontes do sistema em seus gráficos no R, consiste em duas etapas: 1) “importar” as fontes para o R, de forma que ele guarde um registro da localização, e de outras informações sobre cada fonte instalada em seu sistema; 2) após o passo 1, você precisa sempre “carregar” essas fontes, durante toda sessão do R, em que você desejar utilizá-las.</p>
<p>Porém, no caso específico de uma exportação para um arquivo PDF, mesmo após utilizarmos as funções do pacote <code>extrafont</code>, para carregarmos as fontes que desejamos utilizar em nossa sessão do R - como demonstrado por <span class="citation"><a href="#ref-qiu2015" role="doc-biblioref">Qiu</a> (<a href="#ref-qiu2015" role="doc-biblioref">2015</a>, p 101)</span>, a função <code>pdf()</code>, ainda assim, costuma não ser capaz de incorporar as fontes utilizadas, ao arquivo PDF resultante. Apesar da dificuldade inerente ao processo, a <em>engine</em> interna do Cairo Graphics, oferece suporte para a criação de arquivos PDF, e ainda mais importante, oferece um excelente suporte para o processo de incorporação de fontes (ou <em>font embedding</em>, como é comumente chamado) de seu computador para o arquivo PDF criado.</p>
<p>O processo de <em>font embedding</em>, consiste em incluir dentro de seu arquivo PDF, uma descrição completa das fontes utilizadas ao longo de seu PDF. Com essa descrição, as fontes utilizadas em seu arquivo PDF, se tornam independentes do sistema no qual elas estão sendo mostradas ou impressas. Em outras palavras, as fontes de seu PDF vão ser corretamente mostradas na tela de qualquer computador, independentemente se esse computador possui ou não aquelas fontes presentes em seu sistema. O ponto forte da função <code>cairo_pdf()</code>, é que ela realiza esse processo de <em>font embedding</em> automaticamente.</p>
<p>Por exemplo, o gráfico mostrado na figura 8.9, utiliza a fonte Comic Sans MS (uma fonte normalmente disponível em todo sistema Windows) e foi salvo utilizando a função <code>cairo_pdf()</code>.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/grafico_cairo_pdf.png" alt="Um gráfico que utiliza a fonte Comic Sans MS" width="60%" />
<p class="caption">
(#fig:unnamed-chunk-525)Um gráfico que utiliza a fonte Comic Sans MS
</p>
</div>
<p></p>
</div>
</div>
</div>
<div id="exercícios-6" class="section level2 unnumbered">
<h2 class="unnumbered">Exercícios</h2>
<p><strong>Questão 8.1.</strong> Descubra qual o problema dos comandos abaixo, porque eles não geram um gráfico conforme esperado? Ou porque eles sequer geram algum gráfico? Vale destacar que, as tabelas <code>mpg</code> e <code>diamonds</code> estão disponíveis através do próprio pacote <code>ggplot2</code>. Portanto, assim que você chamar por esse pacote em sua sessão através do comando <code>library()</code>, você terá acesso a essas tabelas.</p>
<p>8.1.A) Os comandos abaixo deveriam gerar um simples gráfico de dispersão, porém, um erro é criado. Porque esse erro ocorre? Copie e cole em seu R e veja esse erro com seus próprios olhos.</p>
<p></p>
<div class="sourceCode" id="cb955"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb955-1"><a href="#cb955-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> mpg) <span class="sc">%&gt;%</span> </span>
<span id="cb955-2"><a href="#cb955-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb955-3"><a href="#cb955-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> displ, <span class="at">y =</span> hwy)</span>
<span id="cb955-4"><a href="#cb955-4" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p></p>
<p>8.1.B) Os comandos abaixo deveriam gerar um gráfico de dispersão, onde os pontos seriam coloridos de acordo com os valores da coluna <code>cut</code>. Porém, o resultado é um gráfico de dispersão onde todos os pontos continuam pretos! O que ocorreu de errado nesses comandos?</p>
<p></p>
<div class="sourceCode" id="cb956"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb956-1"><a href="#cb956-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> diamonds) <span class="sc">+</span></span>
<span id="cb956-2"><a href="#cb956-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb956-3"><a href="#cb956-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> carat, <span class="at">y =</span> price, <span class="at">fill =</span> cut)</span>
<span id="cb956-4"><a href="#cb956-4" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p></p>
<p>8.1.C) Os comandos abaixo deveriam gerar um simples gráfico de barras, onde todas as barras deveriam ser coloridas pela cor azul (<em>blue</em>), porém, o resultado é um gráfico com barras coloridas de um vermelho salmão. Porque isso ocorre? Como podemos corrigir esses comandos para que todas as barras estejam coloridas de azul?<a href="#fn31" class="footnote-ref" id="fnref31"><sup>31</sup></a>.</p>
<p></p>
<div class="sourceCode" id="cb957"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb957-1"><a href="#cb957-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diamonds) <span class="sc">+</span></span>
<span id="cb957-2"><a href="#cb957-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(</span>
<span id="cb957-3"><a href="#cb957-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> cut, <span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>)</span>
<span id="cb957-4"><a href="#cb957-4" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p></p>
<p></p>
<p><img src="Introducao_R_files/figure-html/unnamed-chunk-1072-1.png" width="60%" style="display: block; margin: auto;" /></p>
<p></p>
<p><strong>Questão 8.2.</strong> Como exercício prático, utilize as funções do pacote <code>ggplot</code> para desenhar os objetos abaixo:</p>
<p>8.2.A) Desenha a bandeira do movimento LGBTQ+. Como uma ajuda, nós temos abaixo um vetor contendo os códigos de cada cor presente nessa bandeira:</p>
<p></p>
<div class="sourceCode" id="cb958"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb958-1"><a href="#cb958-1" aria-hidden="true" tabindex="-1"></a>vec_colors <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb958-2"><a href="#cb958-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;#a319ff&quot;</span>,</span>
<span id="cb958-3"><a href="#cb958-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;#1294ff&quot;</span>,</span>
<span id="cb958-4"><a href="#cb958-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;#19bf45&quot;</span>,</span>
<span id="cb958-5"><a href="#cb958-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;#ffdc14&quot;</span>,</span>
<span id="cb958-6"><a href="#cb958-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;#ff6a00&quot;</span>,</span>
<span id="cb958-7"><a href="#cb958-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;#ff1919&quot;</span></span>
<span id="cb958-8"><a href="#cb958-8" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p></p>
<p>8.2.B) Considerando a função quadrática <span class="math inline">\(y = x^2 + 15x + 32\)</span>, desenhe a curva dessa função para o intervalo de 0 &lt; <span class="math inline">\(x\)</span> &lt; 1000.</p>
<p>8.2.C) Desenhe um conjunto de setas apontando para o texto <code>"Uma anotação muito importante"</code>. Ou seja, desenhe o texto guardado no objeto <code>anotacao</code> abaixo em seu <code>ggplot</code> e, em seguida, tente desenhar um conjunto de setas apontando para essa anotação.</p>
<p></p>
<div class="sourceCode" id="cb959"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb959-1"><a href="#cb959-1" aria-hidden="true" tabindex="-1"></a>anotacao <span class="ot">&lt;-</span> <span class="st">&quot;Uma anotação</span><span class="sc">\n</span><span class="st">muito importante&quot;</span></span></code></pre></div>
<p></p>
<p><strong>Questão 8.3.</strong> Na média qual a qualidade de corte (<code>cut</code>) na tabela <code>diamonds</code> que gera o maior preço (<code>price</code>). Dito de outra forma, utilize um gráfico do <code>ggplot</code> para responder à seguinte pergunta: tendo a tabela <code>diamonds</code> em mãos, quais são os cortes descritos na coluna <code>cut</code> que geram os diamantes mais caros do mercado, isto é, que possuem os maiores preços na coluna <code>price</code>. Lembre-se que a tabela <code>diamonds</code> advém do próprio pacote <code>ggplot2</code>, logo, se você chamou por esse pacote em sua sessão com um comando <code>library()</code>, você já tem acesso à tabela <code>diamonds</code>.</p>
<p></p>
<div class="sourceCode" id="cb960"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb960-1"><a href="#cb960-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb960-2"><a href="#cb960-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb960-3"><a href="#cb960-3" aria-hidden="true" tabindex="-1"></a><span class="do">### Ao chamar pelo pacote</span></span>
<span id="cb960-4"><a href="#cb960-4" aria-hidden="true" tabindex="-1"></a><span class="do">### ggplot2, você terá acesso</span></span>
<span id="cb960-5"><a href="#cb960-5" aria-hidden="true" tabindex="-1"></a><span class="do">### à tabela diamonds</span></span>
<span id="cb960-6"><a href="#cb960-6" aria-hidden="true" tabindex="-1"></a>diamonds</span></code></pre></div>
<pre><code>## # A tibble: 53,940 x 10
##    carat cut       color clarity depth table price     x     y     z
##    &lt;dbl&gt; &lt;ord&gt;     &lt;ord&gt; &lt;ord&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1  0.23 Ideal     E     SI2      61.5    55   326  3.95  3.98  2.43
##  2  0.21 Premium   E     SI1      59.8    61   326  3.89  3.84  2.31
##  3  0.23 Good      E     VS1      56.9    65   327  4.05  4.07  2.31
##  4  0.29 Premium   I     VS2      62.4    58   334  4.2   4.23  2.63
##  5  0.31 Good      J     SI2      63.3    58   335  4.34  4.35  2.75
##  6  0.24 Very Good J     VVS2     62.8    57   336  3.94  3.96  2.48
##  7  0.24 Very Good I     VVS1     62.3    57   336  3.95  3.98  2.47
##  8  0.26 Very Good H     SI1      61.9    55   337  4.07  4.11  2.53
##  9  0.22 Fair      E     VS2      65.1    61   337  3.87  3.78  2.49
## 10  0.23 Very Good H     VS1      59.4    61   338  4     4.05  2.39
## # ... with 53,930 more rows</code></pre>
<p></p>
<!--chapter:end:08-ggplot.Rmd-->
</div>
</div>
<div id="configurando-componentes-estéticos-do-gráfico-no-ggplot2" class="section level1" number="9">
<h1 number="9"><span class="header-section-number">9</span> Configurando componentes estéticos do gráfico no <code>ggplot2</code></h1>
<div id="introdução-e-pré-requisitos-3" class="section level2" number="9.1">
<h2 number="9.1"><span class="header-section-number">9.1</span> Introdução e pré-requisitos</h2>
<p>No primeiro capítulo sobre o <code>ggplot</code>, vimos quatro das várias camadas que compõe um gráfico estatístico segundo a abordagem de <span class="citation"><a href="#ref-wilkinson" role="doc-biblioref">Wilkinson</a> (<a href="#ref-wilkinson" role="doc-biblioref">2005</a>)</span>. Mais especificamente, vimos as três camadas essenciais que estão presentes em qualquer gráfico: os dados utilizados (<code>data</code>), o mapeamento (<em>aesthetic mapping</em>) de variáveis de sua tabela para atributos estéticos do gráfico, e as formas geométricas (<code>geom</code>’s) que representam os seus dados no gráfico. Além dessas camadas essenciais, também explicamos como você pode criar diferentes facetas de um mesmo gráfico.</p>
<p>Neste capítulo, estaremos focando nas outras camadas, mais especificamente, aquelas que controlam aspectos visuais e estéticos do gráfico. Estaremos utilizando novamente neste capítulo, o mesmo gráfico (<code>plot_exemplo</code>) como base para os nossos exemplos.</p>
<p></p>
<div class="sourceCode" id="cb962"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb962-1"><a href="#cb962-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;palmerpenguins&quot;</span>)</span>
<span id="cb962-2"><a href="#cb962-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(palmerpenguins)</span></code></pre></div>
<p></p>
</div>
<div id="tema-theme-do-gráfico" class="section level2" number="9.2">
<h2 number="9.2"><span class="header-section-number">9.2</span> Tema (<em>theme</em>) do gráfico</h2>
<p>O tema do gráfico, diz respeito a todos os elementos e configurações estéticos que não afetam, ou que não estão conectadas aos dados dispostos no gráfico. Ou seja, os temas não alteram as propriedades perceptíveis do gráfico, mas ajuda você a torná-lo esteticamente agradável <span class="citation">(<a href="#ref-wickham2016" role="doc-biblioref">Wickham 2016</a>, p 169)</span>. Em outras palavras, o tema lhe dá controle sobre as fontes utilizadas, o alinhamento do texto, a grossura do <em>grid</em> e das marcações, a cor do plano de fundo do gráfico, etc.</p>
<p>Todos os aspectos temáticos do gráfico são configurados pela função <code>theme()</code>, que possui vários argumentos. Cada argumento dessa função, lhe permite configurar um elemento de seu gráfico. Onde cada um destes elementos, são associados a um tipo de elemento diferente. Por exemplo, o título do gráfico, é um texto, logo, ele é associado ao elemento do tipo texto - <code>element_text()</code>, já as retas dos eixos são associadas ao elemento do tipo linha - <code>element_line()</code>.</p>
<p>Os tipos de elemento são apenas uma convenção, para que você saiba qual função <code>element_*()</code> é a apropriada para configurar o elemento desejado. Por exemplo, se o título do gráfico, é um elemento associado ao tipo “texto,” você deve usar a função <code>element_text()</code> para modificar este elemento. Porém, se você quer configurar o <em>background</em> do gráfico, você deve utilizar a função <code>element_rect()</code>, pois este elemento está associado ao tipo “retângulo.” Os diversos tipos de elemento são:</p>
<ol style="list-style-type: decimal">
<li><p>Texto: <code>element_text()</code>.</p></li>
<li><p>Retângulo: <code>element_rect()</code>.</p></li>
<li><p>Linha: <code>element_line()</code>.</p></li>
<li><p>Branco ou vazio: <code>element_blank()</code>.</p></li>
</ol>
<p>Você provavelmente está se perguntando o porquê da existência de um tipo de elemento “vazio.” O jornalista americano William Chase, apresentou um ditado na última conferência internacional do RStudio, que representa bem o papel que este tipo de elemento tem a cumprir no <code>ggplot</code>. O ditado diz o seguinte:</p>
<blockquote>
<p>“O espaço em branco no gráfico é como o alho que tempera a sua comida. Pegue o tanto que você acha necessário, e então triplique essa quantidade.” William Chase, <em>The Glamour of Graphics</em>, rstudio::conf, 2020.</p>
</blockquote>
<p>A noção de espaço, é muito importante no seu gráfico, seja porque você tem itens que estão tomando muito espaço das formas geométricas que estão representando os seus dados no gráfico, ou então, porque você quer tornar a visão de seu gráfico mais leve (ou mais “dispersa”) para o leitor. Por isso, o elemento do tipo “vazio” serve para eliminar elementos que são desnecessários em seu gráfico, dando assim, maior espaço para aqueles elementos que são de fato importantes.</p>
<p>Ao longo dessa seção, estarei utilizando um mesmo gráfico, para exemplificar algumas das principais configurações possíveis em <code>theme()</code>. Para não repetir o código que gera o gráfico, toda vez que alterarmos algo nele, eu vou guardar este gráfico em um objeto que dou o nome de <code>plot_exemplo</code>. Dessa forma, toda vez que quiser alterar algum elemento do gráfico, basta que eu adicione a função <code>theme()</code> a este objeto, onde o gráfico está guardado.</p>
<p></p>
<div class="sourceCode" id="cb963"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb963-1"><a href="#cb963-1" aria-hidden="true" tabindex="-1"></a>plot_exemplo <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> penguins) <span class="sc">+</span></span>
<span id="cb963-2"><a href="#cb963-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb963-3"><a href="#cb963-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(</span>
<span id="cb963-4"><a href="#cb963-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> flipper_length_mm,</span>
<span id="cb963-5"><a href="#cb963-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> body_mass_g,</span>
<span id="cb963-6"><a href="#cb963-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> species</span>
<span id="cb963-7"><a href="#cb963-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb963-8"><a href="#cb963-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb963-9"><a href="#cb963-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb963-10"><a href="#cb963-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Relação entre peso e comprimento da nadadeira </span></span>
<span id="cb963-11"><a href="#cb963-11" aria-hidden="true" tabindex="-1"></a><span class="st">    em diferentes</span><span class="sc">\n</span><span class="st">espécies de pinguim&quot;</span>,</span>
<span id="cb963-12"><a href="#cb963-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Comprimento da nadadeira&quot;</span>,</span>
<span id="cb963-13"><a href="#cb963-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Peso corporal&quot;</span>,</span>
<span id="cb963-14"><a href="#cb963-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;Espécie&quot;</span></span>
<span id="cb963-15"><a href="#cb963-15" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb963-16"><a href="#cb963-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb963-17"><a href="#cb963-17" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(plot_exemplo)</span></code></pre></div>
<p></p>
<p></p>
<p><img src="Introducao_R_files/figure-html/unnamed-chunk-530-1.png" width="60%" style="display: block; margin: auto;" /></p>
<p></p>
</div>
<div id="eliminando-elementos-do-gráfico" class="section level2" number="9.3">
<h2 number="9.3"><span class="header-section-number">9.3</span> Eliminando elementos do gráfico</h2>
<p>Como eu disse, você muitas vezes vai querer eliminar elementos desnecessários e que estão tomando muito espaço de seu gráfico. Para esta tarefa, basta utilizar <code>element_blank()</code> sobre o argumento de <code>theme()</code> que controla este elemento em questão. No exemplo abaixo, estou eliminando o título da legenda, que é controlada por <code>legend.title</code>, e também estou eliminando o título do eixo y com <code>axis.title.y</code>.</p>
<p></p>
<div class="sourceCode" id="cb964"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb964-1"><a href="#cb964-1" aria-hidden="true" tabindex="-1"></a>plot_exemplo <span class="sc">+</span></span>
<span id="cb964-2"><a href="#cb964-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb964-3"><a href="#cb964-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb964-4"><a href="#cb964-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>()</span>
<span id="cb964-5"><a href="#cb964-5" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="Introducao_R_files/figure-html/unnamed-chunk-531-1.png" width="60%" style="display: block; margin: auto;" /></p>
<p></p>
</div>
<div id="alterando-a-temática-de-textos" class="section level2" number="9.4">
<h2 number="9.4"><span class="header-section-number">9.4</span> Alterando a temática de textos</h2>
<p>Você possui diversos elementos textuais em seu gráfico, logo abaixo, na figura 9.1, estou relacionando cada elemento textual ao seu respectivo argumento em <code>theme()</code>. Vale ressaltar, que há outros elementos textuais, como o subtítulo do gráfico, que não está presente em nosso <code>plot_exemplo</code>. Portanto, até os próprios valores do eixo são tratados como textos do gráfico. Como mencionei antes, você precisa da função <code>element_text()</code> para configurar este tipo de elemento.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/theme_text.png" alt="Principais elementos textuais do gráfico e seus respectivos argumentos na função `theme()`" width="80%" />
<p class="caption">
(#fig:unnamed-chunk-532)Principais elementos textuais do gráfico e seus respectivos argumentos na função <code>theme()</code>
</p>
</div>
<p></p>
<p>Vamos pensar primeiro no título, que é uma parte importante de seu gráfico e que deve possuir algum tipo de destaque. Por enquanto, o único fator que destaca o título do gráfico dos outros elementos textuais, é o tamanho da fonte usada. Porém, e se quiséssemos adicionar outros fatores de destaque? Como por exemplo, utilizar uma fonte em itálico, ou em negrito.</p>
<p>O argumento de <code>theme()</code> responsável por controlar o título do gráfico, é o <code>plot.title</code>, e portanto, utilizo a função <code>element_text()</code> sobre este argumento, para acrescentarmos novos destaques a este título. O argumento de <code>element_text()</code> que afeta o estilo da fonte (negrito, itálico, etc.) é o <code>face</code>. No exemplo abaixo, eu dou o valor <code>"italic"</code> indicando a função que use o estilo itálico sobre o título:</p>
<p></p>
<div class="sourceCode" id="cb965"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb965-1"><a href="#cb965-1" aria-hidden="true" tabindex="-1"></a>plot_exemplo <span class="sc">+</span></span>
<span id="cb965-2"><a href="#cb965-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb965-3"><a href="#cb965-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;italic&quot;</span>)</span>
<span id="cb965-4"><a href="#cb965-4" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="Introducao_R_files/figure-html/unnamed-chunk-533-1.png" width="60%" style="display: block; margin: auto;" /></p>
<p></p>
<p>Eu posso também destacar outras áreas do gráfico, como o título da legenda, que é controlado pelo argumento <code>legend.title</code>. Eu costumo reduzir o tamanho deste título, e colocá-lo em negrito, e para isso, utilizo os argumentos <code>size</code> e <code>face</code>. Para colocar algum texto em negrito, você deve utilizar o valor <code>"bold"</code>, em <code>face</code>. Eu poderia inclusive, colocar este texto em itálico e negrito (para isso, você deve utilizar o valor <code>"bold.italic"</code>).</p>
<p>Vale também destacar, que o argumento <code>size</code>, trabalha por padrão com a unidade milímetros (mm). Porém, como é um pouco contraintuitivo trabalhar com tamanho de fontes nesta unidade, eu costumo transformá-la para pontos (pt). Para isso, o <code>ggplot</code> oferece uma variável (<code>.pt</code>) que já contém o valor necessário para essa transformação. Assim, o que você precisa fazer é colocar o valor em pontos (pt) desejado, e dividi-lo por essa variável (<code>.pt</code>), que contém o valor necessário para a conversão. No exemplo abaixo, estou reduzindo o título da legenda ao tamanho 26 pt.</p>
<p></p>
<div class="sourceCode" id="cb966"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb966-1"><a href="#cb966-1" aria-hidden="true" tabindex="-1"></a>plot_exemplo <span class="sc">+</span></span>
<span id="cb966-2"><a href="#cb966-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb966-3"><a href="#cb966-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;italic&quot;</span>),</span>
<span id="cb966-4"><a href="#cb966-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>, <span class="at">size =</span> <span class="dv">26</span><span class="sc">/</span>.pt)</span>
<span id="cb966-5"><a href="#cb966-5" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="Introducao_R_files/figure-html/unnamed-chunk-534-1.png" width="60%" style="display: block; margin: auto;" /></p>
<p></p>
<p>Além destas modificações, você talvez queira mudar o alinhamento do título do gráfico. Atualmente, você pode reparar que este título está alinhado à esquerda do gráfico, ou em outras palavras, está alinhado em relação a borda esquerda do gráfico.</p>
<p>Neste caso, estou me referindo ao alinhamento horizontal do título, e por isso, utilizo o argumento <code>hjust</code>. Este argumento funciona da mesma forma em que o vimos anteriormente, ele pega um número de 0 a 1. Sendo que o valor 0 representa o alinhamento totalmente à esquerda, o valor 0.5 centraliza o texto, e o valor 1 representa o alinhamento totalmente à direita. No exemplo abaixo, estou centralizando o título do gráfico.</p>
<p></p>
<div class="sourceCode" id="cb967"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb967-1"><a href="#cb967-1" aria-hidden="true" tabindex="-1"></a>plot_exemplo <span class="sc">+</span></span>
<span id="cb967-2"><a href="#cb967-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb967-3"><a href="#cb967-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;italic&quot;</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb967-4"><a href="#cb967-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>, <span class="at">size =</span> <span class="dv">26</span><span class="sc">/</span>.pt)</span>
<span id="cb967-5"><a href="#cb967-5" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="Introducao_R_files/figure-html/unnamed-chunk-535-1.png" width="60%" style="display: block; margin: auto;" /></p>
<p></p>
<p>Um outro ponto, que talvez seja de seu interesse, é alterar o espaço entre os elementos do gráfico. Você pode controlar este fator, através da função <code>margin()</code>, sobre o argumento <code>margin</code> de <code>element_text()</code>. Dentro da função <code>margin()</code>, temos 4 argumentos que se referem as bordas do seu texto. Dito de outra forma, esses argumentos definem a borda do texto, na qual você deseja acrescentar o espaço: <code>t</code> (<em>top</em>) se refere ao topo do texto; <code>r</code> (<em>right</em>) se refere à direita do texto; <code>l</code> (<em>left</em>) se refere à esquerda do texto; e <code>b</code> (<em>bottom</em>) se refere à base (ou a borda inferior) do texto.</p>
<p>Por exemplo, podemos dar mais destaque ao título do gráfico, ao adicionar um pouco mais de espaço entre ele e a borda do gráfico. Neste caso, o gráfico está abaixo do título, logo, estamos querendo adicionar espaço na borda inferior (argumento <code>b</code>) do título do gráfico. Em seguida, basta que eu defina no argumento, quanto de espaço eu desejo adicionar.</p>
<p></p>
<div class="sourceCode" id="cb968"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb968-1"><a href="#cb968-1" aria-hidden="true" tabindex="-1"></a>plot_exemplo <span class="sc">+</span></span>
<span id="cb968-2"><a href="#cb968-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb968-3"><a href="#cb968-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(</span>
<span id="cb968-4"><a href="#cb968-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">face =</span> <span class="st">&quot;italic&quot;</span>,</span>
<span id="cb968-5"><a href="#cb968-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">hjust =</span> <span class="fl">0.5</span>,</span>
<span id="cb968-6"><a href="#cb968-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">b =</span> <span class="dv">20</span>)</span>
<span id="cb968-7"><a href="#cb968-7" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb968-8"><a href="#cb968-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>, <span class="at">size =</span> <span class="dv">26</span><span class="sc">/</span>.pt)</span>
<span id="cb968-9"><a href="#cb968-9" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="Introducao_R_files/figure-html/unnamed-chunk-536-1.png" width="60%" style="display: block; margin: auto;" /></p>
<p></p>
</div>
<div id="plano-de-fundo-background-e-grid" class="section level2" number="9.5">
<h2 number="9.5"><span class="header-section-number">9.5</span> Plano de fundo (<em>background</em>) e <em>grid</em></h2>
<p>O tema padrão do <code>ggplot</code> pode ser muito esquisito, ou simplesmente “feio” para muita gente. Um de seus elementos que mais recebem críticas, é o plano de fundo do gráfico, que por padrão é colorido de cinza claro. Todos os argumentos de <code>theme()</code>, que controlam os elementos que se encontram no plano de fundo, começam por <code>panel.*</code>. Você pode, por exemplo, alterar as configurações gerais do plano de fundo pelo argumento <code>panel.background</code>, que é associado ao tipo “retângulo” - <code>element_rect()</code>.</p>
<p>No exemplo abaixo, estou alterando a cor deste plano de fundo, para uma cor levemente “amarelada.” Lembra quando eu defini que o <code>ggplot</code> trata de forma distinta as formas geométricas de área, onde se você quisesse preencher esta forma com uma cor, você deveria utilizar o argumento <code>fill</code>, ao invés de <code>color</code>? Aqui a mesma coisa ocorre, pois o plano de fundo do gráfico é associado a um formato de área (retângulo).</p>
<p>Por isso, se utilizar o <code>color</code>, você irá colorir apenas as bordas do gráfico, e não preencher o plano de fundo com uma cor. Em ambos argumentos, você pode fornecer um dos nomes de cor que o R consegue reconhecer (por exemplo, <code>"white", "black"</code>)<a href="#fn32" class="footnote-ref" id="fnref32"><sup>32</sup></a>, ou então, você pode fornecer um código HTML dessa cor.</p>
<p></p>
<div class="sourceCode" id="cb969"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb969-1"><a href="#cb969-1" aria-hidden="true" tabindex="-1"></a>plot_exemplo <span class="sc">+</span></span>
<span id="cb969-2"><a href="#cb969-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb969-3"><a href="#cb969-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;#fffab3&quot;</span>)</span>
<span id="cb969-4"><a href="#cb969-4" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="Introducao_R_files/figure-html/unnamed-chunk-537-1.png" width="60%" style="display: block; margin: auto;" /></p>
<p></p>
<p>Se antes você não gostava do cinza, você provavelmente está gostando menos ainda dessa cor amarelada. Bem, neste caso podemos ficar então mudar para um branco padrão. Vale destacar que, as linhas do <em>grid</em> já estão na cor branca, por isso, podemos colorir também essas linhas para uma cor diferente, de modo a mantê-las visíveis.</p>
<p></p>
<div class="sourceCode" id="cb970"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb970-1"><a href="#cb970-1" aria-hidden="true" tabindex="-1"></a>plot_exemplo <span class="sc">+</span></span>
<span id="cb970-2"><a href="#cb970-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb970-3"><a href="#cb970-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;white&quot;</span>),</span>
<span id="cb970-4"><a href="#cb970-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;#d4d4d4&quot;</span>)</span>
<span id="cb970-5"><a href="#cb970-5" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="Introducao_R_files/figure-html/unnamed-chunk-538-1.png" width="60%" style="display: block; margin: auto;" /></p>
<p></p>
<p>Apesar do gráfico estar agora em um tema mais “padrão,” você talvez você ache estranho a forma como as linhas do <em>grid</em> estão no momento. Pois elas estão sem um “limite,” ou aparentam estar “invadindo” o espaço de outros elementos do gráfico. Talvez o que você precise, seja marcar a borda do gráfico, para construir uma caixa, e definir estes limites do <em>grid</em>. Tudo que você precisa fazer, é usar o <code>color</code> em <code>panel.background</code>, para colorir essas bordas.</p>
<p></p>
<div class="sourceCode" id="cb971"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb971-1"><a href="#cb971-1" aria-hidden="true" tabindex="-1"></a>plot_exemplo <span class="sc">+</span></span>
<span id="cb971-2"><a href="#cb971-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb971-3"><a href="#cb971-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.background =</span> <span class="fu">element_rect</span>(</span>
<span id="cb971-4"><a href="#cb971-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">fill =</span> <span class="st">&quot;white&quot;</span>,</span>
<span id="cb971-5"><a href="#cb971-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">&quot;#222222&quot;</span></span>
<span id="cb971-6"><a href="#cb971-6" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb971-7"><a href="#cb971-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;#d4d4d4&quot;</span>)</span>
<span id="cb971-8"><a href="#cb971-8" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="Introducao_R_files/figure-html/unnamed-chunk-539-1.png" width="60%" style="display: block; margin: auto;" /></p>
<p></p>
<p>Um outro componente que faz parte do gráfico, é o plano de fundo de toda a área do gráfico. Ou seja, toda a área de sua tela que engloba os títulos, os valores, as legendas e o espaço do gráfico. Essa área é controlada pelo argumento <code>plot.background</code>. Não sei por que você faria isso, mas com esse argumento, você pode por exemplo, pintar toda a área do gráfico de azul claro.</p>
<p></p>
<div class="sourceCode" id="cb972"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb972-1"><a href="#cb972-1" aria-hidden="true" tabindex="-1"></a>plot_exemplo <span class="sc">+</span></span>
<span id="cb972-2"><a href="#cb972-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb972-3"><a href="#cb972-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.background =</span> <span class="fu">element_rect</span>(</span>
<span id="cb972-4"><a href="#cb972-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">fill =</span> <span class="st">&quot;white&quot;</span>,</span>
<span id="cb972-5"><a href="#cb972-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">&quot;#222222&quot;</span></span>
<span id="cb972-6"><a href="#cb972-6" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb972-7"><a href="#cb972-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;#d4d4d4&quot;</span>),</span>
<span id="cb972-8"><a href="#cb972-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;#abb3ff&quot;</span>)</span>
<span id="cb972-9"><a href="#cb972-9" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="Introducao_R_files/figure-html/unnamed-chunk-540-1.png" width="60%" style="display: block; margin: auto;" /></p>
<p></p>
</div>
<div id="eixos-do-gráfico" class="section level2" number="9.6">
<h2 number="9.6"><span class="header-section-number">9.6</span> Eixos do gráfico</h2>
<p>Todos os elementos que se encontram nos eixos do gráfico, são controlados pelos argumentos de <code>theme()</code> que se iniciam por <code>axis.*</code>. Você pode ver os argumentos que controlam cada um dos componentes do eixo, pela figura abaixo.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/axis_theme.png" alt="Elementos que compõe um eixo do gráfico" width="60%" />
<p class="caption">
(#fig:unnamed-chunk-541)Elementos que compõe um eixo do gráfico
</p>
</div>
<p></p>
<p>No tema padrão do <code>ggplot</code>, a linha do eixo (<code>axis.line</code>) já não aparece. Portanto, se você quiser eliminar completamente um eixo do seu gráfico, você precisa apagar apenas os outros três componentes. Sendo este, um outro motivo de estranhamento de várias pessoas sobre o tema padrão do <code>ggplot</code>. Por isso, talvez seja interessante para você incluir no seu gráfico, as linhas do eixo, e para esse fim, basta redefinir o seu argumento (<code>axis.line</code>) com <code>element_line()</code>.</p>
<p>Um detalhe muito importante, é que a função <code>theme()</code> possui tanto o argumento geral do componente do eixo (e.g. <code>axis.line</code>), que afeta ambos os eixos (x e y) ao mesmo tempo, quanto o argumento que afeta os eixos individualmente (e.g. <code>axis.line.x</code> e <code>axis.line.y</code>). Isso vale para todos os outros três componentes do eixo, e, portanto, caso você queira que a modificação afete apenas um dos eixos, você deve utilizar os argumentos que possuem o eixo no nome, ao invés dos argumentos gerais.</p>
<p>Uma configuração que aplico com bastante frequência em meus gráficos, é escurecer os valores do eixo (<code>axis.text</code>). Por padrão, os valores vem em um cinza claro, e por causa disso, a leitura desses valores pode ficar muito prejudicada ao exportar esse gráfico, e incluí-lo em um artigo, informativo ou relatório que estou escrevendo. Desse modo, no exemplo abaixo, além de reposicionar as linhas dos eixos, eu também utilizo o argumento <code>color</code> em <code>axis.text</code>, para colorir esses valores com uma cor mais escura.</p>
<p>Além dessas modificações, para garantir que o meu leitor consiga ler esses números, eu ainda aumento levemente o tamanho dos valores do eixo, pelo argumento <code>size</code>. Como eu disse anteriormente, esse argumento trabalha, por padrão, com milímetros. Você pode novamente utilizar a variável <code>.pt</code> para transformar esse valor para pontos (pt).</p>
<p></p>
<div class="sourceCode" id="cb973"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb973-1"><a href="#cb973-1" aria-hidden="true" tabindex="-1"></a>plot_exemplo <span class="sc">+</span></span>
<span id="cb973-2"><a href="#cb973-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb973-3"><a href="#cb973-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">size =</span> <span class="fl">0.8</span>, <span class="at">color =</span> <span class="st">&quot;#222222&quot;</span>),</span>
<span id="cb973-4"><a href="#cb973-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">color =</span> <span class="st">&quot;#222222&quot;</span>)</span>
<span id="cb973-5"><a href="#cb973-5" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="Introducao_R_files/figure-html/unnamed-chunk-542-1.png" width="60%" style="display: block; margin: auto;" /></p>
<p></p>
</div>
<div id="configurações-temáticas-em-uma-legenda" class="section level2" number="9.7">
<h2 number="9.7"><span class="header-section-number">9.7</span> Configurações temáticas em uma legenda</h2>
<p>A legenda de seu gráfico, é um guia que lhe mostra como os elementos visuais percebidos em seu gráfico, se traduzem de volta aos valores observados em sua base de dados. Em outras palavras, é a legenda que mapeia as cores, formas e tamanhos dos elementos de seu gráfico, de volta aos valores apresentados em sua base de dados <span class="citation">(<a href="#ref-wilkinson" role="doc-biblioref">Wilkinson 2005</a>; <a href="#ref-wickham2016" role="doc-biblioref">Wickham 2016</a>)</span>. Sem a legenda, nós não sabemos qual o valor que a cor vermelha em nosso gráfico se refere, nem quanto o tamanho de um objeto, representa em nível de uma variável numérica.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/legendas_theme.png" alt="Itens que compõe uma legenda" width="80%" />
<p class="caption">
(#fig:unnamed-chunk-543)Itens que compõe uma legenda
</p>
</div>
<p></p>
<p>Temos na figura 9.3, os componentes de uma legenda em um gráfico do <code>ggplot</code>, e os seus respectivos argumentos em <code>theme()</code>. Há outros argumentos relacionados em <code>theme()</code>, como <code>legend.text.align</code>, <code>legend.margin</code> e <code>legend.position</code>, que não afetam a temática de algum componente específico da legenda, mas sim, o alinhamento de certos componentes, ou a margem da legenda em relação ao gráfico, ou a posição geral da legenda.</p>
<p>Como exemplo, podemos preencher o plano de fundo da legenda com alguma cor específica em <code>legend.background</code> (argumento <code>fill</code>), assim como podemos contornar as bordas dessa legenda com alguma outra cor (argumento <code>color</code>). Podemos alterar o alinhamento do texto da legenda, ou mais especificamente, os rótulos de cada item da legenda, através de <code>legend.text.align</code>, ao fornecermos um número entre 0 (alinhado totalmente à esquerda) e 1 (alinhado totalmente à direita). Também podemos utilizar a função <code>element_text()</code> em <code>legend.title</code>, para alterarmos a fonte (argumento <code>family</code>), o tamanho (argumento <code>size</code>) o estilo da fonte (argumento <code>face</code>: <code>bold</code> - negrito, <code>italic</code> - itálico, <code>bold.italic</code> - negrito e itálico), e inclusive a cor (argumento <code>color</code>) utilizada no título dessa legenda.</p>
<p>Além dessas configurações, possuímos um bom controle sobre a posição da legenda ao longo da área do gráfico, através do argumento <code>legend.position</code>. Por padrão, toda legenda gerada pelo <code>ggplot</code>, será posicionada à direita do gráfico, entretanto, esse padrão tende a ocupar muito espaço do gráfico, por isso eu particularmente prefiro posicionar as minhas legendas, na parte inferior do gráfico. Para isso podemos fornecer o valor <code>bottom</code> ao argumento. O argumento <code>legend.position</code>, aceita outros quatro valores pré-definidos: <code>top</code> (topo do gráfico); <code>left</code> (esquerda do gráfico); <code>right</code> (direita do gráfico); <code>none</code> (nenhum local do gráfico).</p>
<p>Você pode utilizar o valor pré-definido <code>none</code> em <code>legend.position</code>, para eliminar completamente a legenda do gráfico. Isso é uma boa forma de aumentar o espaço do gráfico, porém, você elimina uma fonte importante de informação, portanto, considere com cuidado se as informações dispostas em sua legenda, são irrelevantes para o seu gráfico. Para além das posições pré-definidas, podemos inclusive posicionar a nossa legenda, para dentro do gráfico, através de <code>legend.position</code>. Para isso, você precisa fornecer dentro de um vetor, a posição (x, y) no plano cartesiano em que você deseja centralizar a sua legenda, de acordo com um valor entre 0 e 1. Você pode interpretar esse sistema, como percentis da distribuição dos valores presentes no eixo. Ou seja, se você fornecer o vetor <code>c(0.1, 0.9)</code>, a legenda será posicionada no 10° percentil da escala do eixo x, e no 90° percentil da escala do eixo y.</p>
<p></p>
<div class="sourceCode" id="cb974"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb974-1"><a href="#cb974-1" aria-hidden="true" tabindex="-1"></a>plot_exemplo <span class="sc">+</span> <span class="fu">theme</span>(</span>
<span id="cb974-2"><a href="#cb974-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">legend.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;#cffff0&quot;</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>),</span>
<span id="cb974-3"><a href="#cb974-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">legend.text.align =</span> <span class="fl">0.5</span>,</span>
<span id="cb974-4"><a href="#cb974-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>, <span class="at">color =</span> <span class="st">&quot;#008059&quot;</span>),</span>
<span id="cb974-5"><a href="#cb974-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## Warning: Removed 2 rows containing missing values (geom_point).</code></pre>
<p><img src="Introducao_R_files/figure-html/unnamed-chunk-544-1.png" width="60%" style="display: block; margin: auto;" /></p>
<p></p>
<div style="page-break-after: always;"></div>
<p></p>
<div class="sourceCode" id="cb976"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb976-1"><a href="#cb976-1" aria-hidden="true" tabindex="-1"></a>plot_exemplo <span class="sc">+</span> <span class="fu">theme</span>(</span>
<span id="cb976-2"><a href="#cb976-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span></span>
<span id="cb976-3"><a href="#cb976-3" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## Warning: Removed 2 rows containing missing values (geom_point).</code></pre>
<p><img src="Introducao_R_files/figure-html/unnamed-chunk-545-1.png" width="60%" style="display: block; margin: auto;" /></p>
<p></p>
<p></p>
<div class="sourceCode" id="cb978"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb978-1"><a href="#cb978-1" aria-hidden="true" tabindex="-1"></a>plot_exemplo <span class="sc">+</span> <span class="fu">theme</span>(</span>
<span id="cb978-2"><a href="#cb978-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb978-3"><a href="#cb978-3" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## Warning: Removed 2 rows containing missing values (geom_point).</code></pre>
<p><img src="Introducao_R_files/figure-html/unnamed-chunk-546-1.png" width="60%" style="display: block; margin: auto;" /></p>
<p></p>
<div style="page-break-after: always;"></div>
<p></p>
<div class="sourceCode" id="cb980"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb980-1"><a href="#cb980-1" aria-hidden="true" tabindex="-1"></a>plot_exemplo <span class="sc">+</span> <span class="fu">theme</span>(</span>
<span id="cb980-2"><a href="#cb980-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.8</span>)</span>
<span id="cb980-3"><a href="#cb980-3" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## Warning: Removed 2 rows containing missing values (geom_point).</code></pre>
<p><img src="Introducao_R_files/figure-html/unnamed-chunk-547-1.png" width="60%" style="display: block; margin: auto;" /></p>
<p></p>
<p>Para mais, temos algumas outras configurações possíveis sobre a margem da legenda em relação à área gráfico, através do argumento <code>legend.margin</code> e da função <code>margin()</code>. Ou seja, nós podemos afastar a legenda da área do gráfico, ou da base do gráfico. Em outras palavras, nós podemos adicionar espaço na base (<code>b</code>), no topo (<code>t</code>), à direita (<code>r</code>), ou à esquerda (<code>l</code>) da legenda, através da função <code>margin()</code>.</p>
<p></p>
<div class="sourceCode" id="cb982"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb982-1"><a href="#cb982-1" aria-hidden="true" tabindex="-1"></a>plot_exemplo <span class="sc">+</span> <span class="fu">theme</span>(</span>
<span id="cb982-2"><a href="#cb982-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">legend.margin =</span> <span class="fu">margin</span>(<span class="at">l =</span> <span class="dv">90</span>, <span class="at">b =</span> <span class="dv">70</span>)</span>
<span id="cb982-3"><a href="#cb982-3" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## Warning: Removed 2 rows containing missing values (geom_point).</code></pre>
<p><img src="Introducao_R_files/figure-html/unnamed-chunk-548-1.png" width="60%" style="display: block; margin: auto;" /></p>
<p></p>
<p>Por último, nós também podemos configurar os itens da legenda, através do argumento <code>legend.key</code>. Neste argumento, você possui todas as opções de customização oferecidas pela função <code>element_rect()</code>. Além de preencher o plano de fundo dos itens (argumento <code>fill</code>), ou de criar uma borda (argumento <code>color</code>), também temos a opção de alterar o tamanho desses itens (argumento <code>size</code>).</p>
<p></p>
<div class="sourceCode" id="cb984"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb984-1"><a href="#cb984-1" aria-hidden="true" tabindex="-1"></a>plot_exemplo <span class="sc">+</span> <span class="fu">theme</span>(</span>
<span id="cb984-2"><a href="#cb984-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">legend.key =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;#c4e2ff&quot;</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>)</span>
<span id="cb984-3"><a href="#cb984-3" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## Warning: Removed 2 rows containing missing values (geom_point).</code></pre>
<p><img src="Introducao_R_files/figure-html/unnamed-chunk-549-1.png" width="60%" style="display: block; margin: auto;" /></p>
<p></p>
</div>
<div id="alterando-a-temática-em-facetas" class="section level2" number="9.8">
<h2 number="9.8"><span class="header-section-number">9.8</span> Alterando a temática em facetas</h2>
<p>Quando você adiciona facetas a um gráfico, você possui novos elementos que talvez sejam de seu interesse configurá-los. Por exemplo, o título de cada faceta, ou o plano de fundo desse título. Todos os argumentos de <code>theme()</code> que controlam elementos das facetas do gráfico, começam por <code>strip.*</code>. No exemplo abaixo, eu estou redefinindo as cores do interior e das bordas do plano de fundo da faceta, além da cor do título da faceta.</p>
<p></p>
<div class="sourceCode" id="cb986"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb986-1"><a href="#cb986-1" aria-hidden="true" tabindex="-1"></a>plot_exemplo <span class="sc">+</span></span>
<span id="cb986-2"><a href="#cb986-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>island, <span class="at">nrow =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb986-3"><a href="#cb986-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb986-4"><a href="#cb986-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">&quot;#222222&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;#d1fff4&quot;</span>),</span>
<span id="cb986-5"><a href="#cb986-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>)</span>
<span id="cb986-6"><a href="#cb986-6" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="Introducao_R_files/figure-html/unnamed-chunk-550-1.png" width="60%" style="display: block; margin: auto;" /></p>
<p></p>
</div>
<div id="alterando-as-fontes-do-seu-gráfico" class="section level2" number="9.9">
<h2 number="9.9"><span class="header-section-number">9.9</span> Alterando as fontes do seu gráfico</h2>
<p>Este é provavelmente o tópico de maior interesse para você ao customizar os seus gráficos, pois você sabe muito bem o potencial impacto que a tipografia pode gerar sobre ele. Eu separei uma seção para discutir apenas esse assunto, pois como você descobrirá bem cedo, inserir fontes de seu sistema (ou fontes customizadas) em seu gráfico pode ser uma dor de cabeça bem grande.</p>
<p>Essa dificuldade ocorre em qualquer programa<a href="#fn33" class="footnote-ref" id="fnref33"><sup>33</sup></a>, linguagem ou sistema que trabalha com diversos <em>device</em>’s gráficos, como é o caso do R. Como comentamos na seção <a href="#sec:devices_graficos">Exportando os seus gráficos do ggplot</a>, um <em>device</em> gráfico é a <em>engine</em> que vai gerar o arquivo de imagem, onde o seu gráfico será guardado. Diferentes <em>engine</em>’s, geram um arquivo de tipo diferente, como <code>.png</code>, ou <code>.jpeg</code>, ou <code>.tiff</code>, ou um arquivo <code>.pdf</code>. Ou seja, cada um desses formatos de arquivo, utilizam um <em>device</em> gráfico diferente para construir o arquivo que irá guardar o seu gráfico.</p>
<p>Antes de definirmos os problemas existentes, e explicar quais são os processos necessários, para que você possa utilizar qualquer fonte que esteja em sua máquina, em seus gráficos do <code>ggplot</code>. Eu vou mostrar quais são as três opções de fonte, que são garantidas de funcionar em seus gráficos do <code>ggplot</code>, e em qualquer máquina. Essas três opções são:</p>
<ol style="list-style-type: decimal">
<li><p><code>sans</code>: Fonte Arial.</p></li>
<li><p><code>serif</code>: Fonte Times New Roman.</p></li>
<li><p><code>mono</code>: Fonte Courier New.</p></li>
</ol>
<p>Portanto, em qualquer máquina que você estiver, você pode utilizar um desses três nomes (<code>sans</code>, <code>serif</code> e <code>mono</code>) para se referir a uma dessas três fontes acima, em seu gráfico do <code>ggplot</code>. Se você quer utilizar diferentes fontes ao longo dos dados mostrados em seu gráfico, você deve definir como essas fontes utilizadas, vão variar ao longo do gráfico, através da função <code>aes()</code>. Mais especificamente, você deve utilizar o argumento <code>family</code> na função <code>aes()</code>, dentro das funções que estão desenhando os textos em seu gráfico, de acordo com os dados presentes em sua tabela, como as funções <code>geom_text()</code> e <code>geom_label()</code>. Ou seja, não estamos falando do tema do gráfico, e sim dos pontos que representam os seus dados no plano cartesiano. Um exemplo de uso dessa ideia, é mostrado logo abaixo.</p>
<p>Neste momento, você deve pensar se você deseja variar as fontes utilizadas ao longo do gráfico, ou se você quer manter ela fixa, ou em outras palavras, que uma mesma fonte seja utilizada em todos os rótulos e textos dispostos no gráfico. Se você quer variar a fonte, você deve criar uma nova variável em sua tabela, contendo os nomes dessas fontes, e em seguida, conectar essa variável ao argumento <code>family</code>, dentro de <code>aes()</code>. Mas se você quer manter essa fonte fixa, basta fornecer o nome dela à <code>family</code>, fora de <code>aes()</code>.</p>
<p></p>
<div class="sourceCode" id="cb987"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb987-1"><a href="#cb987-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb987-2"><a href="#cb987-2" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb987-3"><a href="#cb987-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">rnorm</span>(<span class="dv">100</span>),</span>
<span id="cb987-4"><a href="#cb987-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="fu">runif</span>(<span class="dv">100</span>),</span>
<span id="cb987-5"><a href="#cb987-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">fonte =</span> <span class="fu">sample</span>(</span>
<span id="cb987-6"><a href="#cb987-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">&quot;sans&quot;</span>, <span class="st">&quot;serif&quot;</span>, <span class="st">&quot;mono&quot;</span>),</span>
<span id="cb987-7"><a href="#cb987-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">100</span>,</span>
<span id="cb987-8"><a href="#cb987-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">replace =</span> <span class="cn">TRUE</span></span>
<span id="cb987-9"><a href="#cb987-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb987-10"><a href="#cb987-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb987-11"><a href="#cb987-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb987-12"><a href="#cb987-12" aria-hidden="true" tabindex="-1"></a><span class="do">### Variar a fonte utilizada ao longo do gráfico</span></span>
<span id="cb987-13"><a href="#cb987-13" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(tab) <span class="sc">+</span></span>
<span id="cb987-14"><a href="#cb987-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb987-15"><a href="#cb987-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">family =</span> fonte, <span class="at">label =</span> fonte)</span>
<span id="cb987-16"><a href="#cb987-16" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="Introducao_R_files/figure-html/unnamed-chunk-551-1.png" width="60%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb988"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb988-1"><a href="#cb988-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Ou mater a fonte fixa ao longo de todo o gráfico</span></span>
<span id="cb988-2"><a href="#cb988-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(tab) <span class="sc">+</span></span>
<span id="cb988-3"><a href="#cb988-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb988-4"><a href="#cb988-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">label =</span> fonte),</span>
<span id="cb988-5"><a href="#cb988-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="st">&quot;serif&quot;</span></span>
<span id="cb988-6"><a href="#cb988-6" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="Introducao_R_files/figure-html/unnamed-chunk-551-2.png" width="60%" style="display: block; margin: auto;" /></p>
<p></p>
<p>Portanto, é dessa forma que podemos definir a fonte utilizada nas funções <code>geom</code> que representam os nossos dados no gráfico. Entretanto, para alterarmos a fonte em elementos temáticos (elementos que não dizem respeito, ou que não estão diretamente conectados com os seus dados) do gráfico, essas configurações devem ser realizadas dentro da função <code>theme</code>. Basta utilizarmos o argumento <code>family</code> presente em <code>element_text()</code>, e definirmos o nome da fonte que desejamos empregar.</p>
<p>Um atalho útil, caso você deseja utilizar a mesma fonte em todos os elementos temáticos do gráfico, se trata do argumento <code>text</code> (que se refere a todos os elementos temáticos do tipo “texto”) na função <code>theme()</code>, e definir com a função <code>element_text()</code> a fonte utilizada. Ou seja, basta adicionar a seguinte estrutura dentro de <code>theme()</code>: <code>text = element_text(family = &lt;fonte&gt;)</code>. Porém, caso você deseja utilizar uma fonte diferente em cada componente temático do gráfico, você obrigatoriamente deve definir separadamente a fonte a ser utilizada, em cada argumento de <code>theme()</code> que corresponde a esses componentes estéticos.</p>
<p></p>
<div class="sourceCode" id="cb989"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb989-1"><a href="#cb989-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(tab) <span class="sc">+</span></span>
<span id="cb989-2"><a href="#cb989-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb989-3"><a href="#cb989-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb989-4"><a href="#cb989-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Um título interessante&quot;</span>,</span>
<span id="cb989-5"><a href="#cb989-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">&quot;Um subtítulo também interessante&quot;</span></span>
<span id="cb989-6"><a href="#cb989-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb989-7"><a href="#cb989-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb989-8"><a href="#cb989-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">&quot;serif&quot;</span>),</span>
<span id="cb989-9"><a href="#cb989-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">&quot;mono&quot;</span>),</span>
<span id="cb989-10"><a href="#cb989-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">&quot;serif&quot;</span>)</span>
<span id="cb989-11"><a href="#cb989-11" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="Introducao_R_files/figure-html/unnamed-chunk-552-1.png" width="60%" style="display: block; margin: auto;" /></p>
<p></p>
<div id="importando-novas-fontes-para-o-r" class="section level3" number="9.9.1">
<h3 number="9.9.1"><span class="header-section-number">9.9.1</span> Importando novas fontes para o R</h3>
<blockquote>
<p>“At its core text and fonts are just very messy, with differences between operating systems and font file formats to name some of the challenges.” <span class="citation">(<a href="#ref-pedersen2020" role="doc-biblioref">Pedersen 2020</a>)</span>.</p>
</blockquote>
<p>Agora que vimos como implementar o que o <code>ggplot</code>e o R oferecem já de “fábrica” ao usuário, vou explicar como podemos expandir para as demais fontes presentes em sua máquina. Para isso, você irá precisar de pacotes que facilitam esse processo, sendo o principal deles, o <code>extrafont</code>. É importante destacar, que o métodos que vou explicar aqui, permite o uso apenas de fontes <em>TrueType</em>, ou em outras palavras, fontes onde o seu arquivo possui a extensão <code>.ttf</code>. Tendo essas considerações em mente, se você não possui este pacote instalado no seu computador, você deve rodar o comando abaixo.</p>
<p></p>
<div class="sourceCode" id="cb990"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb990-1"><a href="#cb990-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;extrafont&quot;</span>)</span></code></pre></div>
<p></p>
<p>Uma das dificuldades no uso de diferentes fontes no R, é encontrar os arquivos dessas fontes. Pois a forma e o local em que os arquivos dessas fontes estão guardados, varia ao longo dos sistemas operacionais. Além disso, também não há um padrão definido no nome desses arquivos. Mais especificamente, existe uma forma de interpretarmos as classes e famílias de cada fonte, porém, não há um padrão muito bem definido de como os arquivos dessas fontes deveriam ser nomeados para tal processo. Logo, os nomes dos arquivos dessa fonte, podem gerar incongruências e conflitos com os arquivos de outras fontes, e com isso, o R talvez não consiga diferenciar uma fonte da outra.</p>
<p>Um outro grande problema, está no fato de que cada <em>device</em> gráfico, possui em geral, exigências diferentes quanto aos arquivos dessas fontes. Por exemplo, as <em>engines</em> que produzem arquivos PDF, precisam obrigatoriamente de um arquivo <code>.afm</code> (<em>Adobe Font Metrics File</em>) para cada fonte utilizada, e você muito provavelmente não possui tal arquivo <span class="citation">(<a href="#ref-qiu2015" role="doc-biblioref">Qiu 2015</a>)</span>.</p>
<p>Esses dois problemas podem ser resolvidos com o uso das funções provenientes do pacote <code>extrafont</code>. Tendo isso em mente, a primeira coisa que você deve fazer, <strong>sempre</strong> que for definir a localização de uma nova fonte que você acabou de baixar da internet, ou de uma fonte que já está instalada no seu sistema operacional, é <strong>reiniciar o R</strong>. No RStudio, você possui o atalho <code>Ctrl + Shift + F10</code>, ou então se preferir, você pode ir à aba <code>Session</code>, e escolher a opção <code>Restart R</code>.</p>
<p>Muitas vezes o processo que vamos executar a seguir, falha de alguma forma caso você já tenha outros pacotes conectados a sua sessão atual. Devido a isso, é importante que você inicie o processo com uma sessão limpa. Após reiniciar o R, chame pelo pacote <code>extrafont</code> com a função <code>library()</code>.</p>
<p></p>
<div class="sourceCode" id="cb991"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb991-1"><a href="#cb991-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(extrafont)</span></code></pre></div>
<pre><code>## Registering fonts with R</code></pre>
<p></p>
<p>O que vamos fazer a seguir, é “importar” as fontes para uma base de dados, ou dito de outra forma, vamos guardar a localização dos arquivos dessas fontes, em um local que seja de fácil acesso ao R. Logo, o papel que o pacote <code>extrafont</code> vai desempenhar, será construir uma planilha onde ele irá guardar a localização desses arquivos, e diversas outras informações como o nome e a classe de cada fonte. Assim, sempre que você precisar dessa fonte e chamar por ela, o R irá procurar pela localização dos arquivos dessa fonte, nessa base de dados criada por <code>extrafont</code>.</p>
<p>Para executar esse passo, você deve utilizar a função <code>font_import()</code>. Essa função procura automaticamente pelas fontes instaladas em seu sistema operacional. Eu trabalho com o Windows, que possui uma pasta específica onde ele guarda os arquivos de cada uma dessas fontes instaladas. Logo, ao rodar a função <code>font_import()</code> no Windows, ela irá procurar automaticamente por essa pasta. Mas caso a função, por algum motivo não estiver encontrando essa pasta, você pode tentar definir o caminho até essa pasta, direcionando assim a função. No caso do Windows, essa pasta fica na localização de seu computador definida abaixo.</p>
<p></p>
<div class="sourceCode" id="cb993"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb993-1"><a href="#cb993-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Pasta do Windows que contém</span></span>
<span id="cb993-2"><a href="#cb993-2" aria-hidden="true" tabindex="-1"></a><span class="do">### as fontes instaladas em seu sistema</span></span>
<span id="cb993-3"><a href="#cb993-3" aria-hidden="true" tabindex="-1"></a>C<span class="sc">:</span>\Windows\Fonts</span>
<span id="cb993-4"><a href="#cb993-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb993-5"><a href="#cb993-5" aria-hidden="true" tabindex="-1"></a><span class="do">### Basta fornecer este endereço no</span></span>
<span id="cb993-6"><a href="#cb993-6" aria-hidden="true" tabindex="-1"></a><span class="do">### argumento paths de font_import()</span></span>
<span id="cb993-7"><a href="#cb993-7" aria-hidden="true" tabindex="-1"></a><span class="fu">font_import</span>(<span class="at">paths =</span> <span class="st">&quot;C:/Windows/Fonts&quot;</span>)</span></code></pre></div>
<p></p>
<p>Ao rodar a função <code>font_import()</code> no console, ela irá lhe mostrar a mensagem abaixo, perguntando se você deseja continuar o processo. Para continuar, basta enviar para o console, a letra “y.” A partir daí, a função irá iniciar o processo, encontrando todas as fontes disponíveis em seu sistema, e guardando as informações dessas fontes.</p>
<p></p>
<div class="sourceCode" id="cb994"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb994-1"><a href="#cb994-1" aria-hidden="true" tabindex="-1"></a>Importing fonts may take a few minutes, depending on the number</span>
<span id="cb994-2"><a href="#cb994-2" aria-hidden="true" tabindex="-1"></a>of fonts and the speed of the system.</span>
<span id="cb994-3"><a href="#cb994-3" aria-hidden="true" tabindex="-1"></a>Continue? [y<span class="sc">/</span>n] </span></code></pre></div>
<p></p>
<p>Ao terminar o processo, você terá definido a localização dos arquivos e coletado as informações necessárias da fonte, e você não precisará realizar novamente este processo, pois essas informações estão salvas na base de dados criada por <code>extrafont</code>. Você irá rodar novamente a função <code>font_import()</code>, apenas no caso em que você quiser adicionar uma nova fonte, que não estava instalada anteriormente em seu sistema.</p>
<p>Apesar de já muito útil, você talvez queira mudar o comportamento da função <code>font_import()</code>, que vai procurar pelos arquivos presentes apenas na pasta principal de fontes de seu sistema operacional. Por exemplo, talvez você queira importar uma fonte que ainda não está instalada em seu computador, por exemplo, uma fonte que você acabou de baixar do <code>Google Fonts</code>.</p>
<p>Para essas ocasiões, eu recomendo que você instale essas fontes em seu sistema operacional, antes de prosseguir para os próximos passos. Após a instalação, você pode utilizar novamente o argumento <code>paths</code> da função, onde você pode definir a pasta na qual a função irá procurar pelos arquivos dessas fontes (arquivos com extensão <code>.ttf</code>) que você acaba de instalar. Eu no caso, recomendo que você crie uma pasta, e guarde nela todos os arquivos de fontes que você deseja importar. Por exemplo, eu tenho uma pasta onde guardo todas as fontes que baixo do <code>Google Fonts</code>, e portanto, caso eu queira importar uma nova fonte que eu acabei de baixar, para o R, eu coloco os arquivos dessa fonte dentro dessa pasta, e forneço o endereço dessa pasta para <code>font_import()</code>.</p>
<p></p>
<div class="sourceCode" id="cb995"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb995-1"><a href="#cb995-1" aria-hidden="true" tabindex="-1"></a><span class="fu">font_import</span>(<span class="at">paths =</span> <span class="st">&quot;C:/Users/Pedro/Downloads/Google Fonts&quot;</span>)</span></code></pre></div>
<p></p>
<p>Portanto, após esse passo, onde importamos essas fontes para o R, as fontes ainda não estão disponíveis para serem utilizadas no <code>ggplot</code>. Você até o momento, guardou as informações necessárias dessas fontes, mas ainda não forneceu essas informações ao R. Por isso, para utilizar as fontes que você salvou, você deve rodar a função <code>loadfonts()</code>, para “carregar” essas fontes para a sua sessão atual do R. É importante também destacar, que você deve <strong>sempre</strong> rodar essa função antes mesmo de chamar pelo pacote <code>ggplot2</code>, para evitar <em>bugs</em> indesejados.</p>
<p>Ou seja, em toda sessão no R, em que você estiver gerando um gráfico do <code>ggplot</code>, e deseja utilizar alguma fonte que já esteja registrada na planilha de <code>extrafont</code>, você muito provavelmente terá que reiniciar o R, chamar pelo pacote <code>extrafont</code>, e carregar as fontes salvas pela função <code>loadfonts()</code>, antes mesmo de chamar pelo pacote <code>ggplot2</code> e de recriar o seu gráfico. Apesar deste processo não ser sempre necessário, ele é em geral a opção mais segura. Após esse passo, você pode utilizar a fonte desejada normalmente em seu gráfico de <code>ggplot</code>, basta se referir a ela pelo seu nome nos argumentos <code>family</code>.</p>
<p></p>
<div class="sourceCode" id="cb996"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb996-1"><a href="#cb996-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(extrafont)</span>
<span id="cb996-2"><a href="#cb996-2" aria-hidden="true" tabindex="-1"></a><span class="fu">loadfonts</span>()</span>
<span id="cb996-3"><a href="#cb996-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb996-4"><a href="#cb996-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb996-5"><a href="#cb996-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb996-6"><a href="#cb996-6" aria-hidden="true" tabindex="-1"></a><span class="do">### O meu gráfico</span></span>
<span id="cb996-7"><a href="#cb996-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mpg) <span class="sc">+</span></span>
<span id="cb996-8"><a href="#cb996-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> displ, <span class="at">y =</span> hwy)) <span class="sc">+</span></span>
<span id="cb996-9"><a href="#cb996-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb996-10"><a href="#cb996-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">&quot;Segoe UI&quot;</span>),</span>
<span id="cb996-11"><a href="#cb996-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb996-12"><a href="#cb996-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb996-13"><a href="#cb996-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb996-14"><a href="#cb996-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Relação entre o volume do cilindro e o consumo de combustível&quot;</span>,</span>
<span id="cb996-15"><a href="#cb996-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">&quot;Baseado em uma amostra de 234 veículos&quot;</span></span>
<span id="cb996-16"><a href="#cb996-16" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p></p>
<p></p>
<p><img src="Figuras/fontes_personalizadas.png" width="60%" style="display: block; margin: auto;" /></p>
<p></p>
<p>Caso você não se lembre do nome exato da fonte que deseja, ao executar a função <code>fonts()</code>, você pode acessar uma lista que contém os nomes de todas as fontes que foram importadas para a sua sessão - através da função <code>loadfonts()</code>, e que, portanto, estão disponíveis para uso em sua sessão.</p>
<p>Depois desses passos, ao conseguir gerar o gráfico que você queria, utilizando as fontes que você desejava, será provavelmente de seu desejo, salvar esse gráfico, exportá-lo para algum arquivo. Você pode fazer isso normalmente pelos métodos que mostramos na seção <a href="#sec:devices_graficos">Exportando os seus gráficos do ggplot</a>, especialmente se você escolher exportar o seu gráfico, para algum tipo de arquivo <em>bitmap</em>, ou uma imagem do tipo <em>raster</em> (arquivos PNG, JPEG/JPG, BMP ou TIFF). Porém, se você escolheu exportar o seu gráfico para um arquivo PDF, você talvez enfrente alguns problemas, como as suas fontes desaparecerem do resultado!. Nós mostramos na seção <a href="#sec:cairo_pdf">Arquivos PDF e SVG</a>, como resolver esse problema, que envolve o uso da função <code>cairo_pdf()</code>.</p>
</div>
</div>
<div id="exercícios-7" class="section level2 unnumbered">
<h2 class="unnumbered">Exercícios</h2>
<p><strong>Questão 9.1.</strong> Voltando ao gráfico salvo no objeto <code>plot_exemplo</code>, o qual utilizamos ao longo de todo este capítulo. Seu objetivo nessa questão é criar um objeto <code>tema</code> que seja capaz de aproximar <code>plot_exemplo</code> o máximo possível do gráfico abaixo.</p>
<p></p>
<div class="sourceCode" id="cb997"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb997-1"><a href="#cb997-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb997-2"><a href="#cb997-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(palmerpenguins)</span>
<span id="cb997-3"><a href="#cb997-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb997-4"><a href="#cb997-4" aria-hidden="true" tabindex="-1"></a>plot_exemplo <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> penguins) <span class="sc">+</span></span>
<span id="cb997-5"><a href="#cb997-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb997-6"><a href="#cb997-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(</span>
<span id="cb997-7"><a href="#cb997-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> flipper_length_mm,</span>
<span id="cb997-8"><a href="#cb997-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> body_mass_g,</span>
<span id="cb997-9"><a href="#cb997-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> species)</span>
<span id="cb997-10"><a href="#cb997-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb997-11"><a href="#cb997-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb997-12"><a href="#cb997-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Relação entre peso e comprimento da nadadeira </span></span>
<span id="cb997-13"><a href="#cb997-13" aria-hidden="true" tabindex="-1"></a><span class="st">    em diferentes</span><span class="sc">\n</span><span class="st">espécies de pinguim&quot;</span>,</span>
<span id="cb997-14"><a href="#cb997-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Comprimento da nadadeira&quot;</span>,</span>
<span id="cb997-15"><a href="#cb997-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Peso corporal&quot;</span>,</span>
<span id="cb997-16"><a href="#cb997-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;Espécie&quot;</span></span>
<span id="cb997-17"><a href="#cb997-17" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb997-18"><a href="#cb997-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb997-19"><a href="#cb997-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb997-20"><a href="#cb997-20" aria-hidden="true" tabindex="-1"></a>tema <span class="ot">&lt;-</span> <span class="fu">theme</span>(</span>
<span id="cb997-21"><a href="#cb997-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Coloque as específicações necessárias</span></span>
<span id="cb997-22"><a href="#cb997-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># para que plot_exemplo se torne</span></span>
<span id="cb997-23"><a href="#cb997-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># o gráfico abaixo</span></span>
<span id="cb997-24"><a href="#cb997-24" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb997-25"><a href="#cb997-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb997-26"><a href="#cb997-26" aria-hidden="true" tabindex="-1"></a>plot_exemplo <span class="sc">+</span> tema</span></code></pre></div>
<p></p>
<p></p>
<pre><code>## Warning: Removed 2 rows containing missing values (geom_point).</code></pre>
<p><img src="Introducao_R_files/figure-html/unnamed-chunk-1077-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p></p>
<p><strong>Questão 9.2.</strong> Em cada item abaixo, vamos utilizar novamente o gráfico salvo no objeto <code>plot_exemplo</code>. Esses itens vão lhe questionar sobre algum erro específico, ou, lhe requisitar.</p>
<p>9.2.A) Faça a legenda do gráfico <code>plot_exemplo</code> desaparecer.</p>
<p>9.2.B) Identifique porque o erro abaixo ocorre, e tente corrigí-lo.</p>
<p></p>
<div class="sourceCode" id="cb999"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb999-1"><a href="#cb999-1" aria-hidden="true" tabindex="-1"></a>plot_exemplo <span class="sc">+</span></span>
<span id="cb999-2"><a href="#cb999-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb999-3"><a href="#cb999-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">&quot;#6E1450&quot;</span>),</span>
<span id="cb999-4"><a href="#cb999-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;#6E1450&quot;</span>)</span>
<span id="cb999-5"><a href="#cb999-5" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p></p>
<p>9.2.C) Contorne a área do <em>grid</em> (isto é, a área em que as formas geométricas do gráfico são desenhadas pela função <code>geom_*()</code>) por uma linha de cor <code>"#222222"</code>.</p>
<!--chapter:end:09-theme-ggplot.Rmd-->
</div>
</div>
<div id="part-ferramentas-para-tipos-específicos-de-dados" class="section level1 unnumbered">
<h1 class="unnumbered">(PART) Ferramentas para tipos específicos de dados</h1>
</div>
<div id="manipulação-e-transformação-de-strings-com-stringr" class="section level1" number="10">
<h1 number="10"><span class="header-section-number">10</span> Manipulação e transformação de <em>strings</em> com <code>stringr</code></h1>
<div id="sec:stringr_capitulo" class="section level2" number="10.1">
<h2 number="10.1"><span class="header-section-number">10.1</span> Introdução e pré-requisitos</h2>
<p>Neste capítulo, vamos aprender mais sobre operações especializadas em dados textuais (dados do tipo <code>character</code>), ou como são mais comumente denominados em programação, <em>strings</em>. Esse capítulo também oferece uma introdução a um dos principais e mais importantes tópicos em processamento de texto, as expressões regulares (<em>regular expression</em>), ou <em>regex</em> como é mais conhecida. Para aplicarmos as diversas operações expostas, vamos utilizar as funções disponíveis no pacote <code>stringr</code>. Esse pacote está incluso no <code>tidyverse</code>, logo, para ter acesso às funções apresentadas, você pode chamar pelo <code>tidyverse</code> ou pacote <code>stringr</code> diretamente, por meio do comando <code>library()</code>.</p>
<p></p>
<div class="sourceCode" id="cb1000"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1000-1"><a href="#cb1000-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb1000-2"><a href="#cb1000-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code></pre></div>
<p></p>
</div>
<div id="algumas-noções-básicas" class="section level2" number="10.2">
<h2 number="10.2"><span class="header-section-number">10.2</span> Algumas noções básicas</h2>
<p>Textos ou <em>strings</em> no R, são criados ao contornarmos um determinado texto por aspas (duplas - <code>"</code>, ou simples - <code>'</code>), e cada letra, espaço, símbolo ou número que compõe esse texto, é comumente denominado de caractere. Caso você se esqueça de fechar o par de aspas que contorna o seu texto, o R vai esperar até que você complete a expressão. Ou seja, em seu console, estaria acontecendo algo parecido com o que está abaixo. Lembre-se que você pode apertar a tecla <code>Esc</code>, para abortar a operação, caso você não consiga completá-la.</p>
<p></p>
<pre class="text"><code>&gt; x &lt;- &quot;Olá eu sou Pedro!
+ 
+ </code></pre>
<p></p>
<p>Como as aspas são responsáveis por delimitar esse tipo de dado, para que você possa incluir esse caractere em alguma cadeia de texto, você tem duas alternativas: 1) se você está contornando o texto com aspas duplas, utilize aspas simples, ou vice-versa; 2) contornar o comportamento especial das aspas, ao posicionar uma barra inclinada a esquerda antes de cada aspa (<code>\"</code> ou <code>\'</code>).</p>
<p></p>
<div class="sourceCode" id="cb1002"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1002-1"><a href="#cb1002-1" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;Olá! Esse é um texto qualquer&quot;</span></span></code></pre></div>
<pre><code>## [1] &quot;Olá! Esse é um texto qualquer&quot;</code></pre>
<div class="sourceCode" id="cb1004"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1004-1"><a href="#cb1004-1" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;Para incluir aspas (&#39;&#39;) em uma string&quot;</span></span></code></pre></div>
<pre><code>## [1] &quot;Para incluir aspas (&#39;&#39;) em uma string&quot;</code></pre>
<div class="sourceCode" id="cb1006"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1006-1"><a href="#cb1006-1" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;Será que </span><span class="sc">\&quot;</span><span class="st">alienígenas</span><span class="sc">\&quot;</span><span class="st"> existem de fato?&quot;</span></span></code></pre></div>
<pre><code>## [1] &quot;Será que \&quot;alienígenas\&quot; existem de fato?&quot;</code></pre>
<p></p>
<p>Além disso, textos podem incluir diversos outros caracteres especiais. Sendo os principais exemplos, os caracteres de tabulação (<code>\t</code>), e de quebra de linha (<code>\n</code>). Entretanto, uma quantidade muito grande desses caracteres especiais, podem dificultar a nossa compreensão do conteúdo presente em um texto. Logo, há vários momentos em que desejamos visualizar o texto representado em uma <em>string</em> de maneira “crua.” Para isso, podemos aplicar a função <code>writeLines()</code> sobre o texto em questão.</p>
<p></p>
<div class="sourceCode" id="cb1008"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1008-1"><a href="#cb1008-1" aria-hidden="true" tabindex="-1"></a>texto <span class="ot">&lt;-</span> <span class="st">&quot;Receita:</span><span class="sc">\n\t\t</span><span class="st">2 ovos</span><span class="sc">\n\t\t</span><span class="st">3 copos e meio de farinha</span></span>
<span id="cb1008-2"><a href="#cb1008-2" aria-hidden="true" tabindex="-1"></a><span class="sc">\t\t</span><span class="st">2 copos de achocolatado</span><span class="sc">\n\t\t</span><span class="st">1 copo de açúcar</span><span class="sc">\n\t\t</span><span class="st">Meio copo de óleo</span></span>
<span id="cb1008-3"><a href="#cb1008-3" aria-hidden="true" tabindex="-1"></a><span class="sc">\t\t</span><span class="st">1 colher (de sopa) de fermento</span></span>
<span id="cb1008-4"><a href="#cb1008-4" aria-hidden="true" tabindex="-1"></a><span class="sc">\t\t</span><span class="st">1 colher (de café) de bicabornato de sódio</span><span class="sc">\n\t\t</span><span class="st">...&quot;</span></span>
<span id="cb1008-5"><a href="#cb1008-5" aria-hidden="true" tabindex="-1"></a><span class="fu">writeLines</span>(texto)</span></code></pre></div>
<pre><code>## Receita:
##      2 ovos
##      3 copos e meio de farinha
##      2 copos de achocolatado
##      1 copo de açúcar
##      Meio copo de óleo
##      1 colher (de sopa) de fermento
##      1 colher (de café) de bicabornato de sódio
##      ...</code></pre>
<div class="sourceCode" id="cb1010"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1010-1"><a href="#cb1010-1" aria-hidden="true" tabindex="-1"></a>texto <span class="ot">&lt;-</span> <span class="st">&quot;Será que </span><span class="sc">\&quot;</span><span class="st">alienígenas</span><span class="sc">\&quot;</span><span class="st"> existem de fato?&quot;</span></span>
<span id="cb1010-2"><a href="#cb1010-2" aria-hidden="true" tabindex="-1"></a><span class="fu">writeLines</span>(texto)</span></code></pre></div>
<pre><code>## Será que &quot;alienígenas&quot; existem de fato?</code></pre>
<p></p>
<p>Outro exemplo clássico de caracteres especiais, que são muito encontrados em páginas da internet (e.g. dados coletados em operações de <em>web scrapping</em>), são os códigos hexadecimais ou <em>code points</em> correspondentes a uma determinada letra presente no sistema Unicode. Descrevemos brevemente na seção <a href="#sec:fontes_encoding_tipografia">Um pouco sobre fontes, encoding e tipografia</a>, a importância do Unicode para a universalização dos sistemas de <em>encoding</em>, e consequentemente, para a internacionalização de conteúdo.</p>
<p>Cada caractere no sistema Unicode, é representado por um <em>unicode code point</em> <span class="citation">(<a href="#ref-haralambous2007" role="doc-biblioref">Haralambous 2007</a>)</span>. Em resumo, um <em>code point</em> é um número inteiro que pode identificar unicamente um caractere presente no sistema Unicode. Porém, caracteres que são codificados nesse sistema, são normalmente representados pelo código hexadecimal que equivale ao seu respectivo <em>code point</em>. Logo, ao invés de um número específico, você normalmente irá encontrar em <em>strings</em>, códigos que se iniciam por <code>\u</code>, ou <code>\U</code>, ou ainda <code>U+</code>, seguidos por uma combinação específica de letras e números. Como exemplo, os códigos hexadecimais abaixo equivalem aos <em>code points</em> que formam a palavra “Arigatōgozaimashita,” ou “Muito obrigado” em japonês.</p>
<p></p>
<div class="sourceCode" id="cb1012"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1012-1"><a href="#cb1012-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="st">&quot;\u3042\u308a\u304c\u3068\u3046\u3054\u3056\u3044\u307e\u3057\u305f&quot;</span></span></code></pre></div>
<p></p>
<p>Um outro ponto muito importante em <em>strings</em> está no uso de barras inclinadas à esquerda. Nós já vimos na seção <a href="#sec:enderecos_disco_rigido">Definindo endereços do disco rígido no R</a>, que para representarmos uma barra inclinada à esquerda em uma <em>string</em> do R, precisarmos duplicar essa barra. Logo, em <em>strings</em>, a sequência <code>\\</code> significa para o R <code>\</code>. Existem alguns comandos e caracteres especiais que não requerem essa prática, como o comando que forma um <em>Unicode code point</em> (como demonstrado acima), que sempre se inicia por uma letra “u” antecedida por uma barra inclinada à esquerda (ex: <code>\u3042</code>). Um outro exemplo são os comandos para tabulações e quebra de linha que acabamos de mostrar (<code>\t</code> e <code>\n</code>). Entretanto, essas exceções são a minoria. Portanto, tenha esse cuidado ao utilizar barras inclinadas à esquerda em suas <em>strings</em>.</p>
</div>
<div id="concatenando-ou-combinando-strings-com-paste-e-str_c" class="section level2" number="10.3">
<h2 number="10.3"><span class="header-section-number">10.3</span> Concatenando ou combinando <em>strings</em> com <code>paste()</code> e <code>str_c()</code></h2>
<p>Concatenar, significa unir diferentes valores. Porém, essa união pode ocorrer de diferentes maneiras, e como ela ocorre, tende a depender das funções que você utiliza, como você as configura, e com quais tipos de estruturas você está trabalhando. Com isso, eu quero destacar, que o termo concatenar, pode se referir a muitas coisas (ou operações) diferentes. Na linguagem R, uma das principais operações de concatenação está presente na formação de vetores atômicos, mais especificamente, no uso da função <code>c()</code> (abreviação para <em>combine</em>), que introduzimos na seção de <a href="#sec:vetores_estrutura">Vetores</a>.</p>
<p>O papel da função <code>c()</code> é criar uma sequência a partir de um conjunto de valores. Essa sequência de valores, é o que forma um vetor, e é o que estabelece uma relação de dependência ou de união entre esses valores, pois os torna parte de uma mesma estrutura. Cada um deles possuem uma ordem, ou uma posição dentro dessa sequência, mas nenhum deles é capaz de gerar essa sequência sozinho.</p>
<p>Entretanto, ao concatenarmos textos, nós geralmente estamos nos referindo a uma operação um pouco diferente. Tradicionalmente, ao concatenarmos um conjunto de textos, nós já possuímos um vetor (ou mais vetores) em nossas mãos, e desejamos unir cada elemento, ou cada texto contido nesse vetor, de alguma forma lógica. Dentre os pacotes básicos do R, a principal função que realiza esse tipo de operação, é a função <code>paste()</code>. Um detalhe importante sobre essa função, é que ela converte, por padrão, qualquer tipo de <em>input</em> que você fornecer a ela, para o tipo <code>character</code>. Logo, você pode incluir dados numéricos ou de qualquer outro tipo nos <em>input</em>’s dessa função.</p>
<p>A forma como a função <code>paste()</code> realiza essa união entre os textos, depende diretamente de como você configura os argumentos da função, <code>sep</code> e <code>collapse</code>, e de quais <em>input</em>’s você fornece à função. Se você está fornecendo um único <em>input</em> à função, é certo que você está preocupado apenas com o argumento <code>collapse</code> (em outras palavras, <code>sep</code> é irrelevante nesse caso). Em resumo, o argumento <code>collapse</code> define qual o texto que irá separar os diferentes elementos do <em>input</em> que você forneceu a função. Em outras palavras, se o <em>input</em> que fornecemos é, por exemplo, um vetor de textos, ao definirmos o argumento <code>collapse</code>, estamos pedindo à <code>paste()</code> que junte todos os diferentes elementos do vetor, dentro de um único texto, separando-os pelo texto que você definiu no argumento <code>collapse</code>.</p>
<p>Por exemplo, se eu possuo o vetor <code>vec</code> abaixo, e utilizo a função <code>paste()</code> sobre ele, veja o que ocorre ao definirmos o argumento <code>collapse</code>. Perceba no exemplo abaixo, que todos os elementos do vetor <code>vec</code>, foram unidos dentro de um mesmo texto, onde cada um desses elementos são separados pelo texto <code>" : "</code> que definimos no argumento <code>collapse</code>.</p>
<p></p>
<div class="sourceCode" id="cb1013"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1013-1"><a href="#cb1013-1" aria-hidden="true" tabindex="-1"></a>vec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>, <span class="st">&quot;d&quot;</span>, <span class="st">&quot;e&quot;</span>)</span>
<span id="cb1013-2"><a href="#cb1013-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1013-3"><a href="#cb1013-3" aria-hidden="true" tabindex="-1"></a>conc_vec <span class="ot">&lt;-</span> <span class="fu">paste</span>(vec, <span class="at">collapse =</span> <span class="st">&quot; : &quot;</span>)</span>
<span id="cb1013-4"><a href="#cb1013-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1013-5"><a href="#cb1013-5" aria-hidden="true" tabindex="-1"></a>conc_vec</span></code></pre></div>
<pre><code>## [1] &quot;a : b : c : d : e&quot;</code></pre>
<div class="sourceCode" id="cb1015"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1015-1"><a href="#cb1015-1" aria-hidden="true" tabindex="-1"></a><span class="do">## --------------------------</span></span>
<span id="cb1015-2"><a href="#cb1015-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Um outro exemplo:</span></span>
<span id="cb1015-3"><a href="#cb1015-3" aria-hidden="true" tabindex="-1"></a>nomes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Ana&quot;</span>, <span class="st">&quot;Fabrício&quot;</span>, <span class="st">&quot;Eduardo&quot;</span>, <span class="st">&quot;Mônica&quot;</span>)</span>
<span id="cb1015-4"><a href="#cb1015-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1015-5"><a href="#cb1015-5" aria-hidden="true" tabindex="-1"></a>mensagem <span class="ot">&lt;-</span> <span class="fu">paste</span>(nomes, <span class="at">collapse =</span> <span class="st">&quot; e &quot;</span>)</span>
<span id="cb1015-6"><a href="#cb1015-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1015-7"><a href="#cb1015-7" aria-hidden="true" tabindex="-1"></a>mensagem</span></code></pre></div>
<pre><code>## [1] &quot;Ana e Fabrício e Eduardo e Mônica&quot;</code></pre>
<p></p>
<p>Portanto, o texto que você define em <code>collapse</code>, será o texto que vai separar cada um dos elementos do vetor que você fornece como <em>input</em> à função <code>paste()</code>. Por padrão, o argumento <code>collapse</code> é setado para nulo (<code>NULL</code>). Isso significa, que se você não definir algum texto para o argumento <code>collapse</code>, nada acontece ao aplicarmos a função <code>paste()</code> sobre o vetor. Como o argumento <code>sep</code> é irrelevante para um único <em>input</em>, se você não está interessado nesta operação que ocorre ao definirmos <code>collapse</code>, a função <code>paste()</code> não é o que você está procurando.</p>
<p>Por outro lado, se você está fornecendo dois ou mais <em>inputs</em> à função <code>paste()</code>, é provável que você esteja interessado em definir apenas o argumento <code>sep</code>, apesar de que o argumento <code>collapse</code> pode também ser útil para o seu caso. Ao fornecermos dois ou mais vetores como <em>inputs</em>, a função <code>paste()</code>, por padrão, tenta unir os elementos desses vetores, de forma a produzir um novo vetor de texto. Por exemplo, se eu forneço dois vetores à função <code>paste()</code>, como os vetores <code>vec</code> e <code>id</code> abaixo, o primeiro elemento do vetor resultante de <code>paste()</code> vai possuir os textos presentes no primeiro elemento de ambos os vetores.</p>
<p></p>
<div class="sourceCode" id="cb1017"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1017-1"><a href="#cb1017-1" aria-hidden="true" tabindex="-1"></a>id <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span></span>
<span id="cb1017-2"><a href="#cb1017-2" aria-hidden="true" tabindex="-1"></a>vec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>, <span class="st">&quot;d&quot;</span>, <span class="st">&quot;e&quot;</span>)</span>
<span id="cb1017-3"><a href="#cb1017-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1017-4"><a href="#cb1017-4" aria-hidden="true" tabindex="-1"></a>conc_vec <span class="ot">&lt;-</span> <span class="fu">paste</span>(id, vec)</span>
<span id="cb1017-5"><a href="#cb1017-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1017-6"><a href="#cb1017-6" aria-hidden="true" tabindex="-1"></a>conc_vec</span></code></pre></div>
<pre><code>## [1] &quot;1 a&quot; &quot;2 b&quot; &quot;3 c&quot; &quot;4 d&quot; &quot;5 e&quot;</code></pre>
<p></p>
<p>O argumento <code>sep</code> é responsável por definir o texto que vai separar os valores de diferentes <em>input</em>’s da função <code>paste()</code>. Perceba no exemplo acima, os valores dos vetores <code>id</code> e <code>vec</code>, estão todos separados por um espaço em branco. Isso significa, que por padrão, o argumento <code>sep</code> é configurado como um espaço em branco (<code>" "</code>), e, portanto, você não precisa definir o argumento <code>sep</code>, caso você deseja separar esses valores por um espaço. Mas se há interesse em um texto diferente, para separar esses valores, você deve defini-lo através do argumento <code>sep</code>. Por exemplo, você talvez deseja que não haja espaço algum entre esses valores, como exemplo abaixo.</p>
<p></p>
<div class="sourceCode" id="cb1019"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1019-1"><a href="#cb1019-1" aria-hidden="true" tabindex="-1"></a>id <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span></span>
<span id="cb1019-2"><a href="#cb1019-2" aria-hidden="true" tabindex="-1"></a>vec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>, <span class="st">&quot;d&quot;</span>, <span class="st">&quot;e&quot;</span>)</span>
<span id="cb1019-3"><a href="#cb1019-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1019-4"><a href="#cb1019-4" aria-hidden="true" tabindex="-1"></a>conc_vec <span class="ot">&lt;-</span> <span class="fu">paste</span>(id, vec, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb1019-5"><a href="#cb1019-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1019-6"><a href="#cb1019-6" aria-hidden="true" tabindex="-1"></a>conc_vec</span></code></pre></div>
<pre><code>## [1] &quot;1a&quot; &quot;2b&quot; &quot;3c&quot; &quot;4d&quot; &quot;5e&quot;</code></pre>
<p></p>
<p>Assim sendo, em uma representação visual, podemos identificar os papéis dos argumentos <code>sep</code> e <code>collapse</code> da forma apresentada na figura 10.1.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/sep_collapse.png" alt="Resumo dos papéis desempenhados pelos argumentos `sep` e `collapse` em `paste()`" width="100%" />
<p class="caption">
(#fig:unnamed-chunk-572)Resumo dos papéis desempenhados pelos argumentos <code>sep</code> e <code>collapse</code> em <code>paste()</code>
</p>
</div>
<p></p>
<p>Porém, na maioria das aplicações práticas dessa função, pelo menos um dos <em>input</em>’s fornecidos será constante. Por exemplo, uma situação muito comum de uso dessa função, é a construção de caminhos (ou <em>paths</em>) para diferentes arquivos. Essa é exatamente a aplicação que utilizamos na seção <a href="#sec:demanda_dist_ICMS">Um estudo de caso: uma demanda real sobre a distribuição de ICMS</a>.</p>
<p>Nessa seção, em uma das primeiras etapas descritas, precisamos ler ao todo, 12 planilhas diferentes, e como descrevemos no capítulo 4, para importarmos qualquer arquivo, nós precisamos fornecer o caminho até esse arquivo para o R. Com isso, teríamos a tarefa tediosa de construirmos 12 caminhos diferentes (imagine se fossem 36, ou 320 planilhas diferentes a serem lidas). Porém, como todas essas planilhas se encontram dentro do mesmo diretório de meu computador, eu me aproveito dessa regularidade, para fabricar esses caminhos de uma maneira prática, através da função <code>paste()</code>.</p>
<p>Inicialmente, temos apenas os nomes dessas planilhas contidos no objeto <code>planilhas</code> (que está replicado abaixo).</p>
<p></p>
<div class="sourceCode" id="cb1021"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1021-1"><a href="#cb1021-1" aria-hidden="true" tabindex="-1"></a>planilhas <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="st">&quot;planilhas/&quot;</span>)</span>
<span id="cb1021-2"><a href="#cb1021-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1021-3"><a href="#cb1021-3" aria-hidden="true" tabindex="-1"></a>planilhas</span></code></pre></div>
<p></p>
<p></p>
<pre><code>##  [1] &quot;Abril_2019.xlsx&quot;     &quot;Agosto_2019.xlsx&quot;    &quot;Dezembro_2019.xlsx&quot; 
##  [4] &quot;Fevereiro_2019.xlsx&quot; &quot;Janeiro_2019.xlsx&quot;   &quot;Julho_2019.xlsx&quot;    
##  [7] &quot;Junho_2019.xlsx&quot;     &quot;Maio_2019.xlsx&quot;      &quot;Marco_2019.xlsx&quot;    
## [10] &quot;Novembro_2019.xlsx&quot;  &quot;Outubro_2019.xlsx&quot;   &quot;Setembro_2019.xlsx&quot;</code></pre>
<p></p>
<p>Para criarmos o endereço até cada uma dessas planilhas, precisamos juntar o caminho até o diretório em que elas se encontram (<code>"planilhas/"</code>), ao seus nomes. Com isso, podemos utilizar a função <code>paste()</code> da seguinte maneira. Perceba que dois <em>input</em>’s foram fornecidos a função: o primeiro, conciste apenas no texto <code>"planilhas/"</code>; o segundo, são os nomes das planilhas contidos no objeto <code>planilhas</code>. Além disso, repare que pelo fato de que o texto <code>"planilhas/"</code> ser “constante,” <code>paste()</code> acaba replicando-o para todos os 12 nomes presentes no objeto <code>planilhas</code>.</p>
<p></p>
<div class="sourceCode" id="cb1023"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1023-1"><a href="#cb1023-1" aria-hidden="true" tabindex="-1"></a>caminhos <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">&quot;planilhas/&quot;</span>, planilhas, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb1023-2"><a href="#cb1023-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1023-3"><a href="#cb1023-3" aria-hidden="true" tabindex="-1"></a>caminhos</span></code></pre></div>
<pre><code>##  [1] &quot;planilhas/Abril_2019.xlsx&quot;     &quot;planilhas/Agosto_2019.xlsx&quot;   
##  [3] &quot;planilhas/Dezembro_2019.xlsx&quot;  &quot;planilhas/Fevereiro_2019.xlsx&quot;
##  [5] &quot;planilhas/Janeiro_2019.xlsx&quot;   &quot;planilhas/Julho_2019.xlsx&quot;    
##  [7] &quot;planilhas/Junho_2019.xlsx&quot;     &quot;planilhas/Maio_2019.xlsx&quot;     
##  [9] &quot;planilhas/Marco_2019.xlsx&quot;     &quot;planilhas/Novembro_2019.xlsx&quot; 
## [11] &quot;planilhas/Outubro_2019.xlsx&quot;   &quot;planilhas/Setembro_2019.xlsx&quot;</code></pre>
<p></p>
<p>Você talvez tenha percebido, especialmente durante o capítulo 4, que temos uma variante da função <code>paste()</code>, chamada <code>paste0()</code>. Essa irmã, nada mais é do que um atalho para a função <code>paste()</code>, que utiliza por padrão, a configuração . Ou seja, em todas as ocasiões em que você estiver concatenando textos de diferentes <em>input</em>’s com a função <code>paste()</code>, e deseja utilizar nenhum espaço como separador entre os valores de cada <em>input</em>, você pode rapidamente executar essa ação por meio da função <code>paste0()</code>.</p>
<p></p>
<div class="sourceCode" id="cb1025"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1025-1"><a href="#cb1025-1" aria-hidden="true" tabindex="-1"></a>caminhos <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;planilhas/&quot;</span>, planilhas)</span>
<span id="cb1025-2"><a href="#cb1025-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1025-3"><a href="#cb1025-3" aria-hidden="true" tabindex="-1"></a>caminhos</span></code></pre></div>
<pre><code>##  [1] &quot;planilhas/Abril_2019.xlsx&quot;     &quot;planilhas/Agosto_2019.xlsx&quot;   
##  [3] &quot;planilhas/Dezembro_2019.xlsx&quot;  &quot;planilhas/Fevereiro_2019.xlsx&quot;
##  [5] &quot;planilhas/Janeiro_2019.xlsx&quot;   &quot;planilhas/Julho_2019.xlsx&quot;    
##  [7] &quot;planilhas/Junho_2019.xlsx&quot;     &quot;planilhas/Maio_2019.xlsx&quot;     
##  [9] &quot;planilhas/Marco_2019.xlsx&quot;     &quot;planilhas/Novembro_2019.xlsx&quot; 
## [11] &quot;planilhas/Outubro_2019.xlsx&quot;   &quot;planilhas/Setembro_2019.xlsx&quot;</code></pre>
<p></p>
<div id="a-função-str_c-como-uma-alternativa-para-concatenação-de-strings" class="section level3" number="10.3.1">
<h3 number="10.3.1"><span class="header-section-number">10.3.1</span> A função <code>str_c()</code> como uma alternativa para concatenação de <em>strings</em></h3>
<p>Por ser uma operação muito comum e útil, o pacote <code>stringr</code> nos oferece a função <code>str_c()</code>, como uma alternativa à função <code>paste()</code>. Suas diferenças se restringem a dois pontos. Primeiro, a função <code>str_c()</code> foi escrita em C++, e consegue hoje, atingir uma maior eficiência se comparada a função <code>paste()</code>, como demonstrado abaixo. Logo, <code>str_c()</code> pode oferecer uma vantagem considerável, caso você esteja trabalhando com um grande conjunto de textos.</p>
<p></p>
<div class="sourceCode" id="cb1027"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1027-1"><a href="#cb1027-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb1027-2"><a href="#cb1027-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(microbenchmark)</span>
<span id="cb1027-3"><a href="#cb1027-3" aria-hidden="true" tabindex="-1"></a>texto <span class="ot">&lt;-</span> <span class="fu">sample</span>(letters, <span class="at">size =</span> <span class="fl">1e6</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1027-4"><a href="#cb1027-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1027-5"><a href="#cb1027-5" aria-hidden="true" tabindex="-1"></a><span class="fu">microbenchmark</span>(</span>
<span id="cb1027-6"><a href="#cb1027-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste</span>(texto, <span class="at">collapse =</span> <span class="st">&quot;&quot;</span>),</span>
<span id="cb1027-7"><a href="#cb1027-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_c</span>(texto, <span class="at">collapse =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb1027-8"><a href="#cb1027-8" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p></p>
<pre><code>Unit: milliseconds
                        expr      min       lq      mean
 paste(texto, collapse = &quot;&quot;) 104.7202 107.8384 124.43956
 str_c(texto, collapse = &quot;&quot;)  26.3803  26.9155  28.33062
   median        uq      max neval
 115.8264 129.90345 277.5362   100
  27.1933  29.02705  33.3686   100</code></pre>
<p>Segundo, temos também uma diferença importante sobre as configurações nativas utilizadas por essas funções. Pois a função <code>str_c()</code> adota  como a sua configuração padrão para o argumento <code>sep</code> (se igualando assim, à função <code>paste0()</code>), ao invés de <code>sep = " "</code>, que é o padrão adotado por <code>paste()</code>. Veja um exemplo abaixo.</p>
<p></p>
<div class="sourceCode" id="cb1029"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1029-1"><a href="#cb1029-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_c</span>(<span class="st">&quot;Dia&quot;</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>)</span></code></pre></div>
<pre><code>## [1] &quot;Dia1&quot; &quot;Dia2&quot; &quot;Dia3&quot; &quot;Dia4&quot; &quot;Dia5&quot; &quot;Dia6&quot; &quot;Dia7&quot;</code></pre>
<div class="sourceCode" id="cb1031"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1031-1"><a href="#cb1031-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_c</span>(<span class="st">&quot;Dia&quot;</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>, <span class="at">sep =</span> <span class="st">&quot; &quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;Dia 1&quot; &quot;Dia 2&quot; &quot;Dia 3&quot; &quot;Dia 4&quot; &quot;Dia 5&quot; &quot;Dia 6&quot; &quot;Dia 7&quot;</code></pre>
<div class="sourceCode" id="cb1033"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1033-1"><a href="#cb1033-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_c</span>(<span class="st">&quot;Dia&quot;</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>, <span class="at">collapse =</span> <span class="st">&quot;-&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;Dia1-Dia2-Dia3-Dia4-Dia5-Dia6-Dia7&quot;</code></pre>
<p></p>
<p>Apesar dessas diferenças, a função <code>str_c()</code> se comporta exatamente da mesma maneira que a função <code>paste()</code>. Por isso, pode ser interessante que você adote essa função como o seu padrão para concatenação de textos, especialmente levando-se em conta, a sua maior eficiência.</p>
</div>
</div>
<div id="vantagens-do-pacote-stringr" class="section level2" number="10.4">
<h2 number="10.4"><span class="header-section-number">10.4</span> Vantagens do pacote <code>stringr</code></h2>
<p>Os pacotes básicos da linguagem R oferecem algumas ferramentas para trabalharmos com <em>strings</em>, como a função <code>paste()</code> e a família <code>grep()</code>. Porém, essas ferramentas são em grande parte, inconsistentes em seus nomes e formas e, por isso, são mais difíceis de se lembrar. Mesmo com essa consideração, eu decidi mostrar a função <code>paste()</code> na seção anterior, pelo fato de que ela continua sendo uma função extremamente popular, e que você irá encontrar em todo lugar.</p>
<p>De qualquer forma, a partir de agora, vamos focar apenas nas funções do pacote <code>stringr</code>. As funções desse pacote, são em geral, mais rápidas do que as funções ofertadas pelos pacotes básicos. Além disso, os nomes de todas as funções do pacote <code>stringr</code> começam pela sequência <code>str_*()</code>, o que facilita muito a sua memorização de cada função.</p>
</div>
<div id="comprimento-de-strings-com-str_length" class="section level2" number="10.5">
<h2 number="10.5"><span class="header-section-number">10.5</span> Comprimento de <em>strings</em> com <code>str_length()</code></h2>
<p>A função <code>str_length()</code> lhe permite contabilizar o número de caracteres presentes em uma <em>string</em>. Essa função é extremamente útil, quando desejamos aplicar operações que se baseiam em uma determinada posição de uma <em>string</em>, como extrair uma seção específica dessa <em>string</em>. Perceba abaixo, que ao se deparar com valores <code>NA</code>, a função nos retorna um valor <code>NA</code> correspondente. Repare também, pelo resultado do quarto elemento, referente a palavra “Partindo,” que espaços em branco também são contabilizados como caracteres, portanto, fique atento a este detalhe.</p>
<p></p>
<div class="sourceCode" id="cb1035"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1035-1"><a href="#cb1035-1" aria-hidden="true" tabindex="-1"></a>vec <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb1035-2"><a href="#cb1035-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Fui ao Paraná, e encontrei o Varadá&quot;</span>,</span>
<span id="cb1035-3"><a href="#cb1035-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Abril&quot;</span>, </span>
<span id="cb1035-4"><a href="#cb1035-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;!&quot;</span>,</span>
<span id="cb1035-5"><a href="#cb1035-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Partindo &quot;</span>,</span>
<span id="cb1035-6"><a href="#cb1035-6" aria-hidden="true" tabindex="-1"></a>  <span class="cn">NA</span></span>
<span id="cb1035-7"><a href="#cb1035-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1035-8"><a href="#cb1035-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1035-9"><a href="#cb1035-9" aria-hidden="true" tabindex="-1"></a><span class="fu">str_length</span>(vec)</span></code></pre></div>
<pre><code>## [1] 35  5  1  9 NA</code></pre>
<p></p>
</div>
<div id="lidando-com-capitalização-e-espaços-em-branco" class="section level2" number="10.6">
<h2 number="10.6"><span class="header-section-number">10.6</span> Lidando com capitalização e espaços em branco</h2>
<p>Diversas empresas que utilizam formulários, ou outros sistemas de registro, precisam estar constantemente corrigindo <em>input</em>’s fornecidos por seus usuários. Talvez, os erros mais comumente gerados, sejam no uso da capitalização e de espaços em branco. Por exemplo, ao preenchermos formulários, é muito comum que: 1) esqueçamos a tecla <code>Caps Lock</code> ligada; 2) ou simplesmente ignoramos o uso de capitalização por simplesmente estarmos com pressa para finalizar o formulário; 3) acrescentar espaços desnecessários ao final ou no meio do <em>input</em>.</p>
<p>Como exemplo, suponha que você possua a tabela <code>usuarios</code>. Repare que os valores da coluna <code>cidade</code>, variam bastante quanto ao uso da capitalização. Repare também, que em alguns valores na coluna <code>nome</code>, temos para além de problemas com a capitalização, espaços em branco desnecessários, que as vezes se encontram a direita, ou a esquerda, ou em ambos os lados do nome.</p>
<p></p>
<div class="sourceCode" id="cb1037"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1037-1"><a href="#cb1037-1" aria-hidden="true" tabindex="-1"></a>usuarios <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb1037-2"><a href="#cb1037-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">nome =</span> <span class="fu">c</span>(<span class="st">&quot;Ana&quot;</span>, <span class="st">&quot; Eduardo&quot;</span>, <span class="st">&quot; Cláudio   &quot;</span>, <span class="st">&quot;VerÔNiCA &quot;</span>,</span>
<span id="cb1037-3"><a href="#cb1037-3" aria-hidden="true" tabindex="-1"></a>           <span class="st">&quot;  hugo    &quot;</span>, <span class="st">&quot;JULIANA&quot;</span>, <span class="st">&quot;  Vitor de paula   &quot;</span>),</span>
<span id="cb1037-4"><a href="#cb1037-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">cidade =</span> <span class="fu">c</span>(<span class="st">&quot;BELÉM&quot;</span>, <span class="st">&quot;goiânia&quot;</span>, <span class="st">&quot;são paulo&quot;</span>, <span class="st">&quot;São paulo&quot;</span>, <span class="st">&quot;SÃO pAULO&quot;</span>,</span>
<span id="cb1037-5"><a href="#cb1037-5" aria-hidden="true" tabindex="-1"></a>             <span class="st">&quot;rIO DE janeiro&quot;</span>, <span class="st">&quot;rio de janeiro&quot;</span>),</span>
<span id="cb1037-6"><a href="#cb1037-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">profissao =</span> <span class="fu">c</span>(<span class="st">&quot;Bióloga&quot;</span>, <span class="st">&quot;Biólogo&quot;</span>, <span class="st">&quot;Químico&quot;</span>, <span class="st">&quot;Socióloga&quot;</span>,</span>
<span id="cb1037-7"><a href="#cb1037-7" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;Administrador&quot;</span>, <span class="st">&quot;Administradora&quot;</span>, <span class="st">&quot;Economista&quot;</span>)</span>
<span id="cb1037-8"><a href="#cb1037-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1037-9"><a href="#cb1037-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1037-10"><a href="#cb1037-10" aria-hidden="true" tabindex="-1"></a>usuarios</span></code></pre></div>
<pre><code>## # A tibble: 7 x 3
##   nome                  cidade         profissao     
##   &lt;chr&gt;                 &lt;chr&gt;          &lt;chr&gt;         
## 1 &quot;Ana&quot;                 BELÉM          Bióloga       
## 2 &quot; Eduardo&quot;            goiânia        Biólogo       
## 3 &quot; Cláudio   &quot;         são paulo      Químico       
## 4 &quot;VerÔNiCA &quot;           São paulo      Socióloga     
## 5 &quot;  hugo    &quot;          SÃO pAULO      Administrador 
## 6 &quot;JULIANA&quot;             rIO DE janeiro Administradora
## 7 &quot;  Vitor de paula   &quot; rio de janeiro Economista</code></pre>
<p></p>
<p>No Excel, você normalmente utilizaria a função <code>ARRUMAR()</code> para resolver os excessos de espaços, e as funções <code>MAIÚSCULA()</code>, <code>MINÚSCULA()</code> e <code>PRI.MAIÚSCULA()</code> para alterar a capitalização de todas as letras de cada nome. Sendo as funções <code>str_trim()</code>, <code>str_to_upper()</code>, <code>str_to_lower()</code> e <code>str_to_title()</code>, os seus equivalentes no pacote <code>stringr</code>, respectivamente.</p>
<p>Como os próprios nomes das funções <code>str_to_upper()</code> e <code>str_to_lower()</code> dão a entender, elas convertem todos as letras contidas em um vetor do tipo <code>character</code>, para letras maiúsculas (<em>upper</em>) e minúsculas (<em>lower</em>). Por exemplo, ao aplicarmos essas funções sobre a coluna <code>cidade</code>, temos o seguinte resultado:</p>
<p></p>
<div class="sourceCode" id="cb1039"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1039-1"><a href="#cb1039-1" aria-hidden="true" tabindex="-1"></a>usuarios <span class="sc">%&gt;%</span> </span>
<span id="cb1039-2"><a href="#cb1039-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cidade =</span> <span class="fu">str_to_upper</span>(cidade))</span></code></pre></div>
<pre><code>## # A tibble: 7 x 3
##   nome                  cidade         profissao     
##   &lt;chr&gt;                 &lt;chr&gt;          &lt;chr&gt;         
## 1 &quot;Ana&quot;                 BELÉM          Bióloga       
## 2 &quot; Eduardo&quot;            GOIÂNIA        Biólogo       
## 3 &quot; Cláudio   &quot;         SÃO PAULO      Químico       
## 4 &quot;VerÔNiCA &quot;           SÃO PAULO      Socióloga     
## 5 &quot;  hugo    &quot;          SÃO PAULO      Administrador 
## 6 &quot;JULIANA&quot;             RIO DE JANEIRO Administradora
## 7 &quot;  Vitor de paula   &quot; RIO DE JANEIRO Economista</code></pre>
<div class="sourceCode" id="cb1041"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1041-1"><a href="#cb1041-1" aria-hidden="true" tabindex="-1"></a>usuarios <span class="sc">%&gt;%</span> </span>
<span id="cb1041-2"><a href="#cb1041-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cidade =</span> <span class="fu">str_to_lower</span>(cidade))</span></code></pre></div>
<pre><code>## # A tibble: 7 x 3
##   nome                  cidade         profissao     
##   &lt;chr&gt;                 &lt;chr&gt;          &lt;chr&gt;         
## 1 &quot;Ana&quot;                 belém          Bióloga       
## 2 &quot; Eduardo&quot;            goiânia        Biólogo       
## 3 &quot; Cláudio   &quot;         são paulo      Químico       
## 4 &quot;VerÔNiCA &quot;           são paulo      Socióloga     
## 5 &quot;  hugo    &quot;          são paulo      Administrador 
## 6 &quot;JULIANA&quot;             rio de janeiro Administradora
## 7 &quot;  Vitor de paula   &quot; rio de janeiro Economista</code></pre>
<p></p>
<p>Por outro lado, a função <code>str_to_title()</code> representa a alternativa do meio, ao converter a primeira letra de cada palavra, para maiúsculo, e as letras restantes, para minúsculo, como demonstrado abaixo:</p>
<p></p>
<div class="sourceCode" id="cb1043"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1043-1"><a href="#cb1043-1" aria-hidden="true" tabindex="-1"></a>usuarios <span class="sc">%&gt;%</span> </span>
<span id="cb1043-2"><a href="#cb1043-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cidade =</span> <span class="fu">str_to_title</span>(cidade))</span></code></pre></div>
<pre><code>## # A tibble: 7 x 3
##   nome                  cidade         profissao     
##   &lt;chr&gt;                 &lt;chr&gt;          &lt;chr&gt;         
## 1 &quot;Ana&quot;                 Belém          Bióloga       
## 2 &quot; Eduardo&quot;            Goiânia        Biólogo       
## 3 &quot; Cláudio   &quot;         São Paulo      Químico       
## 4 &quot;VerÔNiCA &quot;           São Paulo      Socióloga     
## 5 &quot;  hugo    &quot;          São Paulo      Administrador 
## 6 &quot;JULIANA&quot;             Rio De Janeiro Administradora
## 7 &quot;  Vitor de paula   &quot; Rio De Janeiro Economista</code></pre>
<p></p>
<p>Quanto ao excedente de espaços na coluna <code>nome</code>, podemos aplicar a função <code>str_trim()</code>. Por padrão, essa função retira qualquer espaço remanescente em ambos os lados de sua <em>string</em>. Mas caso seja de seu desejo, você pode especificar um lado específico para retirar espaços, por meio do argumento <code>side</code>, que aceita os valores <code>"both"</code>, <code>"left"</code> ou <code>"right"</code>.</p>
<p></p>
<div class="sourceCode" id="cb1045"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1045-1"><a href="#cb1045-1" aria-hidden="true" tabindex="-1"></a>usuarios <span class="ot">&lt;-</span> usuarios <span class="sc">%&gt;%</span> </span>
<span id="cb1045-2"><a href="#cb1045-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">nome =</span> <span class="fu">str_trim</span>(nome))</span>
<span id="cb1045-3"><a href="#cb1045-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1045-4"><a href="#cb1045-4" aria-hidden="true" tabindex="-1"></a>usuarios</span></code></pre></div>
<pre><code>## # A tibble: 7 x 3
##   nome           cidade         profissao     
##   &lt;chr&gt;          &lt;chr&gt;          &lt;chr&gt;         
## 1 Ana            BELÉM          Bióloga       
## 2 Eduardo        goiânia        Biólogo       
## 3 Cláudio        são paulo      Químico       
## 4 VerÔNiCA       São paulo      Socióloga     
## 5 hugo           SÃO pAULO      Administrador 
## 6 JULIANA        rIO DE janeiro Administradora
## 7 Vitor de paula rio de janeiro Economista</code></pre>
<p></p>
<p>Vale destacar também, que <code>str_trim()</code> é capaz apenas de remover excessos de espaços que se encontram ao redor de seu texto. Logo, a forma mais direta de resolvermos esse tipo de excesso, seria utilizarmos o método mais “abrangente” da função <code>str_trim()</code>, aplicado pela função <code>str_squish()</code>. Além de remover os espaços ao redor da palavra, a função <code>str_squish()</code> também é capaz de remover espaços repetidos que se encontram entre palavras. Veja abaixo, o exemplo do texto <code>"  São Carlos de   Santana   "</code>.</p>
<p></p>
<div class="sourceCode" id="cb1047"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1047-1"><a href="#cb1047-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_trim</span>(<span class="st">&quot;  São Carlos de   Santana   &quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;São Carlos de   Santana&quot;</code></pre>
<div class="sourceCode" id="cb1049"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1049-1"><a href="#cb1049-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_squish</span>(<span class="st">&quot;  São Carlos de   Santana   &quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;São Carlos de Santana&quot;</code></pre>
<p></p>
</div>
<div id="extraindo-partes-ou-subsets-de-uma-string-com-str_sub" class="section level2" number="10.7">
<h2 number="10.7"><span class="header-section-number">10.7</span> Extraindo partes ou <em>subsets</em> de uma <em>string</em> com <code>str_sub()</code></h2>
<p>Para extrairmos partes de uma <em>string</em>, podemos utilizar a função <code>str_sub()</code>, que se baseia na posição dos caracteres que delimitam o intervalo que você deseja capturar. Ou seja, nessa função, precisamos definir as posições dos caracteres que iniciam e terminam o intervalo que estamos extraindo. Como exemplo, eu posso extrair do primeiro ao quarto caractere de cada texto presente na coluna <code>nome</code>, da seguinte maneira:</p>
<p></p>
<div class="sourceCode" id="cb1051"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1051-1"><a href="#cb1051-1" aria-hidden="true" tabindex="-1"></a>usuarios <span class="sc">%&gt;%</span> </span>
<span id="cb1051-2"><a href="#cb1051-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">parte =</span> <span class="fu">str_sub</span>(nome, <span class="at">start =</span> <span class="dv">1</span>, <span class="at">end =</span> <span class="dv">4</span>))</span></code></pre></div>
<pre><code>## # A tibble: 7 x 4
##   nome           cidade         profissao      parte
##   &lt;chr&gt;          &lt;chr&gt;          &lt;chr&gt;          &lt;chr&gt;
## 1 Ana            BELÉM          Bióloga        Ana  
## 2 Eduardo        goiânia        Biólogo        Edua 
## 3 Cláudio        são paulo      Químico        Cláu 
## 4 VerÔNiCA       São paulo      Socióloga      VerÔ 
## 5 hugo           SÃO pAULO      Administrador  hugo 
## 6 JULIANA        rIO DE janeiro Administradora JULI 
## 7 Vitor de paula rio de janeiro Economista     Vito</code></pre>
<p></p>
<p>De forma semelhante, podemos extrair do terceiro ao quinto caractere dessa mesma coluna, de acordo com o seguinte comando:</p>
<p></p>
<div class="sourceCode" id="cb1053"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1053-1"><a href="#cb1053-1" aria-hidden="true" tabindex="-1"></a>usuarios <span class="sc">%&gt;%</span> </span>
<span id="cb1053-2"><a href="#cb1053-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">parte =</span> <span class="fu">str_sub</span>(nome, <span class="at">start =</span> <span class="dv">3</span>, <span class="at">end =</span> <span class="dv">5</span>))</span></code></pre></div>
<pre><code>## # A tibble: 7 x 4
##   nome           cidade         profissao      parte
##   &lt;chr&gt;          &lt;chr&gt;          &lt;chr&gt;          &lt;chr&gt;
## 1 Ana            BELÉM          Bióloga        a    
## 2 Eduardo        goiânia        Biólogo        uar  
## 3 Cláudio        são paulo      Químico        áud  
## 4 VerÔNiCA       São paulo      Socióloga      rÔN  
## 5 hugo           SÃO pAULO      Administrador  go   
## 6 JULIANA        rIO DE janeiro Administradora LIA  
## 7 Vitor de paula rio de janeiro Economista     tor</code></pre>
<p></p>
<p>Além desses pontos, vale esclarecer que os textos inclusos em seu vetor, não precisam obrigatoriamente se encaixar no intervalo de caracteres que você delimitou. Por exemplo, veja abaixo que eu forneci um vetor contendo dois nomes (Ana e Eduardo), um possui 3 caracteres, enquanto o outro, possui 7. Logo, ao pedir à <code>str_sub()</code>, que retire do primeiro ao sexto caractere de cada texto contido no vetor, a função vai tentar extrair o máximo de caracteres possíveis que se encaixam nesse intervalo. Mesmo que algum desses textos não encaixe por completo nesse intervalo.</p>
<p></p>
<div class="sourceCode" id="cb1055"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1055-1"><a href="#cb1055-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_sub</span>(<span class="fu">c</span>(<span class="st">&quot;Ana&quot;</span>, <span class="st">&quot;Eduardo&quot;</span>), <span class="at">start =</span> <span class="dv">1</span>, <span class="at">end =</span> <span class="dv">6</span>)</span></code></pre></div>
<pre><code>## [1] &quot;Ana&quot;    &quot;Eduard&quot;</code></pre>
<p></p>
<div id="sec:str_sub_e_str_length" class="section level3" number="10.7.1">
<h3 number="10.7.1"><span class="header-section-number">10.7.1</span> Aliando <code>str_sub()</code> com <code>str_length()</code> para extrair partes de tamanho variável</h3>
<p>Na seção <a href="#sec:demanda_dist_ICMS">Um estudo de caso: uma demanda real sobre a distribuição de ICMS</a> oferecemos um caso de uso das funções <code>str_sub()</code> e <code>str_length</code>. Nessa seção, temos um sistema que coleta o nome de cada planilha que importamos para o R. Por que precisamos dessa informação? Porque o nome de cada planilha especifica o mês e o ano a que os seus dados se referem. Logo, os dados presentes na planilha <code>Abril_2019.xlsx</code> diziam respeito ao mês de abril do ano de 2019.</p>
<p>Portanto, ao final da coleta desses nomes, inserimos esses nomes em uma coluna de nosso <code>data.frame</code>, tendo como resultado algo parecido com a coluna <code>origem</code>, que se encontra na tabela <code>periodo</code>, e que pode ser recriada através dos comandos abaixo.</p>
<p></p>
<div class="sourceCode" id="cb1057"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1057-1"><a href="#cb1057-1" aria-hidden="true" tabindex="-1"></a>meses <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Janeiro&quot;</span>, <span class="st">&quot;Fevereiro&quot;</span>, <span class="st">&quot;Março&quot;</span>, <span class="st">&quot;Abril&quot;</span>,</span>
<span id="cb1057-2"><a href="#cb1057-2" aria-hidden="true" tabindex="-1"></a>           <span class="st">&quot;Maio&quot;</span>, <span class="st">&quot;Junho&quot;</span>, <span class="st">&quot;Julho&quot;</span>, <span class="st">&quot;Agosto&quot;</span>,</span>
<span id="cb1057-3"><a href="#cb1057-3" aria-hidden="true" tabindex="-1"></a>           <span class="st">&quot;Setembro&quot;</span>, <span class="st">&quot;Outubro&quot;</span>, <span class="st">&quot;Novembro&quot;</span>, <span class="st">&quot;Dezembro&quot;</span>)</span>
<span id="cb1057-4"><a href="#cb1057-4" aria-hidden="true" tabindex="-1"></a>meses <span class="ot">&lt;-</span> <span class="fu">rep</span>(meses, <span class="at">times =</span> <span class="dv">6</span>)</span>
<span id="cb1057-5"><a href="#cb1057-5" aria-hidden="true" tabindex="-1"></a>anos <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">2015</span><span class="sc">:</span><span class="dv">2020</span>, <span class="at">each =</span> <span class="dv">12</span>)</span>
<span id="cb1057-6"><a href="#cb1057-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1057-7"><a href="#cb1057-7" aria-hidden="true" tabindex="-1"></a>periodo <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb1057-8"><a href="#cb1057-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">origem =</span> <span class="fu">str_c</span>(<span class="fu">str_c</span>(meses, anos, <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>), <span class="st">&quot;.xslx&quot;</span>)</span>
<span id="cb1057-9"><a href="#cb1057-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1057-10"><a href="#cb1057-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1057-11"><a href="#cb1057-11" aria-hidden="true" tabindex="-1"></a>periodo</span></code></pre></div>
<pre><code>## # A tibble: 72 x 1
##    origem             
##    &lt;chr&gt;              
##  1 Janeiro_2015.xslx  
##  2 Fevereiro_2015.xslx
##  3 Março_2015.xslx    
##  4 Abril_2015.xslx    
##  5 Maio_2015.xslx     
##  6 Junho_2015.xslx    
##  7 Julho_2015.xslx    
##  8 Agosto_2015.xslx   
##  9 Setembro_2015.xslx 
## 10 Outubro_2015.xslx  
## # ... with 62 more rows</code></pre>
<p></p>
<p>Com essa informação, podemos facilmente rastrear a origem de cada linha de nossa tabela. Entretanto, mesmo com essa informação, ainda não somos capazes de ordenar a tabela de maneira útil. Pois da forma como as informações são apresentadas na coluna <code>origem</code>, uma ordenação alfabética seria empregada sobre a coluna. Logo, valores como <code>Abril_2018.xlsx</code> e <code>Abril_2017.xlsx</code>, viriam a aparecer antes de valores como <code>Março_2019.xlsx</code>.</p>
<p>Por isso, ainda temos a necessidade de extrair o mês e o ano desses nomes, e em seguida, alocar essas informações em colunas separadas. Com esse objetivo, utilizamos a função <code>str_sub()</code> para extrairmos a parte, ou a seção de cada nome, que corresponde ao mês que ele se refere. Porém, como você pode ver acima, o número de caracteres presentes em cada mês, ou em cada nome, varia de maneira drástica.</p>
<p>Em momentos como esse, você pode tentar identificar se a parte final ou a parte inicial dos textos inclusos em sua coluna, são de alguma maneira, constantes. Ou seja, mesmo que o número de caracteres varie muito ao longo da coluna, talvez exista uma parte específica desses textos que sempre possui a mesma <strong>quantidade de caracteres</strong>.</p>
<p>No caso da coluna <code>origem</code>, temos três partes que são sempre constantes, que são a parte dos anos (mesmo que os anos variem, eles sempre são formados por 4 números, ou 4 caracteres), a parte da extensão do arquivo (<code>.xlsx</code>), e o <em>underscore</em> (<code>_</code>), que sempre separa as duas partes anteriores do mês em cada nome. Somando os caracteres dessas três partes, temos sempre 10 caracteres ao final do nome do arquivo, ao qual podemos eliminar para chegarmos à seção do texto que contém o nome do mês. Com isso, podemos utilizar a função <code>str_length()</code> para calcular o número total de caracteres de cada texto, e subtrair 10 desse valor, para chegarmos ao caractere que delimita o fim do mês em cada texto.</p>
<p>Podemos empregar a mesma linha de raciocínio, para chegarmos aos limites do intervalo que contém o ano em cada texto. Contudo, tanto o limite inicial quanto o limite final desse intervalo, variam. Logo, temos que utilizar o resultado de <code>str_length()</code> para descobrirmos os dois limites dessa seção. Como estamos empregando os valores produzidos por <code>str_length()</code> em três locais diferentes, eu guardo o resultado dessa função em uma coluna denominada <code>num</code>, para não ter o trabalho de digitar repetidamente a função <code>str_length()</code>.</p>
<p></p>
<div class="sourceCode" id="cb1059"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1059-1"><a href="#cb1059-1" aria-hidden="true" tabindex="-1"></a>periodo <span class="sc">%&gt;%</span> </span>
<span id="cb1059-2"><a href="#cb1059-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb1059-3"><a href="#cb1059-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">num =</span> <span class="fu">str_length</span>(origem),</span>
<span id="cb1059-4"><a href="#cb1059-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">mes =</span> <span class="fu">str_sub</span>(origem, <span class="at">start =</span> <span class="dv">1</span>, <span class="at">end =</span> num <span class="sc">-</span> <span class="dv">10</span>),</span>
<span id="cb1059-5"><a href="#cb1059-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">ano =</span> <span class="fu">str_sub</span>(origem, <span class="at">start =</span> num <span class="sc">-</span> <span class="dv">8</span>, <span class="at">end =</span> num <span class="sc">-</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span> <span class="fu">as.integer</span>()</span>
<span id="cb1059-6"><a href="#cb1059-6" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 72 x 4
##    origem                num mes         ano
##    &lt;chr&gt;               &lt;int&gt; &lt;chr&gt;     &lt;int&gt;
##  1 Janeiro_2015.xslx      17 Janeiro    2015
##  2 Fevereiro_2015.xslx    19 Fevereiro  2015
##  3 Março_2015.xslx        15 Março      2015
##  4 Abril_2015.xslx        15 Abril      2015
##  5 Maio_2015.xslx         14 Maio       2015
##  6 Junho_2015.xslx        15 Junho      2015
##  7 Julho_2015.xslx        15 Julho      2015
##  8 Agosto_2015.xslx       16 Agosto     2015
##  9 Setembro_2015.xslx     18 Setembro   2015
## 10 Outubro_2015.xslx      17 Outubro    2015
## # ... with 62 more rows</code></pre>
<p></p>
</div>
</div>
<div id="sec:stringr_regex" class="section level2" number="10.8">
<h2 number="10.8"><span class="header-section-number">10.8</span> Expressões regulares (ou <em>regex</em>) com <code>str_detect()</code></h2>
<p>Expressões regulares (<em>regular expressions</em>), ou simplesmente <em>regex</em>, são uma ferramenta extremamente poderosa para processamento de texto. Por essa característica, praticamente toda linguagem de programação possui em algum nível, uma implementação dessa funcionalidade. Você talvez não saiba ainda, mas expressões regulares estão em todo lugar. Como exemplo, quando você pesquisa por uma palavra em um PDF, você está aplicando uma expressão regular ao longo do arquivo.</p>
<p>Em síntese, expressões regulares são como uma mini linguagem que lhe permite descrever de maneira concisa, um pedaço de texto <span class="citation">(<a href="#ref-friedl2006" role="doc-biblioref">Friedl 2006</a>)</span>. Para utilizar uma expressão regular, você precisa utilizar uma função que possa aplicar esse tipo de mecanismo. Nos pacotes básicos do R, essa funcionalidade está disponível através das funções da família <code>grep()</code> (sendo <code>grep()</code>, <code>grepl()</code> e <code>gsub()</code>, as principais funções dessa família).</p>
<p>Por outro lado, o pacote <code>stringr</code> oferece uma família um pouco maior de funções que são capazes de aplicar tal mecanismo. Sendo as funções <code>str_which()</code>, <code>str_detect()</code>, <code>str_replace()</code> e <code>str_split()</code>, as principais representantes dessa família.</p>
<p>Em grande parte desse capítulo, estaremos utilizando a função <code>str_detect()</code> como a nossa ponte de acesso ao mundo das expressões regulares. Assim como todas as funções <code>str_*()</code> que citamos no parágrafo anterior, a função <code>str_detect()</code> aceita um vetor contendo os textos a serem pesquisados como primeiro argumento (<code>string</code>), e uma expressão regular como seu segundo argumento (<code>pattern</code>).</p>
<p>A função <code>str_which()</code> é praticamente idêntica à <code>str_detect()</code>. Pois ambas as funções vão pesquisar pelos textos que são descritos pela expressão regular que você forneceu, e ambas as funções vão gerar um vetor contendo índices, que definem quais foram os textos encontrados. Entretanto, as funções se divergem no tipo de resultado gerado. A função <code>str_which()</code> nos retorna um vetor contendo índices numéricos. Em contrapartida, a função <code>str_detect()</code> gera um vetor de valores lógicos. Portanto, você pode utilizar o resultado de ambas as funções dentro da função de <em>subsetting</em> (<code>[</code>) para filtrar os textos encontrados, sendo a única diferença, o tipo de índice empregado no filtro.</p>
<div id="a-expressão-regular-mais-simples-de-todas" class="section level3" number="10.8.1">
<h3 number="10.8.1"><span class="header-section-number">10.8.1</span> A expressão regular mais simples de todas</h3>
<p>A maneira mais simples de utilizarmos uma expressão regular, seria pesquisarmos por uma sequência específica de letras. Por exemplo, suponha que eu possua o conjunto de palavras presentes em <code>vec</code>, e desejasse encontrar a palavra “emissão.”</p>
<p></p>
<div class="sourceCode" id="cb1061"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1061-1"><a href="#cb1061-1" aria-hidden="true" tabindex="-1"></a>vec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;permissão&quot;</span>, <span class="st">&quot;demissão&quot;</span>, <span class="st">&quot;emissão&quot;</span>, <span class="st">&quot;penitência&quot;</span>,</span>
<span id="cb1061-2"><a href="#cb1061-2" aria-hidden="true" tabindex="-1"></a>         <span class="st">&quot;jurisdição&quot;</span>, <span class="st">&quot;ordenação&quot;</span>, <span class="st">&quot;concluio&quot;</span>, <span class="st">&quot;vantagem&quot;</span>,</span>
<span id="cb1061-3"><a href="#cb1061-3" aria-hidden="true" tabindex="-1"></a>         <span class="st">&quot;natação&quot;</span>, <span class="st">&quot;satisfação&quot;</span>, <span class="st">&quot;conclusão&quot;</span>, <span class="st">&quot;ilusão&quot;</span>)</span></code></pre></div>
<p></p>
<p>Com o conhecimento que você já possui, você provavelmente tentaria algo como o comando abaixo para encontrar essa palavra.</p>
<p></p>
<div class="sourceCode" id="cb1062"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1062-1"><a href="#cb1062-1" aria-hidden="true" tabindex="-1"></a>vec[vec <span class="sc">==</span> <span class="st">&quot;emissão&quot;</span>]</span></code></pre></div>
<pre><code>## [1] &quot;emissão&quot;</code></pre>
<p></p>
<p>Porém, você também poderia encontrar essa palavra inclusa no vetor <code>vec</code>, ao fornecer uma expressão regular que seja capaz de descrever o texto “emissão.” Em seu primeiro instinto, você provavelmente aplicaria o simples texto <code>"emissão"</code>, todavia, como vemos abaixo, esse não é exatamente o resultado que desejamos.</p>
<p></p>
<div class="sourceCode" id="cb1064"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1064-1"><a href="#cb1064-1" aria-hidden="true" tabindex="-1"></a>teste <span class="ot">&lt;-</span> <span class="fu">str_detect</span>(vec, <span class="st">&quot;emissão&quot;</span>)</span>
<span id="cb1064-2"><a href="#cb1064-2" aria-hidden="true" tabindex="-1"></a>vec[teste]</span></code></pre></div>
<pre><code>## [1] &quot;demissão&quot; &quot;emissão&quot;</code></pre>
<p></p>
<p>O erro acima, está no fato de que estamos interpretando a <strong>expressão regular</strong> <code>"emissão"</code>, como a palavra “emissão.” Você rapidamente irá descobrir, que expressões regulares não possuem qualquer noção do que é uma palavra, muito menos de onde uma começa ou termina. Ou seja, quando estiver utilizando expressões regulares, a menos que você defina explicitamente os limites físicos da pesquisa, o mecanismo estará procurando por uma sequência específica de caracteres, independentemente do local em que essa sequência seja detectada.</p>
<p>Por isso, é importante que você comece a interpretar qualquer expressão regular, como uma descrição de uma sequência específica de caracteres, ao invés de uma palavra. Logo, quando fornecemos o texto <code>"emissão"</code> à <code>str_detect()</code> acima, estamos na verdade, buscando qualquer texto que contenha os caracteres “e-m-i-s-s-ã-o,” precisamente nessa ordem. Com isso, a palavra “demissão” foi incluída no resultado acima, pelo fato de possuir tal sequência de caracteres, mesmo que essa sequência esteja acompanhada por um “d,” o qual não faz parte da expressão regular definida.</p>
<p>Como um outro exemplo, suponha que eu utilize a expressão <code>"is"</code>. Lembre-se que nós não estamos procurando pela palavra <em>is</em>, mas sim, por qualquer texto que contenha um “i” imediatamente seguido por um “s.” Marcando de negrito, apenas as partes dos textos abaixo, que foram de fato encontradas pela expressão <code>"is"</code>, temos: sat<strong>is</strong>fação, dem<strong>is</strong>são, perm<strong>is</strong>são, em<strong>is</strong>são, jur<strong>is</strong>dição.</p>
<p></p>
<div class="sourceCode" id="cb1066"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1066-1"><a href="#cb1066-1" aria-hidden="true" tabindex="-1"></a>teste <span class="ot">&lt;-</span> <span class="fu">str_detect</span>(vec, <span class="st">&quot;is&quot;</span>)</span>
<span id="cb1066-2"><a href="#cb1066-2" aria-hidden="true" tabindex="-1"></a>vec[teste]</span></code></pre></div>
<pre><code>## [1] &quot;permissão&quot;  &quot;demissão&quot;   &quot;emissão&quot;    &quot;jurisdição&quot; &quot;satisfação&quot;</code></pre>
<p></p>
<p>Porém, a partir do momento em que acrescento um segundo “s” à expressão, as palavras “jurisdição” e “satisfação” não mais se encaixam na descrição fornecida pela expressão. Pois nenhuma dessas duas palavras possuem, <strong>em algum lugar</strong>, um “i” imediatamente seguido por duas letras “s.” Com isso, temos que as partes localizadas pela expressão são: perm<strong>iss</strong>ão, dem<strong>iss</strong>ão, em<strong>iss</strong>ão.</p>
<p></p>
<div class="sourceCode" id="cb1068"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1068-1"><a href="#cb1068-1" aria-hidden="true" tabindex="-1"></a>teste <span class="ot">&lt;-</span> <span class="fu">str_detect</span>(vec, <span class="st">&quot;iss&quot;</span>)</span>
<span id="cb1068-2"><a href="#cb1068-2" aria-hidden="true" tabindex="-1"></a>vec[teste]</span></code></pre></div>
<pre><code>## [1] &quot;permissão&quot; &quot;demissão&quot;  &quot;emissão&quot;</code></pre>
<p></p>
<p>Apenas para que os pontos abordados fiquem claros, a figura exposta abaixo, lhe permite visualizar as correspondências (marcadas em cinza) encontradas por cada uma das expressões regulares mostradas anteriormente.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/regex_simples.png" alt="Correspondências encontradas por cada expressão regular, além de suas respectivas descrições." width="90%" />
<p class="caption">
(#fig:unnamed-chunk-596)Correspondências encontradas por cada expressão regular, além de suas respectivas descrições.
</p>
</div>
<p></p>
</div>
<div id="conhecendo-a-função-str_view" class="section level3" number="10.8.2">
<h3 number="10.8.2"><span class="header-section-number">10.8.2</span> Conhecendo a função <code>str_view()</code></h3>
<p>Nas próximas seções, irei descrever os padrões mais importantes de expressão regulares. Porém, mesmo que eu explique em detalhes, a prática pode ser um pouco difícil no início. Muitas vezes, você imagina que a sua expressão regular representa um texto x, quando na realidade, ela representa um texto y. Como resultado, você pode acabar encontrando textos que você não queria encontrar, ou ainda, não encontrar nenhum texto sequer.</p>
<p>Sempre que eu me vejo nessa situação, em que não sei exatamente o que está errado em minha expressão regular, eu costumo utilizar as funções <code>str_view()</code> e <code>str_view_all()</code> para visualizar em mais detalhes, o texto encontrado (ou que deixou de ser encontrado) por essa expressão regular.</p>
<p>Em resumo, as funções <code>str_view()</code> e <code>str_view_all()</code> aceitam um vetor do tipo <code>character</code> e uma expressão regular como <em>inputs</em>. Como <em>output</em>, essas funções retornam um arquivo HTML que expõe as partes exatas dos textos contidos no vetor de <em>input</em>, que foram encontradas pela expressão regular que você forneceu. Como diferença, <code>str_view()</code> mostra apenas a primeira correspondência encontrada pela expressão regular em cada texto, enquanto <code>str_view_all()</code> mostra todas as correspondências encontradas em cada texto.</p>
<p>Como exemplo, o comando <code>str_view("banana", "an")</code> retorna a visualização abaixo como resultado. Segundo essa visualização, a expressão regular <code>"an"</code> consegue encontrar o texto b<strong>an</strong>ana.</p>
<p></p>
<div class="sourceCode" id="cb1070"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1070-1"><a href="#cb1070-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view</span>(<span class="st">&quot;banana&quot;</span>, <span class="st">&quot;an&quot;</span>)</span></code></pre></div>
<p></p>
<p></p>
<p><img src="Figuras/regex_view1.png" width="50%" style="display: block; margin: auto;" /></p>
<p></p>
<p>Caso eu utilize a função <code>str_view_all()</code>, podemos perceber que mais partes da palavra “banana” podem ser encontrados pela mesma expressão.</p>
<p></p>
<div class="sourceCode" id="cb1071"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1071-1"><a href="#cb1071-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view_all</span>(<span class="st">&quot;banana&quot;</span>, <span class="st">&quot;an&quot;</span>)</span></code></pre></div>
<p></p>
<p></p>
<p><img src="Figuras/regex_view2.png" width="30%" style="display: block; margin: auto;" /></p>
<p></p>
<p>Apesar dos exemplos acima serem bastante simples, o real valor dessas funções se mostra quando estamos tentando construir uma expressão regular razoavelmente longa e complexa. Por exemplo, durante a construção e manutenção deste livro, eu utilizo algumas expressões regulares para transformar citações do formato Latex para o formato universal de citações do Rmarkdown. Logo abaixo, temos um exemplo dessas expressões regulares.</p>
<p></p>
<div class="sourceCode" id="cb1072"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1072-1"><a href="#cb1072-1" aria-hidden="true" tabindex="-1"></a>expre <span class="ot">&lt;-</span> <span class="st">&quot;</span><span class="sc">\\\\</span><span class="st">citeonline</span><span class="sc">\\</span><span class="st">[([p. ]+)([0-9]+)</span><span class="sc">\\</span><span class="st">{([a-zA-Z0-9_]+)</span><span class="sc">\\</span><span class="st">}&quot;</span></span></code></pre></div>
<p></p>
<p>Para testarmos essa expressão regular, construí abaixo, um objeto contendo alguns exemplos de citações em formato Latex. Logo, é esperado que essa expressão regular encontre (ou cubra) todos os exemplos de citação abaixo.</p>
<p></p>
<div class="sourceCode" id="cb1073"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1073-1"><a href="#cb1073-1" aria-hidden="true" tabindex="-1"></a>exemplos <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb1073-2"><a href="#cb1073-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Segundo </span><span class="sc">\\</span><span class="st">citeonline[p. 45]{wickham2017}, algo importante&quot;</span>,</span>
<span id="cb1073-3"><a href="#cb1073-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;</span><span class="sc">\\</span><span class="st">citeonline[p. 3]{alvaro_2011} refutou tal modelo&quot;</span>,</span>
<span id="cb1073-4"><a href="#cb1073-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Apresentado por </span><span class="sc">\\</span><span class="st">citeonline[p. 842]{silva21}&quot;</span></span>
<span id="cb1073-5"><a href="#cb1073-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p></p>
<p>Entretanto, quando fornecemos o objeto de exemplos, e a expressão regular à <code>str_view()</code>, vemos que nenhum texto é encontrado nos três exemplos.</p>
<p></p>
<div class="sourceCode" id="cb1074"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1074-1"><a href="#cb1074-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view</span>(exemplos, expre)</span></code></pre></div>
<p></p>
<p></p>
<p><img src="Figuras/regex_view3.png" width="60%" style="display: block; margin: auto;" /></p>
<p></p>
<p>O que tem de errado com essa expressão? Primeiro, precisamos descobrir <strong>onde</strong> está o problema. Será que é uma parte específica da expressão que está quebrando a busca? Ou será que toda essa expressão é inválida, e não serve de nada para o nosso objetivo?</p>
<p>A melhor maneira de respondermos a essas questões é testar cada parte dessa expressão de forma separada. Se uma parte específica da expressão consegue encontrar o texto que nós esperávamos que essa parte encontrasse, temos um sinal de que o problema está em um outro lugar da expressão.</p>
<p>Como exemplo, vamos testar primeiro a parte <code>\\\\citeonline</code> da expressão. Repare abaixo, que a expressão consegue localizar todos os exemplos de <code>\citeonline</code>.</p>
<p></p>
<div class="sourceCode" id="cb1075"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1075-1"><a href="#cb1075-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view</span>(exemplos, <span class="st">&quot;</span><span class="sc">\\\\</span><span class="st">citeonline&quot;</span>)</span></code></pre></div>
<p></p>
<p></p>
<p><img src="Figuras/regex_view4.png" width="60%" style="display: block; margin: auto;" /></p>
<p></p>
<p>Agora, vamos adicionar as partes <code>\\[</code>, <code>([p. ]+)</code> e <code>([0-9]+)</code> da expressão. Perceba novamente abaixo, que ainda não conseguimos encontrar o problema, pois as partes que nós esperávamos encontrar foram de fato encontradas.</p>
<p></p>
<div class="sourceCode" id="cb1076"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1076-1"><a href="#cb1076-1" aria-hidden="true" tabindex="-1"></a>expre <span class="ot">&lt;-</span> <span class="st">&quot;</span><span class="sc">\\\\</span><span class="st">citeonline</span><span class="sc">\\</span><span class="st">[([p. ]+)([0-9]+)&quot;</span></span>
<span id="cb1076-2"><a href="#cb1076-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view</span>(exemplos, expre)</span></code></pre></div>
<p></p>
<p></p>
<p><img src="Figuras/regex_view5.png" width="60%" style="display: block; margin: auto;" /></p>
<p></p>
<p>Porém, perceba agora, que, ao inserirmos a próxima parte da expressão (<code>\\{</code>), nenhum texto é encontrado. Por esse efeito, podemos inferir que há algo de errado nessa parte da expressão.</p>
<p></p>
<div class="sourceCode" id="cb1077"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1077-1"><a href="#cb1077-1" aria-hidden="true" tabindex="-1"></a>expre <span class="ot">&lt;-</span> <span class="st">&quot;</span><span class="sc">\\\\</span><span class="st">citeonline</span><span class="sc">\\</span><span class="st">[([p. ]+)([0-9]+)</span><span class="sc">\\</span><span class="st">{&quot;</span></span>
<span id="cb1077-2"><a href="#cb1077-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view</span>(exemplos, expre)</span></code></pre></div>
<p></p>
<p></p>
<p><img src="Figuras/regex_view3.png" width="60%" style="display: block; margin: auto;" /></p>
<p></p>
<p>Após analisarmos por um tempo esse problema, podemos identificar que está faltando uma parte <code>\\]</code> antes de <code>\\{</code>. Pois o colchete aberto (identificado por <code>\\[</code>) precisa ser fechado (identificado por <code>\\]</code>). Ao adicionarmos essa parte à expressão, todo o problema é solucionado, e a expressão passa a encontrar corretamente todas as citações.</p>
<p></p>
<div class="sourceCode" id="cb1078"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1078-1"><a href="#cb1078-1" aria-hidden="true" tabindex="-1"></a>expre <span class="ot">&lt;-</span> <span class="st">&quot;</span><span class="sc">\\\\</span><span class="st">citeonline</span><span class="sc">\\</span><span class="st">[([p. ]+)([0-9]+)</span><span class="sc">\\</span><span class="st">]&quot;</span></span>
<span id="cb1078-2"><a href="#cb1078-2" aria-hidden="true" tabindex="-1"></a>expre <span class="ot">&lt;-</span> <span class="fu">str_c</span>(expre, <span class="st">&quot;</span><span class="sc">\\</span><span class="st">{([a-zA-Z0-9_]+)</span><span class="sc">\\</span><span class="st">}&quot;</span>)</span>
<span id="cb1078-3"><a href="#cb1078-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view</span>(exemplos, expre)</span></code></pre></div>
<p></p>
<p></p>
<p><img src="Figuras/regex_view6.png" width="60%" style="display: block; margin: auto;" /></p>
<p></p>
<p>Portanto, sempre que você enfrentar alguma dificuldade com as suas expressões regulares, tente utilizar as funções <code>str_view()</code> e <code>str_view_all()</code> para identificar onde o problema está ocorrendo. Essas funções também podem ser muito úteis, quando você ainda não sabe exatamente como construir a expressão que você necessita. Nesse caso, você pode utilizar essas funções para testar várias possibilidades diferentes, atrás da primeira que funcione.</p>
</div>
<div id="caracteres-literais-e-metacharacters" class="section level3" number="10.8.3">
<h3 number="10.8.3"><span class="header-section-number">10.8.3</span> Caracteres literais e <em>metacharacters</em></h3>
<p>Expressões regulares são uma linguagem formada por duas categorias de caracteres <span class="citation">(<a href="#ref-friedl2006" role="doc-biblioref">Friedl 2006</a>)</span>: 1) Caracteres literais, ou simples letras e números pelos quais pesquisamos; e 2) <em>metacharacters</em>, que são um conjunto de caracteres especiais que delimitam o escopo de sua pesquisa, ou a maneira como ela será executada.</p>
<p>Até o momento, utilizamos apenas caracteres literais, ao pesquisarmos pelas sequências <code>"emissão"</code> ou <code>"is"</code>. Ou seja, qualquer número ou letra que formam uma sequência de caracteres são considerados caracteres literais. Alguns símbolos também são considerados caracteres literais, pois não possuem nenhum comportamento especial que altere o comportamento da pesquisa. Como exemplo, a expressão <code>"A1_z-4!D8"</code> é formada apenas por caracteres literais, mesmo que ela descreva uma sequência bem esquisita (e provavelmente inútil) de caracteres.</p>
<p>Qualquer expressão que utilize apenas caracteres literais, busca efetuar uma simples pesquisa por uma sequência particular de caracteres. Consequentemente, a expressão <code>"1"</code> é capaz de detectar o texto “Álvaro chegou em <strong>1</strong>° lugar!” assim como “O aluguel chegou a R$3250,<strong>1</strong>0 nesse mês.” Como um outro exemplo, ao empregarmos a expressão <code>"regi"</code>, ela é capaz de encontrar os textos “<strong>regi</strong>ão” e “<strong>regi</strong>stro,” mas não é capaz de detectar o nome “Reginaldo,” pelo simples fato de que a primeira letra do nome é um “r” maiúsculo, ao invés de um “r” minúsculo.</p>
<p>Em síntese, expressões regulares já são uma ferramenta útil apenas com o uso de caracteres literais. Contudo, elas se tornam bastante limitadas sem o uso de <em>metacharacters</em>, que ampliam em muito as suas funcionalidades, e mudam drasticamente a forma como a pesquisa ocorre. Neste ponto, também reside uma importante dificuldade no domínio de expressões regulares. Pois são muitos <em>metacharacters</em> disponíveis e, por isso, memorizar o que cada um deles fazem, e quais são as suas aplicações mais úteis, não se trata de uma tarefa simples.</p>
<p>Apesar disso, haverá momentos em que você deseja encontrar ou incluir em sua expressão regular o caractere literal que um certo <em>metacharacter</em> representa. Em outras palavras, há ocasiões em que você deseja que certos <em>metacharacters</em> se comportem como caracteres literais. Por exemplo, um dos <em>metacharacters</em> que vamos mostrar nas próximas seções é <code>?</code> (ponto de interrogação). Portanto, o caractere <code>?</code> possui um comportamento especial em expressões regulares, mas se quisermos encontrar o caractere <code>?</code> em si, ao longo do texto, nós precisamos contornar o comportamento especial desse <em>metacharacter</em>. Para isso, basta anteceder esse caractere por uma barra inclinada à esquerda (<code>\?</code>).</p>
<p>Porém, lembre-se que para escrevermos uma barra inclinada à esquerda, nós temos que digitar duas barras inclinadas à esquerda! Logo, para escrever em sua expressão regular, o termo <code>\?</code>, você deve na verdade, digitar o termo <code>\\?</code>. Isso funciona para praticamente qualquer <em>metacharacter</em>. Logo, sempre que você precisar utilizar um certo <em>metacharacter</em> como um caractere literal, tente antecedê-lo por duas barras inclinadas à esquerda.</p>
</div>
<div id="sec:regex_ancoras" class="section level3" number="10.8.4">
<h3 number="10.8.4"><span class="header-section-number">10.8.4</span> Âncoras (<em>anchors</em>)</h3>
<p>O primeiro tipo de <em>metacharacters</em> que vou apresentar, são os do tipo “âncora.” Esse conjunto é composto pelos caracteres <code>^</code> e <code>$</code>, que são responsáveis por delimitar o início e o fim de uma linha, respectivamente.</p>
<p>Logo, ao utilizar a expressão <code>"^emissão$"</code>, eu estou pedindo à <code>str_detect()</code> que localize um texto que contém: o início de uma linha imediatamente seguido pela sequência “e-m-i-s-s-ã-o” de caracteres, que por sua vez, deve ser imediatamente seguido pelo fim dessa mesma linha. Com essa expressão, somos capazes de encontrar apenas a palavra “emissão” que está entre os valores do vetor <code>vec</code>.</p>
<p></p>
<div class="sourceCode" id="cb1079"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1079-1"><a href="#cb1079-1" aria-hidden="true" tabindex="-1"></a>teste <span class="ot">&lt;-</span> <span class="fu">str_detect</span>(vec, <span class="st">&quot;^emissão$&quot;</span>)</span>
<span id="cb1079-2"><a href="#cb1079-2" aria-hidden="true" tabindex="-1"></a>vec[teste]</span></code></pre></div>
<pre><code>## [1] &quot;emissão&quot;</code></pre>
<p></p>
<p>É importante destacar, que os caracteres <code>^</code> e <code>$</code> são capazes de encontrar os limites de uma linha, e não de uma palavra. Por isso, a partir do momento em que a sequência “e-m-i-s-s-ã-o” não estiver encostando em pelo menos um dos limites da linha, <code>str_detect()</code> não será mais capaz de encontrar tal conjunto de caracteres. Como exemplo, perceba abaixo, que apenas o primeiro elemento de <code>text</code> pôde corresponder à expressão empregada em <code>str_detect()</code>. Ou seja, mesmo que o quarto, quinto e sexto elementos de <code>text</code> possuam a palavra “emissão,” eles não puderam ser encontrados pela expressão <code>"^emissão$"</code>, devido ao fato de não estarem localizados em pelo menos um dos limites da linha.</p>
<p></p>
<div class="sourceCode" id="cb1081"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1081-1"><a href="#cb1081-1" aria-hidden="true" tabindex="-1"></a>text <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb1081-2"><a href="#cb1081-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;emissão&quot;</span>,</span>
<span id="cb1081-3"><a href="#cb1081-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;A Ford Brasil executou recentemente uma demissão em massa&quot;</span>,</span>
<span id="cb1081-4"><a href="#cb1081-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;remissão&quot;</span>,</span>
<span id="cb1081-5"><a href="#cb1081-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Para mais, a emissão de CO2 cresceu no Brasil&quot;</span>,</span>
<span id="cb1081-6"><a href="#cb1081-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;emissão de S02 faz parte do processo&quot;</span>,</span>
<span id="cb1081-7"><a href="#cb1081-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;A firma foi processada por tal emissão&quot;</span></span>
<span id="cb1081-8"><a href="#cb1081-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1081-9"><a href="#cb1081-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1081-10"><a href="#cb1081-10" aria-hidden="true" tabindex="-1"></a>teste <span class="ot">&lt;-</span> <span class="fu">str_detect</span>(text, <span class="st">&quot;^emissão$&quot;</span>)</span>
<span id="cb1081-11"><a href="#cb1081-11" aria-hidden="true" tabindex="-1"></a>text[teste]</span></code></pre></div>
<pre><code>## [1] &quot;emissão&quot;</code></pre>
<p></p>
<p>Vale destacar que você não precisa necessariamente utilizar os dois <em>metacharacters</em> ao mesmo tempo. Logo, temos a opção de construir uma expressão que possa encontrar uma certa sequência de caracteres ao final ou no início de uma linha. Por exemplo, a expressão abaixo, busca encontrar a sequência “e-m-i-s-s-ã-o” de caracteres quando ela é imediatamente seguida pelo final da linha.</p>
<p></p>
<div class="sourceCode" id="cb1083"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1083-1"><a href="#cb1083-1" aria-hidden="true" tabindex="-1"></a>teste <span class="ot">&lt;-</span> <span class="fu">str_detect</span>(text, <span class="st">&quot;emissão$&quot;</span>)</span>
<span id="cb1083-2"><a href="#cb1083-2" aria-hidden="true" tabindex="-1"></a>text[teste]</span></code></pre></div>
<pre><code>## [1] &quot;emissão&quot;                               
## [2] &quot;remissão&quot;                              
## [3] &quot;A firma foi processada por tal emissão&quot;</code></pre>
<p></p>
<p>Alguns outros exemplos de expressões regulares que empregam <em>metacharacters</em> do tipo âncora, além de uma rápida reflexão sobre os caracteres <code>^</code> e <code>$</code>, são oferecidos na figura 10.3. Repare que todas as partes do texto que foram detectadas pela expressão regular, foram novamente marcadas de cinza. Perceba também, que cada seta presente na figura, busca conectar cada uma das partes detectadas do texto, ao componente específico da expressão regular que foi responsável por detectá-la.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/ancoras.png" alt="Exemplos e uma reflexão sobre as correspondências encontradas por metacharacters do tipo âncora." width="100%" />
<p class="caption">
(#fig:unnamed-chunk-616)Exemplos e uma reflexão sobre as correspondências encontradas por metacharacters do tipo âncora.
</p>
</div>
<p></p>
</div>
<div id="classes-de-caracteres-character-classes" class="section level3" number="10.8.5">
<h3 number="10.8.5"><span class="header-section-number">10.8.5</span> Classes de caracteres (<em>character classes</em>)</h3>
<p>Uma estrutura muito importante em expressões regulares são as classes de caracteres, ou <em>character classes</em>. Sendo construída a partir de um par de colchetes (<code>[]</code>), essa estrutura lhe permite listar os possíveis caracteres que você deseja encontrar em um ponto da sequência descrita por sua expressão regular.</p>
<p>Por exemplo, suponha que você esteja lendo um livro-texto sobre a linguagem R, e que você queira encontrar todas as instâncias do livro que se referem ao termo <em>regex</em>. Você sabe que as regiões que descrevem o assunto no qual você está interessado, vão conter o termo <em>regex</em>, mas você não sabe como o termo <em>regex</em> está citado no texto. Digo, será que o autor está colocando a primeira letra em maiúsculo (Regex)? Ou será que todo o termo está em maiúsculo (REGEX)?</p>
<p>Tendo essa dúvida em mente, você pode criar uma expressão regular, que permita certas variações da palavra <em>regex</em>, ao listar todas as possibilidades em uma dada posição do termo. Primeiro, vamos imaginar que você deseja permitir que a primeira letra do termo seja tanto maiúscula quanto minúscula. No exemplo abaixo, ao incluirmos as letras “r” e “R” dentro da classe de caracteres (<code>[]</code>), estamos estabelecendo que no primeiro caractere da sequência, podemos ter uma letra “r” ou uma letra “R.”</p>
<p></p>
<div class="sourceCode" id="cb1085"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1085-1"><a href="#cb1085-1" aria-hidden="true" tabindex="-1"></a>texto <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb1085-2"><a href="#cb1085-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Cada letra, número, ou símbolo presente no texto é um caractere.&quot;</span>,</span>
<span id="cb1085-3"><a href="#cb1085-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Textos são criados ao contornados por aspas (duplas ou simples).&quot;</span>,</span>
<span id="cb1085-4"><a href="#cb1085-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;O termo regex é uma abreviação para regular expressions.&quot;</span>,</span>
<span id="cb1085-5"><a href="#cb1085-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Regex é um termo comum no mundo da computação.&quot;</span>,</span>
<span id="cb1085-6"><a href="#cb1085-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Metacharacters alteram consideravelmente o comportamento de um REGEX.&quot;</span>,</span>
<span id="cb1085-7"><a href="#cb1085-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;ReGEx? Ou reGex? Talvez RegEX?.&quot;</span></span>
<span id="cb1085-8"><a href="#cb1085-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1085-9"><a href="#cb1085-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1085-10"><a href="#cb1085-10" aria-hidden="true" tabindex="-1"></a>teste <span class="ot">&lt;-</span> <span class="fu">str_detect</span>(texto, <span class="st">&quot;[Rr]egex&quot;</span>)</span>
<span id="cb1085-11"><a href="#cb1085-11" aria-hidden="true" tabindex="-1"></a>texto[teste]</span></code></pre></div>
<pre><code>## [1] &quot;O termo regex é uma abreviação para regular expressions.&quot;
## [2] &quot;Regex é um termo comum no mundo da computação.&quot;</code></pre>
<p></p>
<p>Ou seja, uma classe de caracteres busca descrever os caracteres possíveis para uma única e particular posição da sequência. Logo, a expressão <code>"[Rr]egex"</code> não está descrevendo a sequência “[-R-r-]-e-g-e-x,” mas está afirmando que “r-e-g-e-x” e “R-e-g-e-x” são duas sequências de caracteres que queremos encontrar em nossa pesquisa. Com isso, se tivéssemos de permitir todas as possibilidades de capitalização em cada letra do termo, poderíamos fornecer a seguinte expressão à <code>str_detect()</code>:</p>
<p></p>
<div class="sourceCode" id="cb1087"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1087-1"><a href="#cb1087-1" aria-hidden="true" tabindex="-1"></a>teste <span class="ot">&lt;-</span> <span class="fu">str_detect</span>(texto, <span class="st">&quot;[Rr][Ee][Gg][Ee][Xx]&quot;</span>)</span>
<span id="cb1087-2"><a href="#cb1087-2" aria-hidden="true" tabindex="-1"></a>texto[teste]</span></code></pre></div>
<pre><code>## [1] &quot;O termo regex é uma abreviação para regular expressions.&quot;             
## [2] &quot;Regex é um termo comum no mundo da computação.&quot;                       
## [3] &quot;Metacharacters alteram consideravelmente o comportamento de um REGEX.&quot;
## [4] &quot;ReGEx? Ou reGex? Talvez RegEX?.&quot;</code></pre>
<p></p>
<p>Dessa maneira, estamos permitindo que <code>str_detect()</code> encontre todas as possibilidades do termo <em>regex</em>, quanto ao uso de capitalização (regex, Regex, REGEX, rEgex, reGex, regEx, regeX, …).</p>
<p>As classes de caracteres também são muito utilizadas para criar um intervalo de caracteres possíveis em um determinado ponto. Esses intervalos são rapidamente formados pelo <em>metacharacter</em> - (sinal de menos). Como exemplo, podemos utilizar o atalho <code>[0-9]</code> para listarmos todos os números de 0 a 9 dentro da classe. Esse atalho é extremamente útil quando desejamos encontrar alguma parte numérica em nosso texto, mas nós não sabemos previamente quais números em particular vão estar presentes nesse item.</p>
<p>Por exemplo, suponha que uma comissão nacional tenha divulgado as colocações de diversos participantes em um torneio de xadrez. Você deseja analisar os participantes e suas respectivas colocações, entretanto, a comissão divulgou os dados como um texto simples em sua página da internet, ao invés de guardar esses dados em uma tabela, ou em alguma outra estrutura que fosse de fácil transposição para o R.</p>
<p>Com isso, você precisa utilizar uma expressão regular que possa encontrar essas colocações ao longo do texto. Uma possibilidade, seria tentarmos localizar as ocorrências de um número seguido do símbolo de grau (°), ao longo do texto. No exemplo abaixo, as colocações variam de 1 a 6 e, por isso, precisamos listar todos os números neste intervalo dentro de uma classe, e acrescentar o símbolo de grau, formando assim, a expressão <code>"[123456]°"</code>. Porém, ao invés de listarmos número por número, podemos aplicar o atalho <code>[1-6]</code> para criarmos uma lista contendo todos os números de 1 a 6.</p>
<p></p>
<div class="sourceCode" id="cb1089"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1089-1"><a href="#cb1089-1" aria-hidden="true" tabindex="-1"></a>colocacoes <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb1089-2"><a href="#cb1089-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;1°: Álvaro&quot;</span>,</span>
<span id="cb1089-3"><a href="#cb1089-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;2°: Melissa&quot;</span>,</span>
<span id="cb1089-4"><a href="#cb1089-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;3°: Ana&quot;</span>,</span>
<span id="cb1089-5"><a href="#cb1089-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;4°: Eduardo&quot;</span>,</span>
<span id="cb1089-6"><a href="#cb1089-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;5°: Daniela&quot;</span>,</span>
<span id="cb1089-7"><a href="#cb1089-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;6°: Matheus&quot;</span>,</span>
<span id="cb1089-8"><a href="#cb1089-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Não é uma colocação&quot;</span>,</span>
<span id="cb1089-9"><a href="#cb1089-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Também não é uma colocação&quot;</span>,</span>
<span id="cb1089-10"><a href="#cb1089-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;31°C&quot;</span>,</span>
<span id="cb1089-11"><a href="#cb1089-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;24°F&quot;</span></span>
<span id="cb1089-12"><a href="#cb1089-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1089-13"><a href="#cb1089-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1089-14"><a href="#cb1089-14" aria-hidden="true" tabindex="-1"></a>teste <span class="ot">&lt;-</span> <span class="fu">str_detect</span>(colocacoes, <span class="st">&quot;[1-6]°&quot;</span>)</span>
<span id="cb1089-15"><a href="#cb1089-15" aria-hidden="true" tabindex="-1"></a>colocacoes[teste]</span></code></pre></div>
<pre><code>## [1] &quot;1°: Álvaro&quot;  &quot;2°: Melissa&quot; &quot;3°: Ana&quot;     &quot;4°: Eduardo&quot; &quot;5°: Daniela&quot;
## [6] &quot;6°: Matheus&quot; &quot;31°C&quot;        &quot;24°F&quot;</code></pre>
<p></p>
<p>Como podemos ver acima, conseguimos localizar todas as colocações. No entanto, perceba que a expressão <code>"[1-6]°"</code> também pôde encontrar informações que se referem a temperaturas (celsius e fahrenheit). Portanto, a expressão <code>"[1-6]°"</code> é muito abrangente para o nosso caso e, em função disso, precisamos descrever em mais detalhes o texto que desejamos. Tudo o que precisamos fazer para corrigir o resultado acima, é incluir uma expressão que encontre um número seguido por um símbolo de grau, <strong>exceto</strong> quando as letras C ou F estão logo após o símbolo de grau.</p>
<p>Para essa tarefa, podemos utilizar o comportamento negativo de uma classe. Em outras palavras, além de listar os caracteres aceitos em uma certa posição, nós também temos a capacidade de utilizar uma classe de caracteres para listar todos os caracteres que <strong>não podem</strong> estar situados em uma determinada posição da sequência.</p>
<p>Para definir os caracteres não desejados em uma posição, você deve iniciar a sua classe, por um acento circunflexo, logo antes de listar os caracteres em questão (<code>[^...]</code>). Com isso, se desejamos evitar as letras C e F (independente de sua capitalização) precisaríamos da sub expressão <code>[^CcFf]</code> logo após o símbolo de grau, formando assim, a expressão regular abaixo:</p>
<p></p>
<div class="sourceCode" id="cb1091"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1091-1"><a href="#cb1091-1" aria-hidden="true" tabindex="-1"></a>teste <span class="ot">&lt;-</span> <span class="fu">str_detect</span>(colocacoes, <span class="st">&quot;[1-6]°[^CcFf]&quot;</span>)</span>
<span id="cb1091-2"><a href="#cb1091-2" aria-hidden="true" tabindex="-1"></a>colocacoes[teste]</span></code></pre></div>
<pre><code>## [1] &quot;1°: Álvaro&quot;  &quot;2°: Melissa&quot; &quot;3°: Ana&quot;     &quot;4°: Eduardo&quot; &quot;5°: Daniela&quot;
## [6] &quot;6°: Matheus&quot;</code></pre>
<p></p>
<p>Portanto, sempre que você encontrar uma classe que contém um acento circunflexo como seu primeiro item, você sabe que essa classe está negando os caracteres listados dentro dela (exemplo: <code>"[^1-6_!]"</code>, não são permitidos nessa posição qualquer número entre 1 e 6, o símbolo <em>underscore</em> ou um ponto de exclamação). Logo, na posição que essa classe representa, não devem ser encontrados os caracteres que estão listados dentro dela. Mas se essa classe não possui tal acento, ou se esse acento circunflexo se encontra a partir do segundo caractere listado, a classe em análise está utilizando seu comportamento positivo (ou afirmativo), de modo que os caracteres listados em seu interior, podem sim estar naquela posição.</p>
<p>Como um outro exemplo, veja abaixo, as correspondências geradas pela expressão <code>"[0-9][^Ffh]"</code>, que utiliza ambos os modos de classe (negativa e positiva). Essa expressão, busca encontrar um número entre 0 e 9, que é imediatamente seguido por um caractere qualquer (que não seja as letras “F,” “f”e “h”). Repare no caso do texto <code>"A5"</code>, no qual a expressão não é capaz de localizá-lo pelo simples fato de que o texto acaba no dígito 5. Lembre-se que cada classe de caracteres representa um caractere a ser encontrado em uma determinada posição da sequência. Logo, mesmo que a parte <code>[^Ffh]</code> esteje listando os caracteres que não podem ser encontrados, ela está automaticamente definindo que <strong>algum caractere deve ser encontrado na segunda posição da sequência</strong>.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/classes_caractere.png" alt="Um exemplo de expressão regular que emprega ambos os modos de classes de caractere (positiva e negativa)" width="100%" />
<p class="caption">
(#fig:unnamed-chunk-621)Um exemplo de expressão regular que emprega ambos os modos de classes de caractere (positiva e negativa)
</p>
</div>
<p></p>
<p>Além desses pontos, repare acima, que o <em>metacharacter</em> <code>^</code> (acento circunflexo) tem um papel completamente diferente dentro de uma classe de caracteres, se comparado ao papel que ele exerce fora dela. Em resumo, o caractere <code>^</code> fora de uma classe, é um <em>metacharacter</em> do tipo âncora, sendo capaz de definir o início de uma linha; mas dentro de uma classe, ele está determinando o comportamento adotado pela classe em questão, de forma que os caracteres listados nessa classe não devem ser encontrados na posição que essa classe simboliza.</p>
<p>Logo, é muito importante destacar o fato de que diversos caracteres possuem um comportamento profundamente diferente, quando inseridos em uma classe de caracteres. Fique atento a isso! Se algum <em>metacharacter</em> estiver se comportando de maneira inesperada, é possível que essa diferença entre os mundos de dentro e de fora de uma classe seja a fonte de sua surpresa. De certo modo, você pode compreender essa situação, como se as classes possuíssem a sua própria mini linguagem, com o seu próprio conjunto de <em>metacharacters</em>, separados da realidade de fora delas <span class="citation">(<a href="#ref-friedl2006" role="doc-biblioref">Friedl 2006</a>)</span>.</p>
<p>Por outro lado, e se você desejasse incluir os <em>metacharacters</em> <code>-</code> e <code>^</code> como possíveis caracteres para uma determinada posição? Como o caractere <code>-</code> cria uma sequência, você precisa listá-lo logo no início de sua classe (ex: <code>"[-1-6]"</code>, que permite um número entre 1 e 6, além de um sinal de menos). Em contrapartida, o caractere <code>^</code> exerce o seu comportamento especial quando é posicionado como o primeiro item de uma classe. Por essa razão, você precisaria listá-lo em uma outra posição qualquer da classe, para que ele se comportasse como um simples acento circunflexo (ex: <code>"[ABC^]"</code>, que permite as letras A, B e C, além de um acento circunflexo).</p>
<p></p>
<div class="sourceCode" id="cb1093"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1093-1"><a href="#cb1093-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;A-B&quot;</span>, <span class="st">&quot;CDE-F&quot;</span>, <span class="st">&quot;12^54&quot;</span>, <span class="st">&quot;R$1230,2&quot;</span>, <span class="st">&quot;BRA&quot;</span>)</span>
<span id="cb1093-2"><a href="#cb1093-2" aria-hidden="true" tabindex="-1"></a>teste <span class="ot">&lt;-</span> <span class="fu">str_detect</span>(a, <span class="st">&quot;[-^]&quot;</span>)</span>
<span id="cb1093-3"><a href="#cb1093-3" aria-hidden="true" tabindex="-1"></a>a[teste]</span></code></pre></div>
<pre><code>## [1] &quot;A-B&quot;   &quot;CDE-F&quot; &quot;12^54&quot;</code></pre>
<p></p>
<p>Até o momento, mostramos apenas o atalho para listar uma sequência numérica (ex: <code>"[0-9]"</code>). Mas também temos um outro atalho para listarmos um intervalo específico (ou todas as letras) do alfabeto. Para isso, podemos utilizar o atalho <code>[a-z]</code> para letras minúsculas, e <code>[A-Z]</code> para letras maiúsculas. Por exemplo, suponha que você possua o conjunto de códigos mostrados no objeto <code>codes</code>. Suponha também, que os códigos que contém letras de “A” a “F,” correspondem a unidades manufaturadas em Belo Horizonte, enquanto os códigos que contém letras de “G” a “Z” dizem respeito a unidades fabricadas na região de São Paulo.</p>
<p>Com isso em mente, para reunirmos todos os códigos de produtos construídos em Belo Horizonte, precisaríamos apenas encontrar os códigos que contém qualquer letra dentro do intervalo de “A” e “F.” Todavia, repare que a capitalização das letras presentes nos códigos, varia. Por isso, precisamos combinar o mesmo intervalo de letras em ambos os estilos de capitalização. Dessa maneira, geramos a expressão abaixo, que contém ambos os intervalos (<code>"[a-fA-F]"</code>).</p>
<p></p>
<div class="sourceCode" id="cb1095"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1095-1"><a href="#cb1095-1" aria-hidden="true" tabindex="-1"></a>codes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;AeF15&quot;</span>, <span class="st">&quot;CCd31&quot;</span>, <span class="st">&quot;17GHJ&quot;</span>, <span class="st">&quot;Lmm96&quot;</span>, <span class="st">&quot;ee3f8&quot;</span>, <span class="st">&quot;BA45B&quot;</span>,</span>
<span id="cb1095-2"><a href="#cb1095-2" aria-hidden="true" tabindex="-1"></a>           <span class="st">&quot;EccF2&quot;</span>, <span class="st">&quot;675Cc&quot;</span>, <span class="st">&quot;hkJ78&quot;</span>, <span class="st">&quot;q401Q&quot;</span>, <span class="st">&quot;iop67&quot;</span>, <span class="st">&quot;DCa98&quot;</span>)</span>
<span id="cb1095-3"><a href="#cb1095-3" aria-hidden="true" tabindex="-1"></a>teste <span class="ot">&lt;-</span> <span class="fu">str_detect</span>(codes, <span class="st">&quot;[a-fA-F]&quot;</span>)</span>
<span id="cb1095-4"><a href="#cb1095-4" aria-hidden="true" tabindex="-1"></a>codes[teste]</span></code></pre></div>
<pre><code>## [1] &quot;AeF15&quot; &quot;CCd31&quot; &quot;ee3f8&quot; &quot;BA45B&quot; &quot;EccF2&quot; &quot;675Cc&quot; &quot;DCa98&quot;</code></pre>
<p></p>
<div id="conclusão-e-algumas-dicas-extras" class="section level4" number="10.8.5.1">
<h4 number="10.8.5.1"><span class="header-section-number">10.8.5.1</span> Conclusão e algumas dicas extras</h4>
<p>Portanto, uma classe de caracteres busca listar os caracteres que podem ou não ser encontrados na posição da sequência que essa classe representa. Em síntese, podemos interpretar o seu uso da seguinte maneira:</p>
<ul>
<li><p><code>[abc]</code>: encontre <code>a</code> ou <code>b</code> ou <code>c</code>.</p></li>
<li><p><code>[^abc]</code>: encontre qualquer caractere, exceto <code>a</code>, <code>b</code> ou <code>c</code>.</p></li>
</ul>
<p>Além disso, uma classe de caracteres lhe permite criar <em>ranges</em>, ou intervalos de caracteres possíveis, como:</p>
<ul>
<li><p><code>[0-9]</code>: encontre qualquer número entre 0 e 9.</p></li>
<li><p><code>[a-z]</code>: encontre qualquer letra (minúscula) entre <code>a</code> e <code>z</code>.</p></li>
<li><p><code>[A-Z]</code>: encontre qualquer letra (maiúscula) entre <code>A</code> e <code>Z</code>.</p></li>
</ul>
<p>Porém, para além dos usos apresentados até aqui, o R nos oferece alguns atalhos para essas construções, sendo os principais:</p>
<ul>
<li><p><code>\d</code>: encontre um dígito (atalho para <code>[0-9]</code>).</p></li>
<li><p><code>\s</code>: encontre qualquer espaço em branco (atalho para <code>[ \t\n]</code>).</p></li>
<li><p><code>\w</code>: encontre um caractere alfanumérico ou um <em>underline</em> (atalho para <code>[a-zA-Z0-9_]</code>)</p></li>
</ul>
<p>Lembre-se que, no R, para inserirmos uma barra inclinada à esquerda em uma <em>string</em>, nós precisamos escrever duas barras inclinadas à esquerda. Logo, para inserirmos, por exemplo, o atalho <code>\d</code> em alguma de nossas expressões regulares, somos obrigados a digitar <code>\\d</code>.</p>
</div>
</div>
<div id="representando-qualquer-caractere-com-um-ponto" class="section level3" number="10.8.6">
<h3 number="10.8.6"><span class="header-section-number">10.8.6</span> Representando qualquer caractere com um ponto</h3>
<p>Você pode representar qualquer caractere em uma expressão regular, por meio do <em>metacharacter</em> <code>.</code> (ponto final). Ou seja, um ponto final em uma expressão regular é capaz de encontrar qualquer caractere (seja ele um número, um símbolo ou uma letra) na posição que ele representa. Logo, a expressão <code>"B.3"</code> significa na prática: uma letra “B,” imediatamente seguida por um caractere qualquer, que por sua vez, é imediatamente seguido por um número 3.</p>
<p>Por exemplo, suponha que você queira encontrar a data “20/02/2019,” mas você sabe que essa data pode se encontrar em diferentes formatos, como 20.02.2019, ou 20-02-2019. Tendo isso em mente, você provavelmente tentaria uma expressão como <code>"20[-/.]02[-/.]2019"</code>. Por outro lado, poderíamos atingir o mesmo resultado ao substituirmos as classes de caracteres por pontos finais, gerando assim, a expressão <code>"20.02.2019"</code>.</p>
<p></p>
<div class="sourceCode" id="cb1097"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1097-1"><a href="#cb1097-1" aria-hidden="true" tabindex="-1"></a>vec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;20.02.2019&quot;</span>, <span class="st">&quot;20-02-2019&quot;</span>, <span class="st">&quot;20/02/2019&quot;</span>,</span>
<span id="cb1097-2"><a href="#cb1097-2" aria-hidden="true" tabindex="-1"></a>         <span class="st">&quot;A senha é 2060212019&quot;</span>, <span class="st">&quot;20$02#2019&quot;</span>)</span>
<span id="cb1097-3"><a href="#cb1097-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1097-4"><a href="#cb1097-4" aria-hidden="true" tabindex="-1"></a>teste <span class="ot">&lt;-</span> <span class="fu">str_detect</span>(vec, <span class="st">&quot;20.02.2019&quot;</span>)</span>
<span id="cb1097-5"><a href="#cb1097-5" aria-hidden="true" tabindex="-1"></a>vec[teste]</span></code></pre></div>
<pre><code>## [1] &quot;20.02.2019&quot;           &quot;20-02-2019&quot;           &quot;20/02/2019&quot;          
## [4] &quot;A senha é 2060212019&quot; &quot;20$02#2019&quot;</code></pre>
<p></p>
<p>Porém, é importante que você tenha cuidado ao utilizar esse <em>metacharacter</em>. Pois como podemos ver acima, a expressão <code>"20.02.2019"</code> também é capaz de encontrar o texto “<strong>20$02#2019</strong>,” assim como o texto “A senha é <strong>2060212019</strong>.” Portanto, as chances de você encontrar o que você não deseja, podem aumentar a depender da maneira em que você aplica esse <em>metacharacter</em> em sua expressão.</p>
</div>
<div id="criando-alternativas-alternation" class="section level3" number="10.8.7">
<h3 number="10.8.7"><span class="header-section-number">10.8.7</span> Criando alternativas (<em>alternation</em>)</h3>
<p>Há certos momentos, em que não conseguimos expor todos os nossos desejos com uma única expressão. Por essa razão, temos o <em>metacharacter</em> <code>|</code> (barra vertical) que nos permite combinar diferentes sub expressões em uma só. Dessa maneira, a função responsável pela pesquisa, irá procurar por qualquer texto que atenda a pelo menos uma dessas sub expressões. Sendo este efeito, comumente denominado de alternação (ou <em>alternation</em>).</p>
<p>Como exemplo, na seção anterior estávamos tentando encontrar o termo <em>regex</em>, ao longo de várias sentenças, que estão reproduzidas logo abaixo, no vetor <code>texto</code>. Na primeira instância, fizemos uso de uma classe de caracter para permitirmos uma letra “r” tanto minúscula quanto maiúscula, no primeiro caractere da sequência de nossa expressão (<code>"[Rr]egex"</code>).</p>
<p>Porém, temos a capacidade de atingir o mesmo resultado, com o uso de alternação. Basta separarmos os dois casos que estamos tentando representar, pelo <em>metacharacter</em> <code>|</code>, formando assim, a expressão abaixo (<code>"Regex|regex"</code>):</p>
<p></p>
<div class="sourceCode" id="cb1099"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1099-1"><a href="#cb1099-1" aria-hidden="true" tabindex="-1"></a>texto <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb1099-2"><a href="#cb1099-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Cada letra, número, ou símbolo presente no texto é um caractere.&quot;</span>,</span>
<span id="cb1099-3"><a href="#cb1099-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Textos são criados ao contornados por aspas (duplas ou simples).&quot;</span>,</span>
<span id="cb1099-4"><a href="#cb1099-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;O termo regex é uma abreviação para regular expressions.&quot;</span>,</span>
<span id="cb1099-5"><a href="#cb1099-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Regex é um termo comum no mundo da computação.&quot;</span>,</span>
<span id="cb1099-6"><a href="#cb1099-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Metacharacters alteram consideravelmente o comportamento de um REGEX.&quot;</span>,</span>
<span id="cb1099-7"><a href="#cb1099-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;ReGEx? Ou reGex? Talvez RegEX?.&quot;</span></span>
<span id="cb1099-8"><a href="#cb1099-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1099-9"><a href="#cb1099-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1099-10"><a href="#cb1099-10" aria-hidden="true" tabindex="-1"></a>teste <span class="ot">&lt;-</span> <span class="fu">str_detect</span>(texto, <span class="st">&quot;Regex|regex&quot;</span>)</span>
<span id="cb1099-11"><a href="#cb1099-11" aria-hidden="true" tabindex="-1"></a>texto[teste]</span></code></pre></div>
<pre><code>## [1] &quot;O termo regex é uma abreviação para regular expressions.&quot;
## [2] &quot;Regex é um termo comum no mundo da computação.&quot;</code></pre>
<p></p>
<p>Lembre-se que a realidade dentro de uma classe de caracteres é completamente diferente de seu exterior. Logo, dentro de uma classe de caracteres, o caractere <code>|</code> é simplesmente um caractere literal, assim como as letras “x” e “r.” Por isso, uma expressão como <code>"Rege[x|r]egex"</code>, estaria na verdade procurando por sequências como “R-e-g-e-x-e-g-e-x,” “R-e-g-e-|-e-g-e-x” e “R-e-g-e-r-e-g-e-x.”</p>
<p>Para mais, é importante que você entenda que cada sub expressão conectada pelo <em>metacharacter</em> <code>|</code>, representa uma expressão regular diferente das demais.</p>
<p>Veja como exemplo, a expressão abaixo. A primeira sub expressão (<code>"[3-6]°"</code>) seleciona um texto que contenha um número entre 3 e 6 imediatamente seguido de um símbolo de grau. A segunda sub expressão (<code>"is[ao]"</code>) seleciona um texto que contenha a sequência “i-s-a” ou “i-s-o” de caracteres. Já a terceira sub expressão (<code>R\\$[0-9]+(,[0-9][0-9])?</code>), que é bem mais elaborada do que as outras duas, busca selecionar um texto que contenha um valor monetário. Com isso, qualquer texto que se encaixe em alguma dessas condições, será selecionado pela função.</p>
<p></p>
<div class="sourceCode" id="cb1101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1101-1"><a href="#cb1101-1" aria-hidden="true" tabindex="-1"></a>vec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;1230&quot;</span>, <span class="st">&quot;Tenho consulta no dia 25&quot;</span>, <span class="st">&quot;R$12,45&quot;</span>, </span>
<span id="cb1101-2"><a href="#cb1101-2" aria-hidden="true" tabindex="-1"></a>         <span class="st">&quot;Essa máquina custa R$320,21&quot;</span>, <span class="st">&quot;Márcia&quot;</span>, <span class="st">&quot;Isotônico&quot;</span>,</span>
<span id="cb1101-3"><a href="#cb1101-3" aria-hidden="true" tabindex="-1"></a>         <span class="st">&quot;Álcool isopropílico&quot;</span>, <span class="st">&quot;Hoje fez 30°&quot;</span>, <span class="st">&quot;4° é muito frio!&quot;</span>)</span>
<span id="cb1101-4"><a href="#cb1101-4" aria-hidden="true" tabindex="-1"></a>teste <span class="ot">&lt;-</span> <span class="fu">str_detect</span>(vec, <span class="st">&quot;[3-6]°|is[ao]|R</span><span class="sc">\\</span><span class="st">$[0-9]+(,[0-9][0-9])?&quot;</span>)</span>
<span id="cb1101-5"><a href="#cb1101-5" aria-hidden="true" tabindex="-1"></a>vec[teste]</span></code></pre></div>
<pre><code>## [1] &quot;R$12,45&quot;                     &quot;Essa máquina custa R$320,21&quot;
## [3] &quot;Álcool isopropílico&quot;         &quot;4° é muito frio!&quot;</code></pre>
<p></p>
<p>Um outro detalhe importante, é que você pode limitar o alcance das alternativas, ao contorná-las com parênteses. Em outras palavras, ao invés de fornecer várias sub expressões, você pode fornecer diferentes sub expressões <strong>dentro</strong> de uma expressão “geral.”</p>
<p>Por exemplo, vamos voltar à expressão <code>"Regex|regex"</code>. Se nós isolarmos a seção <code>"ex|re"</code>, temos um resultado completamente diferente do que vimos anteriormente, pois as sub expressões passam a ser “e-x” e “r-e,” e não “r-e-g-e-x” e “R-e-g-e-x” como anteriormente. Dessa maneira, estamos na verdade procurando por textos que contenham a sequência “R-e-g-e-x-g-e-x” ou a sequência “R-e-g-r-e-g-e-x.”</p>
<p></p>
<div class="sourceCode" id="cb1103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1103-1"><a href="#cb1103-1" aria-hidden="true" tabindex="-1"></a>vec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;regex&quot;</span>, <span class="st">&quot;Regex&quot;</span>, <span class="st">&quot;ISORegex-18930&quot;</span>, <span class="st">&quot;Regexgexgexgexgex&quot;</span>)</span>
<span id="cb1103-2"><a href="#cb1103-2" aria-hidden="true" tabindex="-1"></a>teste <span class="ot">&lt;-</span> <span class="fu">str_detect</span>(vec, <span class="st">&quot;Reg(ex|re)gex&quot;</span>)</span>
<span id="cb1103-3"><a href="#cb1103-3" aria-hidden="true" tabindex="-1"></a>vec[teste]</span></code></pre></div>
<pre><code>## [1] &quot;Regexgexgexgexgex&quot;</code></pre>
<p></p>
<p>Dessa vez, importando um exemplo diretamente da obra de <span class="citation"><a href="#ref-friedl2006" role="doc-biblioref">Friedl</a> (<a href="#ref-friedl2006" role="doc-biblioref">2006</a>)</span>, suponha que você possua um arquivo de texto, contendo uma lista de todos os e-mails de sua caixa de entrada. Com esse arquivo, poderíamos utilizar a expressão <code>"^(From|Subject|Date):"</code> para extraírmos apenas as linhas do arquivo que contém a referência do remetente (<code>From:</code>), do assunto (<code>Subject:</code>) e da data de envio (<code>Date:</code>) de cada e-mail. Perceba também, que a expressão <code>"^(From|Subject|Date):"</code> é equivalente à expressão <code>"^From:|^Subject:|^Date:"</code>.</p>
<p></p>
<div class="sourceCode" id="cb1105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1105-1"><a href="#cb1105-1" aria-hidden="true" tabindex="-1"></a>email <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_lines</span>(<span class="st">&quot;</span></span>
<span id="cb1105-2"><a href="#cb1105-2" aria-hidden="true" tabindex="-1"></a><span class="st">From: elena_campaio@gmail.com Jun 15 2019 07:05</span></span>
<span id="cb1105-3"><a href="#cb1105-3" aria-hidden="true" tabindex="-1"></a><span class="st">Received: from elena_campaio@gmail.com</span></span>
<span id="cb1105-4"><a href="#cb1105-4" aria-hidden="true" tabindex="-1"></a><span class="st">To: pedropark99@gmail.com</span></span>
<span id="cb1105-5"><a href="#cb1105-5" aria-hidden="true" tabindex="-1"></a><span class="st">Date: Thu, Jun 15 2019 07:05</span></span>
<span id="cb1105-6"><a href="#cb1105-6" aria-hidden="true" tabindex="-1"></a><span class="st">Message-Id: &lt;20190322145154232.elena_campaio@gmail.com&gt;</span></span>
<span id="cb1105-7"><a href="#cb1105-7" aria-hidden="true" tabindex="-1"></a><span class="st">Subject: Nova reunião</span></span>
<span id="cb1105-8"><a href="#cb1105-8" aria-hidden="true" tabindex="-1"></a><span class="st">X-Mailer: by mailbox (Version 8.5.1) BellM Company, Copyright 2005-2019</span></span>
<span id="cb1105-9"><a href="#cb1105-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1105-10"><a href="#cb1105-10" aria-hidden="true" tabindex="-1"></a><span class="st">Bom dia Pedro, poderíamos nos encontrar às 10hrs?</span></span>
<span id="cb1105-11"><a href="#cb1105-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1105-12"><a href="#cb1105-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1105-13"><a href="#cb1105-13" aria-hidden="true" tabindex="-1"></a><span class="st">From: pedropark99@gmail.com Jun 15 2019 08:10 </span></span>
<span id="cb1105-14"><a href="#cb1105-14" aria-hidden="true" tabindex="-1"></a><span class="st">Received: from elena_campaio@gmail.com</span></span>
<span id="cb1105-15"><a href="#cb1105-15" aria-hidden="true" tabindex="-1"></a><span class="st">To: elena_campaio@gmail.com</span></span>
<span id="cb1105-16"><a href="#cb1105-16" aria-hidden="true" tabindex="-1"></a><span class="st">Date: Thu, Jun 15 2019 08:10</span></span>
<span id="cb1105-17"><a href="#cb1105-17" aria-hidden="true" tabindex="-1"></a><span class="st">Message-Id: &lt;20190322145155198.elena_campaio@gmail.com&gt;</span></span>
<span id="cb1105-18"><a href="#cb1105-18" aria-hidden="true" tabindex="-1"></a><span class="st">Subject: Re: Nova reunião</span></span>
<span id="cb1105-19"><a href="#cb1105-19" aria-hidden="true" tabindex="-1"></a><span class="st">Reply-To: elena_campaio@gmail.com &lt;20190322145154232.elena_campaio@gmail&gt;</span></span>
<span id="cb1105-20"><a href="#cb1105-20" aria-hidden="true" tabindex="-1"></a><span class="st">X-Mailer: by mailbox (Version 8.5.1) BellM Company, Copyright 2005-2019</span></span>
<span id="cb1105-21"><a href="#cb1105-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1105-22"><a href="#cb1105-22" aria-hidden="true" tabindex="-1"></a><span class="st">Ok Elena! Podemos nos encontrar esse horário.&quot;</span>)</span>
<span id="cb1105-23"><a href="#cb1105-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1105-24"><a href="#cb1105-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1105-25"><a href="#cb1105-25" aria-hidden="true" tabindex="-1"></a>teste <span class="ot">&lt;-</span> <span class="fu">str_detect</span>(email, <span class="st">&quot;^(From|Subject|Date):&quot;</span>)</span>
<span id="cb1105-26"><a href="#cb1105-26" aria-hidden="true" tabindex="-1"></a>email[teste]</span></code></pre></div>
<p></p>
<pre><code>## [1] &quot;From: elena_campaio@gmail.com Jun 15 2019 07:05&quot;
## [2] &quot;Date: Thu, Jun 15 2019 07:05&quot;
## [3] &quot;Subject: Nova reunião&quot;
## [4] &quot;From: pedropark99@gmail.com Jun 15 2019 08:10 &quot;
## [5] &quot;Date: Thu, Jun 15 2019 08:10&quot;
## [6] &quot;Subject: Re: Nova reunião&quot;</code></pre>
</div>
<div id="quantificadores-quantifiers-ou-definindo-repetições" class="section level3" number="10.8.8">
<h3 number="10.8.8"><span class="header-section-number">10.8.8</span> Quantificadores (<em>quantifiers</em>) ou definindo repetições</h3>
<p>Há certos momentos em que precisamos permitir que um certo conjunto de caracteres sejam encontrados múltiplas vezes em uma mesma sequência de caracteres. Um bom exemplo disso, é a expressão que utilizamos na seção anterior <code>"R\\$[0-9]+(,[0-9][0-9])?"</code> para encontrarmos um valor monetário. Temos três partes principais nessa expressão, sendo elas: 1) <code>R\\$</code>; 2) <code>[0-9]+</code>; e 3) <code>(,[0-9][0-9])?</code>.</p>
<p>Primeiro, o que seria um valor monetário? Certamente seria um valor numérico. Porém, um número pode significar qualquer coisa! Talvez uma medida de peso (Kg), idade (anos), volume (L) ou qualquer outra variável contínua que você imaginar. Logo, precisamos de algum item que possa identificar esse número como uma medida de valor, e esse item se trata do símbolo da moeda brasileira (R$). Qualquer valor numérico presente em seu texto que estiver acompanhado desse símbolo é um valor monetário.</p>
<p>Com isso, teríamos a expressão <code>"R\\$[0-9]"</code> como uma tentativa inicial. Perceba que eu tive de contornar o comportamento especial do <em>metacharacter</em> <code>$</code>, ao antecedê-lo por duas barras inclinadas. Dessa maneira, a expressão <code>"\\$"</code> significa de fato o caractere <code>$</code> (cifrão), e não o fim de uma linha como definimos na seção <a href="#sec:regex_ancoras">Âncoras (<em>anchors</em>)</a>.</p>
<p></p>
<div class="sourceCode" id="cb1107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1107-1"><a href="#cb1107-1" aria-hidden="true" tabindex="-1"></a>vec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Eu peso em torno de 65Kg&quot;</span>, <span class="st">&quot;Tenho consulta no dia 25&quot;</span>,</span>
<span id="cb1107-2"><a href="#cb1107-2" aria-hidden="true" tabindex="-1"></a>         <span class="st">&quot;R$1630,45&quot;</span>, <span class="st">&quot;Eu possuo uma conta de R$74,85 a pagar&quot;</span>, </span>
<span id="cb1107-3"><a href="#cb1107-3" aria-hidden="true" tabindex="-1"></a>         <span class="st">&quot;R$400&quot;</span>, <span class="st">&quot;R21&quot;</span>, <span class="st">&quot;Hoje, R$30 equivale a $5,77 dólares&quot;</span>)</span>
<span id="cb1107-4"><a href="#cb1107-4" aria-hidden="true" tabindex="-1"></a>teste <span class="ot">&lt;-</span> <span class="fu">str_detect</span>(vec, <span class="st">&quot;R</span><span class="sc">\\</span><span class="st">$[0-9]&quot;</span>)</span>
<span id="cb1107-5"><a href="#cb1107-5" aria-hidden="true" tabindex="-1"></a>vec[teste]</span></code></pre></div>
<pre><code>## [1] &quot;R$1630,45&quot;                             
## [2] &quot;Eu possuo uma conta de R$74,85 a pagar&quot;
## [3] &quot;R$400&quot;                                 
## [4] &quot;Hoje, R$30 equivale a $5,77 dólares&quot;</code></pre>
<p></p>
<p>Entretanto, não há um limite específico para o número que um valor monetário pode atingir. Em outras palavras, podemos estar nos referindo a míseros centavos ou a milhões de reais. Traduzindo essa afirmação na prática, podemos ter uma quantidade variável de dígitos em nosso valor monetário. O valor R$5 possui apenas 1 dígito, enquanto o valor R$1245 possui 4 dígitos.</p>
<p>A princípio, essa questão não é tão importante, já que fomos capazes de encontrar todos os textos que contém algum valor monetário, com apenas a expressão <code>"R\\$[0-9]"</code>. Ou seja, mesmo que alguns desses valores possuam 3, 4 ou 6 dígitos, precisamos apenas detectar o seu primeiro dígito antecedido pelo símbolo R$.</p>
<p>Todavia, essa questão passa a ser crucial, na hipótese de aplicarmos alguma transformação sobre os valores monetários encontrados. Ou seja, se vamos, por exemplo, extrair os valores encontrados; ou substituí-los por algum outro texto; ou utilizá-los como pontos de quebra do texto que os contém; ou empregá-los em algum cálculo, é de extrema importância que possamos detectar todo o valor com a nossa expressão. Apenas para que fique claro, veja a representação abaixo, que mostra os resultados de ambas as expressões mostradas até aqui sobre o valor R$6530,58.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/regex_1.png" alt="Expressões regulares sobre valores monetários" width="90%" />
<p class="caption">
(#fig:unnamed-chunk-630)Expressões regulares sobre valores monetários
</p>
</div>
<p></p>
<p>Tendo como início, a expressão <code>"R\\$[0-9]"</code>, precisamos permitir uma quantidade variável de dígitos, mais especificamente na parte <code>"[0-9]"</code>. Em ocasiões como essa, nós podemos utilizar os <em>metacharacters</em> do tipo quantificadores, que incluem os caracteres <code>?</code> (ponto de interrogação), <code>+</code> (sinal de mais), <code>*</code> (asterisco) e <code>{}</code> (par de chaves). Como o próprio nome do tipo dá a entender, esses <em>metacharacters</em> buscam delimitar a quantidade de vezes que podemos encontrar um certo caractere em nossa sequência. Em outras palavras, esses <em>metacharacters</em> definem o número mínimo e máximo de ocorrências possíveis para um caractere específico de nossa expressão.</p>
<p>Primeiro, o <em>metacharacter</em> <code>*</code> representa 0 ocorrências como mínimo e infinitas ocorrências como máximo. Com isso, podemos dizer que o <em>metacharacter</em> <code>*</code> significa: “tente encontrar esse caractere, o maior número de vezes possíveis, contudo, está tudo bem se não conseguirmos encontrá-lo em algum lugar.” Logo, a expressão <code>"A6*"</code> nos permite encontrar uma letra “A,” quando acompanhada, por exemplo, pelo “número do diabo” (“<strong>A666</strong>”), ou por qualquer outra quantidade do número 6, como o texto “<strong>A6</strong>,” ou “<strong>A6666666</strong>.” Porém, o <em>metacharacter</em> <code>*</code> também nos dá a possibilidade de não encontrarmos o número 6. Por isso, a expressão <code>"A6*"</code> também é capaz de encontrar o texto “<strong>A</strong>na Luísa,” mesmo que ele não possua um número 6.</p>
<p>Segundo, o <em>metacharacter</em> <code>+</code> representa 1 ocorrência como mínimo e infinitas ocorrências como máximo. Por consequência, o <em>metacharacter</em> <code>+</code> expressa: “tente encontrar esse caractere pelo menos uma vez!” Como exemplo, a expressão <code>"Isa+"</code> é capaz de encontrar os textos “<strong>Isa</strong>dora,” “<strong>Isaa</strong>c Newton” e “<strong>Isaaaaaa</strong>3210.” Mas não é capaz de encontrar o texto “Isótopo,” pois esse texto não possui pelo menos um “a” logo após os caracteres “Is.”</p>
<p>Terceiro, o <em>metacharacter</em> <code>?</code> representa 0 repetições como mínimo e 1 repetição como máximo. Isto é, o <em>metacharacter</em> <code>?</code> busca tornar um caractere completamente opcional. Em outras palavras, ao conectarmos um caractere ou uma sub expressão ao <em>metacharacter</em> <code>?</code> estamos dizendo algo como: “se esse caractere for encontrado, ótimo! Se não, sem problemas!” Como exemplo, a expressão <code>"dr?a"</code> busca encontrar uma letra “d” imediatamente seguida pelos caracteres “ra.” Mas pelo fato de termos incluído o <em>metacharacter</em> <code>?</code> logo à frente da letra “r,” tornamos essa letra opcional. Por isso, a expressão <code>"dr?a"</code> é capaz de encontrar textos como “engen<strong>dra</strong>r,” “<strong>dra</strong>gão” ou “<strong>dra</strong>min,” assim como os textos “A<strong>da</strong>ga” e “reciproci<strong>da</strong>de.”</p>
<p>Quarto, o <em>metacharacter</em> <code>{}</code> representa a forma geral de um quantificador. Pois ele nos permite especificar exatamente quais as quantidades mínima e máxima que desejamos para um determinado caractere. Basta preencher o par de chaves com essas duas quantidades, separadas por uma vírgula (<code>{min, max}</code>). Por exemplo, a expressão <code>"31[0-9]{4,5}"</code> é capaz de encontrar um código do IBGE referente a um município do estado de Minas Gerais (os dígitos <code>31</code> representam o código do estado de MG). Esses códigos do IBGE possuem uma versão curta, que pode variar de 2 a 4 dígitos, entretanto, suas versões mais comumente utilizadas são as de 6 e de 7 dígitos. Como exemplo, os códigos 310620 e 3106200
se referem ao município de Belo Horizonte. Com isso, ao estabelecermos 4 e 5 dígitos como os limites do intervalo representado pela sub expressão <code>[0-9]{4,5}</code>, somos capazes de detectar códigos como <strong>310620</strong> e <strong>3106200</strong>, e ao mesmo tempo, descartar códigos como 31062, que possui menos de 4 dígitos após os dígitos 31.</p>
<p>Além disso, vale destacar que o objetivo de qualquer <em>metacharacter</em> do tipo quantificador, não é o de determinar o número de vezes que um caractere pode aparecer ao <strong>longo do texto</strong>, mas sim, o número de vezes que um caractere pode ocorrer <strong>em sequência</strong>. Por exemplo, a expressão <code>"(25){2,3}"</code> busca detectar um número arbitrário de 25’s. Assim sendo, essa expressão é capaz de detectar valores como <strong>25</strong>, <strong>25</strong>2, e <strong>2525</strong>, da mesma maneira que o texto “Estive na <strong>25</strong> de Março no último dia 25.”</p>
<p>Porém, muitas pessoas interpretam que os dois 25’s presentes no texto “Estive na 25 de Março no último dia 25” são detectados pela expressão <code>"(25){2,3}"</code>, quando na verdade, apenas o primeiro 25 é localizado. Pois o segundo 25 no texto, se encontra a mais de 20 caracteres a frente do primeiro 25. Logo, ao utilizarmos um <em>metacharacter</em> do tipo quantificador, estamos geralmente preocupados com a possibilidade de o mesmo caractere aparecer múltiplas vezes em sequência (um atrás do outro).</p>
<p>Voltando à expressão <code>"R\\$[0-9]"</code>, com tudo o que descrevi nos parágrafos anteriores, nós podemos adicionar um <code>+</code> logo após <code>[0-9]</code>. Dessa maneira, estamos desejando encontrar <strong>pelo menos</strong> um número qualquer entre 0 e 9, logo após o símbolo monetário R$. Com isso, temos a expressão <code>"R\\$[0-9]+"</code>, que é capaz de encontrar tanto “R$3” quanto “R$3050.”</p>
<p>No entanto, ainda temos a possibilidade de encontrarmos um valor monetário que inclui centavos. Ou seja, podemos encontrar um número que seja seguido por uma vírgula e dois outros dígitos que definem os centavos. Por isso, podemos ainda acrescentar a parte <code>",[0-9][0-9]"</code> para captar essa possível parte de nosso valor monetário.</p>
<p></p>
<div class="sourceCode" id="cb1109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1109-1"><a href="#cb1109-1" aria-hidden="true" tabindex="-1"></a>vec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;8730&quot;</span>, <span class="st">&quot;R$21&quot;</span>, <span class="st">&quot;R$3120,50&quot;</span>, <span class="st">&quot;R$43026&quot;</span>, <span class="st">&quot;R$45,10&quot;</span>)</span>
<span id="cb1109-2"><a href="#cb1109-2" aria-hidden="true" tabindex="-1"></a>teste <span class="ot">&lt;-</span> <span class="fu">str_detect</span>(vec, <span class="st">&quot;R</span><span class="sc">\\</span><span class="st">$[0-9]+,[0-9][0-9]&quot;</span>)</span>
<span id="cb1109-3"><a href="#cb1109-3" aria-hidden="true" tabindex="-1"></a>vec[teste]</span></code></pre></div>
<pre><code>## [1] &quot;R$3120,50&quot; &quot;R$45,10&quot;</code></pre>
<p></p>
<p>Porém, repare ainda, que ao adicionarmos a seção <code>",[0-9][0-9]"</code>, a nossa expressão regular não é mais capaz de detectar valores que não possuem uma parte para os centavos, como R$21 e R$43026. É por essa razão, que eu contorno essa seção por parênteses, e adiciono o <em>metacharacter</em> <code>?</code> logo em seguida. Pois dessa forma, essa seção passa a ser opcional. Ou seja, a parte dos centavos deixa de ser obrigatória.</p>
<p></p>
<div class="sourceCode" id="cb1111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1111-1"><a href="#cb1111-1" aria-hidden="true" tabindex="-1"></a>vec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;8730&quot;</span>, <span class="st">&quot;R$21&quot;</span>, <span class="st">&quot;R$3120,50&quot;</span>, <span class="st">&quot;R$43026&quot;</span>, <span class="st">&quot;R$45,10&quot;</span>)</span>
<span id="cb1111-2"><a href="#cb1111-2" aria-hidden="true" tabindex="-1"></a>teste <span class="ot">&lt;-</span> <span class="fu">str_detect</span>(vec, <span class="st">&quot;R</span><span class="sc">\\</span><span class="st">$[0-9]+(,[0-9][0-9])?&quot;</span>)</span>
<span id="cb1111-3"><a href="#cb1111-3" aria-hidden="true" tabindex="-1"></a>vec[teste]</span></code></pre></div>
<pre><code>## [1] &quot;R$21&quot;      &quot;R$3120,50&quot; &quot;R$43026&quot;   &quot;R$45,10&quot;</code></pre>
<p></p>
<div id="conclusão-e-algumas-dicas-extras-1" class="section level4" number="10.8.8.1">
<h4 number="10.8.8.1"><span class="header-section-number">10.8.8.1</span> Conclusão e algumas dicas extras</h4>
<p>Recapitulando o que vimos até aqui, temos que os números de ocorrências representados por cada <em>metacharacter</em> do tipo “quantificador” são:</p>
<ul>
<li><p><code>?</code>: 0 ou 1 ocorrência.</p></li>
<li><p><code>+</code>: 1 ou mais ocorrências.</p></li>
<li><p><code>*</code>: 0 ou mais ocorrências.</p></li>
<li><p><code>{min, max}</code>: entre <code>min</code> e <code>max</code> ocorrências.</p></li>
</ul>
<p>Para além do que ainda não foi comentado nessa seção, você pode utilizar novamente o <em>metacharacter</em> <code>{}</code>, para especificar um número específico de ocorrências que você deseja para um caractere, ou então, definir apenas o número mínimo ou o número máximo de repetições. Com isso, temos que:</p>
<ul>
<li><p><code>{n}</code>: exatamente <code>n</code> ocorrências.</p></li>
<li><p><code>{min,}</code>: pelo menos <code>min</code> ocorrências.</p></li>
<li><p><code>{,max}</code>: até <code>max</code> ocorrências.</p></li>
</ul>
</div>
</div>
<div id="determinando-os-limites-de-uma-palavra" class="section level3" number="10.8.9">
<h3 number="10.8.9"><span class="header-section-number">10.8.9</span> Determinando os limites de uma palavra</h3>
<p>Como estabelecemos anteriormente, expressões regulares não tem a capacidade de diferenciar palavras, e muito menos, de identificar os seus limites. Por essa razão, para termos garantia de que vamos encontrar uma palavra específica no resultado de uma expressão regular, precisamos estabelecer limites para a pesquisa.</p>
<p>Na seção sobre <a href="#sec:regex_ancoras">Âncoras (<em>anchors</em>)</a>, utilizamos os <em>metacharacters</em> do tipo âncora (<code>^</code> e <code>$</code>) para estipularmos os limites da palavra a ser pesquisada. Porém, esses <em>metacharacters</em> <strong>não foram criados para esse objetivo</strong>. Essa afirmação fica clara, ao retornarmos ao exemplo utilizado na seção supracitada.</p>
<p>Naquela ocasião, estávamos tentando encontrar todos os textos contidos no vetor <code>text</code>, que possuíssem a palavra “emissão.” Entretanto, ao utilizarmos a expressão <code>"^emissão$"</code>, fomos capazes de encontrar apenas o primeiro elemento de <code>text</code>. Sendo que, de acordo com o nosso objetivo, também desejamos localizar o quarto, quinto e sexto elementos de <code>text</code>. Pois eles também possuem a palavra “emissão” em alguma instância.</p>
<p></p>
<div class="sourceCode" id="cb1113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1113-1"><a href="#cb1113-1" aria-hidden="true" tabindex="-1"></a>text <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb1113-2"><a href="#cb1113-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;emissão&quot;</span>,</span>
<span id="cb1113-3"><a href="#cb1113-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;A Ford Brasil executou recentemente uma demissão em massa&quot;</span>,</span>
<span id="cb1113-4"><a href="#cb1113-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;remissão&quot;</span>,</span>
<span id="cb1113-5"><a href="#cb1113-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Para mais, a emissão de CO2 cresceu no Brasil&quot;</span>,</span>
<span id="cb1113-6"><a href="#cb1113-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;emissão de S02 faz parte do processo&quot;</span>,</span>
<span id="cb1113-7"><a href="#cb1113-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;A firma foi processada por tal emissão&quot;</span></span>
<span id="cb1113-8"><a href="#cb1113-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1113-9"><a href="#cb1113-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1113-10"><a href="#cb1113-10" aria-hidden="true" tabindex="-1"></a>teste <span class="ot">&lt;-</span> <span class="fu">str_detect</span>(text, <span class="st">&quot;^emissão$&quot;</span>)</span>
<span id="cb1113-11"><a href="#cb1113-11" aria-hidden="true" tabindex="-1"></a>text[teste]</span></code></pre></div>
<pre><code>## [1] &quot;emissão&quot;</code></pre>
<p></p>
<p>Por isso, precisamos de uma nova estratégia para estipularmos esses limites. Lembre-se que uma expressão regular, nada mais é, do que uma descrição concisa de uma sequência específica de caracteres. Logo, precisamos encontrar alguma forma de descrevermos os caracteres que podem representar os limites de uma palavra.</p>
<p>Todavia, para isso, nós precisamos primeiro identificar o que é o limite de uma palavra. Ou redefinindo a questão, o que exatamente separa uma palavra das demais? Com algum tempo de reflexão, você talvez chegue a conclusão de que o que separa uma palavra da outra, são espaços em branco, ou então, símbolos de pontuação, como um ponto final, ou uma vírgula.</p>
<p>Portanto, precisamos incluir em ambos os lados da palavra “emissão” alguma expressão que possa descrever especificamente esses caracteres, como a expressão <code>"(\\s|[!.,?])"</code>. Repare que o par de parênteses nessa expressão, busca apenas limitar o alcance do <em>metacharacter</em> <code>|</code>, que está separando duas alternativas, ou duas sub expressões (<code>\\s</code> e <code>[!.,?]</code>) que podem descrever os caracteres de nosso interesse. Lembre-se que o termo <code>\\s</code> representa o comando <code>\s</code>, que é um atalho para uma classe de caracteres que busca localizar qualquer tipo de espaço em branco.</p>
<p></p>
<div class="sourceCode" id="cb1115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1115-1"><a href="#cb1115-1" aria-hidden="true" tabindex="-1"></a>teste <span class="ot">&lt;-</span> <span class="fu">str_detect</span>(text, <span class="st">&quot;(</span><span class="sc">\\</span><span class="st">s|[!.,?])emissão(</span><span class="sc">\\</span><span class="st">s|[!.,?])&quot;</span>)</span>
<span id="cb1115-2"><a href="#cb1115-2" aria-hidden="true" tabindex="-1"></a>text[teste]</span></code></pre></div>
<pre><code>## [1] &quot;Para mais, a emissão de CO2 cresceu no Brasil&quot;</code></pre>
<p></p>
<p>Contudo, perceba acima, que o resultado de nossa pesquisa continua incorreta. Há algum outro detalhe que estamos esquecendo de incluir em nossa expressão. Pois dessa vez, apenas o quarto elemento de <code>text</code> foi retornado. Isso ocorre, porque estamos ignorando a possibilidade da palavra de nosso interesse, ser a responsável por iniciar ou terminar uma linha do texto. Logo, precisamos acrescentar os <em>metacharacters</em> <code>^</code> e <code>$</code>, em nossa descrição dos limites de uma palavra. Com isso, temos as expressões <code>(^|\\s|[!.,?])</code> e <code>($|\\s|[!.,?])</code>.</p>
<p></p>
<div class="sourceCode" id="cb1117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1117-1"><a href="#cb1117-1" aria-hidden="true" tabindex="-1"></a>teste <span class="ot">&lt;-</span> <span class="fu">str_detect</span>(text, <span class="st">&quot;(^|</span><span class="sc">\\</span><span class="st">s|[!.,?])emissão($|</span><span class="sc">\\</span><span class="st">s|[!.,?])&quot;</span>)</span>
<span id="cb1117-2"><a href="#cb1117-2" aria-hidden="true" tabindex="-1"></a>text[teste]</span></code></pre></div>
<pre><code>## [1] &quot;emissão&quot;                                      
## [2] &quot;Para mais, a emissão de CO2 cresceu no Brasil&quot;
## [3] &quot;emissão de S02 faz parte do processo&quot;         
## [4] &quot;A firma foi processada por tal emissão&quot;</code></pre>
<p></p>
<p>Agora sim, fomos capazes de encontrar todos os textos presentes em <code>text</code> que possuem a palavra “emissão.”</p>
<div id="conclusão-e-algumas-dicas-extras-2" class="section level4" number="10.8.9.1">
<h4 number="10.8.9.1"><span class="header-section-number">10.8.9.1</span> Conclusão e algumas dicas extras</h4>
<p>Para pesquisarmos por palavras específicas em uma expressão regular, nós precisamos incluir uma descrição dos caracteres que podem representar os limites físicos de uma palavra. Os limites de uma palavra geralmente assumem no formato de:</p>
<ul>
<li><p>Um espaço em branco (descrito por <code>[ ]</code> ou por <code>\\s</code>).</p></li>
<li><p>Pontuações (vírgulas, ponto final, etc.; descrito por <code>[!.,?]</code>).</p></li>
<li><p>Início ou o fim de uma linha (descrito por <code>^</code> e <code>$</code>).</p></li>
</ul>
<p>Vale ainda destacar, o fato de que o R nos oferece um atalho para indicarmos o limite de uma palavra, que se trata do comando <code>\b</code>, ou como deve ser escrito no R, <code>\\b</code>. Consequentemente, se você desejasse encontrar, por exemplo, a palavra “camisa,” você poderia utilizar a expressão <code>"\\bcamisa\\b"</code>.</p>
</div>
</div>
<div id="agrupamentos-e-backreferencing" class="section level3" number="10.8.10">
<h3 number="10.8.10"><span class="header-section-number">10.8.10</span> Agrupamentos e <em>backreferencing</em></h3>
<p>Em vários estilos de expressões regulares, parênteses são capazes de “lembrar” o texto encontrado pela sub expressão que eles encapsulam <span class="citation">(<a href="#ref-friedl2006" role="doc-biblioref">Friedl 2006</a>, p 21)</span>. Em expressões regulares, esse mecanismo é comumente denominado de <em>backreferencing</em>.</p>
<p>Em resumo, ao contornarmos uma sub expressão com um par de parênteses, nós estamos formando um “grupo,” e qualquer que seja o pedaço de texto encontrado especificamente por esse grupo, nós somos capazes de reutilizar esse texto dentro da mesma expressão que o localizou, por meio de suas referências numéricas, como <code>\\1</code>, <code>\\2</code>, <code>\\3</code>, e assim por diante. Entenda que essas referências numéricas, nada mais são do que índices de cada par de parênteses, ou de cada grupo presente em sua expressão regular. Logo, o índice <code>\\1</code> se refere ao texto localizado pela sub expressão do primeiro par de parênteses. Já o índice <code>\\2</code>, se refere ao texto descrito pela sub expressão do segundo par de parênteses. E assim segue.</p>
<p>O exemplo clássico desse tipo de operação, está na localização de letras ou palavras repetidas, em uma determinada cadeia de texto. Por exemplo, a expressão abaixo (<code>"(..)\\1"</code>), citada por <span class="citation"><a href="#ref-wickham2017" role="doc-biblioref">Wickham and Grolemund</a> (<a href="#ref-wickham2017" role="doc-biblioref">2017</a>, p 206)</span>, busca encontrar dentro do vetor <code>fruit</code>, alguma palavra que possua um par de letras repetido em sequência. Por isso, palavras como “b<strong>anan</strong>a” e “<strong>coco</strong>nut” são encontradas por essa expressão.</p>
<p></p>
<div class="sourceCode" id="cb1119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1119-1"><a href="#cb1119-1" aria-hidden="true" tabindex="-1"></a>teste <span class="ot">&lt;-</span> <span class="fu">str_detect</span>(fruit, <span class="st">&quot;(..)</span><span class="sc">\\</span><span class="st">1&quot;</span>)</span>
<span id="cb1119-2"><a href="#cb1119-2" aria-hidden="true" tabindex="-1"></a>fruit[teste]</span></code></pre></div>
<pre><code>## [1] &quot;banana&quot;      &quot;coconut&quot;     &quot;cucumber&quot;    &quot;jujube&quot;      &quot;papaya&quot;     
## [6] &quot;salal berry&quot;</code></pre>
<p></p>
<p>Portanto, dentro da expressão <code>"(..)\\1"</code>, o índice <code>\\1</code> está fazendo alusão ao par de caracteres encontrados pela sub expressão <code>"(..)"</code>. Entretanto, é importante que você tenha cuidado aqui. Pois o índice <code>\\1</code> <strong>não corresponde</strong> à expressão regular <code>"(..)"</code>. Ou seja, a expressão <code>"(..)\\1"</code> <strong>não é equivalente</strong> à expressão <code>"(..)(..)"</code>. Perceba que caso essas expressões fossem iguais, estaríamos simplesmente pesquisando por uma sequência de 4 caracteres quaisquer. Logo, não apenas a correspondência detectada pela expressão seria “<strong>bana</strong>na,” mas também, palavras como “<strong>rasp</strong>berry” e “<strong>pome</strong>granate” estariam inclusas no resultado (o que não ocorre acima).</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/backreferencing1.png" alt="Como o mecanismo de pesquisa funciona quando utilizamos *backreferencing*" width="70%" />
<p class="caption">
(#fig:unnamed-chunk-637)Como o mecanismo de pesquisa funciona quando utilizamos <em>backreferencing</em>
</p>
</div>
<p></p>
<p>Por isso, utilizamos o índice <code>\\1</code> quando desejamos encontrar o mesmo pedaço de texto, ou a mesma sequência de caracteres encontrada pelo grupo a que se refere. Com isso, <em>backreferencing</em> se torna um mecanismo útil quando ainda não conhecemos o texto repetido a ser encontrado, ou quando sabemos que esse texto pode variar violentamente ao longo do texto. Por exemplo, suponha que exista em nosso texto, três casos de palavras repetidas (“que que,” “da da” e “ele ele”). Para encontrar esses casos, você talvez tentaria a expressão <code>"\\bque que\\b|\\bda da\\b|\\bele ele\\b"</code>. Porém, seria muito desgastante escrever uma alternativa para cada variação.</p>
<p>Por esse motivo, poderíamos resumir esses casos com o uso de <em>backreferencing</em>. Um exemplo de expressão seria <code>"\\b(.+) \\1\\b"</code>. Dessa forma, a expressão <code>"(.+)"</code> busca encontrar uma sequência qualquer de caracteres, e o índice <code>\\1</code> tenta encontrar essa mesma sequência de caracteres logo após um espaço em branco.</p>
<p>Além desses pontos, repare que utilizamos o atalho <code>\\b</code> (que apresentamos ao final da seção anterior) para definirmos os limites de palavras, ao longo de várias dessas expressões. Se você está querendo descobrir palavras repetidas em seus textos, você com certeza deseja definir esses limites de palavras. Pois caso você não o faça, as repetições de uma sequência específica de caracteres, pelas quais você estaria pesquisando, poderiam ocorrer em qualquer lugar e invadir o espaço de outras palavras.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/backreferencing2.png" alt="A importância de se incluir os limites de palavras em pesquisas que utilizam *backreferencing*" width="100%" />
<p class="caption">
(#fig:unnamed-chunk-638)A importância de se incluir os limites de palavras em pesquisas que utilizam <em>backreferencing</em>
</p>
</div>
<p></p>
<p>Isso significa, que a expressão <code>"(que) \\1"</code> seria capaz de encontrar o texto “A imagem de Naka<strong>que que</strong>ima em meu corpo,” ou o texto “É claro <strong>que que</strong>ro!” Ampliando esse exemplo para uma expressão mais geral, poderíamos rapidamente realizar que a expressão <code>"(.+) \\1"</code> seria capaz de encontrar textos como “Sut<strong>il il</strong>ustração,” assim como “fez-s<strong>e e</strong>ngendrado.” Dessa forma, o atalho <code>\\b</code> impõe limites a nossa pesquisa, que evitam esse tipo de inconveniência.</p>
</div>
<div id="mais-sobre-padrões" class="section level3" number="10.8.11">
<h3 number="10.8.11"><span class="header-section-number">10.8.11</span> Mais sobre padrões</h3>
<p>Mesmo estando presente em diversos programas e linguagens, as expressões regulares possuem certa variabilidade, ou apresentam diferentes “gostos” ou “estilos” em cada uma dessas plataformas.</p>
<p>Dito de outra forma, as linguagens JavaScript, Python e R, oferecem um mecanismo próprio de expressões regulares, porém, a forma como esse mecanismo é implementado e quais são as funcionalidades que ele oferece em cada linguagem, pode variar.</p>
<p>Portanto, existem alguns padrões diferentes estabelecidos de expressões regulares. Apesar disso, a maior parte dos programas e linguagens de programação utilizam o padrão mais popular e completo de todos, que é o padrão criado pela linguagem Perl. Todas as linguagens acima oferecem pacotes e módulos que te permitem utilizar esse padrão.</p>
<p>Contudo, por padrão, as funções da família <code>grep()</code> adotam um padrão diferente de expressões regulares estendidas (<em>extended regular expressions</em>), chamado de POSIX 1003.2, o qual é equivalente ao estilo oferecido pelo programa <code>egrep</code>. Entretanto, essas funções também permitem o uso de expressões regulares no estilo adotado pela linguagem Perl. Basta configurar o seu argumento <code>perl</code> para <code>TRUE</code>.</p>
<p>Por outro lado, as funções do pacote <code>stringr</code> utilizam as bibliotecas em C do projeto <em>ICU</em> (<em>International Components for Unicode</em>), que oferecem um estilo de expressões regulares muito próximo do padrão da linguagem Perl. Para mais detalhes sobre essa biblioteca, além de uma lista bem útil de todos os <em>metacharacters</em> disponíveis, você pode consultar o <a href="https://unicode-org.github.io/icu/userguide/strings/regexp.html">site do projeto</a>.</p>
</div>
</div>
<div id="substituindo-partes-de-um-texto-com-str_replace" class="section level2" number="10.9">
<h2 number="10.9"><span class="header-section-number">10.9</span> Substituindo partes de um texto com <code>str_replace()</code></h2>
<p>A função <code>str_replace()</code> e sua variante <code>str_replace_all()</code>, lhe permite aplicar uma expressão regular sobre o seu texto, e substituir a área encontrada (ou áreas encontradas) por um novo valor de seu interesse. Por exemplo, se eu possuo o conjunto de palavras abaixo, e desejo substituir qualquer vogal por um <em>underline</em>, eu precisaria do seguinte comando.</p>
<p></p>
<div class="sourceCode" id="cb1121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1121-1"><a href="#cb1121-1" aria-hidden="true" tabindex="-1"></a>palavras <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;arquivo&quot;</span>, <span class="st">&quot;estante&quot;</span>, <span class="st">&quot;livro&quot;</span>, <span class="st">&quot;estiagem&quot;</span>,</span>
<span id="cb1121-2"><a href="#cb1121-2" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;dinheiro&quot;</span>, <span class="st">&quot;paz&quot;</span>)</span>
<span id="cb1121-3"><a href="#cb1121-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1121-4"><a href="#cb1121-4" aria-hidden="true" tabindex="-1"></a>palavras <span class="ot">&lt;-</span> <span class="fu">str_replace</span>(palavras, <span class="st">&quot;[aeiou]&quot;</span>, <span class="st">&quot;_&quot;</span>)</span>
<span id="cb1121-5"><a href="#cb1121-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1121-6"><a href="#cb1121-6" aria-hidden="true" tabindex="-1"></a>palavras</span></code></pre></div>
<pre><code>## [1] &quot;_rquivo&quot;  &quot;_stante&quot;  &quot;l_vro&quot;    &quot;_stiagem&quot; &quot;d_nheiro&quot; &quot;p_z&quot;</code></pre>
<p></p>
<p>Entretanto, perceba acima, que apenas a primeira vogal é alterada. Isso não apenas é um comportamento natural da função <code>str_replace()</code>, mas também é um padrão adotado por muitos dos sistemas de expressão regular. Como foi colocado por <span class="citation"><a href="#ref-friedl2006" role="doc-biblioref">Friedl</a> (<a href="#ref-friedl2006" role="doc-biblioref">2006</a>, p 148)</span>: <em>“any match that begins earlier (leftmost) in the string is always preferred over any plausible match that begins later”</em>. Com isso, o autor quis destacar que o ato de parar a pesquisa na primeira correspondência encontrada, faz parte dos princípios de muitas expressões regulares.</p>
<p>Porém, em muitos momentos, haverá a necessidade de sobrepor esse comportamento, de forma que a sua expressão possa encontrar todas as correspondências presentes em uma <em>string</em>. Por esse motivo, o pacote <code>stringr</code> oferece diversas funções variantes que terminam com o padrão <code>*_all()</code>. Essas funções buscam justamente solucionar esse problema e, por isso, aplicam a expressão regular sobre todo o texto, com o objetivo de encontrar o maior número possível de correspondências.</p>
<p>Portanto, ao empregarmos a variante <code>str_replace_all()</code>, desejamos substituir todas as correspondências encontradas por uma expressão regular em cada <em>string</em>, por um novo valor textual. Veja que o exemplo abaixo é praticamente idêntico ao anterior, apenas a função <code>str_replace()</code> foi alterada para <code>str_replace_all()</code>.</p>
<p></p>
<div class="sourceCode" id="cb1123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1123-1"><a href="#cb1123-1" aria-hidden="true" tabindex="-1"></a>palavras <span class="ot">&lt;-</span> <span class="fu">str_replace_all</span>(palavras, <span class="st">&quot;[aeiou]&quot;</span>, <span class="st">&quot;_&quot;</span>)</span>
<span id="cb1123-2"><a href="#cb1123-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1123-3"><a href="#cb1123-3" aria-hidden="true" tabindex="-1"></a>palavras</span></code></pre></div>
<pre><code>## [1] &quot;_rq__v_&quot;  &quot;_st_nt_&quot;  &quot;l_vr_&quot;    &quot;_st__g_m&quot; &quot;d_nh__r_&quot; &quot;p_z&quot;</code></pre>
<p></p>
<p>Como um outro exemplo, poderíamos simular o trabalho executado pela função <code>str_trim()</code>, com as funções <code>str_replace()</code> e <code>str_replace_all()</code>. O comando <code>str_replace(vec, "^( )+", "")</code> estaria procurando por qualquer linha que se inicia por uma quantidade <span class="math inline">\(y\)</span> (sendo <span class="math inline">\(y &gt; 0\)</span>) de espaços em branco, e substituindo esses espaços por nada (). Dessa maneira, este comando equivale à <code>str_trim(vec, side = "left)</code>. Já o comando <code>str_replace_all(vec, "^( )+|( )+$", "")</code>, buscaria qualquer linha que se inicia ou termina por uma quantidade x de espaços em branco, e em seguida, substituiria esses espaços por nada. Sendo assim, esse comando equivale à <code>str_trim(vec, side = "both")</code>.</p>
<p></p>
<div class="sourceCode" id="cb1125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1125-1"><a href="#cb1125-1" aria-hidden="true" tabindex="-1"></a>vec <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb1125-2"><a href="#cb1125-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;  Russo é a língua oficial da Rússia   &quot;</span>,</span>
<span id="cb1125-3"><a href="#cb1125-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;   Japão se encontra na Ásia&quot;</span>,</span>
<span id="cb1125-4"><a href="#cb1125-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Português nunca foi tão difícil!   &quot;</span>,</span>
<span id="cb1125-5"><a href="#cb1125-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;  224,90 &quot;</span></span>
<span id="cb1125-6"><a href="#cb1125-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1125-7"><a href="#cb1125-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1125-8"><a href="#cb1125-8" aria-hidden="true" tabindex="-1"></a><span class="fu">str_replace</span>(vec, <span class="st">&quot;^( )+&quot;</span>, <span class="st">&quot;&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;Russo é a língua oficial da Rússia   &quot;
## [2] &quot;Japão se encontra na Ásia&quot;            
## [3] &quot;Português nunca foi tão difícil!   &quot;  
## [4] &quot;224,90 &quot;</code></pre>
<div class="sourceCode" id="cb1127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1127-1"><a href="#cb1127-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_replace_all</span>(vec, <span class="st">&quot;^( )+|( )+$&quot;</span>, <span class="st">&quot;&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;Russo é a língua oficial da Rússia&quot;
## [2] &quot;Japão se encontra na Ásia&quot;         
## [3] &quot;Português nunca foi tão difícil!&quot;  
## [4] &quot;224,90&quot;</code></pre>
<p></p>
<p>Para mais, <em>backreferencing</em> se torna uma ferramenta extremamente útil em conjunto com <code>str_replace()</code>. Por exemplo, suponha que você tenha se esquecido de adicionar o símbolo da moeda brasileira em cada valor numérico. Com a expressão regular <code>"([0-9]+(,[0-9]+)?)"</code> podemos encontrar esses valores numéricos. Repare que toda a expressão está contornada por parênteses, logo, todo o número é salvo para o índice <code>\\1</code>. Dessa maneira, basta antecedermos esse índice pelo símbolo que desejamos inserir (<code>"R$\\1"</code>).</p>
<p></p>
<div class="sourceCode" id="cb1129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1129-1"><a href="#cb1129-1" aria-hidden="true" tabindex="-1"></a>vec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;O litro de leite custa 3,50&quot;</span>, <span class="st">&quot;O ingresso foi caro. Mais de 500 reais!&quot;</span>, </span>
<span id="cb1129-2"><a href="#cb1129-2" aria-hidden="true" tabindex="-1"></a>         <span class="st">&quot;230015&quot;</span>)</span>
<span id="cb1129-3"><a href="#cb1129-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1129-4"><a href="#cb1129-4" aria-hidden="true" tabindex="-1"></a><span class="fu">str_replace</span>(vec, <span class="st">&quot;([0-9]+(,[0-9]+)?)&quot;</span>, <span class="st">&quot;R$</span><span class="sc">\\</span><span class="st">1&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;O litro de leite custa R$3,50&quot;            
## [2] &quot;O ingresso foi caro. Mais de R$500 reais!&quot;
## [3] &quot;R$230015&quot;</code></pre>
<p></p>
</div>
<div id="dividindo-strings-com-str_split" class="section level2" number="10.10">
<h2 number="10.10"><span class="header-section-number">10.10</span> Dividindo <em>strings</em> com <code>str_split()</code></h2>
<p>Você também pode utilizar uma expressão regular para detectar “pontos de quebra” em uma cadeia de texto e, em seguida, quebrar essa cadeia nesses pontos determinados. Repare no exemplo abaixo, que a função <code>str_split()</code> nos retorna como resultado, uma lista de vetores, onde cada elemento dessa lista, contém os “pedaços” de cada elemento do vetor original (<code>vec</code>). Logo, se você está aplicando <code>str_split()</code> sobre um vetor com 34 elementos, você terá uma lista com 34 elementos em seu produto final.</p>
<p></p>
<div class="sourceCode" id="cb1131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1131-1"><a href="#cb1131-1" aria-hidden="true" tabindex="-1"></a>vec <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb1131-2"><a href="#cb1131-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;1 : 2 : 3 : 4 : 5 : 6 : 7&quot;</span>,</span>
<span id="cb1131-3"><a href="#cb1131-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Faria, Pedro Duarte : 1290321_1&quot;</span>,</span>
<span id="cb1131-4"><a href="#cb1131-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Objeto não localizado : 10_0x341167&quot;</span>,</span>
<span id="cb1131-5"><a href="#cb1131-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;A732 : B3 : 24 : C1 : 90 : 89 : QUA : ABD : AQZ29 : C11 : 01ER&quot;</span></span>
<span id="cb1131-6"><a href="#cb1131-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1131-7"><a href="#cb1131-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1131-8"><a href="#cb1131-8" aria-hidden="true" tabindex="-1"></a><span class="fu">str_split</span>(vec, <span class="st">&quot; : &quot;</span>)</span></code></pre></div>
<pre><code>## [[1]]
## [1] &quot;1&quot; &quot;2&quot; &quot;3&quot; &quot;4&quot; &quot;5&quot; &quot;6&quot; &quot;7&quot;
## 
## [[2]]
## [1] &quot;Faria, Pedro Duarte&quot; &quot;1290321_1&quot;          
## 
## [[3]]
## [1] &quot;Objeto não localizado&quot; &quot;10_0x341167&quot;          
## 
## [[4]]
##  [1] &quot;A732&quot;  &quot;B3&quot;    &quot;24&quot;    &quot;C1&quot;    &quot;90&quot;    &quot;89&quot;    &quot;QUA&quot;   &quot;ABD&quot;  
##  [9] &quot;AQZ29&quot; &quot;C11&quot;   &quot;01ER&quot;</code></pre>
<p></p>
<p>Contudo, a depender do que você planeja fazer em seguida, pode ser difícil trabalhar com uma lista. Por isso, a função <code>str_split()</code> nos oferece o argumento <code>simplify</code>, no qual podemos requisitar a função que simplifique o resultado para uma matriz.</p>
<p></p>
<div class="sourceCode" id="cb1133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1133-1"><a href="#cb1133-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_split</span>(vec, <span class="st">&quot; : &quot;</span>, <span class="at">simplify =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>##      [,1]                    [,2]          [,3] [,4] [,5] [,6] [,7]  [,8] 
## [1,] &quot;1&quot;                     &quot;2&quot;           &quot;3&quot;  &quot;4&quot;  &quot;5&quot;  &quot;6&quot;  &quot;7&quot;   &quot;&quot;   
## [2,] &quot;Faria, Pedro Duarte&quot;   &quot;1290321_1&quot;   &quot;&quot;   &quot;&quot;   &quot;&quot;   &quot;&quot;   &quot;&quot;    &quot;&quot;   
## [3,] &quot;Objeto não localizado&quot; &quot;10_0x341167&quot; &quot;&quot;   &quot;&quot;   &quot;&quot;   &quot;&quot;   &quot;&quot;    &quot;&quot;   
## [4,] &quot;A732&quot;                  &quot;B3&quot;          &quot;24&quot; &quot;C1&quot; &quot;90&quot; &quot;89&quot; &quot;QUA&quot; &quot;ABD&quot;
##      [,9]    [,10] [,11] 
## [1,] &quot;&quot;      &quot;&quot;    &quot;&quot;    
## [2,] &quot;&quot;      &quot;&quot;    &quot;&quot;    
## [3,] &quot;&quot;      &quot;&quot;    &quot;&quot;    
## [4,] &quot;AQZ29&quot; &quot;C11&quot; &quot;01ER&quot;</code></pre>
<p></p>
</div>
<div id="extraindo-apenas-a-correspondência-de-sua-expressão-regular-com-str_extract" class="section level2" number="10.11">
<h2 number="10.11"><span class="header-section-number">10.11</span> Extraindo apenas a correspondência de sua expressão regular com <code>str_extract()</code></h2>
<p>Assim como substituir suas correspondências por novos valores, você também tem a capacidade de extrair essas correspondências isoladamente, por meio da função <code>str_extract()</code>. Essa funcionalidade se torna extremamente importante quando não apenas a estrutura de cada elemento de seu vetor difere, mas também, quando a posição de seu alvo ao longo da cadeia de texto varia. Essas características tornam impossível a extração de nosso alvo com a função <code>str_sub()</code> (que apresentamos anteriormente), que se baseia diretamente na posição dos caracteres ao longo do texto.</p>
<p>Por isso, a melhor alternativa para superarmos esse empecilho, é empregar uma expressão regular que possa detectar os nossos alvos e, com isso, extraí-los por meio da função <code>str_extract()</code>. Como exemplo, podemos extrair todos os anos presentes em cada elemento do vetor <code>per</code>, através do seguinte comando:</p>
<p></p>
<div class="sourceCode" id="cb1135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1135-1"><a href="#cb1135-1" aria-hidden="true" tabindex="-1"></a>per <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Janeiro_2020&quot;</span>, <span class="st">&quot;Visitei Pará de Minas em Fevereiro de 2019&quot;</span>,</span>
<span id="cb1135-2"><a href="#cb1135-2" aria-hidden="true" tabindex="-1"></a>         <span class="st">&quot;2020 foi um ano terrível&quot;</span>, <span class="st">&quot;O Brasil era a 11° economia do mundo em 2005&quot;</span>)</span>
<span id="cb1135-3"><a href="#cb1135-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1135-4"><a href="#cb1135-4" aria-hidden="true" tabindex="-1"></a><span class="fu">str_extract</span>(per, <span class="st">&quot;</span><span class="sc">\\</span><span class="st">d{4}&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2020&quot; &quot;2019&quot; &quot;2020&quot; &quot;2005&quot;</code></pre>
<p></p>
<p>Ou melhor, podemos colocar o texto original e a parte extraída em uma tabela:</p>
<p></p>
<div class="sourceCode" id="cb1137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1137-1"><a href="#cb1137-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(</span>
<span id="cb1137-2"><a href="#cb1137-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">text =</span> per,</span>
<span id="cb1137-3"><a href="#cb1137-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">ano =</span> <span class="fu">str_extract</span>(per, <span class="st">&quot;</span><span class="sc">\\</span><span class="st">d{4}&quot;</span>)</span>
<span id="cb1137-4"><a href="#cb1137-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## # A tibble: 4 x 2
##   text                                         ano  
##   &lt;chr&gt;                                        &lt;chr&gt;
## 1 Janeiro_2020                                 2020 
## 2 Visitei Pará de Minas em Fevereiro de 2019   2019 
## 3 2020 foi um ano terrível                     2020 
## 4 O Brasil era a 11° economia do mundo em 2005 2005</code></pre>
<p></p>
<p>Assim como <code>str_replace()</code>, <code>str_extract()</code> é capaz de extrair apenas a primeira correspondência encontrada por sua expressão regular. Por esse motivo, você irá precisar de sua variante, <code>str_extract_all()</code>, em todas as ocasiões em que você tiver mais de um alvo a ser extraído em cada texto. Por exemplo, podemos extrair o valor de cada medida presente em <code>medidas</code>, por meio da expressão <code>"([0-9]+)([.][0-9]+)?"</code>.</p>
<p></p>
<div class="sourceCode" id="cb1139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1139-1"><a href="#cb1139-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Largura X Altura X Profundidade (Peso, Classe)</span></span>
<span id="cb1139-2"><a href="#cb1139-2" aria-hidden="true" tabindex="-1"></a>medidas <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb1139-3"><a href="#cb1139-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;8.15 m X 2.23 m X 4.5 m (240 Kg, B)&quot;</span>,</span>
<span id="cb1139-4"><a href="#cb1139-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;1.14 m X 3.1 m X 0.9 m (15 Kg, A)&quot;</span>,</span>
<span id="cb1139-5"><a href="#cb1139-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;4.98 m X 9.2 m X 5.25 m (120 Kg, A)&quot;</span>,</span>
<span id="cb1139-6"><a href="#cb1139-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;3.14 m X 3.89 m X 3.41 m (86 Kg, C)&quot;</span></span>
<span id="cb1139-7"><a href="#cb1139-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1139-8"><a href="#cb1139-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1139-9"><a href="#cb1139-9" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> <span class="fu">str_extract_all</span>(</span>
<span id="cb1139-10"><a href="#cb1139-10" aria-hidden="true" tabindex="-1"></a>  medidas,</span>
<span id="cb1139-11"><a href="#cb1139-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;([0-9]+)([.][0-9]+)?&quot;</span>,</span>
<span id="cb1139-12"><a href="#cb1139-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">simplify =</span> <span class="cn">TRUE</span></span>
<span id="cb1139-13"><a href="#cb1139-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1139-14"><a href="#cb1139-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1139-15"><a href="#cb1139-15" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(tab) <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb1139-16"><a href="#cb1139-16" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Largura&quot;</span>, <span class="st">&quot;Altura&quot;</span>, <span class="st">&quot;Profundidade&quot;</span>, <span class="st">&quot;Peso&quot;</span></span>
<span id="cb1139-17"><a href="#cb1139-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1139-18"><a href="#cb1139-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1139-19"><a href="#cb1139-19" aria-hidden="true" tabindex="-1"></a>tab</span></code></pre></div>
<pre><code>##      Largura Altura Profundidade Peso 
## [1,] &quot;8.15&quot;  &quot;2.23&quot; &quot;4.5&quot;        &quot;240&quot;
## [2,] &quot;1.14&quot;  &quot;3.1&quot;  &quot;0.9&quot;        &quot;15&quot; 
## [3,] &quot;4.98&quot;  &quot;9.2&quot;  &quot;5.25&quot;       &quot;120&quot;
## [4,] &quot;3.14&quot;  &quot;3.89&quot; &quot;3.41&quot;       &quot;86&quot;</code></pre>
<p></p>
</div>
<div id="exercícios-8" class="section level2 unnumbered">
<h2 class="unnumbered">Exercícios</h2>
<p><strong>Questão 10.1.</strong> Em cada item dessa questão, você deve criar uma expressão regular que represente a sequência de caracteres descrita no enunciado. Em seguida, você deve aplicar essa expressão regular sobre o vetor <code>words</code>, com o objetivo de extrair todas as palavras desse vetor que se encaixam nessa determinada expressão. O vetor <code>words</code> advém do pacote <code>stringr</code>, logo, se você conseguiu chamar por esse pacote em sua sessão através do comando <code>library()</code>, você já possui acesso a esse vetor.</p>
<p>10.1.A) Um “b” ou “c” seguidos de um “a” e um “l.”</p>
<p>10.1.B) Um caractere qualquer (exceto a letra “a”) imediatamente seguido por um “c,” que por sua vez, é seguido pelo final do <em>string</em>.</p>
<p>10.1.C) A sequência “s-p-a-c-e” de caracteres, ou, um “e” imediatamente seguido por duas letras “s,” que por sua vez são seguidos imediatamente pelo final da linha.</p>
<p>10.1.D) Crie uma expressão regular que possa encontrar todas as palavras presentes em <code>words</code> que contém exatos 3 caracteres. Você pode solucionar essa questão com a função <code>str_length()</code>. <strong>Porém, você deve utilizar uma expressão regular para encontrar essas palavras de 3 caracteres</strong>, portanto, esqueça momentaneamente que a função <code>str_length()</code> existe<a href="#fn34" class="footnote-ref" id="fnref34"><sup>34</sup></a>.</p>
<p><strong>Questão 10.2.</strong> Os itens desta questão vão trabalhar com o vetor <code>compras</code>. Para importar esse vetor para a sua sessão do R, copie e cole os comandos abaixo em seu console. Como você pode ver abaixo, cada elemento do vetor <code>compras</code> contém uma <em>string</em> bastante longa, tão longa que fui obrigado a utilizar a função <code>str_trunc()</code> para cortar parte do texto e apresentar abaixo apenas os 50 primeiros caracteres de cada <em>string</em>. Dentro de cada <em>string</em>, você possui um conjunto de dados referentes a uma compra realizada em uma loja durante o ano de 2020.</p>
<p></p>
<div class="sourceCode" id="cb1141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1141-1"><a href="#cb1141-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1141-2"><a href="#cb1141-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1141-3"><a href="#cb1141-3" aria-hidden="true" tabindex="-1"></a>github <span class="ot">&lt;-</span> <span class="st">&quot;https://raw.githubusercontent.com/pedropark99/&quot;</span></span>
<span id="cb1141-4"><a href="#cb1141-4" aria-hidden="true" tabindex="-1"></a>pasta <span class="ot">&lt;-</span> <span class="st">&quot;Curso-R/master/Dados/&quot;</span></span>
<span id="cb1141-5"><a href="#cb1141-5" aria-hidden="true" tabindex="-1"></a>arquivo <span class="ot">&lt;-</span> <span class="st">&quot;compras_completo.txt&quot;</span></span>
<span id="cb1141-6"><a href="#cb1141-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1141-7"><a href="#cb1141-7" aria-hidden="true" tabindex="-1"></a>compras <span class="ot">&lt;-</span> <span class="fu">read_lines</span>(<span class="fu">paste0</span>(github, pasta, arquivo))</span>
<span id="cb1141-8"><a href="#cb1141-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1141-9"><a href="#cb1141-9" aria-hidden="true" tabindex="-1"></a><span class="fu">str_trunc</span>(<span class="fu">head</span>(compras), <span class="at">width =</span> <span class="dv">50</span>, <span class="at">ellipsis =</span> <span class="st">&quot;~&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;Márcio390.287.917-210akqzS2tk$URMcLOk5Q2356772.25~&quot;
## [2] &quot;Igor944.236.416-254tLo8&amp;S9WtXg05fsdU2188525.212/0~&quot;
## [3] &quot;Márcio395.304.955-57pfwji9Z4Q6dZxSWZV7#7Z$J218160~&quot;
## [4] &quot;Isabela322.900.842-74K5D6b$xAnY&amp;QJ1$XQzE2f1554399~&quot;
## [5] &quot;Álvaro475.767.740-583WWonElfbisKD1GiIVS225066.161~&quot;
## [6] &quot;Rafael031.357.966-89bOzZ7#2JBcsd!sWzaeNY1866117.7~&quot;</code></pre>
<p></p>
<p>10.2.A) Como você pôde ver acima, os dados estão misturados em cada <em>string</em>. Em outras palavras, a loja que coletou esses dados não se preocupou em utilizar um separador especial para separar as variáveis em diferentes colunas. Agora, eles estão todos juntos, um do lado do outro, em uma única coluna.</p>
<p>Em resumo, cada <em>string</em> guarda as informações de 7 variáveis diferentes: nome do consumidor; CPF do consumidor; código de identificação da venda; código de identificação do produto comprado; valor pago por unidade; quantidade adquirida; horário da compra. Precisamente nessa ordem. Como um guia, temos as figuras 10.8 e 10.9 abaixo. Cada figura apresenta uma “metade” específica do primeiro <em>string</em> presente no vetor <code>compras</code> (o <em>string</em> é muito grande, por isso, optou-se por dividi-lo em duas figuras). Cada figura, busca descrever a estrutura seguida por cada <em>string</em> do vetor <code>compras</code>.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Exercícios/Figuras/exec_parte1.png" alt="Descrição dos 39 primeiros caracteres de cada *string* presente em `compras`" width="100%" />
<p class="caption">
(#fig:unnamed-chunk-1080)Descrição dos 39 primeiros caracteres de cada <em>string</em> presente em <code>compras</code>
</p>
</div>
<p></p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Exercícios/Figuras/exec_parte2.png" alt="Descrição dos 43 últimos caracteres de cada *string* presente em `compras`" width="100%" />
<p class="caption">
(#fig:unnamed-chunk-1081)Descrição dos 43 últimos caracteres de cada <em>string</em> presente em <code>compras</code>
</p>
</div>
<p></p>
<p>O seu trabalho é utilizar as ferramentas que você viu nesse capítulo, para extrair essas 7 variáveis e alocá-las em colunas separadas de um <code>data.frame</code>. Esse não é um exercício muito simples, mas ele também transmite certa realidade. Há diversas bases de dados e análises reais na indústria, que exigem um uso intensivo de ferramentas de extração e localização de texto, como é o caso desse exercício sobre o vetor <code>compras</code>.</p>
<p>Para realizar essa atividade, você não precisa necessariamente utilizar apenas expressões regulares por todo o caminho. Dado a complexidade dessas <em>strings</em>, é interessante e, até mais simples, que você misture um pouco suas técnicas, ao trabalhar com partes (ou <em>subsets</em>) específicos das <em>strings</em> com <code>str_length()</code> e <code>str_sub()</code> e, em seguida, aplicar expressões regulares sobre as partes restantes das <em>strings</em>.</p>
<p>Caso você opte por utilizar uma única expressão regular para resolver esse item, é fundamental que você compreenda bem <strong>como</strong> os valores de cada variável podem variar em cada <em>string</em>. Em outras palavras, para que você seja capaz de descrever, com precisão, cada parte da sequência de caracteres que compõe essas <em>strings</em>, você precisa saber, por exemplo: quais caracteres podem aparecer, na parte que apresenta o código de identificação da venda; ou ainda, quantos dígitos são permitidos no campo do valor unitário do produto? Para ter essa compreensão, leia atentamente às figuras 10.8 e 10.9.</p>
<p>10.2.B) Volte ao vetor <code>compras</code> e extraia de cada <em>string</em>, apenas a parte correspondente à data e horário da compra. Com esses valores em mãos, tente capturar o dia de cada data, por último, realize uma contagem sobre esses dias, e descubra o dia do mês em que essa loja possui o maior número de vendas.</p>
<p>10.2.C) Selecione os 3 primeiros dígitos do CPF do consumidor de cada <em>string</em>.</p>
<!--chapter:end:10-strings.Rmd-->
</div>
</div>
<div id="introduzindo-fatores-factors-com-forcats" class="section level1" number="11">
<h1 number="11"><span class="header-section-number">11</span> Introduzindo fatores (<code>factor</code>’s) com <code>forcats</code></h1>
<div id="introdução-e-pré-requisitos-4" class="section level2" number="11.1">
<h2 number="11.1"><span class="header-section-number">11.1</span> Introdução e pré-requisitos</h2>
<p>No capítulo de <a href="#sec:fundamentos_R">Fundamentos da Linguagem R</a>, introduzimos os 4 tipos básicos de dados disponíveis no R, sendo eles: <code>integer</code>; <code>double</code>; <code>character</code>; e <code>logical</code>. Entretanto, também destacamos que outros tipos de dados “mais complexos” estão presentes na linguagem R, e, que eles serão tão importantes quanto os tipos básicos em suas análises.</p>
<p>Os exemplos mais importantes desses tipos são os fatores (<code>factor</code>) e as variáveis de tempo, isto é, datas e horários (<code>Date</code> ou <code>POSIXct</code>). Neste capítulo, vamos focar a discussão no tipo <code>factor</code>, e, no próximo capítulo, discutiremos os tipos referentes às variáveis de tempo.</p>
<p>Parte dos exemplos deste capítulo, envolvem o uso de funções do pacote <code>forcats</code>, portanto, não se esqueça de instalar esse pacote (com o comando <code>install.packages()</code>), e, logo depois, chamar pelo pacote para a sua sessão (com o comando <code>library()</code>). O pacote <code>forcats</code> está incluso no pacote <code>tidyverse</code>, e, por isso, o <code>tidyverse</code> representa um caminho alternativo para você acessar as funções deste pacote.</p>
<p></p>
<div class="sourceCode" id="cb1143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1143-1"><a href="#cb1143-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forcats)</span>
<span id="cb1143-2"><a href="#cb1143-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Ou</span></span>
<span id="cb1143-3"><a href="#cb1143-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code></pre></div>
<p></p>
</div>
<div id="o-que-são-fatores" class="section level2" number="11.2">
<h2 number="11.2"><span class="header-section-number">11.2</span> O que são fatores ?</h2>
<p>Um fator (ou <code>factor</code>) é um tipo de dado do R desenvolvido para o trabalho com <strong>variáveis categóricas</strong>, ou <strong>variáveis qualitativas</strong>. Ou seja, o tipo de dado <code>factor</code> lhe permite armazenar características e qualidades que um indivíduo carrega, ou de outra forma, qual a “categoria” ou grupo em que cada indivíduo de sua tabela se encaixa.</p>
<p>O sexo e a cor de pele são dois exemplos clássicos de variáveis qualitativas, pois elas identificam uma característica física do indivíduo. Características essas que determinam se o indivíduo pertence ou não a um grupo específico de pessoas (mulheres pardas, homens brancos, etc.). A faixa etária é um outro exemplo muito comum, sendo uma variável que busca separar indivíduos em vários grupos de acordo com as suas idades.</p>
<p>Entretanto, para além de características e categorias, também podemos identificar uma variável categórica, ao percebermos se essa variável pode (ou deve) assumir um conjunto muito específico e muito bem definido de valores <span class="citation">(<a href="#ref-Rlanguage" role="doc-biblioref">R Core Team 2020b</a>, p 8)</span>. Por exemplo, uma variável que apresente o sexo de uma pessoa pode assumir apenas dois valores diferentes (Homem ou Mulher; Masculino ou Feminino; H ou M; ou alguma outra variação desses valores). Pode haver ainda, a necessidade de incluir um terceiro valor para casos especiais, como “Indefinido,” mas em geral, o sexo assume apenas os dois valores supracitados<a href="#fn35" class="footnote-ref" id="fnref35"><sup>35</sup></a>. Como um outro exemplo, uma variável que guarda o mês do ano ao qual os dados de sua tabela se referem pode assumir apenas doze valores diferentes (janeiro, fevereiro, março, …, novembro, dezembro), logo, essa também é uma variável categórica sob essa perspectiva.</p>
</div>
<div id="como-construir-um-fator" class="section level2" number="11.3">
<h2 number="11.3"><span class="header-section-number">11.3</span> Como construir um fator</h2>
<p>Suponha que você tenha questionado o sexo de várias pessoas, e anotado as suas respostas no vetor abaixo (<code>entrevista</code>):</p>
<p></p>
<div class="sourceCode" id="cb1144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1144-1"><a href="#cb1144-1" aria-hidden="true" tabindex="-1"></a>entrevista <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Mulher&quot;</span>, <span class="st">&quot;Homem&quot;</span>, <span class="st">&quot;Homem&quot;</span>, <span class="st">&quot;Mulher&quot;</span>, <span class="st">&quot;Mum&quot;</span>)</span></code></pre></div>
<p></p>
<p>Se você deseja transformar esse vetor acima (que no momento é um vetor do tipo <code>character</code>) em um vetor do tipo <code>factor</code>, você deve primeiro pensar sobre o atributo <code>levels</code> que será utilizado neste vetor. Ou seja, <strong>todo objeto do tipo <code>factor</code> no R possui um atributo chamado <code>levels</code></strong>, que representa o conjunto de valores que a variável em questão pode assumir. Como estamos anotando o sexo de algumas pessoas entrevistadas, sabemos que essa variável pode assumir apenas dois valores diferentes. Eu crio o vetor abaixo (<code>niveis_sexo</code>) com o objetivo de guardar essas informações.</p>
<p></p>
<div class="sourceCode" id="cb1145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1145-1"><a href="#cb1145-1" aria-hidden="true" tabindex="-1"></a>niveis_sexo <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Homem&quot;</span>, <span class="st">&quot;Mulher&quot;</span>)</span></code></pre></div>
<p></p>
<p>Agora que temos o vetor com a informação original (<code>entrevista</code>) e um vetor com os níveis, ou, os valores permitidos para essa variável (<code>niveis_sexo</code>), podemos criar o nosso fator através da função <code>factor()</code>.</p>
<p></p>
<div class="sourceCode" id="cb1146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1146-1"><a href="#cb1146-1" aria-hidden="true" tabindex="-1"></a>vec_fator <span class="ot">&lt;-</span> <span class="fu">factor</span>(entrevista, <span class="at">levels =</span> niveis_sexo)</span>
<span id="cb1146-2"><a href="#cb1146-2" aria-hidden="true" tabindex="-1"></a>vec_fator</span></code></pre></div>
<pre><code>## [1] Mulher Homem  Homem  Mulher &lt;NA&gt;  
## Levels: Homem Mulher</code></pre>
<p></p>
<p>Perceba acima, que ao chamarmos pelo novo fator criado, os níveis da variável (atributo <code>levels</code>) são mostrados logo abaixo dos valores armazenados. Repare também, que todos os valores presentes no vetor original (<code>entrevista</code>) e que estejam fora dos níveis da variável (<code>niveis_sexo</code>) são silenciosamente convertidos para valores <code>NA</code>. Isto é, qualquer valor que esteja minimamente divergente dos valores presentes em <code>levels</code>, ou que contenha algum erro ortográfico, será convertido para um valor <code>NA</code>.</p>
<p>Você sempre pode acessar os níveis (isto é, o atributo <code>levels</code>) de um fator por meio da função <code>levels()</code>. Basta aplicá-la diretamente sobre o fator, que um vetor contendo esses níveis será retornado para você.</p>
<p></p>
<div class="sourceCode" id="cb1148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1148-1"><a href="#cb1148-1" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(vec_fator)</span></code></pre></div>
<pre><code>## [1] &quot;Homem&quot;  &quot;Mulher&quot;</code></pre>
<p></p>
<p>Vale destacar, que para o R, um vetor do tipo <code>factor</code>, é na verdade, um vetor do tipo <code>integer</code> que carrega uma classe <code>factor</code>, e que possui um atributo chamado <code>levels</code>. Esse é um dos principais motivos pelos quais os tipos <code>factor</code>, <code>Date</code> e <code>POSIXct</code> são caracterizados como tipos “mais complexos” da linguagem R. Pois esses tipos são construídos a partir dos quatro tipos básicos, mas eles também acumulam novas características ou propriedades que não estão presentes nesses tipos básicos.</p>
<p>No caso do tipo <code>factor</code>, ele é construído a partir do tipo <code>integer</code> devido a forma como o R guarda os valores presentes em um vetor do tipo <code>factor</code> <span class="citation">(<a href="#ref-Rlanguage" role="doc-biblioref">R Core Team 2020b</a>, p 8)</span>. Por exemplo, os valores “Homem” e “Mulher” do vetor <code>vec_fator</code> acima, são guardados pelo R como valores 1 e 2, e são posteriormente traduzidos como valores “Homem” e “Mulher” quando chamamos pelo vetor <code>vec_fator</code>. Tudo isso ocorre, devido às propriedades e atributos que um vetor do tipo <code>factor</code> carrega, e que o diferenciam de um vetor do tipo <code>integer</code>.</p>
<p></p>
<div class="sourceCode" id="cb1150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1150-1"><a href="#cb1150-1" aria-hidden="true" tabindex="-1"></a><span class="fu">typeof</span>(vec_fator)</span></code></pre></div>
<pre><code>## [1] &quot;integer&quot;</code></pre>
<div class="sourceCode" id="cb1152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1152-1"><a href="#cb1152-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(vec_fator)</span></code></pre></div>
<pre><code>## [1] &quot;factor&quot;</code></pre>
<div class="sourceCode" id="cb1154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1154-1"><a href="#cb1154-1" aria-hidden="true" tabindex="-1"></a><span class="fu">attributes</span>(vec_fator)</span></code></pre></div>
<pre><code>## $levels
## [1] &quot;Homem&quot;  &quot;Mulher&quot;
## 
## $class
## [1] &quot;factor&quot;</code></pre>
<p></p>
</div>
<div id="porque-utilizar-fatores-se-eu-posso-armazenar-como-texto" class="section level2" number="11.4">
<h2 number="11.4"><span class="header-section-number">11.4</span> Porque utilizar fatores se eu posso armazenar como texto ?</h2>
<p>Você provavelmente está se perguntando qual a necessidade verdadeira dos fatores, levando em conta que você pode utilizar o tipo <code>character</code> para armazenar os dados de um variável qualitativa. <span class="citation"><a href="#ref-wickham2017" role="doc-biblioref">Wickham and Grolemund</a> (<a href="#ref-wickham2017" role="doc-biblioref">2017</a>, p 224)</span> nos concede um ótimo exemplo de como um fator pode fazer toda a diferença.</p>
<p>Por exemplo, suponha que você possua o vetor abaixo contendo alguns meses do ano. Em geral, há dois problemas no uso de um vetor do tipo <code>character</code> para guardar essas informações.</p>
<p></p>
<div class="sourceCode" id="cb1156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1156-1"><a href="#cb1156-1" aria-hidden="true" tabindex="-1"></a>vec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Mar&quot;</span>, <span class="st">&quot;Fev&quot;</span>, <span class="st">&quot;Jan&quot;</span>, <span class="st">&quot;Set&quot;</span>, <span class="st">&quot;Out&quot;</span>, <span class="st">&quot;Abr&quot;</span>)</span></code></pre></div>
<p></p>
<p>Primeiro, você não está prevenido contra possíveis erros ortográficos. Isso pode ser um problema de pouca importância caso esses dados estejam sendo gerados por uma máquina ou programa, mas ele se torna um problema sério caso você esteja anotando esses valores na mão, ou esteja constantemente corrigindo-os de alguma maneira que seja suscetível ao erro. Logo, se algum mês for incorretamente gravado, nenhum erro ou medida cautelar será acionada pelo R para corrigir esse problema.</p>
<p>Segundo, quando essas informações estão sendo guardadas pelo tipo <code>character</code>, o sistema de ordenação utilizado pelo R (ordenação alfabética) é de pouca utilidade. Como você pode ver abaixo, o R acabou colocando o mês de abril antes dos meses de fevereiro e janeiro.</p>
<p></p>
<div class="sourceCode" id="cb1157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1157-1"><a href="#cb1157-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sort</span>(vec)</span></code></pre></div>
<pre><code>## [1] &quot;Abr&quot; &quot;Fev&quot; &quot;Jan&quot; &quot;Mar&quot; &quot;Out&quot; &quot;Set&quot;</code></pre>
<p></p>
<p>O uso do tipo <code>factor</code> consegue resolver ambos desses problemas. Pois você já sabe que qualquer valor disposto em <code>vec</code>, que possua algum erro ortográfico em comparação com os meses dispostos no atributo <code>levels</code> do fator será automaticamente convertido para um valor <code>NA</code>. Além disso, <strong>ao ordenar um objeto do tipo <code>factor</code>, o R sempre vai utilizar como referência, a ordem na qual os valores estão apresentados no atributo <code>levels</code>.</strong></p>
<p>Como o vetor <code>vec</code> guarda alguns meses do ano, o vetor <code>meses</code> abaixo, representa o atributo <code>levels</code> do fator a ser criado a partir de <code>vec</code>. Lembre-se que, a ordem na qual os meses estão dispostos no atributo <code>levels</code>, afeta diretamente a maneira como o R ordena o fator. Logo, a ordem em que você fornece os valores em <code>meses</code>, será a ordem utilizada pelo R ao ordenar os valores de <code>vec_fator</code>.</p>
<p></p>
<div class="sourceCode" id="cb1159"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1159-1"><a href="#cb1159-1" aria-hidden="true" tabindex="-1"></a>meses <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Jan&quot;</span>, <span class="st">&quot;Fev&quot;</span>, <span class="st">&quot;Mar&quot;</span>, <span class="st">&quot;Abr&quot;</span>, <span class="st">&quot;Mai&quot;</span>, <span class="st">&quot;Jun&quot;</span>,</span>
<span id="cb1159-2"><a href="#cb1159-2" aria-hidden="true" tabindex="-1"></a>           <span class="st">&quot;Jul&quot;</span>, <span class="st">&quot;Ago&quot;</span>, <span class="st">&quot;Set&quot;</span>, <span class="st">&quot;Out&quot;</span>, <span class="st">&quot;Nov&quot;</span>, <span class="st">&quot;Dez&quot;</span>)</span>
<span id="cb1159-3"><a href="#cb1159-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1159-4"><a href="#cb1159-4" aria-hidden="true" tabindex="-1"></a>vec_fator <span class="ot">&lt;-</span> <span class="fu">factor</span>(vec, <span class="at">levels =</span> meses)</span>
<span id="cb1159-5"><a href="#cb1159-5" aria-hidden="true" tabindex="-1"></a>vec_fator</span></code></pre></div>
<pre><code>## [1] Mar Fev Jan Set Out Abr
## Levels: Jan Fev Mar Abr Mai Jun Jul Ago Set Out Nov Dez</code></pre>
<div class="sourceCode" id="cb1161"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1161-1"><a href="#cb1161-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sort</span>(vec_fator)</span></code></pre></div>
<pre><code>## [1] Jan Fev Mar Abr Set Out
## Levels: Jan Fev Mar Abr Mai Jun Jul Ago Set Out Nov Dez</code></pre>
<p></p>
</div>
<div id="não-construir-o-atributo-levels-é-contraintuitivo" class="section level2" number="11.5">
<h2 number="11.5"><span class="header-section-number">11.5</span> Não construir o atributo <code>levels</code> é contraintuitivo</h2>
<p>Apesar de ser o ideal, você não precisa obrigatoriamente construir o atributo <code>levels</code> ao formar um fator. Pois você tem a opção de delegar esse trabalho para a própria função <code>factor()</code>, ao aplicá-la diretamente sobre o seu vetor de interesse.</p>
<p>Porém, ao escolher esse caminho, <code>factor()</code> vai extrair todos os valores únicos de seu vetor, e posicioná-los em ordem alfabética no atributo <code>levels</code>. Ou seja, supondo que o seu vetor de interesse se chame <code>x</code>, é como se o atributo <code>levels</code> de seu fator, equivalesse ao resultado dos comandos: <code>unique(x) %&gt;% sort()</code>; ou de outra forma: <code>sort(unique(x))</code>. Veja o exemplo abaixo:</p>
<p></p>
<div class="sourceCode" id="cb1163"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1163-1"><a href="#cb1163-1" aria-hidden="true" tabindex="-1"></a>v_letras <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;e&quot;</span>, <span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>, <span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;d&quot;</span>)</span>
<span id="cb1163-2"><a href="#cb1163-2" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="fu">factor</span>(v_letras)</span>
<span id="cb1163-3"><a href="#cb1163-3" aria-hidden="true" tabindex="-1"></a>f</span></code></pre></div>
<pre><code>## [1] e a b c a b d
## Levels: a b c d e</code></pre>
<div class="sourceCode" id="cb1165"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1165-1"><a href="#cb1165-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sort</span>(f)</span></code></pre></div>
<pre><code>## [1] a a b b c d e
## Levels: a b c d e</code></pre>
<p></p>
<p>Perceba acima, que tal comportamento de <code>factor()</code> torna o uso de fatores, algo inútil ou desnecessário. Pois a ordenação de seu fator será idêntica à ordenação alfabética utilizada sobre um vetor do tipo <code>character</code>. Lembre-se que para a ordenação de um fator, é utilizada a ordem na qual os valores são apresentados em <code>levels()</code>. Tal ponto pode ser inferido pelo exemplo abaixo, em que a ordenação produzida sobre os valores de <code>v_letras</code> é a mesma (em comparação com o resultado acima) quando ela se encontra no tipo <code>character</code>.</p>
<p></p>
<div class="sourceCode" id="cb1167"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1167-1"><a href="#cb1167-1" aria-hidden="true" tabindex="-1"></a>v_letras <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;e&quot;</span>, <span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>, <span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;d&quot;</span>)</span>
<span id="cb1167-2"><a href="#cb1167-2" aria-hidden="true" tabindex="-1"></a><span class="fu">typeof</span>(v_letras)</span></code></pre></div>
<pre><code>## [1] &quot;character&quot;</code></pre>
<div class="sourceCode" id="cb1169"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1169-1"><a href="#cb1169-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sort</span>(v_letras)</span></code></pre></div>
<pre><code>## [1] &quot;a&quot; &quot;a&quot; &quot;b&quot; &quot;b&quot; &quot;c&quot; &quot;d&quot; &quot;e&quot;</code></pre>
<p></p>
</div>
<div id="alterando-a-ordem-dos-níveis-de-um-fator" class="section level2" number="11.6">
<h2 number="11.6"><span class="header-section-number">11.6</span> Alterando a ordem dos níveis de um fator</h2>
<p>Portanto, o sistema de ordenação é um dos principais recursos do tipo <code>factor</code> no R, e tal sistema está diretamente conectado com o seu atributo <code>levels</code>. Por isso, uma das principais atividades com fatores está na reordenação e do atributo <code>levels</code>, ou em sua reatribuição.</p>
<div id="a-maneira-mais-simples-e-direta" class="section level3" number="11.6.1">
<h3 number="11.6.1"><span class="header-section-number">11.6.1</span> A maneira mais simples e direta</h3>
<p>A forma mais “simples” de alterarmos esse atributo é redefinindo-o por completo através da função <code>levels()</code>. Repare no exemplo abaixo, que apenas a letra “a” foi reposicionada no atributo.</p>
<p></p>
<div class="sourceCode" id="cb1171"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1171-1"><a href="#cb1171-1" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(f) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>, <span class="st">&quot;d&quot;</span>, <span class="st">&quot;e&quot;</span>, <span class="st">&quot;a&quot;</span>)</span>
<span id="cb1171-2"><a href="#cb1171-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sort</span>(f)</span></code></pre></div>
<pre><code>## [1] b b c c d e a
## Levels: b c d e a</code></pre>
<p></p>
<p>Tal operação poderia ser realizada de diversas formas. Por exemplo, caso o seu fator possua um número muito grande de níveis, ao invés de reescrevê-los na mão, talvez seja mais rápido utilizar técnicas de <em>subsetting</em> para reordenar os níveis da maneira desejada.</p>
<p></p>
<div class="sourceCode" id="cb1173"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1173-1"><a href="#cb1173-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Criando um fator com muitos níveis</span></span>
<span id="cb1173-2"><a href="#cb1173-2" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>, <span class="st">&quot;d&quot;</span>, <span class="st">&quot;e&quot;</span>)</span>
<span id="cb1173-3"><a href="#cb1173-3" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(f) <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb1173-4"><a href="#cb1173-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>, <span class="st">&quot;d&quot;</span>, <span class="st">&quot;e&quot;</span>, <span class="st">&quot;f&quot;</span>, <span class="st">&quot;g&quot;</span>,</span>
<span id="cb1173-5"><a href="#cb1173-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;h&quot;</span>, <span class="st">&quot;i&quot;</span>, <span class="st">&quot;j&quot;</span>, <span class="st">&quot;k&quot;</span>, <span class="st">&quot;l&quot;</span>, <span class="st">&quot;m&quot;</span>, <span class="st">&quot;n&quot;</span>,</span>
<span id="cb1173-6"><a href="#cb1173-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;o&quot;</span>, <span class="st">&quot;p&quot;</span>, <span class="st">&quot;q&quot;</span>, <span class="st">&quot;r&quot;</span>, <span class="st">&quot;s&quot;</span>, <span class="st">&quot;t&quot;</span>, <span class="st">&quot;u&quot;</span>,</span>
<span id="cb1173-7"><a href="#cb1173-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;v&quot;</span>, <span class="st">&quot;w&quot;</span>, <span class="st">&quot;x&quot;</span>, <span class="st">&quot;y&quot;</span>, <span class="st">&quot;z&quot;</span></span>
<span id="cb1173-8"><a href="#cb1173-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1173-9"><a href="#cb1173-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1173-10"><a href="#cb1173-10" aria-hidden="true" tabindex="-1"></a><span class="do">## Selecionando os níveis atuais</span></span>
<span id="cb1173-11"><a href="#cb1173-11" aria-hidden="true" tabindex="-1"></a><span class="do">## e reordenando-os com subsetting</span></span>
<span id="cb1173-12"><a href="#cb1173-12" aria-hidden="true" tabindex="-1"></a>niveis_atuais <span class="ot">&lt;-</span> <span class="fu">levels</span>(f)</span>
<span id="cb1173-13"><a href="#cb1173-13" aria-hidden="true" tabindex="-1"></a>n_niveis <span class="ot">&lt;-</span> <span class="fu">length</span>(niveis_atuais)</span>
<span id="cb1173-14"><a href="#cb1173-14" aria-hidden="true" tabindex="-1"></a>novos_niveis <span class="ot">&lt;-</span> niveis_atuais[<span class="fu">c</span>(<span class="dv">4</span><span class="sc">:</span><span class="dv">2</span>, <span class="dv">5</span><span class="sc">:</span>n_niveis, <span class="dv">1</span>)]</span>
<span id="cb1173-15"><a href="#cb1173-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1173-16"><a href="#cb1173-16" aria-hidden="true" tabindex="-1"></a><span class="do">## Redefinindo os níveis do fator</span></span>
<span id="cb1173-17"><a href="#cb1173-17" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(f) <span class="ot">&lt;-</span> novos_niveis</span>
<span id="cb1173-18"><a href="#cb1173-18" aria-hidden="true" tabindex="-1"></a>f</span></code></pre></div>
<pre><code>## [1] &quot;a&quot; &quot;b&quot; &quot;c&quot; &quot;d&quot; &quot;e&quot;
## attr(,&quot;levels&quot;)
##  [1] &quot;d&quot; &quot;c&quot; &quot;b&quot; &quot;e&quot; &quot;f&quot; &quot;g&quot; &quot;h&quot; &quot;i&quot; &quot;j&quot; &quot;k&quot; &quot;l&quot; &quot;m&quot; &quot;n&quot; &quot;o&quot; &quot;p&quot; &quot;q&quot; &quot;r&quot;
## [18] &quot;s&quot; &quot;t&quot; &quot;u&quot; &quot;v&quot; &quot;w&quot; &quot;x&quot; &quot;y&quot; &quot;z&quot; &quot;a&quot;</code></pre>
<p></p>
</div>
<div id="maneiras-alternativas-que-podem-fazer-a-diferença" class="section level3" number="11.6.2">
<h3 number="11.6.2"><span class="header-section-number">11.6.2</span> Maneiras alternativas que podem fazer a diferença</h3>
<p>O pacote <code>forcats</code> oferece várias funções voltadas especificamente para o trabalho com fatores no R. Dentre essas funções, temos a <code>fct_infreq()</code>, que lhe permite reordenar o atributo <code>levels</code> de acordo com a frequência em que cada nível aparece no vetor (do nível mais frequente para o menos frequente).</p>
<p></p>
<div class="sourceCode" id="cb1175"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1175-1"><a href="#cb1175-1" aria-hidden="true" tabindex="-1"></a>v_letras <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;e&quot;</span>, <span class="st">&quot;d&quot;</span>, <span class="st">&quot;d&quot;</span>, <span class="st">&quot;c&quot;</span>, <span class="st">&quot;a&quot;</span>, <span class="st">&quot;a&quot;</span>, <span class="st">&quot;a&quot;</span>, <span class="st">&quot;c&quot;</span>,</span>
<span id="cb1175-2"><a href="#cb1175-2" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;b&quot;</span>, <span class="st">&quot;d&quot;</span>, <span class="st">&quot;d&quot;</span>, <span class="st">&quot;e&quot;</span>, <span class="st">&quot;d&quot;</span>, <span class="st">&quot;a&quot;</span>, <span class="st">&quot;d&quot;</span>, <span class="st">&quot;c&quot;</span>)</span>
<span id="cb1175-3"><a href="#cb1175-3" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="fu">factor</span>(v_letras)</span>
<span id="cb1175-4"><a href="#cb1175-4" aria-hidden="true" tabindex="-1"></a><span class="fu">fct_infreq</span>(f)</span></code></pre></div>
<pre><code>##  [1] e d d c a a a c b d d e d a d c
## Levels: d a c e b</code></pre>
<p></p>
<p>Além disso, você também pode estar interessado em ordenar os níveis de um fator, de acordo com a ordem da primeira aparição de cada nível. Para isso, nós podemos utilizar a função <code>fct_inorder()</code>. Perceba pelo resultado do exemplo abaixo, que as letras “e,” “d” e “c” antecedem as letras “a” e “b” no atributo <code>levels</code> do fator gerado, pois essas letras aparecem primeiro no vetor original.</p>
<p></p>
<div class="sourceCode" id="cb1177"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1177-1"><a href="#cb1177-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fct_inorder</span>(f)</span></code></pre></div>
<pre><code>##  [1] e d d c a a a c b d d e d a d c
## Levels: e d c a b</code></pre>
<p></p>
<p>Para mais, haverá momentos em que você deseja ordenar os níveis de seu fator, de acordo com uma segunda variável. Essa situação ocorre principalmente quando o seu fator está incluso em um <code>data.frame</code>, junto de várias outras variáveis de seu interesse. Para tal ação, temos a função <code>fct_reorder()</code>, que lhe permite fornecer uma segunda variável na qual a ordenação do atributo <code>levels</code> será baseada.</p>
<p>Como exemplo, suponha que você possua a seguinte tabela contendo receitas mensais de algumas lojas:</p>
<p></p>
<div class="sourceCode" id="cb1179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1179-1"><a href="#cb1179-1" aria-hidden="true" tabindex="-1"></a>unidades <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Savassi&quot;</span>, <span class="st">&quot;Centro&quot;</span>, <span class="st">&quot;Gameleira&quot;</span>, <span class="st">&quot;Pampulha&quot;</span>)</span>
<span id="cb1179-2"><a href="#cb1179-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">3</span>)</span>
<span id="cb1179-3"><a href="#cb1179-3" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb1179-4"><a href="#cb1179-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">ano =</span> <span class="dv">2021</span>,</span>
<span id="cb1179-5"><a href="#cb1179-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">mes =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="at">each =</span> <span class="dv">4</span>),</span>
<span id="cb1179-6"><a href="#cb1179-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">unidade =</span> <span class="fu">rep</span>(unidades, <span class="at">times =</span> <span class="dv">12</span>),</span>
<span id="cb1179-7"><a href="#cb1179-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">receita =</span> <span class="fu">rnorm</span>(<span class="dv">48</span>, <span class="dv">17000</span>, <span class="dv">4800</span>)</span>
<span id="cb1179-8"><a href="#cb1179-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1179-9"><a href="#cb1179-9" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> <span class="fu">arrange</span>(tab, mes, unidade)</span>
<span id="cb1179-10"><a href="#cb1179-10" aria-hidden="true" tabindex="-1"></a>tab</span></code></pre></div>
<pre><code>## # A tibble: 48 x 4
##      ano   mes unidade   receita
##    &lt;dbl&gt; &lt;int&gt; &lt;chr&gt;       &lt;dbl&gt;
##  1  2021     1 Centro     15596.
##  2  2021     1 Gameleira  18242.
##  3  2021     1 Pampulha   11470.
##  4  2021     1 Savassi    12383.
##  5  2021     2 Centro     17145.
##  6  2021     2 Gameleira  17410.
##  7  2021     2 Pampulha   22360.
##  8  2021     2 Savassi    17940.
##  9  2021     3 Centro     23083.
## 10  2021     3 Gameleira  13425.
## # ... with 38 more rows</code></pre>
<p></p>
<p>No exemplo abaixo, ao transformarmos a variável <code>unidade</code> em um fator, os níveis da variável são organizados em ordem alfabética, como era esperado.</p>
<p></p>
<div class="sourceCode" id="cb1181"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1181-1"><a href="#cb1181-1" aria-hidden="true" tabindex="-1"></a>tab<span class="sc">$</span>unidade <span class="ot">&lt;-</span> <span class="fu">factor</span>(tab<span class="sc">$</span>unidade)</span>
<span id="cb1181-2"><a href="#cb1181-2" aria-hidden="true" tabindex="-1"></a>tab<span class="sc">$</span>unidade</span></code></pre></div>
<pre><code>##  [1] Centro    Gameleira Pampulha  Savassi   Centro    Gameleira Pampulha 
##  [8] Savassi   Centro    Gameleira Pampulha  Savassi   Centro    Gameleira
## [15] Pampulha  Savassi   Centro    Gameleira Pampulha  Savassi   Centro   
## [22] Gameleira Pampulha  Savassi   Centro    Gameleira Pampulha  Savassi  
## [29] Centro    Gameleira Pampulha  Savassi   Centro    Gameleira Pampulha 
## [36] Savassi   Centro    Gameleira Pampulha  Savassi   Centro    Gameleira
## [43] Pampulha  Savassi   Centro    Gameleira Pampulha  Savassi  
## Levels: Centro Gameleira Pampulha Savassi</code></pre>
<p></p>
<p>A função <code>fct_reorder()</code> vai sempre ordenar o seu fator de acordo com um sumário, ou alguma estatística descritiva da segunda variável. Por isso, você deve se perguntar qual estatística descritiva você deseja utilizar sobre a segunda variável em questão. Como exemplo, você talvez queira ordenar os níveis de <code>unidade</code>, de acordo com a receita média mensal de cada loja.</p>
<p>Logo, desejamos aplicar uma função de média sobre a variável <code>receita</code> ao longo de cada nível do fator <code>unidade</code>. Por isso, eu forneço a função <code>mean()</code> ao argumento <code>.fun</code> de <code>fct_reorder()</code>. Como podemos ver abaixo, as unidades do Centro e da Savassi possuem receitas médias menores do que unidades da Pampulha e da Gameleira, pois essas unidades se encontram nas primeiras posições do atributo <code>levels</code> do fator resultante de <code>fct_reorder()</code>. Ou seja, a função <code>fct_reorder()</code> utiliza, por padrão, uma ordem crescente no atributo <code>levels</code>. Caso você deseje inverter esse comportamento, basta configurar o argumento <code>.desc</code> da função para <code>TRUE</code>.</p>
<p></p>
<div class="sourceCode" id="cb1183"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1183-1"><a href="#cb1183-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Utilize: fct_reorder(unidade, receita, .fun = mean, .desc = TRUE)</span></span>
<span id="cb1183-2"><a href="#cb1183-2" aria-hidden="true" tabindex="-1"></a><span class="do">## para utilizar uma ordenação crescente no atributo levels</span></span>
<span id="cb1183-3"><a href="#cb1183-3" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> tab <span class="sc">%&gt;%</span> </span>
<span id="cb1183-4"><a href="#cb1183-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb1183-5"><a href="#cb1183-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">unidade =</span> <span class="fu">fct_reorder</span>(unidade, receita, <span class="at">.fun =</span> mean)</span>
<span id="cb1183-6"><a href="#cb1183-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb1183-7"><a href="#cb1183-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1183-8"><a href="#cb1183-8" aria-hidden="true" tabindex="-1"></a>tab<span class="sc">$</span>unidade</span></code></pre></div>
<pre><code>##  [1] Centro    Gameleira Pampulha  Savassi   Centro    Gameleira Pampulha 
##  [8] Savassi   Centro    Gameleira Pampulha  Savassi   Centro    Gameleira
## [15] Pampulha  Savassi   Centro    Gameleira Pampulha  Savassi   Centro   
## [22] Gameleira Pampulha  Savassi   Centro    Gameleira Pampulha  Savassi  
## [29] Centro    Gameleira Pampulha  Savassi   Centro    Gameleira Pampulha 
## [36] Savassi   Centro    Gameleira Pampulha  Savassi   Centro    Gameleira
## [43] Pampulha  Savassi   Centro    Gameleira Pampulha  Savassi  
## Levels: Centro Savassi Pampulha Gameleira</code></pre>
<p></p>
</div>
</div>
<div id="reordenando-fatores-em-gráficos" class="section level2" number="11.7">
<h2 number="11.7"><span class="header-section-number">11.7</span> Reordenando fatores em gráficos</h2>
<p>A ordem na qual apresentamos certas informações pode mudar drasticamente não apenas as características físicas e visuais de seu gráfico, mas também, pode afetar e muito a clareza ou a ênfase em certas informações que são cruciais em nosso gráfico. Por essa razão, reordenar variáveis categóricas em seu gráfico pode ser fundamental. Veja o primeiro exemplo abaixo, dado por <span class="citation"><a href="#ref-wickham2017" role="doc-biblioref">Wickham and Grolemund</a> (<a href="#ref-wickham2017" role="doc-biblioref">2017</a>, p 228)</span>.</p>
<p>Dentre as funções que mostramos na seção passada, a função <code>fct_reorder()</code> é talvez a mais útil delas em gráficos. Por exemplo, no gráfico abaixo, temos certa dificuldade em comparar e, principalmente, classificar os vários tempos médios gastos dentro de cada grupo religioso.</p>
<p></p>
<div class="sourceCode" id="cb1185"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1185-1"><a href="#cb1185-1" aria-hidden="true" tabindex="-1"></a>relig <span class="ot">&lt;-</span> gss_cat <span class="sc">%&gt;%</span></span>
<span id="cb1185-2"><a href="#cb1185-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(relig) <span class="sc">%&gt;%</span></span>
<span id="cb1185-3"><a href="#cb1185-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb1185-4"><a href="#cb1185-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">age =</span> <span class="fu">mean</span>(age, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb1185-5"><a href="#cb1185-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">tvhours =</span> <span class="fu">mean</span>(tvhours, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb1185-6"><a href="#cb1185-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">n</span>()</span>
<span id="cb1185-7"><a href="#cb1185-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb1185-8"><a href="#cb1185-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1185-9"><a href="#cb1185-9" aria-hidden="true" tabindex="-1"></a>relig <span class="sc">%&gt;%</span> </span>
<span id="cb1185-10"><a href="#cb1185-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb1185-11"><a href="#cb1185-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(tvhours, relig))</span></code></pre></div>
<p><img src="Introducao_R_files/figure-html/unnamed-chunk-667-1.png" width="65%" style="display: block; margin: auto;" /></p>
<p></p>
<p>Tal problema, pode ser rapidamente resolvido ao aplicarmos a função <code>fct_reorder()</code> sobre a variável no eixo y, para que ela seja reordenada de acordo com os valores da variável do eixo x do gráfico. Perceba abaixo, que agora temos uma facilidade muito maior em comparar e classificar os vários tempos médios gastos em cada grupo religioso. Com essa nova ordenação, podemos rapidamente identificar que as pessoas que não sabem (<em>“Don’t know”</em>) a sua religião (ou que são ateus), são aquelas que mais gastam seu tempo em frente a uma televisão.</p>
<p></p>
<div class="sourceCode" id="cb1186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1186-1"><a href="#cb1186-1" aria-hidden="true" tabindex="-1"></a>relig <span class="sc">%&gt;%</span> </span>
<span id="cb1186-2"><a href="#cb1186-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb1186-3"><a href="#cb1186-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb1186-4"><a href="#cb1186-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(tvhours, <span class="fu">fct_reorder</span>(relig, tvhours))</span>
<span id="cb1186-5"><a href="#cb1186-5" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="Introducao_R_files/figure-html/unnamed-chunk-668-1.png" width="65%" style="display: block; margin: auto;" /></p>
<p></p>
<p>Como um outro exemplo, pode haver certas variáveis que não necessitam de uma reordenação acentuada. Além disso, tais variáveis podem possuir uma ordem própria, que não depende de uma segunda variável. Ou seja, essas variáveis podem possuir uma “ordem natural.” Essa característica, torna o uso de <code>fct_reorder()</code> inadequado (lembre-se que <code>fct_reorder()</code> busca reordenar um fator de acordo com os valores de uma segunda variável).</p>
<p>Por exemplo, se você olhar para o gráfico abaixo, você poderá perceber que temos uma variável de faixa etária no eixo y, e que apenas a faixa de “Menos de 10” está incorretamente posicionada no eixo. Pelo fato das faixas etárias possuírem uma “ordem natural,” isto é, as faixas “mais altas” são aquelas referentes às idades mais elevadas, enquanto as faixas “mais baixas” são aquelas referentes às idades “mais baixas,” não faz sentido reordenarmos essa variável de acordo com os valores de uma segunda variável.</p>
<p></p>
<div class="sourceCode" id="cb1187"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1187-1"><a href="#cb1187-1" aria-hidden="true" tabindex="-1"></a>github <span class="ot">&lt;-</span> <span class="st">&quot;https://raw.githubusercontent.com/pedropark99/&quot;</span></span>
<span id="cb1187-2"><a href="#cb1187-2" aria-hidden="true" tabindex="-1"></a>arquivo <span class="ot">&lt;-</span> <span class="st">&quot;Curso-R/master/Dados/datasus.csv&quot;</span></span>
<span id="cb1187-3"><a href="#cb1187-3" aria-hidden="true" tabindex="-1"></a>datasus <span class="ot">&lt;-</span> <span class="fu">read_csv2</span>(<span class="fu">paste0</span>(github, arquivo))</span>
<span id="cb1187-4"><a href="#cb1187-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1187-5"><a href="#cb1187-5" aria-hidden="true" tabindex="-1"></a>totais <span class="ot">&lt;-</span> datasus <span class="sc">%&gt;%</span> </span>
<span id="cb1187-6"><a href="#cb1187-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="st">`</span><span class="at">Faixa etaria</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1187-7"><a href="#cb1187-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb1187-8"><a href="#cb1187-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">Total =</span> <span class="fu">sum</span>(Contagem)</span>
<span id="cb1187-9"><a href="#cb1187-9" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p></p>
<p></p>
<div class="sourceCode" id="cb1188"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1188-1"><a href="#cb1188-1" aria-hidden="true" tabindex="-1"></a>totais <span class="sc">%&gt;%</span> </span>
<span id="cb1188-2"><a href="#cb1188-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb1188-3"><a href="#cb1188-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(</span>
<span id="cb1188-4"><a href="#cb1188-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">y =</span> <span class="st">`</span><span class="at">Faixa etaria</span><span class="st">`</span>, <span class="at">x =</span> Total)</span>
<span id="cb1188-5"><a href="#cb1188-5" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="Introducao_R_files/figure-html/unnamed-chunk-671-1.png" width="65%" style="display: block; margin: auto;" /></p>
<p></p>
<p>Portanto, a faixa de “Menos de 10” é a única faixa a ser reposicionada, e podemos realizar tal ação com a função <code>fct_relevel()</code>. Repare no exemplo abaixo, que após o ajuste, a faixa “Menos de 10” foi realocada para a posição mais inferior do eixo.</p>
<p></p>
<div class="sourceCode" id="cb1189"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1189-1"><a href="#cb1189-1" aria-hidden="true" tabindex="-1"></a>totais <span class="sc">%&gt;%</span> </span>
<span id="cb1189-2"><a href="#cb1189-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb1189-3"><a href="#cb1189-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Faixa etaria</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">fct_relevel</span>(<span class="st">`</span><span class="at">Faixa etaria</span><span class="st">`</span>, <span class="st">&quot;Menos de 10&quot;</span>)</span>
<span id="cb1189-4"><a href="#cb1189-4" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb1189-5"><a href="#cb1189-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb1189-6"><a href="#cb1189-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(</span>
<span id="cb1189-7"><a href="#cb1189-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">y =</span> <span class="st">`</span><span class="at">Faixa etaria</span><span class="st">`</span>, <span class="at">x =</span> Total)</span>
<span id="cb1189-8"><a href="#cb1189-8" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="Introducao_R_files/figure-html/unnamed-chunk-672-1.png" width="65%" style="display: block; margin: auto;" /></p>
<p></p>
<p>Além dessas opções, a função <code>fct_infreq()</code> é muito útil para gráficos de barras do <code>ggplot</code>, que incluem por padrão um cálculo de frequência. Em outras palavras, ao lembrarmos que <code>fct_infreq()</code> busca reordenar um fator de acordo com a frequência em que os seus níveis aparecem em seus dados, se torna muito natural aliarmos essa função a um gráfico de barras do <code>ggplot</code>.</p>
<p>Por exemplo, se gerarmos um gráfico de barras a partir de cada cor de pele presente em nossa tabela <code>datasus</code>, temos o seguinte resultado:</p>
<p></p>
<div class="sourceCode" id="cb1190"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1190-1"><a href="#cb1190-1" aria-hidden="true" tabindex="-1"></a>datasus <span class="sc">%&gt;%</span> </span>
<span id="cb1190-2"><a href="#cb1190-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb1190-3"><a href="#cb1190-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(</span>
<span id="cb1190-4"><a href="#cb1190-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> Cor)</span>
<span id="cb1190-5"><a href="#cb1190-5" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="Introducao_R_files/figure-html/unnamed-chunk-673-1.png" width="65%" style="display: block; margin: auto;" /></p>
<p></p>
<p>Agora, com o uso de <code>fct_infreq()</code> podemos reposicionar essas barras em um sentido mais lógico, como está demonstrado abaixo:</p>
<p></p>
<div class="sourceCode" id="cb1191"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1191-1"><a href="#cb1191-1" aria-hidden="true" tabindex="-1"></a>datasus <span class="sc">%&gt;%</span> </span>
<span id="cb1191-2"><a href="#cb1191-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb1191-3"><a href="#cb1191-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(</span>
<span id="cb1191-4"><a href="#cb1191-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">fct_infreq</span>(Cor))</span>
<span id="cb1191-5"><a href="#cb1191-5" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="Introducao_R_files/figure-html/unnamed-chunk-674-1.png" width="65%" style="display: block; margin: auto;" /></p>
<p></p>
</div>
<div id="modificando-os-níveis-de-um-fator" class="section level2" number="11.8">
<h2 number="11.8"><span class="header-section-number">11.8</span> Modificando os níveis de um fator</h2>
<p>Até o momento, demos bastante foco sobre a ordenação dos valores presentes no atributo <code>levels</code>. Justamente pelo fato de que essa característica define uma das principais vantagens do tipo <code>factor</code> no R, que é a de modificar a forma como a linguagem ordena os valores presentes em um vetor. Porém, ainda não discutimos o que ocorre quando nós deliberadamente alteramos um dos valores presentes no atributo <code>levels</code>.</p>
<p>Por exemplo, suponha que eu possua o fator abaixo. Nesse caso, o fator <code>f</code> possui quatro níveis, sendo eles: <code>a</code>, <code>b</code>, <code>c</code>, e <code>d</code>.</p>
<p></p>
<div class="sourceCode" id="cb1192"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1192-1"><a href="#cb1192-1" aria-hidden="true" tabindex="-1"></a>vec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;c&quot;</span>, <span class="st">&quot;c&quot;</span>, <span class="st">&quot;d&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>)</span>
<span id="cb1192-2"><a href="#cb1192-2" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="fu">factor</span>(vec, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>, <span class="st">&quot;d&quot;</span>))</span>
<span id="cb1192-3"><a href="#cb1192-3" aria-hidden="true" tabindex="-1"></a>f</span></code></pre></div>
<pre><code>## [1] a c c d b a b
## Levels: a b c d</code></pre>
<p></p>
<p>Agora, o que ocorre se eu tentar modificar o primeiro nível (<code>a</code>) desse fator? De maneira elegante e surpreendente, o R irá substituir todos os valores <code>a</code> presentes no fator, pelo novo valor definido, como está demonstrado abaixo:</p>
<p></p>
<div class="sourceCode" id="cb1194"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1194-1"><a href="#cb1194-1" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(f) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;m&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>, <span class="st">&quot;d&quot;</span>)</span>
<span id="cb1194-2"><a href="#cb1194-2" aria-hidden="true" tabindex="-1"></a>f</span></code></pre></div>
<pre><code>## [1] m c c d b m b
## Levels: m b c d</code></pre>
<p></p>
<p>Assim como nas seções anteriores, o pacote <code>forcats</code> também oferece algumas funções muito úteis para esse procedimento. Veja o exemplo abaixo, em que eu utilizo a função <code>fct_recode()</code> para reconfigurar todos os níveis (ou valores) presentes coluna <code>Cor</code> em nossa tabela <code>datasus</code>.</p>
<p></p>
<div class="sourceCode" id="cb1196"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1196-1"><a href="#cb1196-1" aria-hidden="true" tabindex="-1"></a>datasus <span class="sc">%&gt;%</span> </span>
<span id="cb1196-2"><a href="#cb1196-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb1196-3"><a href="#cb1196-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">Cor =</span> <span class="fu">fct_recode</span>(</span>
<span id="cb1196-4"><a href="#cb1196-4" aria-hidden="true" tabindex="-1"></a>      Cor,</span>
<span id="cb1196-5"><a href="#cb1196-5" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;Carmim&quot;</span> <span class="ot">=</span> <span class="st">&quot;Parda&quot;</span>,</span>
<span id="cb1196-6"><a href="#cb1196-6" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;Azul&quot;</span> <span class="ot">=</span> <span class="st">&quot;Amarela&quot;</span>,</span>
<span id="cb1196-7"><a href="#cb1196-7" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;Bronze&quot;</span> <span class="ot">=</span> <span class="st">&quot;Branca&quot;</span>,</span>
<span id="cb1196-8"><a href="#cb1196-8" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;Roxo&quot;</span> <span class="ot">=</span> <span class="st">&quot;Indígena&quot;</span></span>
<span id="cb1196-9"><a href="#cb1196-9" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb1196-10"><a href="#cb1196-10" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 1,836 x 6
##    `Faixa etaria` Genero    Cor    `Nome UF` UF    Contagem
##    &lt;chr&gt;          &lt;chr&gt;     &lt;fct&gt;  &lt;chr&gt;     &lt;chr&gt;    &lt;dbl&gt;
##  1 10 a 14        Feminino  Carmim Acre      AC           4
##  2 10 a 14        Masculino Carmim Acre      AC           4
##  3 15 a 19        Feminino  Bronze Acre      AC           2
##  4 15 a 19        Feminino  Carmim Acre      AC           4
##  5 15 a 19        Masculino Bronze Acre      AC           6
##  6 15 a 19        Masculino Carmim Acre      AC          65
##  7 15 a 19        Masculino Preta  Acre      AC           1
##  8 20 a 24        Feminino  Roxo   Acre      AC           1
##  9 20 a 24        Feminino  Carmim Acre      AC           4
## 10 20 a 24        Masculino Bronze Acre      AC           7
## # ... with 1,826 more rows</code></pre>
<p></p>
<p>Caso você precise unir diversos níveis em um só, ou, em outras palavras, se você precisa agregar vários níveis, a função <code>fct_collapse()</code> é uma melhor escolha. Pois ela lhe permite fornecer um vetor contendo todos os níveis antigos a serem agregados em um só. Veja o exemplo abaixo, em que eu agrego diversas faixas etárias, gerando assim, uma descrição etária menos detalhada:</p>
<p></p>
<div class="sourceCode" id="cb1198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1198-1"><a href="#cb1198-1" aria-hidden="true" tabindex="-1"></a>datasus <span class="sc">%&gt;%</span> </span>
<span id="cb1198-2"><a href="#cb1198-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb1198-3"><a href="#cb1198-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Faixa etaria</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">fct_collapse</span>(</span>
<span id="cb1198-4"><a href="#cb1198-4" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Faixa etaria</span><span class="st">`</span>,</span>
<span id="cb1198-5"><a href="#cb1198-5" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;Menos de 19 anos&quot;</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;Menos de 10&quot;</span>, <span class="st">&quot;10 a 14&quot;</span>, <span class="st">&quot;15 a 19&quot;</span>),</span>
<span id="cb1198-6"><a href="#cb1198-6" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;Entre 20 e 64 anos&quot;</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;20 a 24&quot;</span>, <span class="st">&quot;25 a 29&quot;</span>, <span class="st">&quot;30 a 34&quot;</span>,</span>
<span id="cb1198-7"><a href="#cb1198-7" aria-hidden="true" tabindex="-1"></a>                               <span class="st">&quot;35 a 39&quot;</span>, <span class="st">&quot;40 a 44&quot;</span>, <span class="st">&quot;45 a 49&quot;</span>,</span>
<span id="cb1198-8"><a href="#cb1198-8" aria-hidden="true" tabindex="-1"></a>                               <span class="st">&quot;50 a 54&quot;</span>, <span class="st">&quot;55 a 59&quot;</span>, <span class="st">&quot;60 a 64&quot;</span>),</span>
<span id="cb1198-9"><a href="#cb1198-9" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;Acima de 64 anos&quot;</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;65 a 69&quot;</span>, <span class="st">&quot;Mais de 70&quot;</span>)</span>
<span id="cb1198-10"><a href="#cb1198-10" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb1198-11"><a href="#cb1198-11" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 1,836 x 6
##    `Faixa etaria`     Genero    Cor      `Nome UF` UF    Contagem
##    &lt;fct&gt;              &lt;chr&gt;     &lt;chr&gt;    &lt;chr&gt;     &lt;chr&gt;    &lt;dbl&gt;
##  1 Menos de 19 anos   Feminino  Parda    Acre      AC           4
##  2 Menos de 19 anos   Masculino Parda    Acre      AC           4
##  3 Menos de 19 anos   Feminino  Branca   Acre      AC           2
##  4 Menos de 19 anos   Feminino  Parda    Acre      AC           4
##  5 Menos de 19 anos   Masculino Branca   Acre      AC           6
##  6 Menos de 19 anos   Masculino Parda    Acre      AC          65
##  7 Menos de 19 anos   Masculino Preta    Acre      AC           1
##  8 Entre 20 e 64 anos Feminino  Indígena Acre      AC           1
##  9 Entre 20 e 64 anos Feminino  Parda    Acre      AC           4
## 10 Entre 20 e 64 anos Masculino Branca   Acre      AC           7
## # ... with 1,826 more rows</code></pre>
<p></p>
<!--chapter:end:11-factors.Rmd-->
</div>
</div>
<div id="introdução-à-variáveis-de-tempo-com-lubridate" class="section level1" number="12">
<h1 number="12"><span class="header-section-number">12</span> Introdução à variáveis de tempo com <code>lubridate</code></h1>
<div id="sec:lubridate_var_tempo" class="section level2" number="12.1">
<h2 number="12.1"><span class="header-section-number">12.1</span> Introdução e pré-requisitos</h2>
<p>Variáveis de tempo são aquelas que guardam <strong>informações que se encontram em alguma unidade de tempo</strong>. Exemplos são: datas (i.e. 20 de março de 2020), ou horários - que preferencialmente são acompanhados por uma data (i.e. 11:45 da manhã do dia 12 de fevereiro de 2001; ou, 12/02/2001 11:45:00), ou ainda, a duração (ou o tempo) de algum evento (12 segundos, 12 dias, 2 semanas, 1 mês e meio, etc.).</p>
<p>Tais variáveis podem ser interpretadas no R por meio de quatro tipos de dados diferentes, sendo eles: <code>Date</code>, <code>POSIXlt</code>, <code>POSIXct</code> e <code>difftime</code>. Logo, neste capítulo, vamos focar nesses quatro tipos de dados, e, introduzir várias ferramentas e operações comumente aplicadas sobre eles. Parte dessas ferramentas advém do pacote <code>lubridate</code> e, portanto, para acompanhar os exemplos deste capítulo, você deve (após instalar esse pacote em sua máquina) chamar por esse pacote em sua sessão, através do comando <code>library()</code>.</p>
<p></p>
<div class="sourceCode" id="cb1200"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1200-1"><a href="#cb1200-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span></code></pre></div>
<p></p>
</div>
<div id="o-pacote-lubridate" class="section level2" number="12.2">
<h2 number="12.2"><span class="header-section-number">12.2</span> O pacote <code>lubridate</code></h2>
<p>Como é bem descrito por <span class="citation"><a href="#ref-rnews2001" role="doc-biblioref">Ripley and Hornik</a> (<a href="#ref-rnews2001" role="doc-biblioref">2001</a>)</span> e <span class="citation"><a href="#ref-rnews2004" role="doc-biblioref">Grothendieck and Petzoldt</a> (<a href="#ref-rnews2004" role="doc-biblioref">2004</a>)</span>, desde sua versão 1.9, o R oferece “de fábrica” um excelente suporte para variáveis de tempo. Suas funções são capazes de lidar muito bem com diferenças entre fusos horários, além de incluírem anos bissextos e horários de verão. Porém, mesmo com esse potencial, essas funções (<code>as.Date()</code>, <code>as.POSIXct()</code>, <code>strptime()</code>, dentre outras) tendem a aplicar definições muito formais, tornando-as assim, pouca intuitivas para muitos usuários.</p>
<p>Por esse motivo, o pacote <code>lubridate</code> tem tido muito sucesso ao longo da comunidade, ao prover funções que realizam grande parte do trabalho irritante com essas funções. Ou seja, no fundo, várias das funções do pacote <code>lubridate</code> são apenas <em>wrappers</em>, isto é, são construídas a partir das funções do pacote básico do R. Significa que o pacote <code>lubridate</code> foi criado, em grande parte, com o intuito de facilitar o nosso trabalho com as ferramentas que o R já oferece, ao invés de remodelá-las por completo.</p>
<p>Portanto, ao longo deste capítulo, você irá aprender primeiro sobre as funções do pacote <code>lubridate</code>, e, em seguida, as funções básicas do R são apresentadas para aqueles que desejam conhecer mais a fundo tal sistema. Dessa forma, nós estaremos apresentando primeiro, o atalho, e, em seguida, o caminho completo.</p>
</div>
<div id="datas-com-o-tipo-date" class="section level2" number="12.3">
<h2 number="12.3"><span class="header-section-number">12.3</span> Datas com o tipo <code>Date</code></h2>
<p>No R, datas são normalmente interpretadas através do tipo de dado <code>Date</code>. Temos 3 métodos principais de se criar uma data no R (existem outros métodos menos intuitivos<a href="#fn36" class="footnote-ref" id="fnref36"><sup>36</sup></a>), os quais estão resumidos na figura 12.1 abaixo, e que são apresentados a seguir: 1) a partir de <em>strings</em> (um vetor do tipo <code>character</code>); 2) a partir de cada componente da data (dia, mês e ano); e 3) a partir de números.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/layout_horizontal_dates.png" alt="Principais métodos para se criar datas no R" width="100%" />
<p class="caption">
(#fig:unnamed-chunk-680)Principais métodos para se criar datas no R
</p>
</div>
<p></p>
<p>Dentre as funções dos pacotes básicos do R, a função <code>as.Date()</code> é a principal função responsável por criar vetores do tipo <code>Date</code>. Todavia, ao longo dessa seção, estaremos focados nas funções do pacote <code>lubridate</code>, em especial, a função <code>as_date()</code>. De qualquer forma, saiba que, no fim das contas, as funções desse pacote vão utilizar a função <code>as.Date()</code> para criar o vetor contendo as suas datas. As funções <code>as_date()</code> e <code>as.Date()</code> são muito semelhantes entre si, logo, grande parte do conhecimento mostrado em <code>as_date()</code>, pode ser diretamente aplicado em <code>as.Date()</code>.</p>
<p>Ao longo das próximas seções, você pode rapidamente perceber que a formação de dados do tipo <code>Date</code> (assim como dos tipos <code>POSIXct</code> e <code>POSIXlt</code>) no R, envolve o ato de coerção de vetores que se encontram em outros tipos (como <code>character</code> ou <code>double</code>) para o tipo <code>Date</code>. Em outras palavras, não é possível criarmos diretamente um vetor do tipo <code>Date</code>. O motivo para tal prática, pode ser atribuído às diversas maneiras em que uma mesma data (além das outras variáveis de tempo) pode ser escrita, ou representada. Por essa diversidade, o R busca oferecer flexibilidade aos seus usuários, através de diferentes métodos de coerção. A figura 12.1, resume os principais métodos que vamos aprender ao longo dessa seção, além de algumas características importantes que envolvem o tipo <code>Date</code>.</p>
<div id="a-partir-de-strings" class="section level3" number="12.3.1">
<h3 number="12.3.1"><span class="header-section-number">12.3.1</span> A partir de <em>strings</em></h3>
<p>Como exemplo inicial, podemos fornecer à função <code>as_date()</code> (do pacote <code>lubridate</code>), a data 01 de abril de 2020 como um <em>string</em>. Repare abaixo, que o resultado final da operação é um vetor do tipo <code>Date</code> (e não do tipo <code>character</code>).</p>
<p></p>
<div class="sourceCode" id="cb1201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1201-1"><a href="#cb1201-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">as_date</span>(<span class="st">&quot;2020-04-01&quot;</span>)</span>
<span id="cb1201-2"><a href="#cb1201-2" aria-hidden="true" tabindex="-1"></a>d</span></code></pre></div>
<pre><code>## [1] &quot;2020-04-01&quot;</code></pre>
<div class="sourceCode" id="cb1203"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1203-1"><a href="#cb1203-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(d)</span></code></pre></div>
<pre><code>## [1] &quot;Date&quot;</code></pre>
<p></p>
<p>Entretanto, você talvez tenha achado estranho o formato em que a data foi escrita na função <code>as_date()</code>. Pois no Brasil, datas são normalmente escritas no padrão “dia/mês/ano” (ex: 01/04/2020), e não “ano-mês-dia.” Este é o formato estipulado pelo padrão internacional ISO-8601, que é o padrão adotado pelo R. Ou seja, no R, datas são manipuladas, estocadas, fornecidas e apresentadas no formato “ano-mês-dia.”</p>
<p>Você irá rapidamente perceber que, muitos países podem escrever uma mesma data de maneiras muito diferentes. Por exemplo, nos EUA, datas são usualmente escritas no formato “mês-dia-ano” (ex: 02-18-2021), mas também aparecem muitas vezes em sua forma extensa (ex: February 18, 2021). Em algumas regiões da Espanha, datas são escritas no formato “ano/dia/mês” (ex: 2020/15/08). Também não é incomum encontrarmos em países nórdicos (Suécia, Finlândia, Dinamarca), datas escritas com o uso de pontos separando cada componente (ex: 2020.08.15).</p>
<p>Toda essa variedade só torna o nosso trabalho mais complicado, especialmente se nós não sabemos qual a origem, ou, o padrão adotado por essas datas. E não há nada que você possa fazer a respeito, a não ser, identificar por conta própria o padrão adotado e ajustar a função empregada de acordo com esse padrão.</p>
</div>
<div id="sec:formato_diferente_date" class="section level3" number="12.3.2">
<h3 number="12.3.2"><span class="header-section-number">12.3.2</span> O que devo fazer se minhas datas se encontram em um formato diferente?</h3>
<p>Portanto, caso você possua um conjunto de datas como <em>strings</em> (ou seja, em um vetor do tipo <code>character</code>), e, essas datas estejam em um formato diferente do estipulado pela ISO-8601, você tem 2 opções rápidas para transportar corretamente essas datas para o tipo <code>Date</code>.</p>
<p>Primeiro, todas as funções no R que lidam com variáveis de tempo, geralmente oferecem um argumento <code>format</code>, no qual você pode definir o formato, ou o padrão adotado por suas datas. Logo, você precisa apenas definir o argumento <code>format</code> em <code>as_date()</code>, ou em qualquer outra função que você esteja utilizando para essa coerção.</p>
<p>Segundo, você também pode utilizar as funções rápidas do pacote <code>lubridate</code>, <code>ymd()</code>, <code>dmy()</code>, <code>dym()</code> e <code>mdy()</code>, que já possuem uma ordem implícita, ou um <code>format</code> padrão. Dessa maneira, você economiza certo tempo, ao não ter que se preocupar com o argumento <code>format</code> nessas funções.</p>
<p>Por exemplo, suponha que você possua um conjunto de datas escritas no Brasil, guardadas no vetor <code>datas</code>, e que você deseja converter esse vetor (que se encontra no momento, no tipo <code>character</code>) para o tipo <code>Date</code>. Como os componentes da data estão na ordem “dia <span class="math inline">\(\rightarrow\)</span> mês <span class="math inline">\(\rightarrow\)</span> ano,” eu utilizo a função <code>dmy()</code> para ler essas datas.</p>
<p></p>
<div class="sourceCode" id="cb1205"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1205-1"><a href="#cb1205-1" aria-hidden="true" tabindex="-1"></a>datas <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;15/03/2020&quot;</span>, <span class="st">&quot;16/03/2020&quot;</span>, <span class="st">&quot;18/03/2020&quot;</span>, <span class="st">&quot;24/03/2020&quot;</span>)</span>
<span id="cb1205-2"><a href="#cb1205-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dmy</span>(datas)</span></code></pre></div>
<pre><code>## [1] &quot;2020-03-15&quot; &quot;2020-03-16&quot; &quot;2020-03-18&quot; &quot;2020-03-24&quot;</code></pre>
<p></p>
<p>Isso significa que, <strong>a ordem na qual as letras “d,” “m” e “y” aparecem no nome da função, representa a ordem adotada pelo argumento <code>format</code> dessa função</strong>. Em outras palavras, a letra “d” simboliza o “dia”; a letra “m” por sua vez, o “mês”; e a letra “y,” o “ano,” ou, em inglês, <em>“year”</em>. Ou seja, a função <code>dmy()</code> espera como <em>input</em>, datas cujos componentes estejam na ordem “dia <span class="math inline">\(\rightarrow\)</span> mês <span class="math inline">\(\rightarrow\)</span> ano” (ou “<code>d</code> <span class="math inline">\(\rightarrow\)</span> <code>m</code> <span class="math inline">\(\rightarrow\)</span> <code>y</code>”). Já a função <code>ymd()</code>, tem como expectativa, datas cujos componentes estejam na ordem “ano <span class="math inline">\(\rightarrow\)</span> mês <span class="math inline">\(\rightarrow\)</span> dia” (ou “<code>y</code> <span class="math inline">\(\rightarrow\)</span> <code>m</code> <span class="math inline">\(\rightarrow\)</span> <code>d</code>”).</p>
<p>Portanto, as funções rápidas <code>dmy()</code>, <code>ymd()</code> e suas irmãs, possuem implicitamente uma ordem esperada para os componentes de suas datas. Para mais, essas funções identificam automaticamente qualquer caractere que não seja um dígito, e os trata como os delimitadores que separam cada componente da data. Logo, não importa se cada componente está sendo separado por um hífen (<code>-</code>), ponto (<code>.</code>), cifrão (<code>$</code>) ou barra inclinada (<code>/</code>), essas funções serão capazes de detectar esses caracteres e ignorá-los durante a conversão.</p>
<p>Como já foi descrito acima, a segunda alternativa seria definirmos explicitamente o argumento <code>format</code> em <code>as_date()</code>. Neste argumento, você deve fornecer uma pequena definição<a href="#fn37" class="footnote-ref" id="fnref37"><sup>37</sup></a> que descreve o padrão no qual a sua data se encontra. Para construir tal definição, você irá utilizar um conjunto de códigos, que são formados pelo símbolo de porcentagem acompanhado de uma letra específica. Cada um desses códigos, podem representar um dos três componentes de uma data (dia, mês e ano). A tabela abaixo apresenta um resumo desses códigos.</p>
<p></p>
<p></p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/tab_codigos_format_date.png" alt="Códigos que representam cada componente de uma data" width="65%" />
<p class="caption">
(#fig:unnamed-chunk-684)Códigos que representam cada componente de uma data
</p>
</div>
<p></p>
<p>Tendo os códigos acima, se uma data no Brasil é escrita no formato “dia/mês/ano,” uma descrição que representa tal padrão é <code>"%d/%m/%Y"</code>. Como um outro exemplo, se temos as datas <code>"2021, 30-12"</code> e <code>"97,10,January"</code>, podemos utilizar respectivamente os valores <code>"%Y, %d-%m"</code> e <code>"%y,%d,%B"</code> para descrever os padrões adotados por cada uma. Veja os exemplos abaixo:</p>
<p></p>
<div class="sourceCode" id="cb1207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1207-1"><a href="#cb1207-1" aria-hidden="true" tabindex="-1"></a>datas <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;15/03/2020&quot;</span>, <span class="st">&quot;16/03/2020&quot;</span>, <span class="st">&quot;18/03/2020&quot;</span>, <span class="st">&quot;24/03/2020&quot;</span>)</span>
<span id="cb1207-2"><a href="#cb1207-2" aria-hidden="true" tabindex="-1"></a><span class="fu">as_date</span>(datas, <span class="at">format =</span> <span class="st">&quot;%d/%m/%Y&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2020-03-15&quot; &quot;2020-03-16&quot; &quot;2020-03-18&quot; &quot;2020-03-24&quot;</code></pre>
<div class="sourceCode" id="cb1209"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1209-1"><a href="#cb1209-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as_date</span>(<span class="st">&quot;2021, 30-12&quot;</span>, <span class="at">format =</span> <span class="st">&quot;%Y, %d-%m&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2021-12-30&quot;</code></pre>
<div class="sourceCode" id="cb1211"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1211-1"><a href="#cb1211-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as_date</span>(<span class="st">&quot;97,10,January&quot;</span>, <span class="at">format =</span> <span class="st">&quot;%y,%d,%B&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;1997-01-10&quot;</code></pre>
<div class="sourceCode" id="cb1213"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1213-1"><a href="#cb1213-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as_date</span>(<span class="st">&quot;12-30-1997&quot;</span>, <span class="at">format =</span> <span class="st">&quot;%m-%d-%Y&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;1997-12-30&quot;</code></pre>
<p></p>
<p>Um detalhe importante é que os códigos <code>%b</code> e <code>%B</code> são capazes de representar apenas os nomes dos meses em inglês (ex: <em>april</em>, <em>december</em>, <em>october</em>). Por isso, se as suas datas possuem os nomes dos meses, em qualquer outra língua que não seja o inglês, você terá que, obrigatoriamente, traduzir esses nomes para o inglês, ou convertê-los para sua versão numérica (março = 03; abril = 04; maio = 05; e assim por diante).</p>
</div>
<div id="a-partir-de-cada-componente" class="section level3" number="12.3.3">
<h3 number="12.3.3"><span class="header-section-number">12.3.3</span> A partir de cada componente</h3>
<p>Também é muito comum, termos cada um dos componentes separados em uma coluna específica de nossa tabela. Como exemplo, temos abaixo a tabela <code>registros</code>, onde o ano, mês e dia estão separados em uma determinada coluna da tabela.</p>
<p>Para unirmos esses componentes em uma data, nós podemos utilizar a função <code>make_date()</code>. Por meio dessa função, você precisa apenas conectar os argumentos <code>year</code>, <code>month</code> e <code>day</code>, aos nomes das colunas que contém o ano, mês e dia (respectivamente), de cada observação da tabela, como demonstrado abaixo.</p>
<p></p>
<div class="sourceCode" id="cb1215"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1215-1"><a href="#cb1215-1" aria-hidden="true" tabindex="-1"></a>registros <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb1215-2"><a href="#cb1215-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">valor =</span> <span class="fu">c</span>(<span class="fl">5.50</span>, <span class="fl">4.25</span>, <span class="fl">1.32</span>, <span class="fl">24.10</span>, <span class="fl">12.50</span>),</span>
<span id="cb1215-3"><a href="#cb1215-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">dia =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">8</span>, <span class="dv">12</span>, <span class="dv">15</span>),</span>
<span id="cb1215-4"><a href="#cb1215-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">mes =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">4</span>),</span>
<span id="cb1215-5"><a href="#cb1215-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">ano =</span> <span class="fu">c</span>(<span class="dv">2021</span>, <span class="dv">2021</span>, <span class="dv">2021</span>, <span class="dv">2021</span>, <span class="dv">2021</span>)</span>
<span id="cb1215-6"><a href="#cb1215-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1215-7"><a href="#cb1215-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1215-8"><a href="#cb1215-8" aria-hidden="true" tabindex="-1"></a>registros <span class="ot">&lt;-</span> <span class="fu">mutate</span>(</span>
<span id="cb1215-9"><a href="#cb1215-9" aria-hidden="true" tabindex="-1"></a>  registros,</span>
<span id="cb1215-10"><a href="#cb1215-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="fu">make_date</span>(<span class="at">year =</span> ano, <span class="at">month =</span> mes, <span class="at">day =</span> dia)</span>
<span id="cb1215-11"><a href="#cb1215-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1215-12"><a href="#cb1215-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1215-13"><a href="#cb1215-13" aria-hidden="true" tabindex="-1"></a>registros</span></code></pre></div>
<pre><code>## # A tibble: 5 x 5
##   valor   dia   mes   ano data      
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;date&gt;    
## 1  5.5      5     4  2021 2021-04-05
## 2  4.25     6     4  2021 2021-04-06
## 3  1.32     8     4  2021 2021-04-08
## 4 24.1     12     4  2021 2021-04-12
## 5 12.5     15     4  2021 2021-04-15</code></pre>
<p></p>
<p>Além disso, é importante frisar que, os seus componentes não precisam necessariamente estar dentro de um <code>data.frame</code>. Dito de outra forma, você também pode fornecer cada componente de sua data como um vetor. Veja o exemplo abaixo:</p>
<p></p>
<div class="sourceCode" id="cb1217"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1217-1"><a href="#cb1217-1" aria-hidden="true" tabindex="-1"></a>dias <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">12</span>, <span class="dv">15</span>, <span class="dv">7</span>)</span>
<span id="cb1217-2"><a href="#cb1217-2" aria-hidden="true" tabindex="-1"></a>mes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb1217-3"><a href="#cb1217-3" aria-hidden="true" tabindex="-1"></a>ano <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2020</span>, <span class="dv">2020</span>, <span class="dv">2020</span>, <span class="dv">2020</span>, <span class="dv">2021</span>)</span>
<span id="cb1217-4"><a href="#cb1217-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1217-5"><a href="#cb1217-5" aria-hidden="true" tabindex="-1"></a><span class="fu">make_date</span>(<span class="at">year =</span> ano, <span class="at">month =</span> mes, <span class="at">day =</span> dias)</span></code></pre></div>
<pre><code>## [1] &quot;2020-01-01&quot; &quot;2020-01-04&quot; &quot;2020-02-12&quot; &quot;2020-02-15&quot; &quot;2021-02-07&quot;</code></pre>
<p></p>
</div>
<div id="a-partir-de-números" class="section level3" number="12.3.4">
<h3 number="12.3.4"><span class="header-section-number">12.3.4</span> A partir de números</h3>
<p>Para mais, o R também nos permite criar uma data a partir de um número. Por exemplo, eu posso criar a data <code>"2020-04-01"</code> (01 de abril de 2020) através do número 18353. Repare abaixo, que ao invés de um vetor do tipo <code>double</code> contendo o número inicial (18353), a operação me retorna um vetor do tipo <code>Date</code>, contendo a data supracitada.</p>
<p></p>
<div class="sourceCode" id="cb1219"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1219-1"><a href="#cb1219-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">as_date</span>(<span class="dv">18353</span>)</span>
<span id="cb1219-2"><a href="#cb1219-2" aria-hidden="true" tabindex="-1"></a>d</span></code></pre></div>
<pre><code>## [1] &quot;2020-04-01&quot;</code></pre>
<div class="sourceCode" id="cb1221"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1221-1"><a href="#cb1221-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(d)</span></code></pre></div>
<pre><code>## [1] &quot;Date&quot;</code></pre>
<p></p>
<p>Quando você fornece um vetor numérico à função <code>as_date()</code>, todos os números contidos neste vetor são tratados como o número de dias desde a data <code>"1970-01-01"</code>, ou, 01 de janeiro de 1970. Em outras palavras, o R utiliza uma “escala de dias,” e a data <code>"1970-01-01"</code> representa a origem, ou o ponto zero dessa escala (para representar dias anteriores a essa data, utilizamos números negativos). Nós denominamos essa data, como a <strong>data de origem</strong>.</p>
<p>Portanto, o número 18353 nos retorna a data <code>"2020-04-01"</code>, pelo fato de que este dia está a 18353 dias de distância da data <code>"1970-01-01"</code>. Caso você ainda sinta certa confusão, visite a seção <a href="#sec:interp_var_tempo">Como as variáveis de tempo são interpretadas pelo R ?</a>, que busca prover uma descrição mais formal e mais detalhada dos conceitos de data de origem e escala de tempo.</p>
</div>
<div id="fique-atento-aos-tipos-de-dados-empregados" class="section level3" number="12.3.5">
<h3 number="12.3.5"><span class="header-section-number">12.3.5</span> Fique atento aos tipos de dados empregados!</h3>
<p>Vale a pena destacar que, apesar de serem apresentadas a você como <em>strings</em>, dados do tipo <code>Date</code> são guardados e interpretados de uma maneira completamente diferente dos dados do tipo <code>character</code>. Ou seja, quando valores do tipo <code>Date</code> aparecem em seu console, eles sempre aparecem contornados por aspas duplas, como se fossem dados do tipo <code>character</code>. <strong>E não há qualquer informação aparente no console, que te indique qual dos dois tipos (<code>Date</code> ou <code>character</code>) está sendo empregado sobre esses valores.</strong></p>
<p>Por isso, é muito importante que você esteja atento à forma como o R está interpretando os seus dados. Use e abuse de funções e de testes lógicos que possam lhe assegurar que os seus dados estão sendo interpretados da maneira esperada! Tendo essas considerações em mente, a forma mais rápida de identificarmos se um vetor é do tipo <code>character</code>, ou do tipo <code>Date</code>, é descobrirmos a sua classe, por meio da função <code>class()</code>. Repare no exemplo abaixo, que o primeiro valor pertence ao tipo <code>character</code>, enquanto o segundo, está sendo interpretado pelo tipo <code>Date</code>.</p>
<p></p>
<div class="sourceCode" id="cb1223"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1223-1"><a href="#cb1223-1" aria-hidden="true" tabindex="-1"></a>texto <span class="ot">&lt;-</span> <span class="st">&quot;2020-08-01&quot;</span></span>
<span id="cb1223-2"><a href="#cb1223-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">&quot;2020-08-01&quot;</span>)</span>
<span id="cb1223-3"><a href="#cb1223-3" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(texto)</span></code></pre></div>
<pre><code>## [1] &quot;character&quot;</code></pre>
<div class="sourceCode" id="cb1225"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1225-1"><a href="#cb1225-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(data)</span></code></pre></div>
<pre><code>## [1] &quot;Date&quot;</code></pre>
<div class="sourceCode" id="cb1227"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1227-1"><a href="#cb1227-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Um teste lógico para o tipo Date</span></span>
<span id="cb1227-2"><a href="#cb1227-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(texto) <span class="sc">==</span> <span class="st">&quot;Date&quot;</span></span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<div class="sourceCode" id="cb1229"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1229-1"><a href="#cb1229-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(data) <span class="sc">==</span> <span class="st">&quot;Date&quot;</span></span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p></p>
<p>Por outro lado, caso as suas datas estejam dentro de um <code>tibble</code>, tal problemática perde um pouco de sua importância. Pois como descrevemos na seção <a href="#sec:fundamentos_tibble"><code>tibble</code>’s como uma alternativa moderna aos <code>data.frame</code>’s</a>, quando um <code>tibble</code> aparece em seu console, ele sempre disponibiliza uma pequena descrição logo abaixo do nome de cada coluna, indicando o tipo de dado contido nela. Portanto, no exemplo abaixo, podemos rapidamente identificar pela descrição <code>&lt;date&gt;</code>, que os dados presentes na coluna <code>data</code> pertencem ao tipo de dado <code>Date</code>.</p>
<p></p>
<div class="sourceCode" id="cb1231"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1231-1"><a href="#cb1231-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tibble)</span>
<span id="cb1231-2"><a href="#cb1231-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1231-3"><a href="#cb1231-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(</span>
<span id="cb1231-4"><a href="#cb1231-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="fu">dmy</span>(<span class="fu">c</span>(<span class="st">&quot;20/05/2020&quot;</span>, <span class="st">&quot;21/05/2020&quot;</span>, <span class="st">&quot;22/05/2020&quot;</span>, <span class="st">&quot;23/05/2020&quot;</span>))</span>
<span id="cb1231-5"><a href="#cb1231-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## # A tibble: 4 x 1
##   data      
##   &lt;date&gt;    
## 1 2020-05-20
## 2 2020-05-21
## 3 2020-05-22
## 4 2020-05-23</code></pre>
<p></p>
</div>
</div>
<div id="datas-horários-e-fusos-horários-com-os-tipos-posixct-e-posixlt" class="section level2" number="12.4">
<h2 number="12.4"><span class="header-section-number">12.4</span> Datas, horários e fusos horários com os tipos <code>POSIXct</code> e <code>POSIXlt</code></h2>
<p>Em várias ocasiões, empresas, agentes e governos, precisam registrar o instante de ocorrência de algum episódio com um alto nível de precisão. Com isso, eu quero dizer que em certas situações, precisamos não apenas da data, mas também do horário e do fuso horário em que certo evento ocorre. Para isso, o R nos oferece os tipos <code>POSIXct</code> e <code>POSIXlt</code>, que são capazes de guardar não apenas datas, mas também horários além de fusos horários.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/date_time.png" alt="Como um ponto no tempo é definido nos tipos `POSIXct` e `POSIXlt`" width="85%" />
<p class="caption">
(#fig:unnamed-chunk-691)Como um ponto no tempo é definido nos tipos <code>POSIXct</code> e <code>POSIXlt</code>
</p>
</div>
<p></p>
<p>No fundo, o R utiliza as funções <code>as.POSIXct()</code> e <code>as.POSIXlt()</code> para criar um objeto dos tipos <code>POSIXct</code> e <code>POSIXlt</code>, respectivamente. Portanto, mesmo que as ferramentas apresentadas nessa seção pertençam (em sua maioria) ao pacote <code>lubridate</code>, saiba que no fundo, as funções <code>as.POSIXct()</code> e <code>as.POSIXlt()</code> são empregadas para criar o seu vetor do tipo <code>POSIXct</code> e <code>POSIXlt</code>.</p>
<p>Dentro da comunidade de R, vários usuários costumam se referir aos tipos <code>POSIXct</code> e <code>POSIXlt</code>, em uma forma mais intuitiva. Sendo o termo <code>date-time</code>, o mais utilizado para tal referência. Portanto, <code>date-time</code> é um sinônimo (ou uma gíria) utilizado para se referir à “espécie” de dado (isto é, uma data acompanhada de um horário e de um fuso horário) armazenado pelos tipos <code>POSIXct</code> e <code>POSIXlt</code>.</p>
<p>Por isso, ao longo dessa seção, quando estivermos descrevendo características gerais que se aplicam a ambos os tipos, vamos utilizar o termo <code>date-time</code> como um sinônimo aos tipos <code>POSIXct</code> e <code>POSIXlt</code>. Por outro lado, quando estivermos descrevendo características específicas de cada um, vamos utilizar o nome do tipo correspondente.</p>
<div id="criando-vetores-do-tipo-date-time" class="section level3" number="12.4.1">
<h3 number="12.4.1"><span class="header-section-number">12.4.1</span> Criando vetores do tipo <code>date-time</code></h3>
<p>Para criarmos um vetor contendo dados do tipo <code>date-time</code>, podemos utilizar exatamente os mesmos métodos empregados no tipo <code>Date</code>, com pequenas modificações. Isto é, podemos criar um vetor dos tipos <code>POSIXct</code> e <code>POSIXlt</code>: 1) a partir de <em>strings</em>; 2) a partir de números; e 3) a partir de cada componente deste <code>date-time</code>. Um resumo de tais métodos, além de algumas observações quanto ao tipo <code>date-time</code>, são apresentados na figura 12.3.</p>
<p>Para realizar cada um desses métodos, o pacote <code>lubridate</code> nos oferece a função <code>as_datetime()</code>. Todavia, vale apontar que essa função sempre gera um vetor do tipo <code>POSIXct</code> como resultado. Por isso, se você deseja converter o seu objeto para o tipo <code>POSIXlt</code>, aplique a função <code>as.POSIXlt()</code> sobre o resultado de <code>as_datetime()</code>.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/layout_horizontal_dates-times.png" alt="Principais métodos para se criar dados do tipo `date-time` no R" width="100%" />
<p class="caption">
(#fig:unnamed-chunk-692)Principais métodos para se criar dados do tipo <code>date-time</code> no R
</p>
</div>
<p></p>
</div>
<div id="a-partir-de-strings-1" class="section level3" number="12.4.2">
<h3 number="12.4.2"><span class="header-section-number">12.4.2</span> A partir de <em>strings</em></h3>
<p>Assim como descrevemos durante as seções do tipo <code>Date</code>, o R segue as regras definidas no padrão internacional ISO-8601 para armazenar e interpretar suas variáveis de tempo. Esse padrão delimita que, dados do tipo <code>date-time</code> devem ser escritos no formato “ano-mês-dia hora:minuto:segundo.” A figura 12.4, provê uma representação visual de tal formato.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/formato_datetime.png" alt="Formato padrão no R para dados do tipo `date-time`" width="60%" />
<p class="caption">
(#fig:unnamed-chunk-693)Formato padrão no R para dados do tipo <code>date-time</code>
</p>
</div>
<p></p>
<p>Mais abaixo, temos um exemplo em que um objeto chamado <code>dt</code> é criado, com o objetivo de guardar o seguinte ponto no tempo: 10 horas, 40 minutos e 35 segundos do dia 01 de janeiro de 2020. Repare nesse exemplo, que nós não incluímos na <em>string</em> inicial qualquer informação a respeito do fuso horário utilizado. Mesmo assim, a função <code>as_datetime()</code> automaticamente configurou o horário com o fuso UTC, que corresponde à <em>Coordinated Universal Time</em>. Portanto, sempre que você não definir explicitamente um fuso horário, a função <code>as_datetime()</code> vai utilizar o fuso horário UTC.</p>
<p>Para mais, isso demonstra que <strong>não é necessário incluirmos o fuso horário utilizado, diretamente na <em>string</em> a ser fornecido</strong>. Pois tal informação é definida separadamente no argumento <code>tz</code> da função.</p>
<p></p>
<div class="sourceCode" id="cb1233"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1233-1"><a href="#cb1233-1" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">&lt;-</span> <span class="fu">as_datetime</span>(<span class="st">&quot;2020-01-01 10:40:35&quot;</span>)</span>
<span id="cb1233-2"><a href="#cb1233-2" aria-hidden="true" tabindex="-1"></a>dt</span></code></pre></div>
<pre><code>## [1] &quot;2020-01-01 10:40:35 UTC&quot;</code></pre>
<p></p>
<p><strong>Isso não significa que, as <em>strings</em> não devem ou não podem conter qualquer informação a respeito do fuso horário</strong>. Mas significa que essas informações serão, por padrão, ignoradas pela função, que vai utilizar o fuso UTC para qualquer <em>input</em>. Veja o exemplo abaixo, em que dois fusos horários diferentes são testados, e o mesmo resultado é gerado em ambos.</p>
<p></p>
<div class="sourceCode" id="cb1235"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1235-1"><a href="#cb1235-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as_datetime</span>(<span class="st">&quot;2020-01-01 10:40:35 Portugal&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2020-01-01 10:40:35 UTC&quot;</code></pre>
<div class="sourceCode" id="cb1237"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1237-1"><a href="#cb1237-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as_datetime</span>(<span class="st">&quot;2020-01-01 10:40:35 America/Sao_Paulo&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2020-01-01 10:40:35 UTC&quot;</code></pre>
<p></p>
<p>Portanto, a maneira correta de definir o fuso horário a ser empregado, é por meio do argumento <code>tz</code>, como demonstrado abaixo:</p>
<p></p>
<div class="sourceCode" id="cb1239"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1239-1"><a href="#cb1239-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as_datetime</span>(<span class="st">&quot;2020-01-01 10:40:35&quot;</span>, <span class="at">tz =</span> <span class="st">&quot;Portugal&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2020-01-01 10:40:35 WET&quot;</code></pre>
<div class="sourceCode" id="cb1241"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1241-1"><a href="#cb1241-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as_datetime</span>(<span class="st">&quot;2020-01-01 10:40:35&quot;</span>, <span class="at">tz =</span> <span class="st">&quot;America/Sao_Paulo&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2020-01-01 10:40:35 -03&quot;</code></pre>
<p></p>
<p>Fusos horários são usualmente fornecidos ao argumento <code>tz</code> por meio de um código (e.g. <code>"WET"</code>, <code>"UTC"</code>, <code>"ROK"</code>, <code>"CET"</code>, etc.), ou por meio de uma referência de região ou cidade específica (e.g. <code>"Europe/Paris"</code>, <code>"Pacific/Auckland"</code>, <code>"America/Toronto"</code>, etc.). Para consultar a lista completa de valores reconhecidos pelo R, execute a função <code>OlsonNames()</code> em seu console.</p>
<p>Dito de outra forma, valores como <code>"ROK"</code> (abreviação para <em>Republic of Korea</em>), <code>"CET"</code> (<em>Central European Time</em>), <code>"America/Sao_Paulo"</code> (cidade de São Paulo) e <code>"Pacific/Auckland"</code> (cidade de Auckland), são aceitos pelo argumento <code>tz</code>, porque eles estão inclusos no resultado da função <code>OlsonNames()</code>. Em contraste, valores como <code>"São Paulo"</code>, <code>"WST"</code>, e <code>"+11"</code>, não são aceitos pelo argumento <code>tz</code>, pois não estão presentes em <code>OlsonNames()</code>.</p>
<p></p>
<div class="sourceCode" id="cb1243"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1243-1"><a href="#cb1243-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as_datetime</span>(<span class="st">&quot;2020-01-01 10:34:12&quot;</span>, <span class="at">tz =</span> <span class="st">&quot;CET&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2020-01-01 10:34:12 CET&quot;</code></pre>
<div class="sourceCode" id="cb1245"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1245-1"><a href="#cb1245-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as_datetime</span>(<span class="st">&quot;2020-01-01 10:34:12&quot;</span>, <span class="at">tz =</span> <span class="st">&quot;ROK&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2020-01-01 10:34:12 KST&quot;</code></pre>
<div class="sourceCode" id="cb1247"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1247-1"><a href="#cb1247-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as_datetime</span>(<span class="st">&quot;2020-01-01 10:34:12&quot;</span>, <span class="at">tz =</span> <span class="st">&quot;Pacific/Auckland&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2020-01-01 10:34:12 NZDT&quot;</code></pre>
<p></p>
<p></p>
<div class="sourceCode" id="cb1249"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1249-1"><a href="#cb1249-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Quando incluímos um fuso horário desconhecido</span></span>
<span id="cb1249-2"><a href="#cb1249-2" aria-hidden="true" tabindex="-1"></a><span class="do">### pelo R, a seguinte mensagem de erro aparece:</span></span>
<span id="cb1249-3"><a href="#cb1249-3" aria-hidden="true" tabindex="-1"></a><span class="fu">as_datetime</span>(<span class="st">&quot;2020-01-01 10:34:12&quot;</span>, <span class="at">tz =</span> <span class="st">&quot;WST&quot;</span>)</span></code></pre></div>
<p></p>
<p></p>
<pre class="text"><code>Error in C_force_tz(time, tz = tzone, roll) : 
  CCTZ: Unrecognized output timezone: &quot;WST&quot;</code></pre>
<p></p>
</div>
<div id="sec:date_time_formato_diferente" class="section level3" number="12.4.3">
<h3 number="12.4.3"><span class="header-section-number">12.4.3</span> O que devo fazer se meus dados se encontram em um formato diferente?</h3>
<p>Da mesma maneira que uma mesma data pode ser escrita de várias formas, horários também podem assumir formatos diferentes. Sendo que, diferentemente das datas, algumas partes de um horário (hora, minuto e segundo) podem ser ignoradas, a depender da precisão de tempo necessária. De qualquer modo, em casos como este, as soluções a serem empregadas são exatamente as mesmas que descrevemos na seção <a href="#sec:formato_diferente_date">O que devo fazer se minhas datas se encontram em um formato diferente?</a>, que são:</p>
<ol style="list-style-type: decimal">
<li><p>Utilizar os códigos oferecidos pelo R no argumento <code>format</code> da função.</p></li>
<li><p>Ou utilizar as funções rápidas do pacote <code>lubridate</code> (<code>dmy_h()</code>, <code>dmy_hm()</code>, <code>dmy_hms()</code>, etc.) que possuem uma ordem implícita para cada componente.</p></li>
</ol>
<p>A tabela abaixo, apresenta os principais códigos oferecidos pelo R para cada componente de um dado do tipo <code>date-time</code>. Porém, há vários outros códigos, os quais são menos comuns e, que por isso, foram omitidos da tabela abaixo. Você pode encontrar uma lista completa desses códigos, ao consultar a documentação interna da função <code>strptime()</code>, com o comando <code>?strptime</code>.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/tab_codigos_format_datetime.png" alt="Códigos que podem representar cada componente de um dado do tipo `date-time`" width="100%" />
<p class="caption">
(#fig:unnamed-chunk-700)Códigos que podem representar cada componente de um dado do tipo <code>date-time</code>
</p>
</div>
<p></p>
<p>Pelas informações dispostas na tabela abaixo, sabemos que o formato delineado pelo padrão ISO-8601, isto é, “ano-mês-dia hora:minuto:segundo,” pode ser descrito pelo padrão <code>"%Y-%m-%d %H:%M:%S"</code>, ou, de forma mais sucinta, <code>"%F %T"</code>. Como exemplo, repare abaixo que ambas as descrições geram os mesmos resultados, quando aplicadas sobre os valores presentes no vetor <code>pontos</code>:</p>
<p></p>
<div class="sourceCode" id="cb1251"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1251-1"><a href="#cb1251-1" aria-hidden="true" tabindex="-1"></a>pontos <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;2018-06-15 08:11:05&quot;</span>, <span class="st">&quot;2018-07-22 21:09:05&quot;</span>)</span>
<span id="cb1251-2"><a href="#cb1251-2" aria-hidden="true" tabindex="-1"></a><span class="fu">as_datetime</span>(pontos, <span class="at">format =</span> <span class="st">&quot;%Y-%m-%d %H:%M:%S&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2018-06-15 08:11:05 UTC&quot; &quot;2018-07-22 21:09:05 UTC&quot;</code></pre>
<div class="sourceCode" id="cb1253"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1253-1"><a href="#cb1253-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Ou de forma análoga</span></span>
<span id="cb1253-2"><a href="#cb1253-2" aria-hidden="true" tabindex="-1"></a><span class="fu">as_datetime</span>(pontos, <span class="at">format =</span> <span class="st">&quot;%F %T&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2018-06-15 08:11:05 UTC&quot; &quot;2018-07-22 21:09:05 UTC&quot;</code></pre>
<p></p>
<p>No caso do Brasil, valores do tipo <code>date-time</code> costumam se apresentar no formato “dia/mês/ano hora:minuto:segundo.” Logo, uma descrição capaz de representar tal formato é <code>"%d/%m/%Y %H:%M:%S"</code>, ou então, uma alternativa mais curta é <code>"%d/%m/%Y %T"</code>.</p>
<p></p>
<div class="sourceCode" id="cb1255"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1255-1"><a href="#cb1255-1" aria-hidden="true" tabindex="-1"></a>pontos_br <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;15/06/2018 08:11:05&quot;</span>, <span class="st">&quot;22/07/2018 21:09:05&quot;</span>)</span>
<span id="cb1255-2"><a href="#cb1255-2" aria-hidden="true" tabindex="-1"></a><span class="fu">as_datetime</span>(pontos_br, <span class="at">format =</span> <span class="st">&quot;%d/%m/%Y %H:%M:%S&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2018-06-15 08:11:05 UTC&quot; &quot;2018-07-22 21:09:05 UTC&quot;</code></pre>
<div class="sourceCode" id="cb1257"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1257-1"><a href="#cb1257-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Ou de forma análoga</span></span>
<span id="cb1257-2"><a href="#cb1257-2" aria-hidden="true" tabindex="-1"></a><span class="fu">as_datetime</span>(pontos_br, <span class="at">format =</span> <span class="st">&quot;%d/%m/%Y %T&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2018-06-15 08:11:05 UTC&quot; &quot;2018-07-22 21:09:05 UTC&quot;</code></pre>
<p></p>
<p>Vale ressaltar que, em todos os exemplos mostrados até agora, todos os componentes de um <code>date-time</code> foram fornecidos nas <em>strings</em> utilizadas como <em>input</em>. Dito de outra forma, em nenhum exemplo mostrado até o momento, os segundos, os minutos ou as horas estavam ausentes das <em>strings</em> utilizadas como <em>input</em>. Esse cenário perfeito nem sempre ocorre, e isso não necessariamente é um problema sério. Pois, em alguns processos, a empresa nem sempre precisa de uma precisão muito alta em seus registros de tempo.</p>
<p>Por exemplo, uma indústria de aço não recebe matérias primas a cada segundo. Muitas vezes, a firma encomenda um grande estoque de materiais, combustíveis e minérios ao final de cada mês. Por esse motivo, a firma talvez precise registrar apenas as horas e minutos do dia, em que cada entrega (ou carregamento de matéria-prima) chegou a sua sede, em um determinado mês.</p>
<p>Tendo isso em mente, se eu possuo a <em>string</em> abaixo, contendo o valor <code>"2020-04-15 10:30"</code>, eu poderia utilizar a descrição <code>"%F %H:%M"</code> para descrever o formato em que esse valor se encontra. Contudo, uma alternativa eficiente e intuitiva, é utilizar a função <code>ymd_hm()</code>. Perceba pelo resultado abaixo, que ao não possuirmos um determinado componente de um dado do tipo <code>date-time</code>, esse componente faltante é preenchido por zeros.</p>
<p></p>
<div class="sourceCode" id="cb1259"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1259-1"><a href="#cb1259-1" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">&lt;-</span> <span class="st">&quot;2020-04-15 10:30&quot;</span></span>
<span id="cb1259-2"><a href="#cb1259-2" aria-hidden="true" tabindex="-1"></a><span class="fu">as_datetime</span>(dt, <span class="at">format =</span> <span class="st">&quot;%F %H:%M&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2020-04-15 10:30:00 UTC&quot;</code></pre>
<div class="sourceCode" id="cb1261"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1261-1"><a href="#cb1261-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ymd_hm</span>(dt)</span></code></pre></div>
<pre><code>## [1] &quot;2020-04-15 10:30:00 UTC&quot;</code></pre>
<p></p>
<p>Do mesmo modo que descrevemos anteriormente, funções rápidas como <code>ymd_hm()</code> possuem uma ordem para cada componente que está implícita no nome dessa função. A novidade em relação às funções <code>ymd()</code>, <code>dmy()</code> e suas irmãs, é que essas funções focadas em dados do tipo <code>date-time</code>, incluem três novas letras que se referem a hora (<code>h</code>), minuto (<code>m</code>) e segundo (<code>s</code>). Portanto, sabemos pelo nome da função, que <code>ymd_hm()</code> espera um <em>input</em> onde os componentes se apresentam na ordem “ano <span class="math inline">\(\rightarrow\)</span> mês <span class="math inline">\(\rightarrow\)</span> dia <span class="math inline">\(\rightarrow\)</span> hora <span class="math inline">\(\rightarrow\)</span> minuto.”</p>
<p>Por isso, a função <code>dmy_hms()</code> é uma alternativa ideal para ler dados do tipo <code>date-time</code> que foram escritos segundo o padrão brasileiro. Pois essa função espera como <em>input</em>, um dado em que os componentes seguem a ordem “dia <span class="math inline">\(\rightarrow\)</span> mês <span class="math inline">\(\rightarrow\)</span> ano <span class="math inline">\(\rightarrow\)</span> hora <span class="math inline">\(\rightarrow\)</span> minuto <span class="math inline">\(\rightarrow\)</span> segundo.” Veja o exemplo abaixo:</p>
<p></p>
<div class="sourceCode" id="cb1263"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1263-1"><a href="#cb1263-1" aria-hidden="true" tabindex="-1"></a>dts <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;12/10/1998 19:19:32&quot;</span>, <span class="st">&quot;12/10/1998 22:15:09&quot;</span>)</span>
<span id="cb1263-2"><a href="#cb1263-2" aria-hidden="true" tabindex="-1"></a>sem_segundo <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;12/10/1998 19:19&quot;</span>, <span class="st">&quot;12/10/1998 22:15&quot;</span>)</span>
<span id="cb1263-3"><a href="#cb1263-3" aria-hidden="true" tabindex="-1"></a>sem_minuto_e_segundo <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;12/10/1998 19&quot;</span>, <span class="st">&quot;12/10/1998 22&quot;</span>)</span>
<span id="cb1263-4"><a href="#cb1263-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1263-5"><a href="#cb1263-5" aria-hidden="true" tabindex="-1"></a><span class="fu">dmy_hms</span>(dts)</span></code></pre></div>
<pre><code>## [1] &quot;1998-10-12 19:19:32 UTC&quot; &quot;1998-10-12 22:15:09 UTC&quot;</code></pre>
<div class="sourceCode" id="cb1265"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1265-1"><a href="#cb1265-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dmy_hm</span>(sem_segundo)</span></code></pre></div>
<pre><code>## [1] &quot;1998-10-12 19:19:00 UTC&quot; &quot;1998-10-12 22:15:00 UTC&quot;</code></pre>
<div class="sourceCode" id="cb1267"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1267-1"><a href="#cb1267-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dmy_h</span>(sem_minuto_e_segundo)</span></code></pre></div>
<pre><code>## [1] &quot;1998-10-12 19:00:00 UTC&quot; &quot;1998-10-12 22:00:00 UTC&quot;</code></pre>
<p></p>
<p>Para além dos códigos mais tradicionais, a parte inferior da tabela x.x descreve alguns códigos menos comuns, como o código <code>%z</code>. Esse código em específico, é capaz de identificar um ajuste (em horas e minutos) presente na <em>string</em> de <em>input</em>, e adicioná-lo ao fuso horário aplicado sobre o resultado da função. Porém, como veremos mais à frente, lidar com fusos horários não é algo muito simples, e para piorar, o cálculo aritmético por trás da adição de um ajuste com o código <code>%z</code>, é no mínimo, peculiar.</p>
<p>Portanto, o uso de ajustes representados pelo código <code>%z</code>, é algo mais complicado do que uma simples adição<a href="#fn38" class="footnote-ref" id="fnref38"><sup>38</sup></a>. Sendo que, o cálculo aritmético aplicado por tal código, está demonstrado em detalhes na seção <a href="#sec:datetime_confusoes_cod_z">Quando fusos horários diferentes geram uma grande confusão</a>. Por esses motivos, o código <code>%z</code> é algo difícil de se trabalhar, especialmente levando-se em conta que: <strong>em certas situações, o código <code>%z</code> gera resultados diferentes entre as funções <code>as_datetime()</code> e <code>as.POSIXct()</code></strong>.</p>
<p>Tal diferença, se baseia puramente no fato de que a função <code>as_datetime()</code> escolhe, por padrão, o fuso horário UTC, enquanto a função <code>as.POSIXct()</code>, tende a escolher o fuso horário padrão de seu sistema operacional (o qual não necessariamente é o fuso horário UTC). Como exemplo, temos abaixo um vetor chamado <code>dt</code>, que contém o instante: 8 horas do dia 01 de janeiro de 2020. Ademais, podemos identificar um ajuste negativo (ou “para trás”) de 3 horas (<code>-0300</code>), ao final da <em>string</em>. Perceba abaixo, que ambas as funções nos retornam horários diferentes. Esse problema vale certa reflexão sua, porque essa diferença existe? Como ela ocorre? Vamos dar as respostas para essas perguntas mais a frente. Até lá, pense um pouco sobre esses resultados.</p>
<p></p>
<div class="sourceCode" id="cb1269"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1269-1"><a href="#cb1269-1" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">&lt;-</span> <span class="st">&quot;2020-01-01 08:00:00 -0300&quot;</span></span>
<span id="cb1269-2"><a href="#cb1269-2" aria-hidden="true" tabindex="-1"></a><span class="fu">strptime</span>(dt, <span class="at">format =</span> <span class="st">&quot;%F %T %z&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2020-01-01 08:00:00&quot;</code></pre>
<div class="sourceCode" id="cb1271"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1271-1"><a href="#cb1271-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as_datetime</span>(dt, <span class="at">format =</span> <span class="st">&quot;%F %T %z&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2020-01-01 11:00:00 UTC&quot;</code></pre>
<p></p>
<p>Como uma dica, repare como os resultados mudam quando adicionamos uma hora ao ajuste, gerando assim, um desvio negativo de 2 horas (<code>-0200</code>).</p>
<p></p>
<div class="sourceCode" id="cb1273"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1273-1"><a href="#cb1273-1" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">&lt;-</span> <span class="st">&quot;2020-01-01 08:00:00 -0200&quot;</span></span>
<span id="cb1273-2"><a href="#cb1273-2" aria-hidden="true" tabindex="-1"></a><span class="fu">strptime</span>(dt, <span class="at">format =</span> <span class="st">&quot;%F %T %z&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2020-01-01 07:00:00&quot;</code></pre>
<div class="sourceCode" id="cb1275"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1275-1"><a href="#cb1275-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as_datetime</span>(dt, <span class="at">format =</span> <span class="st">&quot;%F %T %z&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2020-01-01 10:00:00 UTC&quot;</code></pre>
<p></p>
</div>
<div id="a-partir-de-cada-componente-1" class="section level3" number="12.4.4">
<h3 number="12.4.4"><span class="header-section-number">12.4.4</span> A partir de cada componente</h3>
<p>Caso você possua, separadamente, cada um dos itens que compõe um dado do tipo <code>date-time</code> (dia, mês, ano, hora, minuto e segundo), você pode utilizar a função <code>make_datetime()</code> para uni-los em um único vetor do tipo <code>date-time</code>. Por exemplo, suponha que você possua um <code>data.frame</code> parecido com a tabela <code>tab</code> abaixo.</p>
<p></p>
<div class="sourceCode" id="cb1277"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1277-1"><a href="#cb1277-1" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb1277-2"><a href="#cb1277-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">ano =</span> <span class="dv">2020</span>,</span>
<span id="cb1277-3"><a href="#cb1277-3" aria-hidden="true" tabindex="-1"></a>  mês <span class="ot">=</span> <span class="dv">5</span>,</span>
<span id="cb1277-4"><a href="#cb1277-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">dia =</span> <span class="fu">c</span>(<span class="dv">15</span>, <span class="dv">16</span>, <span class="dv">16</span>, <span class="dv">18</span>, <span class="dv">19</span>),</span>
<span id="cb1277-5"><a href="#cb1277-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">hora =</span> <span class="fu">c</span>(<span class="dv">9</span>, <span class="dv">11</span>, <span class="dv">12</span>, <span class="dv">8</span>, <span class="dv">14</span>),</span>
<span id="cb1277-6"><a href="#cb1277-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">minuto =</span> <span class="fu">c</span>(<span class="dv">7</span>, <span class="dv">23</span>, <span class="dv">19</span>, <span class="dv">15</span>, <span class="dv">30</span>),</span>
<span id="cb1277-7"><a href="#cb1277-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">segundo =</span> <span class="fu">c</span>(<span class="dv">34</span>, <span class="dv">11</span>, <span class="dv">5</span>, <span class="dv">17</span>, <span class="dv">49</span>)</span>
<span id="cb1277-8"><a href="#cb1277-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1277-9"><a href="#cb1277-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1277-10"><a href="#cb1277-10" aria-hidden="true" tabindex="-1"></a>tab </span></code></pre></div>
<pre><code>## # A tibble: 5 x 6
##     ano   mês   dia  hora minuto segundo
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;
## 1  2020     5    15     9      7      34
## 2  2020     5    16    11     23      11
## 3  2020     5    16    12     19       5
## 4  2020     5    18     8     15      17
## 5  2020     5    19    14     30      49</code></pre>
<p></p>
<p>Em relação à função <code>make_date()</code>, a função <code>make_datetime()</code> introduz três novos argumentos, sendo eles: <code>hour</code>, <code>min</code> e <code>sec</code>, que se referem às horas, os minutos e os segundos, respectivamente.</p>
<p></p>
<div class="sourceCode" id="cb1279"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1279-1"><a href="#cb1279-1" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> <span class="fu">mutate</span>(</span>
<span id="cb1279-2"><a href="#cb1279-2" aria-hidden="true" tabindex="-1"></a>  tab,</span>
<span id="cb1279-3"><a href="#cb1279-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">date_time =</span> <span class="fu">make_datetime</span>(</span>
<span id="cb1279-4"><a href="#cb1279-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">year =</span> ano, <span class="at">month =</span> mês, <span class="at">day =</span> dia,</span>
<span id="cb1279-5"><a href="#cb1279-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">hour =</span> hora, <span class="at">min =</span> minuto, <span class="at">sec =</span> segundo</span>
<span id="cb1279-6"><a href="#cb1279-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb1279-7"><a href="#cb1279-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1279-8"><a href="#cb1279-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1279-9"><a href="#cb1279-9" aria-hidden="true" tabindex="-1"></a>tab</span></code></pre></div>
<pre><code>## # A tibble: 5 x 7
##     ano   mês   dia  hora minuto segundo date_time          
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;dttm&gt;             
## 1  2020     5    15     9      7      34 2020-05-15 09:07:34
## 2  2020     5    16    11     23      11 2020-05-16 11:23:11
## 3  2020     5    16    12     19       5 2020-05-16 12:19:05
## 4  2020     5    18     8     15      17 2020-05-18 08:15:17
## 5  2020     5    19    14     30      49 2020-05-19 14:30:49</code></pre>
<p></p>
</div>
<div id="a-partir-de-números-1" class="section level3" number="12.4.5">
<h3 number="12.4.5"><span class="header-section-number">12.4.5</span> A partir de números</h3>
<p>Assim como ocorre no tipo <code>Date</code>, dados do tipo <code>date-time</code> também podem ser criados a partir de números. O mecanismo de conversão é muito semelhante ao que mostramos com o tipo <code>Date</code>. Porém, ao invés de representar o número de dias desde uma data de origem, ao ser convertido para os tipos <code>POSIXct</code> e <code>POSIXlt</code>, o número que estamos tentando converter, será interpretado como o número de segundos desde a meia-noite de 01 de janeiro de 1970 (de outra forma, <code>1970-01-01 00:00:00</code>).</p>
<p>Por isso, podemos chegar ao instante “08 horas do dia 01 de janeiro de 2005,” ao convertermos o número 1.104.566.400 (que representa aproximadamente 1,104 bilhões de segundos) para o tipo <code>date-time</code>. Em outras palavras, 08 horas do dia 01 de janeiro de 2005 está a 1.104.566.400 segundos de distância da meia-noite do dia 01 de janeiro de 1970.</p>
<p></p>
<div class="sourceCode" id="cb1281"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1281-1"><a href="#cb1281-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as_datetime</span>(<span class="dv">1104566400</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2005-01-01 08:00:00 UTC&quot;</code></pre>
<p></p>
<p>Para mais detalhes sobre os conceitos de ponto de origem e escala temporal (que são essenciais para se compreender corretamente essa conversão entre números e instantes no tempo), consulte a seção <a href="#sec:interp_var_tempo">Como as variáveis de tempo são interpretadas pelo R ?</a>.</p>
</div>
<div id="novamente-fique-atento-aos-tipos-empregados" class="section level3" number="12.4.6">
<h3 number="12.4.6"><span class="header-section-number">12.4.6</span> Novamente, fique atento aos tipos empregados!</h3>
<p>Assim como ocorre com o tipo <code>Date</code>, dados do tipo <code>POSIXct</code> e <code>POSIXlt</code> também aparecem em seu console, contornados por aspas duplas e, novamente, não há qualquer informação aparente, que nos informe se os dados em questão se encontram no tipo <code>character</code> ou em algum dos tipos <code>date-time</code>. Da mesma forma que descrevemos no tipo <code>Date</code>, uma maneira simples e prática de identificar se um objeto pertence ao tipo <code>POSIXct</code> ou <code>POSIXlt</code>, é olhar para a classe desse objeto, com a função <code>class()</code>. Entretanto, de maneira diferente do tipo <code>Date</code>, que continha apenas um valor para a sua classe, repare abaixo que, objetos dos tipos <code>POSIXct</code> e <code>POSIXlt</code> sempre possuem um segundo valor para a sua classe (<code>POSIXt</code>).</p>
<p></p>
<div class="sourceCode" id="cb1283"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1283-1"><a href="#cb1283-1" aria-hidden="true" tabindex="-1"></a>v_POSIXct <span class="ot">&lt;-</span> <span class="fu">as.POSIXct</span>(<span class="st">&quot;2020-01-01 10:40:35&quot;</span>)</span>
<span id="cb1283-2"><a href="#cb1283-2" aria-hidden="true" tabindex="-1"></a>v_POSIXlt <span class="ot">&lt;-</span> <span class="fu">as.POSIXlt</span>(<span class="st">&quot;2020-01-01 10:40:35&quot;</span>)</span>
<span id="cb1283-3"><a href="#cb1283-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1283-4"><a href="#cb1283-4" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(v_POSIXct)</span></code></pre></div>
<pre><code>## [1] &quot;POSIXct&quot; &quot;POSIXt&quot;</code></pre>
<div class="sourceCode" id="cb1285"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1285-1"><a href="#cb1285-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(v_POSIXlt)</span></code></pre></div>
<pre><code>## [1] &quot;POSIXlt&quot; &quot;POSIXt&quot;</code></pre>
<p></p>
<p>Por esse detalhe, quando você estiver criando o seu teste lógico, utilize o operador <code>%in%</code>, ao invés do operador <code>==</code>.</p>
<p></p>
<div class="sourceCode" id="cb1287"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1287-1"><a href="#cb1287-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Para identificar se o objeto é do</span></span>
<span id="cb1287-2"><a href="#cb1287-2" aria-hidden="true" tabindex="-1"></a><span class="do">### tipo POSIXct, utilize:</span></span>
<span id="cb1287-3"><a href="#cb1287-3" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;POSIXct&quot;</span> <span class="sc">%in%</span> <span class="fu">class</span>(v_POSIXct)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb1289"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1289-1"><a href="#cb1289-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Já para o tipo POSIXlt, utilize:</span></span>
<span id="cb1289-2"><a href="#cb1289-2" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;POSIXlt&quot;</span> <span class="sc">%in%</span> <span class="fu">class</span>(v_POSIXlt)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p></p>
<p>Um outro método útil de identificarmos se um objeto pertence aos tipos <code>POSIXct</code> e <code>POSIXlt</code>, é através da função <code>inherits()</code>, como está demonstrado abaixo:</p>
<p></p>
<div class="sourceCode" id="cb1291"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1291-1"><a href="#cb1291-1" aria-hidden="true" tabindex="-1"></a><span class="fu">inherits</span>(v_POSIXct, <span class="st">&quot;POSIXct&quot;</span>)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb1293"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1293-1"><a href="#cb1293-1" aria-hidden="true" tabindex="-1"></a><span class="fu">inherits</span>(v_POSIXlt, <span class="st">&quot;POSIXlt&quot;</span>)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p></p>
</div>
</div>
<div id="diferenças-entre-posixct-e-posixlt" class="section level2" number="12.5">
<h2 number="12.5"><span class="header-section-number">12.5</span> Diferenças entre <code>POSIXct</code> e <code>POSIXlt</code></h2>
<p>Até o momento, nós não descrevemos quais são as características que diferem os tipos <code>POSIXct</code> e <code>POSIXlt</code> um do outro. Em resumo, os valores do tipo <code>POSIXct</code> são guardados dentro de em um vetor e, os valores do tipo <code>POSIXlt</code>, em uma lista nomeada contendo vários vetores que guardam cada componente desses valores.</p>
<p>Em mais detalhes, quando utilizamos o tipo <code>POSIXct</code>, o R vai apenas construir um vetor contendo os nossos dados do tipo <code>date-time</code>. Apesar desses valores serem apresentados a nós, no formato “ano-mês-dia hora:minuto:segundo,” em uma camada mais profunda, o R vai armazená-los como o número de segundos desde o instante <code>1970-01-01 00:00:00</code> (meia-noite de 01 de janeiro de 1970). Por outro lado, quando empregamos o tipo <code>POSIXlt</code>, o R vai construir uma lista nomeada contendo vários vetores, onde cada um desses vetores possui um componente específico (dia, mês, ano, hora, etc.) de seu dado do tipo <code>date-time</code>. A figura 12.5, fornece uma representação visual dessa diferença.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/posixct_posixlt.png" alt="Representação visual das estruturas formadas pelos tipos `POSIXct` e `POSIXlt`" width="85%" />
<p class="caption">
(#fig:unnamed-chunk-713)Representação visual das estruturas formadas pelos tipos <code>POSIXct</code> e <code>POSIXlt</code>
</p>
</div>
<p></p>
<p>Para mais detalhes, você pode conferir a documentação interna desses tipos, com <code>?POSIXct</code> ou <code>?POSIXlt</code>. Para mais, vale destacar que, dados que se encontram em qualquer um desses dois tipos, são apresentados da mesma maneira a nós. Em outras palavras, quando aparecem em seu console do R, os dados do tipo <code>POSIXct</code> e <code>POSIXlt</code> sempre aparecem como um vetor cotendo valores no formato “ano-mês-dia hora:minuto:segundo.”</p>
<p></p>
<div class="sourceCode" id="cb1295"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1295-1"><a href="#cb1295-1" aria-hidden="true" tabindex="-1"></a>v_POSIXct <span class="ot">&lt;-</span> <span class="fu">as.POSIXct</span>(<span class="st">&quot;2020-01-01 10:40:35&quot;</span>)</span>
<span id="cb1295-2"><a href="#cb1295-2" aria-hidden="true" tabindex="-1"></a>v_POSIXlt <span class="ot">&lt;-</span> <span class="fu">as.POSIXlt</span>(<span class="st">&quot;2020-01-01 10:40:35&quot;</span>)</span>
<span id="cb1295-3"><a href="#cb1295-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1295-4"><a href="#cb1295-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(v_POSIXct)</span></code></pre></div>
<pre><code>## [1] &quot;2020-01-01 10:40:35 -03&quot;</code></pre>
<div class="sourceCode" id="cb1297"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1297-1"><a href="#cb1297-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(v_POSIXlt)</span></code></pre></div>
<pre><code>## [1] &quot;2020-01-01 10:40:35 -03&quot;</code></pre>
<p></p>
<p>Porém, como eu descrevi acima, a forma como esses dados estão estruturados dentro do objeto é completamente diferente. Por exemplo, eu posso extrair os segundos (35) do valor (ou valores) em questão, ao acessar o item de nome <code>sec</code> da lista que compõe o objeto <code>v_POSIXlt</code>. Da mesma forma, caso eu precise extrair o dia (01) de cada data presente no objeto <code>v_POSIXlt</code>, basta acessar o item de nome <code>mday</code> dessa lista.</p>
<p></p>
<div class="sourceCode" id="cb1299"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1299-1"><a href="#cb1299-1" aria-hidden="true" tabindex="-1"></a>v_POSIXlt<span class="sc">$</span>sec</span></code></pre></div>
<pre><code>## [1] 35</code></pre>
<div class="sourceCode" id="cb1301"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1301-1"><a href="#cb1301-1" aria-hidden="true" tabindex="-1"></a>v_POSIXlt<span class="sc">$</span>mday</span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<p></p>
<p>Na hipótese de, realizarmos a mesma tarefa com um valor do tipo <code>POSIXct</code>, sem que ele seja convertido para o tipo <code>POSIXlt</code>, a nossa melhor opção seria implantarmos um <em>string subsetting</em>, com as funções que já vimos no capítulo <a href="#sec:stringr_capitulo">Manipulação e transformação de <em>strings</em> com <code>stringr</code></a>.</p>
<p></p>
<div class="sourceCode" id="cb1303"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1303-1"><a href="#cb1303-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb1303-2"><a href="#cb1303-2" aria-hidden="true" tabindex="-1"></a>como_texto <span class="ot">&lt;-</span> <span class="fu">as.character</span>(v_POSIXct)</span>
<span id="cb1303-3"><a href="#cb1303-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1303-4"><a href="#cb1303-4" aria-hidden="true" tabindex="-1"></a><span class="do">### Por exemplo, para extrair os segundos faríamos:</span></span>
<span id="cb1303-5"><a href="#cb1303-5" aria-hidden="true" tabindex="-1"></a><span class="fu">as.integer</span>(<span class="fu">str_sub</span>(como_texto, <span class="dv">18</span>, <span class="dv">19</span>))</span></code></pre></div>
<pre><code>## [1] 35</code></pre>
<div class="sourceCode" id="cb1305"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1305-1"><a href="#cb1305-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Para extrair o dia:</span></span>
<span id="cb1305-2"><a href="#cb1305-2" aria-hidden="true" tabindex="-1"></a><span class="fu">as.integer</span>(<span class="fu">str_sub</span>(como_texto, <span class="dv">9</span>, <span class="dv">10</span>))</span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<div class="sourceCode" id="cb1307"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1307-1"><a href="#cb1307-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Para extrair o ano:</span></span>
<span id="cb1307-2"><a href="#cb1307-2" aria-hidden="true" tabindex="-1"></a><span class="fu">as.integer</span>(<span class="fu">str_sub</span>(como_texto, <span class="dv">1</span>, <span class="dv">4</span>))</span></code></pre></div>
<pre><code>## [1] 2020</code></pre>
<p></p>
<p>Portanto, podemos dizer que o tipo <code>POSIXlt</code> provê um formato mais próximo da maneira como nós, seres humanos, pensamos sobre um valor do tipo <code>date-time</code>. Ou seja, diversos componentes (dia, mês, ano, hora, etc.) que, em conjunto, formam um dado do tipo <code>date-time</code>, mas que ainda representam unidades ou informações diferentes. Todavia, o tipo <code>POSIXct</code> fornece uma estrutura muito mais ideal para o uso em <code>data.frame</code>’s e, em geral, operações e cálculos aritméticos. Dito de outra forma, seja em uma coluna de um <code>data.frame</code> ou em qualquer outra estrutura, é mais fácil trabalhar no R com dados do tipo <code>date-time</code>, quando eles se encontram no tipo <code>POSIXct</code>.</p>
<p>Você também pode encarar a escolha entre esses dois tipos da seguinte maneira: se você deseja extrair um componente específico de cada data (dia, mês, ano, hora, etc.), você pode transformar os seus valores para o tipo <code>POSIXlt</code>, com a função <code>as.POSIXlt()</code> e, em seguida, extrair o item da lista resultante que contém o componente desejado; caso você não tenha pretensões de extrair algum componente, sempre utilize o tipo <code>POSIXct</code>. Pois esse tipo provê um formato mais natural para diversas operações e cálculos aritméticos que você venha a realizar sobre os seus valores.</p>
</div>
<div id="extraindo-os-componentes-de-uma-variável-de-tempo" class="section level2" number="12.6">
<h2 number="12.6"><span class="header-section-number">12.6</span> Extraindo os componentes de uma variável de tempo</h2>
<p>Você já sabe que, nós podemos extrair cada componente de maneira simples e intuitiva, ao transformarmos os dados em questão para o tipo <code>POSIXlt</code>, e utilizar os itens da lista resultante para chegarmos ao componente desejado. Porém, também vamos mostrar nessa seção, algumas funções rápidas presentes no pacote <code>lubridate</code>, que tornam esse processo de extração ainda mais simples.</p>
<p>Primeiro, essas funções rápidas e as partes extraídas por cada uma delas, são:</p>
<ul>
<li><code>day()</code>, dia do mês (1-31).</li>
<li><code>month()</code>, mês do ano (1-12).</li>
<li><code>year()</code>, ano (número de 4 dígitos).</li>
<li><code>hour()</code>, hora do dia (0-23).</li>
<li><code>minute()</code>, minutos (0-59).</li>
<li><code>second()</code>, segundos (0-61).</li>
</ul>
<p>Tendo essas funções em mente, se nós desejamos extrair apenas as horas de cada valor presente no vetor <code>dt</code> abaixo, nós podemos simplesmente aplicar a função <code>hour()</code> sobre este vetor. De modo análogo, se desejamos calcular o dia do mês correspondente a cada valor, nós podemos utilizar a função <code>day()</code>:</p>
<p></p>
<div class="sourceCode" id="cb1309"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1309-1"><a href="#cb1309-1" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;21/02/2020 10:22:53&quot;</span>, <span class="st">&quot;01/11/2019 20:13:01&quot;</span>, <span class="st">&quot;19/07/2018 15:24:20&quot;</span>)</span>
<span id="cb1309-2"><a href="#cb1309-2" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">&lt;-</span> <span class="fu">dmy_hms</span>(dt)</span>
<span id="cb1309-3"><a href="#cb1309-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1309-4"><a href="#cb1309-4" aria-hidden="true" tabindex="-1"></a><span class="fu">hour</span>(dt)</span></code></pre></div>
<pre><code>## [1] 10 20 15</code></pre>
<div class="sourceCode" id="cb1311"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1311-1"><a href="#cb1311-1" aria-hidden="true" tabindex="-1"></a><span class="fu">minute</span>(dt)</span></code></pre></div>
<pre><code>## [1] 22 13 24</code></pre>
<div class="sourceCode" id="cb1313"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1313-1"><a href="#cb1313-1" aria-hidden="true" tabindex="-1"></a><span class="fu">day</span>(dt)</span></code></pre></div>
<pre><code>## [1] 21  1 19</code></pre>
<p></p>
<p>Essas funções rápidas são particularmente úteis, quando desejamos extrair os componentes de alguma coluna de um <code>data.frame</code>’s. Como exemplo, podemos visitar novamente a tabela <code>transf</code> que vimos ao longo do capítulo 4, e extrair os componentes de cada valor presente em sua coluna <code>Data</code>.</p>
<p></p>
<div class="sourceCode" id="cb1315"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1315-1"><a href="#cb1315-1" aria-hidden="true" tabindex="-1"></a>github <span class="ot">&lt;-</span> <span class="st">&quot;https://raw.githubusercontent.com/pedropark99/&quot;</span></span>
<span id="cb1315-2"><a href="#cb1315-2" aria-hidden="true" tabindex="-1"></a>pasta <span class="ot">&lt;-</span> <span class="st">&quot;Curso-R/master/Dados/&quot;</span></span>
<span id="cb1315-3"><a href="#cb1315-3" aria-hidden="true" tabindex="-1"></a>arquivo <span class="ot">&lt;-</span> <span class="st">&quot;transf_reform.csv&quot;</span></span>
<span id="cb1315-4"><a href="#cb1315-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1315-5"><a href="#cb1315-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb1315-6"><a href="#cb1315-6" aria-hidden="true" tabindex="-1"></a>transf <span class="ot">&lt;-</span> <span class="fu">read_csv2</span>(<span class="fu">paste0</span>(github, pasta, arquivo))</span>
<span id="cb1315-7"><a href="#cb1315-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1315-8"><a href="#cb1315-8" aria-hidden="true" tabindex="-1"></a>transf <span class="ot">&lt;-</span> transf <span class="sc">%&gt;%</span> </span>
<span id="cb1315-9"><a href="#cb1315-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>Descricao) <span class="sc">%&gt;%</span> </span>
<span id="cb1315-10"><a href="#cb1315-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb1315-11"><a href="#cb1315-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">hora =</span> <span class="fu">hour</span>(Data),</span>
<span id="cb1315-12"><a href="#cb1315-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">minuto =</span> <span class="fu">minute</span>(Data),</span>
<span id="cb1315-13"><a href="#cb1315-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">segundo =</span> <span class="fu">second</span>(Data)</span>
<span id="cb1315-14"><a href="#cb1315-14" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p></p>
<p></p>
<div class="sourceCode" id="cb1316"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1316-1"><a href="#cb1316-1" aria-hidden="true" tabindex="-1"></a>transf</span></code></pre></div>
<pre><code>## # A tibble: 20,006 x 8
##    Data                Usuario  Valor TransferID Pais   hora minuto segundo
##    &lt;dttm&gt;              &lt;chr&gt;    &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt; &lt;int&gt;  &lt;int&gt;   &lt;dbl&gt;
##  1 2018-12-06 22:19:19 Eduardo   599.  116241629 Alem~    22     19      19
##  2 2018-12-06 22:10:34 Júlio    4611.  115586504 Alem~    22     10      34
##  3 2018-12-06 21:59:50 Nathál~  4418.  115079280 Alem~    21     59      50
##  4 2018-12-06 21:54:13 Júlio    2740.  114972398 Alem~    21     54      13
##  5 2018-12-06 21:41:27 Ana      1408.  116262934 Alem~    21     41      27
##  6 2018-12-06 21:18:40 Nathál~  5052.  115710402 Alem~    21     18      40
##  7 2018-12-06 20:54:32 Eduardo  5665.  114830203 Alem~    20     54      32
##  8 2018-12-06 20:15:46 Sandra   1474.  116323455 Alem~    20     15      46
##  9 2018-12-06 20:04:35 Armando  8906.  115304382 Alem~    20      4      35
## 10 2018-12-22 20:00:56 Armando 18521.  114513684 Alem~    20      0      56
## # ... with 19,996 more rows</code></pre>
<p></p>
<p>Para mais, o vetor <code>dt</code>, assim como a coluna <code>Data</code> da tabela <code>transf</code>, que utilizamos nos exemplos anteriores, são vetores do tipo <code>POSIXct</code>. Contudo, as funções mostradas acima, funcionam exatamente da mesma forma com valores do tipo <code>Date</code>. Ou seja, o processo é o mesmo, basta aplicar a função que extrai o componente no qual você está interessado sobre o seu vetor do tipo <code>Date</code>.</p>
<p></p>
<div class="sourceCode" id="cb1318"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1318-1"><a href="#cb1318-1" aria-hidden="true" tabindex="-1"></a>v_Date <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;21/02/2020&quot;</span>, <span class="st">&quot;01/11/2019&quot;</span>, <span class="st">&quot;19/07/2018&quot;</span>)</span>
<span id="cb1318-2"><a href="#cb1318-2" aria-hidden="true" tabindex="-1"></a>v_Date <span class="ot">&lt;-</span> <span class="fu">dmy</span>(v_Date)</span>
<span id="cb1318-3"><a href="#cb1318-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1318-4"><a href="#cb1318-4" aria-hidden="true" tabindex="-1"></a><span class="fu">day</span>(v_Date)</span></code></pre></div>
<pre><code>## [1] 21  1 19</code></pre>
<div class="sourceCode" id="cb1320"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1320-1"><a href="#cb1320-1" aria-hidden="true" tabindex="-1"></a><span class="fu">month</span>(v_Date)</span></code></pre></div>
<pre><code>## [1]  2 11  7</code></pre>
<div class="sourceCode" id="cb1322"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1322-1"><a href="#cb1322-1" aria-hidden="true" tabindex="-1"></a><span class="fu">year</span>(v_Date)</span></code></pre></div>
<pre><code>## [1] 2020 2019 2018</code></pre>
<p></p>
<p>Em outras palavras, isso é a mesma coisa que dizer: “um vetor do tipo <code>Date</code> pode ser convertido diretamente para o tipo <code>POSIXlt</code> e, com isso, podemos extrair os componentes que compõe cada data presente nesse vetor.” Tal fato está exposto no exemplo abaixo:</p>
<p></p>
<div class="sourceCode" id="cb1324"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1324-1"><a href="#cb1324-1" aria-hidden="true" tabindex="-1"></a>v_Date <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;21/02/2020&quot;</span>, <span class="st">&quot;01/11/2019&quot;</span>, <span class="st">&quot;19/07/2018&quot;</span>)</span>
<span id="cb1324-2"><a href="#cb1324-2" aria-hidden="true" tabindex="-1"></a>v_Date <span class="ot">&lt;-</span> <span class="fu">as.POSIXlt</span>(<span class="fu">dmy</span>(v_Date))</span>
<span id="cb1324-3"><a href="#cb1324-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1324-4"><a href="#cb1324-4" aria-hidden="true" tabindex="-1"></a>v_Date<span class="sc">$</span>mday</span></code></pre></div>
<pre><code>## [1] 21  1 19</code></pre>
<p></p>
<p>Como definimos na seção anterior, um objeto do tipo <code>POSIXlt</code> é na realidade, uma lista nomeada, e, você pode descobrir quais são os nomes de cada item dessa lista, ao acessar o atributo <code>names</code> desse objeto, com a função <code>attr()</code>, como demonstrado abaixo. Dessa maneira, o nome <code>"hour"</code> me indica que há um item chamado <code>hour</code> nessa lista, e, ao acessar esse item com o comando <code>v_POSIXlt$hour</code>, eu posso identificar o que se encontra dentro desse item. Você pode encontrar mais detalhes sobre cada item dessa lista, ao ler a documentação interna do tipo <code>POSIXlt</code>, com o comando <code>?POSIXlt</code>.</p>
<p></p>
<div class="sourceCode" id="cb1326"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1326-1"><a href="#cb1326-1" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(v_POSIXlt, <span class="st">&quot;names&quot;</span>)</span></code></pre></div>
<pre><code>##  [1] &quot;sec&quot;    &quot;min&quot;    &quot;hour&quot;   &quot;mday&quot;   &quot;mon&quot;    &quot;year&quot;   &quot;wday&quot;  
##  [8] &quot;yday&quot;   &quot;isdst&quot;  &quot;zone&quot;   &quot;gmtoff&quot;</code></pre>
<p></p>
</div>
<div id="fusos-horários" class="section level2" number="12.7">
<h2 number="12.7"><span class="header-section-number">12.7</span> Fusos horários</h2>
<div id="como-identificar-o-fuso-horário-associado-a-um-valor-do-tipo-date-time" class="section level3" number="12.7.1">
<h3 number="12.7.1"><span class="header-section-number">12.7.1</span> Como identificar o fuso horário associado a um valor do tipo <code>date-time</code></h3>
<p>É importante destacar que, todo dado do tipo <code>POSIXct</code> ou <code>POSIXlt</code> estará sempre ligado a algum fuso-horário de referência, mesmo que esse fuso não esteja evidente à primeira vista. Há duas maneiras principais de se identificar o fuso utilizado: primeiro, veja se alguma informação aparece ao lado do horário presente em seu valor do tipo <code>date-time</code>; segundo, veja a informação armazenada no atributo <code>tzone</code> de seu objeto. A partir desses métodos de conferência, existem três possibilidades para a identificação desse fuso, as quais estão resumidas na figura 12.6.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/como_fusos_se_apresentam.png" alt="Métodos para se identificar o fuso horário empregado em dados do tipo `POSIXct` e `POSIXlt`" width="100%" />
<p class="caption">
(#fig:unnamed-chunk-724)Métodos para se identificar o fuso horário empregado em dados do tipo <code>POSIXct</code> e <code>POSIXlt</code>
</p>
</div>
<p></p>
<p>Portanto, busque primeiro, reconhecer se alguma informação aparece à direita do horário. Se não há alguma informação nesse local, verifique o atributo <code>tzone</code> desse objeto. Quando utilizamos as funções dos pacotes básicos do R para criar o nosso objeto, e não definimos algum fuso horário específico no argumento <code>tz</code>, o atributo <code>tzone</code> do objeto resultante estará quase sempre vazio. Em casos como esse, o R vai automaticamente utilizar o fuso horário de seu sistema operacional, que pode ser identificado pelo resultado da função <code>Sys.timezone()</code>. Perceba abaixo, que o sistema operacional do meu computador, utiliza o horário de São Paulo, que é equivalente ao fuso horário de Brasília.</p>
<p></p>
<div class="sourceCode" id="cb1328"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1328-1"><a href="#cb1328-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.timezone</span>()</span></code></pre></div>
<pre><code>## [1] &quot;America/Sao_Paulo&quot;</code></pre>
<p></p>
<p>Esse fuso horário (de Brasília) se encontra a 3 desvios negativos do fuso horário UTC (vamos explicar mais a frente o que isso significa). Por esse motivo que, no exemplo abaixo, um <code>-03</code> aparece ao final do valor de <code>vec</code>. Em outras palavras, essa informação (<code>-03</code>) está nos dizendo que o fuso horário empregado sobre o valor de <code>vec</code>, é o fuso horário que se encontra a 3 desvios negativos do fuso horário UTC, que pelos motivos apresentados acima, é o fuso horário de Brasília, ou, o fuso horário padrão do sistema operacional de meu computador.</p>
<p></p>
<div class="sourceCode" id="cb1330"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1330-1"><a href="#cb1330-1" aria-hidden="true" tabindex="-1"></a>vec <span class="ot">&lt;-</span> <span class="fu">as.POSIXct</span>(<span class="st">&quot;2020-01-01 10:34:12&quot;</span>)</span>
<span id="cb1330-2"><a href="#cb1330-2" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(vec, <span class="st">&quot;tzone&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;&quot;</code></pre>
<div class="sourceCode" id="cb1332"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1332-1"><a href="#cb1332-1" aria-hidden="true" tabindex="-1"></a>vec</span></code></pre></div>
<pre><code>## [1] &quot;2020-01-01 10:34:12 -03&quot;</code></pre>
<p></p>
<p>Em outras situações, o fuso horário presente à direita do horário será informado em seu código padrão. Veja o exemplo abaixo, em que utilizamos o fuso horário de Paris (França). Como resultado, o atributo <code>tzone</code> é preenchido pelo valor <code>"Europe/Paris"</code>. Mas quando o valor de <code>vec</code> é desenhado em nosso console, o código CET é posicionado à direita do horário. Esse código se refere à <em>Central European Time</em> (ou “Tempo da Europa Central”), que é o fuso horário usufruído por diversos países europeus, incluindo a França.</p>
<p></p>
<div class="sourceCode" id="cb1334"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1334-1"><a href="#cb1334-1" aria-hidden="true" tabindex="-1"></a>vec <span class="ot">&lt;-</span> <span class="fu">as_datetime</span>(<span class="st">&quot;2020-01-01 10:34:12&quot;</span>, <span class="at">tz =</span> <span class="st">&quot;Europe/Paris&quot;</span>)</span>
<span id="cb1334-2"><a href="#cb1334-2" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(vec, <span class="st">&quot;tzone&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;Europe/Paris&quot;</code></pre>
<div class="sourceCode" id="cb1336"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1336-1"><a href="#cb1336-1" aria-hidden="true" tabindex="-1"></a>vec</span></code></pre></div>
<pre><code>## [1] &quot;2020-01-01 10:34:12 CET&quot;</code></pre>
<p></p>
<p>Sendo assim, você pode aplicar dois métodos diferentes sobre um valor do tipo <code>POSIXct</code> ou <code>POSIXlt</code>, para se identificar o fuso horário de referência. Para mais, compreenda que ao longo desses métodos, o fuso horário aplicado pode se apresentar em 3 formatos diferentes: por meio de um código (como <code>CET</code>, para <em>Central European Time</em>, ou <code>UTC</code>, para <em>Coordinated Universal Time</em>); por meio de uma região, ou uma cidade específica (como <code>America/Sao_Paulo</code>, ou <code>Europe/Paris</code>); ou então, por um desvio positivo ou negativo em relação ao fuso horário UTC (como <code>-03</code>, <code>+05</code>, ou <code>+11</code>).</p>
</div>
<div id="zonas-horárias-e-o-coordinated-universal-time-utc-como-horário-internacional" class="section level3" number="12.7.2">
<h3 number="12.7.2"><span class="header-section-number">12.7.2</span> Zonas horárias e o <em>Coordinated Universal Time</em> (UTC) como horário internacional</h3>
<p>O planeta Terra é divido em 24 zonas horárias, que são apresentadas na figura abaixo. No centro, se encontra a zona horária de número 0, que é a zona em que se encontra o famoso Meridiano de Greenwhich, que por convenção, é o meridiano que divide a terra ao meio, ou, em outras palavras, que separa formalmente o oriente do ocidente. Cada zona horária, representa um fuso horário diferente, e, por isso, podemos dizer que há 24 fusos horários diferentes ao redor do mundo.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/World_Time_Zones_Map.png" alt="As diferentes zonas horárias presentes no planeta Terra" width="100%" />
<p class="caption">
(#fig:unnamed-chunk-728)As diferentes zonas horárias presentes no planeta Terra
</p>
</div>
<p></p>
<p>Mesmo que cada zona horária seja determinada geograficamente, cada país ou cada nação tem o direito político de decidir qual a zona horária a qual ele pertence. Por esse motivo, mesmo que países como Argélia, Espanha e França estejam geograficamente sobre a zona horária de número 0, por decisão política própria, tais países foram inclusos na zona horária de número +1.</p>
<p>A zona horária de número 0, é a zona horária em que é calculado e utilizado o horário internacional, que é comumente denominado de <em>Coordinated Universal Time</em> (UTC), ou, Tempo Universal Coordenado. Sendo que <strong>todos os fusos horários utilizados ao redor do mundo, são calculados a partir do horário UTC</strong>. Dito de outra forma, UTC é o nome do fuso horário utilizado na zona horária de número 0, (isto é, a zona em que se encontra o Meridiano de Greenwhich) e tal horário, é a base para determinarmos todos os outros horários empregados no mundo.</p>
<p>Sendo assim, o UTC é oficialmente o horário universal ou internacional utilizado no mundo. No passado, o sistema UTC era formalmente chamado de Tempo Médio de Greenwhich, ou, <em>Greenwhich Mean Time</em> (GMT), o qual sofreu alterações metodológicas importantes, que o transformaram no sistema UTC que conhecemos e utilizamos hoje. Por isso, caso você encontre algum horário acompanhado da sigla GMT, saiba que ele está se referindo ao “antigo UTC.”</p>
</div>
<div id="fusos-horários-como-desvios-do-horário-utc" class="section level3" number="12.7.3">
<h3 number="12.7.3"><span class="header-section-number">12.7.3</span> Fusos horários como desvios do horário UTC</h3>
<p>É muito importante destacar que, <strong>o UTC é o horário internacional, não no sentido de que ele é o horário utilizado fora dos limites de qualquer país, mas sim, no sentido de que todos os outros fusos horários utilizados no planeta, são calculados a partir dele</strong>.</p>
<p>Em resumo, o fuso horário aplicado em uma determinada zona horária, apresenta 1 hora de diferença em relação aos fusos horários empregados em suas zonas vizinhas. Tal efeito é de certa forma, uma consequência do fato da Terra levar aproximadamente 24 horas para dar a volta completa em torno de seu próprio eixo (esse movimento é chamado de rotação da Terra). Por esse motivo, cada uma das 24 zonas horárias possui 15 graus de longitude (ou de “largura”). Pois a cada 15 graus que a Terra rotaciona, 1 hora se passa em nosso horário.</p>
<p>Essa afirmação pode ser posta matematicamente. Ao partirmos do princípio de que a Terra é uma esfera perfeita, sabemos que o planeta possui 360 graus de circunferência. Levando-se em conta que o planeta demora 24 horas para rotacionar-se em torno de seu próprio eixo, temos que <span class="math inline">\(360 / 24 = 15\)</span> graus por hora. Por essa razão que, cada zona horária, ou, cada fuso horário apresenta 1 hora de diferença em relação aos seus vizinhos.</p>
<p>Com isso, podemos interpretar fusos horários como desvios de <span class="math inline">\(x\)</span> horas em relação ao horário UTC (ou a zona horária de número 0). Ao analisarmos um determinado fuso horário, é muito importante identificarmos o lado do Meridiano de Greenwhich (à esquerda ou à direita) no qual esse fuso se encontra, pois, tal informação determinará se o desvio de <span class="math inline">\(x\)</span> horas (em relação ao horário UTC) é negativo (à esquerda) ou positivo (à direita). Se o desvio for negativo, significa que o desvio deve ser subtraído do horário internacional (ou seja, o horário do país em questão, está atrasado em relação ao horário UTC). Por outro lado, se o desvio for positivo, significa que esse desvio deve ser acrescido ao horário internacional (o país está com horário adiantado).</p>
<p>Portanto, um fuso horário é calculado a partir de um desvio de <span class="math inline">\(x\)</span> horas em relação ao horário UTC. Para sabermos o número <span class="math inline">\(x\)</span> de horas a serem descontadas (ou adicionadas) do horário UTC, temos que saber a distância da zona horária em análise da zona horária de número 0. Por exemplo, ao voltarmos para a figura 12.7, podemos identificar que a Finlândia está inclusa na zona horária de número +2 e, por estar a duas zonas horárias de distância da zona horária de número 0, sabemos que o horário empregado na Finlândia possui um desvio positivo de 2 horas em relação ao horário UTC. Isso significa que a Finlândia está 2 horas adiantada em relação ao horário internacional.</p>
<p>Como um outro exemplo, o Brasil participa de 4 zonas horárias diferentes (de números -2, -3, -4 e -5). Logo, o Brasil possui 4 fusos horários diferentes ao longo de suas regiões, sendo o fuso horário de Brasília o mais comum dentre eles. A zona horária que representa o fuso horário de Brasília, é a zona de número -3. Isso significa que o horário de Brasília está a 3 desvios negativos do horário UTC, ou, dito de outra forma, o horário de Brasília é equivalente ao horário internacional subtraído de 3 horas (ou atrasado em 3 horas). Tal relação está exposta pela figura 12.8.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/test_tz.png" alt="O Brasil possui quatro fusos horários diferentes" width="100%" />
<p class="caption">
(#fig:unnamed-chunk-730)O Brasil possui quatro fusos horários diferentes
</p>
</div>
<p></p>
</div>
<div id="sec:datetime_confusoes_cod_z" class="section level3" number="12.7.4">
<h3 number="12.7.4"><span class="header-section-number">12.7.4</span> Quando fusos horários diferentes geram uma grande confusão</h3>
<p>Uma das principais características do pacote <code>lubridate</code> é a de que suas funções tentam utilizar o fuso horário UTC em todo lugar. Por isso, em todas as ocasiões em que não definirmos explicitamente um fuso horário a ser empregado no argumento <code>tz</code> de <code>as_datetime()</code>, ou de <code>dmy_hms()</code>, o valor resultante dessas funções vai utilizar o fuso UTC.</p>
<p>No entanto, as funções dos pacotes básicos do R adotam um protocolo diferente. Ao não definirmos um fuso horário no argumento <code>tz</code> das funções <code>as.POSIXct()</code> e <code>strptime()</code>, o fuso horário padrão do sistema operacional será automaticamente empregado sobre o resultado. No caso do Brasil, enfrentamos 4 fusos horários diferentes. Logo, a depender de onde você se encontra no país, você talvez tenha resultados diferentes dos que são apresentados a seguir. Mas o raciocínio permanece o mesmo, independentemente de onde você se encontra no planeta.</p>
<p>Na prática, essa diferença entre padrões só impacta em seus resultados, caso você esteja trabalhando com diversos fusos horários ao mesmo tempo, ou, se você deseja aplicar alguma operação que lida diretamente com o fuso horário de um dado do tipo <code>date-time</code>. Um exemplo de operação que lida diretamente com o fuso de referência dos dados e, que, portanto, possui diferentes resultados entre <code>as_datetime()</code> e <code>as.POSIXct()</code>, é o uso do código <code>%z</code> em <code>format</code>, para incluir um desvio (em horas e minutos) sobre o fuso horário a ser aplicado sobre o resultado final.</p>
<p>Na seção <a href="#sec:date_time_formato_diferente">O que devo fazer se meus dados se encontram em um formato diferente?</a>, demos um exemplo prático que demonstra esse efeito, que nasce da diferença entre os fusos horários padrões adotados pelas funções. Nesse exemplo possuíamos um vetor chamado <code>dt</code>, contendo o instante: 8 horas do dia 01 de janeiro de 2020. O objetivo principal desse exemplo era demonstrar que, se não definirmos algum fuso horário no argumento <code>tz</code>, as funções <code>as_datetime()</code> e <code>as.POSIXct()</code> nos trazem resultados diferentes, quando aplicadas sobre os mesmos valores do tipo <code>date-time</code>. Tal exemplo está reproduzido abaixo:</p>
<p></p>
<div class="sourceCode" id="cb1338"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1338-1"><a href="#cb1338-1" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">&lt;-</span> <span class="st">&quot;2020-01-01 08:00:00 -0300&quot;</span></span>
<span id="cb1338-2"><a href="#cb1338-2" aria-hidden="true" tabindex="-1"></a><span class="fu">as.POSIXct</span>(dt, <span class="at">format =</span> <span class="st">&quot;%F %T %z&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2020-01-01 08:00:00 -03&quot;</code></pre>
<div class="sourceCode" id="cb1340"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1340-1"><a href="#cb1340-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as_datetime</span>(dt, <span class="at">format =</span> <span class="st">&quot;%F %T %z&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2020-01-01 11:00:00 UTC&quot;</code></pre>
<p></p>
<p>Lembre-se que o valor <code>-0300</code> presente ao final da <em>string</em> armazenada em <code>dt</code>, representa um desvio negativo de 3 horas que será interpretado pelo código <code>%z</code>. Para mais, lembre-se que o valor <code>-03</code> presente ao final do resultado de <code>as.POSIXct()</code> representa apenas o fuso horário empregado nesse resultado e, portanto, não possui qualquer relação com o desvio de <code>-0300</code> do código <code>%z</code>.</p>
<p>Primeiro, ao observarmos o resultado de <code>as.POSIXct()</code>, percebemos que o desvio de 3 horas (<code>-0300</code>) não gerou alterações no horário (8 horas em ponto) contido em <code>dt</code>. Entretanto, nós também podemos observar abaixo, que a função <code>as_datetime()</code> “adicionou” esse desvio ao valor presente em <code>dt</code>, gerando assim, um horário adiantado em 3 horas. A lógica por trás desses resultados, começa a ficar mais clara, a medida em que alteramos o valor do desvio, como demonstrado abaixo.</p>
<p></p>
<div class="sourceCode" id="cb1342"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1342-1"><a href="#cb1342-1" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">&lt;-</span> <span class="st">&quot;2020-01-01 08:00:00 -0200&quot;</span></span>
<span id="cb1342-2"><a href="#cb1342-2" aria-hidden="true" tabindex="-1"></a><span class="fu">as.POSIXct</span>(dt, <span class="at">format =</span> <span class="st">&quot;%F %T %z&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2020-01-01 07:00:00 -03&quot;</code></pre>
<div class="sourceCode" id="cb1344"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1344-1"><a href="#cb1344-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as_datetime</span>(dt, <span class="at">format =</span> <span class="st">&quot;%F %T %z&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2020-01-01 10:00:00 UTC&quot;</code></pre>
<p></p>
<p>Como um outro exemplo, podemos alterar o sinal do desvio. Porém, ao contrário do que você provavelmente está pensando, mesmo um desvio positivo acaba sendo subtraído do horário. Dessa vez, <code>as.POSIXct()</code> subtraiu 5 horas do horário original de <code>dt</code>, enquanto em <code>as_datetime()</code>, a redução foi de apenas 2 horas.</p>
<p></p>
<div class="sourceCode" id="cb1346"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1346-1"><a href="#cb1346-1" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">&lt;-</span> <span class="st">&quot;2020-01-01 08:00:00 +0200&quot;</span></span>
<span id="cb1346-2"><a href="#cb1346-2" aria-hidden="true" tabindex="-1"></a><span class="fu">as.POSIXct</span>(dt, <span class="at">format =</span> <span class="st">&quot;%F %T %z&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2020-01-01 03:00:00 -03&quot;</code></pre>
<div class="sourceCode" id="cb1348"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1348-1"><a href="#cb1348-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as_datetime</span>(dt, <span class="at">format =</span> <span class="st">&quot;%F %T %z&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2020-01-01 06:00:00 UTC&quot;</code></pre>
<p></p>
<p>A medida em que testamos diferentes valores para esse desvio, podemos perceber que a adição do desvio representado pelo código <code>%z</code> segue a fórmula:</p>
<center>
<span class="math inline">\(H = h - [(d \times -1) + z]\)</span>
</center>
<p>Sendo que, as variáveis presentes nessa equação são:</p>
<ul>
<li><span class="math inline">\(H\)</span>: hora presente no resultado final da função.</li>
<li><span class="math inline">\(h\)</span>: hora inicial, ou, em outras palavras, a hora que está presente na <em>string</em> de <em>input</em>.</li>
<li><span class="math inline">\(d\)</span>: número de desvios (em relação ao fuso UTC) que representa o fuso horário empregado no resultado final da função.</li>
<li><span class="math inline">\(z\)</span>: o valor do desvio presente na <em>string</em> de <em>input</em>, e que é representado pelo código <code>%z</code>.</li>
</ul>
<p>Desse modo, ao olharmos para a <em>string</em> armazenado em <code>dt</code>, identificamos que o valor de <span class="math inline">\(h\)</span> nessa equação, corresponde a 8 horas. Como nós não alteramos o horário presente nessa <em>string</em> em nenhum dos exemplos anteriores, o valor de <span class="math inline">\(h\)</span> esteve sempre fixo. O que estava variando de um exemplo para o outro, era o valor de <span class="math inline">\(z\)</span> e o valor de <span class="math inline">\(d\)</span>.</p>
<p>A valor da variável <span class="math inline">\(d\)</span> depende apenas de qual o fuso horário adotado pela função que estamos utilizando. Quando utilizamos a função <code>as_datetime()</code>, o valor de <span class="math inline">\(d\)</span> será igual a zero, pois essa função sempre tenta adotar o fuso horário UTC em seus resultados. Contudo, quando utilizamos as funções dos pacotes básicos do R, o valor de <span class="math inline">\(d\)</span> vai depender de qual é o fuso horário padrão de seu sistema operacional. No meu caso, o valor de <span class="math inline">\(d\)</span> em meu computador (quando a função <code>as.POSIXct()</code> ou <code>strptime()</code> é empregada) é igual a -3 (que é o desvio que representa o fuso horário de Brasília).</p>
<p>Tendo essas informações em mente, podemos concluir que a diferença entre os resultados das funções <code>as.POSIXct()</code> e <code>as_datetime()</code> se deve apenas à divergência entre os fusos horários adotados por cada função, o que impacta diretamente no valor da variável <span class="math inline">\(d\)</span> para cada função. Em outras palavras, se <span class="math inline">\(H_{lubr}\)</span> e <span class="math inline">\(H_{base}\)</span> são as horas calculadas por <code>as_datetime()</code> e <code>as.POSIXct()</code>, e, se <span class="math inline">\(d_{lubr}\)</span> e <span class="math inline">\(d_{base}\)</span> são os desvios que representam os fusos horários adotados por cada função, respectivamente, podemos expor essa diferença de forma matemática:</p>
<center>
<p><span class="math inline">\(H_{lubr} = 8 - [(d_{lubr} \times -1) + z] = 8+d_{lubr}-z\)</span></p>
<p><span class="math inline">\(H_{base} = 8 - [(d_{base} \times -1) + z] = 8+d_{base}-z\)</span></p>
<p><span class="math inline">\(H_{base} - H_{lubr} = 8+d_{base}-z - (8+d_{lubr}-z)\)</span></p>
<span class="math inline">\(H_{base} - H_{lubr} = d_{base} - d_{lubr}\)</span>
</center>
<p>Com essas equações, podemos rapidamente identificar que se ambas as funções aplicarem o mesmo fuso horário, as variáveis <span class="math inline">\(d_{lubr}\)</span> e <span class="math inline">\(d_{base}\)</span> serão iguais e, consequentemente, essa diferença entre <span class="math inline">\(H_{base}\)</span> e <span class="math inline">\(H_{lubr}\)</span> desaparece. Como exemplo, perceba abaixo que ambas as funções retornam o mesmo resultado, ao escolhermos um fuso horário específico no argumento <code>tz</code> de cada função, como por exemplo, o horário de Toronto (Canadá).</p>
<p></p>
<div class="sourceCode" id="cb1350"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1350-1"><a href="#cb1350-1" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">&lt;-</span> <span class="st">&quot;2020-01-01 08:00:00 +0200&quot;</span></span>
<span id="cb1350-2"><a href="#cb1350-2" aria-hidden="true" tabindex="-1"></a><span class="do">### Quando ambas as funções utilizam o mesmo fuso horário</span></span>
<span id="cb1350-3"><a href="#cb1350-3" aria-hidden="true" tabindex="-1"></a><span class="do">### a inserção do código %z gera o mesmo resultado</span></span>
<span id="cb1350-4"><a href="#cb1350-4" aria-hidden="true" tabindex="-1"></a><span class="fu">as.POSIXct</span>(dt, <span class="at">format =</span> <span class="st">&quot;%F %T %z&quot;</span>, <span class="at">tz =</span> <span class="st">&quot;America/Toronto&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2020-01-01 01:00:00 EST&quot;</code></pre>
<div class="sourceCode" id="cb1352"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1352-1"><a href="#cb1352-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as_datetime</span>(dt, <span class="at">format =</span> <span class="st">&quot;%F %T %z&quot;</span>, <span class="at">tz =</span> <span class="st">&quot;America/Toronto&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2020-01-01 01:00:00 EST&quot;</code></pre>
<p></p>
<p>Portanto, fique atento a possíveis diferenças entre os horários que resultam de funções que, em tese, deveriam ser “equivalentes” e, que portanto, deveriam gerar os mesmos resultados. Essa seção, buscou demonstrar que tal diferença pode nascer da divergência entre os fusos horários adotados por cada função. Caso você encontre uma diferença dessa natureza, busque pela documentação interna de cada função, e procure entender como essas funções trabalham com o fuso horário.</p>
</div>
<div id="interpretando-um-mesmo-ponto-no-tempo-em-diferentes-fusos-horários" class="section level3" number="12.7.5">
<h3 number="12.7.5"><span class="header-section-number">12.7.5</span> Interpretando um mesmo ponto no tempo em diferentes fusos horários</h3>
<p>Vamos construir mentalmente duas pessoas. Cláudio mora e trabalha no Rio de Janeiro, e tem feito alguns projetos internacionais na área de marketing. Um de seus principais parceiros é Ryuichi, um grande empresário do Japão. Suponha que Cláudio e Ryuichi tenham marcado uma reunião entre eles, às 9hrs da manhã no horário do Japão (isto é, no horário local para o Ryuichi). Qual será o horário da reunião no Brasil? Ou seja, que horas Cláudio deve ligar o seu computador e acessar a sala de reunião para conversar com Ryuichi?</p>
<p>Podemos rapidamente responder a essa questão, com a função <code>with_tz()</code>. Precisamos primeiro, criar um objeto que guarde o horário de 9hrs segundo o fuso horário do Japão e, em seguida, pedimos à função, que nos mostre esse mesmo instante segundo o horário de São Paulo. Como você pode ver abaixo, Cláudio teria que entrar na reunião às 21hrs do dia anterior ao dia marcado por Ryuichi.</p>
<p></p>
<div class="sourceCode" id="cb1354"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1354-1"><a href="#cb1354-1" aria-hidden="true" tabindex="-1"></a>horario_japao <span class="ot">&lt;-</span> <span class="fu">ymd_hm</span>(<span class="st">&quot;2020-01-01 09:00&quot;</span>, <span class="at">tz =</span> <span class="st">&quot;Japan&quot;</span>)</span>
<span id="cb1354-2"><a href="#cb1354-2" aria-hidden="true" tabindex="-1"></a><span class="fu">with_tz</span>(horario_japao, <span class="st">&quot;America/Sao_Paulo&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2019-12-31 21:00:00 -03&quot;</code></pre>
<p></p>
<p>Portanto, o horário do Japão está 12 horas adiantado em relação ao horário utilizado por Cláudio. Isso significa que, poderíamos chegar ao mesmo resultado mostrado pela função <code>with_tz()</code>, ao subtrairmos 12 horas do valor presente <code>horario_japao</code>. Lembre-se que, valores do tipo <code>POSIXct</code> são armazenados em segundos, logo, para subtrairmos as 12 horas, precisamos multiplicar essas 12 horas com os 60 minutos (de cada hora) e com os 60 segundos (de cada minuto).</p>
<p></p>
<div class="sourceCode" id="cb1356"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1356-1"><a href="#cb1356-1" aria-hidden="true" tabindex="-1"></a>horario_japao <span class="sc">-</span> (<span class="dv">12</span> <span class="sc">*</span> <span class="dv">60</span> <span class="sc">*</span> <span class="dv">60</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2019-12-31 21:00:00 JST&quot;</code></pre>
<p></p>
<p>No entanto, ao invés de adicionar ou subtrair segundos, no fundo, o que a função <code>with_tz()</code> faz, é retornar o mesmo objeto contendo um atributo <code>tzone</code> diferente. Em outras palavras, podemos ainda chegar ao mesmo resultado de <code>with_tz()</code>, ao alterarmos o valor do atributo <code>tzone</code> em <code>horario_japao</code> para o fuso horário de Cláudio, como demonstrado abaixo.</p>
<p></p>
<div class="sourceCode" id="cb1358"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1358-1"><a href="#cb1358-1" aria-hidden="true" tabindex="-1"></a>horario_brasil <span class="ot">&lt;-</span> horario_japao</span>
<span id="cb1358-2"><a href="#cb1358-2" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(horario_brasil, <span class="st">&quot;tzone&quot;</span>) <span class="ot">&lt;-</span> <span class="st">&quot;America/Sao_Paulo&quot;</span></span>
<span id="cb1358-3"><a href="#cb1358-3" aria-hidden="true" tabindex="-1"></a>horario_brasil</span></code></pre></div>
<pre><code>## [1] &quot;2019-12-31 21:00:00 -03&quot;</code></pre>
<p></p>
<p>Por isso, fique atento aos seus dados do tipo <code>POSIXct</code> e <code>POSIXlt</code>. Na hipótese desses dados se alterarem repentinamente, sem alguma explicação clara, pode ser que alguma operação que você realizou tenha alterado o valor conectado ao atributo <code>tzone</code> desses dados e, com isso, provocado esse efeito.</p>
</div>
</div>
<div id="calculando-intervalos-com-o-tipo-difftime" class="section level2" number="12.8">
<h2 number="12.8"><span class="header-section-number">12.8</span> Calculando intervalos com o tipo <code>difftime</code></h2>
<p>O R oferece de forma nativa, um outro tipo de variável de tempo que é útil para calcularmos intervalos ou diferenças entre dois pontos no tempo. Esse tipo é comumente chamado de <code>difftime</code>, e é representado principalmente pela função <code>difftime()</code>.</p>
<p>O tipo <code>difftime</code> é na verdade, um tipo de dado muito simples. Em resumo, um dado do tipo <code>difftime</code> é um dado do tipo <code>double</code>, acompanhado de um atributo chamado <code>units</code>, que guarda a unidade na qual o valor <code>double</code> se encontra. Porém, o papel que esse tipo busca cumprir não é nada simples.</p>
<p>Por exemplo, vamos supor dois horários em um mesmo dia, como 09 horas e 16 horas. A diferença entre esses dois pontos é de 7 horas. Tudo que o tipo <code>difftime</code> faz é, armazenar a unidade “horas” no atributo <code>units</code> que está conectado ao número 7. Dito de outra forma, um dos papéis que o tipo <code>difftime</code> cumpre é manter o controle das unidades de tempo empregadas em valores que representam um intervalo de tempo (ou a duração de algum evento).</p>
<p></p>
<div class="sourceCode" id="cb1360"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1360-1"><a href="#cb1360-1" aria-hidden="true" tabindex="-1"></a>dt1 <span class="ot">&lt;-</span> <span class="fu">ymd_h</span>(<span class="st">&quot;2020-01-01 09&quot;</span>)</span>
<span id="cb1360-2"><a href="#cb1360-2" aria-hidden="true" tabindex="-1"></a>dt2 <span class="ot">&lt;-</span> <span class="fu">ymd_h</span>(<span class="st">&quot;2020-01-01 16&quot;</span>)</span>
<span id="cb1360-3"><a href="#cb1360-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1360-4"><a href="#cb1360-4" aria-hidden="true" tabindex="-1"></a><span class="fu">difftime</span>(dt2, dt1)</span></code></pre></div>
<pre><code>## Time difference of 7 hours</code></pre>
<p></p>
<p>Devido a esse controle, o tipo <code>difftime</code> é capaz de eficientemente calcular o intervalo de tempo, entre valores que se encontram em unidades de tempo diferentes. Por exemplo, qual a diferença entre 14 horas e 14000 segundos? Ao convertermos esses números para valores do tipo <code>difftime</code>, o R se torna capaz de identificar as unidades de cada um. Dessa forma, o R pode reconhecer qual a maneira ideal de converter ambos os valores para a mesma unidade, e com isso, calcular corretamente a diferença entre os dois.</p>
<p></p>
<div class="sourceCode" id="cb1362"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1362-1"><a href="#cb1362-1" aria-hidden="true" tabindex="-1"></a>horas <span class="ot">&lt;-</span> <span class="fu">as.difftime</span>(<span class="dv">14</span>, <span class="at">units =</span> <span class="st">&quot;hours&quot;</span>)</span>
<span id="cb1362-2"><a href="#cb1362-2" aria-hidden="true" tabindex="-1"></a>segundos <span class="ot">&lt;-</span> <span class="fu">as.difftime</span>(<span class="dv">14000</span>, <span class="at">units =</span> <span class="st">&quot;secs&quot;</span>)</span>
<span id="cb1362-3"><a href="#cb1362-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1362-4"><a href="#cb1362-4" aria-hidden="true" tabindex="-1"></a>horas <span class="sc">-</span> segundos</span></code></pre></div>
<pre><code>## Time difference of 36400 secs</code></pre>
<p></p>
<p>Além disso, a função <code>difftime()</code> lhe permite escolher a unidade que você deseja para o resultado. Logo, se você deseja saber quantas semanas estão entre as datas 14 de março de 2020 e 01 de janeiro de 2020, você pode rapidamente calcular esse valor da seguinte maneira:</p>
<p></p>
<div class="sourceCode" id="cb1364"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1364-1"><a href="#cb1364-1" aria-hidden="true" tabindex="-1"></a>janeiro <span class="ot">&lt;-</span> <span class="fu">ymd</span>(<span class="st">&quot;2020-01-01&quot;</span>)</span>
<span id="cb1364-2"><a href="#cb1364-2" aria-hidden="true" tabindex="-1"></a>marco <span class="ot">&lt;-</span> <span class="fu">ymd</span>(<span class="st">&quot;2020-03-14&quot;</span>)</span>
<span id="cb1364-3"><a href="#cb1364-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1364-4"><a href="#cb1364-4" aria-hidden="true" tabindex="-1"></a><span class="fu">difftime</span>(marco, janeiro, <span class="at">units =</span> <span class="st">&quot;weeks&quot;</span>)</span></code></pre></div>
<pre><code>## Time difference of 10.42857 weeks</code></pre>
<p></p>
<p>Caso você não precise de um nível de precisão muito elevado, você aplicar funções como <code>round()</code>, <code>ceiling()</code> e <code>floor()</code> sobre o resultado de <code>difftime()</code>. Por exemplo, a parte decimal do valor que calculamos acima (10,42857 semanas) é de pouco valor para nós. Digo, quanto é 0,42857 ou 42,857% de uma semana? Por essa questão, seria interessante aplicarmos a função <code>floor()</code> sobre este resultado, para sabermos qual o número de semanas completas que existem entre as datas de <code>marco</code> e <code>janeiro</code>.</p>
<p></p>
<div class="sourceCode" id="cb1366"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1366-1"><a href="#cb1366-1" aria-hidden="true" tabindex="-1"></a><span class="fu">floor</span>(<span class="fu">difftime</span>(marco, janeiro, <span class="at">units =</span> <span class="st">&quot;weeks&quot;</span>))</span></code></pre></div>
<pre><code>## Time difference of 10 weeks</code></pre>
<p></p>
</div>
<div id="sec:interp_var_tempo" class="section level2" number="12.9">
<h2 number="12.9"><span class="header-section-number">12.9</span> Como as variáveis de tempo são interpretadas pelo R ?</h2>
<p>Em resumo, qualquer informação que represente uma data (ex: 20/12/2020) é geralmente interpretada pelo R por meio do tipo <code>Date</code>; já datas que são acompanhadas de algum horário (ex: 20/12/2020 10:32:41) são assimiladas pelo R através dos tipos <code>POSIXlt</code> e <code>POSIXct</code> <span class="citation">(<a href="#ref-peng2015" role="doc-biblioref">Peng 2015</a>)</span>; e, por último, quando temos a duração de algum evento, ou principalmente, a diferença de tempo entre duas datas (ex: a diferença entre 12 de março e 15 de março é de três dias, ou, 72 horas, ou, 4.320 minutos, ou, 259.200 segundos), temos a opção de empregarmos o tipo <code>difftime</code> sobre essas informações (mas nem sempre isso é necessário).</p>
<p><strong>No fundo, qualquer dado que for interpretado pelos tipos <code>Date</code>, <code>POSIXlt</code>, <code>POSIXct</code>, ou <code>difftime</code>, é armazenado pelo R como um número real, isto é, um dado do tipo <code>double</code></strong>. Ou seja, da mesma forma em que descrevemos (no capítulo anterior) o tipo <code>factor</code> como um “parente” do tipo básico <code>integer</code>, os tipos <code>Date</code>, <code>POSIXlt</code>, <code>POSIXct</code> e <code>difftime</code> são na realidade, parentes do tipo básico <code>double</code>, ou, dito de outra forma, são construídos a partir dele. E o que diferencia esses tipos do tipo básico <code>double</code>, são as suas classes e atributos.</p>
<p>Assim sendo, em termos técnicos, podemos dizer que um dado que se encontra no tipo <code>Date</code>, <code>POSIXlt</code>, <code>POSIXct</code>, ou <code>difftime</code>, é na verdade, um dado do tipo <code>double</code> que possui classe <code>Date</code>, <code>POSIXlt</code>, <code>POSIXct</code>, ou <code>difftime</code>, respectivamente. Para mais, um objeto que se encontra no tipo <code>POSIXlt</code> ou <code>POSIXct</code>, inclui um atributo chamado <code>tzone</code>. Já um objeto do tipo <code>difftime</code>, possui um atributo chamado <code>units</code>. Dito de outra forma, os tipos <code>Date</code>, <code>POSIXlt</code>, <code>POSIXct</code> e <code>difftime</code> são armazenados por meio do tipo <code>double</code>, mas apresentam diferentes classes e atributos que os diferenciam uns dos outros.</p>
<p>Isso significa que, por exemplo, para testarmos corretamente se um objeto do R se encontra no tipo <code>Date</code>, nós devemos aplicar um teste lógico parecido com o teste abaixo. Ambos os vetores (<code>double_vec</code> e <code>date_vec</code>) conseguem passar (isto é, adquirem um valor <code>TRUE</code>) na primeira parte do teste (<code>is.double(x)</code>), pois ambos os vetores são do tipo <code>double</code>. Entretanto, apenas o vetor <code>date_vec</code> é capaz de passar também na segunda parte do teste (<code>class(x) == "Date"</code>), pois apenas <code>date_vec</code> possui classe <code>Date</code>.</p>
<p></p>
<div class="sourceCode" id="cb1368"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1368-1"><a href="#cb1368-1" aria-hidden="true" tabindex="-1"></a>double_vec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">1.2</span>, <span class="fl">1.5</span>, <span class="fl">2.4</span>)</span>
<span id="cb1368-2"><a href="#cb1368-2" aria-hidden="true" tabindex="-1"></a>date_vec <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="fu">c</span>(<span class="st">&quot;2020-09-10&quot;</span>, <span class="st">&quot;2020-09-11&quot;</span>, <span class="st">&quot;2020-09-12&quot;</span>))</span>
<span id="cb1368-3"><a href="#cb1368-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1368-4"><a href="#cb1368-4" aria-hidden="true" tabindex="-1"></a><span class="fu">is.double</span>(double_vec) <span class="sc">&amp;</span> <span class="fu">class</span>(double_vec) <span class="sc">==</span> <span class="st">&quot;Date&quot;</span></span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<div class="sourceCode" id="cb1370"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1370-1"><a href="#cb1370-1" aria-hidden="true" tabindex="-1"></a><span class="fu">is.double</span>(date_vec) <span class="sc">&amp;</span> <span class="fu">class</span>(date_vec) <span class="sc">==</span> <span class="st">&quot;Date&quot;</span></span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p></p>
<p>Uma segunda forma mais direta de realizarmos esse teste é através da função <code>inherits()</code>, que é capaz de identificar se um objeto específico do R “herda,” ou apresenta as características específicas de um tipo em questão.</p>
<p></p>
<div class="sourceCode" id="cb1372"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1372-1"><a href="#cb1372-1" aria-hidden="true" tabindex="-1"></a><span class="fu">inherits</span>(double_vec, <span class="st">&quot;Date&quot;</span>)</span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<div class="sourceCode" id="cb1374"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1374-1"><a href="#cb1374-1" aria-hidden="true" tabindex="-1"></a><span class="fu">inherits</span>(date_vec, <span class="st">&quot;Date&quot;</span>)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p></p>
<div id="escala-de-tempo-e-o-conceito-de-data-de-origem" class="section level3" number="12.9.1">
<h3 number="12.9.1"><span class="header-section-number">12.9.1</span> Escala de tempo e o conceito de data de origem</h3>
<p>Para que essa característica fique clara, veja o exemplo abaixo. Primeiro, eu guardo a data 10 de março de 2020 no objeto <code>d</code>. Ao questionarmos o R sobre o tipo de dado e classe utilizados pelo objeto <code>d</code>, vemos que ele é um vetor do tipo <code>double</code> com classe <code>Date</code>. Em seguida, eu aplico a função <code>unclass()</code> sobre o objeto <code>d</code>, para que o R me mostre exatamente como essa data está sendo armazenada.</p>
<p>Repare abaixo, que o R está guardando a data <code>2020-03-10</code> (quer dizer, 10 de março de 2020) como o número 18331. Agora, você provavelmente está se questionando: o que esse número 18331 significa? Como ele é traduzido para a data 10 de março de 2020? Essas questões são respondidas pelo conceito de <strong>data de origem</strong>.</p>
<p></p>
<div class="sourceCode" id="cb1376"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1376-1"><a href="#cb1376-1" aria-hidden="true" tabindex="-1"></a><span class="do">## O objeto d guarda a data</span></span>
<span id="cb1376-2"><a href="#cb1376-2" aria-hidden="true" tabindex="-1"></a><span class="do">## 10 de março de 2020</span></span>
<span id="cb1376-3"><a href="#cb1376-3" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">&quot;2020-03-10&quot;</span>)</span>
<span id="cb1376-4"><a href="#cb1376-4" aria-hidden="true" tabindex="-1"></a><span class="fu">typeof</span>(d)</span></code></pre></div>
<pre><code>## [1] &quot;double&quot;</code></pre>
<div class="sourceCode" id="cb1378"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1378-1"><a href="#cb1378-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(d)</span></code></pre></div>
<pre><code>## [1] &quot;Date&quot;</code></pre>
<div class="sourceCode" id="cb1380"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1380-1"><a href="#cb1380-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unclass</span>(d)</span></code></pre></div>
<pre><code>## [1] 18331</code></pre>
<p></p>
<p>Este número, pelo qual o R guarda a data <code>2020-03-10</code>, representa o número de dias decorridos desde a data de origem até a data <code>2020-03-10</code>. Digo, 18331 dias se passaram desde a data de origem até atingirmos o dia 10 de março de 2020. Portanto, a <strong>data de origem representa o “marco zero,” ou o ponto zero da escala de tempo</strong>, e podemos descobrir qual é essa “data de origem” utilizada pelo R, ao subtrairmos da data armazenada o número que a representa.</p>
<p>Por exemplo, se o número 18331 representa a data <code>2020-03-10</code>, ao subtrairmos esse número dessa data, o R acaba nos retornando a data <code>1970-01-01</code>. Portanto, o “dia zero” segundo a perspectiva do R, é o dia 01 de janeiro de 1970. Isso significa que, todos os seus dados no R que estiverem sendo interpretadas pelo tipo <code>Date</code>, vão ser (obrigatoriamente) armazenados pelo R como o número de dias entre a data de origem do R (o dia 01 de janeiro de 1970) e as suas datas em questão.</p>
<p></p>
<div class="sourceCode" id="cb1382"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1382-1"><a href="#cb1382-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.Date</span>(<span class="st">&quot;2020-03-10&quot;</span>) <span class="sc">-</span> <span class="dv">18331</span></span></code></pre></div>
<pre><code>## [1] &quot;1970-01-01&quot;</code></pre>
<p></p>
<p>Essa característica é muito importante, e não é particular ao R. Diversas linguagens de programação, e programas comuns (como o Excel) implementam variáveis de tempo desta mesma maneira<a href="#fn39" class="footnote-ref" id="fnref39"><sup>39</sup></a>. Logo, no R, qualquer informação que descreva um ponto específico do tempo é armazenada como um número, e, tal número representa (de certa maneira) uma “medida de distância” entre o ponto zero da escala de tempo e o ponto do tempo com o qual você está trabalhando.</p>
<p>Tendo isso em mente, qual é o número que representa a data 10 de janeiro de 1970 no R? Se você compreendeu os conceitos apresentados nessa seção, você certamente respondeu que esse valor é o número 9. Pois partindo do dia 01 de janeiro de 1970 até o dia 10 de janeiro, temos 9 dias de diferença.</p>
<p></p>
<div class="sourceCode" id="cb1384"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1384-1"><a href="#cb1384-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">&quot;1970-01-10&quot;</span>)</span>
<span id="cb1384-2"><a href="#cb1384-2" aria-hidden="true" tabindex="-1"></a><span class="fu">unclass</span>(d)</span></code></pre></div>
<pre><code>## [1] 9</code></pre>
<p></p>
<p>Mas e as datas anteriores ao dia 01 de janeiro de 1970? Como o R representa essas datas? Mesmo nessa situação, o R não muda o seu comportamento. Contudo, como essas datas se encontram atrás do “ponto zero” na escala do tempo utilizada, o R vai representar essas datas com números negativos. Por exemplo, o dia 30 de dezembro de 1969 é representado por meio do número -2. Pois essa data se encontra a 2 dias atrás do dia 01 de janeiro de 1970.</p>
<p></p>
<div class="sourceCode" id="cb1386"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1386-1"><a href="#cb1386-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">&quot;1969-12-30&quot;</span>)</span>
<span id="cb1386-2"><a href="#cb1386-2" aria-hidden="true" tabindex="-1"></a><span class="fu">unclass</span>(d)</span></code></pre></div>
<pre><code>## [1] -2</code></pre>
<p></p>
<p>Portanto, quanto você aplica uma ordenação sobre um vetor do tipo <code>Date</code>, <code>POSIXlt</code>, <code>POSIXct</code> ou <code>difftime</code>, ao invés de o R comparar o dia, mês e ano de cada data, ele vai utilizar os números que representam cada ponto no tempo presente nesse vetor para calcular essa ordenação. Em outras palavras, esses valores são ordenados de acordo com as suas distâncias em relação à data de origem utilizada pelo R.</p>
</div>
<div id="a-unidade-ou-a-escala-de-tempo-muda-com-o-tipo-de-dado" class="section level3" number="12.9.2">
<h3 number="12.9.2"><span class="header-section-number">12.9.2</span> A unidade ou a escala de tempo muda com o tipo de dado</h3>
<p>Nós sabemos que o tipo <code>Date</code> é armazenado como o número de dias em relação à data de origem. Porém, um choque ocorre quando tentamos transportar isso para os tipos <code>POSIXlt</code> e <code>POSIXct</code>. Pois qualquer dado que for interpretado por algum desses dois tipos, vai ser armazenado como os segundos em relação ao ponto de origem.</p>
<p>Ou seja, a teoria continua a mesma; a sua informação continua sendo armazenada como um número, que representa uma “medida de distância” até o “ponto zero” da escala de tempo. Entretanto, a unidade utilizada nessa escala de tempo muda de acordo com o tipo de dado que você emprega. Logo, quando estamos discutindo o tipo <code>Date</code>, o R recorre à uma escala de tempo <strong>em dias</strong>. Mas quando estamos nos referindo aos tipos <code>POSIXlt</code> e <code>POSIXct</code>, essa mesma escala de tempo é interpretada <strong>em segundos</strong>.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/escala_tempo_posix.png" alt="Representação visual da escala de tempo utilizada por cada tipo de dado" width="90%" />
<p class="caption">
(#fig:unnamed-chunk-748)Representação visual da escala de tempo utilizada por cada tipo de dado
</p>
</div>
<p></p>
<p>Para mais, a data de origem é a mesma em ambas as escalas (01 de janeiro de 1970). Todavia, como os tipos <code>POSIXlt</code> e <code>POSIXct</code> são capazes de guardar horários, esses tipos vão utilizar um ponto específico dessa data de origem como referência. Isto é, ao invés de utilizar o dia 01 de janeiro de 1970 como um todo, os tipos <code>POSIXlt</code> e <code>POSIXct</code> empregam <strong>um ponto, ou, um horário específico</strong> desse dia como o ponto zero de sua escala de tempo. E esse horário é, de certa forma, o ponto zero desse dia, ou, de outra forma, a meia noite desse dia no fuso horário UTC. Logo, o <strong>ponto de origem</strong> na escala da qual os tipos <code>POSIXlt</code> e <code>POSIXct</code> usufruem é o horário 00:00:00 do dia 01 de janeiro de 1970, especificamente no fuso horário UTC.</p>
<p>Com isso, se o dia <code>2020-03-10</code> está a 18331 dias de distância do dia <code>1970-01-01</code>, a quantos segundos o horário 14:30 desse mesmo dia (<code>2020-03-10 14:30:00</code>) está de distância do ponto zero da escala (<code>1970-01-01 00:00:00</code>)? Para descobrirmos a resposta, podemos aplicar o mesmo método que utilizamos com o tipo <code>Date</code>, por meio da função <code>unclass()</code>. Vemos abaixo, que tal horário é interpretado pelo R como o segundo 1583850600. Em outras palavras, esse horário está aproximadamente a 1,583 bilhão de segundos de distância do ponto zero da escala.</p>
<p></p>
<div class="sourceCode" id="cb1388"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1388-1"><a href="#cb1388-1" aria-hidden="true" tabindex="-1"></a>hr <span class="ot">&lt;-</span> <span class="fu">as.POSIXct</span>(<span class="st">&quot;2020-03-10 14:30:00&quot;</span>, <span class="at">tz =</span> <span class="st">&quot;UTC&quot;</span>)</span>
<span id="cb1388-2"><a href="#cb1388-2" aria-hidden="true" tabindex="-1"></a><span class="fu">unclass</span>(hr)</span></code></pre></div>
<pre><code>## [1] 1583850600
## attr(,&quot;tzone&quot;)
## [1] &quot;UTC&quot;</code></pre>
<p></p>
</div>
</div>
<div id="exercícios-9" class="section level2 unnumbered">
<h2 class="unnumbered">Exercícios</h2>
<p><strong>Questão 12.1.</strong> Cada item abaixo pode lhe pedir para identificar a origem de algum erro, ou de algum resultado inesperado, ou ainda, requisitar que você trabalhe com algum objeto específico para um dado fim.</p>
<p>12.1.A) Perceba abaixo, que ao transformarmos o vetor <code>vec</code> para o tipo <code>Date</code>, alguns elementos são transformados para valores <code>NA</code>. Porque essa transformação ocorre? Há alguma solução clara para isso?</p>
<p></p>
<div class="sourceCode" id="cb1390"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1390-1"><a href="#cb1390-1" aria-hidden="true" tabindex="-1"></a>vec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;2020-01-17&quot;</span>, <span class="st">&quot;2020-02-21&quot;</span>, <span class="st">&quot;2020-02-30&quot;</span>, </span>
<span id="cb1390-2"><a href="#cb1390-2" aria-hidden="true" tabindex="-1"></a>         <span class="st">&quot;2020-04-12&quot;</span>, <span class="st">&quot;2020-13-19&quot;</span>, <span class="st">&quot;2020-09-87&quot;</span>)</span>
<span id="cb1390-3"><a href="#cb1390-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1390-4"><a href="#cb1390-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1390-5"><a href="#cb1390-5" aria-hidden="true" tabindex="-1"></a><span class="fu">as.Date</span>(vec)</span></code></pre></div>
<pre><code>## [1] &quot;2020-01-17&quot; &quot;2020-02-21&quot; NA           &quot;2020-04-12&quot; NA          
## [6] NA</code></pre>
<p></p>
<p>12.1.B) Que comandos você utilizaria para transportar o vetor <code>vec</code> abaixo para o tipo <code>Date</code>?</p>
<p></p>
<div class="sourceCode" id="cb1392"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1392-1"><a href="#cb1392-1" aria-hidden="true" tabindex="-1"></a>vec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;02, 02, 2020&quot;</span>, <span class="st">&quot;15, 03, 2020&quot;</span>, <span class="st">&quot;21, 04, 2020&quot;</span>,</span>
<span id="cb1392-2"><a href="#cb1392-2" aria-hidden="true" tabindex="-1"></a>         <span class="st">&quot;19, 09, 2020&quot;</span>, <span class="st">&quot;22, 06, 2020&quot;</span>, <span class="st">&quot;25, 12, 2020&quot;</span>)</span></code></pre></div>
<p></p>
<p>12.1.C) Como definimos neste capítulo, no R, dados do tipo <code>date-time</code> são armazenados como o número de segundos desde a meia noite de 01 de janeiro de 1970. Porém, por alguma razão inesperada, quando eu crio um objeto contendo este exato ponto no tempo, e retiro a sua classe com a função <code>unclass()</code>, percebo que este ponto foi armazenado como o valor 10800. Porque isso ocorre? Ele não deveria ser armazenado como zero?</p>
<p></p>
<div class="sourceCode" id="cb1393"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1393-1"><a href="#cb1393-1" aria-hidden="true" tabindex="-1"></a>ponto <span class="ot">&lt;-</span> <span class="fu">as.POSIXct</span>(<span class="st">&quot;1970-01-01 00:00:00&quot;</span>)</span>
<span id="cb1393-2"><a href="#cb1393-2" aria-hidden="true" tabindex="-1"></a><span class="fu">unclass</span>(ponto)</span></code></pre></div>
<pre><code>## [1] 10800
## attr(,&quot;tzone&quot;)
## [1] &quot;&quot;</code></pre>
<p></p>
<p><strong>Questão 12.2.</strong> Como definimos anteriormente neste capítulo, diversos programas, incluindo o Excel, armazenam valores do tipo <code>date-time</code> como o número de dias ou de segundos, em relação a um ponto específico de origem na escala do tempo. Logo abaixo, temos a tabela <code>dados_excel</code>. Essa tabela nos apresenta na coluna <code>como_numero</code>, o número aproximado no Excel que representa os valores do tipo <code>date-time</code> presentes na coluna <code>como_data</code>. Ou seja, no Excel, o ponto <code>"20/02/2020 03:45:00"</code> é armazenada como o número decimal 43.881,15625. Considerando que, no sistema Windows, o Excel utiliza a data 30 de Dezembro de 1899 (ou <code>"1899-12-30"</code>) como o seu ponto de origem, o seu trabalho nessa questão é converter os números presentes no vetor <code>numero_no_excel</code> para o tipo <code>POSIXct</code>, de modo que o resultado contenha os mesmos instantes apresentados no vetor <code>datetime_no_excel</code>. <strong>Dica:</strong> configure o argumento <code>tz</code> para o fuso horário UTC, dessa forma, você evita em sua conversão, possíveis adições/subtrações automáticas que emergem da diferença entre o fuso de seu sistema operacional e o fuso UTC.</p>
<p></p>
<div class="sourceCode" id="cb1395"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1395-1"><a href="#cb1395-1" aria-hidden="true" tabindex="-1"></a>datetime_no_excel <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb1395-2"><a href="#cb1395-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;20/02/2020 03:40:00&quot;</span>,</span>
<span id="cb1395-3"><a href="#cb1395-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;20/02/2020 03:45:00&quot;</span>,</span>
<span id="cb1395-4"><a href="#cb1395-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;20/02/2020 03:50:00&quot;</span>,</span>
<span id="cb1395-5"><a href="#cb1395-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;20/02/2020 03:55:00&quot;</span>,</span>
<span id="cb1395-6"><a href="#cb1395-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;20/02/2020 04:00:00&quot;</span></span>
<span id="cb1395-7"><a href="#cb1395-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1395-8"><a href="#cb1395-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1395-9"><a href="#cb1395-9" aria-hidden="true" tabindex="-1"></a>numero_no_excel <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb1395-10"><a href="#cb1395-10" aria-hidden="true" tabindex="-1"></a>  <span class="fl">43881.1527777778</span>,</span>
<span id="cb1395-11"><a href="#cb1395-11" aria-hidden="true" tabindex="-1"></a>  <span class="fl">43881.15625</span>,</span>
<span id="cb1395-12"><a href="#cb1395-12" aria-hidden="true" tabindex="-1"></a>  <span class="fl">43881.159722222226</span>,</span>
<span id="cb1395-13"><a href="#cb1395-13" aria-hidden="true" tabindex="-1"></a>  <span class="fl">43881.1632060185</span>, </span>
<span id="cb1395-14"><a href="#cb1395-14" aria-hidden="true" tabindex="-1"></a>  <span class="fl">43881.1666666667</span></span>
<span id="cb1395-15"><a href="#cb1395-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1395-16"><a href="#cb1395-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1395-17"><a href="#cb1395-17" aria-hidden="true" tabindex="-1"></a>dados_excel <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb1395-18"><a href="#cb1395-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">como_data =</span> datetime_no_excel,</span>
<span id="cb1395-19"><a href="#cb1395-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">como_numero =</span> numero_no_excel</span>
<span id="cb1395-20"><a href="#cb1395-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1395-21"><a href="#cb1395-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1395-22"><a href="#cb1395-22" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(dados_excel)</span></code></pre></div>
<pre><code>##             como_data como_numero
## 1 20/02/2020 03:40:00    43881.15
## 2 20/02/2020 03:45:00    43881.16
## 3 20/02/2020 03:50:00    43881.16
## 4 20/02/2020 03:55:00    43881.16
## 5 20/02/2020 04:00:00    43881.17</code></pre>
<p></p>
<!--chapter:end:12-variaveis-tempo.Rmd-->
</div>
</div>
<div id="part-funções-e-loops-construindo-os-seus-próprios-programas-e-automatizando-tarefas" class="section level1 unnumbered">
<h1 class="unnumbered">(PART) Funções e <em>Loops</em>: construindo os seus próprios programas e automatizando tarefas</h1>
</div>
<div id="controle-condicional-de-fluxo" class="section level1" number="13">
<h1 number="13"><span class="header-section-number">13</span> Controle condicional de fluxo</h1>
<div id="introdução" class="section level2" number="13.1">
<h2 number="13.1"><span class="header-section-number">13.1</span> Introdução</h2>
<p>Haverá momentos em que você precisa tomar decisões em seu programa. A estrutura no R que te permite construir essas decisões, são os controles condicionais de fluxo. Nesse capítulo vamos rapidamente descrever o que são controles de fluxo, e focar logo em seguida, nos controles condicionais de fluxo. Apesar deles serem mais conhecidos por outros nomes, basicamente todas as linguagens de programação existentes oferecem tais controles e, por isso, eles fazem parte da base de praticamente todos os programas em uso no mundo.</p>
</div>
<div id="o-que-são-controles-de-fluxo" class="section level2" number="13.2">
<h2 number="13.2"><span class="header-section-number">13.2</span> O que são controles de fluxo ?</h2>
<p>Em ciência da computação, controle de fluxo (ou <em>control flow</em>) é a ordem na qual expressões (ou comandos) são avaliados em uma dada linguagem ou programa. Mas esse termo também é utilizado para se referir à estruturas que são capazes de alterar essa “ordem de avaliação” dos comandos executados por uma dada linguagem/programa. Nesse capítulo vamos descrever uma dessas estruturas que estão disponíveis na linguagem R.</p>
<p>No R, expressões são avaliadas de maneira sequencial (um comando atrás do outro). Mas a linguagem também nos oferece algumas estruturas que alteram a forma como essas expressões podem ser avaliadas. Tais estruturas são chamadas de “elementos de controle de fluxo” nos manuais internos da linguagem <span class="citation">(<a href="#ref-Rlanguage" role="doc-biblioref">R Core Team 2020b</a>)</span>, porém, elas são mais conhecidas dentro da comunidade de R (e da comunidade de programação em geral) por um conjunto de termos (<em>loops</em>, <code>if/else</code> <em>statements</em>, <em>exception handling</em>, dentre outros).</p>
<p>Estes “elementos de controle de fluxo” são estruturas especiais criadas a partir de palavras-chave (funções também se encaixam nessa categoria), e que utilizam um par de chaves (<code>{}</code>) para delimitar o conjunto de comandos sobre o qual essa estrutura vai atuar. Ao contornarmos esses comandos com um par de chaves, formamos o “corpo” (ou o <em>body</em>) dessa estrutura. Logo abaixo, temos uma lista dos “elementos de controle de fluxo” presentes no R. Para além dos elementos listados abaixo, temos algumas outras palavras-chave que ocorrem dentro dessas estruturas, e que também alteram a forma como o fluxo de comandos ocorre, como as palavras-chave <code>next</code> e <code>break</code>, as quais podem ser utilizadas dentro de algum <em>loop</em>.</p>
<p></p>
<div class="sourceCode" id="cb1397"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1397-1"><a href="#cb1397-1" aria-hidden="true" tabindex="-1"></a><span class="do">### if statement</span></span>
<span id="cb1397-2"><a href="#cb1397-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> ( cond ) {</span>
<span id="cb1397-3"><a href="#cb1397-3" aria-hidden="true" tabindex="-1"></a>  expr</span>
<span id="cb1397-4"><a href="#cb1397-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1397-5"><a href="#cb1397-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1397-6"><a href="#cb1397-6" aria-hidden="true" tabindex="-1"></a><span class="do">### if else statement</span></span>
<span id="cb1397-7"><a href="#cb1397-7" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> ( cond ) {</span>
<span id="cb1397-8"><a href="#cb1397-8" aria-hidden="true" tabindex="-1"></a>  expr1</span>
<span id="cb1397-9"><a href="#cb1397-9" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb1397-10"><a href="#cb1397-10" aria-hidden="true" tabindex="-1"></a>  expr2</span>
<span id="cb1397-11"><a href="#cb1397-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1397-12"><a href="#cb1397-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1397-13"><a href="#cb1397-13" aria-hidden="true" tabindex="-1"></a><span class="do">### while loop</span></span>
<span id="cb1397-14"><a href="#cb1397-14" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> ( cond ) {</span>
<span id="cb1397-15"><a href="#cb1397-15" aria-hidden="true" tabindex="-1"></a>  expr</span>
<span id="cb1397-16"><a href="#cb1397-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1397-17"><a href="#cb1397-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1397-18"><a href="#cb1397-18" aria-hidden="true" tabindex="-1"></a><span class="do">### repeat loop</span></span>
<span id="cb1397-19"><a href="#cb1397-19" aria-hidden="true" tabindex="-1"></a><span class="cf">repeat</span> {</span>
<span id="cb1397-20"><a href="#cb1397-20" aria-hidden="true" tabindex="-1"></a>  expr</span>
<span id="cb1397-21"><a href="#cb1397-21" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1397-22"><a href="#cb1397-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1397-23"><a href="#cb1397-23" aria-hidden="true" tabindex="-1"></a><span class="do">### for loop</span></span>
<span id="cb1397-24"><a href="#cb1397-24" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ( var <span class="cf">in</span> list ) {</span>
<span id="cb1397-25"><a href="#cb1397-25" aria-hidden="true" tabindex="-1"></a>  expr</span>
<span id="cb1397-26"><a href="#cb1397-26" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p></p>
<p>Muitas linguagens de programação oferecem ao menos 3 categorias principais de controles de fluxo, sendo elas: 1) controles condicionais, ou, controles de escolha (<code>if/else</code> <em>statements</em>); 2) controles de iteração (<em>loops</em>); 3) controles de exceções (<em>exception handling</em>). No R, todas essas categorias estão presentes. Entretanto, os controles de exceções estão disponíveis através de funções (como <code>try()</code> e <code>tryCatch()</code>), enquanto os demais tipos de controles são empregados através das estruturas especiais que mencionamos, que são formadas por palavras-chave (como <code>if</code>, <code>for</code>, <code>while</code>, etc.). O foco deste capítulo são os controles de escolha. Por isso, os controles de iteração e de exceções serão descritos em capítulos posteriores.</p>
</div>
<div id="o-que-são-controles-condicionais-de-fluxo" class="section level2" number="13.3">
<h2 number="13.3"><span class="header-section-number">13.3</span> O que são controles condicionais de fluxo ?</h2>
<p>Um controle condicional de fluxo (ou controle de escolha) lhe permite executar ou ignorar um determinado bloco de comandos com base em uma condição lógica. Dito de outra forma, um controle de escolha vai utilizar o resultado de um teste lógico, para decidir sobre executar ou não um determinado bloco de comandos. Muitos programadores e profissionais da ciência da computação em geral, conhecem os controles condicionais de fluxo pelo termo <em>“branching”</em>.</p>
<p>Nós utilizamos esse tipo de controle de fluxo, toda vez que encontramos uma bifurcação em nosso programa, e precisamos decidir sobre qual dos dois caminhos seguir. Por exemplo, suponha que eu tenha uma variável <code>x</code> em minha sessão, e que eu gostaria que o R me mostrasse no console, uma mensagem para o caso do valor dessa variável ser maior que 10, e, uma outra mensagem para o caso desse valor ser menor que 10. Tal mecanismo de mensagens poderia ser implementado da seguinte forma:</p>
<p></p>
<div class="sourceCode" id="cb1398"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1398-1"><a href="#cb1398-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb1398-2"><a href="#cb1398-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1398-3"><a href="#cb1398-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (x <span class="sc">&gt;</span> <span class="dv">10</span>) {</span>
<span id="cb1398-4"><a href="#cb1398-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">&quot;x é maior que 10!&quot;</span>)</span>
<span id="cb1398-5"><a href="#cb1398-5" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb1398-6"><a href="#cb1398-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">&quot;x é menor que 10!&quot;</span>)</span>
<span id="cb1398-7"><a href="#cb1398-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## [1] &quot;x é menor que 10!&quot;</code></pre>
<p></p>
<p>Um controle de escolha é sempre iniciado pela palavra-chave <code>if</code>, e pode ou não incluir uma palavra-chave <code>else</code> em seguida. Sendo assim, após a palavra <code>if</code>, devemos abrir um par de parênteses, e incluir dentro deles, algum teste lógico (ou um objeto que contenha um valor lógico). Depois, abrimos um par de chaves, e incluímos dentro delas, os comandos a serem executados caso o resultado do teste lógico seja <code>TRUE</code> (no exemplo acima, esse comando é <code>print("x é maior que 10!")</code>). Se você deseja que um outro conjunto de comandos sejam executados, para a hipótese do teste lógico retornar o valor <code>FALSE</code>, basta adicionar a palavra-chave <code>else</code> e abrir um novo par de chaves e incluir esse outro conjunto de comandos (no exemplo acima, esse outro comando é <code>print("x é menor que 10!")</code>) dentro delas.</p>
<p>Tendo isso em mente, e observando o resultado dos comandos acima, podemos concluir que o resultado do teste lógico <code>x &gt; 10</code> foi igual a <code>FALSE</code>, e que por isso, o R ignorou completamente o comando armazenado no primeiro par de chaves, e executou o comando definido no segundo par de chaves que está conectada pela palavra-chave <code>else</code>.</p>
<p>Portanto, olhando agora para o <em>template</em> abaixo, quando o R encontrar em seu <em>script</em> esse tipo de estrutura iniciada pela palavra <code>if</code>, ele vai primeiro, avaliar o resultado da condição lógica descrita em <code>condicao</code>. Caso o resultado desse teste seja <code>TRUE</code>, o R vai executar os comandos presentes no primeiro par de chaves. Mas caso o resultado desse teste seja <code>FALSE</code>, o R vai ignorar os comandos presentes no primeiro par de chaves, e também, vai verificar se você adicionou uma palavra <code>else</code> após esse primeiro par de chaves. Caso você tenha adicionado essa palavra, o R vai executar os comandos inseridos no par de chaves que está logo após essa palavra <code>else</code>. Vale destacar que, o resultado de <code>condicao</code> deve ser um único valor lógico (<code>TRUE</code> ou <code>FALSE</code>). Caso o resultado de <code>condicao</code> seja um vetor de valores lógicos, <code>if</code> vai utilizar apenas o primeiro valor desse vetor para realizar suas escolhas <span class="citation">(<a href="#ref-grolemund2014" role="doc-biblioref">Grolemund 2014</a>)</span>.</p>
<p></p>
<div class="sourceCode" id="cb1400"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1400-1"><a href="#cb1400-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(condicao){</span>
<span id="cb1400-2"><a href="#cb1400-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># se `condicao` for verdadeira</span></span>
<span id="cb1400-3"><a href="#cb1400-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># execute esses comandos</span></span>
<span id="cb1400-4"><a href="#cb1400-4" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb1400-5"><a href="#cb1400-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># se `condicao` não for verdadeira</span></span>
<span id="cb1400-6"><a href="#cb1400-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># execute esses comandos</span></span>
<span id="cb1400-7"><a href="#cb1400-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p></p>
<p>Descrevendo ainda de outra maneira, e utilizando o <em>template</em> abaixo, se o resultado de <code>condicao</code> for <code>TRUE</code>, o R vai executar os comandos descritos na área <code>comandos1</code>, e vai ignorar completamente os comandos descritos na área <code>comandos2</code>. Por outro lado, se o resultado de <code>condicao</code> for <code>FALSE</code>, o contrário ocorre, logo, o R ignora os comandos descritos em <code>comandos1</code> e executa os comandos descritos em <code>comandos2</code>. Dessa forma, um <code>if</code> <em>statement</em> é uma maneira de dizermos para o R realizar uma tarefa específica para um caso específico. Em português, um <code>if</code> <em>statement</em> pode ser traduzido como “Caso isso seja verdadeiro, faça isso, caso contrário, faça aquilo” <span class="citation">(<a href="#ref-grolemund2014" role="doc-biblioref">Grolemund 2014</a>)</span>.</p>
<p></p>
<div class="sourceCode" id="cb1401"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1401-1"><a href="#cb1401-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(condicao){</span>
<span id="cb1401-2"><a href="#cb1401-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># comandos1</span></span>
<span id="cb1401-3"><a href="#cb1401-3" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb1401-4"><a href="#cb1401-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># comandos2</span></span>
<span id="cb1401-5"><a href="#cb1401-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p></p>
<p>Você pode incluir em cada área (<code>comandos1</code> e <code>comandos2</code>) quantas linhas de comandos forem necessárias. Porém, pelo fato de um teste lógico produzir apenas dois valores possíveis (<code>TRUE</code> e <code>FALSE</code>), com 1 combinação de <code>if</code> e <code>else</code>, você é capaz de construir apenas dois blocos de comandos, ou duas possibilidades de execução. Caso você queira adicionar mais blocos possíveis de serem executados, formando uma espécie de “árvore de possibilidades,” você precisa adicionar um novo <code>if</code> após o <code>else</code>, como no exemplo abaixo:</p>
<p></p>
<div class="sourceCode" id="cb1402"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1402-1"><a href="#cb1402-1" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb1402-2"><a href="#cb1402-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1402-3"><a href="#cb1402-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(y <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb1402-4"><a href="#cb1402-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">&quot;y é igual a 1&quot;</span>)</span>
<span id="cb1402-5"><a href="#cb1402-5" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> <span class="cf">if</span>(y <span class="sc">==</span> <span class="dv">2</span>){</span>
<span id="cb1402-6"><a href="#cb1402-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">&quot;y é igual a 2&quot;</span>)</span>
<span id="cb1402-7"><a href="#cb1402-7" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> <span class="cf">if</span>(y <span class="sc">==</span> <span class="dv">3</span>){</span>
<span id="cb1402-8"><a href="#cb1402-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">&quot;y é igual a 3&quot;</span>)</span>
<span id="cb1402-9"><a href="#cb1402-9" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> <span class="cf">if</span>(y <span class="sc">==</span> <span class="dv">4</span>){</span>
<span id="cb1402-10"><a href="#cb1402-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">&quot;y é igual a 4&quot;</span>)</span>
<span id="cb1402-11"><a href="#cb1402-11" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb1402-12"><a href="#cb1402-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">&quot;Não sei o que y é&quot;</span>)</span>
<span id="cb1402-13"><a href="#cb1402-13" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## [1] &quot;y é igual a 4&quot;</code></pre>
<div class="sourceCode" id="cb1404"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1404-1"><a href="#cb1404-1" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="st">&quot;a&quot;</span></span>
<span id="cb1404-2"><a href="#cb1404-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1404-3"><a href="#cb1404-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(y <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb1404-4"><a href="#cb1404-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">&quot;y é igual a 1&quot;</span>)</span>
<span id="cb1404-5"><a href="#cb1404-5" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> <span class="cf">if</span>(y <span class="sc">==</span> <span class="dv">2</span>){</span>
<span id="cb1404-6"><a href="#cb1404-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">&quot;y é igual a 2&quot;</span>)</span>
<span id="cb1404-7"><a href="#cb1404-7" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> <span class="cf">if</span>(y <span class="sc">==</span> <span class="dv">3</span>){</span>
<span id="cb1404-8"><a href="#cb1404-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">&quot;y é igual a 3&quot;</span>)</span>
<span id="cb1404-9"><a href="#cb1404-9" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> <span class="cf">if</span>(y <span class="sc">==</span> <span class="dv">4</span>){</span>
<span id="cb1404-10"><a href="#cb1404-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">&quot;y é igual a 4&quot;</span>)</span>
<span id="cb1404-11"><a href="#cb1404-11" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb1404-12"><a href="#cb1404-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">&quot;Não sei o que y é&quot;</span>)</span>
<span id="cb1404-13"><a href="#cb1404-13" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## [1] &quot;Não sei o que y é&quot;</code></pre>
<p></p>
<p>Contudo, quando você possui mais de duas possibilidades, como no exemplo acima, o seu código geralmente fica mais organizado e legível, quando você utiliza vários <code>if</code>’s individuais para cada caso, como demonstrado abaixo:</p>
<p></p>
<div class="sourceCode" id="cb1406"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1406-1"><a href="#cb1406-1" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="st">&quot;a&quot;</span></span>
<span id="cb1406-2"><a href="#cb1406-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1406-3"><a href="#cb1406-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(y <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb1406-4"><a href="#cb1406-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">&quot;y é igual a 1&quot;</span>)</span>
<span id="cb1406-5"><a href="#cb1406-5" aria-hidden="true" tabindex="-1"></a>} </span>
<span id="cb1406-6"><a href="#cb1406-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1406-7"><a href="#cb1406-7" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(y <span class="sc">==</span> <span class="dv">2</span>){</span>
<span id="cb1406-8"><a href="#cb1406-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">&quot;y é igual a 2&quot;</span>)</span>
<span id="cb1406-9"><a href="#cb1406-9" aria-hidden="true" tabindex="-1"></a>} </span>
<span id="cb1406-10"><a href="#cb1406-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1406-11"><a href="#cb1406-11" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(y <span class="sc">==</span> <span class="dv">3</span>){</span>
<span id="cb1406-12"><a href="#cb1406-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">&quot;y é igual a 3&quot;</span>)</span>
<span id="cb1406-13"><a href="#cb1406-13" aria-hidden="true" tabindex="-1"></a>} </span>
<span id="cb1406-14"><a href="#cb1406-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1406-15"><a href="#cb1406-15" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(y <span class="sc">==</span> <span class="dv">4</span>){</span>
<span id="cb1406-16"><a href="#cb1406-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">&quot;y é igual a 4&quot;</span>)</span>
<span id="cb1406-17"><a href="#cb1406-17" aria-hidden="true" tabindex="-1"></a>} </span></code></pre></div>
<p></p>
<p>Perceba que, quando você não utiliza a palavra-chave <code>else</code>, o R vai executar uma ação se, e somente se o resultado do teste lógico descrito em <code>if</code> for <code>TRUE</code>. Pois sem a palavra-chave <code>else</code>, você basicamente não deu ao R, nenhuma ação a ser executada para o caso do teste lógico resultar em <code>FALSE</code>. Por isso que no exemplo acima, nenhuma das mensagens com <code>print()</code> foram executadas. Pois os testes lógicos de todos os <code>if</code>’s acima, resultaram em <code>FALSE</code>.</p>
</div>
<div id="a-função-switch-como-uma-alternativa-interessante" class="section level2" number="13.4">
<h2 number="13.4"><span class="header-section-number">13.4</span> A função <code>switch()</code> como uma alternativa interessante</h2>
<p>No R, temos uma função que executa um controle de fluxo semelhante ao realizado por <code>if</code> e <code>else</code>, que é a função <code>switch()</code>. Porém, ao invés de utilizar o resultado de um teste lógico, essa função utiliza uma <em>string</em> ou um índice numérico para selecionar e executar um dos blocos de comandos listados.</p>
<p>Por exemplo, logo abaixo, eu forneço à função <code>switch()</code> o objeto <code>y</code>, o qual contém a <em>string</em> <code>"fruit"</code>. Ao receber esse valor, <code>switch()</code> começa a procurar por alguma opção listada cujo o nome seja igual a essa <em>string</em>. Ao se deparar com <code>fruit = "banana"</code>, <code>switch()</code> pega a expressão guardada nessa opção (nesse caso, a <em>string</em> <code>"banana"</code>) e a executa. Já no segundo bloco, o objeto <code>y</code> agora guarda a <em>string</em> <code>"meat"</code>, e assim, a função <code>switch()</code> procura novamente por uma opção listada que possua esse nome. Porém, ela não encontra nenhuma opção com o nome <code>meat</code>, e, por isso, ela acaba executando a expressão “geral” (a qual não está conectada a nenhum “nome” específico).</p>
<p></p>
<div class="sourceCode" id="cb1407"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1407-1"><a href="#cb1407-1" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="st">&quot;fruit&quot;</span></span>
<span id="cb1407-2"><a href="#cb1407-2" aria-hidden="true" tabindex="-1"></a><span class="cf">switch</span>(y, <span class="at">fruit =</span> <span class="st">&quot;banana&quot;</span>, <span class="at">vegetable =</span> <span class="st">&quot;broccoli&quot;</span>, <span class="st">&quot;Neither&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;banana&quot;</code></pre>
<div class="sourceCode" id="cb1409"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1409-1"><a href="#cb1409-1" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="st">&quot;meat&quot;</span></span>
<span id="cb1409-2"><a href="#cb1409-2" aria-hidden="true" tabindex="-1"></a><span class="cf">switch</span>(y, <span class="at">fruit =</span> <span class="st">&quot;banana&quot;</span>, <span class="at">vegetable =</span> <span class="st">&quot;broccoli&quot;</span>, <span class="st">&quot;Neither&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;Neither&quot;</code></pre>
<p></p>
<p>Portanto, quando fornecemos uma <em>string</em> à <code>switch()</code>, a função procura por uma opção listada que possua um nome igual a essa <em>string</em>. Caso <code>switch()</code> encontre essa opção, a função vai executar a expressão que foi dada a essa opção. Vale destacar que essa expressão pode ser qualquer coisa, uma constante, uma função ou uma expressão que cria um novo objeto (<code>nome_objeto &lt;- valor</code>).</p>
<p></p>
<div class="sourceCode" id="cb1411"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1411-1"><a href="#cb1411-1" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="st">&quot;média&quot;</span></span>
<span id="cb1411-2"><a href="#cb1411-2" aria-hidden="true" tabindex="-1"></a><span class="cf">switch</span>(y, média <span class="ot">=</span> <span class="fu">mean</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>), <span class="at">soma =</span> <span class="fu">sum</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>), <span class="st">&quot;Não encontrei a função&quot;</span>)</span></code></pre></div>
<pre><code>## [1] 5.5</code></pre>
<div class="sourceCode" id="cb1413"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1413-1"><a href="#cb1413-1" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="st">&quot;soma&quot;</span></span>
<span id="cb1413-2"><a href="#cb1413-2" aria-hidden="true" tabindex="-1"></a><span class="cf">switch</span>(y, média <span class="ot">=</span> <span class="fu">mean</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>), <span class="at">soma =</span> <span class="fu">sum</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>), <span class="st">&quot;Não encontrei a função&quot;</span>)</span></code></pre></div>
<pre><code>## [1] 55</code></pre>
<div class="sourceCode" id="cb1415"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1415-1"><a href="#cb1415-1" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="st">&quot;divisão&quot;</span></span>
<span id="cb1415-2"><a href="#cb1415-2" aria-hidden="true" tabindex="-1"></a><span class="cf">switch</span>(y, média <span class="ot">=</span> <span class="fu">mean</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>), <span class="at">soma =</span> <span class="fu">sum</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>), <span class="st">&quot;Não encontrei a função&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;Não encontrei a função&quot;</code></pre>
<p></p>
<p>Uma outra forma de selecionar a expressão a ser executada em <code>switch()</code> é fonecer o índice númerico que representa essa expressão. Ou seja, se eu quero executar a primeira expressão listada, eu forneço o número 1, se eu quero executar a segunda expressão listada, eu forneço o número 2, e assim por diante.</p>
<p></p>
<div class="sourceCode" id="cb1417"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1417-1"><a href="#cb1417-1" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb1417-2"><a href="#cb1417-2" aria-hidden="true" tabindex="-1"></a><span class="cf">switch</span>(y, <span class="fu">mean</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>), <span class="fu">sum</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>), <span class="st">&quot;Não encontrei a função&quot;</span>)</span></code></pre></div>
<pre><code>## [1] 55</code></pre>
<p></p>
</div>
<div id="em-certas-ocasiões-é-melhor-evitar-uma-árvore-de-ifs-através-de-subsetting" class="section level2" number="13.5">
<h2 number="13.5"><span class="header-section-number">13.5</span> Em certas ocasiões, é melhor evitar uma árvore de <code>if</code>’s através de <em>subsetting</em></h2>
<p>Nós utilizamos um controle de escolha para escolher que caminho perseguir em uma determinada parte de nosso programa. Entretanto, muitos usuários podem acabar utilizando <code>if</code> <em>statements</em> de uma forma não produtiva, ou ineficiente. Tenha atenção com isso. Se você está utilizando vários <code>if</code>/<code>else</code> em seu código, você provavelmente consegue refatorar esses comandos, em um formato mais claro e eficiente.</p>
<p>Isso se torna um ponto ainda mais crítico quando você está tentando lidar com várias possibilidades diferentes. Pois, apesar dos controles de escolha do R serem bastante rápidos, quando temos uma árvore muito grande de <code>if</code>’s, várias verificações lógicas precisam ser avaliadas e, com isso, ineficiências podem surgir em seu programa de maneira desnecessária. Uma das conclusões fundamentais de <span class="citation"><a href="#ref-grolemund2014" role="doc-biblioref">Grolemund</a> (<a href="#ref-grolemund2014" role="doc-biblioref">2014</a>)</span> na Parte 3 de sua obra, é que podemos quase sempre evitar esse efeito danoso, ao substituirmos nossa árvore de <code>if</code>’s por um sistema que utiliza <em>subsetting</em> sobre algum objeto de consulta que contém todas as possibilidades.</p>
<p>Por exemplo, suponha que você esteja construindo um programa que simula uma máquina caça-níquel. Quando você aciona a máquina, três símbolos são sorteados, dentre as opções “D” (diamante), “C” (cereja), “B” (banana), “G” (ouro). Caso os três símbolos seja iguais entre si, você ganha um prêmio, com base em que símbolos são esses. Suponha que 3 diamantes geram R$1000 de prêmio, enquanto 3 cerejas, 3 bananas e 3 ouros levam a prêmios de R$200, R$100 e R$600, respectivamente.</p>
<p>Portanto, nesse programa, temos um comando que sorteia o <code>resultado</code> da máquina caça-níquel, e uma outra parte, que decide qual o valor do <code>premio</code> com base nesse <code>resultado</code> sorteado. Esse é provavelmente o caso mais típico de uso indevido de um <code>if</code>/<code>else</code> <em>statements</em>, em que você está tentando determinar o valor correto de uma variável (no caso abaixo, <code>premio</code>) que pode assumir diferentes valores a depender de uma ou de várias condições lógicas.</p>
<p></p>
<div class="sourceCode" id="cb1419"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1419-1"><a href="#cb1419-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Sorteando os símbolos:</span></span>
<span id="cb1419-2"><a href="#cb1419-2" aria-hidden="true" tabindex="-1"></a>resultado <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">&quot;D&quot;</span>, <span class="st">&quot;C&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;G&quot;</span>), <span class="dv">3</span>), <span class="at">collapse =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb1419-3"><a href="#cb1419-3" aria-hidden="true" tabindex="-1"></a>resultado</span></code></pre></div>
<pre><code>## [1] &quot;CGB&quot;</code></pre>
<div class="sourceCode" id="cb1421"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1421-1"><a href="#cb1421-1" aria-hidden="true" tabindex="-1"></a>premio <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb1421-2"><a href="#cb1421-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1421-3"><a href="#cb1421-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(resultado <span class="sc">==</span> <span class="st">&quot;DDD&quot;</span>){</span>
<span id="cb1421-4"><a href="#cb1421-4" aria-hidden="true" tabindex="-1"></a>  premio <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb1421-5"><a href="#cb1421-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1421-6"><a href="#cb1421-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1421-7"><a href="#cb1421-7" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(resultado <span class="sc">==</span> <span class="st">&quot;CCC&quot;</span>){</span>
<span id="cb1421-8"><a href="#cb1421-8" aria-hidden="true" tabindex="-1"></a>  premio <span class="ot">&lt;-</span> <span class="dv">200</span></span>
<span id="cb1421-9"><a href="#cb1421-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1421-10"><a href="#cb1421-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1421-11"><a href="#cb1421-11" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(resultado <span class="sc">==</span> <span class="st">&quot;BBB&quot;</span>){</span>
<span id="cb1421-12"><a href="#cb1421-12" aria-hidden="true" tabindex="-1"></a>  premio <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb1421-13"><a href="#cb1421-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1421-14"><a href="#cb1421-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1421-15"><a href="#cb1421-15" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(resultado <span class="sc">==</span> <span class="st">&quot;GGG&quot;</span>){</span>
<span id="cb1421-16"><a href="#cb1421-16" aria-hidden="true" tabindex="-1"></a>  premio <span class="ot">&lt;-</span> <span class="dv">600</span></span>
<span id="cb1421-17"><a href="#cb1421-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1421-18"><a href="#cb1421-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1421-19"><a href="#cb1421-19" aria-hidden="true" tabindex="-1"></a><span class="do">### Vendo qual foi o prêmio da rodada:</span></span>
<span id="cb1421-20"><a href="#cb1421-20" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(premio)</span></code></pre></div>
<pre><code>## [1] 0</code></pre>
<p></p>
<p>Um método muito mais eficiente de se resolver um problema como esse, seria criarmos um vetor de consulta (ou <em>lookup vector</em>) com os valores de cada prêmio. Para criar um vetor como esse, nós armazenamos os prêmios em um vetor comum, e utilizamos a função <code>names()</code> para nomearmos cada um desses valores com o respectivo resultado que o representa. Dessa forma, ao sortearmos o resultado do caça-níquel, utilizamos esse resultado como uma <em>key</em> dentro da função de <em>subsetting</em> (<code>[</code>). No exemplo abaixo, estamos fazendo isso com o comando <code>premios[resultado]</code>. Assim, o R vai procurar por um prêmio dentro do vetor <code>premios</code> que contém o mesmo nome que essa <em>key</em>.</p>
<p></p>
<div class="sourceCode" id="cb1423"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1423-1"><a href="#cb1423-1" aria-hidden="true" tabindex="-1"></a>premios <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1000</span>, <span class="dv">200</span>, <span class="dv">100</span>, <span class="dv">600</span>)</span>
<span id="cb1423-2"><a href="#cb1423-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(premios) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;DDD&quot;</span>, <span class="st">&quot;CCC&quot;</span>, <span class="st">&quot;BBB&quot;</span>, <span class="st">&quot;GGG&quot;</span>)</span>
<span id="cb1423-3"><a href="#cb1423-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(premios)</span></code></pre></div>
<pre><code>##  DDD  CCC  BBB  GGG 
## 1000  200  100  600</code></pre>
<div class="sourceCode" id="cb1425"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1425-1"><a href="#cb1425-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Sorteando o resultado</span></span>
<span id="cb1425-2"><a href="#cb1425-2" aria-hidden="true" tabindex="-1"></a>resultado <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">&quot;D&quot;</span>, <span class="st">&quot;C&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;G&quot;</span>), <span class="dv">3</span>), <span class="at">collapse =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb1425-3"><a href="#cb1425-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(resultado)</span></code></pre></div>
<pre><code>## [1] &quot;BGD&quot;</code></pre>
<div class="sourceCode" id="cb1427"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1427-1"><a href="#cb1427-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Calculando o prêmio</span></span>
<span id="cb1427-2"><a href="#cb1427-2" aria-hidden="true" tabindex="-1"></a>premio <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="dv">0</span>, premios[resultado], <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1427-3"><a href="#cb1427-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(premio)</span></code></pre></div>
<pre><code>## [1] 0</code></pre>
<p></p>
<p>Assim como em que qualquer outra linguagem, você pode reescrever uma sentença de várias formas diferentes, sem afetar o seu significado. Porém, quando estamos tratando de linguagens de programação, certos padrões de escrita tendem a ser mais claros e eficientes do que outros. O padrão de escrita mostrado acima, em que estamos tentando determinar o valor correto de uma variável, pode ser quase sempre resumido por essa estratégia em que criamos um objeto de consulta contendo todas as possibilidades, e utilizamos a função de <em>subsetting</em> (<code>[</code>) para selecionarmos a possibilidade correta.</p>
<p>Entenda que, esse “valor correto” pode ser qualquer coisa (um <code>character</code>, um <code>double</code>, uma função, o nome de um arquivo, etc.) que o R te permite definir. Como exemplo, suponha que você receba múltiplos valores numéricos individuais, e que esses valores numéricos são acompanhados de um rótulo. Esse rótulo faz referência a um indicador específico.</p>
<p>Vamos supor que temos apenas 3 indicadores diferentes: nota média de atendimento (identificado pelo rótulo <code>"nma"</code>), tempo médio de atendimento (identificado pelo rótulo <code>"tma"</code>) e índice de conclusão de tickets (identificado pelo rótulo <code>"ict"</code>). Cada um desses 3 indicadores utilizam uma unidade diferente, ou, em outras palavras, eles são apresentados em formatos diferentes. Por exemplo, o indicador <code>tma</code> é um indicador de tempo, logo, ele pode ser apresentado no formato <code>HH:MM:SS</code>. Por outro lado, o indicador <code>ict</code> é uma proporção de quantos tickets foram concluídos, logo, ele seria apresentado como uma porcentagem <code>VV,VV%</code>.</p>
<p>Portanto, a depender do rótulo associado ao valor numérico que eu recebo, eu preciso formatar esse valor numérico de uma determinada maneira. Poderíamos organizar essas diferentes maneiras de se apresentar um determinado indicador em diferentes funções de “formatos.” Tais funções estão representadas abaixo. Todas elas esperam receber como <em>input</em>, um valor numérico qualquer, e elas produzem como <em>output</em>, uma representação em texto desse valor numérico no formato ideal para o indicador a que esse valor se refere.</p>
<p></p>
<div class="sourceCode" id="cb1429"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1429-1"><a href="#cb1429-1" aria-hidden="true" tabindex="-1"></a>format_percent <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb1429-2"><a href="#cb1429-2" aria-hidden="true" tabindex="-1"></a>  rn <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">as.double</span>(x) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>)</span>
<span id="cb1429-3"><a href="#cb1429-3" aria-hidden="true" tabindex="-1"></a>  rn <span class="ot">&lt;-</span> <span class="fu">format</span>(rn, <span class="at">decimal.mark =</span> <span class="st">&quot;,&quot;</span>, <span class="at">big.mark =</span> <span class="st">&quot;.&quot;</span>)</span>
<span id="cb1429-4"><a href="#cb1429-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(rn, <span class="st">&quot;%&quot;</span>, <span class="at">collapse =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb1429-5"><a href="#cb1429-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1429-6"><a href="#cb1429-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1429-7"><a href="#cb1429-7" aria-hidden="true" tabindex="-1"></a>format_double <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb1429-8"><a href="#cb1429-8" aria-hidden="true" tabindex="-1"></a>  rn <span class="ot">&lt;-</span> <span class="fu">as.double</span>(x)</span>
<span id="cb1429-9"><a href="#cb1429-9" aria-hidden="true" tabindex="-1"></a>  rn <span class="ot">&lt;-</span> <span class="fu">round</span>(rn, <span class="dv">2</span>)</span>
<span id="cb1429-10"><a href="#cb1429-10" aria-hidden="true" tabindex="-1"></a>  rn <span class="ot">&lt;-</span> <span class="fu">format</span>(rn, <span class="at">decimal.mark =</span> <span class="st">&quot;,&quot;</span>, <span class="at">big.mark =</span> <span class="st">&quot;.&quot;</span>)</span>
<span id="cb1429-11"><a href="#cb1429-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(rn)</span>
<span id="cb1429-12"><a href="#cb1429-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1429-13"><a href="#cb1429-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1429-14"><a href="#cb1429-14" aria-hidden="true" tabindex="-1"></a>format_hour <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb1429-15"><a href="#cb1429-15" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">as.double</span>(x)</span>
<span id="cb1429-16"><a href="#cb1429-16" aria-hidden="true" tabindex="-1"></a>  H <span class="ot">&lt;-</span> <span class="fu">as.integer</span>( <span class="fu">abs</span>(n) <span class="sc">/</span> <span class="dv">3600</span> )</span>
<span id="cb1429-17"><a href="#cb1429-17" aria-hidden="true" tabindex="-1"></a>  M <span class="ot">&lt;-</span> <span class="fu">as.integer</span>( (<span class="fu">abs</span>(n) <span class="sc">/</span> <span class="dv">60</span>) <span class="sc">-</span> (H <span class="sc">*</span> <span class="dv">60</span>) )</span>
<span id="cb1429-18"><a href="#cb1429-18" aria-hidden="true" tabindex="-1"></a>  S <span class="ot">&lt;-</span> <span class="fu">as.integer</span>( <span class="fu">abs</span>(n) <span class="sc">-</span> (M <span class="sc">*</span> <span class="dv">60</span>) <span class="sc">-</span> (H <span class="sc">*</span> <span class="dv">3600</span>) )</span>
<span id="cb1429-19"><a href="#cb1429-19" aria-hidden="true" tabindex="-1"></a>  H <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(H <span class="sc">&lt;</span> <span class="dv">10</span>, <span class="fu">paste0</span>(<span class="st">&quot;0&quot;</span>, <span class="fu">as.character</span>(H), <span class="at">collapse =</span> <span class="st">&quot;&quot;</span>), <span class="fu">as.character</span>(H))</span>
<span id="cb1429-20"><a href="#cb1429-20" aria-hidden="true" tabindex="-1"></a>  M <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(M <span class="sc">&lt;</span> <span class="dv">10</span>, <span class="fu">paste0</span>(<span class="st">&quot;0&quot;</span>, <span class="fu">as.character</span>(M), <span class="at">collapse =</span> <span class="st">&quot;&quot;</span>), <span class="fu">as.character</span>(M))</span>
<span id="cb1429-21"><a href="#cb1429-21" aria-hidden="true" tabindex="-1"></a>  S <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(S <span class="sc">&lt;</span> <span class="dv">10</span>, <span class="fu">paste0</span>(<span class="st">&quot;0&quot;</span>, <span class="fu">as.character</span>(S), <span class="at">collapse =</span> <span class="st">&quot;&quot;</span>), <span class="fu">as.character</span>(S))</span>
<span id="cb1429-22"><a href="#cb1429-22" aria-hidden="true" tabindex="-1"></a>  hour <span class="ot">&lt;-</span> <span class="fu">paste0</span>(H, <span class="st">&#39;:&#39;</span>, M, <span class="st">&#39;:&#39;</span>, S, <span class="at">collapse =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb1429-23"><a href="#cb1429-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(hour)</span>
<span id="cb1429-24"><a href="#cb1429-24" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p></p>
<p>Com essas funções em mãos, você poderia construir uma árvore de <code>if</code>’s que decidiria qual dessas funções aplicar sobre um determinado valor a depender do rótulo que o acompanha. Logo abaixo, temos um exemplo deste raciocínio:</p>
<p></p>
<div class="sourceCode" id="cb1430"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1430-1"><a href="#cb1430-1" aria-hidden="true" tabindex="-1"></a>valor <span class="ot">&lt;-</span> <span class="fl">560.258812</span></span>
<span id="cb1430-2"><a href="#cb1430-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(valor) <span class="ot">&lt;-</span> <span class="st">&quot;tma&quot;</span></span>
<span id="cb1430-3"><a href="#cb1430-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1430-4"><a href="#cb1430-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">names</span>(valor) <span class="sc">==</span> <span class="st">&quot;ict&quot;</span>){</span>
<span id="cb1430-5"><a href="#cb1430-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">format_percent</span>(valor)</span>
<span id="cb1430-6"><a href="#cb1430-6" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> </span>
<span id="cb1430-7"><a href="#cb1430-7" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">names</span>(valor) <span class="sc">==</span> <span class="st">&quot;tma&quot;</span>){</span>
<span id="cb1430-8"><a href="#cb1430-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">format_hour</span>(valor)</span>
<span id="cb1430-9"><a href="#cb1430-9" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span></span>
<span id="cb1430-10"><a href="#cb1430-10" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">names</span>(valor) <span class="sc">==</span> <span class="st">&quot;nma&quot;</span>){</span>
<span id="cb1430-11"><a href="#cb1430-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">format_double</span>(valor)</span>
<span id="cb1430-12"><a href="#cb1430-12" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## [1] &quot;00:09:20&quot;</code></pre>
<p></p>
<p>Entretanto, podemos facilmente refatorar esses comandos utilizando <em>subsetting</em>. Dessa forma, podemos armazenar as diferentes funções de formato dentro de uma lista e, em seguida, utilizarmos o rótulo que acompanha o valor em questão como uma <em>key</em> para acessarmos a função de formato correta dentro da lista de consulta (<code>funcoes_formato</code>), como está demonstrado abaixo:</p>
<p></p>
<div class="sourceCode" id="cb1432"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1432-1"><a href="#cb1432-1" aria-hidden="true" tabindex="-1"></a>funcoes_formato <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb1432-2"><a href="#cb1432-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;nma&quot;</span> <span class="ot">=</span> format_double,</span>
<span id="cb1432-3"><a href="#cb1432-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;ict&quot;</span> <span class="ot">=</span> format_percent,</span>
<span id="cb1432-4"><a href="#cb1432-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;tma&quot;</span> <span class="ot">=</span> format_hour</span>
<span id="cb1432-5"><a href="#cb1432-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1432-6"><a href="#cb1432-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1432-7"><a href="#cb1432-7" aria-hidden="true" tabindex="-1"></a>valor <span class="ot">&lt;-</span> <span class="fl">560.258812</span></span>
<span id="cb1432-8"><a href="#cb1432-8" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(valor) <span class="ot">&lt;-</span> <span class="st">&quot;tma&quot;</span></span>
<span id="cb1432-9"><a href="#cb1432-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1432-10"><a href="#cb1432-10" aria-hidden="true" tabindex="-1"></a>format_fun <span class="ot">&lt;-</span> funcoes_formato[[<span class="fu">names</span>(valor)]]</span>
<span id="cb1432-11"><a href="#cb1432-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1432-12"><a href="#cb1432-12" aria-hidden="true" tabindex="-1"></a><span class="fu">format_fun</span>(valor)</span></code></pre></div>
<pre><code>## [1] &quot;00:09:20&quot;</code></pre>
<p></p>
<p>Uma outra alternativa, seria utilizarmos a função <code>switch()</code> para reorganizarmos esse código:</p>
<p></p>
<div class="sourceCode" id="cb1434"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1434-1"><a href="#cb1434-1" aria-hidden="true" tabindex="-1"></a>valor <span class="ot">&lt;-</span> <span class="fl">560.258812</span></span>
<span id="cb1434-2"><a href="#cb1434-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(valor) <span class="ot">&lt;-</span> <span class="st">&quot;tma&quot;</span></span>
<span id="cb1434-3"><a href="#cb1434-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1434-4"><a href="#cb1434-4" aria-hidden="true" tabindex="-1"></a>ind <span class="ot">&lt;-</span> <span class="fu">names</span>(valor)</span>
<span id="cb1434-5"><a href="#cb1434-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1434-6"><a href="#cb1434-6" aria-hidden="true" tabindex="-1"></a>format_fun <span class="ot">&lt;-</span> <span class="cf">switch</span>(</span>
<span id="cb1434-7"><a href="#cb1434-7" aria-hidden="true" tabindex="-1"></a>  ind,</span>
<span id="cb1434-8"><a href="#cb1434-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;nma&quot;</span> <span class="ot">=</span> format_double,</span>
<span id="cb1434-9"><a href="#cb1434-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;ict&quot;</span> <span class="ot">=</span> format_percent,</span>
<span id="cb1434-10"><a href="#cb1434-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;tma&quot;</span> <span class="ot">=</span> format_hour</span>
<span id="cb1434-11"><a href="#cb1434-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1434-12"><a href="#cb1434-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1434-13"><a href="#cb1434-13" aria-hidden="true" tabindex="-1"></a><span class="fu">format_fun</span>(valor)</span></code></pre></div>
<pre><code>## [1] &quot;00:09:20&quot;</code></pre>
<p></p>
<!-- ## O que seria um uso adequado de controles condicionais de fluxo? -->
<!-- ### *Exit early as possible* -->
<!-- Um programa (ou *script*) do R é, em geral, construído a partir de um conjunto de funções. Essas funções coletam e utilizam vários *inputs* para produzirem um *output*. Contudo, para que toda função execute a sua tarefa para a qual ela foi desenvolvida, e da maneira adequada, essa função precisa muitas vezes que certas condições sejam satisfeitas. -->
<!-- Com a frase *exit early as possible* (ou, "saia o mais rápido possível") estou destacando a importância de conferirmos se essas condições são satisfeitas, e, caso seja necessário, pararmos o mais rápido possível a execução de uma função. Com isso em mente, essa frase poderia ser comparada com "primeiro de tudo, confirme que suas condições foram satisfeitas", ou ainda, "se algo estiver errado, pare imediatamente!". -->
<!-- Portanto, em qualquer função que você venha a desenvolver no R, é sempre uma boa ideia iniciar essa função com um conjunto de conferências sobre os seus *inputs*. Se os *inputs* fornecidos à essa função, tiverem todas as características e atributos que você espera que eles tenham, você tem maior certeza de que a sua função vai funcionar da maneira correta. Porém, se algum desses *inputs* não satisfezerem alguma dessas condições, a sua função pode não ser capaz de lidar com esse *input* da forma esperada. Por essa razão, talvez seja melhor pararmos a execução, e avisarmos ao usuário de que o *input* que ele forneceu não é adequado para essa função. -->
<!-- Algumas funções que apresentamos até aqui, seguem esse princípio. Um exemplo é a função `readxl::read_excel()`. Como descrevemos no capítulo [Importando e exportando dados com `readr`, `readxl` e `haven`](#sec:importando_dados), essa função serve para lermos planilhas do Excel (`.xlsx` ou `.xls`).  -->
<!-- Logo abaixo, temos o *body* dessa função, ou em outras palavras, os comandos que ela executa. Perceba abaixo que, a primeira coisa que essa função `read_excel()` faz é executar duas outras funções (`check_format()` e `check_file()`).  -->
<!-- ```{r} -->
<!-- body(readxl::read_excel) -->
<!-- ``` -->
<!-- Essas duas funções são responsáveis pelas conferências necessárias sobre o principal *input* da função (que é o argumento `path`). Ao observarmos o *body* de `check_file()`, podemos perceber que a função realiza duas conferências principais: 1) primeiro, ela se certifica que o caminho fornecido à `read_excel()` é uma string (com a função `readxl:::is_string()`), ou, em outras palavras, um valor do tipo `character`; 2) segundo, a função se certifica que o caminho fornecido à `read_excel()` é válido, isto é, se o arquivo descrito nesse caminho existe de fato em meu computador (com a função `file.exists()`).  -->
<!-- ```{r} -->
<!-- body(readxl:::check_file) -->
<!-- ``` -->
<!-- Por que essas conferências são necessárias? Primeiro, porque caminhos até arquivos e diretórios devem ser fornecidos como *strings* no R, assim como em diversas outras linguagens de programação. Segundo, porque eu posso muito bem entregar à função, um caminho imaginário, ou seja, um caminho que não existe em meu computador. O que `read_excel()` deveria fazer nesse caso? Se o caminho não existe, será que ela deveria sequer tentar encontrar e ler o arquivo descrito nesse caminho? Provavelmente, o melhor a se fazer nesse caso seria simplesmente interrompermos a execução de `read_excel()`, e avisarmos ao usuário que o caminho dado não existe no computador em questão.  -->
<!-- Este é exatamente o papel que a função `readxl:::check_file()` cumpre. Perceba acima que essa função utiliza um `if` *statement* para executar a função `stop()`, a depender do resultado de `!file.exists(path)`. Dessa forma, se a expressão `!file_exists(path)` retornar `FALSE`, significa que o arquivo descrito no *input* `path` existe em meu computador e, por isso, a função ignora completamente o comando `stop()` que está dentro do `if` *statement*. Porém, se a expressão `!file.exists(path)` retornar `TRUE`, o `if` *statement* vai executar o comando `stop()`, e toda a execução de `read_excel()` é interrompida com uma mensagem de erro, a qual avisa o usuário que o arquivo descrito em `path` não existe. -->
<!-- A função `readxl:::check_format()` realiza um trabalho parecido. Em resumo, essa função utiliza `readxl:::excel_format()` para determinar se o arquivo descrito em `path` é de fato uma planilha do Excel, isto é, se o arquivo possui extensão `.xslx` ou `.xls`. Em seguida, a função confere com a expressão `is.na(format)`, se a função `readxl:::excel_format()` conseguiu determinar o formato do arquivo. Caso não tenha, é muito provável que o arquivo descrito em `path` não seja uma planilha do Excel e, por esse motivo, a função executa o comando `stop()` que está dentro do `if` *statement*. -->
<!-- ```{r} -->
<!-- body(readxl:::check_format) -->
<!-- ``` -->
<!-- Portanto, sempre que você estiver desenvolvendo uma função (ou o seu *script* como um todo), reflita se há alguma condição que precisa ser aceita para que a sua função (ou o seu *script*) funcione de maneira adequada. Por exemplo, vamos supor que você possui em seu *script*, uma simples soma entre duas variáveis (como `x` e `y`).  -->
<!-- ```{r} -->
<!-- x <- 15 -->
<!-- y <- 5 -->
<!-- x + y -->
<!-- ``` -->
<!-- Existe alguma condição que precisa ser satisfeita, para que essa soma ocorra como esperado? Você pode rapidamente chegar à conclusão de que ambas as variáveis (`x` e `y`) devem conter valores numéricos. Logo, seria interessante incluírmos um `if` *statement* que nos avise caso essa condição não se sustente, como está demonstrado abaixo. -->
<!-- ```{r, eval = FALSE} -->
<!-- x <- 15 -->
<!-- y <- "5" -->
<!-- if(!is.numeric(x) | !is.numeric(y)){ -->
<!--   stop("Uma das variáveis (`x` ou `y`) não contém valores numéricos!") -->
<!-- }  -->
<!-- x + y -->
<!-- ``` -->
<!-- ``` -->
<!-- Error: Uma das variáveis (`x` ou `y`) não contém valores numéricos! -->
<!-- ``` -->
<!-- ### As vezes o seu código fica mais claro com uma árvore de `if`'s -->
<!-- ```{r} -->
<!-- fun <- getAnywhere(mutate.data.frame)[["objs"]][[1]] -->
<!-- body(fun) -->
<!-- ``` -->
<!--chapter:end:13-controle-fluxo.Rmd-->
</div>
</div>
<div id="funções" class="section level1" number="14">
<h1 number="14"><span class="header-section-number">14</span> Funções</h1>
<div id="sec:functions_chapter" class="section level2" number="14.1">
<h2 number="14.1"><span class="header-section-number">14.1</span> Introdução</h2>
<p>Cada pessoa possui necessidades diferentes em seu trabalho, e a grande vantagem de se utilizar uma linguagem de programação para executar esse trabalho, é que ela lhe fornece as ferramentas para que você mesmo possa expandi-la para satisfazer os seus próprios objetivos. E a base para tal expansão está na construção de funções.</p>
<p>No início, você pode ter bastante dificuldade de construir a função que você deseja. Há vários pontos que tornam esse processo difícil. Usuários que ainda não absorveram as principais características da linguagem apresentadas no capítulo de <a href="#sec:fundamentos_R">Fundamentos da Linguagem R</a>, podem ter muita dificuldade em identificar a origem de erros comuns em suas funções. Para mais, quando você executa uma determinada função, ela processa todas as suas tarefas em um ambiente diferente do seu. Isto significa que você não vê na maior parte do tempo, quais são os resultados que essa função está gerando, ou que objetos ela está criando, e tal situação nebulosa pode confundir muitos usuários.</p>
<p>Apesar dessas dificuldades, a capacidade de construir as suas próprias funções, amplia e muito os seus horizontes, ao permitir que você se aproprie da linguagem. Isto é, através de funções você é capaz de personalizar a linguagem R para que ela resolva especificamente os seus problemas, da maneira exata que você deseja que eles sejam resolvidos. Em outras palavras, apesar da linguagem R já lhe fornecer as principais ferramentas, ela também permite que você construa as suas próprias ferramentas para resolver problemas mais complexos ou mais específicos.</p>
<p>De certa forma, todos que realizam algum trabalho sério com o R, estão muito provavelmente expandindo a linguagem o tempo todo <span class="citation">(<a href="#ref-chambers2016" role="doc-biblioref">Chambers 2016</a>, p 3)</span>. Por isso, neste capítulo, vamos mostrar os primeiros passos para que você possa começar a montar as suas próprias funções. Vamos fornecer algumas dicas de como enfrentar erros, além de descrever as melhores formas de se organizar essas funções, para que você não se perca no meio do processo.</p>
</div>
<div id="em-que-momento-você-deve-construir-uma-função" class="section level2" number="14.2">
<h2 number="14.2"><span class="header-section-number">14.2</span> Em que momento você deve construir uma função ?</h2>
<p>Um bom guia é: se você copiar e colar um mesmo conjunto de comandos mais de 2 vezes, construa uma função para esses comandos! <span class="citation">(<a href="#ref-wickham2017" role="doc-biblioref">Wickham and Grolemund 2017</a>)</span>. Muitos usuários e programadores em geral conhecem essa regra como o princípio DRY - <em>do not repeat yourself!</em> (“não repita você mesmo!”). Portanto, se você utiliza constantemente um mesmo conjunto de comandos em vários contextos diferentes, talvez esta seja a hora de você construir uma função no R que executa esses comandos.</p>
<p>Como exemplo, suponha que eu tenho um <code>data.frame</code> chamado <code>tab</code>. Dentro dele, encontramos 4 colunas numéricas (<code>v1</code>, <code>v2</code>, <code>v3</code> e <code>v4</code>). Perceba que, após criar essa tabela com a função <code>data.frame()</code>, eu tenho um bloco de 4 linhas de comandos. Com um pouco de atenção, você talvez perceba que esses comandos estão apenas normalizando cada uma dessas 4 colunas, segundo um índice <span class="math inline">\(Z\)</span> de uma distribuição normal.</p>
<p>Entretanto, talvez a primeira coisa que você de fato reparou nesse bloco de comandos, é que eles são um pouco difíceis de se ler. Agora, se você realmente prestar atenção neles, você provavelmente pode identificar um erro de digitação, mais especificamente, na linha de comandos que está normalizando a coluna <code>v3</code>. Perceba que eu me esqueci de ajustar a coluna dentro da função <code>mean()</code>, para a coluna <code>v3</code>. Por causa desse erro, os valores da coluna <code>v3</code> serão normalizados segundo a média dos valores da coluna <code>v2</code>.</p>
<p></p>
<div class="sourceCode" id="cb1436"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1436-1"><a href="#cb1436-1" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb1436-2"><a href="#cb1436-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">v1 =</span> <span class="fu">runif</span>(<span class="dv">10</span>),</span>
<span id="cb1436-3"><a href="#cb1436-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">v2 =</span> <span class="fu">runif</span>(<span class="dv">10</span>),</span>
<span id="cb1436-4"><a href="#cb1436-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">v3 =</span> <span class="fu">runif</span>(<span class="dv">10</span>),</span>
<span id="cb1436-5"><a href="#cb1436-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">v4 =</span> <span class="fu">runif</span>(<span class="dv">10</span>)</span>
<span id="cb1436-6"><a href="#cb1436-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1436-7"><a href="#cb1436-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1436-8"><a href="#cb1436-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1436-9"><a href="#cb1436-9" aria-hidden="true" tabindex="-1"></a>tab<span class="sc">$</span>v1 <span class="ot">&lt;-</span> (tab<span class="sc">$</span>v1 <span class="sc">-</span> <span class="fu">mean</span>(tab<span class="sc">$</span>v1, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">/</span> <span class="fu">sd</span>(tab<span class="sc">$</span>v1, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1436-10"><a href="#cb1436-10" aria-hidden="true" tabindex="-1"></a>tab<span class="sc">$</span>v2 <span class="ot">&lt;-</span> (tab<span class="sc">$</span>v2 <span class="sc">-</span> <span class="fu">mean</span>(tab<span class="sc">$</span>v2, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">/</span> <span class="fu">sd</span>(tab<span class="sc">$</span>v2, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1436-11"><a href="#cb1436-11" aria-hidden="true" tabindex="-1"></a>tab<span class="sc">$</span>v3 <span class="ot">&lt;-</span> (tab<span class="sc">$</span>v3 <span class="sc">-</span> <span class="fu">mean</span>(tab<span class="sc">$</span>v2, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">/</span> <span class="fu">sd</span>(tab<span class="sc">$</span>v3, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1436-12"><a href="#cb1436-12" aria-hidden="true" tabindex="-1"></a>tab<span class="sc">$</span>v4 <span class="ot">&lt;-</span> (tab<span class="sc">$</span>v4 <span class="sc">-</span> <span class="fu">mean</span>(tab<span class="sc">$</span>v4, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">/</span> <span class="fu">sd</span>(tab<span class="sc">$</span>v4, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p></p>
<p>Isso é um erro extremamente comum quando começamos a copiar e colar muito um mesmo pedaço de código. Tal erro, ocorre principalmente porque os nossos olhos tendem a focar muito de sua atenção no que é muito diferente do que está ao redor, e não no que é muito parecido entre si. Consequentemente, quando temos muita repetição em um determinado bloco de comandos, ler e compreender esses comandos se torna uma atividade mais difícil e que exige muito mais de sua atenção.</p>
<p>Ao criarmos uma função que justamente executa esses comandos, evitamos esses erros de digitação que são extremamente comuns e que podem ser extremamente danosos. Imagine se alguma pessoa dependesse diretamente dos valores dessa coluna <code>v3</code> para executar o seu trabalho. Por exemplo, se algum gerente faz suas decisões de negócio com base nessa coluna <code>v3</code>, ele estaria baseando suas decisões em valores errados! Caso você não detectasse esse erro a tempo, antes de enviar os dados para esse gerente, você poderia muito bem perder o seu emprego!</p>
<p>Para mais, perceba que no exemplo acima, eu repeti o mesmo conjunto de comandos 4 vezes, e por causa disso, se eu precisasse alterar alguma coisa nesses comandos (e.g. para utilizar colunas diferentes, ou normalizar as colunas segundo uma fórmula de cálculo diferente, etc.), eu teria que fazer alterações em 4 lugares diferentes.</p>
<p>Por outro lado, quando você guarda esses comandos dentro de uma função, você precisa aplicar essas modificações em um único local. Pois ao alterarmos a definição da função, as mudanças são automaticamente refletidas sobre todos os locais onde você emprega essa função. Consequentemente, agrupar os seus comandos em funções, torna a manutenção de seu <em>script</em> mais simples e fácil.</p>
<div id="sec:exemplo_inicial_funcao" class="section level3" number="14.2.1">
<h3 number="14.2.1"><span class="header-section-number">14.2.1</span> Um exemplo inicial de função</h3>
<p>Como exemplo inicial, vamos criar uma função para o bloco de comandos mostrados na seção anterior. Primeiro, vamos analisar os comandos que estão sendo utilizados, para saber o que essa função vai executar, e que argumentos ela vai precisar. Reproduzi logo abaixo uma parte dos comandos utilizados. Agora, pergunte-se que argumentos essa função precisaria para executar esses comandos abaixo? Ou em outras palavras, quais <em>inputs</em> essa função vai utilizar?</p>
<p></p>
<div class="sourceCode" id="cb1437"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1437-1"><a href="#cb1437-1" aria-hidden="true" tabindex="-1"></a>(tab<span class="sc">$</span>v1 <span class="sc">-</span> <span class="fu">mean</span>(tab<span class="sc">$</span>v1, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">/</span> <span class="fu">sd</span>(tab<span class="sc">$</span>v1, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p></p>
<p>Para definir os <em>inputs</em> de uma função, é muito útil observarmos as várias repetições dos comandos que queremos incluir nessa função, e identificarmos o que está mudando entre cada repetição. Se você voltar às 4 repetições desses comandos que mostramos na seção passada, você pode perceber que a única coisa que está mudando entre cada linha de código, são as colunas utilizadas (<code>v1</code>, <code>v2</code>, <code>v3</code> ou <code>v4</code>). Portanto, podemos concluir que nossa função precisa de 1 único argumento, que seria a coluna a ser normalizada.</p>
<p>Tendo isso em mente, poderíamos reescrever a expressão acima com o argumento <code>x</code> de nossa função. Por escolha própria, determinei que o nome desse argumento seria <code>x</code>. Mas a realidade, é que você pode dar o nome que quiser para os argumentos de sua função (poderíamos muito bem dar a ele o nome de <code>coluna</code> por exemplo). Pois esses argumentos são apenas “apelidos” que damos aos <em>inputs</em> de uma função.</p>
<p></p>
<div class="sourceCode" id="cb1438"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1438-1"><a href="#cb1438-1" aria-hidden="true" tabindex="-1"></a>(x <span class="sc">-</span> <span class="fu">mean</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">/</span> <span class="fu">sd</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p></p>
<p>Agora, contornamos essa expressão por um par de chaves<code>{}</code>, e posicionamos antes desse par de chaves, a palavra-chave <code>function</code>, seguida de nosso argumento <code>x</code> dentro de um par de parênteses. Com isso, temos a definição completa de nossa função.</p>
<p></p>
<div class="sourceCode" id="cb1439"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1439-1"><a href="#cb1439-1" aria-hidden="true" tabindex="-1"></a><span class="cf">function</span>(x){</span>
<span id="cb1439-2"><a href="#cb1439-2" aria-hidden="true" tabindex="-1"></a>  (x <span class="sc">-</span> <span class="fu">mean</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">/</span> <span class="fu">sd</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1439-3"><a href="#cb1439-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p></p>
<p>Porém, nós precisamos salvar essa definição em algum lugar. Portanto, salve o resultado dessa estrutura em um novo objeto. Dessa forma, temos agora uma nova função chamada <code>normalizar()</code>, que executa a expressão que definimos acima.</p>
<p></p>
<div class="sourceCode" id="cb1440"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1440-1"><a href="#cb1440-1" aria-hidden="true" tabindex="-1"></a>normalizar <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb1440-2"><a href="#cb1440-2" aria-hidden="true" tabindex="-1"></a>  (x <span class="sc">-</span> <span class="fu">mean</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">/</span> <span class="fu">sd</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1440-3"><a href="#cb1440-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p></p>
<p>Com essa nova função, podemos reescrever o bloco de comandos que mostramos na seção passada, da maneira apresentada abaixo. Ainda temos certa repetição nos comandos, mas agora, temos um bloco muito mais simples e fácil de se compreender. Para eliminar completamente a repetição envolvida nesses comandos, poderíamos adicionar um <em>loop</em> com a função <code>normalizar()</code>, ou, utilizar uma das funções disponíveis no pacote <code>purrr</code>. Porém, veremos essas técnicas mais à frente, por enquanto, continuaremos focando nos poderes e características que emergem das funções.</p>
<p></p>
<div class="sourceCode" id="cb1441"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1441-1"><a href="#cb1441-1" aria-hidden="true" tabindex="-1"></a>tab<span class="sc">$</span>v1 <span class="ot">&lt;-</span> <span class="fu">normalizar</span>(tab<span class="sc">$</span>v1)</span>
<span id="cb1441-2"><a href="#cb1441-2" aria-hidden="true" tabindex="-1"></a>tab<span class="sc">$</span>v2 <span class="ot">&lt;-</span> <span class="fu">normalizar</span>(tab<span class="sc">$</span>v2)</span>
<span id="cb1441-3"><a href="#cb1441-3" aria-hidden="true" tabindex="-1"></a>tab<span class="sc">$</span>v3 <span class="ot">&lt;-</span> <span class="fu">normalizar</span>(tab<span class="sc">$</span>v3)</span>
<span id="cb1441-4"><a href="#cb1441-4" aria-hidden="true" tabindex="-1"></a>tab<span class="sc">$</span>v4 <span class="ot">&lt;-</span> <span class="fu">normalizar</span>(tab<span class="sc">$</span>v4)</span></code></pre></div>
<p></p>
</div>
</div>
<div id="sec:o_que_uma_funcao_faz" class="section level2" number="14.3">
<h2 number="14.3"><span class="header-section-number">14.3</span> O que uma função faz ?</h2>
<p>O que uma função faz não é algo muito distante do que você já normalmente faz em sua sessão do R, enviando manualmente cada um de seus comandos do R para dentro do console. Porém, quando você armazena os seus comandos dentro de funções, replicar esses comandos para outras áreas, amostras e indivíduos, se torna algo muito mais fácil e prático. É essa capacidade de expandir o seu trabalho com facilidade, que torna uma função algo muito poderoso.</p>
<blockquote>
<p><em>“Writing functions in R is not separate from issuing commands interactively, but grows from using, and reusing, such commands”</em> <span class="citation">(<a href="#ref-chambers2008" role="doc-biblioref">Chambers 2008</a>, p 37)</span>.</p>
</blockquote>
<p>Em resumo, uma função lhe permite reutilizar um certo conjunto de comandos, além de parametrizar a sua execução. Por exemplo, se você possui um bloco de comandos de, digamos, 20 linhas, ao inserir esse bloco de comandos dentro de uma função, você se torna capaz de executar essas 20 linhas de código através de 1 único comando. Por consequência, você não tem mais o trabalho de enviar individualmente cada uma das 20 linhas para o console.</p>
<p>Para mais, uma função lhe permite que você defina argumentos (ou parâmetros, ou <em>inputs</em>). Através desses argumentos, você é capaz de modificar a forma como essas 20 linhas de código operam e, consequentemente, alterar o resultado que elas produzem.</p>
<p>Tendo esses pontos em mente, você geralmente utiliza uma função, quando você deseja aplicar os mesmos comandos (ou a mesma “funcionalidade”) sobre vários <em>inputs</em> diferentes. Essa característica se torna extremamente importante a partir do momento em que você precisa expandir o seu trabalho para um número maior de locais.</p>
<p>Por exemplo, suponha que você aplique hoje, os comandos x, y e z sobre 1 única tabela para calcular um determinado indicador. Agora, suponha que amanhã você tenha que calcular o mesmo indicador, só que para um conjunto de 1000 tabelas diferentes. Como você enfrentaria esse desafio? Você copiaria 1000 vezes os comandos x, y e z em seu <em>script</em> para cada uma dessas 1000 tabelas? Uma solução muito mais eficiente para esse problema, seria criarmos uma função que aplica os comandos x, y e z sobre um determinado <em>input</em>, e pedirmos ao R que aplique essa função sobre essas 1000 tabelas por nós.</p>
</div>
<div id="os-passos-e-componentes-necessários-para-se-criar-uma-função" class="section level2" number="14.4">
<h2 number="14.4"><span class="header-section-number">14.4</span> Os passos e componentes necessários para se criar uma função</h2>
<p>Segundo <span class="citation"><a href="#ref-wickham2017" role="doc-biblioref">Wickham and Grolemund</a> (<a href="#ref-wickham2017" role="doc-biblioref">2017</a>)</span>, a criação de uma nova função no R envolve a realização de 3 passos:</p>
<ol style="list-style-type: decimal">
<li>escolha um nome para a sua nova função.</li>
<li>defina os argumentos que essa nova função vai precisar, e quais deles são obrigatórios ou opcionais.</li>
<li>insira dentro do corpo da função, todos os comandos que você deseja que ela execute.</li>
</ol>
<p>Estes 3 passos refletem exatamente a estrutura de uma função no R, a qual é formada por 3 componentes diferentes, que são: 1) o nome da função; 2) os argumentos da função; e 3) o corpo, ou o <code>body</code> da função. Para uma compreensão mais visual de cada um desses 3 componentes, eu delimitei cada um deles na figura 14.1. Nessa figura, utilizo como exemplo, uma função chamada <code>somar</code>, que simplesmente soma os dois argumentos fornecidos a ela, e nos retorna o resultado dessa soma.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/funcao1.png" alt="Os componentes de uma função" width="100%" />
<p class="caption">
(#fig:unnamed-chunk-772)Os componentes de uma função
</p>
</div>
<p></p>
<p>Portanto, toda função que você cria no R deve possuir esses três componentes. Para criarmos a definição de uma função no R (que representa a área verde escura na figura 14.1), nós sempre iniciamos pela palavra-chave <code>function</code>. Ou seja, quando você digita essa palavra-chave, o R entende que você está prestes a construir a definição de uma função, ao descrever os seus argumentos e o seu corpo.</p>
<div id="um-exemplo-identificando-anos-bissextos" class="section level3" number="14.4.1">
<h3 number="14.4.1"><span class="header-section-number">14.4.1</span> Um exemplo: identificando anos bissextos</h3>
<p>Vamos supor que, você possua uma necessidade bem específica, que é a de identificar se um determinado ano é um ano bissexto. Você estudou a definição de um ano bissexto, tentou aplicar essa definição dentro do R, e conseguiu construir o teste lógico abaixo, que realiza os testes necessários. Lembre-se que um ano bissexto é um ano que: 1) é múltiplo de 4; e 2) não é múltiplo de 100, a menos que ele seja múltiplo de 400. Repare que, estamos utilizando abaixo o operador <code>%%</code>, o qual nos retorna o resto da divisão. Portanto, se o resto da divisão entre um determinado ano e um número <code>x</code> for igual a zero, sabemos que esse ano é múltiplo de <code>x</code>. Caso esse resto seja diferente de zero, sabemos que esse ano não é múltiplo de <code>x</code>.</p>
<p></p>
<div class="sourceCode" id="cb1442"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1442-1"><a href="#cb1442-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Testando se o ano de 2008 é bissexto ou não</span></span>
<span id="cb1442-2"><a href="#cb1442-2" aria-hidden="true" tabindex="-1"></a>(<span class="dv">2008</span> <span class="sc">%%</span> <span class="dv">4</span> <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">&amp;</span> ((<span class="dv">2008</span> <span class="sc">%%</span> <span class="dv">100</span> <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">|</span> (<span class="dv">2008</span> <span class="sc">%%</span> <span class="dv">400</span> <span class="sc">==</span> <span class="dv">0</span>))</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p></p>
<p>Portanto, se você precisa identificar múltiplos anos como anos bissextos ou não bissextos, você talvez comece a copiar e colar o código que você criou acima para cada ano que você deseja testar, formando algo como:</p>
<p></p>
<div class="sourceCode" id="cb1444"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1444-1"><a href="#cb1444-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Para o ano de 2009</span></span>
<span id="cb1444-2"><a href="#cb1444-2" aria-hidden="true" tabindex="-1"></a>(<span class="dv">2009</span> <span class="sc">%%</span> <span class="dv">4</span> <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">&amp;</span> ((<span class="dv">2009</span> <span class="sc">%%</span> <span class="dv">100</span> <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">|</span> (<span class="dv">2009</span> <span class="sc">%%</span> <span class="dv">400</span> <span class="sc">==</span> <span class="dv">0</span>))</span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<div class="sourceCode" id="cb1446"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1446-1"><a href="#cb1446-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Para o ano de 2010</span></span>
<span id="cb1446-2"><a href="#cb1446-2" aria-hidden="true" tabindex="-1"></a>(<span class="dv">2010</span> <span class="sc">%%</span> <span class="dv">4</span> <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">&amp;</span> ((<span class="dv">2010</span> <span class="sc">%%</span> <span class="dv">100</span> <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">|</span> (<span class="dv">2010</span> <span class="sc">%%</span> <span class="dv">400</span> <span class="sc">==</span> <span class="dv">0</span>))</span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<div class="sourceCode" id="cb1448"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1448-1"><a href="#cb1448-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Para o ano de 2011</span></span>
<span id="cb1448-2"><a href="#cb1448-2" aria-hidden="true" tabindex="-1"></a>(<span class="dv">2011</span> <span class="sc">%%</span> <span class="dv">4</span> <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">&amp;</span> ((<span class="dv">2011</span> <span class="sc">%%</span> <span class="dv">100</span> <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">|</span> (<span class="dv">2011</span> <span class="sc">%%</span> <span class="dv">400</span> <span class="sc">==</span> <span class="dv">0</span>))</span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<div class="sourceCode" id="cb1450"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1450-1"><a href="#cb1450-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Para o ano de 2012</span></span>
<span id="cb1450-2"><a href="#cb1450-2" aria-hidden="true" tabindex="-1"></a>(<span class="dv">2012</span> <span class="sc">%%</span> <span class="dv">4</span> <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">&amp;</span> ((<span class="dv">2012</span> <span class="sc">%%</span> <span class="dv">100</span> <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">|</span> (<span class="dv">2012</span> <span class="sc">%%</span> <span class="dv">400</span> <span class="sc">==</span> <span class="dv">0</span>))</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p></p>
<p>Se você for esperto o suficiente, vai acabar percebendo que o teste lógico que você criou acima é capaz de lidar com um vetor de anos a serem testados.</p>
<p></p>
<div class="sourceCode" id="cb1452"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1452-1"><a href="#cb1452-1" aria-hidden="true" tabindex="-1"></a>anos <span class="ot">&lt;-</span> <span class="dv">2008</span><span class="sc">:</span><span class="dv">2016</span></span>
<span id="cb1452-2"><a href="#cb1452-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1452-3"><a href="#cb1452-3" aria-hidden="true" tabindex="-1"></a>resultado <span class="ot">&lt;-</span> (anos <span class="sc">%%</span> <span class="dv">4</span> <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">&amp;</span> ((anos <span class="sc">%%</span> <span class="dv">100</span> <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">|</span> (anos <span class="sc">%%</span> <span class="dv">400</span> <span class="sc">==</span> <span class="dv">0</span>))</span>
<span id="cb1452-4"><a href="#cb1452-4" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(resultado) <span class="ot">&lt;-</span> anos</span>
<span id="cb1452-5"><a href="#cb1452-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1452-6"><a href="#cb1452-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(resultado)</span></code></pre></div>
<pre><code>##  2008  2009  2010  2011  2012  2013  2014  2015  2016 
##  TRUE FALSE FALSE FALSE  TRUE FALSE FALSE FALSE  TRUE</code></pre>
<p>
Nada mal, mas porque não incorporamos esse teste dentro de uma função? Primeiro, precisamos escolher um nome para essa função. Para o nosso exemplo, algo como <code>é_ano_bissexto</code> é suficiente. Ou se preferir, em inglês, <code>is_leap_year</code>. Porém, se você puder, é sempre interessante retirar os acentos de nomes de seus objetos e funções, para evitar possíveis problemas de <em>encoding</em>. Dessa forma, <code>e_ano_bissexto</code> é um nome melhor.</p>
<p>Agora que definimos o nome da função, começamos a construir a sua definição. Lembre-se que a definição de uma função sempre se inicia pela palavra-chave <code>function</code>, seguida por um par de parênteses (onde serão definidos os argumentos) e por um par de chaves (onde será definido o corpo).</p>
<p></p>
<div class="sourceCode" id="cb1454"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1454-1"><a href="#cb1454-1" aria-hidden="true" tabindex="-1"></a>e_ano_bissexto <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb1454-2"><a href="#cb1454-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Corpo da função</span></span>
<span id="cb1454-3"><a href="#cb1454-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p></p>
<p>A segunda etapa do processo, é definir quais os <em>inputs</em> que essa função precisa. Como essa é uma função que busca identificar se um determinado ano é bissexto ou não, essa função precisa receber um ano sobre o qual ela possa aplicar os seus testes. Esse ano é certamente um <em>input</em> obrigatório, pois caso essa função não receba esse ano, ela vai aplicar os seus testes sobre o quê especificamente?</p>
<p>Portanto, determinamos que essa função precisa ter 1 argumento obrigatório, que é o ano a ser testado. Por minha escolha, dei o nome de <code>ano</code> a esse argumento, mas ele poderia se chamar <code>x</code>, <code>y</code>, ou qualquer outro nome de sua preferência. Lembre-se que argumentos são como apelidos, eles apenas determinam em que parte do corpo da função será empregado os valores que você fornece a estes argumentos.</p>
<p></p>
<div class="sourceCode" id="cb1455"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1455-1"><a href="#cb1455-1" aria-hidden="true" tabindex="-1"></a>e_ano_bissexto <span class="ot">&lt;-</span> <span class="cf">function</span>(ano){</span>
<span id="cb1455-2"><a href="#cb1455-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Corpo da função</span></span>
<span id="cb1455-3"><a href="#cb1455-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p></p>
<p>No estado atual da nossa função <code>e_ano_bissexto</code>, ela possui um argumento chamado <code>ano</code>, mas essa função não calcula absolutamente nada, ela nem sequer chega a aplicar algum cálculo sobre o valor que fornecemos a esse argumento <code>ano</code>. Essa é a situação atual, pois o corpo (ou o <code>body</code>) dessa função está vazio. Desse modo, o comando abaixo realiza sim uma chamada à função <code>e_ano_bissexto</code> com o valor de 2020 para o argumento <code>ano</code>, porém, a função em si, simplesmente não realiza cálculo nenhum ou nos retorna algum resultado.</p>
<p></p>
<div class="sourceCode" id="cb1456"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1456-1"><a href="#cb1456-1" aria-hidden="true" tabindex="-1"></a><span class="fu">e_ano_bissexto</span>(<span class="dv">2020</span>)</span></code></pre></div>
<pre><code>## NULL</code></pre>
<p></p>
<p>Sendo assim, é hora de preenchermos o corpo dessa função. Lembre-se que, o corpo de uma função deve conter os comandos que você deseja que essa função execute por você. Nós sabemos que a função <code>e_ano_bissexto()</code> deve testar se um ano é bissexto, logo, devemos incluir nesse corpo, os comandos necessários para aplicar esse teste lógico, considerando o argumento <code>ano</code> que definimos na etapa anterior.</p>
<p></p>
<div class="sourceCode" id="cb1458"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1458-1"><a href="#cb1458-1" aria-hidden="true" tabindex="-1"></a>e_ano_bissexto <span class="ot">&lt;-</span> <span class="cf">function</span>(ano){</span>
<span id="cb1458-2"><a href="#cb1458-2" aria-hidden="true" tabindex="-1"></a>  (ano <span class="sc">%%</span> <span class="dv">4</span> <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">&amp;</span> ((ano <span class="sc">%%</span> <span class="dv">100</span> <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">|</span> (ano <span class="sc">%%</span> <span class="dv">400</span> <span class="sc">==</span> <span class="dv">0</span>))</span>
<span id="cb1458-3"><a href="#cb1458-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p></p>
<p>Enfim, temos a nossa função <code>e_ano_bissexto()</code> funcionando da forma como desejamos:</p>
<p></p>
<div class="sourceCode" id="cb1459"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1459-1"><a href="#cb1459-1" aria-hidden="true" tabindex="-1"></a><span class="fu">e_ano_bissexto</span>(<span class="dv">2100</span>) <span class="co"># FALSE pois é múltiplo de 100 mas não de 400</span></span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<div class="sourceCode" id="cb1461"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1461-1"><a href="#cb1461-1" aria-hidden="true" tabindex="-1"></a><span class="fu">e_ano_bissexto</span>(<span class="dv">2020</span>) <span class="co"># TRUE pois é múltiplo de 4</span></span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb1463"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1463-1"><a href="#cb1463-1" aria-hidden="true" tabindex="-1"></a><span class="fu">e_ano_bissexto</span>(<span class="dv">2012</span><span class="sc">:</span><span class="dv">2016</span>) <span class="co"># TRUE para 2012 e 2016</span></span></code></pre></div>
<pre><code>## [1]  TRUE FALSE FALSE FALSE  TRUE</code></pre>
<p></p>
</div>
</div>
<div id="funções-são-para-humanos-e-para-computadores" class="section level2" number="14.5">
<h2 number="14.5"><span class="header-section-number">14.5</span> Funções são para humanos e para computadores</h2>
<p>O título dessa seção foi retirado diretamente da obra de <span class="citation"><a href="#ref-wickham2017" role="doc-biblioref">Wickham and Grolemund</a> (<a href="#ref-wickham2017" role="doc-biblioref">2017</a>)</span>. Com essa frase, <span class="citation"><a href="#ref-wickham2017" role="doc-biblioref">Wickham and Grolemund</a> (<a href="#ref-wickham2017" role="doc-biblioref">2017</a>)</span> buscam destacar a importância do grau de legibilidade e da documentação de uma função. Ou seja, sempre que você cria uma função, é fundamental que você escolha nomes claros para cada parte dessa função e que você documente o máximo de detalhes sobre ela.</p>
<p>Dessa forma, quando você voltar a essa função um ano depois desde a data em que você a criou, você terá muito mais facilidade de ler, compreender e relembrar o que essa função faz e o quais são os aspectos mais importantes sobre ela. Essa questão se torna ainda mais importante quando você está colaborando com outras pessoas, pois elas precisam ler e compreender o seu código, para que elas possam discutir e trazer as suas contribuições ao trabalho que vocês estão realizando.</p>
<p>Vamos começar pelo nome de sua função. Diferentes estilos de nomes são utilizados hoje no mundo da programação. O importante não é qual desses estilos você adota, mas sim, que você adote um e que você permaneça com ele. Ou seja, veja qual estilo te agrada mais e seja feliz com ele. O objetivo disso é tornar o seu código consistente, de forma que ele sempre esteja utilizando o mesmo estilo. Pois caso contrário, se o seu código utiliza muitos estilos diferentes ao mesmo tempo, sempre que você estiver lendo o seu código, você precisa trocar o tempo todo o seu modo de leitura, e isso exige certo esforço e concentração.</p>
<p>Como um guia, os principais estilos utilizados hoje no R são: 1) o <code>UpperCamel</code>; 2) o <code>camelCase</code> ; 3) o <code>snake_case</code>; e 4) o <code>dot.case</code>, que é o padrão utilizado pelo próprio R na maioria de suas funções de seus pacotes básicos. Exemplos de funções que utilizam o padrão <code>dot.case</code> são <code>data.frame()</code>, <code>list.files()</code> e <code>is.na()</code>.</p>
<!-- ```{r, echo = FALSE, fig.cap = "Os principais estilos de nomes utilizados na programação", out.width="500%"} -->
<!-- knitr::include_graphics("Figuras/coding_cases.png") -->
<!-- ``` -->
<p>Pode ser particularmente difícil de se definir um nome curto, e que ainda assim, traga significado para a sua função. De qualquer forma, não é pecado nenhum utilizar nomes grandes em suas funções, desde que eles entreguem o objetivo da função de forma clara. Como um guia, os nomes de funções geralmente devem ser verbos (por exemplo, <code>bind_rows()</code> ou “unir linhas”), e os nomes de seus argumentos, um substantivo <span class="citation">(<a href="#ref-wickham2017" role="doc-biblioref">Wickham and Grolemund 2017</a>)</span>. Entretando, há ocasiões em que é melhor utilizar um substantivo para nomear uma função, especialmente se ela está computando um valor que é muito conhecido por algum substantivo específico (por exemplo, a média - <code>mean()</code>, ou os coeficientes de uma regressão - <code>coef()</code>).</p>
<p>A medida em que você vai construindo múltiplas funções em um mesmo <em>script</em>, é útil dividirmos esse <em>script</em> em seções, e adicionar comentários à função que explicam como cada parte dela funciona. Nós já vimos essa funcionalidade anteriormente, na seção <a href="#sec:scripts">Scripts</a>, mas é útil relembrarmos aqui.</p>
<p>Para além de descrever como a função funciona, também é importante que você utilize os comentários para descrever o que os <em>inputs</em> de sua função devem ser (e.g. “o argumento <code>df</code> aceita um <code>data.frame</code> que contenha uma coluna chamada <code>valor</code>”), ou, o que eles definitivamente não podem ser (e.g. “os argumentos A e B não podem ser vetores de comprimentos diferentes!”). Como exemplo, a função <code>normalizar()</code> funciona apenas para vetores de comprimento maior do que 1.</p>
<p></p>
<div class="sourceCode" id="cb1465"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1465-1"><a href="#cb1465-1" aria-hidden="true" tabindex="-1"></a><span class="do">## A função normalizar() busca &quot;normalizar&quot; um determinado vetor</span></span>
<span id="cb1465-2"><a href="#cb1465-2" aria-hidden="true" tabindex="-1"></a><span class="do">## ou coluna, segundo o índice Z de uma distribuição normal.</span></span>
<span id="cb1465-3"><a href="#cb1465-3" aria-hidden="true" tabindex="-1"></a><span class="do">## OBS: argumento x deve ser um vetor de comprimento maior que 1.</span></span>
<span id="cb1465-4"><a href="#cb1465-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1465-5"><a href="#cb1465-5" aria-hidden="true" tabindex="-1"></a>normalizar <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb1465-6"><a href="#cb1465-6" aria-hidden="true" tabindex="-1"></a>  (x <span class="sc">-</span> <span class="fu">mean</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">/</span> <span class="fu">sd</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1465-7"><a href="#cb1465-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p></p>
</div>
<div id="construindo-argumentos-e-resultados-de-uma-função" class="section level2" number="14.6">
<h2 number="14.6"><span class="header-section-number">14.6</span> Construindo argumentos e resultados de uma função</h2>
<div id="podemos-ter-argumentos-obrigatórios-eou-opcionais" class="section level3" number="14.6.1">
<h3 number="14.6.1"><span class="header-section-number">14.6.1</span> Podemos ter argumentos obrigatórios e/ou opcionais</h3>
<p>Quando você define um argumento de uma função, você pode torná-lo um argumento obrigatório ou opcional. Se uma função possui um argumento obrigatório, você não consegue executar essa função sem definir algum valor para esse argumento. Por exemplo, vamos voltar à função <code>somar()</code> que mostramos na figura 14.1. Essa função possui dois argumentos (<code>x</code> e <code>y</code>). Caso eu defina um valor para o argumento <code>x</code>, mas não defina um valor para o argumento <code>y</code>, um erro será retornado.</p>
<p></p>
<div class="sourceCode" id="cb1466"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1466-1"><a href="#cb1466-1" aria-hidden="true" tabindex="-1"></a>somar <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y){</span>
<span id="cb1466-2"><a href="#cb1466-2" aria-hidden="true" tabindex="-1"></a>  resultado <span class="ot">&lt;-</span> x <span class="sc">+</span> y</span>
<span id="cb1466-3"><a href="#cb1466-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(resultado)</span>
<span id="cb1466-4"><a href="#cb1466-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p></p>
<p>Tal erro ocorre, pois o argumento <code>y</code> (assim como o argumento <code>x</code>) é um argumento obrigatório da função <code>somar()</code>. Um argumento se torna obrigatório, na medida em que você não estabelece um valor padrão (ou <em>“default”</em>) para ele, na definição de sua função.</p>
<p></p>
<div class="sourceCode" id="cb1467"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1467-1"><a href="#cb1467-1" aria-hidden="true" tabindex="-1"></a><span class="fu">somar</span>(<span class="at">x =</span> <span class="dv">56</span>)</span></code></pre></div>
<p></p>
<pre><code>Error in somar(x = 56) : argument &quot;y&quot; is missing, with no default</code></pre>
<p>Para estabelecer um valor padrão para um argumento de uma função, basta que você iguale esse argumento a este valor padrão na definição dessa função (mais especificamente, dentro dos parênteses onde são definidos os argumentos da função). Como exemplo, se eu quisesse que o argumento <code>y</code> da função <code>somar()</code> tivesse o valor padrão de 10, eu deveria recriar a função da seguinte forma:</p>
<p></p>
<div class="sourceCode" id="cb1469"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1469-1"><a href="#cb1469-1" aria-hidden="true" tabindex="-1"></a>somar <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">y =</span> <span class="dv">10</span>){</span>
<span id="cb1469-2"><a href="#cb1469-2" aria-hidden="true" tabindex="-1"></a>  resultado <span class="ot">&lt;-</span> x <span class="sc">+</span> y</span>
<span id="cb1469-3"><a href="#cb1469-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(resultado)</span>
<span id="cb1469-4"><a href="#cb1469-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p></p>
<p>Dessa forma, eu posso chamar novamente a função definindo apenas o argumento <code>x</code>, e dessa vez, nenhum erro aparece. Pois agora, o argumento <code>y</code> se tornou um argumento opcional, dado que ele já possui um valor padrão. Por causa disso, toda vez que eu executar essa função, ela sempre vai realizar os seus cálculos considerando o valor de 10 para o argumento <code>y</code>.</p>
<p></p>
<div class="sourceCode" id="cb1470"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1470-1"><a href="#cb1470-1" aria-hidden="true" tabindex="-1"></a><span class="fu">somar</span>(<span class="at">x =</span> <span class="dv">56</span>)</span></code></pre></div>
<pre><code>## [1] 66</code></pre>
<div class="sourceCode" id="cb1472"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1472-1"><a href="#cb1472-1" aria-hidden="true" tabindex="-1"></a><span class="fu">somar</span>(<span class="at">x =</span> <span class="dv">32</span>)</span></code></pre></div>
<pre><code>## [1] 42</code></pre>
<p></p>
<p>Agora, não é porque um certo argumento possui um valor padrão, que você não pode sobrescrever esse valor durante uma chamada. Como exemplo, se eu quisesse somar os números 56 e 43, ao invés de 56 e 10 (o valor padrão do argumento <code>y</code>), eu poderia executar o seguinte comando:</p>
<p></p>
<div class="sourceCode" id="cb1474"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1474-1"><a href="#cb1474-1" aria-hidden="true" tabindex="-1"></a><span class="fu">somar</span>(<span class="at">x =</span> <span class="dv">56</span>, <span class="at">y =</span> <span class="dv">43</span>)</span></code></pre></div>
<pre><code>## [1] 99</code></pre>
<p></p>
<p>Isso quer dizer que, você pode estabelecer um valor padrão para um determinado argumento, mas você não é capaz de determinar um valor único, obrigatório e irreversível para esse argumento na lista de argumentos da função. A única possibilidade de você limitar o valor de um determinado argumento, é você criar validações e bloqueios dentro do corpo de sua função que obrigam o usuário a fornecer um valor específico a este argumento.</p>
<p>Por exemplo, se quiséssemos limitar o argumento <code>y</code> ao valor 10, poderíamos fazer isso da forma mostrada abaixo. Tal método utiliza a função <code>stop()</code> dentro de um controle condicional de fluxo, construído pela palavra-chave <code>if</code>.</p>
<p></p>
<div class="sourceCode" id="cb1476"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1476-1"><a href="#cb1476-1" aria-hidden="true" tabindex="-1"></a>somar <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">y =</span> <span class="dv">10</span>){</span>
<span id="cb1476-2"><a href="#cb1476-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(y <span class="sc">!=</span> <span class="dv">10</span>){</span>
<span id="cb1476-3"><a href="#cb1476-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">&quot;O valor do argumento y precisa ser igual a 10.&quot;</span>)</span>
<span id="cb1476-4"><a href="#cb1476-4" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1476-5"><a href="#cb1476-5" aria-hidden="true" tabindex="-1"></a>  resultado <span class="ot">&lt;-</span> x <span class="sc">+</span> y</span>
<span id="cb1476-6"><a href="#cb1476-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(resultado)</span>
<span id="cb1476-7"><a href="#cb1476-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1476-8"><a href="#cb1476-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1476-9"><a href="#cb1476-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1476-10"><a href="#cb1476-10" aria-hidden="true" tabindex="-1"></a><span class="fu">somar</span>(<span class="at">x =</span> <span class="dv">56</span>, <span class="at">y =</span> <span class="dv">43</span>)</span></code></pre></div>
<p></p>
<pre><code>Error in somar(x = 56, y = 43) : O valor do argumento y precisa ser igual a 10.</code></pre>
<p>Por outro lado, um outro método bastante simples de limitarmos o valor de <code>y</code>, seria simplesmente retirarmos ele da lista de argumentos, de modo que ele seja definido dentro do corpo da função. Dessa forma, estamos retirando a possibilidade do usuário definir um valor para a variável <code>y</code>. Agora, toda vez que executarmos a função <code>somar</code>, ela sempre vai criar um novo objeto chamado <code>y</code> contendo o valor 10.</p>
<p></p>
<div class="sourceCode" id="cb1478"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1478-1"><a href="#cb1478-1" aria-hidden="true" tabindex="-1"></a>somar <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb1478-2"><a href="#cb1478-2" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb1478-3"><a href="#cb1478-3" aria-hidden="true" tabindex="-1"></a>  resultado <span class="ot">&lt;-</span> x <span class="sc">+</span> y</span>
<span id="cb1478-4"><a href="#cb1478-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(resultado)</span>
<span id="cb1478-5"><a href="#cb1478-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1478-6"><a href="#cb1478-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1478-7"><a href="#cb1478-7" aria-hidden="true" tabindex="-1"></a><span class="fu">somar</span>(<span class="at">x =</span> <span class="dv">56</span>)</span></code></pre></div>
<pre><code>## [1] 66</code></pre>
<p></p>
<p>Vale ressaltar que, o valor padrão de um determinado argumento pode ser qualquer coisa que a linguagem R te permite definir. Pode ser, por exemplo, uma constante (e.g., <code>y = 10</code>), uma lista (e.g., <code>y = list("add", "remove", "mult")</code>), uma outra função (e.g., <code>y = sum</code> ou <code>y = mean</code>), ou um vetor (e.g., <code>y = c(0.25, 0.5, 0.75)</code>).</p>
<p>Comparado à linguagem Python, a linguagem R te dá total liberdade para posicionar os seus argumentos dentro da lista de argumentos de sua função. Em outras palavras, os argumentos opcionais de sua função podem estar em qualquer posição da lista de argumentos. Por causa disso, podemos definir um valor padrão para o argumento <code>x</code> e, ainda assim, mantê-lo como o primeiro argumento da função.</p>
<p></p>
<div class="sourceCode" id="cb1480"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1480-1"><a href="#cb1480-1" aria-hidden="true" tabindex="-1"></a>somar <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">x =</span> <span class="dv">10</span>, y){</span>
<span id="cb1480-2"><a href="#cb1480-2" aria-hidden="true" tabindex="-1"></a>  resultado <span class="ot">&lt;-</span> x <span class="sc">+</span> y</span>
<span id="cb1480-3"><a href="#cb1480-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(resultado)</span>
<span id="cb1480-4"><a href="#cb1480-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1480-5"><a href="#cb1480-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1480-6"><a href="#cb1480-6" aria-hidden="true" tabindex="-1"></a><span class="fu">somar</span>(<span class="at">y =</span> <span class="dv">20</span>)</span></code></pre></div>
<pre><code>## [1] 30</code></pre>
<p></p>
<p>Isso não é possível de ser feito na linguagem Python, pois ela te obriga a posicionar os seus argumentos opcionais como os últimos argumentos de sua função. Consequentemente, se tentássemos reproduzir a versão acima de <code>somar()</code>, em Python, teríamos o seguinte resultado:</p>
<p></p>
<div class="sourceCode" id="cb1482"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb1482-1"><a href="#cb1482-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> somar(y, x <span class="op">=</span> <span class="dv">10</span>):</span>
<span id="cb1482-2"><a href="#cb1482-2" aria-hidden="true" tabindex="-1"></a>  resultado <span class="op">=</span> x <span class="op">+</span> y</span>
<span id="cb1482-3"><a href="#cb1482-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> resultado</span>
<span id="cb1482-4"><a href="#cb1482-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1482-5"><a href="#cb1482-5" aria-hidden="true" tabindex="-1"></a>somar(y <span class="op">=</span> <span class="dv">20</span>)</span></code></pre></div>
<pre><code>## 30</code></pre>
<p></p>
</div>
<div id="algumas-dicas-sobre-argument-matching" class="section level3" number="14.6.2">
<h3 number="14.6.2"><span class="header-section-number">14.6.2</span> Algumas dicas sobre <em>argument matching</em></h3>
<p>Quando um argumento de sua função possui um conjunto pequeno e bem definido de valores possíveis, pode ser interessante empregar um <em>argument matching</em> sobre este argumento. Essa técnica é utilizada principalmente em argumentos que podem assumir um valor em texto (uma <em>string</em>), como <code>"center"</code>, <code>"secs"</code> ou <code>"auto"</code>, e se baseia na função <code>match.arg()</code> que pertence aos pacotes básicos do R, ou ainda, na função <code>arg_match()</code> que advém do pacote <code>rlang</code> e que realiza exatamente o mesmo trabalho<a href="#fn40" class="footnote-ref" id="fnref40"><sup>40</sup></a>.</p>
<p>Um exemplo de função que utiliza essa técnica é a função <code>format()</code>, ou, de maneira mais precisa, o seu argumento <code>justify</code>. Em resumo, o argumento <code>justify</code> de <code>format()</code> pode assumir apenas 4 valores: <code>"left"</code>, <code>"right"</code>, <code>"centre"</code> ou <code>"none"</code>. A função <code>match.arg()</code> é responsável por conferir se o usuário selecionou um desses 4 valores neste argumento <code>justify</code>. Caso você forneça qualquer valor que não esteja dentre esses 4 valores, a função vai levantar um erro, obrigando você a corrigir o seu <em>input</em>.</p>
<p></p>
<div class="sourceCode" id="cb1484"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1484-1"><a href="#cb1484-1" aria-hidden="true" tabindex="-1"></a>texto <span class="ot">&lt;-</span> <span class="st">&quot;Hoje, fui acampar.</span></span>
<span id="cb1484-2"><a href="#cb1484-2" aria-hidden="true" tabindex="-1"></a><span class="st">Mas tive que voltar para casa.&quot;</span></span>
<span id="cb1484-3"><a href="#cb1484-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1484-4"><a href="#cb1484-4" aria-hidden="true" tabindex="-1"></a><span class="fu">format</span>(texto, <span class="at">justify =</span> <span class="st">&quot;mx&quot;</span>)</span></code></pre></div>
<p></p>
<pre><code>Error in match.arg(justify) : &#39;arg&#39; deve ser um dentre &quot;left&quot;, &quot;right&quot;, &quot;centre&quot;, &quot;none&quot;</code></pre>
<p>Como exemplo, suponha que você tenha desenvolvido uma função que constrói um pequeno resumo pessoal (uma espécie de cartão de visita) para qualquer pessoa que trabalhe em sua empresa. Suponha também que, existem apenas 4 tipos de cargo possíveis nessa empresa: estagiário, analista, gerente e CEO. Agora, como você pode limitar o argumento <code>cargo</code> da função abaixo para essas 4 possibilidades?</p>
<p></p>
<div class="sourceCode" id="cb1486"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1486-1"><a href="#cb1486-1" aria-hidden="true" tabindex="-1"></a>construir_perfil <span class="ot">&lt;-</span> <span class="cf">function</span>(nome, cargo, </span>
<span id="cb1486-2"><a href="#cb1486-2" aria-hidden="true" tabindex="-1"></a>                             telefone,endereco,</span>
<span id="cb1486-3"><a href="#cb1486-3" aria-hidden="true" tabindex="-1"></a>                             <span class="at">empresa =</span> <span class="st">&quot;Take Blip&quot;</span>){</span>
<span id="cb1486-4"><a href="#cb1486-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1486-5"><a href="#cb1486-5" aria-hidden="true" tabindex="-1"></a>  prof <span class="ot">&lt;-</span> <span class="fu">paste</span>(cargo, empresa, <span class="at">sep =</span> <span class="st">&quot; em &quot;</span>)</span>
<span id="cb1486-6"><a href="#cb1486-6" aria-hidden="true" tabindex="-1"></a>  top <span class="ot">&lt;-</span> <span class="fu">paste</span>(nome, telefone, <span class="at">sep =</span> <span class="st">&quot; | &quot;</span>)</span>
<span id="cb1486-7"><a href="#cb1486-7" aria-hidden="true" tabindex="-1"></a>  perfil <span class="ot">&lt;-</span> <span class="fu">paste</span>(top, endereco, prof, <span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb1486-8"><a href="#cb1486-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1486-9"><a href="#cb1486-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">writeLines</span>(perfil)</span>
<span id="cb1486-10"><a href="#cb1486-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1486-11"><a href="#cb1486-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1486-12"><a href="#cb1486-12" aria-hidden="true" tabindex="-1"></a><span class="fu">construir_perfil</span>(</span>
<span id="cb1486-13"><a href="#cb1486-13" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Pedro Duarte&quot;</span>, <span class="st">&quot;Analista&quot;</span>,</span>
<span id="cb1486-14"><a href="#cb1486-14" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;+55 31 98888-8888&quot;</span>,</span>
<span id="cb1486-15"><a href="#cb1486-15" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Belo Horizonte - MG&quot;</span></span>
<span id="cb1486-16"><a href="#cb1486-16" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## Pedro Duarte | +55 31 98888-8888
## Belo Horizonte - MG
## Analista em Take Blip</code></pre>
<p></p>
<p>Primeiro, você deve igualar o argumento <code>cargo</code> a um vetor contendo essas 4 possibilidades e, em seguida, incluir a função <code>match.arg()</code> dentro do corpo da função. Dito de outra forma, você deve igualar o seu argumento a um vetor contendo o conjunto de possibilidades, de modo que este vetor se torna o valor padrão desse argumento, e, depois, dentro do corpo de sua função, você aplica a função <code>match.arg()</code> sobre este argumento, e salva o seu resultado em algum objeto.</p>
<p></p>
<div class="sourceCode" id="cb1488"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1488-1"><a href="#cb1488-1" aria-hidden="true" tabindex="-1"></a>construir_perfil <span class="ot">&lt;-</span> <span class="cf">function</span>(nome, </span>
<span id="cb1488-2"><a href="#cb1488-2" aria-hidden="true" tabindex="-1"></a>                             <span class="at">cargo =</span> <span class="fu">c</span>(<span class="st">&quot;Estagiário&quot;</span>, <span class="st">&quot;Analista&quot;</span>, <span class="st">&quot;Gerente&quot;</span>, <span class="st">&quot;CEO&quot;</span>), </span>
<span id="cb1488-3"><a href="#cb1488-3" aria-hidden="true" tabindex="-1"></a>                             telefone, endereco,</span>
<span id="cb1488-4"><a href="#cb1488-4" aria-hidden="true" tabindex="-1"></a>                             <span class="at">empresa =</span> <span class="st">&quot;Take Blip&quot;</span>){</span>
<span id="cb1488-5"><a href="#cb1488-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1488-6"><a href="#cb1488-6" aria-hidden="true" tabindex="-1"></a>  sel_cargo <span class="ot">&lt;-</span> <span class="fu">match.arg</span>(cargo)</span>
<span id="cb1488-7"><a href="#cb1488-7" aria-hidden="true" tabindex="-1"></a>  prof <span class="ot">&lt;-</span> <span class="fu">paste</span>(sel_cargo, empresa, <span class="at">sep =</span> <span class="st">&quot; em &quot;</span>)</span>
<span id="cb1488-8"><a href="#cb1488-8" aria-hidden="true" tabindex="-1"></a>  top <span class="ot">&lt;-</span> <span class="fu">paste</span>(nome, telefone, <span class="at">sep =</span> <span class="st">&quot; | &quot;</span>)</span>
<span id="cb1488-9"><a href="#cb1488-9" aria-hidden="true" tabindex="-1"></a>  perfil <span class="ot">&lt;-</span> <span class="fu">paste</span>(top, endereco, prof, <span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb1488-10"><a href="#cb1488-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1488-11"><a href="#cb1488-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">writeLines</span>(perfil)</span>
<span id="cb1488-12"><a href="#cb1488-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1488-13"><a href="#cb1488-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1488-14"><a href="#cb1488-14" aria-hidden="true" tabindex="-1"></a><span class="fu">construir_perfil</span>(</span>
<span id="cb1488-15"><a href="#cb1488-15" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Pedro Duarte&quot;</span>, <span class="st">&quot;Vendedor&quot;</span>,</span>
<span id="cb1488-16"><a href="#cb1488-16" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;+55 31 98888-8888&quot;</span>,</span>
<span id="cb1488-17"><a href="#cb1488-17" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Belo Horizonte - MG&quot;</span></span>
<span id="cb1488-18"><a href="#cb1488-18" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p></p>
<pre><code>Error in match.arg(cargo) : &#39;arg&#39; deve ser um dentre &quot;Estagiário&quot;, &quot;Analista&quot;,
&quot;Gerente&quot;, &quot;CEO&quot;</code></pre>
</div>
<div id="dot-dot-dot-...-o-argumento-mágico" class="section level3" number="14.6.3">
<h3 number="14.6.3"><span class="header-section-number">14.6.3</span> Dot-dot-dot (<code>...</code>), o argumento mágico</h3>
<p>No R, temos um tipo especial de argumento, representado por três pontos (<code>...</code>). Esse argumento é comumente chamado por <em>dot-dot-dot</em> dentro da comunidade <span class="citation">(<a href="#ref-Rlanguage" role="doc-biblioref">R Core Team 2020b</a>; <a href="#ref-wickham2017" role="doc-biblioref">Wickham and Grolemund 2017</a>)</span>, e ele funciona de forma semelhante ao <code>*args</code> e <code>**kwargs</code> do Python. Diversas funções utilizam esse argumento especial, como por exemplo, todas as funções do pacote <code>dplyr</code> que vimos no capítulo 4, como <code>mutate()</code>, <code>summarise()</code>, <code>select()</code>, <code>arrange()</code>, <code>bind_rows()</code>, <code>across()</code>, etc.</p>
<p></p>
<div class="sourceCode" id="cb1490"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1490-1"><a href="#cb1490-1" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span>mutate</span></code></pre></div>
<pre><code>## function (.data, ...) 
## {
##     UseMethod(&quot;mutate&quot;)
## }
## &lt;bytecode: 0x000001a2163512f8&gt;
## &lt;environment: namespace:dplyr&gt;</code></pre>
<div class="sourceCode" id="cb1492"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1492-1"><a href="#cb1492-1" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span>arrange</span></code></pre></div>
<pre><code>## function (.data, ..., .by_group = FALSE) 
## {
##     UseMethod(&quot;arrange&quot;)
## }
## &lt;bytecode: 0x000001a2162bfd30&gt;
## &lt;environment: namespace:dplyr&gt;</code></pre>
<p></p>
<p>Este argumento permite que a sua função aceite um número arbitrário de argumentos. Em outras palavras, nós geralmente utilizamos esse argumento especial em uma função, quando nós não sabemos de antemão, todos os <em>inputs</em> dessa função. Por exemplo, o primeiro argumento da função <code>sum()</code> é o <code>dot-dot-dot</code>. Por causa disso, essa função é capaz de receber 2, 10, 100, ou 1000 <em>inputs</em> diferentes.</p>
<p></p>
<div class="sourceCode" id="cb1494"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1494-1"><a href="#cb1494-1" aria-hidden="true" tabindex="-1"></a>sum</span></code></pre></div>
<pre><code>## function (..., na.rm = FALSE)  .Primitive(&quot;sum&quot;)</code></pre>
<div class="sourceCode" id="cb1496"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1496-1"><a href="#cb1496-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="dv">3</span>, <span class="dv">5</span>)</span></code></pre></div>
<pre><code>## [1] 8</code></pre>
<div class="sourceCode" id="cb1498"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1498-1"><a href="#cb1498-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(</span>
<span id="cb1498-2"><a href="#cb1498-2" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>,</span>
<span id="cb1498-3"><a href="#cb1498-3" aria-hidden="true" tabindex="-1"></a>  <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>, <span class="dv">10</span></span>
<span id="cb1498-4"><a href="#cb1498-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## [1] 55</code></pre>
<p></p>
<p>Um exemplo de uso bastante comum deste argumento especial, é o transporte de argumentos para outras funções. Por exemplo, eu posso criar uma função chamada <code>apply_agg()</code>, que busca aplicar alguma função agregadora sobre um vetor numérico. Perceba abaixo, que a cada execução da função <code>apply_agg()</code> eu estou modificando a função agregadora utilizada (<code>mean()</code>, <code>table()</code> e <code>quantile()</code>).</p>
<p>Por serem funções diferentes, elas possuem argumentos diferentes, e isso cria um problema sério caso eu queira definir um de seus argumentos durante a chamada à função <code>apply_agg()</code>. A solução para isso, está no uso do <em>dot-dot-dot</em>. Com ele, a função <code>apply_agg()</code> passa a aceitar um número qualquer de argumentos. Dessa forma, eu posso repassar à <code>apply_agg()</code> todos os argumentos que desejo utilizar na função agregadora. Em outras palavras, <code>apply_agg()</code> vai repassar todos esses argumentos arbitrários à função que eu conectei ao argumento <code>fun</code>.</p>
<p></p>
<div class="sourceCode" id="cb1500"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1500-1"><a href="#cb1500-1" aria-hidden="true" tabindex="-1"></a>apply_agg <span class="ot">&lt;-</span> <span class="cf">function</span>(x, fun, ...){</span>
<span id="cb1500-2"><a href="#cb1500-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fun</span>(x, ...)</span>
<span id="cb1500-3"><a href="#cb1500-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1500-4"><a href="#cb1500-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1500-5"><a href="#cb1500-5" aria-hidden="true" tabindex="-1"></a>vec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">1.25</span>, <span class="fl">1.25</span>, <span class="fl">7.8</span>, <span class="fl">5.3</span>, <span class="fl">9.1</span>, <span class="cn">NA</span>)</span>
<span id="cb1500-6"><a href="#cb1500-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1500-7"><a href="#cb1500-7" aria-hidden="true" tabindex="-1"></a><span class="fu">apply_agg</span>(vec, mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## [1] 4.94</code></pre>
<div class="sourceCode" id="cb1502"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1502-1"><a href="#cb1502-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apply_agg</span>(vec, table, <span class="at">useNA =</span> <span class="st">&quot;no&quot;</span>)</span></code></pre></div>
<pre><code>## x
## 1.25  5.3  7.8  9.1 
##    2    1    1    1</code></pre>
<div class="sourceCode" id="cb1504"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1504-1"><a href="#cb1504-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apply_agg</span>(</span>
<span id="cb1504-2"><a href="#cb1504-2" aria-hidden="true" tabindex="-1"></a>  vec, </span>
<span id="cb1504-3"><a href="#cb1504-3" aria-hidden="true" tabindex="-1"></a>  quantile,</span>
<span id="cb1504-4"><a href="#cb1504-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">0.75</span>),</span>
<span id="cb1504-5"><a href="#cb1504-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">na.rm =</span> <span class="cn">TRUE</span>,</span>
<span id="cb1504-6"><a href="#cb1504-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">names =</span> <span class="cn">FALSE</span></span>
<span id="cb1504-7"><a href="#cb1504-7" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## [1] 1.25 7.80</code></pre>
<p></p>
<p>Quando você utiliza o argumento <em>dot-dot-dot</em> em sua função, todo valor que você fornecer a essa função durante a sua chamada, e que não estiver conectado a algum argumento formal, será conectado ao argumento <em>dot-dot-dot</em> <span class="citation">(<a href="#ref-Rlanguage" role="doc-biblioref">R Core Team 2020b</a>)</span>. De forma mais clara, se a função <code>mean()</code> só possui um argumento formal (isto é, um argumento que possui um nome definido), apenas o primeiro argumento é conectado a esse argumento formal, enquanto todos os outros argumentos que eu fornecer à função vão ser associados ao argumento <em>dot-dot-dot</em>. No exemplo abaixo, apenas <code>vec</code> é conectado à um argumento formal (<code>x</code>), enquanto os valores <code>na.rm = TRUE</code> e <code>trim = 0.1</code> são associados ao argumento <em>dot-dot-dot</em> (<code>...</code>).</p>
<p></p>
<div class="sourceCode" id="cb1506"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1506-1"><a href="#cb1506-1" aria-hidden="true" tabindex="-1"></a>mean</span></code></pre></div>
<pre><code>## function (x, ...) 
## UseMethod(&quot;mean&quot;)
## &lt;bytecode: 0x000001a20fb6d958&gt;
## &lt;environment: namespace:base&gt;</code></pre>
<div class="sourceCode" id="cb1508"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1508-1"><a href="#cb1508-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(vec, <span class="at">na.rm =</span> <span class="cn">TRUE</span>, <span class="at">trim =</span> <span class="fl">0.1</span>)</span></code></pre></div>
<pre><code>## [1] 4.94</code></pre>
<p></p>
</div>
<div id="como-definir-o-resultado-de-sua-função" class="section level3" number="14.6.4">
<h3 number="14.6.4"><span class="header-section-number">14.6.4</span> Como definir o resultado de sua função</h3>
<p>Geralmente é de nosso desejo que uma função retorne algum resultado. Para que isso aconteça, é importante que você defina dentro do corpo de sua função o que ela deve retornar. Há duas maneiras principais de se definir esse resultado: 1) utilizando a palavra-chave <code>return()</code>; ou 2) ao final de sua função, executar algum comando que retorne por padrão algum resultado.</p>
<p>A palavra-chave <code>return()</code> é uma função especial que deve ser utilizada somente dentro do corpo de funções, ou dentro do corpo de outras construções parecidas como controles de fluxo (<code>if/else</code> <em>statements</em> e <em>loops</em>). Tudo que a função <code>return()</code> faz é retornar uma cópia do objeto sobre o qual ela foi aplicada e, em seguida, parar a execução da função que a executou.</p>
<p>Como exemplo, o último comando executado pela função <code>somar()</code> é <code>return(resultado)</code>. Sendo assim, quando <code>somar()</code> executar esse comando, <code>return()</code> nos retorna o objeto <code>resultado</code>, e automaticamente encerra a execução da função que a executou (nesse caso, a função <code>somar()</code>). Como essa função <code>return()</code> sempre finaliza a execução da função que chamou por ela, você geralmente inclui essa função <code>return()</code> ao final do corpo de sua função.</p>
<p></p>
<div class="sourceCode" id="cb1510"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1510-1"><a href="#cb1510-1" aria-hidden="true" tabindex="-1"></a>somar <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y){</span>
<span id="cb1510-2"><a href="#cb1510-2" aria-hidden="true" tabindex="-1"></a>  resultado <span class="ot">&lt;-</span> x <span class="sc">+</span> y</span>
<span id="cb1510-3"><a href="#cb1510-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(resultado)</span>
<span id="cb1510-4"><a href="#cb1510-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p></p>
<p>Mas existem funções que utilizam a função <code>return()</code> em diversos pontos de seu corpo. Como um exemplo mais extremo, observe a função <code>fizz_buzz()</code> abaixo, que possui 4 comandos <code>return()</code> diferentes em seu corpo. Essa função é uma representação do jogo popular “FizzBuzz,” o qual é muito comum em países de língua inglesa. A ideia do jogo, são duas pessoas contando de 1 até algum número limite, de maneira alternada. Porém, se a pessoa está prestes a contar um número múltiplo de 3, ao invés de dizer o número em si, ela deve dizer a palavra “Fizz,” caso seja um número múltiplo de 5, ela deve dizer a palavra “Buzz,” e se esse número for múltiplo de ambos (de 3 e de 5), ela deve falar “FizzBuzz.” Portanto, se fôssemos seguir o jogo, e contar de 1 até 16, a contagem seria: “1, 2, Fizz, 4, Buzz, Fizz, 7, 8, Fizz, Buzz, 11, Fizz, 13, 14, FizzBuzz, 16.”</p>
<p>Da maneira como ela está desenvolvida abaixo, a função <code>fizz_buzz()</code> aceita um número qualquer em seu argumento <code>x</code>. Primeiro, a função vai conferir se esse número é múltiplo de 3 e de 5. Caso o número seja múltiplo de 3 e de 5, ela vai executar o comando <code>return("FizzBuzz")</code>. Isso significa que <code>return()</code> vai terminar a execução de <code>fizz_buzz()</code> e retornar o texto <code>"FizzBuzz"</code> como resultado. Porém, se o número não for múltiplo de 3 e de 5, a função vai ignorar o comando <code>return("FizzBuzz")</code>, e prosseguir com sua execução. Depois, a função confere se <code>x</code> é múltiplo de 3, e caso seja, o comando <code>return("Fizz")</code> é executado, caso não, a função novamente ignora esse comando, e prossegue com sua execução. Depois, a função confere se <code>x</code> é múltiplo de 5, caso seja, ela avalia o comando <code>return("Buzz")</code>, caso contrário, ela novamente prossegue com sua execução. Por último, a função executa o comando <code>return(as.character(x))</code>, encerrando enfim, sua execução.</p>
<p></p>
<div class="sourceCode" id="cb1511"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1511-1"><a href="#cb1511-1" aria-hidden="true" tabindex="-1"></a>fizz_buzz <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb1511-2"><a href="#cb1511-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(x <span class="sc">%%</span> <span class="dv">3</span> <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> x <span class="sc">%%</span> <span class="dv">5</span> <span class="sc">==</span> <span class="dv">0</span>){</span>
<span id="cb1511-3"><a href="#cb1511-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="st">&quot;FizzBuzz&quot;</span>)</span>
<span id="cb1511-4"><a href="#cb1511-4" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1511-5"><a href="#cb1511-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1511-6"><a href="#cb1511-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(x <span class="sc">%%</span> <span class="dv">3</span> <span class="sc">==</span> <span class="dv">0</span>){</span>
<span id="cb1511-7"><a href="#cb1511-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="st">&quot;Fizz&quot;</span>)</span>
<span id="cb1511-8"><a href="#cb1511-8" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1511-9"><a href="#cb1511-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1511-10"><a href="#cb1511-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(x <span class="sc">%%</span> <span class="dv">5</span> <span class="sc">==</span> <span class="dv">0</span>){</span>
<span id="cb1511-11"><a href="#cb1511-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="st">&quot;Buzz&quot;</span>)</span>
<span id="cb1511-12"><a href="#cb1511-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1511-13"><a href="#cb1511-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1511-14"><a href="#cb1511-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">as.character</span>(x))</span>
<span id="cb1511-15"><a href="#cb1511-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1511-16"><a href="#cb1511-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1511-17"><a href="#cb1511-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1511-18"><a href="#cb1511-18" aria-hidden="true" tabindex="-1"></a><span class="fu">fizz_buzz</span>(<span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2&quot;</code></pre>
<div class="sourceCode" id="cb1513"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1513-1"><a href="#cb1513-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fizz_buzz</span>(<span class="dv">3</span>)</span></code></pre></div>
<pre><code>## [1] &quot;Fizz&quot;</code></pre>
<div class="sourceCode" id="cb1515"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1515-1"><a href="#cb1515-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fizz_buzz</span>(<span class="dv">5</span>)</span></code></pre></div>
<pre><code>## [1] &quot;Buzz&quot;</code></pre>
<div class="sourceCode" id="cb1517"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1517-1"><a href="#cb1517-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fizz_buzz</span>(<span class="dv">11</span>)</span></code></pre></div>
<pre><code>## [1] &quot;11&quot;</code></pre>
<div class="sourceCode" id="cb1519"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1519-1"><a href="#cb1519-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fizz_buzz</span>(<span class="dv">15</span>)</span></code></pre></div>
<pre><code>## [1] &quot;FizzBuzz&quot;</code></pre>
<p></p>
<p>Por outro lado, quando nós não incluímos algum <code>return()</code> dentro do corpo da função, ela sempre nos retorna o resultado da última expressão que ela executou. Por exemplo, eu poderia reescrever a função <code>somar()</code> da forma apresentada abaixo. Dessa maneira, quando executarmos essa função, ela vai nos retornar o resultado da última e única expressão avaliada por ela (<code>x + y</code>).</p>
<p></p>
<div class="sourceCode" id="cb1521"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1521-1"><a href="#cb1521-1" aria-hidden="true" tabindex="-1"></a>somar <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y){</span>
<span id="cb1521-2"><a href="#cb1521-2" aria-hidden="true" tabindex="-1"></a>  x <span class="sc">+</span> y</span>
<span id="cb1521-3"><a href="#cb1521-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1521-4"><a href="#cb1521-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1521-5"><a href="#cb1521-5" aria-hidden="true" tabindex="-1"></a><span class="fu">somar</span>(<span class="dv">5</span>, <span class="dv">10</span>)</span></code></pre></div>
<pre><code>## [1] 15</code></pre>
<p></p>
<p>Um outro exemplo seria a função <code>construir_perfil()</code> que apresentamos na seção passada. Perceba que o corpo da função termina com o comando <code>writeLines(perfil)</code>. Consequentemente, o resultado apresentado pela função <code>construir_perfil()</code> é o resultado dessa expressão <code>writeLines(perfil)</code>.</p>
<p>Uma outra forma comum de se retornar um resultado em uma função, é escrever o nome do objeto que você deseja retornar ao final do corpo da função. Com essa noção em mente, poderíamos reescrever novamente a função <code>somar()</code> da maneira abaixo. Como o último comando executado pela função <code>somar()</code> é uma chamada ao objeto <code>soma</code>, a função vai nos retornar o conteúdo desse objeto como resultado.</p>
<p></p>
<div class="sourceCode" id="cb1523"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1523-1"><a href="#cb1523-1" aria-hidden="true" tabindex="-1"></a>somar <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y){</span>
<span id="cb1523-2"><a href="#cb1523-2" aria-hidden="true" tabindex="-1"></a>  soma <span class="ot">&lt;-</span> x <span class="sc">+</span> y</span>
<span id="cb1523-3"><a href="#cb1523-3" aria-hidden="true" tabindex="-1"></a>  soma</span>
<span id="cb1523-4"><a href="#cb1523-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1523-5"><a href="#cb1523-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1523-6"><a href="#cb1523-6" aria-hidden="true" tabindex="-1"></a><span class="fu">somar</span>(<span class="dv">5</span>, <span class="dv">10</span>)</span></code></pre></div>
<pre><code>## [1] 15</code></pre>
<p></p>
<p>Todavia, um tipo de expressão que foge desse escopo, são expressões que criam novos objetos (<code>nome_objeto &lt;- valor</code>). Em outras palavras, se o corpo de sua função terminar em uma expressão desse tipo, nada será retornado. Veja o exemplo abaixo:</p>
<p></p>
<div class="sourceCode" id="cb1525"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1525-1"><a href="#cb1525-1" aria-hidden="true" tabindex="-1"></a>somar <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y){</span>
<span id="cb1525-2"><a href="#cb1525-2" aria-hidden="true" tabindex="-1"></a>  soma <span class="ot">&lt;-</span> x <span class="sc">+</span> y</span>
<span id="cb1525-3"><a href="#cb1525-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1525-4"><a href="#cb1525-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1525-5"><a href="#cb1525-5" aria-hidden="true" tabindex="-1"></a><span class="fu">somar</span>(<span class="dv">5</span>, <span class="dv">10</span>)</span></code></pre></div>
<p></p>
</div>
<div id="uma-função-não-precisa-necessariamente-retornar-algum-resultado" class="section level3" number="14.6.5">
<h3 number="14.6.5"><span class="header-section-number">14.6.5</span> Uma função não precisa necessariamente retornar algum resultado</h3>
<p>Caso você não defina explicitamente o que a sua função deve retornar, ela nunca vai retornar algum resultado para você. Vale ressaltar que, uma função não precisa necessariamente ter algum retorno, para que ela possa funcionar e executar os comandos descritos em seu corpo.</p>
<p>Algumas funções foram especificamente desenvolvidas de forma a não retornarem algum resultado visível para o seu usuário. Ao invés de calcularem um “resultado,” funções desse tipo, geralmente são funções que foram desenvolvidas com o intuito de produzir “efeitos colaterais” em sua sessão, ou, de outra maneira, são funções que buscam afetar outros objetos, <em>environments</em> e/ou configurações de sua sessão.</p>
<p>Diversas funções do pacote <code>knitr</code> funcionam dessa maneira. Um exemplo é a função <code>render_latex()</code> que está reproduzida abaixo. Perceba abaixo, que a função não possui ao final, algum <code>return()</code> ou o nome de algum objeto. Na realidade, o último comando executado no corpo de <code>render_latex()</code> é uma chamada a uma outra função chamada <code>set()</code>, que está armazenada em um objeto chamado <code>knit_hooks</code>.</p>
<p></p>
<div class="sourceCode" id="cb1526"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1526-1"><a href="#cb1526-1" aria-hidden="true" tabindex="-1"></a>render_latex <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb1526-2"><a href="#cb1526-2" aria-hidden="true" tabindex="-1"></a>  opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">out.width =</span> <span class="st">&#39;</span><span class="sc">\\</span><span class="st">maxwidth&#39;</span>, <span class="at">dev =</span> <span class="st">&#39;pdf&#39;</span>)</span>
<span id="cb1526-3"><a href="#cb1526-3" aria-hidden="true" tabindex="-1"></a>  opts_knit<span class="sc">$</span><span class="fu">set</span>(<span class="at">out.format =</span> <span class="st">&#39;latex&#39;</span>)</span>
<span id="cb1526-4"><a href="#cb1526-4" aria-hidden="true" tabindex="-1"></a>  h <span class="ot">&lt;-</span> opts_knit<span class="sc">$</span><span class="fu">get</span>(<span class="st">&#39;header&#39;</span>)</span>
<span id="cb1526-5"><a href="#cb1526-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">nzchar</span>(h[<span class="st">&#39;framed&#39;</span>])) <span class="fu">set_header</span>(<span class="at">framed =</span> .header.framed)</span>
<span id="cb1526-6"><a href="#cb1526-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">nzchar</span>(h[<span class="st">&#39;highlight&#39;</span>])) <span class="fu">set_header</span>(<span class="at">highlight =</span> .header.hi.tex)</span>
<span id="cb1526-7"><a href="#cb1526-7" aria-hidden="true" tabindex="-1"></a>  knit_hooks<span class="sc">$</span><span class="fu">set</span>(<span class="fu">hooks_latex</span>())</span>
<span id="cb1526-8"><a href="#cb1526-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p></p>
<p>Ao observamos mais atentamente o que essa função <code>set()</code> faz, podemos perceber que ao final, essa função executa o comando <code>invisible(NULL)</code>. A função <code>invisible()</code> é parecida com a função <code>return()</code>, no sentido de que ela simplesmente retorna para o usuário, uma cópia do objeto sobre o qual ela foi aplicada. No caso abaixo, <code>invisible()</code> está retornando uma cópia do valor <code>NULL</code>. Entretanto, essa cópia é na verdade uma cópia “invisível” do objeto. Dessa maneira, a função de fato retorna essa cópia como resultado, mas não mostra ele de forma visível para o seu usuário.</p>
<p></p>
<div class="sourceCode" id="cb1527"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1527-1"><a href="#cb1527-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>knit_hooks<span class="sc">$</span>set</span></code></pre></div>
<pre><code>## function (...) 
## {
##     dots = resolve(...)
##     if (length(dots)) 
##         defaults &lt;&lt;- merge(dots)
##     invisible(NULL)
## }
## &lt;bytecode: 0x000001a218f9b558&gt;
## &lt;environment: 0x000001a218f8f0c0&gt;</code></pre>
<p></p>
<p>Por essas características, se eu executar essa função em meu console, nada acontece, ou melhor, nada <strong>aparentemente</strong> acontece, pois a função está sim executando os comandos descritos em seu corpo, ela só não está retornando algo visível para nós.</p>
<p></p>
<div class="sourceCode" id="cb1529"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1529-1"><a href="#cb1529-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb1529-2"><a href="#cb1529-2" aria-hidden="true" tabindex="-1"></a><span class="fu">render_latex</span>()</span></code></pre></div>
<p></p>
</div>
<div id="como-retornar-múltiplos-resultados" class="section level3" number="14.6.6">
<h3 number="14.6.6"><span class="header-section-number">14.6.6</span> Como retornar múltiplos resultados</h3>
<p>Por padrão, uma função sempre retorna o resultado da última expressão executada por ela. Mas e se você precisasse que essa função retornasse os resultados de múltiplas expressões calculadas por ela de uma vez só? Dito de outra forma, suponha que você tenha vários objetos definidos dentro do corpo de sua função, e que você deseja acessar o conteúdo desses objetos em sua sessão. Como você faria isso?</p>
<p>Como exemplo, vamos supor que você possua uma função parecida com a função <code>aggs()</code> abaixo. Essa função aceita dois números como <em>input</em>, e calcula a soma, a divisão, o produto e a potência entre eles. Como faríamos para acessar os resultados de todas essas operações de uma vez só?</p>
<p>O método mais simples e direto de retornarmos todos esses resultados, seria, armazenarmos esses diferentes resultados em uma lista e, em seguida, pedir à função que nos retorne essa lista como resultado. Lembre-se que, você pode guardar o que você quiser dentro de uma lista. Repare no exemplo abaixo, que eu salvo os resultados de todas as operações individualmente e, depois, eu guardo todos esses resultados em uma lista e, por último, peço que a função me retorne essa lista com a função <code>return()</code>.</p>
<p></p>
<div class="sourceCode" id="cb1530"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1530-1"><a href="#cb1530-1" aria-hidden="true" tabindex="-1"></a>aggs <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y){</span>
<span id="cb1530-2"><a href="#cb1530-2" aria-hidden="true" tabindex="-1"></a>  soma <span class="ot">&lt;-</span> x <span class="sc">+</span> y</span>
<span id="cb1530-3"><a href="#cb1530-3" aria-hidden="true" tabindex="-1"></a>  div <span class="ot">&lt;-</span> x <span class="sc">/</span> y</span>
<span id="cb1530-4"><a href="#cb1530-4" aria-hidden="true" tabindex="-1"></a>  prod <span class="ot">&lt;-</span> x <span class="sc">*</span> y</span>
<span id="cb1530-5"><a href="#cb1530-5" aria-hidden="true" tabindex="-1"></a>  pot <span class="ot">&lt;-</span> x <span class="sc">^</span> y</span>
<span id="cb1530-6"><a href="#cb1530-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1530-7"><a href="#cb1530-7" aria-hidden="true" tabindex="-1"></a>  lista <span class="ot">&lt;-</span> <span class="fu">list</span>(soma, div, prod, pot)</span>
<span id="cb1530-8"><a href="#cb1530-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(lista) <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb1530-9"><a href="#cb1530-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;soma&quot;</span>, <span class="st">&quot;divisão&quot;</span>,</span>
<span id="cb1530-10"><a href="#cb1530-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;produto&quot;</span>, <span class="st">&quot;potência&quot;</span></span>
<span id="cb1530-11"><a href="#cb1530-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb1530-12"><a href="#cb1530-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(lista)</span>
<span id="cb1530-13"><a href="#cb1530-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1530-14"><a href="#cb1530-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1530-15"><a href="#cb1530-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1530-16"><a href="#cb1530-16" aria-hidden="true" tabindex="-1"></a><span class="fu">aggs</span>(<span class="dv">15</span>, <span class="dv">5</span>)</span></code></pre></div>
<pre><code>## $soma
## [1] 20
## 
## $divisão
## [1] 3
## 
## $produto
## [1] 75
## 
## $potência
## [1] 759375</code></pre>
<p></p>
</div>
</div>
<div id="implementando-verificações-e-bloqueios-em-sua-função" class="section level2" number="14.7">
<h2 number="14.7"><span class="header-section-number">14.7</span> Implementando verificações e bloqueios em sua função</h2>
<div id="exit-early-as-possible" class="section level3" number="14.7.1">
<h3 number="14.7.1"><span class="header-section-number">14.7.1</span> <em>Exit early as possible</em></h3>
<p>Um programa (ou <em>script</em>) do R é, em geral, construído a partir de um conjunto de funções. Essas funções coletam e utilizam vários <em>inputs</em> para produzirem um <em>output</em>. Contudo, para que uma função execute a tarefa para a qual ela foi desenvolvida, e da maneira correta, essa função precisa muitas vezes que certas condições sejam satisfeitas.</p>
<p>Com a frase <em>exit early as possible</em> (ou, “saia o mais rápido possível”) estou destacando a importância de conferirmos se essas condições são satisfeitas, e, caso seja necessário, pararmos o mais rápido possível a execução de uma função. Com isso em mente, essa frase poderia ser comparada com “primeiro de tudo, confirme que suas condições foram satisfeitas,” ou ainda, “se algo estiver errado, pare imediatamente!”</p>
<p>Portanto, em qualquer função que você venha a desenvolver no R, é sempre uma boa ideia iniciar essa função com um conjunto de conferências sobre os seus <em>inputs</em>. Se os <em>inputs</em> fornecidos à essa função, tiverem todas as características e atributos que você espera que eles tenham, você possui uma maior confiança de que a sua função vai funcionar da maneira correta. Porém, se algum desses <em>inputs</em> não satisfizerem alguma dessas condições, a sua função pode não ser capaz de lidar com esse <em>input</em> da forma esperada. Por essa razão, talvez seja melhor pararmos a execução, e avisarmos ao usuário de que o <em>input</em> que ele forneceu não é adequado para essa função.</p>
<p>Algumas funções que apresentamos até aqui, seguem esse princípio. Um exemplo é a função <code>readxl::read_excel()</code>. Como descrevemos no capítulo <a href="#sec:importando_dados">Importando e exportando dados com <code>readr</code>, <code>readxl</code> e <code>haven</code></a>, utilizamos essa função para ler planilhas do Excel (<code>.xlsx</code> ou <code>.xls</code>).</p>
<p>Logo abaixo, temos o <em>body</em> dessa função, ou em outras palavras, todos os comandos que ela executa. Perceba abaixo que, a primeira coisa que essa função <code>read_excel()</code> faz é executar duas outras funções (<code>check_format()</code> e <code>check_file()</code>).</p>
<p></p>
<div class="sourceCode" id="cb1532"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1532-1"><a href="#cb1532-1" aria-hidden="true" tabindex="-1"></a><span class="fu">body</span>(readxl<span class="sc">::</span>read_excel)</span></code></pre></div>
<pre><code>## {
##     path &lt;- check_file(path)
##     format &lt;- check_format(path)
##     read_excel_(path = path, sheet = sheet, range = range, col_names = col_names, 
##         col_types = col_types, na = na, trim_ws = trim_ws, skip = skip, 
##         n_max = n_max, guess_max = guess_max, progress = progress, 
##         .name_repair = .name_repair, format = format)
## }</code></pre>
<p></p>
<p>Essas duas funções são responsáveis pelas conferências necessárias sobre o principal <em>input</em> da função (que é o argumento <code>path</code>). Ao observarmos o <em>body</em> de <code>check_file()</code>, podemos perceber que a função realiza duas conferências principais: 1) primeiro, ela se certifica que o caminho fornecido à <code>read_excel()</code> é uma string (com a função <code>readxl:::is_string()</code>), ou, em outras palavras, um valor do tipo <code>character</code>; 2) segundo, a função se certifica que o caminho fornecido à <code>read_excel()</code> é válido, isto é, se o arquivo descrito nesse caminho existe de fato em meu computador (com a função <code>file.exists()</code>).</p>
<p></p>
<div class="sourceCode" id="cb1534"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1534-1"><a href="#cb1534-1" aria-hidden="true" tabindex="-1"></a><span class="fu">body</span>(readxl<span class="sc">:::</span>check_file)</span></code></pre></div>
<pre><code>## {
##     if (!is_string(path)) {
##         stop(&quot;`path` must be a string&quot;, call. = FALSE)
##     }
##     if (!file.exists(path)) {
##         stop(&quot;`path` does not exist: &quot;, sQuote(path), call. = FALSE)
##     }
##     path
## }</code></pre>
<p></p>
<p>Por que essas conferências são necessárias? Primeiro, porque caminhos até arquivos e diretórios devem ser fornecidos como <em>strings</em> no R, assim como em diversas outras linguagens de programação. Segundo, porque eu posso muito bem entregar à função, um caminho imaginário, ou seja, um caminho que não existe em meu computador. O que <code>read_excel()</code> deveria fazer nesse caso? Se o caminho não existe, será que ela deveria sequer tentar encontrar e ler o arquivo descrito nesse caminho? Provavelmente, o melhor a se fazer nesse caso seria simplesmente interrompermos a execução de <code>read_excel()</code>, e avisarmos ao usuário que o caminho dado não existe no computador em questão.</p>
<p>Este é exatamente o papel que a função <code>readxl:::check_file()</code> cumpre. Perceba acima que essa função utiliza um <code>if</code> <em>statement</em> para executar a função <code>stop()</code>, a depender do resultado de <code>!file.exists(path)</code>. Dessa forma, se a expressão <code>!file_exists(path)</code> retornar <code>FALSE</code>, significa que o arquivo descrito no <em>input</em> <code>path</code> existe em meu computador e, por isso, a função ignora completamente o comando <code>stop()</code> que está dentro do <code>if</code> <em>statement</em>. Porém, se a expressão <code>!file.exists(path)</code> retornar <code>TRUE</code>, o <code>if</code> <em>statement</em> vai executar o comando <code>stop()</code>, e toda a execução de <code>read_excel()</code> é interrompida com uma mensagem de erro, a qual avisa o usuário que o arquivo descrito em <code>path</code> não existe.</p>
<p>A função <code>readxl:::check_format()</code> realiza um trabalho parecido. Em resumo, essa função utiliza <code>readxl:::excel_format()</code> para determinar se o arquivo descrito em <code>path</code> é de fato uma planilha do Excel, isto é, se o arquivo possui extensão <code>.xslx</code> ou <code>.xls</code>. Para isso, a função confere com a expressão <code>is.na(format)</code>, se a função <code>readxl:::excel_format()</code> conseguiu determinar o formato do arquivo. Caso não tenha, é muito provável que o arquivo descrito em <code>path</code> não é uma planilha do Excel e, por esse motivo, a função executa o comando <code>stop()</code> que está dentro do <code>if</code> <em>statement</em>.</p>
<p></p>
<div class="sourceCode" id="cb1536"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1536-1"><a href="#cb1536-1" aria-hidden="true" tabindex="-1"></a><span class="fu">body</span>(readxl<span class="sc">:::</span>check_format)</span></code></pre></div>
<pre><code>## {
##     format &lt;- excel_format(path)
##     if (is.na(format)) {
##         stop(&quot;Can&#39;t establish that the input is either xls or xlsx.&quot;, 
##             call. = FALSE)
##     }
##     format
## }</code></pre>
<p></p>
<p>Portanto, sempre que você estiver desenvolvendo uma função (ou o seu <em>script</em> como um todo), reflita se há alguma condição que precisa ser satisfeita para que a sua função (ou o seu <em>script</em>) funcione de maneira adequada. Por exemplo, vamos voltar novamente à função <code>somar()</code>. Existe alguma condição que precisa ser satisfeita, para que essa função funcione como esperado? Como essa função busca somar dois <em>números</em>, você pode rapidamente chegar à conclusão de que ambos os <em>inputs</em> da função (<code>x</code> e <code>y</code>) devem ser valores numéricos. Logo, seria interessante incluirmos dentro dela um sistema de bloqueio que nos avise caso essa condição não se sustente, como está demonstrado abaixo:</p>
<p></p>
<div class="sourceCode" id="cb1538"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1538-1"><a href="#cb1538-1" aria-hidden="true" tabindex="-1"></a>somar <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y){</span>
<span id="cb1538-2"><a href="#cb1538-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1538-3"><a href="#cb1538-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.numeric</span>(x) <span class="sc">|</span> <span class="sc">!</span><span class="fu">is.numeric</span>(y)){</span>
<span id="cb1538-4"><a href="#cb1538-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">&quot;Um dos inputs (`x` ou `y`) não é um valor numérico!&quot;</span>)</span>
<span id="cb1538-5"><a href="#cb1538-5" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1538-6"><a href="#cb1538-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1538-7"><a href="#cb1538-7" aria-hidden="true" tabindex="-1"></a>  resultado <span class="ot">&lt;-</span> x <span class="sc">+</span> y</span>
<span id="cb1538-8"><a href="#cb1538-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(resultado)</span>
<span id="cb1538-9"><a href="#cb1538-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1538-10"><a href="#cb1538-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1538-11"><a href="#cb1538-11" aria-hidden="true" tabindex="-1"></a><span class="fu">somar</span>(<span class="dv">5</span>, <span class="st">&quot;15&quot;</span>)</span></code></pre></div>
<p></p>
<pre><code>Error in somar(5, &quot;15&quot;): Um dos inputs (`x` ou `y`) não é um valor numérico!</code></pre>
</div>
<div id="a-função-stop" class="section level3" number="14.7.2">
<h3 number="14.7.2"><span class="header-section-number">14.7.2</span> A função <code>stop()</code></h3>
<p>Quando queremos criar um sistema de bloqueio em nossa função, nós quase sempre recorremos à função <code>stop()</code> dentro de algum <code>if</code> <em>statement</em>. Como o próprio nome da função dá a entender, <code>stop()</code> encerra a execução da função que a executa, e retorna uma mensagem de erro. Você geralmente define essa mensagem de erro, através de uma <em>string</em> contendo a mensagem desejada.</p>
<p></p>
<div class="sourceCode" id="cb1540"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1540-1"><a href="#cb1540-1" aria-hidden="true" tabindex="-1"></a><span class="fu">stop</span>(<span class="st">&quot;Teste&quot;</span>)</span></code></pre></div>
<p></p>
<pre><code>Error: Teste</code></pre>
<p>É importante que você seja claro e objetivo nesta mensagem de erro, pois ela deve explicar brevemente (ou fornecer uma dica) para o usuário, sobre o que ele fez de errado com sua função. Muitas vezes, é útil explicar nessa mensagem, o porquê de sua função ter decidido executar o <code>stop()</code>. No exemplo abaixo, o <code>if</code> <em>statement</em> vai executar o <code>stop()</code> somente se o objeto <code>x</code> não for um valor numérico, logo, é natural que o <code>stop()</code> nos retorne uma mensagem dizendo explicitamente que o objeto <code>x</code> deveria ser um valor numérico.</p>
<p></p>
<div class="sourceCode" id="cb1542"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1542-1"><a href="#cb1542-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="st">&quot;5&quot;</span></span>
<span id="cb1542-2"><a href="#cb1542-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1542-3"><a href="#cb1542-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.numeric</span>(x)){</span>
<span id="cb1542-4"><a href="#cb1542-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stop</span>(<span class="st">&quot;O objeto `x` não é um valor numérico!&quot;</span>)</span>
<span id="cb1542-5"><a href="#cb1542-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p></p>
<pre><code>Error: O objeto `x` não é um valor numérico!</code></pre>
</div>
</div>
<div id="algumas-dicas-sobre-como-construir-a-sua-função" class="section level2" number="14.8">
<h2 number="14.8"><span class="header-section-number">14.8</span> Algumas dicas sobre como construir a sua função</h2>
<div id="construa-sua-função-aos-poucos" class="section level3" number="14.8.1">
<h3 number="14.8.1"><span class="header-section-number">14.8.1</span> Construa sua função aos poucos</h3>
<p>Não se apresse! Muitas vezes, você precisa inserir vários comandos dentro do corpo de sua função, para que ela cumpra o papel desejado. Cada um desses comandos pode ser uma fonte de erros ou de <em>bugs</em>. Por isso, o ideal é que você construa a sua função de forma incremental. Ou seja, adicione um comando, e teste a função. Se tudo der certo como planejado, adicione o próximo comando, e teste novamente a função. E assim por diante, até que você tenha adicionado todos os comandos necessários.</p>
<p>Por exemplo, suponha que seu objetivo fosse construir uma função que fosse capaz de reordenar as colunas de um <code>data.frame</code> qualquer, segundo uma ordenação alfabética (<code>reordenar_colunas()</code>). Qual seria o primeiro passo que essa função precisa cumprir? Primeiro, para aplicarmos uma ordenação alfabética precisamos saber os nomes das colunas do <code>data.frame</code> em questão. Podemos fazer isso com a função <code>colnames()</code>:</p>
<p></p>
<div class="sourceCode" id="cb1544"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1544-1"><a href="#cb1544-1" aria-hidden="true" tabindex="-1"></a>df_teste <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb1544-2"><a href="#cb1544-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">Produto =</span> <span class="fu">c</span>(<span class="st">&quot;Leite&quot;</span>, <span class="st">&quot;Leite&quot;</span>, <span class="st">&quot;Arroz&quot;</span>, <span class="st">&quot;Feijão&quot;</span>),</span>
<span id="cb1544-3"><a href="#cb1544-3" aria-hidden="true" tabindex="-1"></a>  Preço <span class="ot">=</span> <span class="fu">c</span>(<span class="fl">3.15</span>, <span class="fl">3.15</span>, <span class="fl">18.25</span>, <span class="fl">6.92</span>),</span>
<span id="cb1544-4"><a href="#cb1544-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">ID =</span> <span class="fu">c</span>(<span class="dv">1200</span>, <span class="dv">1200</span>, <span class="dv">1655</span>, <span class="dv">1987</span>),</span>
<span id="cb1544-5"><a href="#cb1544-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Estoque =</span> <span class="fu">c</span>(<span class="dv">500</span>, <span class="dv">500</span>, <span class="dv">1250</span>, <span class="dv">900</span>)</span>
<span id="cb1544-6"><a href="#cb1544-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1544-7"><a href="#cb1544-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1544-8"><a href="#cb1544-8" aria-hidden="true" tabindex="-1"></a>reordenar_colunas <span class="ot">&lt;-</span> <span class="cf">function</span>(df){</span>
<span id="cb1544-9"><a href="#cb1544-9" aria-hidden="true" tabindex="-1"></a>  cols <span class="ot">&lt;-</span> <span class="fu">colnames</span>(df)</span>
<span id="cb1544-10"><a href="#cb1544-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(cols)</span>
<span id="cb1544-11"><a href="#cb1544-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1544-12"><a href="#cb1544-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1544-13"><a href="#cb1544-13" aria-hidden="true" tabindex="-1"></a><span class="fu">reordenar_colunas</span>(df_teste)</span></code></pre></div>
<pre><code>## [1] &quot;Produto&quot; &quot;Preço&quot;   &quot;ID&quot;      &quot;Estoque&quot;</code></pre>
<p></p>
<p>Em seguida, podemos reordenar os nomes dessas colunas segundo uma ordenação alfabética. Podemos realizar esse passo, ao aplicarmos a função <code>sort()</code> sobre os nomes dessas colunas. Adiciono um novo comando ao corpo da função, e aplico ela novamente para conferir se está tudo funcionando:</p>
<p></p>
<div class="sourceCode" id="cb1546"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1546-1"><a href="#cb1546-1" aria-hidden="true" tabindex="-1"></a>reordenar_colunas <span class="ot">&lt;-</span> <span class="cf">function</span>(df){</span>
<span id="cb1546-2"><a href="#cb1546-2" aria-hidden="true" tabindex="-1"></a>  cols <span class="ot">&lt;-</span> <span class="fu">colnames</span>(df)</span>
<span id="cb1546-3"><a href="#cb1546-3" aria-hidden="true" tabindex="-1"></a>  cols <span class="ot">&lt;-</span> <span class="fu">sort</span>(cols)</span>
<span id="cb1546-4"><a href="#cb1546-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(cols)</span>
<span id="cb1546-5"><a href="#cb1546-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1546-6"><a href="#cb1546-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1546-7"><a href="#cb1546-7" aria-hidden="true" tabindex="-1"></a><span class="fu">reordenar_colunas</span>(df_teste)</span></code></pre></div>
<pre><code>## [1] &quot;Estoque&quot; &quot;ID&quot;      &quot;Preço&quot;   &quot;Produto&quot;</code></pre>
<p></p>
<p>Por último, podemos utilizar esse vetor com os nomes das colunas já ordenados, para reordenarmos o <code>data.frame</code> em questão, através de <em>subsetting</em>:</p>
<p></p>
<div class="sourceCode" id="cb1548"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1548-1"><a href="#cb1548-1" aria-hidden="true" tabindex="-1"></a>reordenar_colunas <span class="ot">&lt;-</span> <span class="cf">function</span>(df){</span>
<span id="cb1548-2"><a href="#cb1548-2" aria-hidden="true" tabindex="-1"></a>  cols <span class="ot">&lt;-</span> <span class="fu">colnames</span>(df)</span>
<span id="cb1548-3"><a href="#cb1548-3" aria-hidden="true" tabindex="-1"></a>  cols <span class="ot">&lt;-</span> <span class="fu">sort</span>(cols)</span>
<span id="cb1548-4"><a href="#cb1548-4" aria-hidden="true" tabindex="-1"></a>  df_reordenado <span class="ot">&lt;-</span> df[cols]</span>
<span id="cb1548-5"><a href="#cb1548-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1548-6"><a href="#cb1548-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(df_reordenado)</span>
<span id="cb1548-7"><a href="#cb1548-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1548-8"><a href="#cb1548-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1548-9"><a href="#cb1548-9" aria-hidden="true" tabindex="-1"></a><span class="fu">reordenar_colunas</span>(df_teste)</span></code></pre></div>
<pre><code>##   Estoque   ID Preço Produto
## 1     500 1200  3.15   Leite
## 2     500 1200  3.15   Leite
## 3    1250 1655 18.25   Arroz
## 4     900 1987  6.92  Feijão</code></pre>
<p></p>
<p>Com um primeiro protótipo da função funcionando, podemos pensar em melhorias para essa função. Por exemplo, podemos dar maior flexibilidade à função, ao permitir que <code>reordenar_colunas()</code> reordene as colunas segundo uma ordem crescente ou decrescente. Para isso, podemos adicionar um argumento <code>crescente</code> à função, e utilizar esse argumento para determinar se uma ordem crescente ou decrescente será aplicada por <code>sort()</code>.</p>
<p></p>
<div class="sourceCode" id="cb1550"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1550-1"><a href="#cb1550-1" aria-hidden="true" tabindex="-1"></a>reordenar_colunas <span class="ot">&lt;-</span> <span class="cf">function</span>(df, <span class="at">crescente =</span> <span class="cn">TRUE</span>){</span>
<span id="cb1550-2"><a href="#cb1550-2" aria-hidden="true" tabindex="-1"></a>  cols <span class="ot">&lt;-</span> <span class="fu">colnames</span>(df)</span>
<span id="cb1550-3"><a href="#cb1550-3" aria-hidden="true" tabindex="-1"></a>  cols <span class="ot">&lt;-</span> <span class="fu">sort</span>(cols, <span class="at">decreasing =</span> <span class="sc">!</span>crescente)</span>
<span id="cb1550-4"><a href="#cb1550-4" aria-hidden="true" tabindex="-1"></a>  df_reordenado <span class="ot">&lt;-</span> df[cols]</span>
<span id="cb1550-5"><a href="#cb1550-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1550-6"><a href="#cb1550-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(df_reordenado)</span>
<span id="cb1550-7"><a href="#cb1550-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1550-8"><a href="#cb1550-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1550-9"><a href="#cb1550-9" aria-hidden="true" tabindex="-1"></a><span class="fu">reordenar_colunas</span>(df_teste, <span class="at">crescente =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>##   Produto Preço   ID Estoque
## 1   Leite  3.15 1200     500
## 2   Leite  3.15 1200     500
## 3   Arroz 18.25 1655    1250
## 4  Feijão  6.92 1987     900</code></pre>
<p></p>
</div>
<div id="comece-por-um-caso-pequeno" class="section level3" number="14.8.2">
<h3 number="14.8.2"><span class="header-section-number">14.8.2</span> Comece por um caso pequeno</h3>
<p>Se o seu objetivo é, por exemplo, aplicar um modelo sobre 1000 bases de dados diferentes, comece tentando criar uma função que aplique esse modelo para apenas 1 dessas 1000 bases. Em outras palavras, é melhor ter primeiro uma barraca de pé e estável, do que tentar construir um castelo logo de cara!</p>
<p>Tentar lidar ao mesmo tempo com todas as dimensões do problema, como as especificações do modelo, o manuseio das bases, e a questão da expansão (ou de como aplicar o modelo) para as demais 999 tabelas, é um tiro no pé. O melhor que você pode fazer, é lidar com uma dimensão de cada vez. Ao isolarmos uma dessas 1000 bases, e utilizarmos ela como uma massa de teste, podemos nos concentrar em uma das dimensões, e adiarmos as demais até que elas precisem de fato ser resolvidas.</p>
</div>
<div id="se-você-possui-um-grande-objetivo-divida-ele-em-pequenos-passos" class="section level3" number="14.8.3">
<h3 number="14.8.3"><span class="header-section-number">14.8.3</span> Se você possui um grande objetivo, divida ele em pequenos passos</h3>
<p>Se você deseja construir uma função que cumpre um grande objetivo, é essencial que você quebre esse grande objetivo em vários pequenos passos. Ao dividir o seu grande objetivo em pequenos passos, você terá mais facilidade de implementar funções que cumprem cada um desses pequenos passos. Aos poucos, você vai construindo várias funções, que juntas, completam o seu grande objetivo.</p>
</div>
<div id="quando-puder-aproveite-e-suba-no-ombro-de-gigantes" class="section level3" number="14.8.4">
<h3 number="14.8.4"><span class="header-section-number">14.8.4</span> Quando puder, aproveite e suba no ombro de gigantes!</h3>
<p>Em certas ocasiões, o melhor conselho que nós podemos dar sobre como construir a sua função é: “não construa sua função!” ou “não perca o seu tempo tentando reinventar a roda.” Antes de construir qualquer função, é interessante que você faça uma rápida busca pelo Google, atrás de alguma função que já cumpra o trabalho que você deseja realizar. Por exemplo, e se você precisasse ler uma planilha de Excel? Porque eu deveria criar, do zero, uma nova função que lê esse tipo de arquivo, se eu posso me aproveitar de uma função já existente (<code>readxl::read_excel()</code>) ?</p>
<p>Portanto, a lição é: sempre que puder, se aproveite de funções já prontas! Suba nos ombros de quem já fez o trabalho duro por você! Se essa função já possui tudo o que você precisa, você economiza muito de seu tempo e avança mais rapidamente para o seu objetivo principal. Não há pecado nenhum em nos aproveitarmos de coisas já prontas para economizarmos muito de nosso tempo e esforço.</p>
<p>Contudo, existem duas situações em que, pode ser necessário que você crie uma função do zero, mesmo que já existam algumas alternativas prontas. Uma dessas situações, é quando você enfrenta um problema de performance. Ou seja, a alternativa já existente no R é muito lenta, e você conhece formas mais rápidas e eficientes de se realizar o mesmo cálculo. A outra situação, é quando a alternativa existente aplica um metodologia que apresenta algum conflito com o objetivo que você deseja atingir. Por exemplo, se uma função já existente estima uma regressão linear através do método OLS (<em>Ordinary Least Squares</em>), mas você precisa que essa regressão seja estimada pelo método ML (<em>Maximum Likelihood</em>).</p>
</div>
</div>
<div id="funções-anônimas" class="section level2" number="14.9">
<h2 number="14.9"><span class="header-section-number">14.9</span> Funções anônimas</h2>
<p>Lembre-se que, nós normalmente acessamos e aplicamos uma função no R, através do nome do objeto onde armazenamos a sua definição. Porém, você não precisa necessariamente salvar a sua definição em um objeto, para que você seja capaz de utilizar uma função. Tendo apenas a definição dessa função em mãos, o que na figura 14.1 representa toda a área verde escura, você já possui todos os métodos que descrevem como essa função funciona e de quais <em>inputs</em> ela precisa.</p>
<p>Entretanto, justamente pelo fato de você possuir apenas a definição dessa função, você é incapaz de utilizá-la através do modo tradicional, pois você não consegue se referir a essa definição através de um nome. Por esse motivo, quando temos apenas a definição de uma função, nós normalmente a denominamos de “função anônima,” ou <em>“anonymous function”</em>. Ou seja, ela se torna uma função sem “nome.”</p>
<p>Criar funções anônimas é uma prática muito comum no R quando estamos utilizando um certo conjunto de funções. Principalmente pela economia de digitação, pois não temos mais o trabalho de criarmos um objeto para armazenarmos essa definição. Normalmente, utilizamos essas funções anônimas em argumentos de outras funções, e existem uma infinidade de funções no R que aceitam outras funções em seus argumentos. Ou seja, muitas funções utilizam como <em>input</em>, uma outra função. Exemplos desses tipos de funções são <code>do.call()</code>, <code>lapply()</code> e <code>purrr::map()</code>.</p>
<p>Por conseguinte, se você possui apenas a definição de uma função (e não um objeto que contenha essa definição), e deseja aplicar essa definição sobre um conjunto de <em>inputs</em>, você precisa fornecer essa função anônima a uma outra função que possa aplicar essa definição por você. Como um exemplo, eu poderia rapidamente criar uma função anônima equivalente à <code>somar</code> mostrada na figura 14.1, e aplicá-la sobre um conjunto de <em>inputs</em> através da função <code>do.call()</code>, como demonstrado abaixo:</p>
<p></p>
<div class="sourceCode" id="cb1552"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1552-1"><a href="#cb1552-1" aria-hidden="true" tabindex="-1"></a><span class="fu">do.call</span>(</span>
<span id="cb1552-2"><a href="#cb1552-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(x, y) x <span class="sc">+</span> y,</span>
<span id="cb1552-3"><a href="#cb1552-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">x =</span> <span class="dv">15</span>, <span class="at">y =</span> <span class="dv">88</span>)</span>
<span id="cb1552-4"><a href="#cb1552-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## [1] 103</code></pre>
<p></p>
</div>
<div id="sec:oque_e_uma_funcao_R" class="section level2" number="14.10">
<h2 number="14.10"><span class="header-section-number">14.10</span> O que é uma função no R ?</h2>
<p>Para responder essa pergunta, quero destacar dois princípios fundamentais sobre a linguagem R apresentados na obra de <span class="citation"><a href="#ref-chambers2016" role="doc-biblioref">Chambers</a> (<a href="#ref-chambers2016" role="doc-biblioref">2016</a>)</span>:</p>
<ol style="list-style-type: decimal">
<li><p>Tudo que existe no R, são objetos.</p></li>
<li><p>Tudo que acontece no R, são chamadas a funções.</p></li>
</ol>
<p>Nós já comentamos sobre o primeiro princípio no capítulo de <a href="#sec:fundamentos_R">Fundamentos da Linguagem R</a>, mas vale a pena destacá-lo mais uma vez. Portanto, assim como os demais objetos que você cria em sua sessão, todas as funções existentes no R também são objetos. Você talvez tenha percebido isso, ao criarmos a função <code>normalizar()</code> na seção anterior.</p>
<p>Portanto, nós criamos funções no R ao salvarmos sua definição em um objeto através do operador de <em>assignment</em> (<code>&lt;-</code>), e acessamos posteriormente suas funcionalidades ao utilizar o objeto no qual essa função foi salva. O nome da função corresponde ao nome do objeto no qual está salvo a definição dessa função. Assim como os demais objetos disponíveis na linguagem, toda função possui uma classe e um tipo associados a ela. Por padrão, funções pertencem ao tipo <code>closure</code> e possuem a classe <code>function</code>. Tais características estão demonstradas abaixo, em que estou utilizando a função <code>rnorm()</code> como exemplo.</p>
<p></p>
<div class="sourceCode" id="cb1554"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1554-1"><a href="#cb1554-1" aria-hidden="true" tabindex="-1"></a><span class="fu">typeof</span>(rnorm)</span></code></pre></div>
<pre><code>## [1] &quot;closure&quot;</code></pre>
<div class="sourceCode" id="cb1556"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1556-1"><a href="#cb1556-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(rnorm)</span></code></pre></div>
<pre><code>## [1] &quot;function&quot;</code></pre>
<p></p>
<p>Contudo, de maneira oposta a diversos tipos de objetos no R, os operadores de <em>subsetting</em> (<code>[</code> e <code>[[</code>) não funcionam sobre funções. Tal fato está diretamente relacionado ao erro <code>"object of type 'closure' is not subsettable"</code>, o qual é um erro bem comum, tão comum que foi o título principal de uma palestra de Jenny Bryan na <code>rstudio::conf2020</code><a href="#fn41" class="footnote-ref" id="fnref41"><sup>41</sup></a>. Você pode facilmente reproduzir esse erro, ao aplicar um operador de <em>subsetting</em> sobre um objeto do tipo <code>closure</code>, isto é, sobre uma função qualquer.</p>
<p></p>
<div class="sourceCode" id="cb1558"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1558-1"><a href="#cb1558-1" aria-hidden="true" tabindex="-1"></a>rnorm[<span class="dv">1</span>]</span></code></pre></div>
<p></p>
<pre><code>Error in rnorm[1] : object of type &#39;closure&#39; is not subsettable</code></pre>
<p>Na visão do R, toda função possui 3 componentes principais, sendo eles: 1) os argumentos (<code>arguments</code>), ou os <em>inputs</em> da função; 2) o seu <code>body</code>, ou o corpo da função; 3) e o <em>environment</em> dessa função <span class="citation">(<a href="#ref-Rlanguage" role="doc-biblioref">R Core Team 2020b</a>; <a href="#ref-wickham2015_advanced" role="doc-biblioref">Wickham 2015a</a>)</span>. Vamos explicar em mais detalhes o que é um <em>environment</em>, por enquanto, apenas saiba que toda função possui um <em>environment</em> associado a ela. Você pode acessar os argumentos, o corpo e o <em>environment</em> associados a uma determinada função, através das funções <code>formals()</code>, <code>body()</code> e <code>environment()</code> respectivamente. Por padrão, a função <code>formals()</code> nos retorna uma lista, onde cada elemento dessa lista corresponde a um argumento da função. Os argumentos que já possuem um valor padrão, já vem preenchidos nessa lista com este valor padrão. Já os argumentos que não possuem um valor padrão, aparecem nesta lista preenchidos com um valor <code>NULL</code>.</p>
<p></p>
<div class="sourceCode" id="cb1560"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1560-1"><a href="#cb1560-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Os arguemntos da função rnorm():</span></span>
<span id="cb1560-2"><a href="#cb1560-2" aria-hidden="true" tabindex="-1"></a><span class="fu">formals</span>(rnorm)</span></code></pre></div>
<pre><code>## $n
## 
## 
## $mean
## [1] 0
## 
## $sd
## [1] 1</code></pre>
<div class="sourceCode" id="cb1562"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1562-1"><a href="#cb1562-1" aria-hidden="true" tabindex="-1"></a><span class="do">## O corpo da função rnorm():</span></span>
<span id="cb1562-2"><a href="#cb1562-2" aria-hidden="true" tabindex="-1"></a><span class="fu">body</span>(rnorm)</span></code></pre></div>
<pre><code>## .Call(C_rnorm, n, mean, sd)</code></pre>
<div class="sourceCode" id="cb1564"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1564-1"><a href="#cb1564-1" aria-hidden="true" tabindex="-1"></a><span class="do">## O environment associado à função rnorm():</span></span>
<span id="cb1564-2"><a href="#cb1564-2" aria-hidden="true" tabindex="-1"></a><span class="fu">environment</span>(rnorm)</span></code></pre></div>
<pre><code>## &lt;environment: namespace:stats&gt;</code></pre>
<p></p>
<p>Enquanto os argumentos e corpo de uma função são especificados de maneira explícita quando você cria essa função, o <em>environment</em> associado à função é determinado de forma implícita, com base em <strong>onde você define essa função</strong> <span class="citation">(<a href="#ref-wickham2015_advanced" role="doc-biblioref">Wickham 2015a</a>)</span>. Para além dessas características, você pode visualizar a definição completa de uma função, ao chamar pelo objeto onde essa função foi salva. Como exemplo, para visualizarmos todos os 3 componentes (argumentos, <code>body</code> e <code>environment</code>) da função <code>rnorm()</code>, basta chamarmos no console pelo objeto <code>rnorm</code>:</p>
<p></p>
<div class="sourceCode" id="cb1566"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1566-1"><a href="#cb1566-1" aria-hidden="true" tabindex="-1"></a>rnorm</span></code></pre></div>
<pre><code>## function (n, mean = 0, sd = 1) 
## .Call(C_rnorm, n, mean, sd)
## &lt;bytecode: 0x000001a21b148c98&gt;
## &lt;environment: namespace:stats&gt;</code></pre>
<p></p>
<p>Porém, temos um tipo de função especial que representa a única exceção a essa regra de que toda função no R possui 3 componentes. Esse tipo são as funções primitivas (<code>Primitive</code>), as quais são as funções que não possuem nenhum código em R escrito dentro delas. Essas funções, utilizam dentro delas a função <code>.Primitive()</code> para acessar rotinas escritas na linguagem C. Grande parte dessas funções primitivas são encontradas dentro do pacote <code>base</code> da linguagem, sendo um exemplo de função primitiva, a função <code>sum()</code>. Perceba abaixo que, dentro de <code>sum()</code>, temos apenas uma chamada à função <code>.Primitive()</code>, que procura por uma função chamada <code>sum</code> definida dentro das rotinas escritas em C.</p>
<p></p>
<div class="sourceCode" id="cb1568"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1568-1"><a href="#cb1568-1" aria-hidden="true" tabindex="-1"></a>sum</span></code></pre></div>
<pre><code>## function (..., na.rm = FALSE)  .Primitive(&quot;sum&quot;)</code></pre>
<div class="sourceCode" id="cb1570"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1570-1"><a href="#cb1570-1" aria-hidden="true" tabindex="-1"></a><span class="fu">formals</span>(sum)</span></code></pre></div>
<pre><code>## NULL</code></pre>
<div class="sourceCode" id="cb1572"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1572-1"><a href="#cb1572-1" aria-hidden="true" tabindex="-1"></a><span class="fu">body</span>(sum)</span></code></pre></div>
<pre><code>## NULL</code></pre>
<div class="sourceCode" id="cb1574"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1574-1"><a href="#cb1574-1" aria-hidden="true" tabindex="-1"></a><span class="fu">environment</span>(sum)</span></code></pre></div>
<pre><code>## NULL</code></pre>
<p></p>
<p>Tais funções primitivas inclusive possuem um tipo associado a elas diferente das demais (<code>builtin</code>), apesar de ainda possuírem a classe <code>function</code>.</p>
<p></p>
<div class="sourceCode" id="cb1576"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1576-1"><a href="#cb1576-1" aria-hidden="true" tabindex="-1"></a><span class="fu">typeof</span>(sum)</span></code></pre></div>
<pre><code>## [1] &quot;builtin&quot;</code></pre>
<div class="sourceCode" id="cb1578"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1578-1"><a href="#cb1578-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(sum)</span></code></pre></div>
<pre><code>## [1] &quot;function&quot;</code></pre>
<p></p>
<p>Prosseguindo, de acordo com o segundo princípio apresentado por <span class="citation"><a href="#ref-chambers2016" role="doc-biblioref">Chambers</a> (<a href="#ref-chambers2016" role="doc-biblioref">2016</a>)</span>, em qualquer operação que você realiza no R, por mais simples que ela pareça, você está realizando por trás múltiplas chamadas à várias funções diferentes. Com este princípio, <span class="citation"><a href="#ref-chambers2016" role="doc-biblioref">Chambers</a> (<a href="#ref-chambers2016" role="doc-biblioref">2016</a>)</span> busca principalmente destacar a característica “funcional” da linguagem R. Logo, apesar de ser uma linguagem baseada em objetos (isto é, uma linguagem que utiliza o paradigma OOP - <em>object-oriented programming</em>), o R também herdou algumas características do paradigma FP - <em>functional programming</em>. E por essa característica, autores como <span class="citation"><a href="#ref-chambers2016" role="doc-biblioref">Chambers</a> (<a href="#ref-chambers2016" role="doc-biblioref">2016</a>)</span> preferem caracterizar a linguagem R como uma <em>“Functional, object-based language”</em> (ou uma “linguagem funcional baseada em objetos”).</p>
<p>Em resumo, três características principais de <em>functional programming</em> estão presentes no R. Primeiro, toda expressão escrita no R pode ser reescrita em sua forma “funcional.” Por exemplo, quando escrevemos expressões como <code>(1 + 2)</code>, ou, <code>z[1] &lt;- x[1] + y[1]</code>, estamos indiretamente utilizando as funções <code>&lt;-</code>, <code>[&lt;-</code>, <code>(</code>, <code>[</code> e <code>+</code>. Como resultado, podemos reescrever essas expressões de uma forma mais <em>functional-based</em>, como se estivéssemos aplicando funções sobre os objetos envolvidos nessas expressões, como está apresentado abaixo. Portanto, mesmo que uma expressão no R não possua ou apresente de uma forma explícita alguma função, você certamente está executando alguma função nessa expressão, mesmo que de forma indireta.</p>
<p></p>
<div class="sourceCode" id="cb1580"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1580-1"><a href="#cb1580-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Reescrevendo a expressão: z &lt;- 10</span></span>
<span id="cb1580-2"><a href="#cb1580-2" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">&lt;-</span><span class="st">`</span>(z, <span class="dv">10</span>)</span>
<span id="cb1580-3"><a href="#cb1580-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Reescrevendo a expressão: 1 + 2</span></span>
<span id="cb1580-4"><a href="#cb1580-4" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">+</span><span class="st">`</span>(<span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb1580-5"><a href="#cb1580-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Reescrevendo a expressão: z + (y * (x ^ 0.5))</span></span>
<span id="cb1580-6"><a href="#cb1580-6" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">+</span><span class="st">`</span>( z, <span class="st">`</span><span class="at">(</span><span class="st">`</span>( <span class="st">`</span><span class="at">*</span><span class="st">`</span>(y, <span class="st">`</span><span class="at">(</span><span class="st">`</span>( <span class="st">`</span><span class="at">^</span><span class="st">`</span>(x, <span class="fl">0.5</span>) ))))</span>
<span id="cb1580-7"><a href="#cb1580-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Reescrevendo a expressão: z[1] &lt;- x[1] + y[1]</span></span>
<span id="cb1580-8"><a href="#cb1580-8" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">&lt;-</span><span class="st">`</span>(z, <span class="st">`</span><span class="at">[&lt;-</span><span class="st">`</span>(z, <span class="dv">1</span>, x[<span class="dv">1</span>] <span class="sc">+</span> y[<span class="dv">1</span>]))</span>
<span id="cb1580-9"><a href="#cb1580-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Ou ainda:</span></span>
<span id="cb1580-10"><a href="#cb1580-10" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">&lt;-</span><span class="st">`</span>(z, <span class="st">`</span><span class="at">[&lt;-</span><span class="st">`</span>(z, <span class="dv">1</span>, <span class="st">`</span><span class="at">+</span><span class="st">`</span>( <span class="st">`</span><span class="at">[</span><span class="st">`</span>(x, <span class="dv">1</span>), <span class="st">`</span><span class="at">[</span><span class="st">`</span>(y, <span class="dv">1</span>) )))</span></code></pre></div>
<p></p>
<p>Segundo, todo código no R pode ser representado através de uma árvore de chamadas a funções (ou <em>tree of function calls</em>). Na figura 14.2, temos essa representação para a expressão <code>x &lt;- y + 2</code>. Perceba que, inicialmente é realizado uma chamada à função <code>&lt;-</code> contendo dois argumentos. O primeiro argumento corresponde ao objeto <code>x</code>, e o segundo, a uma nova chamada à uma função. Nessa segunda chamada, é executada a função <code>+</code> com dois outros argumentos, sendo eles o objeto <code>y</code> e a constante <code>2</code>.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/call_tree.png" alt="Representando uma expressão do R em uma árvore de chamadas a funções - Exemplo 1" width="90%" />
<p class="caption">
(#fig:unnamed-chunk-825)Representando uma expressão do R em uma árvore de chamadas a funções - Exemplo 1
</p>
</div>
<p></p>
<p>Portanto, todo comando no R é executado como uma sequência de <em>function calls</em>, e pode ser representado através dessa relação sequencial. Como um outro exemplo, poderíamos desenhar novamente essa árvore de <em>function calls</em> de forma a representar a expressão <code>x - mean(x) / sd(x)</code>. Como temos um número maior de funções envolvidas nessa expressão, a árvore que a representa é mais profunda, mas o raciocínio permanece o mesmo.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/call_tree2.png" alt="Representando uma expressão do R em uma árvore de chamadas a funções - Exemplo 2" width="90%" />
<p class="caption">
(#fig:unnamed-chunk-826)Representando uma expressão do R em uma árvore de chamadas a funções - Exemplo 2
</p>
</div>
<p></p>
<p>Terceiro, toda função executa as suas tarefas em um <em>environment</em> diferente do seu, ou, em outras palavras, em um contexto separado dos demais. Isto significa que, quando chamamos por uma função do R, é criado um novo contexto (ou um novo <em>envirnoment</em>) em sua sessão, e essa função executa as suas tarefas dentro desse contexto separado, onde um objeto é criado para cada um dos argumentos da função, e os valores desses objetos correspondem aos valores que fornecemos aos argumentos na chamada à função. O resultado final da execução dessa função, é o valor gerado ao executarmos os comandos que formam o corpo (ou o <code>body</code>) da função, neste <em>environment</em> separado <span class="citation">(<a href="#ref-chambers2016" role="doc-biblioref">Chambers 2016</a>, p 52)</span>.</p>
<p>Isso garante maior confiança e reprodutibilidade dos resultados gerados por essa função, pois eles podem ser gerados de forma independente dos demais contextos <span class="citation">(<a href="#ref-chambers2016" role="doc-biblioref">Chambers 2016</a>)</span>. Portanto, mesmo que eu esteja redefinindo um objeto chamado <code>x</code> dentro de minha função, e que eu já possua um objeto chamado <code>x</code> salvo em minha sessão (ou em meu <em>global environment</em>), quando eu executar essa função, ela vai criar um objeto <code>x</code> em um ambiente separado do meu, e, por isso, a função não vai afetar de forma alguma os objetos salvos em minha sessão.</p>
<p></p>
<div class="sourceCode" id="cb1581"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1581-1"><a href="#cb1581-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb1581-2"><a href="#cb1581-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(x)</span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<div class="sourceCode" id="cb1583"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1583-1"><a href="#cb1583-1" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb1583-2"><a href="#cb1583-2" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb1583-3"><a href="#cb1583-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1583-4"><a href="#cb1583-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1583-5"><a href="#cb1583-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Executei a função:</span></span>
<span id="cb1583-6"><a href="#cb1583-6" aria-hidden="true" tabindex="-1"></a><span class="fu">f</span>()</span>
<span id="cb1583-7"><a href="#cb1583-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1583-8"><a href="#cb1583-8" aria-hidden="true" tabindex="-1"></a><span class="co"># O resultado abaixo continua sendo 1, ao invés de 1000</span></span>
<span id="cb1583-9"><a href="#cb1583-9" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(x)</span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<p></p>
<p>Logo, esta terceira característica do R, representa uma concepção mais flexível do paradigma FP. Pois normalmente, a execução de uma função no R não afeta de forma alguma os objetos salvos em meu ambiente principal de trabalho, mas se eu quiser, eu posso permitir que os objetos salvos em meu ambiente afetem o resultado gerado por uma função, principalmente se eu utilizo um de meus objetos dentro do <code>body</code> dessa função. Como um exemplo, suponha que eu tenha a função <code>dobrar()</code> abaixo. Repare abaixo que, essa função não possui nenhum argumento (ou nenhum <em>input</em>) definido.</p>
<p>Portanto, como essa função está gerando o resultado abaixo de 200 ? Assim como em qualquer outra função, o R vai começar a executar os comandos descritos no <code>body</code> dessa função. Ao analisar a expressão <code>x * 2</code>, o R percebe que ele precisa de um objeto chamado <code>x</code> para executar essa expressão. Consequentemente, o R inicia um processo de busca, em que ele procura por um objeto chamado <code>x</code> ao longo de todos os contextos ativos em minha sessão. Assim que ele chega ao meu ambiente, ele percebe que eu defini logo antes da função, um objeto chamado <code>x</code> e, por isso, ele utiliza o valor armazenado neste objeto no <code>body</code> da função <code>dobrar()</code>.</p>
<p></p>
<div class="sourceCode" id="cb1585"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1585-1"><a href="#cb1585-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb1585-2"><a href="#cb1585-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1585-3"><a href="#cb1585-3" aria-hidden="true" tabindex="-1"></a>dobrar <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb1585-4"><a href="#cb1585-4" aria-hidden="true" tabindex="-1"></a>  x <span class="sc">*</span> <span class="dv">2</span></span>
<span id="cb1585-5"><a href="#cb1585-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1585-6"><a href="#cb1585-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1585-7"><a href="#cb1585-7" aria-hidden="true" tabindex="-1"></a><span class="fu">dobrar</span>()</span></code></pre></div>
<pre><code>## [1] 200</code></pre>
<p></p>
<p>Caso eu elimine, ou altere esse objeto <code>x</code> salvo em minha sessão de alguma maneira, eu posso alterar diretamente o resultado gerado pela função <code>dobrar()</code>.</p>
<p></p>
<div class="sourceCode" id="cb1587"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1587-1"><a href="#cb1587-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Alterando o objeto x salvo em meu ambiente</span></span>
<span id="cb1587-2"><a href="#cb1587-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">500</span></span>
<span id="cb1587-3"><a href="#cb1587-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1587-4"><a href="#cb1587-4" aria-hidden="true" tabindex="-1"></a><span class="fu">dobrar</span>()</span></code></pre></div>
<pre><code>## [1] 1000</code></pre>
<p></p>
<p>Outras linguagens que adotam o paradigma FP de maneira mais fiel, em geral, abraçam esse conceito de independência de contextos de forma mais rígida. Por isso, o R nos traz o que tem de melhor do paradigma FP (que é a maior confiança e reprodutibilidade dos resultados), mas ao mesmo tempo, não tenta ser muito restritivo sobre o que um usuário é capaz de fazer com os contextos que ele cria dentro da linguagem.</p>
<p>Concluindo, funções no R são objetos e, por isso, nós criamos uma nova função ao salvarmos sua definição em um novo objeto, e utilizamos essa função, através do nome do objeto no qual a sua definição foi armazenada. Para além disso, funções representam a base de como a linguagem R funciona, pois, a forma como essas funções se comportam e realizam as suas tarefas, determina diretamente os resultados que a linguagem gera.</p>
</div>
<div id="exercícios-10" class="section level2 unnumbered">
<h2 class="unnumbered">Exercícios</h2>
<p><strong>Questão 14.1.</strong> Em cada item abaixo, você deve construir uma função que se encaixe nos requisitos explicitados:</p>
<p>14.1.A) Construa uma função que aceite um número variável de argumentos, e que, retorne esses argumentos em uma lista.</p>
<p>14.1.B) Construa uma função que receba o raio de um círculo, e que calcule a área desse círculo. Vale destacar que, o R já possui um objeto pré-definido chamado <code>pi</code> que contém o número pi (<span class="math inline">\(\pi\)</span>).</p>
<p><strong>Questão 14.2.</strong> Tente construir uma função que receba uma palavra qualquer como <em>input</em> e, que retorne o <em>scrabble score</em> para essa palavra como <em>output</em>. O <em>scrabble score</em> é basicamente uma pontuação baseada nas letras que estão presentes em um uma palavra. Cada letra possui uma pontuação diferente e, você deve somar a pontuação de cada letra para chegar ao <em>scrabble score</em> da palavra. Em mais detalhes, as letras A, E, I, O, U, L, N, R, S e T valem 1 ponto cada uma; as letras D e G, valem 2 pontos; as letras B, C, M e P, 3 pontos; as letras F, H, V, W e Y, 4 pontos; a letra K, 5 pontos; as letras J e X, 8 pontos; as letras Q e Z, 10 pontos. Tendo as pontuações do parágrafo anterior em mente, temos que a palavra “bateria” possui um <em>scrabble score</em> total de 9 pontos (<span class="math inline">\(3 + 1 + 1 + 1 + 1 + 1 + 1 = 9\)</span>). Por outro lado, a palavra “metallica” possui um total de 13 pontos. Vale destacar que o jogo <em>scrabble</em> foi inicialmente desenvolvido para o alfabeto da língua inglesa, o qual não possui acentos de nenhuma natureza. Portanto, para que você não tenha que lidar com tal complexidade, considere que sua função vai receber apenas letras sem acentos. Como um exemplo de teste, você pode aplicar a sua função sobre cada palavra contida no vetor <code>w</code> abaixo, e verificar se o resultado de sua função equivale aos elementos correspondentes do vetor <code>p</code>. Ou seja, se a sua função aplicada à terceira palavra de <code>w</code>, retornar um valor diferente do terceiro elemento de <code>p</code>, sua função não está funcionando corretamente.</p>
<p></p>
<div class="sourceCode" id="cb1589"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1589-1"><a href="#cb1589-1" aria-hidden="true" tabindex="-1"></a>w <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;isabela&quot;</span>, <span class="st">&quot;caderno&quot;</span>, <span class="st">&quot;mouse&quot;</span>, <span class="st">&quot;elevador&quot;</span>,</span>
<span id="cb1589-2"><a href="#cb1589-2" aria-hidden="true" tabindex="-1"></a>       <span class="st">&quot;solar&quot;</span>, <span class="st">&quot;gaveta&quot;</span>, <span class="st">&quot;porta&quot;</span>, <span class="st">&quot;eduardo&quot;</span>)</span>
<span id="cb1589-3"><a href="#cb1589-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1589-4"><a href="#cb1589-4" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">9</span>, <span class="dv">10</span>, <span class="dv">7</span>, <span class="dv">12</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">7</span>, <span class="dv">9</span>)</span></code></pre></div>
<p></p>
<!-- **Questão 14.3.** Dessa vez, temos um desafio mais complexo. O seu objetivo neste exercício, é criar uma função que criptografe uma determinada mensagem. Ou seja, essa função vai receber uma mensagem de texto, e vai retornar  -->
<!-- ```{r} -->
<!-- mensagem <- "Estive em Valadares hoje, porém, vou para Uberlândia amanhã" -->
<!-- crypto <- function(text){ -->
<!--   text <- str_to_lower(text) -->
<!--   text <- stringr::str_replace_all(text, "[!?.:-_, ]", "") -->
<!--   text_length <- stringr::str_length(text) -->
<!--   tab <- expand.grid( -->
<!--       c = 1:text_length, -->
<!--       r = 1:text_length -->
<!--     ) %>%  -->
<!--     mutate( -->
<!--       mult = c * r -->
<!--     ) %>%  -->
<!--     filter(mult >= text_length, c >= r, c - r <= 1) %>%  -->
<!--     arrange(c) -->
<!--   columns <- tab$c[1] -->
<!--   rows <- tab$r[1] -->
<!--   n_blocks <- floor(text_length / columns) -->
<!--   starts <- cumsum(rep.int(columns, times = n_blocks)) - columns + 1  -->
<!--   ends <- cumsum(rep.int(columns, times = n_blocks)) -->
<!--   m <- matrix(c(starts, ends), ncol = 2) -->
<!--   ### Ainda corrigir esse problema: -->
<!--   ### Warning message: -->
<!--   ### In matrix(., ncol = columns, nrow = rows, byrow = TRUE) : -->
<!--   ###   data length [48] is not a sub-multiple or multiple of the number of rows [7] -->
<!--   result <- str_sub(text, start = m) %>% -->
<!--     str_split("") %>%  -->
<!--     unlist() %>%  -->
<!--     matrix(ncol = columns, nrow = rows, byrow = TRUE) %>%  -->
<!--     as.vector() %>%  -->
<!--     str_c(collapse = "") -->
<!--   return(text) -->
<!-- } -->
<!-- crypto(mensagem) -->
<!-- ``` -->
<!--chapter:end:05-funcoes-loops.Rmd-->
</div>
</div>
<div id="loops" class="section level1" number="15">
<h1 number="15"><span class="header-section-number">15</span> <em>Loops</em></h1>
<div id="introdução-1" class="section level2" number="15.1">
<h2 number="15.1"><span class="header-section-number">15.1</span> Introdução</h2>
<p>Os <em>loop</em>’s são uma outra categoria de controles de fluxo que praticamente toda linguagem de programação oferece. Portanto, eles impactam a ordem em que certos comandos são avaliados pelo R. Sendo mais preciso, um <em>loop</em> te permite executar múltiplas vezes um mesmo conjunto de comandos, criando assim, um “espaço de repetição” no fluxo de execução de seu programa.</p>
<p><em>Loop</em>’s são particularmente úteis, quando desejamos replicar uma mesma função (ou um mesmo conjunto de comandos) sobre vários <em>inputs</em> diferentes. <em>Loop</em>’s também são parte essencial quando desejamos trabalhar com listas (<code>list</code>), seja caminhando por ela (isto é, visitando cada um de seus elementos), ou modificando-a de uma forma simples e automatizada.</p>
</div>
<div id="o-que-são-loops" class="section level2" number="15.2">
<h2 number="15.2"><span class="header-section-number">15.2</span> O que são <em>loops</em> ?</h2>
<p>Um <em>loop</em> te permite executar repetidas vezes um mesmo conjunto de comandos, e, assim como ocorre em outras linguagens, nós temos diferentes “tipos” de loops no R. Mais especificamente, a linguagem oferece três tipos explícitos de <em>loop</em> que são: 1) <code>for</code> <em>loop</em>; 2) <code>while</code> <em>loop</em>; 3) <code>repeat</code> <em>loop</em>. Além disso, a linguagem também oferece as palavras-chave <code>next</code> e <code>break</code>, que oferecem maior controle sobre a execução de loops <span class="citation">(<a href="#ref-Rlanguage" role="doc-biblioref">R Core Team 2020b</a>)</span>. Também temos tipos implícitos de <em>loop</em> oferecidos pela família de funções <code>apply</code> (<code>apply()</code>, <code>tapply()</code>, <code>sapply()</code>, <code>vapply()</code>, e <code>lapply()</code>). Entretanto, vamos focar por enquanto neste capítulo nos tipos explícitos de loop.</p>
<p>A diferença entre cada tipo de loop, está apenas em como eles determinam o número de repetições que eles vão executar, ou em como eles decidem parar essa repetição. O tipo mais simples de todos é provavelmente o <code>while</code> <em>loop</em>, que em resumo, vai repetir um certo conjunto de comandos, enquanto uma certa condição lógica resultar em <code>TRUE</code>. Por outro lado, o tipo mais genérico de todos é o <code>for</code> <em>loop</em>, que vai repetir os comandos de acordo com um “índice de repetição.” E o tipo menos comum de todos é o <code>repeat</code> <em>loop</em>, que vai repetir o conjunto de comandos indefinidamente, até que uma condição de <code>break</code> seja executada.</p>
<p>O exemplo mais simples de um loop, provavelmente seria um <code>for</code> <em>loop</em> que simplesmente nos mostra o valor que o seu iterador assume a cada repetição. Tal exemplo está reproduzido abaixo. Perceba que a cada repetição do <code>for</code> <em>loop</em>, ele está executando o comando <code>print(i)</code>. Descrevendo de outra forma, a cada repetição do <code>for</code> <em>loop</em>, a função <code>print()</code> é executada, a qual procura por um objeto chamado <code>i</code>, e nos retorna como resultado, o conteúdo desse objeto. No exemplo abaixo, esse objeto <code>i</code> é o “iterador” do <code>for</code> <em>loop</em>. Esse iterador é um objeto que guarda o índice de repetição do loop.</p>
<p></p>
<div class="sourceCode" id="cb1590"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1590-1"><a href="#cb1590-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>){</span>
<span id="cb1590-2"><a href="#cb1590-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(i)</span>
<span id="cb1590-3"><a href="#cb1590-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## [1] 1
## [1] 2
## [1] 3
## [1] 4
## [1] 5</code></pre>
<p></p>
</div>
<div id="descrevendo-um-for-loop" class="section level2" number="15.3">
<h2 number="15.3"><span class="header-section-number">15.3</span> Descrevendo um <code>for</code> <em>loop</em></h2>
<p>Um <code>for</code> <em>loop</em> é sempre iniciado pela palavra-chave <code>for</code>, seguido por um par de parênteses, onde é feita a “definição do loop,” e, depois, por um par de chaves, onde é incluído o “corpo do loop,” ou o conjunto de comandos que vão ser executados em cada repetição. Portanto, todo <code>for</code> <em>loop</em> possui esses dois componentes: definição e corpo. Todo <code>while</code> <em>loop</em> também possui essas duas partes, contudo, um <code>repeat</code> <em>loop</em> possui apenas o corpo. Para uma noção mais clara, eu delimitei cada componente na figura 15.1.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/loop1.png" alt="Componentes de um `for` *loop*" width="90%" />
<p class="caption">
(#fig:unnamed-chunk-832)Componentes de um <code>for</code> <em>loop</em>
</p>
</div>
<p></p>
<div id="definição" class="section level3" number="15.3.1">
<h3 number="15.3.1"><span class="header-section-number">15.3.1</span> Definição</h3>
<p>A definição de um <code>for</code> <em>loop</em> é formada dentro de um par de parênteses, logo após a palavra-chave <code>for</code>. Dentro desse par de parênteses, temos três itens diferentes: 1) um iterador, ou, um “índice de iteração”; 2) a palavra-chave <code>in</code>; e 3) um objeto qualquer (geralmente um vetor). Essa definição deve sempre conter esses três itens.</p>
<p>Um iterador é um objeto (ou uma variável) que será reservado para conter o índice do loop. Em outras palavras, o iterador é um objeto criado pelo <code>for</code> <em>loop</em>, que será responsável por armazenar o índice de repetição do loop. A cada repetição, o iterador de um <code>for</code> <em>loop</em> vai assumir um valor diferente. Mais especificamente, ele vai armazenar um elemento diferente do objeto que você forneceu após a palavra-chave <code>in</code>.</p>
<p>Ou seja, esse objeto (ou o “terceiro item” da definição) que você forneceu determina o conjunto de valores que o iterador vai assumir ao longo da execução do <code>for</code> <em>loop</em>. Por exemplo, se eu forneço o vetor <code>1:5</code>, significa que o iterador vai assumir os valores 1, 2, 3, 4 e 5 ao longo da execução do loop. Mas se eu forneço o vetor <code>c("Ana", "Eduardo", "Márcia")</code>, então esse iterador vai assumir os valores <code>"Ana"</code>, <code>"Eduardo"</code> e <code>"Márcia"</code> a medida em que o <em>loop</em> realiza suas repetições.</p>
<p>Portanto, na 1° repetição do loop, o iterador vai conter o 1° elemento do objeto que você forneceu após a palavra-chave <code>in</code>, já na 2° repetição, o iterador vai conter o 2° elemento, e assim por diante. O que será cada um desses elementos, vai depender do objeto que você forneceu e da estrutura de dados que ele utiliza. Perceba no exemplo abaixo, que o iterador <code>i</code> assume o valor <code>"a"</code> na 1° repetição do loop, depois, o valor <code>"b"</code> na 2° repetição, e depois, o valor <code>"c"</code> na 3° e última repetição do loop.</p>
<p></p>
<div class="sourceCode" id="cb1592"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1592-1"><a href="#cb1592-1" aria-hidden="true" tabindex="-1"></a>letras <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>)</span>
<span id="cb1592-2"><a href="#cb1592-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1592-3"><a href="#cb1592-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> letras){</span>
<span id="cb1592-4"><a href="#cb1592-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(i)</span>
<span id="cb1592-5"><a href="#cb1592-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## [1] &quot;a&quot;
## [1] &quot;b&quot;
## [1] &quot;c&quot;</code></pre>
<p></p>
<p>Repare também pelo exemplo acima, que o tamanho (ou o número de elementos) do objeto que você forneceu, determina o número de repetições que o <code>for</code> <em>loop</em> vai executar. Desse modo, se um <code>while</code> <em>loop</em> utiliza uma condição lógica para determinar o número de iterações a serem executadas, um <code>for</code> <em>loop</em> se baseia apenas no número de elementos presentes no objeto que você estabeleceu na definição do loop. Logo, se você utiliza, por exemplo, um <code>data.frame</code> de 5 colunas, o <code>for</code> <em>loop</em> vai repetir os comandos 5 vezes, mas se você utiliza uma lista de 30 elementos, então o <code>for</code> <em>loop</em> vai iterar 30 vezes sobre os comandos definidos em seu corpo.</p>
<p>Ainda observando o exemplo acima, ao invés de fornecermos um vetor de <code>character</code>’s, é mais comum fornecermos um vetor contendo uma sequência de <code>integer</code>’s, utilizando o operador <code>:</code> (como <code>1:10</code>) ou funções de sequência como <code>seq_along()</code> e <code>seq_len()</code>. Dessa forma, o iterador se comporta como um índice numérico, que representa o número da repetição em que o <em>loop</em> se encontra. Dito de outra forma, se o meu <em>loop</em> está na 1° repetição, o iterador vai conter o valor 1, se o <em>loop</em> está na 2° repetição, o iterador passa a conter o valor 2, e assim por diante.</p>
<p>Portanto, eu poderia muito bem reescrever o <em>loop</em> anterior, utilizando dessa vez um índice numérico para acessar os elementos do vetor <code>letras</code>. Repare abaixo, que estou utilizando o índice numérico do iterador em conjunto com <em>subsetting</em>, para acessar cada elemento do vetor <code>letras</code>.</p>
<p></p>
<div class="sourceCode" id="cb1594"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1594-1"><a href="#cb1594-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_along</span>(letras)){</span>
<span id="cb1594-2"><a href="#cb1594-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(letras[i])</span>
<span id="cb1594-3"><a href="#cb1594-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## [1] &quot;a&quot;
## [1] &quot;b&quot;
## [1] &quot;c&quot;</code></pre>
<p></p>
<p>Perceba também no exemplo acima, que estou aplicando a função <code>seq_along()</code> sobre o vetor <code>letras</code>. Tudo que essa função faz, é me retornar uma sequência de 1 até o número de elementos contidos no objeto em que apliquei ela. Logo, o resultado de <code>seq_along()</code> no caso acima, é um vetor contendo uma sequência de 1 a 3. Isso também significa que, eu poderia muito bem substituir essa expressão <code>seq_along(letras)</code> por <code>1:3</code>, ou, <code>c(1, 2, 3)</code>, ou, <code>1:length(letras)</code>.</p>
<p>A função <code>seq_len()</code> é irmã de <code>seq_along()</code>. Essa função gera uma sequência de 1 até o número que você oferecer à função. Ou seja, a expressão <code>seq_len(3)</code> é equivalente a <code>1:3</code>, e <code>seq_len(100)</code>, à <code>1:100</code>, e assim por diante. Tendo isso em mente, poderíamos reescrever o <em>loop</em> acima da seguinte maneira:</p>
<p></p>
<div class="sourceCode" id="cb1596"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1596-1"><a href="#cb1596-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="fu">length</span>(letras))){</span>
<span id="cb1596-2"><a href="#cb1596-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(letras[i])</span>
<span id="cb1596-3"><a href="#cb1596-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## [1] &quot;a&quot;
## [1] &quot;b&quot;
## [1] &quot;c&quot;</code></pre>
<p></p>
<p>Caso o resultado da expressão <code>length(letras)</code> fosse igual a zero, as funções <code>seq_along()</code> e <code>seq_len()</code> nos retornaria um vetor do tipo <code>integer</code> de comprimento zero. Dessa forma, o <code>for</code> <em>loop</em> não é executado pelo R. Ou seja, como o vetor em questão estaria vazio, o iterador do <code>for</code> <em>loop</em> não teria nenhum elemento para iterar sobre.</p>
<p>Uma expressão como <code>1:length(x)</code> funciona perfeitamente bem quando o vetor <code>x</code> possui comprimento maior que 1. Todavia, quando esse vetor possui comprimento zero, a expressão <code>1:length(x)</code> acaba nos retornando <code>1:0</code> (isto é, o vetor <code>c(1, 0)</code>) como resultado, ao invés de um vetor vazio. Um detalhe como esse, pode causar erros no mínimo medonhos e de difícil rastreabilidade quando utilizamos esse vetor em um <code>for</code> <em>loop</em>. Ao evidenciar essa diferença, quero destacar que as funções <code>seq_along()</code> e <code>seq_len()</code> são métodos mais seguros e apropriados de se criar essas sequências a serem utilizadas pelo iterador de um <code>for</code> <em>loop</em>.</p>
<p>Para mais, vale destacar que, o objeto definido após a palavra-chave <code>in</code> pode ser qualquer coisa que a linguagem te permite definir. Geralmente esse objeto é um vetor de índices numéricos, como nos exemplos acima, mas ele poderia muito bem ser uma lista ou um <code>data.frame</code>, ou algo mais de sua preferência. Qualquer que seja a sua escolha, o <code>for</code> <em>loop</em> vai caminhar ao longo desse objeto que você forneceu, elemento por elemento.</p>
<p>Por uma convenção, programadores em geral, quase sempre utilizam a letra <code>i</code> para representar esse iterador. Especialmente se se esse iterador contém um índice numérico. Mas você tem a liberdade de dar o nome que quiser para o seu iterador. Como exemplo, eu poderia muito bem criar um iterador chamado <code>fruta</code>.</p>
<p></p>
<div class="sourceCode" id="cb1598"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1598-1"><a href="#cb1598-1" aria-hidden="true" tabindex="-1"></a>frutas <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb1598-2"><a href="#cb1598-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Banana&quot;</span>, <span class="st">&quot;Maçã&quot;</span>, <span class="st">&quot;Pêra&quot;</span>,</span>
<span id="cb1598-3"><a href="#cb1598-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Pêssego&quot;</span>, <span class="st">&quot;Laranja&quot;</span></span>
<span id="cb1598-4"><a href="#cb1598-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1598-5"><a href="#cb1598-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1598-6"><a href="#cb1598-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(fruta <span class="cf">in</span> frutas){</span>
<span id="cb1598-7"><a href="#cb1598-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(fruta)</span>
<span id="cb1598-8"><a href="#cb1598-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## [1] &quot;Banana&quot;
## [1] &quot;Maçã&quot;
## [1] &quot;Pêra&quot;
## [1] &quot;Pêssego&quot;
## [1] &quot;Laranja&quot;</code></pre>
<p></p>
<p>O iterador é parte essencial de um <code>for</code> <em>loop</em>, pois em geral, utilizamos esse iterador para acessarmos um elemento diferente de algum objeto, ou, para gerarmos um resultado diferente a cada repetição do loop. Veja no exemplo abaixo, que a cada iteração o <code>for</code> <em>loop</em> está somando 10 a um elemento diferente do vetor <code>valores</code>. Consequentemente, o valor armazenado no objeto <code>soma</code> muda a cada repetição do <code>for</code> <em>loop</em>.</p>
<p></p>
<div class="sourceCode" id="cb1600"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1600-1"><a href="#cb1600-1" aria-hidden="true" tabindex="-1"></a>valores <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">15</span>, <span class="dv">20</span>, <span class="dv">25</span>, <span class="dv">30</span>)</span>
<span id="cb1600-2"><a href="#cb1600-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1600-3"><a href="#cb1600-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> valores){</span>
<span id="cb1600-4"><a href="#cb1600-4" aria-hidden="true" tabindex="-1"></a>  soma <span class="ot">&lt;-</span> i <span class="sc">+</span> <span class="dv">10</span></span>
<span id="cb1600-5"><a href="#cb1600-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(soma)</span>
<span id="cb1600-6"><a href="#cb1600-6" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## [1] 25
## [1] 30
## [1] 35
## [1] 40</code></pre>
<p></p>
<p>Portanto, geralmente utilizamos o iterador para aplicarmos uma função sobre um <em>input</em> diferente e, com isso, gerar um resultado distinto a cada repetição. Esse <em>input</em> pode ser o próprio índice numérico do iterador (como nos exemplos em que aplicamos a função <code>print()</code> sobre o iterador), ou, então, um elemento (ou parte) de algum objeto (como no exemplo acima, do vetor <code>valores</code>).</p>
<p>Contudo, temos também a opção de não utilizamos o iterador ao longo do corpo do loop. Dessa forma, o <em>loop</em> vai sempre executar os mesmos comandos, que por sua vez, vão utilizar sempre os mesmos <em>inputs</em> e, consequentemente, vão gerar sempre o mesmo resultado a cada repetição.</p>
<p></p>
<div class="sourceCode" id="cb1602"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1602-1"><a href="#cb1602-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>){</span>
<span id="cb1602-2"><a href="#cb1602-2" aria-hidden="true" tabindex="-1"></a>  soma <span class="ot">&lt;-</span> <span class="dv">10</span> <span class="sc">+</span> <span class="dv">15</span></span>
<span id="cb1602-3"><a href="#cb1602-3" aria-hidden="true" tabindex="-1"></a>  msg <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;Essa soma é igual a: &quot;</span>, soma)</span>
<span id="cb1602-4"><a href="#cb1602-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(msg)</span>
<span id="cb1602-5"><a href="#cb1602-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## [1] &quot;Essa soma é igual a: 25&quot;
## [1] &quot;Essa soma é igual a: 25&quot;
## [1] &quot;Essa soma é igual a: 25&quot;
## [1] &quot;Essa soma é igual a: 25&quot;
## [1] &quot;Essa soma é igual a: 25&quot;</code></pre>
<p></p>
</div>
<div id="corpo" class="section level3" number="15.3.2">
<h3 number="15.3.2"><span class="header-section-number">15.3.2</span> Corpo</h3>
<p>O corpo de um <code>for</code> <em>loop</em> (assim como de qualquer outro tipo de loop) contém o conjunto de comandos que serão executados a cada repetição. Dessa maneira, você deve inserir dentro desse corpo, todos os comandos que você deseja que esse <code>for</code> <em>loop</em> execute por você. Nesse sentido, o corpo de um <em>loop</em> funciona de uma maneira muito parecida com o corpo de uma função.</p>
<p>Como exemplo, eu posso utilizar um <code>for</code> <em>loop</em> para realizar 5 jogadas de um dado tradicional. Dessa forma, em cada uma das 5 repetições, o <code>for</code> <em>loop</em> executa a função <code>sample()</code> para sortear um número de 1 a 6, e, em seguida, me mostra qual foi o número sorteado através da função <code>print()</code>.</p>
<p></p>
<div class="sourceCode" id="cb1604"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1604-1"><a href="#cb1604-1" aria-hidden="true" tabindex="-1"></a>dado <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span></span>
<span id="cb1604-2"><a href="#cb1604-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1604-3"><a href="#cb1604-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>){</span>
<span id="cb1604-4"><a href="#cb1604-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">sample</span>(dado, <span class="dv">1</span>))  </span>
<span id="cb1604-5"><a href="#cb1604-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## [1] 1
## [1] 6
## [1] 5
## [1] 4
## [1] 2</code></pre>
<p></p>
</div>
</div>
<div id="armazenando-os-resultados-de-um-loop." class="section level2" number="15.4">
<h2 number="15.4"><span class="header-section-number">15.4</span> Armazenando os resultados de um <em>loop</em>.</h2>
<p>O que acontece dentro de um <em>loop</em> (seja ele um <code>for</code>, <code>while</code> ou <code>repeat</code> <em>loop</em>) permanece dentro desse <em>loop</em> <span class="citation">(<a href="#ref-grolemund2014" role="doc-biblioref">Grolemund 2014</a>)</span>. Isso significa que os resultados gerados ao longo da execução de um <em>loop</em> não são salvos, a menos que você peça explicitamente por isso.</p>
<p>Imagine por exemplo, que você deseja simular 20 jogadas do dado, utilizando um <em>loop</em> como o da seção anterior. Porém você deseja ter os números sorteados em cada jogada, salvos em algum objeto, para que você possa fazer cálculos sobre esses resultados após a execução do loop. Para isso, você precisa utilizar uma expressão de <em>assignment</em> para salvar (em algum objeto) um resultado gerado dentro de seu loop.</p>
<p>No exemplo abaixo, eu estou criando um vetor do tipo <code>integer</code> com 20 elementos chamado <code>jogadas</code>. Em seguida, dentro do loop, eu estou usando o operador de <em>assignment</em> (<code>&lt;-</code>) para salvar o resultado de cada jogada em um dos elementos do vetor <code>jogadas</code>. Como resultado, se quisermos utilizar os números sorteados ao longo do <em>loop</em> em algum cálculo posterior, basta utilizarmos o objeto <code>jogadas</code>.</p>
<p></p>
<div class="sourceCode" id="cb1606"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1606-1"><a href="#cb1606-1" aria-hidden="true" tabindex="-1"></a>jogadas <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">&quot;integer&quot;</span>, <span class="at">length =</span> <span class="dv">20</span>)</span>
<span id="cb1606-2"><a href="#cb1606-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>){</span>
<span id="cb1606-3"><a href="#cb1606-3" aria-hidden="true" tabindex="-1"></a>  jogadas[i] <span class="ot">&lt;-</span> <span class="fu">sample</span>(dado, <span class="dv">1</span>)  </span>
<span id="cb1606-4"><a href="#cb1606-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1606-5"><a href="#cb1606-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1606-6"><a href="#cb1606-6" aria-hidden="true" tabindex="-1"></a>jogadas</span></code></pre></div>
<pre><code>##  [1] 5 1 2 2 5 5 3 4 5 4 4 1 6 6 5 4 1 1 2 5</code></pre>
<p></p>
<p>Perceba no exemplo acima, que eu reservei o espaço para cada resultado <strong>antes</strong> do <code>for</code> <em>loop</em>. É muito importante que você crie previamente, um objeto que possa guardar os resultados de seu <em>loop</em> <span class="citation">(<a href="#ref-grolemund2014" role="doc-biblioref">Grolemund 2014</a>; <a href="#ref-wickham2017" role="doc-biblioref">Wickham and Grolemund 2017</a>)</span>. Logo, esse objeto precisa ter espaço suficiente para comportar todos os resultados gerados pelo seu <em>loop</em>.</p>
<p>Por exemplo, se eu possuo um <code>data.frame</code> contendo 4 colunas numéricas, e desejo calcular a média de cada coluna, eu preciso criar algum objeto que possa receber as 4 médias que serão geradas pelo loop. No exemplo abaixo, eu utilizo a função <code>vector()</code> para criar um novo vetor atômico chamado <code>media</code>. Este vetor é do tipo <code>double</code>, e possui 4 elementos. Sendo assim, dentro do corpo do loop, eu salvo os resultados da função <code>mean()</code> dentro de cada elemento do vetor <code>media</code>.</p>
<p></p>
<div class="sourceCode" id="cb1608"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1608-1"><a href="#cb1608-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb1608-2"><a href="#cb1608-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">a =</span> <span class="fu">rnorm</span>(<span class="dv">20</span>),</span>
<span id="cb1608-3"><a href="#cb1608-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">b =</span> <span class="fu">rnorm</span>(<span class="dv">20</span>),</span>
<span id="cb1608-4"><a href="#cb1608-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">c =</span> <span class="fu">rnorm</span>(<span class="dv">20</span>),</span>
<span id="cb1608-5"><a href="#cb1608-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">d =</span> <span class="fu">rnorm</span>(<span class="dv">20</span>)</span>
<span id="cb1608-6"><a href="#cb1608-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1608-7"><a href="#cb1608-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1608-8"><a href="#cb1608-8" aria-hidden="true" tabindex="-1"></a>media <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">&quot;double&quot;</span>, <span class="at">length =</span> <span class="dv">4</span>)</span>
<span id="cb1608-9"><a href="#cb1608-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>){</span>
<span id="cb1608-10"><a href="#cb1608-10" aria-hidden="true" tabindex="-1"></a>  media[i] <span class="ot">&lt;-</span> <span class="fu">mean</span>(df[[i]])</span>
<span id="cb1608-11"><a href="#cb1608-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1608-12"><a href="#cb1608-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1608-13"><a href="#cb1608-13" aria-hidden="true" tabindex="-1"></a>media</span></code></pre></div>
<pre><code>## [1] -0.0260228  0.1182790  0.1210387  0.3298290</code></pre>
<p></p>
<p>Por que é muito importante que você reserve o espaço para cada resultado <strong>antes</strong> do loop? Pois caso contrário, o nosso <em>loop</em> pode ficar muito lento, dado que, para cada resultado gerado, o R precisa reservar um tempo durante a execução, para expandir o objeto em que você está salvando esses resultados <span class="citation">(<a href="#ref-grolemund2014" role="doc-biblioref">Grolemund 2014</a>)</span>.</p>
<p>Em mais detalhes, se você possui um vetor <code>x</code> de 5 elementos, e adiciona um 6° elemento a ele, para que o vetor “cresça,” o R é obrigado a criar um novo vetor de 6 elementos em um outro endereço de sua memória RAM, e copiar todos os 5 elementos do vetor <code>x</code> para esse novo endereço, e, por fim, adicionar o 6° elemento a este novo vetor criado. Obviamente esse processo é feito de maneira automática, mas com certeza é um processo altamente custoso.</p>
<p>Dentro da comunidade do R, esse problema é mais conhecido pelo termo <em>growing vector problem</em> (ou “problema do vetor crescente”). Caso estivéssemos usando um <em>loop</em> de 2 mil repetições, o R precisaria executar 2 mil vezes o processo descrito no parágrafo anterior, para aumentar um elemento a mais em meu vetor, com o objetivo de guardar o novo resultado gerado em cada uma dessas 2 mil repetições. Por outro lado, se eu já reservo previamente um vetor com 2 mil elementos, o R não precisaria mais executar esse processo, e pode se dedicar apenas na execução do loop.</p>
<p>Como exemplo, eu realizei um pequeno teste em minha máquina. Em ambos os exemplos abaixo estou realizando o mesmo <em>loop</em> de 10 milhões de repetições. A cada repetição, esse <em>loop</em> salva o valor do iterador em um vetor chamado <code>vec</code>. A diferença entre os dois exemplos, é que no primeiro eu expando o vetor <code>vec</code> a cada repetição e, no segundo, o vetor <code>vec</code> já possui 10 milhões de elementos antes do <em>loop</em> começar. Repare abaixo, que a minha máquina demorou em torno de 3,92 segundos para executar o primeiro exemplo, mas apenas 0,43 segundos para executar o segundo.</p>
<p></p>
<div class="sourceCode" id="cb1610"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1610-1"><a href="#cb1610-1" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>({</span>
<span id="cb1610-2"><a href="#cb1610-2" aria-hidden="true" tabindex="-1"></a>  vec <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb1610-3"><a href="#cb1610-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10000000</span>){</span>
<span id="cb1610-4"><a href="#cb1610-4" aria-hidden="true" tabindex="-1"></a>    vec[i] <span class="ot">&lt;-</span> i</span>
<span id="cb1610-5"><a href="#cb1610-5" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1610-6"><a href="#cb1610-6" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<p></p>
<pre><code>## usuário   sistema decorrido 
##    3.47      0.41      3.92</code></pre>
<p></p>
<div class="sourceCode" id="cb1612"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1612-1"><a href="#cb1612-1" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>({</span>
<span id="cb1612-2"><a href="#cb1612-2" aria-hidden="true" tabindex="-1"></a>  vec <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">&quot;integer&quot;</span>, <span class="at">length =</span> <span class="dv">10000000</span>)</span>
<span id="cb1612-3"><a href="#cb1612-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10000000</span>){</span>
<span id="cb1612-4"><a href="#cb1612-4" aria-hidden="true" tabindex="-1"></a>    vec[i] <span class="ot">&lt;-</span> i</span>
<span id="cb1612-5"><a href="#cb1612-5" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1612-6"><a href="#cb1612-6" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<p></p>
<pre><code>## usuário   sistema decorrido 
##    0.40      0.02      0.43</code></pre>
<p>Além disso, é muito importante que você crie um vetor associado ao mesmo tipo de dado que o resultado gerado em seu loop. Logo, se o seu <em>loop</em> gera um valor do tipo <code>double</code> em cada repetição, é importante que você crie um vetor do tipo <code>double</code> para armazenar esses resultados. Também é essencial que você saiba o tamanho que esse resultado pode assumir em cada repetição. Em outras palavras, será que a cada repetição de seu loop, um único número é gerado (por exemplo, uma média)? Ou um novo vetor de 5 elementos? Ou um <code>data.frame</code> de tamanho variável?</p>
<p>A partir do momento que você sabe qual o tipo de resultado que será gerado pelo seu loop, você pode identificar com mais facilidade, qual a melhor estrutura de dado para guardar esses valores. Pergunte-se: será que um vetor atômico consegue guardar esses resultados? Ou uma lista é mais adequada? Lembre-se que vetores atômicos só podem guardar dentro de si, valores que pertencem ao mesmo tipo de dado (<code>double</code>, <code>integer</code>, <code>logical</code>, <code>character</code>, etc.). Além disso, nós não podemos guardar um novo vetor ou um novo <code>data.frame</code>, dentro de cada elemento de um vetor atômico. Logo, se a cada repetição do <em>loop</em> você está gerando um vetor, uma lista ou um <code>data.frame</code>, é melhor que você utilize uma lista para armazenar cada um desses resultados (ao invés de um vetor atômico).</p>
<p>Para criar uma nova lista de <span class="math inline">\(n\)</span> elementos, você pode utilizar novamente a função <code>vector()</code>. Basta que você configure o argumento <code>mode</code> da função para o valor <code>"list"</code>. Lembre-se que, para acessar um elemento de uma lista, você precisa utilizar 2 pares de colchetes ao invés de 1 par. No exemplo abaixo, estou utilizando um <code>for</code> <em>loop</em> para realizar um trabalho semelhante à função <code>split()</code>, que é o de dividir (ou separar) as linhas de um <code>data.frame</code> em diferentes elementos de uma lista, de acordo com os valores de uma determinada coluna.</p>
<p></p>
<div class="sourceCode" id="cb1614"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1614-1"><a href="#cb1614-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code></pre></div>
<p></p>
<p></p>
<div class="sourceCode" id="cb1615"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1615-1"><a href="#cb1615-1" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb1615-2"><a href="#cb1615-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">setor =</span> <span class="fu">c</span>(<span class="st">&quot;B&quot;</span>, <span class="st">&quot;C&quot;</span>, <span class="st">&quot;C&quot;</span>, <span class="st">&quot;A&quot;</span>),</span>
<span id="cb1615-3"><a href="#cb1615-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">ID =</span> <span class="fu">c</span>(<span class="st">&quot;1154&quot;</span>, <span class="st">&quot;678&quot;</span>, <span class="st">&quot;9812&quot;</span>, <span class="st">&quot;2500&quot;</span>),</span>
<span id="cb1615-4"><a href="#cb1615-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">valor =</span> <span class="fu">round</span>(<span class="fu">rnorm</span>(<span class="dv">4</span>), <span class="dv">2</span>)</span>
<span id="cb1615-5"><a href="#cb1615-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1615-6"><a href="#cb1615-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1615-7"><a href="#cb1615-7" aria-hidden="true" tabindex="-1"></a>setores <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;C&quot;</span>)</span>
<span id="cb1615-8"><a href="#cb1615-8" aria-hidden="true" tabindex="-1"></a>lista_vazia <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">&quot;list&quot;</span>, <span class="at">length =</span> <span class="dv">3</span>)</span>
<span id="cb1615-9"><a href="#cb1615-9" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(lista_vazia) <span class="ot">&lt;-</span> setores</span>
<span id="cb1615-10"><a href="#cb1615-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1615-11"><a href="#cb1615-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(setor_id <span class="cf">in</span> setores){</span>
<span id="cb1615-12"><a href="#cb1615-12" aria-hidden="true" tabindex="-1"></a>  lista_vazia[[setor_id]] <span class="ot">&lt;-</span> <span class="fu">filter</span>(tab, setor <span class="sc">==</span> setor_id)</span>
<span id="cb1615-13"><a href="#cb1615-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1615-14"><a href="#cb1615-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1615-15"><a href="#cb1615-15" aria-hidden="true" tabindex="-1"></a>lista_vazia</span></code></pre></div>
<pre><code>## $A
##   setor   ID valor
## 1     A 2500 -1.23
## 
## $B
##   setor   ID valor
## 1     B 1154  -1.1
## 
## $C
##   setor   ID valor
## 1     C  678  1.42
## 2     C 9812 -1.61</code></pre>
<p></p>
<div id="alguns-outros-padrões-de-loops" class="section level3" number="15.4.1">
<h3 number="15.4.1"><span class="header-section-number">15.4.1</span> Alguns outros padrões de loops</h3>
<p>Loops são ferramenta fundamental para trabalharmos com listas no R. Pois a linguagem não trata as listas da mesma forma que os vetores atômicos. Logo, operações muito simples e corriqueiras, como aplicar uma determinada operação sobre todos os elementos de um vetor, não possuem a mesma solução direta quando lidamos com uma lista. Por exemplo, se eu tentasse multiplicar cada elemento de uma lista por 2, da mesma forma que eu faria para um vetor atômico, um erro é retornado:</p>
<p></p>
<div class="sourceCode" id="cb1617"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1617-1"><a href="#cb1617-1" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>) <span class="sc">*</span> <span class="dv">2</span></span></code></pre></div>
<p></p>
<pre><code>## Error in list(1, 2, 3) * 2 : argumento não-numérico para operador binário</code></pre>
<p>Aplicar uma determinada operação/função sobre cada elemento de uma lista é uma atividade bastante comum no R. Porém, para realizarmos esse trabalho, temos que utilizar um <em>loop</em> para navegar sobre cada elemento dessa lista, aplicando a operação/função que desejamos aplicar. Nesse aspecto, uma lista da linguagem R se aproxima muito à uma lista da linguagem Python, que também exige o uso de loops para trabalharmos com cada elemento.</p>
<p>Como exemplo, para multiplicarmos cada elemento de uma lista por 2, teríamos que construir um <em>loop</em> parecido com este. Nesse exemplo, estou utilizando o iterador do loop para acessar cada elemento da lista, através do comando <code>lista[[i]]</code> e, em seguida, estou multiplicando esse elemento por 2 e, por último, salvo o resultado nesse mesmo elemento da lista.</p>
<p></p>
<div class="sourceCode" id="cb1619"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1619-1"><a href="#cb1619-1" aria-hidden="true" tabindex="-1"></a>lista <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)</span>
<span id="cb1619-2"><a href="#cb1619-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_along</span>(lista)){</span>
<span id="cb1619-3"><a href="#cb1619-3" aria-hidden="true" tabindex="-1"></a>  lista[[i]] <span class="ot">&lt;-</span> lista[[i]] <span class="sc">*</span> <span class="dv">2</span> </span>
<span id="cb1619-4"><a href="#cb1619-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1619-5"><a href="#cb1619-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1619-6"><a href="#cb1619-6" aria-hidden="true" tabindex="-1"></a>lista</span></code></pre></div>
<pre><code>## [[1]]
## [1] 2
## 
## [[2]]
## [1] 4
## 
## [[3]]
## [1] 6</code></pre>
<p></p>
<p>Além disso, até o momento, focamos bastante em loops que utilizam vetores contendo uma sequência numérica. Contudo, também é muito comum iterarmos sobre vetores contendo nomes (ou rótulos), com o objetivo de extrairmos ou modificarmos elementos específicos de uma lista, ou, colunas específicas de um <code>data.frame</code>. Por exemplo, imagine que você possua um <code>data.frame</code> parecido com o objeto <code>tab</code> abaixo.</p>
<p></p>
<div class="sourceCode" id="cb1621"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1621-1"><a href="#cb1621-1" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb1621-2"><a href="#cb1621-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">ID =</span> <span class="fu">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;C&quot;</span>),</span>
<span id="cb1621-3"><a href="#cb1621-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">c1 =</span> <span class="fu">rnorm</span>(<span class="dv">4</span>),</span>
<span id="cb1621-4"><a href="#cb1621-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">c2 =</span> <span class="fu">rnorm</span>(<span class="dv">4</span>),</span>
<span id="cb1621-5"><a href="#cb1621-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">c3 =</span> <span class="fu">rnorm</span>(<span class="dv">4</span>)</span>
<span id="cb1621-6"><a href="#cb1621-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p></p>
<p>Agora, suponha que você desejasse calcular a média de todas as colunas numéricas dessa tabela. Para isso, você poderia utilizar um código parecido com esse:</p>
<p></p>
<div class="sourceCode" id="cb1622"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1622-1"><a href="#cb1622-1" aria-hidden="true" tabindex="-1"></a>medias <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb1622-2"><a href="#cb1622-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">c1 =</span> <span class="fu">mean</span>(tab<span class="sc">$</span>c1),</span>
<span id="cb1622-3"><a href="#cb1622-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">c2 =</span> <span class="fu">mean</span>(tab<span class="sc">$</span>c2),</span>
<span id="cb1622-4"><a href="#cb1622-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">c3 =</span> <span class="fu">mean</span>(tab<span class="sc">$</span>c3)</span>
<span id="cb1622-5"><a href="#cb1622-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p></p>
<p>Entretanto, essa solução se torna rapidamente inviável a medida em que o número de colunas numéricas em seu <code>data.frame</code> aumenta. Logo, uma solução mais interessante, seria primeiro, coletarmos o nome das colunas que são numéricas e, em seguida, utilizar um <em>loop</em> para iterarmos ao longo dessas colunas, calculando a média de cada uma.</p>
<p>Para coletarmos os nomes das colunas numéricas, poderíamos construir um <em>loop</em> como o demonstrado abaixo. Dessa forma, estamos empregando a função <code>is.numeric()</code> sobre cada coluna de <code>tab</code>, e armazenando o resultado no vetor <code>vec</code>. Ao final do loop, o vetor <code>vec</code> guarda um valor do tipo <code>logical</code> para cada coluna de <code>tab</code>, indicando se essa coluna é numérica ou não. Com isso, podemos utilizar esse vetor <code>vec</code> com <em>subsetting</em> sobre o resultado da função <code>names()</code>, para descobrirmos os nomes das colunas numéricas de <code>tab</code>.</p>
<p></p>
<div class="sourceCode" id="cb1623"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1623-1"><a href="#cb1623-1" aria-hidden="true" tabindex="-1"></a>vec <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">&quot;logical&quot;</span>, <span class="at">length =</span> <span class="fu">ncol</span>(tab))</span>
<span id="cb1623-2"><a href="#cb1623-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_along</span>(tab)){</span>
<span id="cb1623-3"><a href="#cb1623-3" aria-hidden="true" tabindex="-1"></a>  vec[i] <span class="ot">&lt;-</span> <span class="fu">is.numeric</span>(tab[[i]])</span>
<span id="cb1623-4"><a href="#cb1623-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1623-5"><a href="#cb1623-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1623-6"><a href="#cb1623-6" aria-hidden="true" tabindex="-1"></a>colunas_numericas <span class="ot">&lt;-</span> <span class="fu">names</span>(tab)[vec]</span>
<span id="cb1623-7"><a href="#cb1623-7" aria-hidden="true" tabindex="-1"></a>colunas_numericas</span></code></pre></div>
<pre><code>## [1] &quot;c1&quot; &quot;c2&quot; &quot;c3&quot;</code></pre>
<p></p>
<p>Com esses nomes guardados, podemos construir um novo <em>loop</em> que utiliza esses nomes para acessar cada uma dessas colunas numéricas de <code>tab</code>, e aplicar a função <code>mean()</code> sobre cada uma delas. Como resultado, temos um novo vetor chamado <code>medias</code> que contém as médias de cada coluna numérica de <code>tab</code>.</p>
<p></p>
<div class="sourceCode" id="cb1625"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1625-1"><a href="#cb1625-1" aria-hidden="true" tabindex="-1"></a>medias <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">&quot;double&quot;</span>, <span class="at">length =</span> <span class="fu">length</span>(colunas_numericas))</span>
<span id="cb1625-2"><a href="#cb1625-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_along</span>(colunas_numericas)){</span>
<span id="cb1625-3"><a href="#cb1625-3" aria-hidden="true" tabindex="-1"></a>  coluna <span class="ot">&lt;-</span> colunas_numericas[i]</span>
<span id="cb1625-4"><a href="#cb1625-4" aria-hidden="true" tabindex="-1"></a>  medias[i] <span class="ot">&lt;-</span> <span class="fu">mean</span>(tab[[coluna]])</span>
<span id="cb1625-5"><a href="#cb1625-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1625-6"><a href="#cb1625-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1625-7"><a href="#cb1625-7" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(medias) <span class="ot">&lt;-</span> colunas_numericas</span>
<span id="cb1625-8"><a href="#cb1625-8" aria-hidden="true" tabindex="-1"></a>medias</span></code></pre></div>
<pre><code>##         c1         c2         c3 
## -0.6090414  0.3384576  0.5603875</code></pre>
<p></p>
<p>Portanto, no exemplo acima, a coluna <code>ID</code> do objeto <code>tab</code> não foi acessada em momento algum pelo <code>for</code> <em>loop</em>. Pois o nome dessa coluna não está presente no vetor <code>colunas_numericas</code>. Sendo assim, quando estamos trabalhando com estruturas nomeadas (como listas e <code>data.frame</code>’s), podemos utilizar um <code>for</code> <em>loop</em> em conjunto com o nome atribuído a cada elemento dessa estrutura para acessar e modificar elementos específicos do objeto, sem afetarmos os demais elementos do mesmo.</p>
</div>
<div id="cuidado-com-o-nome-de-seu-iterador" class="section level3" number="15.4.2">
<h3 number="15.4.2"><span class="header-section-number">15.4.2</span> Cuidado com o nome de seu iterador</h3>
<p>O iterador é uma variável criada automaticamente pelo <code>for</code> <em>loop</em>. Porém, tome muito cuidado, pois a depender do ambiente em que o <code>for</code> <em>loop</em> for executado, essa variável pode ser criada em seu ambiente global (<em>global environment</em>). Isso significa que, o iterador criado pelo <code>for</code> <em>loop</em> pode acabar sobrescrevendo um objeto que você criou anteriormente em seu ambiente.</p>
<p>Por isso, mesmo que você tenha liberdade para definir o nome que desejar para o seu iterador, é importante que você tome cuidado para não sobrescrever algum objeto importante durante o seu programa. Apenas para que esse problema fique claro, veja no exemplo abaixo, que eu crio antes do loop, um objeto <code>i</code> que guarda o texto <code>"Uma anotação importante"</code>. Após o loop, eu verifico o que está armazenado nesse objeto <code>i</code>, e o número 3 é retornado (ao invés da anotação importante).</p>
<p></p>
<div class="sourceCode" id="cb1627"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1627-1"><a href="#cb1627-1" aria-hidden="true" tabindex="-1"></a>i <span class="ot">&lt;-</span> <span class="st">&quot;Uma anotação importante&quot;</span></span>
<span id="cb1627-2"><a href="#cb1627-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1627-3"><a href="#cb1627-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>){</span>
<span id="cb1627-4"><a href="#cb1627-4" aria-hidden="true" tabindex="-1"></a>  soma <span class="ot">&lt;-</span> <span class="dv">15</span> <span class="sc">+</span> <span class="dv">3</span></span>
<span id="cb1627-5"><a href="#cb1627-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1627-6"><a href="#cb1627-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1627-7"><a href="#cb1627-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(i)</span></code></pre></div>
<pre><code>## [1] 3</code></pre>
<p></p>
<p>No exemplo acima, como o iterador do <em>loop</em> se chamava <code>i</code>, o <code>for</code> <em>loop</em> cria um novo objeto chamado <code>i</code>, o qual sobrescreve o objeto <code>i</code> anterior que guardava a <em>string</em>. Após a execução do loop, este objeto <code>i</code> guarda o número 3, que é o valor que esse iterador assumiu na última repetição do <code>for</code> <em>loop</em>.</p>
<p>Portanto, o iterador de um <code>for</code> <em>loop</em>, é um objeto criado no ambiente (ou <em>environment</em>) em que esse <code>for</code> <em>loop</em> é chamado. Uma solução inteligente para esse problema gerado pelo <code>for</code> <em>loop</em>, seria executarmos esse <em>loop</em> através de uma função. Pois, como discutimos no capítulo anterior, as funções são executadas em ambientes separados do seu ambiente global. Dessa forma, o iterador do <code>for</code> <em>loop</em> é criado no ambiente em que essa função é executada. Perceba abaixo, que dessa vez, mesmo após executarmos a função contendo o loop, o objeto <code>i</code> ainda contém a anotação importante.</p>
<p></p>
<div class="sourceCode" id="cb1629"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1629-1"><a href="#cb1629-1" aria-hidden="true" tabindex="-1"></a>i <span class="ot">&lt;-</span> <span class="st">&quot;Uma anotação importante&quot;</span></span>
<span id="cb1629-2"><a href="#cb1629-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1629-3"><a href="#cb1629-3" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb1629-4"><a href="#cb1629-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>){</span>
<span id="cb1629-5"><a href="#cb1629-5" aria-hidden="true" tabindex="-1"></a>    soma <span class="ot">&lt;-</span> <span class="dv">15</span> <span class="sc">+</span> <span class="dv">3</span></span>
<span id="cb1629-6"><a href="#cb1629-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1629-7"><a href="#cb1629-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1629-8"><a href="#cb1629-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1629-9"><a href="#cb1629-9" aria-hidden="true" tabindex="-1"></a><span class="do">### Executei a função</span></span>
<span id="cb1629-10"><a href="#cb1629-10" aria-hidden="true" tabindex="-1"></a><span class="fu">f</span>()</span>
<span id="cb1629-11"><a href="#cb1629-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1629-12"><a href="#cb1629-12" aria-hidden="true" tabindex="-1"></a><span class="do">### O valor do objeto i continua o mesmo</span></span>
<span id="cb1629-13"><a href="#cb1629-13" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(i)</span></code></pre></div>
<pre><code>## [1] &quot;Uma anotação importante&quot;</code></pre>
<p></p>
</div>
</div>
<div id="descrevendo-um-while-loop" class="section level2" number="15.5">
<h2 number="15.5"><span class="header-section-number">15.5</span> Descrevendo um <code>while</code> <em>loop</em></h2>
<p>Um <code>while</code> <em>loop</em> é criado a partir da palavra-chave <code>while</code>. Assim como um <code>for</code> <em>loop</em>, um <code>while</code> <em>loop</em> também possui uma definição e um corpo. Sendo que o seu corpo funciona exatamente da mesma forma que em um <code>for</code> <em>loop</em>. Logo, você inclui dentro do corpo de um <code>while</code> <em>loop</em>, os comandos a serem executados em cada iteração.</p>
<p>Porém, a definição de um <code>while</code> <em>loop</em> é construída de uma forma diferente. Essa definição também é construída dentro de um par de parênteses, logo após a palavra-chave <code>while</code>, contudo, ela possui 1 único item dentro dela, que é a condição lógica responsável por reger (ou coordenar) o loop. No exemplo abaixo, essa condição lógica é <code>i &lt; 5</code>.</p>
<p>Repare também, que eu crio o objeto <code>i</code> <strong>antes</strong> do <code>while</code> <em>loop</em> ocorrer. Logo, ao contrário de um <code>for</code> <em>loop</em>, um <code>while</code> <em>loop</em> não utiliza um iterador, ou, em outras palavras, um <code>while</code> <em>loop</em> não cria um objeto durante sua execução, ele apenas confere o resultado da condição lógica <code>i &lt; 5</code> a cada repetição.</p>
<p></p>
<div class="sourceCode" id="cb1631"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1631-1"><a href="#cb1631-1" aria-hidden="true" tabindex="-1"></a>i <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb1631-2"><a href="#cb1631-2" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span>(i <span class="sc">&lt;</span> <span class="dv">5</span>){</span>
<span id="cb1631-3"><a href="#cb1631-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(i)</span>
<span id="cb1631-4"><a href="#cb1631-4" aria-hidden="true" tabindex="-1"></a>  i <span class="ot">&lt;-</span> i <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb1631-5"><a href="#cb1631-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## [1] 1
## [1] 2
## [1] 3
## [1] 4</code></pre>
<p></p>
<p>Portanto, a cada repetição, o <code>while</code> <em>loop</em> confere se o resultado de <code>i &lt; 5</code> é igual a <code>TRUE</code>, caso seja, os comandos definidos no corpo desse <em>loop</em> são executados. Perceba que, no exemplo acima, o <em>loop</em> nos mostra o conteúdo do objeto <code>i</code> com <code>print()</code> e, em seguida, acrescenta 1 ao valor do objeto <code>i</code> com <code>i &lt;- i + 1</code>. Como esse incremento é executado em toda repetição do loop, em algum momento, o valor de <code>i</code> será maior ou igual a 5 e, consequentemente, o resultado da condição lógica <code>i &lt; 5</code> não será mais <code>TRUE</code>. No instante em que essa condição retornar <code>FALSE</code>, o <code>while</code> <em>loop</em> vai encerrar sua execução. Esse fluxo de execução está desenhado na figura 15.2 abaixo.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/while1.png" alt="Fluxo de execução de um `while` loop" width="90%" />
<p class="caption">
(#fig:unnamed-chunk-855)Fluxo de execução de um <code>while</code> loop
</p>
</div>
<p></p>
<p>Tendo isso em mente, um <code>while</code> <em>loop</em> repete um mesmo conjunto de comandos <strong>enquanto uma condição lógica for verdadeira</strong> <span class="citation">(<a href="#ref-grolemund2014" role="doc-biblioref">Grolemund 2014</a>)</span>. Agora, tenha cuidado com um <code>while</code> <em>loop</em>, pois se a condição que rege o <em>loop</em> nunca resultar em <code>FALSE</code>, o <em>loop</em> nunca vai encerrar a sua execução. Ou seja, podemos criar um <em>loop</em> infinito.</p>
<p>Se você decidiu utilizar um <code>while</code> <em>loop</em> (ao invés de um <code>for</code> <em>loop</em>), é razoável pressupormos que os comandos inseridos no corpo deste <em>loop</em> vão decidir se essa condição vai continuar resultando em <code>TRUE</code> ou não. Logo, se o código presente no corpo de seu <code>while</code> <em>loop</em> não possui qualquer relação com a condição lógica que você forneceu na definição do loop, esse <em>loop</em> nunca vai parar de repetir os comandos descritos em seu corpo <span class="citation">(<a href="#ref-grolemund2014" role="doc-biblioref">Grolemund 2014</a>)</span>.</p>
<p>No exemplo anterior, o comando <code>i &lt;- i + 1</code> presente no corpo do loop, gerava um “crescimento” do objeto <code>i</code> a cada iteração e, por causa disso, garantia que em algum momento, a condição <code>i &lt; 5</code> resultaria em <code>FALSE</code>. Mas o que seria um caso de <code>while</code> <em>loop</em> infinito ? Um exemplo seria um <em>loop</em> que utiliza uma condição formada por constantes, como <code>1 &lt; 5</code>. Pois 1 sempre será menor que 5, logo, essa condição sempre resultará em <code>TRUE</code>. Um outro exemplo seria o <em>loop</em> abaixo, que utiliza uma condição lógica em torno do objeto <code>x</code>, mas que não possui nenhum comando presente em seu corpo, que altere esse objeto <code>x</code> de alguma forma que possa tornar a condição lógica <code>x == 10</code> igual a <code>FALSE</code>.</p>
<p></p>
<div class="sourceCode" id="cb1633"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1633-1"><a href="#cb1633-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb1633-2"><a href="#cb1633-2" aria-hidden="true" tabindex="-1"></a>contagem <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb1633-3"><a href="#cb1633-3" aria-hidden="true" tabindex="-1"></a><span class="do">### Esse loop é infinito:</span></span>
<span id="cb1633-4"><a href="#cb1633-4" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span>(x <span class="sc">==</span> <span class="dv">10</span>){</span>
<span id="cb1633-5"><a href="#cb1633-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(contagem)</span>
<span id="cb1633-6"><a href="#cb1633-6" aria-hidden="true" tabindex="-1"></a>  contagem <span class="ot">&lt;-</span> contagem <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb1633-7"><a href="#cb1633-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p></p>
<p>Entenda que, a definição de um <code>while</code> <em>loop</em> pode conter qualquer tipo de condição lógica que você quiser. Você pode inclusive fornecer diretamente um valor do tipo <code>logical</code> a essa definição (apesar de que isso criaria um <em>loop</em> infinito - <code>TRUE</code>, ou, um <em>loop</em> que jamais executaria os comandos de seu corpo - <code>FALSE</code>). De qualquer forma, a condição lógica que você fornecer à definição de um <code>while</code> <em>loop</em>, deve resultar em 1 único valor do tipo <code>logical</code>. Caso essa condição resulte em um vetor de valores do tipo <code>logical</code>, <code>while</code> vai utilizar apenas o primeiro elemento deste vetor para determinar se o <em>loop</em> prossegue ou não com a sua iteração.</p>
</div>
<div id="descrevendo-um-repeat-loop" class="section level2" number="15.6">
<h2 number="15.6"><span class="header-section-number">15.6</span> Descrevendo um <code>repeat</code> <em>loop</em></h2>
<p>Um <code>repeat</code> <em>loop</em> é um <em>loop</em> infinito por definição. Logo, você precisa ter um cuidado em dobro com este tipo de loop. Sendo assim, um <code>repeat</code> <em>loop</em> vai repetir indefinidamente o conjunto de comandos descritos no corpo do loop. Por esse motivo, quando utilizamos um <code>repeat</code> <em>loop</em>, nós geralmente criamos uma condição de <code>break</code> em seu corpo.</p>
<p>Em resumo, o comando <code>break</code> cria uma ordem que interrompe o <em>loop</em> que o executou. Portanto, <code>break</code> é uma palavra-chave que deve ser utilizada dentro do corpo de qualquer tipo de loop. Com essa palavra-chave, podemos transformar um <em>loop</em> infinito, em um <em>loop</em> finito. Como exemplo, podemos recriar o exemplo básico de <em>loop</em> com um <code>repeat</code> <em>loop</em> dessa forma:</p>
<p></p>
<div class="sourceCode" id="cb1634"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1634-1"><a href="#cb1634-1" aria-hidden="true" tabindex="-1"></a>i <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb1634-2"><a href="#cb1634-2" aria-hidden="true" tabindex="-1"></a><span class="cf">repeat</span>{</span>
<span id="cb1634-3"><a href="#cb1634-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(i <span class="sc">&gt;=</span> <span class="dv">5</span>){</span>
<span id="cb1634-4"><a href="#cb1634-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">break</span></span>
<span id="cb1634-5"><a href="#cb1634-5" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1634-6"><a href="#cb1634-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(i)</span>
<span id="cb1634-7"><a href="#cb1634-7" aria-hidden="true" tabindex="-1"></a>  i <span class="ot">&lt;-</span> i <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb1634-8"><a href="#cb1634-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## [1] 1
## [1] 2
## [1] 3
## [1] 4</code></pre>
<p></p>
<p>Perceba acima, que um <code>repeat</code> <em>loop</em> não possui uma definição, apenas o corpo. Em um <code>for</code> <em>loop</em> ou <code>while</code> <em>loop</em>, a definição determina o momento em que a iteração do <em>loop</em> deve ser finalizada. Como um <code>repeat</code> <em>loop</em> é um <em>loop</em> infinito, não faz sentido criarmos uma definição para ele.</p>
<p>Em vista disso, assim como ocorre em um <code>while</code> <em>loop</em>, você também precisa incluir dentro do corpo de um <code>repeat</code> <em>loop</em>, comandos que possam decidir quando é o momento de parar o loop, dessa vez, utilizando um comando <code>break</code>. No exemplo acima, utilizo um <code>if</code> <em>statement</em> dentro do corpo do <em>loop</em> para fazer essa decisão.</p>
</div>
<div id="pulando-repetições-com-next" class="section level2" number="15.7">
<h2 number="15.7"><span class="header-section-number">15.7</span> Pulando repetições com <code>next</code></h2>
<p>Enquanto <code>break</code> para a execução de um loop, <code>next</code> faz com que o <em>loop</em> vá direto para a próxima iteração. Dito de outra forma, a palavra-chave <code>next</code> no R é equivalente à palavra-chave <code>continue</code> nas linguagens C e Python.</p>
<p>Como exemplo, o <em>loop</em> abaixo utiliza um <code>if</code> <em>statement</em> com o teste lógico <code>i %% 2 == 0</code> para verificar se o valor do objeto <code>i</code> é um número par, caso seja, o <em>loop</em> vai executar um comando <code>next</code> para pular os comandos restantes do corpo do loop, e ir direto para a próxima iteração. Em outras palavras, quando o iterador <code>i</code> assume valores pares, como 2 e 4, o <em>loop</em> não chega a executar o comando <code>print(i)</code>, pois o comando <code>next</code> já moveu o <em>loop</em> para a próxima repetição.</p>
<p></p>
<div class="sourceCode" id="cb1636"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1636-1"><a href="#cb1636-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>){</span>
<span id="cb1636-2"><a href="#cb1636-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(i <span class="sc">%%</span> <span class="dv">2</span> <span class="sc">==</span> <span class="dv">0</span>){</span>
<span id="cb1636-3"><a href="#cb1636-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">next</span></span>
<span id="cb1636-4"><a href="#cb1636-4" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1636-5"><a href="#cb1636-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1636-6"><a href="#cb1636-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(i)</span>
<span id="cb1636-7"><a href="#cb1636-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## [1] 1
## [1] 3
## [1] 5</code></pre>
<p></p>
</div>
<div id="um-estudo-de-caso-exportando-múltiplas-planilhas-de-excel" class="section level2" number="15.8">
<h2 number="15.8"><span class="header-section-number">15.8</span> Um estudo de caso: exportando múltiplas planilhas de Excel</h2>
<p>O pacote <code>readxl</code> (que introduzimos no capítulo 4) nos oferece a função <code>read_excel()</code>, com a qual podemos ler (ou importar) planilhas do Excel no R. Porém, o pacote não nos oferece uma função capaz de escrever (ou exportar) um <code>data.frame</code> do R para um arquivo de Excel.</p>
<!-- Isso é uma atividade muito comum. Muitas vezes desejamos exportar os nossos resultados para fora do R, seja para compartilhá-los com outros colegas, ou, para inserí-los dentro de uma apresentação, etc. E muitas vezes, queremos exportar esses resultados para um tipo de arquivo que todo mundo conheça e que seja simples de se compartilhar. Uma planilha de Excel é um excelente exemplo disso. -->
<p>Apesar do R não oferecer de fábrica uma solução, existem vários outros pacotes disponíveis que trabalham com planilhas de Excel, e que oferecem funções capazes de escrever tal formato de arquivo. Sendo os principais: <code>openxlsx</code>, <code>xlsx</code> e <code>writexl</code>.</p>
<p>O pacote <code>writexl</code> é o mais recente e simples de todos dessa lista, dado que ele oferece uma única função, chamada <code>write_xlsx()</code>. Entretanto, isso também significa que ele é a opção mais limitada, e não oferece várias funcionalidades importantes (por exemplo, a adição de abas, ou <em>sheets</em>, ao arquivo). Este pacote é uma interface para a biblioteca <code>libxlsxwriter</code> (escrita em C). Por causa disso, <code>writexl</code> é, em geral, o pacote que escreve os menores arquivos (em tamanho) e no menor tempo possível. Tendo isso em mente, se você precisa de uma solução simples e performática, <code>writexl</code> é uma boa escolha.</p>
<p>Por outro lado, o pacote <code>xlsx</code> já é um pacote antigo, tendo sido uma das primeiras alternativas a surgirem dentro da comunidade de R. Apesar de ser um pacote bastante completo, ele depende de uma biblioteca escrita em Java, e, por causa dessa dependência, é importante que você tenha o Java devidamente instalado e configurado em seu computador, para que você consiga aproveitar de suas funcionalidades. Infelizmente, alguns usuários enfrentam <a href="https://www.r-bloggers.com/2021/09/error-java_home-cannot-be-determined-from-the-registry/#:~:text=Approach%201%3A%20error%3A%20JAVA_HOME%20cannot%20be%20determined%20from%20the%20Registry&amp;text=This%20is%20frequently%20due%20to,t%20install%20Java%20at%20all.">problemas que surgem dessa dependência</a>.</p>
<p>Por último, o pacote <code>openxlsx</code> é, em geral, a solução que oferece um equilíbrio entre os dois mundos: é performática, fácil de se utilizar e não possui dependências externas ao pacote. Por esse motivo, vamos utilizar as funções de <code>openxlsx</code> ao longo dos exemplos mostrados neste estudo de caso.</p>
<div id="descrevendo-um-contexto-comum" class="section level3" number="15.8.1">
<h3 number="15.8.1"><span class="header-section-number">15.8.1</span> Descrevendo um contexto comum</h3>
<p>É frequente termos vários <code>data.frame</code>’s diferentes que desejamos salvar em arquivos de nosso computador. Até o momento, mostramos no capítulo 4 como podemos salvar esses objetos em arquivos CSV, através de funções como <code>readr::write_delim()</code> e <code>readr::write_csv2()</code>. Mas nessa seção, vamos exportar esses <code>data.frame</code>’s para arquivos de Excel.</p>
<p>Como exemplo, vamos utilizar novamente a tabela <code>datasus</code> que introduzimos anteriormente no capítulo 8. Lembrando que você pode importar rapidamente essa tabela para a sua sessão com os comandos abaixo. Ou seja, copie e cole os comandos abaixo em seu console, que você já terá acesso a essa tabela.</p>
<p></p>
<div class="sourceCode" id="cb1638"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1638-1"><a href="#cb1638-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb1638-2"><a href="#cb1638-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1638-3"><a href="#cb1638-3" aria-hidden="true" tabindex="-1"></a>github <span class="ot">&lt;-</span> <span class="st">&quot;https://raw.githubusercontent.com/pedropark99/&quot;</span></span>
<span id="cb1638-4"><a href="#cb1638-4" aria-hidden="true" tabindex="-1"></a>pasta <span class="ot">&lt;-</span> <span class="st">&quot;Curso-R/master/Dados/&quot;</span></span>
<span id="cb1638-5"><a href="#cb1638-5" aria-hidden="true" tabindex="-1"></a>arquivo <span class="ot">&lt;-</span> <span class="st">&quot;datasus.csv&quot;</span></span>
<span id="cb1638-6"><a href="#cb1638-6" aria-hidden="true" tabindex="-1"></a>datasus <span class="ot">&lt;-</span> <span class="fu">read_csv2</span>(<span class="fu">paste0</span>(github, pasta, arquivo))</span></code></pre></div>
<p></p>
<p></p>
<div class="sourceCode" id="cb1639"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1639-1"><a href="#cb1639-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(datasus)</span></code></pre></div>
<pre><code>## # A tibble: 1,836 x 6
##    `Faixa etaria` Genero    Cor      `Nome UF` UF    Contagem
##    &lt;chr&gt;          &lt;chr&gt;     &lt;chr&gt;    &lt;chr&gt;     &lt;chr&gt;    &lt;dbl&gt;
##  1 10 a 14        Feminino  Parda    Acre      AC           4
##  2 10 a 14        Masculino Parda    Acre      AC           4
##  3 15 a 19        Feminino  Branca   Acre      AC           2
##  4 15 a 19        Feminino  Parda    Acre      AC           4
##  5 15 a 19        Masculino Branca   Acre      AC           6
##  6 15 a 19        Masculino Parda    Acre      AC          65
##  7 15 a 19        Masculino Preta    Acre      AC           1
##  8 20 a 24        Feminino  Indígena Acre      AC           1
##  9 20 a 24        Feminino  Parda    Acre      AC           4
## 10 20 a 24        Masculino Branca   Acre      AC           7
## # ... with 1,826 more rows</code></pre>
<p></p>
</div>
<div id="como-exportar-uma-tabela-para-um-arquivo-de-excel" class="section level3" number="15.8.2">
<h3 number="15.8.2"><span class="header-section-number">15.8.2</span> Como exportar uma tabela para um arquivo de Excel</h3>
<p>Para escrevermos uma planilha de Excel (<code>.xlsx</code>) com o pacote <code>openxlsx</code>, temos que seguir basicamente quatro passos: 1) criar um workbook vazio com a função <code>createWorkbook()</code>; 2) adicionar uma nova página a esse workbook, com a função <code>addWorksheet()</code>; 3) escrever os dados do <code>data.frame</code> em questão nessa nova página adicionada ao workbook, com a função <code>writeData()</code>; 3) por último, exportar esse workbook (ou essa planilha) com a função <code>saveWorkbook()</code>.</p>
<p>Em resumo, todas as planilhas de Excel criadas pelo pacote <code>openxlsx</code> são representadas no R através de um <em>“workbook”</em> (em termos mais técnicos, isto é um objeto de classe <code>"Workbook"</code>). Portanto, sempre que estamos trabalhando com as funções do pacote <code>openxlsx</code>, seja adicionando dados a essa planilha, ou alterando suas configurações, estamos na realidade, aplicando essas funções sobre o workbook que representa essa planilha de Excel no R.</p>
<p>Tendo isso em mente, você vai acabar percebendo que a grande maioria das funções do pacote <code>openxlsx</code> recebem em seu primeiro argumento, o workbook que armazena a sua planilha. Nos exemplos dessa seção, eu vou sempre armazenar esse workbook em um objeto chamado <code>wb</code>. Para criarmos um workbook, podemos utilizar a função <code>createWorkbook()</code>, como demonstrado abaixo:</p>
<p></p>
<div class="sourceCode" id="cb1641"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1641-1"><a href="#cb1641-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(openxlsx)</span>
<span id="cb1641-2"><a href="#cb1641-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1641-3"><a href="#cb1641-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Criando um workbook vazio:</span></span>
<span id="cb1641-4"><a href="#cb1641-4" aria-hidden="true" tabindex="-1"></a>wb <span class="ot">&lt;-</span> <span class="fu">createWorkbook</span>()</span></code></pre></div>
<p></p>
<p>Porém, essa função <code>createWorkbook()</code> cria a representação de uma planilha completamente vazia. Por isso, precisamos adicionar um novo sheet à essa planilha. Em outras palavras, é como se estivéssemos adicionando à essa planilha, uma nova folha de papel, onde podemos escrever os nossos dados. Para adicionarmos essa nova página (ou sheet), podemos utilizar a função <code>addWorksheet()</code>. Após executarmos essa função no exemplo abaixo, o workbook armazenado no objeto <code>wb</code> passa a conter uma nova página chamada “Dados DATASUS.”</p>
<p></p>
<div class="sourceCode" id="cb1642"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1642-1"><a href="#cb1642-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Adicionando uma nova página (ou sheet) nesse workbook:</span></span>
<span id="cb1642-2"><a href="#cb1642-2" aria-hidden="true" tabindex="-1"></a><span class="fu">addWorksheet</span>(wb, <span class="st">&quot;Dados DATASUS&quot;</span>)</span></code></pre></div>
<p></p>
<p>Após adicionarmos essa nova página, podemos escrever os nossos dados nela, com a função <code>writeData()</code>. Para utilizar essa função, você fornece o seu workbook no primeiro argumento, o nome da página na qual você deseja escrever esses dados (nesse caso, a página “Dados DATASUS”) no segundo argumento, e os dados em questão a serem escritos no terceiro argumento.</p>
<p></p>
<div class="sourceCode" id="cb1643"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1643-1"><a href="#cb1643-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Escrevendo os dados da tabela datasus</span></span>
<span id="cb1643-2"><a href="#cb1643-2" aria-hidden="true" tabindex="-1"></a><span class="do">## nessa nova página:</span></span>
<span id="cb1643-3"><a href="#cb1643-3" aria-hidden="true" tabindex="-1"></a><span class="fu">writeData</span>(wb, <span class="st">&quot;Dados DATASUS&quot;</span>, datasus)</span></code></pre></div>
<p></p>
<p>Sendo assim, o nosso workbook <code>wb</code> já contém os dados da tabela <code>datasus</code> escritos em uma página chamada “Dados DATASUS.” Por último, precisamos apenas exportar esse workbook para um arquivo de Excel (<code>.xslx</code>). Para isso, podemos utilizar a função <code>saveWorkbook()</code>. Após executar o comando abaixo, um novo arquivo <code>.xlsx</code> chamado <code>"dados-datasus"</code> é criado em meu diretório de trabalho, contendo os dados da tabela <code>datasus</code>.</p>
<p></p>
<div class="sourceCode" id="cb1644"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1644-1"><a href="#cb1644-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Por último exportando os dados:</span></span>
<span id="cb1644-2"><a href="#cb1644-2" aria-hidden="true" tabindex="-1"></a><span class="fu">saveWorkbook</span>(wb, <span class="st">&quot;dados-datasus.xlsx&quot;</span>)</span></code></pre></div>
<p></p>
</div>
<div id="como-salvar-múltiplas-planilhas-de-excel" class="section level3" number="15.8.3">
<h3 number="15.8.3"><span class="header-section-number">15.8.3</span> Como salvar múltiplas planilhas de Excel</h3>
<p>Agora que sabemos quais são os passos necessários para salvar uma única planilha, podemos pensar em como podemos salvar múltiplas planilhas diferentes. Como exemplo, vamos dividir a tabela <code>datasus</code>, em várias tabelas menores. Mais especificamente, vamos dividir essa tabela por cada UF (Unidade da Federação). Para isso, podemos utilizar a função <code>split()</code>:</p>
<p></p>
<div class="sourceCode" id="cb1645"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1645-1"><a href="#cb1645-1" aria-hidden="true" tabindex="-1"></a>por_uf <span class="ot">&lt;-</span> <span class="fu">split</span>(datasus, <span class="sc">~</span>UF)</span></code></pre></div>
<p></p>
<p>Agora, o objeto <code>por_uf</code> é uma lista de 27 elementos. Cada elemento, contém um <code>data.frame</code> com os dados de uma UF específica. Por exemplo, com o comando abaixo, podemos acessar os dados de Minas Gerais (MG).</p>
<p></p>
<div class="sourceCode" id="cb1646"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1646-1"><a href="#cb1646-1" aria-hidden="true" tabindex="-1"></a>por_uf[[<span class="st">&quot;MG&quot;</span>]]</span></code></pre></div>
<pre><code>## # A tibble: 89 x 6
##    `Faixa etaria` Genero    Cor    `Nome UF`    UF    Contagem
##    &lt;chr&gt;          &lt;chr&gt;     &lt;chr&gt;  &lt;chr&gt;        &lt;chr&gt;    &lt;dbl&gt;
##  1 10 a 14        Feminino  Branca Minas Gerais MG           1
##  2 10 a 14        Feminino  Parda  Minas Gerais MG           3
##  3 10 a 14        Feminino  Preta  Minas Gerais MG           1
##  4 10 a 14        Masculino Branca Minas Gerais MG           3
##  5 10 a 14        Masculino Parda  Minas Gerais MG          11
##  6 10 a 14        Masculino Preta  Minas Gerais MG           2
##  7 15 a 19        Feminino  Branca Minas Gerais MG          16
##  8 15 a 19        Feminino  Parda  Minas Gerais MG          21
##  9 15 a 19        Feminino  Preta  Minas Gerais MG           6
## 10 15 a 19        Masculino Branca Minas Gerais MG          78
## # ... with 79 more rows</code></pre>
<p></p>
<p>Como podemos exportar uma planilha para cada UF? Para isso, podemos utilizar um for loop sobre o objeto <code>por_uf</code>. O for loop abaixo, vai (a cada repetição) criar um novo objeto <code>wb</code> contendo uma planilha vazia, em seguida, adicionar uma página chamada “Página 1” a essa planilha, depois, escrever os dados de uma UF específica nessa página, e, por último, exportar esses dados para uma planilha com o nome da UF.</p>
<p>A cada repetição do loop, os dados da UF são selecionados através do comando <code>dados_uf &lt;- por_uf[[uf]]</code>. Após executar o for loop abaixo, você deve ter 27 novas planilhas em seu diretório de trabalho.</p>
<p></p>
<div class="sourceCode" id="cb1648"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1648-1"><a href="#cb1648-1" aria-hidden="true" tabindex="-1"></a>ufs <span class="ot">&lt;-</span> <span class="fu">names</span>(por_uf)</span>
<span id="cb1648-2"><a href="#cb1648-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1648-3"><a href="#cb1648-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(uf <span class="cf">in</span> ufs){</span>
<span id="cb1648-4"><a href="#cb1648-4" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Selecionando os dados da UF</span></span>
<span id="cb1648-5"><a href="#cb1648-5" aria-hidden="true" tabindex="-1"></a>  dados_uf <span class="ot">&lt;-</span> por_uf[[uf]]</span>
<span id="cb1648-6"><a href="#cb1648-6" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Criando o workbook vazio</span></span>
<span id="cb1648-7"><a href="#cb1648-7" aria-hidden="true" tabindex="-1"></a>  wb <span class="ot">&lt;-</span> <span class="fu">createWorkbook</span>()</span>
<span id="cb1648-8"><a href="#cb1648-8" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Adicionando uma página padrão:</span></span>
<span id="cb1648-9"><a href="#cb1648-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addWorksheet</span>(wb, <span class="st">&quot;Página 1&quot;</span>)</span>
<span id="cb1648-10"><a href="#cb1648-10" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Escrevendo os dados da UF na nova página</span></span>
<span id="cb1648-11"><a href="#cb1648-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">writeData</span>(wb, <span class="st">&quot;Página 1&quot;</span>, dados_uf)</span>
<span id="cb1648-12"><a href="#cb1648-12" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Salvando o workbook em uma planilha</span></span>
<span id="cb1648-13"><a href="#cb1648-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveWorkbook</span>(wb, <span class="fu">paste</span>(uf, <span class="st">&quot;.xlsx&quot;</span>, <span class="at">collapse =</span> <span class="st">&quot;&quot;</span>))</span>
<span id="cb1648-14"><a href="#cb1648-14" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p></p>
</div>
<div id="salvando-os-dados-em-diferentes-páginas-de-uma-mesma-planilha" class="section level3" number="15.8.4">
<h3 number="15.8.4"><span class="header-section-number">15.8.4</span> Salvando os dados em diferentes páginas de uma mesma planilha</h3>
<p>Portanto, já vimos como podemos salvar uma única planilha, e, também, várias planilhas de uma vez só com um for loop. Porém, podemos ainda salvar os dados de cada UF em páginas separadas de uma mesma planilha do Excel. Ou seja, podemos criar um único arquivo de Excel, contendo 27 páginas. Cada página, contém os dados de uma UF específica.</p>
<p>Perceba que o problema continua o mesmo: queremos exportar os dados de cada UF para locais separados. Todavia, a forma como estamos separando esses dados se modificou, pois agora, estamos separando por páginas de uma planilha, ao invés de separarmos por planilha. Para executarmos essa tarefa, podemos novamente aplicar um for loop sobre o objeto <code>por_uf</code>.</p>
<p>Perceba abaixo, que o corpo do loop é quase idêntico ao do exemplo anterior, contendo algumas poucas alterações. Dessa vez, o workbook <code>wb</code> é criado fora do loop, pois queremos salvar todos os dados no mesmo workbook (ou na mesma planilha). Ou seja, nós não queremos redefinir esse workbook a cada repetição do loop, mas sim, adicionar mais conteúdo a ele. Repare também, que a função <code>addWorksheet()</code> também cumpre um papel importante dessa vez, dado que ela é responsável por criar as páginas na planilha para cada UF.</p>
<p>Logo, a cada repetição do loop abaixo, estamos adicionando uma nova página ao workbook <code>wb</code> com o nome de uma UF, e escrevendo nessa nova página adicionada, os dados da UF correspondente. Após a execução do loop, o workbook <code>wb</code> já contém todas as 27 páginas com os dados de cada UF. Tudo o que precisamos fazer ao final é exportar esse workbook para uma planilha chamada <code>"dados-datasus"</code>, com a função <code>saveWorkbook()</code>.</p>
<p></p>
<div class="sourceCode" id="cb1649"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1649-1"><a href="#cb1649-1" aria-hidden="true" tabindex="-1"></a>ufs <span class="ot">&lt;-</span> <span class="fu">names</span>(por_uf)</span>
<span id="cb1649-2"><a href="#cb1649-2" aria-hidden="true" tabindex="-1"></a>wb <span class="ot">&lt;-</span> <span class="fu">createWorkbook</span>()</span>
<span id="cb1649-3"><a href="#cb1649-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1649-4"><a href="#cb1649-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(uf <span class="cf">in</span> ufs){</span>
<span id="cb1649-5"><a href="#cb1649-5" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Selecionando os dados da UF:</span></span>
<span id="cb1649-6"><a href="#cb1649-6" aria-hidden="true" tabindex="-1"></a>  dados_uf <span class="ot">&lt;-</span> por_uf[[uf]]</span>
<span id="cb1649-7"><a href="#cb1649-7" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Adicionando uma nova página ao workbook:</span></span>
<span id="cb1649-8"><a href="#cb1649-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addWorksheet</span>(wb, uf)</span>
<span id="cb1649-9"><a href="#cb1649-9" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Escrevendo os dados da UF nessa página:</span></span>
<span id="cb1649-10"><a href="#cb1649-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">writeData</span>(wb, uf, dados_uf)</span>
<span id="cb1649-11"><a href="#cb1649-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1649-12"><a href="#cb1649-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1649-13"><a href="#cb1649-13" aria-hidden="true" tabindex="-1"></a><span class="fu">saveWorkbook</span>(wb, <span class="st">&quot;dados-datasus.xlsx&quot;</span>)</span></code></pre></div>
<p></p>
</div>
</div>
<div id="sobre-código-vetorizado-vectorized-code" class="section level2" number="15.9">
<h2 number="15.9"><span class="header-section-number">15.9</span> Sobre código vetorizado (<em>vectorized code</em>)</h2>
<p>Na comunidade do R, os <em>loop</em>’s não são particularmente incentivados como em outras linguagens de programação. Programas escritos em linguagens como C, C++ e Python quase sempre utilizam <em>loop</em>’s de forma massiva, algo que nem sempre ocorre em programas escritos em R.</p>
<p>Tal diferença ocorre por dois motivos: 1) R é uma linguagem funcional, logo, quando precisamos utilizar um <em>loop</em>, ao invés de defini-lo explicitamente, nós geralmente aplicamos uma função que constrói esse <em>loop</em> por nós <span class="citation">(<a href="#ref-wickham2017" role="doc-biblioref">Wickham and Grolemund 2017</a>)</span>; 2) para mais, o R é uma linguagem focada em cálculos vetorizados <span class="citation">(<a href="#ref-grolemund2014" role="doc-biblioref">Grolemund 2014</a>)</span>. Isto significa que a linguagem R prefere trabalhar em seus cálculos, com todo o vetor (ou todo o objeto) de uma vez só, ao invés de trabalhar sequencialmente com cada um dos elementos desse objeto de forma individual.</p>
<p>Por essa característica, programas em R, usualmente se aproveitam de três características: testes lógicos, <em>subsetting</em> e cálculos por elemento, ou <em>element-wise execution</em> <span class="citation">(<a href="#ref-grolemund2014" role="doc-biblioref">Grolemund 2014</a>)</span>. Pois essas características são o que o R faz de melhor.</p>
<p>Uma soma entre dois vetores, é um bom exemplo que demonstra como essa noção de <em>element-wise execution</em> está enraizada na forma como o R realiza os seus cálculos. Para somarmos dois vetores no R, precisamos apenas conectar esses dois vetores pelo operador <code>+</code>. Perceba que isso é algo muito simples e direto.</p>
<p></p>
<div class="sourceCode" id="cb1650"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1650-1"><a href="#cb1650-1" aria-hidden="true" tabindex="-1"></a>vetor1 <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span></span>
<span id="cb1650-2"><a href="#cb1650-2" aria-hidden="true" tabindex="-1"></a>vetor2 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">30</span>, <span class="dv">40</span>, <span class="dv">50</span>)</span>
<span id="cb1650-3"><a href="#cb1650-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1650-4"><a href="#cb1650-4" aria-hidden="true" tabindex="-1"></a>vetor1 <span class="sc">+</span> vetor2</span></code></pre></div>
<pre><code>## [1] 11 22 33 44 55</code></pre>
<p></p>
<p>Contudo, para realizarmos esse mesmo trabalho em outras linguagens, temos um trabalho maior, pois essas outras linguagens operam de uma forma completamente diferente do R. Perceba que nos dois exemplos abaixo, ambas as soluções apresentadas dependem de um <code>for</code> <em>loop</em>. Como um primeiro exemplo, eu poderia reproduzir em C, a soma entre os objetos <code>vetor1</code> e <code>vetor2</code> da seguinte forma:</p>
<p></p>
<div class="sourceCode" id="cb1652"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb1652-1"><a href="#cb1652-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> vetor1[<span class="dv">5</span>] = {</span>
<span id="cb1652-2"><a href="#cb1652-2" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span></span>
<span id="cb1652-3"><a href="#cb1652-3" aria-hidden="true" tabindex="-1"></a>};</span>
<span id="cb1652-4"><a href="#cb1652-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1652-5"><a href="#cb1652-5" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> vetor2[<span class="dv">5</span>] = {</span>
<span id="cb1652-6"><a href="#cb1652-6" aria-hidden="true" tabindex="-1"></a>  <span class="dv">10</span>,<span class="dv">20</span>,<span class="dv">30</span>,<span class="dv">40</span>,<span class="dv">50</span></span>
<span id="cb1652-7"><a href="#cb1652-7" aria-hidden="true" tabindex="-1"></a>};</span>
<span id="cb1652-8"><a href="#cb1652-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1652-9"><a href="#cb1652-9" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> soma[<span class="dv">5</span>];</span>
<span id="cb1652-10"><a href="#cb1652-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1652-11"><a href="#cb1652-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; <span class="dv">5</span>; i++) {</span>
<span id="cb1652-12"><a href="#cb1652-12" aria-hidden="true" tabindex="-1"></a>  soma[i] = vetor1[i] + vetor2[i];</span>
<span id="cb1652-13"><a href="#cb1652-13" aria-hidden="true" tabindex="-1"></a>  printf(<span class="st">&quot;%d  &quot;</span>, soma[i]);</span>
<span id="cb1652-14"><a href="#cb1652-14" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p></p>
<pre><code>## 11  22  33  44  55</code></pre>
<p>Como um segundo exemplo, eu poderia reproduzir essa mesma soma em Python da seguinte maneira:</p>
<p></p>
<div class="sourceCode" id="cb1654"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb1654-1"><a href="#cb1654-1" aria-hidden="true" tabindex="-1"></a>vetor1 <span class="op">=</span> [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>]</span>
<span id="cb1654-2"><a href="#cb1654-2" aria-hidden="true" tabindex="-1"></a>vetor2 <span class="op">=</span> [<span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">30</span>, <span class="dv">40</span>, <span class="dv">50</span>]</span>
<span id="cb1654-3"><a href="#cb1654-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1654-4"><a href="#cb1654-4" aria-hidden="true" tabindex="-1"></a>soma <span class="op">=</span> []</span>
<span id="cb1654-5"><a href="#cb1654-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(vetor1)):</span>
<span id="cb1654-6"><a href="#cb1654-6" aria-hidden="true" tabindex="-1"></a>  soma.append(vetor1[i] <span class="op">+</span> vetor2[i])</span>
<span id="cb1654-7"><a href="#cb1654-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1654-8"><a href="#cb1654-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(soma)</span></code></pre></div>
<pre><code>## [11, 22, 33, 44, 55]</code></pre>
<p></p>
<p>Portanto, enquanto linguagens como Python e C executam seus cálculos em uma perspectiva mais “incremental” (uma operação de cada vez), o R prefere realizar esses mesmos cálculos em uma perspectiva mais “vetorizada,” lidando com todo o objeto de uma vez só. A figura 15.3 abaixo, apresenta tal diferença de maneira gráfica.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/vetorizacao.png" alt="Como a soma entre dois vetores é executada em diferentes linguagens de programação" width="100%" />
<p class="caption">
(#fig:unnamed-chunk-873)Como a soma entre dois vetores é executada em diferentes linguagens de programação
</p>
</div>
<p></p>
<p><span class="citation"><a href="#ref-grolemund2014" role="doc-biblioref">Grolemund</a> (<a href="#ref-grolemund2014" role="doc-biblioref">2014</a>)</span> é provavelmente o autor que melhor destacou essa diferença entre o R e outras linguagens. Como exemplo, <span class="citation"><a href="#ref-grolemund2014" role="doc-biblioref">Grolemund</a> (<a href="#ref-grolemund2014" role="doc-biblioref">2014</a>)</span> mostrou a diferença entre duas funções (<code>abs_loop()</code> e <code>abs_vec()</code>) que aceitam um vetor numérico como <em>input</em>, e que retornam um novo vetor contendo os valores absolutos dos números contidos no vetor de <em>input</em>.</p>
<p>Em outras palavras, ambas as funções são equivalentes à função <code>abs()</code> dos pacotes básicos do R. Porém, elas realizam os seus cálculos de maneiras bastante distintas. A função <code>abs_loop()</code> utiliza um <code>for</code> <em>loop</em> para visitar individualmente cada elemento do vetor de <em>input</em>, e multiplica esse elemento por -1 caso ele seja menor que 0. Logo, <code>abs_loop()</code> adota uma perspectiva semelhante às linguagens C e Python. Por outro lado, <code>abs_vec()</code> se aproveita das características fortes do R, pois ele primeiro utiliza um teste lógico para detectar todos os elementos do vetor que precisam ser ajustados, e, em seguida, multiplica todos esses elementos por -1 de uma vez só.</p>
<p></p>
<div class="sourceCode" id="cb1656"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1656-1"><a href="#cb1656-1" aria-hidden="true" tabindex="-1"></a>abs_loop <span class="ot">&lt;-</span> <span class="cf">function</span>(vec){</span>
<span id="cb1656-2"><a href="#cb1656-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_along</span>(vec)){</span>
<span id="cb1656-3"><a href="#cb1656-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(vec[i] <span class="sc">&lt;</span> <span class="dv">0</span>){</span>
<span id="cb1656-4"><a href="#cb1656-4" aria-hidden="true" tabindex="-1"></a>      vec[i] <span class="ot">&lt;-</span> vec[i] <span class="sc">*</span> <span class="sc">-</span><span class="dv">1</span></span>
<span id="cb1656-5"><a href="#cb1656-5" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1656-6"><a href="#cb1656-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1656-7"><a href="#cb1656-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1656-8"><a href="#cb1656-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(vec)</span>
<span id="cb1656-9"><a href="#cb1656-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1656-10"><a href="#cb1656-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1656-11"><a href="#cb1656-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1656-12"><a href="#cb1656-12" aria-hidden="true" tabindex="-1"></a>abs_vec <span class="ot">&lt;-</span> <span class="cf">function</span>(vec){</span>
<span id="cb1656-13"><a href="#cb1656-13" aria-hidden="true" tabindex="-1"></a>  negative <span class="ot">&lt;-</span> vec <span class="sc">&lt;</span> <span class="dv">0</span></span>
<span id="cb1656-14"><a href="#cb1656-14" aria-hidden="true" tabindex="-1"></a>  vec[negative] <span class="ot">&lt;-</span> vec[negative] <span class="sc">*</span> <span class="sc">-</span><span class="dv">1</span></span>
<span id="cb1656-15"><a href="#cb1656-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(vec)</span>
<span id="cb1656-16"><a href="#cb1656-16" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p></p>
<p>Realizei um teste rápido em meu computador, aplicando ambas as funções sobre um vetor de 100 milhões de elementos. Os resultados da função <code>abs_loop()</code> são de certa forma impressionantes, pois eles mostram claramente uma grande evolução da linguagem nos últimos anos.</p>
<p>Na época, <span class="citation"><a href="#ref-grolemund2014" role="doc-biblioref">Grolemund</a> (<a href="#ref-grolemund2014" role="doc-biblioref">2014</a>)</span> realizou este mesmo teste com um vetor de 5 milhões de observações, e a função <code>abs_loop()</code> demorou em torno de 16 segundos para sua execução. Porém, hoje, em 2021, utilizando uma instalação do R no Windows, em sua versão 4.1.0, adquirimos praticamente os mesmos 16 segundos sobre um vetor 20 vezes maior que o vetor utilizado por <span class="citation"><a href="#ref-grolemund2014" role="doc-biblioref">Grolemund</a> (<a href="#ref-grolemund2014" role="doc-biblioref">2014</a>)</span>. Isso mostra uma grande melhoria de performance dos <em>loops</em> construídos pela linguagem nos últimos anos.</p>
<p></p>
<div class="sourceCode" id="cb1657"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1657-1"><a href="#cb1657-1" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>({</span>
<span id="cb1657-2"><a href="#cb1657-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abs_loop</span>(<span class="fu">rnorm</span>(<span class="dv">100000000</span>))</span>
<span id="cb1657-3"><a href="#cb1657-3" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<p></p>
<pre><code>##  usuário   sistema decorrido 
##    15.99      0.29     16.34</code></pre>
<p></p>
<div class="sourceCode" id="cb1659"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1659-1"><a href="#cb1659-1" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>({</span>
<span id="cb1659-2"><a href="#cb1659-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abs_vec</span>(<span class="fu">rnorm</span>(<span class="dv">100000000</span>))</span>
<span id="cb1659-3"><a href="#cb1659-3" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<p></p>
<pre><code>##  usuário   sistema decorrido 
##     9.05      0.45      9.58</code></pre>
<p>Obviamente, parte dessa melhoria se deve ao hardware atual, que provavelmente é mais rápido e moderno que o hardware utilizado na época de <span class="citation"><a href="#ref-grolemund2014" role="doc-biblioref">Grolemund</a> (<a href="#ref-grolemund2014" role="doc-biblioref">2014</a>)</span>. Mesmo assim, um ganho de performance de 20 vezes não pode ser atribuído apenas ao hardware de um notebook de entrada como o meu, que inclui 8GB de RAM e um processador lançado ao mercado no início de 2017. Parte desses resultados se devem à otimizações da própria linguagem, que foi se aprimorando ao longo dos anos.</p>
<p>Para fins de comparação, mesmo que eu reproduza exatamente o mesmo teste realizado por <span class="citation"><a href="#ref-grolemund2014" role="doc-biblioref">Grolemund</a> (<a href="#ref-grolemund2014" role="doc-biblioref">2014</a>)</span>, podemos perceber não apenas o grande ganho de <code>abs_loop()</code>, mas também, de <code>abs_vec()</code>. Nos testes de <span class="citation"><a href="#ref-grolemund2014" role="doc-biblioref">Grolemund</a> (<a href="#ref-grolemund2014" role="doc-biblioref">2014</a>)</span>, as funções <code>abs_loop()</code> e <code>abs_vec()</code> demoraram 16,018 e 0,52 segundos, respectivamente. Por outro lado, perceba pelos resultados dos testes abaixo (realizados no meu computador), que essas mesmas funções levaram apenas 0,77 e 0,11 segundos. O que realmente impressiona nesses resultados, é como a função <code>abs_loop()</code> se aproximou bastante da performance apresentada por <code>abs_vec()</code>.</p>
<p></p>
<div class="sourceCode" id="cb1661"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1661-1"><a href="#cb1661-1" aria-hidden="true" tabindex="-1"></a>long <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>), <span class="dv">5000000</span>)</span>
<span id="cb1661-2"><a href="#cb1661-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1661-3"><a href="#cb1661-3" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>({</span>
<span id="cb1661-4"><a href="#cb1661-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abs_loop</span>(long)</span>
<span id="cb1661-5"><a href="#cb1661-5" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<p></p>
<pre><code>##  usuário   sistema decorrido 
##     0.76      0.00      0.77</code></pre>
<p></p>
<div class="sourceCode" id="cb1663"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1663-1"><a href="#cb1663-1" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>({</span>
<span id="cb1663-2"><a href="#cb1663-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abs_vec</span>(long)</span>
<span id="cb1663-3"><a href="#cb1663-3" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<p></p>
<pre><code>##  usuário   sistema decorrido 
##     0.09      0.02      0.11 </code></pre>
<p>Este tipo de resultado, demonstra que os <em>loops</em> no R são muito mais rápidos do que a maior parte dos usuários imagina. Essa é uma polêmica antiga na comunidade internacional de R, onde a ideia de que <em>loops</em> no R são lentos e ineficientes acabou sendo difundida em massa. Parte da culpa não reside apenas nos usuários, dado que o próprio manual interno e introdutório da linguagem desincentiva o uso de <em>loops</em>:</p>
<blockquote>
<blockquote>
<p>Warning: <code>for()</code> <em>loops</em> are used in R code much less often than in compiled languages.
Code that takes a ‘whole object’ view is likely to be both clearer and faster in R. <span class="citation">(<a href="#ref-Rintroduction" role="doc-biblioref">R Core Team 2020a</a>, p 41)</span></p>
</blockquote>
</blockquote>
<p>Uma outra parte da fonte que incentivou o surgimento dessa polêmica, foi o simples fato de que o R é uma linguagem funcional. Portanto, loops explícitos no R são mais incomuns do que em outras linguagens. Por esse motivo, muitos usuários acabaram pressupondo que loops explícitos fossem algo ruim no R.</p>
<p>O que muitos não percebem, é que mesmo com esses pressupostos, nós ainda utilizamos loops em diversas situações no R. Porém, quando essas situações ocorrem, esse <em>loop</em> geralmente está “escondido” atrás de uma função. Ou seja, ao invés de construirmos um <em>loop</em> explícito, nós utilizamos uma função que constrói, por nós, esse <em>loop</em> de forma implícita. Exemplos disso são as funções <code>lapply()</code> e <code>purrr::map()</code>.</p>
<p>Concluindo, os resultados acima, demonstram que a linguagem R oferece sim, <em>loops</em> rápidos e eficientes, que podem produzir uma boa performance. Entretanto, ainda assim, as soluções vetorizadas continuam sendo as mais performáticas, e mesmo com o bom desempenho apresentado, os <em>loops</em> do R não se escalam tão bem quanto os <em>loops</em> de outras linguagens como C e C++.</p>
<p>Por esse motivo, muitos usuários do R, quando enfrentam um problema mais complexo que exige o uso intensivo de <em>loops</em>, utilizam interfaces (como a API fornecida pelo pacote <code>Rcpp</code>) para reescrever os seus <em>loops</em> em linguagens mais performáticas como C++. O <a href="https://cran.r-project.org/web/packages/Rcpp/vignettes/Rcpp-introduction.pdf">artigo de introdução</a> do pacote <code>Rcpp</code> oferece bons exemplos onde isso ocorre, mostrando também como você pode acessar, através do R, funções escritas em C++.</p>
<p>Na prática, isso significa que, se você deseja adquirir a melhor performance possível no R, tente escrever um código sob uma perspectiva “vetorizada,” que se aproveita das 3 características principais do R (<em>subsetting</em>, testes lógicos e <em>element-wise execution</em>). Entretanto, não tenha medo ou receio de utilizar <em>loops</em> em seu código, pois eles também conseguem entregar uma boa performance.</p>
<p>Contudo, se os loops do R não são rápidos o suficiente para o seu problema, tente utilizar alguma interface para reescrever esses <em>loops</em> em linguagens mais performáticas, como C e C++. O R oferece de fábrica uma API para a linguagem C, que está descrita no capítulo 5 do manual <a href="https://cran.r-project.org/doc/manuals/r-release/R-exts.html#System-and-foreign-language-interfaces">Writing R Extensions</a>. Mas você também pode utilizar o pacote <code>Rcpp</code> para acessar funções escritas em C++.</p>
</div>
<div id="exercícios-11" class="section level2 unnumbered">
<h2 class="unnumbered">Exercícios</h2>
<p><strong>Questão 15.1.</strong> Responda as questões abaixo:</p>
<p>15.1.A) O que acontece se executarmos o for loop abaixo:</p>
<p></p>
<div class="sourceCode" id="cb1665"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1665-1"><a href="#cb1665-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">&quot;integer&quot;</span>)</span>
<span id="cb1665-2"><a href="#cb1665-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1665-3"><a href="#cb1665-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_along</span>(x)){</span>
<span id="cb1665-4"><a href="#cb1665-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(i)</span>
<span id="cb1665-5"><a href="#cb1665-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p></p>
<p>15.1.B) Porque o <em>loop</em> abaixo é um <em>loop</em> infinito?</p>
<p></p>
<div class="sourceCode" id="cb1666"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1666-1"><a href="#cb1666-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb1666-2"><a href="#cb1666-2" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> ( x <span class="sc">&lt;</span> <span class="dv">10</span> ) {</span>
<span id="cb1666-3"><a href="#cb1666-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(x)</span>
<span id="cb1666-4"><a href="#cb1666-4" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> x <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb1666-5"><a href="#cb1666-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (x <span class="sc">%%</span> <span class="dv">5</span> <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb1666-6"><a href="#cb1666-6" aria-hidden="true" tabindex="-1"></a>    x <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb1666-7"><a href="#cb1666-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1666-8"><a href="#cb1666-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p></p>
<p>15.1.C) Quantas vezes o <code>for</code> <em>loop</em> abaixo vai repetir os comandos descritos em seu <em>body</em>?</p>
<p></p>
<div class="sourceCode" id="cb1667"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1667-1"><a href="#cb1667-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">id =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span>
<span id="cb1667-2"><a href="#cb1667-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(name <span class="cf">in</span> letters[<span class="dv">1</span><span class="sc">:</span><span class="dv">24</span>]){</span>
<span id="cb1667-3"><a href="#cb1667-3" aria-hidden="true" tabindex="-1"></a>  df[[name]] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb1667-4"><a href="#cb1667-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p></p>
<p>15.1.D) Porque o <code>for</code> <em>loop</em> abaixo está retornando <code>numeric(0)</code> na segunda iteração? Qual é a fonte do erro?</p>
<p></p>
<div class="sourceCode" id="cb1668"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1668-1"><a href="#cb1668-1" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">&quot;integer&quot;</span>)</span>
<span id="cb1668-2"><a href="#cb1668-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span></span>
<span id="cb1668-3"><a href="#cb1668-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(y)){</span>
<span id="cb1668-4"><a href="#cb1668-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(x[i] <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb1668-5"><a href="#cb1668-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## [1] 2
## numeric(0)</code></pre>
<p></p>
<p><strong>Questão 15.2.</strong> Crie um <em>loop</em> que seja capaz de encontra o valor máximo do vetor <code>vec</code> abaixo. Em outras palavras, construa um <em>loop</em> que consiga encontrar o mesmo resultado do comando <code>max(vec)</code>.</p>
<p></p>
<div class="sourceCode" id="cb1670"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1670-1"><a href="#cb1670-1" aria-hidden="true" tabindex="-1"></a>vec <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb1670-2"><a href="#cb1670-2" aria-hidden="true" tabindex="-1"></a>  <span class="fl">5.2</span>, <span class="fl">6.1</span>, <span class="fl">2.3</span>, <span class="fl">7.4</span>, <span class="fl">1.1</span>, <span class="fl">3.6</span>,</span>
<span id="cb1670-3"><a href="#cb1670-3" aria-hidden="true" tabindex="-1"></a>  <span class="fl">7.2</span>, <span class="fl">8.1</span>, <span class="fl">3.3</span>, <span class="fl">4.5</span>, <span class="fl">0.8</span>, <span class="fl">5.4</span></span>
<span id="cb1670-4"><a href="#cb1670-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p></p>
<p><strong>Questão 15.3.</strong> Ao longo deste capítulo, nós não mostramos um exemplo de um <em>loop</em> aninhado (<em>nested loop</em>), isto é, um loop que contém um outro <em>loop</em> dentro de si. Porém, é completamente permitido que você construa camadas e camadas de <em>loops</em> desta maneira. Seu objetivo neste exercício é desenvolver um <em>loop</em> aninhado que preencha a matriz <code>mt</code> abaixo. Ao final do <em>loop</em>, cada elemento dessa matriz deve conter o resultado da multiplicação dos índices que localizam esse elemento nessa matriz. Ou seja, o elemento da 9° linha da 10° coluna, deve conter o valor <span class="math inline">\(9 \times 10 = 90\)</span>; já o elemento da 15° linha da 3° coluna, deve conter o valor <span class="math inline">\(15 \times 3 = 45\)</span>; e assim por diante.</p>
<p></p>
<div class="sourceCode" id="cb1671"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1671-1"><a href="#cb1671-1" aria-hidden="true" tabindex="-1"></a>mt <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">ncol =</span> <span class="dv">30</span>, <span class="at">nrow =</span> <span class="dv">30</span>)</span></code></pre></div>
<p></p>
<!-- **Questão 13.4.** Seu objetivo é encontrar a raiz quadrada de 25, utilizando o método da bisecção (ou *bisection search* como é mais conhecido). -->
<!-- ```{r} -->
<!-- x = 25 -->
<!-- epsilon = 0.01 -->
<!-- numGuesses = 0 -->
<!-- low = 0.0 -->
<!-- high = max(1.0, x) -->
<!-- ans = (high + low)/2.0 -->
<!-- while abs(ans**2 - x) >= epsilon: -->
<!--  numGuesses += 1 -->
<!--  if ans**2 < x: -->
<!--  low = ans -->
<!--  else: -->
<!--  high = ans -->
<!--  ans = (high + low)/2.0 -->
<!-- print('numGuesses =', numGuesses) -->
<!-- print(ans, 'is close to square root of', x) -->
<!-- ``` -->
<!-- ```{r} -->
<!-- x <- 25 -->
<!-- epsilon <- 0.01 -->
<!-- numGuesses <- 0 -->
<!-- low <- 0.0 -->
<!-- high <- max(1.0, x) -->
<!-- ans <- (high + low)/2.0 -->
<!-- while ( abs(ans ^ 2 - x) >= epsilon ) { -->
<!--   numGuesses <- numGuesses + 1 -->
<!--   if (ans ^ 2 < x) { -->
<!--     low = ans  -->
<!--   } -->
<!--   else { -->
<!--     high <- ans -->
<!--   } -->
<!--   ans <- (high + low)/2.0 -->
<!-- } -->
<!-- cat('numGuesses =', numGuesses, "\n") -->
<!-- cat(ans, 'is close to square root of', x) -->
<!-- ``` -->
<!--chapter:end:17-loops.Rmd-->
</div>
</div>
<div id="functional-programming-com-purrr" class="section level1" number="16">
<h1 number="16"><span class="header-section-number">16</span> <em>Functional programming</em> com <code>purrr</code></h1>
<div id="introdução-2" class="section level2" number="16.1">
<h2 number="16.1"><span class="header-section-number">16.1</span> Introdução</h2>
<p>Neste capítulo, vamos introduzir um outro pacote do <code>tidyverse</code>, chamado de <code>purrr</code>. Esse pacote provê um conjunto de ferramentas que ampliam as funcionalidades de <em>functional programming</em> do R. Para ter acesso às funções desse pacote, você pode chamar tanto pelo <code>tidyverse</code> quanto pelo <code>purrr</code> diretamente.</p>
<p></p>
<div class="sourceCode" id="cb1672"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1672-1"><a href="#cb1672-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1672-2"><a href="#cb1672-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span></code></pre></div>
<p></p>
</div>
<div id="loops-implícitos-com-a-família-map" class="section level2" number="16.2">
<h2 number="16.2"><span class="header-section-number">16.2</span> <em>Loops</em> implícitos com a família <code>map</code></h2>
<p>A principal fraqueza de um <code>for</code> <em>loop</em> é que ele foca demasiada atenção sobre os objetos envolvidos na iteração. Isso por um lado é bom, pois você consegue identificar todas as “dependências” de um <code>for</code> <em>loop</em>, mas, por um outro lado, é ruim. Pois na maioria das vezes, é muito mais importante identificarmos a ação, a transformação ou a funcionalidade que está sendo aplicada sobre esses objetos em cada iteração.</p>
<p>Por exemplo, abaixo temos dois <code>for</code> <em>loops</em> diferentes que aplicam uma determinada operação sobre o objeto <code>tab</code>. O que cada <code>for</code> <em>loop</em> abaixo está fazendo? Qual a diferença entre eles? Após observá-los por um tempo você vai acabar percebendo que a única diferença entre esses dois <code>for</code> <em>loops</em> está na função que está sendo aplicada sobre cada coluna de <code>tab</code>.</p>
<p></p>
<div class="sourceCode" id="cb1673"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1673-1"><a href="#cb1673-1" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb1673-2"><a href="#cb1673-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">x1 =</span> <span class="fu">rnorm</span>(<span class="dv">10</span>),</span>
<span id="cb1673-3"><a href="#cb1673-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">x2 =</span> <span class="fu">rnorm</span>(<span class="dv">10</span>),</span>
<span id="cb1673-4"><a href="#cb1673-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">x3 =</span> <span class="fu">rnorm</span>(<span class="dv">10</span>),</span>
<span id="cb1673-5"><a href="#cb1673-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">x4 =</span> <span class="fu">rnorm</span>(<span class="dv">10</span>)</span>
<span id="cb1673-6"><a href="#cb1673-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1673-7"><a href="#cb1673-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1673-8"><a href="#cb1673-8" aria-hidden="true" tabindex="-1"></a>vec1 <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">&quot;double&quot;</span>, <span class="at">length =</span> <span class="fu">ncol</span>(tab))</span>
<span id="cb1673-9"><a href="#cb1673-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_along</span>(tab)){</span>
<span id="cb1673-10"><a href="#cb1673-10" aria-hidden="true" tabindex="-1"></a>  vec1[i] <span class="ot">&lt;-</span> <span class="fu">mean</span>(tab[[i]], <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1673-11"><a href="#cb1673-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1673-12"><a href="#cb1673-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1673-13"><a href="#cb1673-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1673-14"><a href="#cb1673-14" aria-hidden="true" tabindex="-1"></a>vec2 <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">&quot;double&quot;</span>, <span class="at">length =</span> <span class="fu">ncol</span>(tab))</span>
<span id="cb1673-15"><a href="#cb1673-15" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_along</span>(tab)){</span>
<span id="cb1673-16"><a href="#cb1673-16" aria-hidden="true" tabindex="-1"></a>  vec2[i] <span class="ot">&lt;-</span> <span class="fu">median</span>(tab[[i]], <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1673-17"><a href="#cb1673-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1673-18"><a href="#cb1673-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1673-19"><a href="#cb1673-19" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(vec1)</span></code></pre></div>
<pre><code>## [1] -0.52620962  0.49760887  0.24003168 -0.02559521</code></pre>
<div class="sourceCode" id="cb1675"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1675-1"><a href="#cb1675-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(vec2)</span></code></pre></div>
<pre><code>## [1] -0.56059544  0.32895476  0.19140022  0.08733386</code></pre>
<p></p>
<p>É esse o problema que a família de funções <code>map</code> busca solucionar, ao nos fornecer um meio de construirmos <em>loops</em> em um formato mais funcional, destacando assim, as transformações e funções que estamos aplicando em cada repetição, ao invés dos objetos envolvidos na iteração. Como exemplo, podemos replicar o mesmo exemplo de <code>for</code> <em>loops</em> acima, utilizando a família de funções <code>map</code>, da seguinte forma:</p>
<p></p>
<div class="sourceCode" id="cb1677"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1677-1"><a href="#cb1677-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span>
<span id="cb1677-2"><a href="#cb1677-2" aria-hidden="true" tabindex="-1"></a>vec1 <span class="ot">&lt;-</span> <span class="fu">map_dbl</span>(tab, mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1677-3"><a href="#cb1677-3" aria-hidden="true" tabindex="-1"></a>vec2 <span class="ot">&lt;-</span> <span class="fu">map_dbl</span>(tab, median, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1677-4"><a href="#cb1677-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1677-5"><a href="#cb1677-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(vec1)</span></code></pre></div>
<pre><code>##          x1          x2          x3          x4 
## -0.52620962  0.49760887  0.24003168 -0.02559521</code></pre>
<div class="sourceCode" id="cb1679"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1679-1"><a href="#cb1679-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(vec2)</span></code></pre></div>
<pre><code>##          x1          x2          x3          x4 
## -0.56059544  0.32895476  0.19140022  0.08733386</code></pre>
<p></p>
<p>Perceba acima, o quão simples e sucinto é para expressarmos uma operação com a família <code>map</code>. Vamos explicar daqui a pouco, em detalhes como essas funções funcionam. Por enquanto, quero apenas destacar que agora com a função <code>map_dbl()</code>, está muito fácil de identificarmos a diferença entre os dois <em>loops</em> acima. Pois a única coisa que está de fato mudando entre uma linha e outra, é a função aplicada sobre cada coluna de <code>tab</code>, que são as funções <code>mean()</code> e <code>median()</code>. Dessa forma, você pode rapidamente entender que o primeiro <em>loop</em> está calculando a média de cada coluna, enquanto o segundo <em>loop</em>, está calculando a mediana.</p>
<div id="a-família-de-funções-map" class="section level3" number="16.2.1">
<h3 number="16.2.1"><span class="header-section-number">16.2.1</span> A família de funções <code>map()</code></h3>
<p>Portanto, o pacote <code>purrr</code> nos oferece a família de funções <code>map</code>, a qual possui 7 membros diferentes, sendo eles:</p>
<ul>
<li><code>map()</code>: retorna uma lista.</li>
<li><code>map_dbl()</code>: retorna um vetor atômico do tipo <code>double</code>.</li>
<li><code>map_chr()</code>: retorna um vetor atômico do tipo <code>character</code>.</li>
<li><code>map_int()</code>: retorna um vetor atômico do tipo <code>integer</code>.</li>
<li><code>map_lgl()</code>: retorna um vetor atômico do tipo <code>logical</code>.</li>
<li><code>map_dfr()</code> e <code>map_dfc()</code>: retornam um <code>data.frame</code>.</li>
</ul>
<p>Todas essas 7 funções possuem os mesmos argumentos e realizam exatamente o mesmo trabalho. A única diferença entre elas, está na estrutura de dado em que o resultado é retornado. Tal estrutura é identificada pelo sufixo presente no nome de cada função. Portanto, todas essas funções <code>map</code> aceitam um objeto como <em>input</em>, e retornam como <em>output</em>, um novo objeto de mesmo comprimento que o objeto de <em>input</em>, e na estrutura identificada pelo sufixo no nome da função <span class="citation">(<a href="#ref-wickham2017" role="doc-biblioref">Wickham and Grolemund 2017</a>)</span>.</p>
<p>Toda função <code>map</code> possui 3 argumentos principais, sendo eles: 1) <code>.x</code>, que é o objeto sobre o qual <code>map</code> vai iterar, ou, sobre o qual ela vai aplicar o <em>loop</em>; 2) <code>.f</code>, que é a função a ser aplicada sobre cada elemento de <code>.x</code>; e 3) <code>...</code>, que é a lista de argumentos a serem repassados para a função definida em <code>.f</code>.</p>
<p>Em resumo, todas as funções <code>map</code> buscam aplicar a função definida em <code>.f</code> sobre cada elemento do objeto <code>.x</code>. Consequentemente, o resultado de toda função <code>map</code> é um novo objeto contendo os resultados da função definida em <code>.f</code> aplicada sobre cada elemento do objeto definido em <code>.x</code>. Tal ação, está representada na figura 16.1.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/map_simple.png" alt="Representação simples da tarefa executada por \texttt{map\_dbl()}" width="70%" />
<p class="caption">
(#fig:unnamed-chunk-883)Representação simples da tarefa executada por 
</p>
</div>
<p></p>
<p>Portanto, no exemplo anterior, em que aplicamos a função <code>map_dbl()</code> sobre o objeto <code>tab</code>, o que <code>map_dbl()</code> fez, foi criar um <em>loop</em> para aplicar as funções <code>mean()</code> e <code>median()</code> sobre cada elemento de <code>tab</code>. Como <code>tab</code> é um <code>data.frame</code>, cada elemento desse objeto corresponde a uma coluna do <code>data.frame</code>. A medida em que as funções <code>mean()</code> e <code>median()</code> foram sendo aplicadas sobre cada coluna de <code>tab</code>, a função <code>map_dbl()</code> foi coletando e armazenando os seus resultados em um vetor atômico do tipo <code>double</code>. Por fim, a função <code>map_dbl()</code> nos retorna como <em>output</em>, este vetor atômico contendo todos os resultados gerados. A figura 16.2 abaixo, apresenta esse processo de forma mais detalhada.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/map.png" alt="Representação mais detalhada da tarefa executada por \texttt{map\_dbl()}" width="100%" />
<p class="caption">
(#fig:unnamed-chunk-884)Representação mais detalhada da tarefa executada por 
</p>
</div>
<p></p>
</div>
<div id="no-fundo-estamos-utilizando-um-for-loop" class="section level3" number="16.2.2">
<h3 number="16.2.2"><span class="header-section-number">16.2.2</span> No fundo, estamos utilizando um <code>for</code> <em>loop</em></h3>
<p>No fim das contas, todas as funções <code>map</code> utilizam em algum momento um <code>for</code> <em>loop</em> para aplicar a função <code>.f</code> sobre cada elemento do objeto <code>.x</code>. Um detalhe é que essas funções constroem esse <code>for</code> <em>loop</em> em C, com o objetivo de gerar máxima performance. A título de ilustração, poderíamos reproduzir em R a definição da função <code>map()</code>, da seguinte forma:</p>
<p></p>
<div class="sourceCode" id="cb1681"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1681-1"><a href="#cb1681-1" aria-hidden="true" tabindex="-1"></a>map <span class="ot">&lt;-</span> <span class="cf">function</span>(.x, .f, ...){</span>
<span id="cb1681-2"><a href="#cb1681-2" aria-hidden="true" tabindex="-1"></a>  resultados <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">&quot;list&quot;</span>, <span class="at">length =</span> <span class="fu">length</span>(.x))</span>
<span id="cb1681-3"><a href="#cb1681-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_along</span>(.x)){</span>
<span id="cb1681-4"><a href="#cb1681-4" aria-hidden="true" tabindex="-1"></a>    resultados[[i]] <span class="ot">&lt;-</span> <span class="fu">.f</span>(.x[[i]], ...)</span>
<span id="cb1681-5"><a href="#cb1681-5" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1681-6"><a href="#cb1681-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1681-7"><a href="#cb1681-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(resultados)</span>
<span id="cb1681-8"><a href="#cb1681-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1681-9"><a href="#cb1681-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1681-10"><a href="#cb1681-10" aria-hidden="true" tabindex="-1"></a><span class="fu">map</span>(tab, mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## [[1]]
## [1] -0.5262096
## 
## [[2]]
## [1] 0.4976089
## 
## [[3]]
## [1] 0.2400317
## 
## [[4]]
## [1] -0.02559521</code></pre>
<p></p>
<p>Com essa definição em mente, você também pode rapidamente atribuir as diferenças entre as funções <code>map()</code>, <code>map_dbl()</code>, e todas as demais funções <code>map</code>, à primeira linha dessa definição com a função <code>vector()</code>. Ou seja, a diferença principal entre as funções <code>map()</code> e <code>map_dbl()</code> (ou qualquer outra das funções <code>map</code>) é o tipo de vetor criado pela função <code>vector()</code>. Tal diferença está marcada na figura 16.3.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/dif_map.png" alt="Diferenças entre as definições das funções `map`" width="100%" />
<p class="caption">
(#fig:unnamed-chunk-887)Diferenças entre as definições das funções <code>map</code>
</p>
</div>
<p></p>
<p>Sendo assim, todas as funções <code>map</code> ainda dependem de um <code>for</code> <em>loop</em> para realizar o seu trabalho. Porém, essas funções assumem o trabalho duro de criar esse <code>for</code> <em>loop</em> por você. Como resultado, você economiza parte de seu tempo, e deixa a intenção de seu código mais clara.</p>
</div>
<div id="se-não-existe-uma-solução-pronta-no-r-crie-a-sua-própria" class="section level3" number="16.2.3">
<h3 number="16.2.3"><span class="header-section-number">16.2.3</span> Se não existe uma solução pronta no R, crie a sua própria</h3>
<p>Um dos grandes poderes das funções <code>map</code>, é que elas te ajudam a aplicar as suas ações sobre múltiplos <em>inputs</em> diferentes. Por “suas ações,” quero destacar que, se você não possui uma função já pronta no R que execute a ação que você deseja aplicar sobre cada elemento de seu objeto, você pode muito bem criar uma função personalizada, que aplique exatamente essa ação da forma como você deseja. Replicar depois essa função personalizada para os demais <em>inputs</em> se torna um passo muito simples com as funções <code>map</code>.</p>
<p>Por exemplo, imagine que você tenha uma lista como o objeto <code>l</code> abaixo, onde cada elemento é uma nova lista que pode conter um número variável de elementos. Agora, imagine que você queira identificar quais elementos dessa lista possuem <code>NA</code>’s. Nesse caso, você pode criar uma função como a <code>tem_na()</code> abaixo, que aceita uma lista como <em>input</em>, e utiliza as funções <code>is.na()</code> e <code>any()</code> para descobrir se algum dos elementos dessa lista contém um valor <code>NA</code>. Em seguida, podemos simplesmente replicar essa função para cada elemento da lista <code>l</code> com a função <code>map_lgl()</code>.</p>
<p></p>
<div class="sourceCode" id="cb1683"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1683-1"><a href="#cb1683-1" aria-hidden="true" tabindex="-1"></a>tem_na <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb1683-2"><a href="#cb1683-2" aria-hidden="true" tabindex="-1"></a>  teste <span class="ot">&lt;-</span> <span class="fu">is.na</span>(x)</span>
<span id="cb1683-3"><a href="#cb1683-3" aria-hidden="true" tabindex="-1"></a>  resultado <span class="ot">&lt;-</span> <span class="fu">any</span>(teste)</span>
<span id="cb1683-4"><a href="#cb1683-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(resultado)</span>
<span id="cb1683-5"><a href="#cb1683-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1683-6"><a href="#cb1683-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1683-7"><a href="#cb1683-7" aria-hidden="true" tabindex="-1"></a>l <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb1683-8"><a href="#cb1683-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="cn">NA</span>),</span>
<span id="cb1683-9"><a href="#cb1683-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="dv">24</span>, <span class="dv">12</span>),</span>
<span id="cb1683-10"><a href="#cb1683-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="dv">21</span>, <span class="cn">NA</span>, <span class="dv">4</span>),</span>
<span id="cb1683-11"><a href="#cb1683-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="dv">56</span>, <span class="dv">19</span>, <span class="dv">20</span>, <span class="dv">43</span>)</span>
<span id="cb1683-12"><a href="#cb1683-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1683-13"><a href="#cb1683-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1683-14"><a href="#cb1683-14" aria-hidden="true" tabindex="-1"></a>vec <span class="ot">&lt;-</span> <span class="fu">map_lgl</span>(l, tem_na)</span>
<span id="cb1683-15"><a href="#cb1683-15" aria-hidden="true" tabindex="-1"></a>vec</span></code></pre></div>
<pre><code>## [1]  TRUE FALSE  TRUE FALSE</code></pre>
<p></p>
</div>
<div id="alguns-atalhos-úteis-das-funções-map" class="section level3" number="16.2.4">
<h3 number="16.2.4"><span class="header-section-number">16.2.4</span> Alguns atalhos úteis das funções <code>map</code></h3>
<p>Existem alguns atalhos úteis que você pode utilizar ao definir o argumento <code>.f</code> nas funções <code>map</code>. Por exemplo, suponha que você possua uma lista com várias informações referentes a um determinado aluno. Caso você precise coletar as idades de cada aluno em um vetor atômico por exemplo, você poderia fornecer à função <code>map_dbl()</code>, uma função anônima responsável por extrair o item <code>idade</code> de uma lista de <em>input</em>, como demonstrado abaixo.</p>
<p></p>
<div class="sourceCode" id="cb1685"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1685-1"><a href="#cb1685-1" aria-hidden="true" tabindex="-1"></a>alunos <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb1685-2"><a href="#cb1685-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">Ana =</span> <span class="fu">list</span>(<span class="at">idade =</span> <span class="dv">15</span>, <span class="at">altura =</span> <span class="fl">1.67</span>),</span>
<span id="cb1685-3"><a href="#cb1685-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Bruno =</span> <span class="fu">list</span>(<span class="at">idade =</span> <span class="dv">17</span>, <span class="at">altura =</span> <span class="fl">1.75</span>),</span>
<span id="cb1685-4"><a href="#cb1685-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Amanda =</span> <span class="fu">list</span>(<span class="at">idade =</span> <span class="dv">21</span>, <span class="at">altura =</span> <span class="fl">1.88</span>),</span>
<span id="cb1685-5"><a href="#cb1685-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Eduardo =</span> <span class="fu">list</span>(<span class="at">idade =</span> <span class="dv">14</span>, <span class="at">altura =</span> <span class="fl">1.62</span>)</span>
<span id="cb1685-6"><a href="#cb1685-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1685-7"><a href="#cb1685-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1685-8"><a href="#cb1685-8" aria-hidden="true" tabindex="-1"></a>alunos <span class="sc">%&gt;%</span> </span>
<span id="cb1685-9"><a href="#cb1685-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map_dbl</span>(<span class="cf">function</span>(x) x<span class="sc">$</span>idade)</span></code></pre></div>
<pre><code>##     Ana   Bruno  Amanda Eduardo 
##      15      17      21      14</code></pre>
<p></p>
<p>Apesar de bem prático escrevermos uma função anônima dessa forma, podemos utilizar uma notação ainda mais simples. Tal notação consiste em utilizar um til (<code>~</code>) como uma abreviação para a declaração da função anônima, e um ponto final (<code>.</code>) para determinar onde o argumento será posicionado no corpo dessa função anônima. Tendo isso em mente, poderíamos reproduzir o exemplo acima, da seguinte forma:</p>
<p></p>
<div class="sourceCode" id="cb1687"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1687-1"><a href="#cb1687-1" aria-hidden="true" tabindex="-1"></a>alunos <span class="sc">%&gt;%</span> </span>
<span id="cb1687-2"><a href="#cb1687-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map_dbl</span>(<span class="sc">~</span>.<span class="sc">$</span>idade)</span></code></pre></div>
<pre><code>##     Ana   Bruno  Amanda Eduardo 
##      15      17      21      14</code></pre>
<p></p>
<p>Portanto, o til substitui de certa forma a palavra-chave <code>function</code>, e o ponto final representa o argumento da função, ou, o elemento sobre o qual a função será aplicada. Contudo, como esse processo de extrair informações específicas de uma lista é algo muito comum, as funções <code>map</code> também oferecem um outro atalho, que seria o uso de uma <em>string</em>. Logo, se você deseja extrair um item de uma lista presente em cada elemento de um objeto, você pode simplesmente fornecer o nome desse item em uma <em>string</em> à função <code>map</code>.</p>
<p></p>
<div class="sourceCode" id="cb1689"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1689-1"><a href="#cb1689-1" aria-hidden="true" tabindex="-1"></a>alunos <span class="sc">%&gt;%</span> </span>
<span id="cb1689-2"><a href="#cb1689-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map_dbl</span>(<span class="st">&quot;idade&quot;</span>)</span></code></pre></div>
<pre><code>##     Ana   Bruno  Amanda Eduardo 
##      15      17      21      14</code></pre>
<p></p>
</div>
</div>
<div id="um-estudo-de-caso-aplicando-um-modelo-econométrico-sobre-diferentes-países" class="section level2" number="16.3">
<h2 number="16.3"><span class="header-section-number">16.3</span> Um estudo de caso: aplicando um modelo econométrico sobre diferentes países</h2>
<p>Nessa seção, vamos reproduzir o famoso exemplo dado por Hadley Wickham em sua palestra <em>“Managing many models with R”</em>. Pois esse exemplo demonstra bem, como as funções <code>map</code> ampliam as nossas capacidades com a linguagem R. Tal exemplo, começa pelo dataset <code>gapminder</code>, disponível através do pacote <code>gapminder</code>. Esse dataset contém dados de expectativa de vida (<code>lifeExp</code>), população (<code>pop</code>) e PIB per capita (<code>gdpPercap</code>) de diversos países do mundo (<code>country</code>), ao longo de vários anos (<code>year</code>).</p>
<p></p>
<div class="sourceCode" id="cb1691"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1691-1"><a href="#cb1691-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gapminder)</span></code></pre></div>
<p></p>
<p></p>
<div class="sourceCode" id="cb1692"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1692-1"><a href="#cb1692-1" aria-hidden="true" tabindex="-1"></a>gapminder</span></code></pre></div>
<pre><code>## # A tibble: 1,704 x 6
##    country     continent  year lifeExp      pop gdpPercap
##    &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;
##  1 Afghanistan Asia       1952    28.8  8425333      779.
##  2 Afghanistan Asia       1957    30.3  9240934      821.
##  3 Afghanistan Asia       1962    32.0 10267083      853.
##  4 Afghanistan Asia       1967    34.0 11537966      836.
##  5 Afghanistan Asia       1972    36.1 13079460      740.
##  6 Afghanistan Asia       1977    38.4 14880372      786.
##  7 Afghanistan Asia       1982    39.9 12881816      978.
##  8 Afghanistan Asia       1987    40.8 13867957      852.
##  9 Afghanistan Asia       1992    41.7 16317921      649.
## 10 Afghanistan Asia       1997    41.8 22227415      635.
## # ... with 1,694 more rows</code></pre>
<p></p>
<p>Repare abaixo, que esse dataset contém dados de 142 países diferentes, ao longo de 5 continentes do mundo. Dentre esses vários países, temos uma expectativa de vida estimada que varia de 23,59 até 82,60 anos, e um PIB per capita de 241 até 113.523 dólares.</p>
<p></p>
<div class="sourceCode" id="cb1694"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1694-1"><a href="#cb1694-1" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">n_distinct</span>(gapminder<span class="sc">$</span>country)</span></code></pre></div>
<pre><code>## [1] 142</code></pre>
<div class="sourceCode" id="cb1696"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1696-1"><a href="#cb1696-1" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">n_distinct</span>(gapminder<span class="sc">$</span>continent)</span></code></pre></div>
<pre><code>## [1] 5</code></pre>
<div class="sourceCode" id="cb1698"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1698-1"><a href="#cb1698-1" aria-hidden="true" tabindex="-1"></a><span class="fu">range</span>(gapminder<span class="sc">$</span>lifeExp)</span></code></pre></div>
<pre><code>## [1] 23.599 82.603</code></pre>
<div class="sourceCode" id="cb1700"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1700-1"><a href="#cb1700-1" aria-hidden="true" tabindex="-1"></a><span class="fu">range</span>(gapminder<span class="sc">$</span>gdpPercap)</span></code></pre></div>
<pre><code>## [1]    241.1659 113523.1329</code></pre>
<p></p>
<p>Com esses dados em mãos, podemos utilizar um modelo econométrico para tentar explicar a expectativa de vida da população de cada país com base no seu PIB per capita. Essa é uma hipótese clássica da literatura econômica, que se baseia na ideia de que um povo vive melhor e por mais tempo, quando ele possui uma maior capacidade de adquirir bens e serviços. Tal modelo econométrico está apresentado abaixo, onde <span class="math inline">\(lifeExp_j\)</span> representa a expectativa de vida estimada para o país <span class="math inline">\(j\)</span>, e <span class="math inline">\(gdpPercap_j\)</span>, o PIB per capita observado para o mesmo país <span class="math inline">\(j\)</span>.</p>
<p><span class="math display">\[lifeExp_j= \beta_{0} + \beta_{1} \times gdpPercap_j\]</span></p>
<p>Caso você nunca tenha visto ou estudado sobre econometria (também conhecida como “análise de regressão linear”), não se preocupe em entender exatamente como o modelo é calculado, ou o que a equação acima representa. Se preocupe apenas em entender os seguintes pontos: 1) a função <code>lm()</code> é uma função presente nos pacotes básicos do R, que é capaz de calcular esse tipo de modelo; 2) precisamos aplicar essa função <code>lm()</code> sobre os dados de cada país, para obtermos os resultados do modelo separados para cada país.</p>
<p>Como um primeiro exemplo, para aplicarmos esse modelo econométrico sobre os dados de um país em específico, como o Brasil, poderíamos fazer o seguinte:</p>
<p></p>
<div class="sourceCode" id="cb1702"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1702-1"><a href="#cb1702-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1702-2"><a href="#cb1702-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1702-3"><a href="#cb1702-3" aria-hidden="true" tabindex="-1"></a>br <span class="ot">&lt;-</span> gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb1702-4"><a href="#cb1702-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(country <span class="sc">==</span> <span class="st">&quot;Brazil&quot;</span>)</span>
<span id="cb1702-5"><a href="#cb1702-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1702-6"><a href="#cb1702-6" aria-hidden="true" tabindex="-1"></a>modelo <span class="ot">&lt;-</span> <span class="fu">lm</span>(lifeExp <span class="sc">~</span> gdpPercap, <span class="at">data =</span> br)</span>
<span id="cb1702-7"><a href="#cb1702-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(modelo)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = lifeExp ~ gdpPercap, data = br)
## 
## Residuals:
##    Min     1Q Median     3Q    Max 
## -3.066 -1.278  0.367  1.335  2.350 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 4.599e+01  1.510e+00   30.46 3.41e-11 ***
## gdpPercap   2.787e-03  2.405e-04   11.59 4.04e-07 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 1.943 on 10 degrees of freedom
## Multiple R-squared:  0.9307, Adjusted R-squared:  0.9238 
## F-statistic: 134.4 on 1 and 10 DF,  p-value: 4.045e-07</code></pre>
<p></p>
<p>Portanto, no exemplo acima, o objeto <code>modelo</code> contém os resultados do modelo para o Brasil. Pois aplicamos a função <code>lm()</code> especificamente sobre os dados do Brasil. Todavia, caso aplicássemos a função <code>lm()</code> diretamente sobre a tabela <code>gapminder</code> inteira, teríamos na verdade, os resultados do modelo para todo o mundo (sem distinção de países). Pois estamos utilizando os dados de todos os países ao mesmo tempo para calcular o modelo.</p>
<p></p>
<div class="sourceCode" id="cb1704"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1704-1"><a href="#cb1704-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Abaixo temos os resultados do modelo para</span></span>
<span id="cb1704-2"><a href="#cb1704-2" aria-hidden="true" tabindex="-1"></a><span class="do">### todo o mundo. Pois aplicamos a função lm() sobre</span></span>
<span id="cb1704-3"><a href="#cb1704-3" aria-hidden="true" tabindex="-1"></a><span class="do">### os dados de todos os países de uma vez só.</span></span>
<span id="cb1704-4"><a href="#cb1704-4" aria-hidden="true" tabindex="-1"></a>modelo <span class="ot">&lt;-</span> <span class="fu">lm</span>(lifeExp <span class="sc">~</span> gdpPercap, <span class="at">data =</span> gapminder)</span>
<span id="cb1704-5"><a href="#cb1704-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(modelo)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = lifeExp ~ gdpPercap, data = gapminder)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -82.754  -7.758   2.176   8.225  18.426 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 5.396e+01  3.150e-01  171.29   &lt;2e-16 ***
## gdpPercap   7.649e-04  2.579e-05   29.66   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 10.49 on 1702 degrees of freedom
## Multiple R-squared:  0.3407, Adjusted R-squared:  0.3403 
## F-statistic: 879.6 on 1 and 1702 DF,  p-value: &lt; 2.2e-16</code></pre>
<p></p>
<p>Agora, como poderíamos calcular os resultados desse modelo separados para cada um dos 142 países descritos em <code>gapminder</code>? Com a ajuda das funções <code>map</code>, replicar esse modelo para os 142 países, se torna uma tarefa extremamente simples de ser feita.</p>
<p>Pelo fato da função <code>map()</code> aplicar uma determinada função sobre cada elemento de um objeto, podemos utilizar <code>map()</code> para aplicarmos <code>lm()</code> sobre os dados de cada país. Sendo assim, cada elemento do objeto utilizado por <code>map()</code>, deve conter os dados de um país específico. Logo, cada elemento deste objeto seria muito provavelmente um <code>data.frame</code> contendo os dados de um país.</p>
<p>Dito de outra forma, vamos aplicar a função <code>map()</code> sobre uma lista de <code>data.frame</code>’s. Por esse motivo, a função que <code>map()</code> vai aplicar sobre cada elemento dessa lista, deve aceitar como <em>input</em>, um <code>data.frame</code> contendo os dados de um país específico, e gerar como <em>output</em>, os resultados do modelo aplicado sobre esses dados de <em>input</em>. Como primeiro passo, vamos criar essa função.</p>
<div id="a-função-que-calcula-o-modelo-econométrico" class="section level3" number="16.3.1">
<h3 number="16.3.1"><span class="header-section-number">16.3.1</span> A função que calcula o modelo econométrico</h3>
<p>Portanto, precisamos criar uma função que aceita um <code>data.frame</code> como <em>input</em>, e que calcula o modelo econométrico sobre os dados desse <em>input</em>. A função <code>aplicar_modelo()</code> abaixo, cumpre justamente esse papel. Tudo que essa função faz é aplicar a função <code>lm()</code> sobre o <code>data.frame</code> de <em>input</em> (argumento <code>x</code>). Perceba também que, independente de qual for o <code>data.frame</code> que fornecermos a essa função, ela vai sempre calcular o mesmo modelo, pois a equação na função <code>lm()</code> sempre será <code>lifeExp ~ gdpPercap</code>.</p>
<p></p>
<div class="sourceCode" id="cb1706"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1706-1"><a href="#cb1706-1" aria-hidden="true" tabindex="-1"></a>aplicar_modelo <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb1706-2"><a href="#cb1706-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lm</span>(lifeExp <span class="sc">~</span> gdpPercap, <span class="at">data =</span> x)</span>
<span id="cb1706-3"><a href="#cb1706-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p></p>
</div>
<div id="criando-uma-lista-de-data.frames" class="section level3" number="16.3.2">
<h3 number="16.3.2"><span class="header-section-number">16.3.2</span> Criando uma lista de <code>data.frame</code>’s</h3>
<p>Podemos criar a lista de <code>data.frame</code>’s, contendo os dados de cada país, de diversas formas. Em sua palestra, Hadley Wickham utilizou a função <code>nest()</code>, proveniente do pacote <code>tidyr</code>, para criar essa lista de <code>data.frame</code>’s dentro de uma coluna do <code>data.frame</code> original. Ou seja, Wickham utilizou <code>nest()</code> para criar uma espécie de <code>data.frame</code> de <code>data.frame</code>’s, pois ele queria demonstrar esta poderosa ideia de um <em>nested</em> <code>data.frame</code>. Porém, como uma solução ainda mais simples, também poderíamos utilizar a função <code>split()</code> para dividirmos a tabela <code>gapminder</code> em uma lista, onde cada elemento dessa lista conteria um <code>data.frame</code> com os dados de um país diferente. Ambas as soluções são perfeitamente válidas.</p>
</div>
<div id="com-a-função-split" class="section level3" number="16.3.3">
<h3 number="16.3.3"><span class="header-section-number">16.3.3</span> Com a função <code>split()</code></h3>
<p>Precisamos separar em diferentes elementos, os dados de cada país descrito na tabela <code>gapminder</code>. Para isso, podemos utilizar a função <code>split()</code>. Em resumo, essa função aceita um vetor ou <code>data.frame</code> como <em>input</em>, e divide esse objeto de <em>input</em> em diferentes elementos de uma lista, com base em algum vetor de grupos.</p>
<p>Logo, podemos pedir à <code>split()</code> que divida a tabela <code>gapminder</code> de acordo com os valores da coluna <code>country</code>. Veja o resultado abaixo:</p>
<p></p>
<div class="sourceCode" id="cb1707"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1707-1"><a href="#cb1707-1" aria-hidden="true" tabindex="-1"></a>dados_por_pais <span class="ot">&lt;-</span> gapminder <span class="sc">%&gt;%</span> <span class="fu">split</span>(<span class="sc">~</span>country)</span>
<span id="cb1707-2"><a href="#cb1707-2" aria-hidden="true" tabindex="-1"></a>dados_por_pais[[<span class="dv">1</span>]]</span></code></pre></div>
<pre><code>## # A tibble: 12 x 6
##    country     continent  year lifeExp      pop gdpPercap
##    &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;
##  1 Afghanistan Asia       1952    28.8  8425333      779.
##  2 Afghanistan Asia       1957    30.3  9240934      821.
##  3 Afghanistan Asia       1962    32.0 10267083      853.
##  4 Afghanistan Asia       1967    34.0 11537966      836.
##  5 Afghanistan Asia       1972    36.1 13079460      740.
##  6 Afghanistan Asia       1977    38.4 14880372      786.
##  7 Afghanistan Asia       1982    39.9 12881816      978.
##  8 Afghanistan Asia       1987    40.8 13867957      852.
##  9 Afghanistan Asia       1992    41.7 16317921      649.
## 10 Afghanistan Asia       1997    41.8 22227415      635.
## 11 Afghanistan Asia       2002    42.1 25268405      727.
## 12 Afghanistan Asia       2007    43.8 31889923      975.</code></pre>
<p></p>
<p>Portanto, o objeto <code>dados_por_pais</code> é uma lista, onde cada elemento dessa lista, contém um <code>data.frame</code> com os dados de um país específico. Agora, podemos utilizar a função <code>map()</code> para simplesmente aplicarmos a função <code>aplicar_modelo()</code> sobre cada elemento dessa lista, ou, sobre os dados de cada país. Como resultado, teremos uma nova lista, onde cada elemento dessa lista, contém os resultados do modelo para um determinado país. No exemplo abaixo, estou mostrando os resultados do modelo para o Afeganistão. Curiosamente, o coeficiente estimado pelo modelo foi negativo (-0,00224), indicando assim, que para o Afeganistão, aumentos no PIB per capita reduzem a expectativa de vida estimada da população. Um resultado que contradiz a nossa hipótese inicial.</p>
<p></p>
<div class="sourceCode" id="cb1709"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1709-1"><a href="#cb1709-1" aria-hidden="true" tabindex="-1"></a>modelos <span class="ot">&lt;-</span> <span class="fu">map</span>(dados_por_pais, aplicar_modelo)</span>
<span id="cb1709-2"><a href="#cb1709-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(modelos[[<span class="dv">1</span>]])</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = lifeExp ~ gdpPercap, data = x)
## 
## Residuals:
##    Min     1Q Median     3Q    Max 
## -8.730 -3.880  1.845  3.866  6.734 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)   
## (Intercept) 39.27720   12.04623   3.261  0.00857 **
## gdpPercap   -0.00224    0.01488  -0.151  0.88334   
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 5.341 on 10 degrees of freedom
## Multiple R-squared:  0.002261,   Adjusted R-squared:  -0.09751 
## F-statistic: 0.02266 on 1 and 10 DF,  p-value: 0.8833</code></pre>
<p></p>
<p>Com a lista <code>modelos</code>, podemos continuar utilizando a função <code>map()</code> para extrair informações específicas desses modelos. Por exemplo, os comandos abaixo utilizam a função <code>glance()</code> do pacote <code>broom</code> para extrair o <span class="math inline">\(R^2\)</span> (coeficiente de determinação) estimado por cada modelo. No exemplo abaixo, estou mostrando os coeficientes dos 10 primeiros países.</p>
<p></p>
<div class="sourceCode" id="cb1711"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1711-1"><a href="#cb1711-1" aria-hidden="true" tabindex="-1"></a>r2s <span class="ot">&lt;-</span> modelos <span class="sc">%&gt;%</span></span>
<span id="cb1711-2"><a href="#cb1711-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(broom<span class="sc">::</span>glance) <span class="sc">%&gt;%</span></span>
<span id="cb1711-3"><a href="#cb1711-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map_dbl</span>(<span class="st">&quot;r.squared&quot;</span>)</span>
<span id="cb1711-4"><a href="#cb1711-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1711-5"><a href="#cb1711-5" aria-hidden="true" tabindex="-1"></a>r2s[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span></code></pre></div>
<pre><code>## Afghanistan     Albania     Algeria      Angola   Argentina   Australia 
## 0.002260718 0.700762689 0.818067786 0.090648834 0.691638237 0.973075112 
##     Austria     Bahrain  Bangladesh     Belgium 
## 0.985977854 0.806033051 0.717947961 0.985551840</code></pre>
<p></p>
</div>
<div id="com-a-função-nest" class="section level3" number="16.3.4">
<h3 number="16.3.4"><span class="header-section-number">16.3.4</span> Com a função <code>nest()</code></h3>
<p>Apesar da função <code>split()</code> já nos oferecer uma ótima solução, também podemos muito bem adotar a solução mostrada por Wickham, que utiliza a função <code>nest()</code> para criar um “<code>data.frame</code> de <code>data.frame</code>’s.”</p>
<p>No momento, cada linha da tabela <code>gapminder</code> descreve os dados de um país em um determinado ano. Entretanto, a nossa intenção com essa solução, é transformar a tabela <code>gapminder</code>, de modo que cada linha da tabela contenha todos os dados de um determinado país para todos os anos. Podemos realizar essa transformação, ao agruparmos à tabela pela coluna <code>country</code> (com a função <code>group_by()</code>) e, em seguida, aplicarmos a função <code>nest()</code> do pacote <code>tidyr</code>, como demonstrado abaixo:</p>
<p></p>
<div class="sourceCode" id="cb1713"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1713-1"><a href="#cb1713-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb1713-2"><a href="#cb1713-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span>
<span id="cb1713-3"><a href="#cb1713-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code></pre></div>
<p></p>
<p></p>
<div class="sourceCode" id="cb1714"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1714-1"><a href="#cb1714-1" aria-hidden="true" tabindex="-1"></a>dados_por_pais <span class="ot">&lt;-</span> gapminder <span class="sc">%&gt;%</span></span>
<span id="cb1714-2"><a href="#cb1714-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(country, continent) <span class="sc">%&gt;%</span> </span>
<span id="cb1714-3"><a href="#cb1714-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nest</span>()</span>
<span id="cb1714-4"><a href="#cb1714-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1714-5"><a href="#cb1714-5" aria-hidden="true" tabindex="-1"></a>dados_por_pais</span></code></pre></div>
<pre><code>## # A tibble: 142 x 3
## # Groups:   country, continent [142]
##    country     continent data             
##    &lt;fct&gt;       &lt;fct&gt;     &lt;list&gt;           
##  1 Afghanistan Asia      &lt;tibble [12 x 4]&gt;
##  2 Albania     Europe    &lt;tibble [12 x 4]&gt;
##  3 Algeria     Africa    &lt;tibble [12 x 4]&gt;
##  4 Angola      Africa    &lt;tibble [12 x 4]&gt;
##  5 Argentina   Americas  &lt;tibble [12 x 4]&gt;
##  6 Australia   Oceania   &lt;tibble [12 x 4]&gt;
##  7 Austria     Europe    &lt;tibble [12 x 4]&gt;
##  8 Bahrain     Asia      &lt;tibble [12 x 4]&gt;
##  9 Bangladesh  Asia      &lt;tibble [12 x 4]&gt;
## 10 Belgium     Europe    &lt;tibble [12 x 4]&gt;
## # ... with 132 more rows</code></pre>
<p></p>
<p>Dessa vez, o objeto <code>dados_por_pais</code> é um <code>data.frame</code> que contém três colunas (<code>country</code>, <code>continent</code> e <code>data</code>). A coluna <code>data</code> é uma lista, e cada elemento dessa lista contém um novo <code>data.frame</code>, que por sua vez, contém todos os dados referentes ao país identificado na coluna <code>country</code> da tabela.</p>
<p>Ou seja, ainda estamos utilizando uma lista de <code>data.frame</code>’s, onde cada <code>data.frame</code> dessa lista contém os dados de um país específico. A diferença agora, é que essa lista está inserida em uma coluna de um <code>data.frame</code>, ao invés de estar em um objeto separado.</p>
<p>Portanto, a figura 16.4 abaixo apresenta de forma gráfica a transformação executada por <code>nest()</code>. Repare também, que o pacote <code>tidyr</code> nos oferece a função <code>unnest()</code>, com a qual podemos reverter a transformação executada por <code>nest()</code>.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/nest.png" alt="Transformação executada por `nest()`" width="100%" />
<p class="caption">
(#fig:unnamed-chunk-904)Transformação executada por <code>nest()</code>
</p>
</div>
<p></p>
<p>Como exemplo, os dados do Brasil estão na 15° linha da tabela <code>dados_por_pais</code>. Logo, eu posso adquirir todos os dados do Brasil, ao acessar o 15° elemento da coluna <code>data</code>. Perceba abaixo, que um novo <code>data.frame</code> é retornado, que contém todos os dados referentes ao Brasil.</p>
<p></p>
<div class="sourceCode" id="cb1716"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1716-1"><a href="#cb1716-1" aria-hidden="true" tabindex="-1"></a>dados_por_pais<span class="sc">$</span>data[[<span class="dv">15</span>]]</span></code></pre></div>
<pre><code>## # A tibble: 12 x 4
##     year lifeExp       pop gdpPercap
##    &lt;int&gt;   &lt;dbl&gt;     &lt;int&gt;     &lt;dbl&gt;
##  1  1952    50.9  56602560     2109.
##  2  1957    53.3  65551171     2487.
##  3  1962    55.7  76039390     3337.
##  4  1967    57.6  88049823     3430.
##  5  1972    59.5 100840058     4986.
##  6  1977    61.5 114313951     6660.
##  7  1982    63.3 128962939     7031.
##  8  1987    65.2 142938076     7807.
##  9  1992    67.1 155975974     6950.
## 10  1997    69.4 168546719     7958.
## 11  2002    71.0 179914212     8131.
## 12  2007    72.4 190010647     9066.</code></pre>
<p></p>
<p>Agora, precisamos apenas aplicar a função <code>aplicar_modelo()</code> sobre cada elemento da coluna <code>data</code>. Para isso, podemos utilizar novamente a função <code>map()</code>, dessa vez, dentro da função <code>mutate()</code> que introduzimos no capítulo 4. Dessa maneira, <code>map()</code> vai executar a função <code>aplicar_modelo()</code> para cada elemento da coluna <code>data</code>, e retornar uma lista com os resultados, e a função <code>mutate()</code> vai adicionar essa lista como uma nova coluna do <code>data.frame</code>.</p>
<p></p>
<div class="sourceCode" id="cb1718"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1718-1"><a href="#cb1718-1" aria-hidden="true" tabindex="-1"></a>modelos <span class="ot">&lt;-</span> dados_por_pais <span class="sc">%&gt;%</span> </span>
<span id="cb1718-2"><a href="#cb1718-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb1718-3"><a href="#cb1718-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">resultados =</span> data <span class="sc">%&gt;%</span> <span class="fu">map</span>(aplicar_modelo)</span>
<span id="cb1718-4"><a href="#cb1718-4" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb1718-5"><a href="#cb1718-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1718-6"><a href="#cb1718-6" aria-hidden="true" tabindex="-1"></a>modelos</span></code></pre></div>
<pre><code>## # A tibble: 142 x 4
## # Groups:   country, continent [142]
##    country     continent data              resultados
##    &lt;fct&gt;       &lt;fct&gt;     &lt;list&gt;            &lt;list&gt;    
##  1 Afghanistan Asia      &lt;tibble [12 x 4]&gt; &lt;lm&gt;      
##  2 Albania     Europe    &lt;tibble [12 x 4]&gt; &lt;lm&gt;      
##  3 Algeria     Africa    &lt;tibble [12 x 4]&gt; &lt;lm&gt;      
##  4 Angola      Africa    &lt;tibble [12 x 4]&gt; &lt;lm&gt;      
##  5 Argentina   Americas  &lt;tibble [12 x 4]&gt; &lt;lm&gt;      
##  6 Australia   Oceania   &lt;tibble [12 x 4]&gt; &lt;lm&gt;      
##  7 Austria     Europe    &lt;tibble [12 x 4]&gt; &lt;lm&gt;      
##  8 Bahrain     Asia      &lt;tibble [12 x 4]&gt; &lt;lm&gt;      
##  9 Bangladesh  Asia      &lt;tibble [12 x 4]&gt; &lt;lm&gt;      
## 10 Belgium     Europe    &lt;tibble [12 x 4]&gt; &lt;lm&gt;      
## # ... with 132 more rows</code></pre>
<p></p>
<p>Agora, cada elemento da coluna <code>resultados</code> contém todos os resultados do modelo para cada país da tabela <code>gapminder</code>. A partir daqui, podemos utilizar novamente as funções <code>map</code> para extrairmos as informações específicas dos modelos. Por exemplo, podemos extrair o beta estimado (<span class="math inline">\(\beta_1\)</span>) e o coeficiente de determinação de cada país, e adicioná-los como novas colunas da tabela modelos.</p>
<p></p>
<div class="sourceCode" id="cb1720"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1720-1"><a href="#cb1720-1" aria-hidden="true" tabindex="-1"></a>modelos <span class="ot">&lt;-</span> modelos <span class="sc">%&gt;%</span> </span>
<span id="cb1720-2"><a href="#cb1720-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb1720-3"><a href="#cb1720-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">glance =</span> resultados <span class="sc">%&gt;%</span> <span class="fu">map</span>(broom<span class="sc">::</span>glance),</span>
<span id="cb1720-4"><a href="#cb1720-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">tidy =</span> resultados <span class="sc">%&gt;%</span> <span class="fu">map</span>(broom<span class="sc">::</span>tidy),</span>
<span id="cb1720-5"><a href="#cb1720-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">beta_estimado =</span> tidy <span class="sc">%&gt;%</span> <span class="fu">map_dbl</span>(<span class="sc">~</span>.[[<span class="st">&quot;estimate&quot;</span>]][<span class="dv">2</span>]),</span>
<span id="cb1720-6"><a href="#cb1720-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">r2 =</span> glance <span class="sc">%&gt;%</span> <span class="fu">map_dbl</span>(<span class="st">&quot;r.squared&quot;</span>)</span>
<span id="cb1720-7"><a href="#cb1720-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb1720-8"><a href="#cb1720-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>glance, <span class="sc">-</span>tidy)</span>
<span id="cb1720-9"><a href="#cb1720-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1720-10"><a href="#cb1720-10" aria-hidden="true" tabindex="-1"></a>modelos</span></code></pre></div>
<pre><code>## # A tibble: 142 x 6
## # Groups:   country, continent [142]
##    country     continent data              resultados beta_estimado      r2
##    &lt;fct&gt;       &lt;fct&gt;     &lt;list&gt;            &lt;list&gt;             &lt;dbl&gt;   &lt;dbl&gt;
##  1 Afghanistan Asia      &lt;tibble [12 x 4]&gt; &lt;lm&gt;           -0.00224  0.00226
##  2 Albania     Europe    &lt;tibble [12 x 4]&gt; &lt;lm&gt;            0.00444  0.701  
##  3 Algeria     Africa    &lt;tibble [12 x 4]&gt; &lt;lm&gt;            0.00714  0.818  
##  4 Angola      Africa    &lt;tibble [12 x 4]&gt; &lt;lm&gt;           -0.00103  0.0906 
##  5 Argentina   Americas  &lt;tibble [12 x 4]&gt; &lt;lm&gt;            0.00187  0.692  
##  6 Australia   Oceania   &lt;tibble [12 x 4]&gt; &lt;lm&gt;            0.000524 0.973  
##  7 Austria     Europe    &lt;tibble [12 x 4]&gt; &lt;lm&gt;            0.000450 0.986  
##  8 Bahrain     Asia      &lt;tibble [12 x 4]&gt; &lt;lm&gt;            0.00142  0.806  
##  9 Bangladesh  Asia      &lt;tibble [12 x 4]&gt; &lt;lm&gt;            0.0325   0.718  
## 10 Belgium     Europe    &lt;tibble [12 x 4]&gt; &lt;lm&gt;            0.000447 0.986  
## # ... with 132 more rows</code></pre>
<p></p>
<p>Com esses resultados em mãos, podemos criar visualizações muito interessantes. Como o gráfico de dispersão abaixo, que apresenta a relação entre o beta estimado e o coeficiente de determinação do modelo. Repare nesse gráfico, que os países da Europa, em geral, possuem um beta estimado baixo, indicando assim, que aumentos no PIB per capita tem baixos impactos na expectativa de vida. Isso provavelmente ocorre, porque esses países já possuem expectativas de vida relativamente altas.</p>
<p>Por outro lado, perceba também que os países africanos parecem se concentrar nos dois extremos do gráfico, com os maiores e menores betas estimados. Os maiores betas, indicam que aumentos no PIB per capita trazem fortes impactos positivos sobre as expectativas de vida nesses países. Isso provavelmente se deve à vida precária e a baixa expectativa de vida que a população desses países enfrenta, de modo que, uma melhoria mínima pode trazer grandes impactos positivos nas condições de vida dessas populações.</p>
<p>Para mais, repare que os países africanos que possuem betas estimados negativos também possuem coeficientes de determinação baixos, indicando assim, um baixo poder explicativo do modelo. Isso é um sinal de que o nosso modelo não consegue explicar muito dos dados desses países, e provavelmente, esse baixo poder explicativo gerou um beta estimado negativo, que é algo inesperado para essa relação entre expectativa de vida e renda per capita.</p>
<p>Talvez, esses países tem características importantes que os outros países não possuem, e que afetam essa relação econômica. Por exemplo, muitos países africanos enfrentam guerras civis recorrentes. Guerras desse tipo geram impactos negativos na expectativa de vida, e as mortes podem gerar quedas na população total do país, o que resultaria em um aumento do PIB per capita (<em>ceteris paribus</em>).</p>
<p></p>
<div class="sourceCode" id="cb1722"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1722-1"><a href="#cb1722-1" aria-hidden="true" tabindex="-1"></a>modelos <span class="sc">%&gt;%</span> </span>
<span id="cb1722-2"><a href="#cb1722-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb1722-3"><a href="#cb1722-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb1722-4"><a href="#cb1722-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> r2, <span class="at">y =</span> beta_estimado, <span class="at">color =</span> continent)</span>
<span id="cb1722-5"><a href="#cb1722-5" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="Introducao_R_files/figure-html/unnamed-chunk-908-1.png" width="60%" style="display: block; margin: auto;" /></p>
<p></p>
</div>
</div>
<div id="comparando-a-família-map-à-família-apply" class="section level2" number="16.4">
<h2 number="16.4"><span class="header-section-number">16.4</span> Comparando a família <code>map</code> à família <code>apply</code></h2>
<p>Os pacotes básicos do R, nos oferecem a família <code>apply</code> de funções, a qual desenvolve um papel muito similar às funções <code>map</code>. Os membros dessa família estão listados abaixo:</p>
<ul>
<li><code>apply</code> (<em>generic apply</em>): retorna diferentes tipos de estrutura a depender de um conjunto de condições.</li>
<li><code>lapply</code> (<em>list apply</em>): retorna uma lista.</li>
<li><code>sapply</code> (<em>simple apply</em>): tenta simplificar o resultado para uma estrutura mais “simples,” a depender do comprimento de cada resultado gerado por <code>FUN</code>.</li>
<li><code>vapply</code> (<em>vector apply</em>): retorna um vetor de mesmo tipo de dado que o vetor definido no argumento <code>FUN.VALUE</code>.</li>
</ul>
<p>Tendo isso em mente, todas essas funções aceitam um objeto (<code>X</code>) e uma função (<code>FUN</code>) em seus dois primeiros argumentos. Essas funções <code>apply</code> vão aplicar a função <code>FUN</code> sobre cada elemento do objeto <code>X</code> fornecido, e retornar como resultado, um novo objeto contendo todos os resultados gerados pela função <code>FUN</code> aplicada sobre cada elemento do objeto <code>X</code>.</p>
<p>Um dos principais motivos pelos quais a família <code>apply</code> tem perdido espaço para a família <code>map</code>, é pelo fato dessas funções serem menos consistentes, especialmente quanto à estrutura do resultado retornado. Por exemplo, <code>apply()</code> pode retornar um vetor, um <code>array</code> ou uma lista como resultado. Para mais, as condições que determinam qual dessas estruturas é retornada por <code>apply()</code> são levemente confusas. Se estiver curioso, leia a seção <code>Value</code> da documentação interna (<code>?apply</code>).</p>
<p>A função <code>sapply()</code> também é um outro caso de incosistência, pois essa função altera a estrutura de dados retornada, a depender do comprimento de cada um dos resultados gerados pela função <code>FUN</code>. Isso significa que, a estrutura de dados retornada por <code>sapply()</code> é determinada por um conjunto de resultados aos quais nós não temos acesso enquanto a função não completar a sua execução. Ou seja, nós não somos capazes de prever com antecedência, qual será a estrutura retornada por <code>sapply()</code>. Isso é um problema grave, dado que ele pode gerar bugs em seu script com muita facilidade, caso você não esteja preparado para lidar com literalmente qualquer tipo de resultado possível de <code>sapply()</code>.</p>
<p>São inconsistências desse tipo, que tornaram as funções <code>map</code> o padrão utilizado pela comunidade na construção de muitos pacotes e funções. Pois as funções <code>map</code> são extremamente consistentes em seus resultados. Por esse mesmo motivo, que as funções <code>lapply()</code> e <code>vapply()</code> são exemplos de funções <code>apply</code> que ainda são muito utilizadas em diversos pacotes e funções existentes na atualidade.</p>
<p>Pois diferente de <code>apply()</code> e <code>sapply()</code>, essas funções são consistentes em seus resultados. A função <code>lapply()</code> é equivalente à função <code>map()</code>, pois ela sempre lhe retorna uma lista como resultado. Já a função <code>vapply()</code> vai sempre retornar um vetor de mesmo tipo de dado que o vetor fornecido ao seu argumento <code>FUN.VALUE</code>. Ou seja, poderíamos reproduzir a função <code>map_dbl()</code> com <code>vapply()</code>, ao fornecermos um vetor do tipo <code>double</code> ao seu argumento <code>FUN.VALUE</code>.</p>
<p></p>
<div class="sourceCode" id="cb1723"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1723-1"><a href="#cb1723-1" aria-hidden="true" tabindex="-1"></a>numeros <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb1723-2"><a href="#cb1723-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="fl">1.5</span>, <span class="fl">2.5</span>, <span class="dv">3</span>),</span>
<span id="cb1723-3"><a href="#cb1723-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="fl">9.8</span>, <span class="fl">1.2</span>),</span>
<span id="cb1723-4"><a href="#cb1723-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="fl">1.2</span>, <span class="fl">1.3</span>, <span class="fl">1.5</span>, <span class="fl">1.1</span>)</span>
<span id="cb1723-5"><a href="#cb1723-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1723-6"><a href="#cb1723-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1723-7"><a href="#cb1723-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1723-8"><a href="#cb1723-8" aria-hidden="true" tabindex="-1"></a>somas <span class="ot">&lt;-</span> <span class="fu">vapply</span>(numeros, <span class="at">FUN =</span> sum, <span class="at">FUN.VALUE =</span> <span class="fu">double</span>(<span class="dv">1</span>))</span>
<span id="cb1723-9"><a href="#cb1723-9" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(somas)</span></code></pre></div>
<pre><code>## [1]  7.0 11.0  5.1</code></pre>
<p></p>
<p>Na verdade, a função <code>vapply()</code> também é capaz de retornar matrizes e arrays. Tudo depende de como você organiza o objeto fornecido ao argumento <code>FUN.VALUE</code>. Isso é um diferencial importante, que nenhuma das funções <code>map</code> são capazes de fazer até o momento.</p>
<p></p>
<div class="sourceCode" id="cb1725"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1725-1"><a href="#cb1725-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Retorna uma matriz</span></span>
<span id="cb1725-2"><a href="#cb1725-2" aria-hidden="true" tabindex="-1"></a><span class="fu">vapply</span>(numeros, <span class="at">FUN =</span> range, <span class="at">FUN.VALUE =</span> <span class="fu">double</span>(<span class="dv">2</span>))</span></code></pre></div>
<pre><code>##      [,1] [,2] [,3]
## [1,]  1.5  1.2  1.1
## [2,]  3.0  9.8  1.5</code></pre>
<div class="sourceCode" id="cb1727"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1727-1"><a href="#cb1727-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Retorna um array</span></span>
<span id="cb1727-2"><a href="#cb1727-2" aria-hidden="true" tabindex="-1"></a><span class="fu">vapply</span>(numeros, <span class="at">FUN =</span> range, <span class="at">FUN.VALUE =</span> <span class="fu">array</span>(<span class="fu">double</span>(<span class="dv">1</span>), <span class="at">dim =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">1</span>)))</span></code></pre></div>
<pre><code>## , , 1, 1
## 
##      [,1] [,2]
## [1,]  1.5    3
## 
## , , 1, 2
## 
##      [,1] [,2]
## [1,]  1.2  9.8
## 
## , , 1, 3
## 
##      [,1] [,2]
## [1,]  1.1  1.5</code></pre>
<p></p>
</div>
<div id="identificando-erros-nas-funções-map" class="section level2" number="16.5">
<h2 number="16.5"><span class="header-section-number">16.5</span> Identificando erros nas funções <code>map</code></h2>
<p>A cada iteração do loop criado por <code>map</code>, estamos executando a função definida no argumento <code>.f</code>. Isso significa que, em um loop de 10 mil iterações, essa função será chamada 10 mil vezes. Isso é um detalhe importante, pois um erro pode surgir em cada uma dessas 10 mil chamadas. E caso esse erro ocorra, como você faria para identificar a sua fonte? É esse tema que vamos abordar nessa seção.</p>
<p>Vamos utilizar os comandos abaixo como exemplo. Perceba que um erro foi levantado.</p>
<p></p>
<div class="sourceCode" id="cb1729"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1729-1"><a href="#cb1729-1" aria-hidden="true" tabindex="-1"></a>valores <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb1729-2"><a href="#cb1729-2" aria-hidden="true" tabindex="-1"></a>  <span class="fl">2.5</span>, <span class="fl">5.1</span>, <span class="fl">6.7</span>, <span class="fl">8.9</span>, <span class="st">&quot;9.1&quot;</span>, <span class="fl">0.2</span>,</span>
<span id="cb1729-3"><a href="#cb1729-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;4.4&quot;</span>, <span class="st">&quot;5.1&quot;</span>, <span class="st">&quot;7.4&quot;</span>, <span class="fl">3.6</span>, <span class="fl">3.8</span>,</span>
<span id="cb1729-4"><a href="#cb1729-4" aria-hidden="true" tabindex="-1"></a>  <span class="fl">4.2</span>, <span class="fl">8.7</span>, <span class="fl">8.8</span></span>
<span id="cb1729-5"><a href="#cb1729-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1729-6"><a href="#cb1729-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1729-7"><a href="#cb1729-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1729-8"><a href="#cb1729-8" aria-hidden="true" tabindex="-1"></a>logaritmos <span class="ot">&lt;-</span> valores <span class="sc">%&gt;%</span> <span class="fu">map_dbl</span>(log)</span></code></pre></div>
<p></p>
<pre><code>Error in .Primitive(&quot;log&quot;)(x, base) :
  non-numeric argument to mathematical function</code></pre>
<p>A principal dificuldade que temos é identificar <strong>onde</strong> o erro ocorreu. Isto é, em qual das iterações esse erro ocorreu? Será que ele ocorre logo na primeira iteração do loop? Ou, talvez na última iteração? Ou ainda, ao longo de várias iterações diferentes do loop?</p>
<p>Para identificar tais pontos, poderíamos ter acesso aos resultados que foram gerados com sucesso, e aos resultados que fracassaram. Para isso, o pacote <code>purrr</code> nos provê a função <code>safely()</code>.</p>
<p>Você deve aplicar essa função <code>safely()</code> sobre a função <code>.f</code> que você deseja utilizar dentro de <code>map()</code>. Como resultado, <code>safely()</code> gera uma nova versão da função <code>.f</code>, que é capaz de coletar os todos os resultados gerados, mesmo que eles levantem algum erro durante sua execução.</p>
<p></p>
<div class="sourceCode" id="cb1731"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1731-1"><a href="#cb1731-1" aria-hidden="true" tabindex="-1"></a>safe_log <span class="ot">&lt;-</span> <span class="fu">safely</span>(log)</span>
<span id="cb1731-2"><a href="#cb1731-2" aria-hidden="true" tabindex="-1"></a>safe_log</span></code></pre></div>
<pre><code>## function (...) 
## capture_error(.f(...), otherwise, quiet)
## &lt;bytecode: 0x000001a218ca1968&gt;
## &lt;environment: 0x000001a218ca2068&gt;</code></pre>
<p></p>
<p>O que essa nova versão da função faz, é sempre gerar uma lista com dois elementos (<code>result</code> e <code>error</code>) para cada <em>input</em>. O elemento <code>result</code> vai estar preenchido com o resultado da função caso ele tenha sido gerado com sucesso, enquanto o elemento <code>error</code>, estará vazio. Entretanto, caso algum erro ocorra e o resultado da função não possa ser gerado, o contrário ocorre. Ou seja, o elemento <code>result</code> estará vazio, enquanto o elemento <code>error</code> irá conter o erro que interrompeu a execução.</p>
<p>No primeiro exemplo abaixo, o elemento <code>result</code> gerado por <code>safe_log()</code> contém o valor <code>2.302585</code>, que corresponde ao resultado de <code>log(10)</code>. Isso significa que o valor da expressão <code>log(10)</code> pôde ser calculado com sucesso, sem nenhum erro encontrado. Porém, no segundo exemplo abaixo, o elemento <code>result</code> está vazio, enquanto o elemento <code>error</code> contém a mensagem de erro gerada. Logo, o resultado da expressão <code>log("a")</code> não pôde ser calculada com sucesso, pois o erro contido no elemento <code>error</code> foi levantado durante a execução.</p>
<p></p>
<div class="sourceCode" id="cb1733"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1733-1"><a href="#cb1733-1" aria-hidden="true" tabindex="-1"></a><span class="fu">safe_log</span>(<span class="dv">10</span>) <span class="sc">%&gt;%</span> <span class="fu">str</span>()</span></code></pre></div>
<pre><code>## List of 2
##  $ result: num 2.3
##  $ error : NULL</code></pre>
<div class="sourceCode" id="cb1735"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1735-1"><a href="#cb1735-1" aria-hidden="true" tabindex="-1"></a><span class="fu">safe_log</span>(<span class="st">&quot;a&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">str</span>()</span></code></pre></div>
<pre><code>## List of 2
##  $ result: NULL
##  $ error :List of 2
##   ..$ message: chr &quot;non-numeric argument to mathematical function&quot;
##   ..$ call   : language .Primitive(&quot;log&quot;)(x, base)
##   ..- attr(*, &quot;class&quot;)= chr [1:3] &quot;simpleError&quot; &quot;error&quot; &quot;condition&quot;</code></pre>
<p></p>
<p>Agora, podemos simplesmente fornecer para <code>map()</code> a nova função criada. Repare que dessa vez, eu estou utilizando a função <code>map()</code> ao invés da função <code>map_dbl()</code> para coletar os resultados gerados por <code>safe_log()</code>. Pois a função <code>log()</code> gera um único valor do tipo <code>double</code> para cada <em>input</em>, já a função <code>safe_log()</code>, gera uma lista com dois elementos (<code>result</code> e <code>error</code>) para cada <em>input</em>. Como exemplo, mostro abaixo os resultados para os 3 primeiros elementos. Perceba que nenhum desses elementos levantou algum erro, dado que o elemento <code>error</code> está vazio para todos eles.</p>
<p></p>
<div class="sourceCode" id="cb1737"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1737-1"><a href="#cb1737-1" aria-hidden="true" tabindex="-1"></a>logaritmos <span class="ot">&lt;-</span> valores <span class="sc">%&gt;%</span> <span class="fu">map</span>(safe_log)</span>
<span id="cb1737-2"><a href="#cb1737-2" aria-hidden="true" tabindex="-1"></a>logaritmos[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>] <span class="sc">%&gt;%</span> </span>
<span id="cb1737-3"><a href="#cb1737-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str</span>()</span></code></pre></div>
<pre><code>## List of 3
##  $ :List of 2
##   ..$ result: num 0.916
##   ..$ error : NULL
##  $ :List of 2
##   ..$ result: num 1.63
##   ..$ error : NULL
##  $ :List of 2
##   ..$ result: num 1.9
##   ..$ error : NULL</code></pre>
<p></p>
<p>Sendo assim, para identificarmos quais elementos de <code>valores</code> são os responsáveis por levantar o erro que vimos anteriormente, podemos navegar por cada elemento de <code>logaritmos</code>, e descobrir em quais deles, o elemento <code>error</code> não está vazio.</p>
<p></p>
<div class="sourceCode" id="cb1739"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1739-1"><a href="#cb1739-1" aria-hidden="true" tabindex="-1"></a>erros <span class="ot">&lt;-</span> logaritmos <span class="sc">%&gt;%</span> <span class="fu">map</span>(<span class="st">&quot;error&quot;</span>)</span>
<span id="cb1739-2"><a href="#cb1739-2" aria-hidden="true" tabindex="-1"></a>erro_nao_vazio <span class="ot">&lt;-</span> erros <span class="sc">%&gt;%</span> <span class="fu">map_lgl</span>(<span class="sc">~!</span><span class="fu">is.null</span>(.))</span>
<span id="cb1739-3"><a href="#cb1739-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1739-4"><a href="#cb1739-4" aria-hidden="true" tabindex="-1"></a>valores[erro_nao_vazio] <span class="sc">%&gt;%</span> </span>
<span id="cb1739-5"><a href="#cb1739-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str</span>()</span></code></pre></div>
<pre><code>## List of 4
##  $ : chr &quot;9.1&quot;
##  $ : chr &quot;4.4&quot;
##  $ : chr &quot;5.1&quot;
##  $ : chr &quot;7.4&quot;</code></pre>
<p></p>
<p>Repare acima, que antes de aplicar o teste lógico para saber quais erros estavam vazios, eu precisei extrair primeiro o elemento <code>error</code> de todos os elementos de <code>logaritmos</code>. Como uma alternativa, podemos reorganizar os elementos de <code>logaritmos</code> em duas listas diferentes, uma contendo todos os resultados gerados (<code>result</code>), e outra, contendo todos os erros gerados (<code>error</code>).</p>
<p>Para isso, basta aplicarmos a função <code>transpose()</code> sobre o objeto <code>logaritmos</code>. Agora, o objeto <code>logaritmos</code> contém dentro dele, uma lista de resultados (<code>result</code>) e uma lista de erros (<code>error</code>).</p>
<p></p>
<div class="sourceCode" id="cb1741"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1741-1"><a href="#cb1741-1" aria-hidden="true" tabindex="-1"></a>logaritmos <span class="ot">&lt;-</span> <span class="fu">transpose</span>(logaritmos)</span>
<span id="cb1741-2"><a href="#cb1741-2" aria-hidden="true" tabindex="-1"></a>logaritmos<span class="sc">$</span>result[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>]</span></code></pre></div>
<pre><code>## [[1]]
## [1] 0.9162907
## 
## [[2]]
## [1] 1.629241
## 
## [[3]]
## [1] 1.902108</code></pre>
<div class="sourceCode" id="cb1743"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1743-1"><a href="#cb1743-1" aria-hidden="true" tabindex="-1"></a>logaritmos<span class="sc">$</span>error[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>]</span></code></pre></div>
<pre><code>## [[1]]
## NULL
## 
## [[2]]
## NULL
## 
## [[3]]
## NULL</code></pre>
<p></p>
<p>Com essa estrutura, podemos reproduzir o teste anterior com:</p>
<p></p>
<div class="sourceCode" id="cb1745"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1745-1"><a href="#cb1745-1" aria-hidden="true" tabindex="-1"></a>erro_nao_vazio <span class="ot">&lt;-</span> <span class="fu">map_lgl</span>(logaritmos<span class="sc">$</span>error, <span class="sc">~!</span><span class="fu">is.null</span>(.))</span>
<span id="cb1745-2"><a href="#cb1745-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1745-3"><a href="#cb1745-3" aria-hidden="true" tabindex="-1"></a>valores[erro_nao_vazio] <span class="sc">%&gt;%</span> </span>
<span id="cb1745-4"><a href="#cb1745-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str</span>()</span></code></pre></div>
<pre><code>## List of 4
##  $ : chr &quot;9.1&quot;
##  $ : chr &quot;4.4&quot;
##  $ : chr &quot;5.1&quot;
##  $ : chr &quot;7.4&quot;</code></pre>
<p></p>
<p>Portanto, sabemos agora que os elementos <code>"9.1"</code>, <code>"4.4"</code>, <code>"5.1"</code> e <code>"7.4"</code> do objeto <code>valores</code> estão levantando erros quando aplicamos a função <code>log()</code> sobre eles. Com isso, podemos reproduzir o erro ao aplicar a função <code>log()</code> sobre um desses elementos. Dessa forma, podemos analisar caso a caso de forma mais concentrada, e entender o que está gerando o erro.</p>
<p></p>
<div class="sourceCode" id="cb1747"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1747-1"><a href="#cb1747-1" aria-hidden="true" tabindex="-1"></a><span class="fu">log</span>(<span class="st">&quot;9.1&quot;</span>)</span></code></pre></div>
<p></p>
<pre><code>Error in log(&quot;9.1&quot;) : non-numeric argument to mathematical function</code></pre>
<p>De qualquer forma, você provavelmente já entendeu qual é o problema. Esses elementos estão sendo interpretados pelo tipo <code>character</code>, ao invés de um tipo numérico como o tipo <code>double</code>. Em outras palavras, a função <code>log()</code> não sabe como calcular o logaritmo de um valor textual (ou uma <em>string</em>), como <code>"9.1"</code>.</p>
<p>Tendo isso em mente, poderíamos aplicar a função <code>as.double()</code> sobre esses elementos para resolvermos esse problema. Perceba que após realizarmos essa correção, o comando com <code>map_dbl()</code> executa normalmente sem nenhum erro.</p>
<p></p>
<div class="sourceCode" id="cb1749"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1749-1"><a href="#cb1749-1" aria-hidden="true" tabindex="-1"></a>valores[erro_nao_vazio] <span class="ot">&lt;-</span> valores[erro_nao_vazio] <span class="sc">%&gt;%</span> </span>
<span id="cb1749-2"><a href="#cb1749-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(as.double)</span>
<span id="cb1749-3"><a href="#cb1749-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1749-4"><a href="#cb1749-4" aria-hidden="true" tabindex="-1"></a><span class="do">### Agora, os comandos abaixo funcionam normalmente</span></span>
<span id="cb1749-5"><a href="#cb1749-5" aria-hidden="true" tabindex="-1"></a><span class="do">### sem nenhum erro.</span></span>
<span id="cb1749-6"><a href="#cb1749-6" aria-hidden="true" tabindex="-1"></a>logaritmos <span class="ot">&lt;-</span> valores <span class="sc">%&gt;%</span> <span class="fu">map_dbl</span>(log)</span>
<span id="cb1749-7"><a href="#cb1749-7" aria-hidden="true" tabindex="-1"></a>logaritmos </span></code></pre></div>
<pre><code>##  [1]  0.9162907  1.6292405  1.9021075  2.1860513  2.2082744 -1.6094379
##  [7]  1.4816045  1.6292405  2.0014800  1.2809338  1.3350011  1.4350845
## [13]  2.1633230  2.1747517</code></pre>
<p></p>
<p>Portanto, a função <code>safely()</code> te oferece um conjunto de informações mais completas sobre cada execução, pois ela te traz exatamente qual foi a mensagem de erro retornada. Porém, em algumas ocasiões, você só quer coletar os resultados gerados.</p>
<p>Para isso, temos uma outra função irmã mais simplificada, que é a função <code>possibly()</code>. Assim como ocorre com <code>safely()</code>, essa função <code>possibly()</code> recebe uma outra função como <em>input</em>, e retorna como <em>output</em>, uma nova versão da função de <em>input</em>. Assim como ocorre com <code>safely()</code>, a função criada por <code>possibly()</code> vai sempre executar com sucesso, mesmo que um erro seja levantado pela função principal <code>.f</code>.</p>
<p>Para mais, a função <code>possibly()</code> te permite definir um valor padrão de retorno, caso a execução da função principal <code>.f</code> retorne um erro. Por exemplo, com os comandos abaixo, estou definindo que se a função <code>log()</code> levantar algum erro para um determinado <em>input</em>, ela deve retornar como <em>output</em> o valor <code>NA_real_</code>.</p>
<p></p>
<div class="sourceCode" id="cb1751"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1751-1"><a href="#cb1751-1" aria-hidden="true" tabindex="-1"></a>valores <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb1751-2"><a href="#cb1751-2" aria-hidden="true" tabindex="-1"></a>  <span class="fl">3.2</span>, <span class="fl">4.4</span>, <span class="fl">5.1</span>, <span class="fl">8.6</span>,</span>
<span id="cb1751-3"><a href="#cb1751-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;C&quot;</span></span>
<span id="cb1751-4"><a href="#cb1751-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1751-5"><a href="#cb1751-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1751-6"><a href="#cb1751-6" aria-hidden="true" tabindex="-1"></a>valores <span class="sc">%&gt;%</span> </span>
<span id="cb1751-7"><a href="#cb1751-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map_dbl</span>(<span class="fu">possibly</span>(log, <span class="cn">NA_real_</span>))</span></code></pre></div>
<pre><code>## [1] 1.163151 1.481605 1.629241 2.151762       NA       NA       NA</code></pre>
<p></p>
<p>Apesar de duas opções bastante úteis, você pode ainda estar interessado em coletar outras informações sobre a execução de cada iteração. Como exemplo, a função <code>quietly()</code> exerce um papel semelhante à <code>safely()</code>, mas, ao invés de coletar erros, essa função busca coletar os resultados, mensagens e avisos gerados em cada iteração, além dos possíveis <em>outputs</em> que são mostrados na tela.</p>
<p>Perceba no exemplo abaixo, que assim como ocorre com <code>safely()</code> e <code>possibly()</code>, <code>quietly()</code> também nos retorna uma nova versão da função <code>print()</code>. Quando eu aplico essa nova função sobre algum <em>input</em> qualquer, é retornado uma lista com 4 elementos. Como os elementos <code>warnings</code> e <code>messages</code> abaixo estão vazios, isso significa que não houveram avisos ou mensagens acionadas durante a execução da expressão <code>print(8)</code>. Para mais, podemos ver através dos itens <code>result</code> e <code>output</code>, o resultado da expressão e, também, qual é o texto apresentado em nosso console quando a expressão <code>print(8)</code> é executada.</p>
<p></p>
<div class="sourceCode" id="cb1753"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1753-1"><a href="#cb1753-1" aria-hidden="true" tabindex="-1"></a>quiet_print <span class="ot">&lt;-</span> <span class="fu">quietly</span>(print)</span>
<span id="cb1753-2"><a href="#cb1753-2" aria-hidden="true" tabindex="-1"></a><span class="fu">quiet_print</span>(<span class="dv">8</span>)</span></code></pre></div>
<pre><code>## $result
## [1] 8
## 
## $output
## [1] &quot;[1] 8&quot;
## 
## $warnings
## character(0)
## 
## $messages
## character(0)</code></pre>
<p></p>
<p>Sendo assim, podemos utilizar a função <code>quietly()</code> em conjunto com <code>map()</code> para coletarmos essas informações sobre a execução de uma função qualquer sobre vários <em>inputs</em> diferentes. Veja no exemplo abaixo, que o segundo <em>input</em> da lista <code>x</code> (<code>-10</code>) gerou um aviso, pois o elemento <code>warnings</code> da segunda lista no resultado não está vazio.</p>
<p></p>
<div class="sourceCode" id="cb1755"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1755-1"><a href="#cb1755-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="dv">5</span>, <span class="sc">-</span><span class="dv">10</span>, <span class="dv">15</span>)</span>
<span id="cb1755-2"><a href="#cb1755-2" aria-hidden="true" tabindex="-1"></a>x <span class="sc">%&gt;%</span></span>
<span id="cb1755-3"><a href="#cb1755-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(<span class="fu">quietly</span>(log)) <span class="sc">%&gt;%</span> </span>
<span id="cb1755-4"><a href="#cb1755-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str</span>()</span></code></pre></div>
<pre><code>## List of 3
##  $ :List of 4
##   ..$ result  : num 1.61
##   ..$ output  : chr &quot;&quot;
##   ..$ warnings: chr(0) 
##   ..$ messages: chr(0) 
##  $ :List of 4
##   ..$ result  : num NaN
##   ..$ output  : chr &quot;&quot;
##   ..$ warnings: chr &quot;NaNs produced&quot;
##   ..$ messages: chr(0) 
##  $ :List of 4
##   ..$ result  : num 2.71
##   ..$ output  : chr &quot;&quot;
##   ..$ warnings: chr(0) 
##   ..$ messages: chr(0)</code></pre>
<p></p>
</div>
<div id="compreendendo-as-funções-map_dfr-e-map_dfc" class="section level2" number="16.6">
<h2 number="16.6"><span class="header-section-number">16.6</span> Compreendendo as funções <code>map_dfr()</code> e <code>map_dfc()</code></h2>
<p>Novamente, as funções <code>map_dfc()</code> e <code>map_dfr()</code> realizam exatamente o mesmo trabalho e possuem os mesmos argumentos das demais funções <code>map</code>. Contudo, como você já deve ter pressuposto pelo sufixo <code>df</code>, as funções <code>map_dfc()</code> e <code>map_dfr()</code> retornam como resultado, um <code>data.frame</code>. Porém, essas duas funções constroem esse novo <code>data.frame</code> de maneiras distintas.</p>
<p>Em primeiro lugar, você pode utilizar as funções <code>map_dfr()</code> e <code>map_dfc()</code>, sempre que um <code>data.frame</code> é gerado a cada iteração do <em>loop</em> criado pela função <code>map</code>. Ou seja, quando aplicamos a função <code>.f</code> sobre um elemento de <code>.x</code>, um <code>data.frame</code> é gerado como resultado. Dito ainda de uma outra forma, a função <code>.f</code> recebe um elemento de <code>.x</code> como <em>input</em>, e gera um novo <code>data.frame</code> como <em>output</em>.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/map_dfr.png" alt="\texttt{map\_dfr()} une os `data.frame`'s gerados, por linha" width="80%" />
<p class="caption">
(#fig:unnamed-chunk-924) une os <code>data.frame</code>’s gerados, por linha
</p>
</div>
<p></p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/map_dfc.png" alt="\texttt{map\_dfc()} une os `data.frame`'s gerados, por coluna" width="100%" />
<p class="caption">
(#fig:unnamed-chunk-925) une os <code>data.frame</code>’s gerados, por coluna
</p>
</div>
<p></p>
<p>Portanto, se você utiliza a função <code>map_df*()</code> sobre um objeto de 50 elementos, é esperado que 50 <code>data.frame</code>’s sejam gerados durante a execução de <code>map_df*()</code>. Após gerar todos esses 50 <code>data.frame</code>’s, a função <code>map_df*()</code> em questão, vai tentar uni-los em um único <code>data.frame</code>. Por fim, a função vai retornar como resultado, esse <code>data.frame</code> único, que contém os resultados de todos os 50 <code>data.frame</code>’s gerados.</p>
<p>Por isso, a única diferença essencial entre as funções <code>map_dfr()</code> e <code>map_dfc()</code>, está na forma como essas funções vão unir esses 50 <code>data.frame</code>’s gerados. Como você pode observar nas figuras 16.5 e 16.6, <code>map_dfr()</code> une os <code>data.frame</code>’s por linha, enquanto <code>map_dfc()</code>, une por coluna.</p>
<p>Tendo esses pontos em mente, as funções <code>map_dfr()</code> e <code>map_dfc()</code> são particularmente úteis, quando desejamos aplicar uma função sobre cada elemento de um objeto, e armazenar todos os resultados em um <code>data.frame</code> único.</p>
</div>
<div id="sec:demanda_dist_ICMS" class="section level2" number="16.7">
<h2 number="16.7"><span class="header-section-number">16.7</span> Um estudo de caso: uma demanda real sobre a distribuição de ICMS</h2>
<p>Nessa seção, vou apresentar um exemplo prático, sobre uma demanda real que chegou até mim em 2020. Na época, eu trabalhava como estagiário na Diretoria de Estatística e Informações da Fundação João Pinheiro (FJP-MG), mais especificamente com uma lei estadual que é tradicionalmente chamada de Lei Robin Hood (Lei 18.030 de 2009 - MG). Essa lei rege a distribuição do ICMS total de Minas Gerais, ao longo dos municípios do estado.</p>
<p>Em resumo, o Governo de Minas Gerais, coleta o ICMS (imposto sobre operações relativas à circulação de mercadorias e sobre prestações de serviços de transporte interestadual, intermunicipal e de comunicação) gerado em todo o estado, e ao final de um período, ele redistribui esse valor para os 853 municípios do estado. Cada município, possui um índice de participação, que corresponde à porcentagem do ICMS total ao qual o respectivo município tem direito. Em outras palavras, se o ICMS total gerado no estado em um período foi de 8,5 bilhões de reais, e o município de Belo Horizonte possui um índice de participação equivalente a 0,009, isso significa que ao final do período, 0,9% do ICMS total, ou 76,5 milhões de reais serão transferidos para a prefeitura do município de Belo Horizonte.</p>
<p>Diversos critérios descritos na lei regem o cálculo deste índice de participação de cada município, sendo alguns deles: Turismo, Esporte, Patrimônio Cultural, População e Receita Própria. Em suma, o índice de participação de cada município, é uma média ponderada dos índices de cada um desses diversos critérios da lei. Você pode encontrar uma descrição completa desses critérios e do cálculo dos índices de participação, no texto original da lei<a href="#fn42" class="footnote-ref" id="fnref42"><sup>42</sup></a>.</p>
<div id="a-demanda-em-si" class="section level3" number="16.7.1">
<h3 number="16.7.1"><span class="header-section-number">16.7.1</span> A demanda em si</h3>
<p>A demanda é muito simples, porém, ela é trabalhosa e envolve um volume excessivo de repetição se você optar por utilizar programas como Excel para resolvê-la. Dentre os vários critérios da lei, temos o critério de Meio Ambiente, e o órgão responsável pelo cálculo do índice referente a esse critério, é a SEMAD-MG (Secretaria de Estado de Meio Ambiente e Desenvolvimento Sustentável). Um dia, a SEMAD chegou até nós da Fundação João Pinheiro (FJP), pedindo por todos os valores de ICMS transferidos para cada município, ao longo dos anos de 2018 e 2019, de acordo com o critério do Meio Ambiente da Lei Robin Hood.</p>
<p>Os funcionários da FJP, calculam e publicam todo mês, os valores transferidos de ICMS separados por cada critério da lei, e para cada município. Ou seja, para o ano de 2019, pense por exemplo, em uma lista de arquivos de Excel parecida com a lista abaixo, onde cada planilha corresponde aos valores de ICMS transferidos em um mês específico do ano.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/planilhas1.png" alt="Lista de arquivos do Excel" width="80%" />
<p class="caption">
(#fig:unnamed-chunk-926)Lista de arquivos do Excel
</p>
</div>
<p></p>
<p>Dando uma olhada mais de perto, cada uma dessas planilhas do Excel, assumem a estrutura abaixo. Onde cada linha da tabela, representa um município do estado de Minas Gerais, e cada coluna (ou pelo menos, grande parte dessas colunas), representa os valores de ICMS transferidos segundo os índices de um critério específico da lei. Ou seja, a coluna <code>Educação</code>, nos apresenta os valores de ICMS transferidos para cada município do estado, considerando-se o índice que cada um desses municípios adquiriram no critério de Educação, e também, considerando-se a parcela que o critério de Educação representa do total de ICMS distribuído.</p>
<p></p>
<div class="sourceCode" id="cb1757"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1757-1"><a href="#cb1757-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb1757-2"><a href="#cb1757-2" aria-hidden="true" tabindex="-1"></a>Abril_2019 <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">&quot;planilhas/Abril_2019.xlsx&quot;</span>)</span>
<span id="cb1757-3"><a href="#cb1757-3" aria-hidden="true" tabindex="-1"></a>Abril_2019</span></code></pre></div>
<pre><code>## # A tibble: 853 x 27
##     IBGE1 IBGE2   SEF Municípios          População `População dos 50 + Po~
##     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;                   &lt;dbl&gt;                   &lt;dbl&gt;
##  1 310010    10     1 ABADIA DOS DOURADOS     8847.                       0
##  2 310020    20     2 ABAETÉ                 29470.                       0
##  3 310030    30     3 ABRE CAMPO             17087.                       0
##  4 310040    40     4 ACAIACA                 5068.                       0
##  5 310050    50     5 AÇUCENA                12151.                       0
##  6 310060    60     6 ÁGUA BOA               17258.                       0
##  7 310070    70     7 ÁGUA COMPRIDA           2544.                       0
##  8 310080    80     8 AGUANIL                 5644.                       0
##  9 310090    90     9 ÁGUAS FORMOSAS         24321.                       0
## 10 310100   100    10 ÁGUAS VERMELHAS        17102.                       0
## # ... with 843 more rows, and 21 more variables: Área Geográfica &lt;dbl&gt;,
## #   Educação &lt;dbl&gt;, Patrimônio Cultural &lt;dbl&gt;, Receita Própria &lt;dbl&gt;,
## #   Cota Mínima &lt;dbl&gt;, Mineradores &lt;dbl&gt;, Saúde Per Capita &lt;dbl&gt;,
## #   VAF &lt;dbl&gt;, Esportes &lt;dbl&gt;, Turismo &lt;dbl&gt;, Penitenciárias &lt;dbl&gt;,
## #   Recursos Hídricos &lt;dbl&gt;, Produção de Alimentos 2º semestre &lt;dbl&gt;,
## #   Unidades de Conservação (IC i) &lt;dbl&gt;, Saneamento &lt;dbl&gt;,
## #   Mata Seca &lt;dbl&gt;, Meio Ambiente &lt;dbl&gt;, PSF &lt;dbl&gt;, ...</code></pre>
<p></p>
<p>Porém, temos dois problemas aqui: 1) A SEMAD precisa apenas dos valores de ICMS transferidos de acordo com o critério de Meio Ambiente, e nada mais; 2) A SEMAD precisa dos valores de ICMS transferidos ao longo de todos os meses dos anos de 2018 e 2019, e se nós temos 12 planilhas por ano, temos que reunir informações de 24 planilhas diferentes para a secretaria.</p>
<p>Portanto, temos aqui uma típica tarefa extremamente repetitiva e monótona, que ninguém gosta de fazer. Imagine você abrindo na mão, cada uma das 24 planilhas, procurando pela coluna do Meio Ambiente, copiando e colando ela em um novo arquivo contendo apenas os dados de Meio Ambiente, preenchendo colunas de ano e mês para manter a rastreabilidade dos registros, etc. Aqueles com mais experiência no Excel, poderiam argumentar que uma solução mais segura, seria utilizar a plataforma de <em>queries</em> do programa para carregar os dados das 24 planilhas em uma planilha única. Porém, apenas pelo tempo que você levaria para importar cada arquivo e configurar cada <em>querie</em>, seria muito mais rápido se você simplesmente adotasse a estratégia de <code>Crtl+C</code> e <code>Ctrl+V</code>, para transferir todos os dados para uma planilha única.</p>
<p>Além disso, tarefas muito repetitivas são, não apenas muito cansativas, mas também, muito <em>error-prone</em> (ou seja, elas elevam muito as suas chances de erros). Esses são dois fatores que podem ser facilmente evitados através do uso de funções e de <em>loop</em>’s no R. Ao construir uma função que define as ações que você deseja aplicar, e um <em>loop</em> que replique essa função para todas as x planilhas, você permite que o seu computador realize o trabalho duro e cansativo por você. Com isso, as suas chances de erro se reduzem muito, e você realiza o mesmo trabalho em menor tempo. Pois os nossos computadores são extremamente rápidos e precisos para realizar todo tipo de cálculo. Afinal, é para isso que eles foram feitos.</p>
</div>
<div id="planejando-os-passos" class="section level3" number="16.7.2">
<h3 number="16.7.2"><span class="header-section-number">16.7.2</span> Planejando os passos</h3>
<p>Como exemplo prático, para formatar os arquivos segundo as necessidades da SEMAD-MG, vou demonstrar as seguintes etapas: 1) importar essas planilhas para o R; 2) adicionar colunas de referência para cada planilha (ano e mês a que os dados se referem); 3) unir todas as planilhas em uma tabela única; 4) selecionar apenas as colunas relevantes para a SEMAD; 5) exportar o resultado para fora do R.</p>
</div>
<div id="importando-as-planilhas" class="section level3" number="16.7.3">
<h3 number="16.7.3"><span class="header-section-number">16.7.3</span> Importando as planilhas</h3>
<p>Tendo isso em mente, o primeiro passo seria importarmos essas planilhas. Mas, para isso precisamos dos <em>path</em>’s, ou, dos caminhos até esses arquivos. Podemos coletar essa informação, através da função <code>list.files()</code>, a qual pertence aos pacotes básicos do R. Como o próprio nome dá a entender, essa função busca listar os nomes de todos os arquivos contidos em determinada uma pasta. Caso você não defina alguma pasta específica na função (diferente do que fizemos abaixo), <code>list.files()</code> vai listar todos os arquivos presentes no seu diretório de trabalho atual do R.</p>
<p>Neste exemplo, todas as 12 planilhas já estão separadas dentro de uma pasta de meu computador chamada <code>"planilhas"</code>. Por isso, forneço abaixo o nome dessa pasta à função <code>list.files()</code>. Como resultado, o objeto <code>caminhos</code> contém o caminho até todas essas planilhas que desejamos importar para dentro do R.</p>
<p></p>
<div class="sourceCode" id="cb1759"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1759-1"><a href="#cb1759-1" aria-hidden="true" tabindex="-1"></a>caminhos <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="st">&quot;planilhas/&quot;</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1759-2"><a href="#cb1759-2" aria-hidden="true" tabindex="-1"></a>caminhos</span></code></pre></div>
<pre><code>##  [1] &quot;planilhas/Abril_2019.xlsx&quot;     &quot;planilhas/Agosto_2019.xlsx&quot;   
##  [3] &quot;planilhas/Dezembro_2019.xlsx&quot;  &quot;planilhas/Fevereiro_2019.xlsx&quot;
##  [5] &quot;planilhas/Janeiro_2019.xlsx&quot;   &quot;planilhas/Julho_2019.xlsx&quot;    
##  [7] &quot;planilhas/Junho_2019.xlsx&quot;     &quot;planilhas/Maio_2019.xlsx&quot;     
##  [9] &quot;planilhas/Marco_2019.xlsx&quot;     &quot;planilhas/Novembro_2019.xlsx&quot; 
## [11] &quot;planilhas/Outubro_2019.xlsx&quot;   &quot;planilhas/Setembro_2019.xlsx&quot;</code></pre>
<p></p>
<p>Agora que temos os caminhos até todas essas planilhas, importá-las para dentro do R se torna algo extremamente simples. Podemos simplesmente utilizar a função <code>map()</code> para aplicar uma função (que seja capaz de ler esses arquivos) sobre cada um desses caminhos. Lembre-se que, podemos importar planilhas do Excel para dentro do R, através da função <code>readxl::read_excel()</code> que introduzimos no capítulo 4.</p>
<p></p>
<div class="sourceCode" id="cb1761"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1761-1"><a href="#cb1761-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb1761-2"><a href="#cb1761-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span>
<span id="cb1761-3"><a href="#cb1761-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1761-4"><a href="#cb1761-4" aria-hidden="true" tabindex="-1"></a>planilhas <span class="ot">&lt;-</span> <span class="fu">map</span>(caminhos, read_excel)</span>
<span id="cb1761-5"><a href="#cb1761-5" aria-hidden="true" tabindex="-1"></a>planilhas[[<span class="dv">1</span>]]</span></code></pre></div>
<pre><code>## # A tibble: 853 x 27
##     IBGE1 IBGE2   SEF Municípios          População `População dos 50 + Po~
##     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;                   &lt;dbl&gt;                   &lt;dbl&gt;
##  1 310010    10     1 ABADIA DOS DOURADOS     8847.                       0
##  2 310020    20     2 ABAETÉ                 29470.                       0
##  3 310030    30     3 ABRE CAMPO             17087.                       0
##  4 310040    40     4 ACAIACA                 5068.                       0
##  5 310050    50     5 AÇUCENA                12151.                       0
##  6 310060    60     6 ÁGUA BOA               17258.                       0
##  7 310070    70     7 ÁGUA COMPRIDA           2544.                       0
##  8 310080    80     8 AGUANIL                 5644.                       0
##  9 310090    90     9 ÁGUAS FORMOSAS         24321.                       0
## 10 310100   100    10 ÁGUAS VERMELHAS        17102.                       0
## # ... with 843 more rows, and 21 more variables: Área Geográfica &lt;dbl&gt;,
## #   Educação &lt;dbl&gt;, Patrimônio Cultural &lt;dbl&gt;, Receita Própria &lt;dbl&gt;,
## #   Cota Mínima &lt;dbl&gt;, Mineradores &lt;dbl&gt;, Saúde Per Capita &lt;dbl&gt;,
## #   VAF &lt;dbl&gt;, Esportes &lt;dbl&gt;, Turismo &lt;dbl&gt;, Penitenciárias &lt;dbl&gt;,
## #   Recursos Hídricos &lt;dbl&gt;, Produção de Alimentos 2º semestre &lt;dbl&gt;,
## #   Unidades de Conservação (IC i) &lt;dbl&gt;, Saneamento &lt;dbl&gt;,
## #   Mata Seca &lt;dbl&gt;, Meio Ambiente &lt;dbl&gt;, PSF &lt;dbl&gt;, ...</code></pre>
<p></p>
<p>Agora, o objeto <code>planilhas</code> é uma lista de 12 elementos. Cada elemento dessa lista, contém um <code>data.frame</code> que corresponde aos dados de uma das 12 planilhas.</p>
</div>
<div id="conferindo-a-estrutura-dos-arquivos" class="section level3" number="16.7.4">
<h3 number="16.7.4"><span class="header-section-number">16.7.4</span> Conferindo a estrutura dos arquivos</h3>
<p>Vamos aproveitar que já importamos as 12 planilhas, para fazermos algumas conferências sobre esses arquivos. Será que todas as planilhas possuem a mesma estrutura (o mesmo número de linhas, as mesmas colunas, os mesmos tipos de dados, etc.) ? Logo abaixo, estamos utilizando a função <code>nrow()</code> para coletarmos os números de linhas de cada tabela, <code>ncol()</code> para o número de colunas, e <code>colnames()</code> para os nomes das colunas. Perceba abaixo, que todas as planilhas possuem o mesmo número de linhas e colunas.</p>
<p></p>
<div class="sourceCode" id="cb1763"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1763-1"><a href="#cb1763-1" aria-hidden="true" tabindex="-1"></a>n_linhas <span class="ot">&lt;-</span> <span class="fu">map_int</span>(planilhas, nrow)</span>
<span id="cb1763-2"><a href="#cb1763-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(n_linhas)</span></code></pre></div>
<pre><code>##  [1] 853 853 853 853 853 853 853 853 853 853 853 853</code></pre>
<div class="sourceCode" id="cb1765"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1765-1"><a href="#cb1765-1" aria-hidden="true" tabindex="-1"></a>n_colunas <span class="ot">&lt;-</span> <span class="fu">map_int</span>(planilhas, ncol)</span>
<span id="cb1765-2"><a href="#cb1765-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(n_colunas)</span></code></pre></div>
<pre><code>##  [1] 27 27 27 27 27 27 27 27 27 27 27 27</code></pre>
<p></p>
<p>Para conferirmos os nomes das colunas temos um pouco mais de trabalho, mas nada que seja muito distante do que foi mostrado até o momento.</p>
<p></p>
<div class="sourceCode" id="cb1767"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1767-1"><a href="#cb1767-1" aria-hidden="true" tabindex="-1"></a>nomes_colunas <span class="ot">&lt;-</span> <span class="fu">map</span>(planilhas, colnames)</span>
<span id="cb1767-2"><a href="#cb1767-2" aria-hidden="true" tabindex="-1"></a>referencia <span class="ot">&lt;-</span> nomes_colunas[[<span class="dv">1</span>]]</span>
<span id="cb1767-3"><a href="#cb1767-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1767-4"><a href="#cb1767-4" aria-hidden="true" tabindex="-1"></a>igual_a_referencia <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">&quot;logical&quot;</span>, <span class="at">length =</span> <span class="dv">12</span>)</span>
<span id="cb1767-5"><a href="#cb1767-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_along</span>(nomes_colunas)){</span>
<span id="cb1767-6"><a href="#cb1767-6" aria-hidden="true" tabindex="-1"></a>  igual_a_referencia[i] <span class="ot">&lt;-</span> <span class="fu">all</span>(nomes_colunas[[i]] <span class="sc">==</span> referencia)</span>
<span id="cb1767-7"><a href="#cb1767-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1767-8"><a href="#cb1767-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1767-9"><a href="#cb1767-9" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(igual_a_referencia) <span class="ot">&lt;-</span> caminhos</span>
<span id="cb1767-10"><a href="#cb1767-10" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(igual_a_referencia)</span></code></pre></div>
<pre><code>##     planilhas/Abril_2019.xlsx    planilhas/Agosto_2019.xlsx 
##                          TRUE                          TRUE 
##  planilhas/Dezembro_2019.xlsx planilhas/Fevereiro_2019.xlsx 
##                         FALSE                          TRUE 
##   planilhas/Janeiro_2019.xlsx     planilhas/Julho_2019.xlsx 
##                          TRUE                          TRUE 
##     planilhas/Junho_2019.xlsx      planilhas/Maio_2019.xlsx 
##                          TRUE                          TRUE 
##     planilhas/Marco_2019.xlsx  planilhas/Novembro_2019.xlsx 
##                          TRUE                         FALSE 
##   planilhas/Outubro_2019.xlsx  planilhas/Setembro_2019.xlsx 
##                          TRUE                          TRUE</code></pre>
<p></p>
<p>Perceba pelo resultado acima, que os arquivos <code>Dezembro_2019.xlsx</code> e <code>Novembro_2019.xlsx</code> possuem alguma divergência no nome de suas colunas. Podemos rapidamente descobrir que colunas são essas com um simples teste lógico e <em>subsetting</em>:</p>
<p></p>
<div class="sourceCode" id="cb1769"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1769-1"><a href="#cb1769-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Coluna diferente no arquivo Dezembro_2019.xlsx</span></span>
<span id="cb1769-2"><a href="#cb1769-2" aria-hidden="true" tabindex="-1"></a>nomes_colunas[[<span class="dv">3</span>]][ <span class="sc">!</span>referencia <span class="sc">==</span> nomes_colunas[[<span class="dv">3</span>]] ]</span></code></pre></div>
<pre><code>## [1] &quot;cota minima&quot;</code></pre>
<div class="sourceCode" id="cb1771"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1771-1"><a href="#cb1771-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Coluna diferente no arquivo Novembro_2019.xlsx</span></span>
<span id="cb1771-2"><a href="#cb1771-2" aria-hidden="true" tabindex="-1"></a>nomes_colunas[[<span class="dv">10</span>]][ <span class="sc">!</span>referencia <span class="sc">==</span> nomes_colunas[[<span class="dv">10</span>]] ]</span></code></pre></div>
<pre><code>## [1] &quot;cota minima&quot;</code></pre>
<p></p>
<p>Pelos resultados acima, podemos observar que as duas planilhas possuem uma coluna chamada <code>cota minima</code>, a qual não está presente nas demais planilhas. Essa mesma coluna está nomeada como <code>Cota Mínima</code>, nas demais planilhas. Como resultado, caso você estivesse aplicando um <em>loop</em> sobre cada uma das 12 planilhas, e estivesse procurando por uma coluna chamada <code>Cota Mínima</code> em cada uma delas, o R não seria capaz de encontrar essa coluna nos arquivos <code>Dezembro_2019.xlsx</code> e <code>Novembro_2019.xlsx</code>.</p>
<p>Pelo fato de estarmos preocupados com a coluna de <code>Meio Ambiente</code>, essa diferença se torna um pouco irrelevante para nós. Entretanto, caso estivéssemos trabalhando com essa coluna de <code>Cota Mínima</code> em cada planilha, teríamos um grande problema a ser resolvido.</p>
</div>
<div id="adicionando-colunas-de-referência" class="section level3" number="16.7.5">
<h3 number="16.7.5"><span class="header-section-number">16.7.5</span> Adicionando colunas de referência</h3>
<p>Apesar de já termos importado todas as 12 planilhas, temos um grande problema a ser solucionado. Os dados de cada planilha não possuem qualquer coluna ou metadado de referência que indique o período ao qual os dados se referem.</p>
<p>Dito de outra forma, ao olharmos para os dados da primeira planilha, podemos ver os valores monetários de cada município para cada critério. Porém, a que mês esses valores monetários se referem? Dezembro? Janeiro? Março? E de que ano? 2019? ou 2020?</p>
<p></p>
<div class="sourceCode" id="cb1773"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1773-1"><a href="#cb1773-1" aria-hidden="true" tabindex="-1"></a>planilhas[[<span class="dv">1</span>]]</span></code></pre></div>
<pre><code>## # A tibble: 853 x 27
##     IBGE1 IBGE2   SEF Municípios          População `População dos 50 + Po~
##     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;                   &lt;dbl&gt;                   &lt;dbl&gt;
##  1 310010    10     1 ABADIA DOS DOURADOS     8847.                       0
##  2 310020    20     2 ABAETÉ                 29470.                       0
##  3 310030    30     3 ABRE CAMPO             17087.                       0
##  4 310040    40     4 ACAIACA                 5068.                       0
##  5 310050    50     5 AÇUCENA                12151.                       0
##  6 310060    60     6 ÁGUA BOA               17258.                       0
##  7 310070    70     7 ÁGUA COMPRIDA           2544.                       0
##  8 310080    80     8 AGUANIL                 5644.                       0
##  9 310090    90     9 ÁGUAS FORMOSAS         24321.                       0
## 10 310100   100    10 ÁGUAS VERMELHAS        17102.                       0
## # ... with 843 more rows, and 21 more variables: Área Geográfica &lt;dbl&gt;,
## #   Educação &lt;dbl&gt;, Patrimônio Cultural &lt;dbl&gt;, Receita Própria &lt;dbl&gt;,
## #   Cota Mínima &lt;dbl&gt;, Mineradores &lt;dbl&gt;, Saúde Per Capita &lt;dbl&gt;,
## #   VAF &lt;dbl&gt;, Esportes &lt;dbl&gt;, Turismo &lt;dbl&gt;, Penitenciárias &lt;dbl&gt;,
## #   Recursos Hídricos &lt;dbl&gt;, Produção de Alimentos 2º semestre &lt;dbl&gt;,
## #   Unidades de Conservação (IC i) &lt;dbl&gt;, Saneamento &lt;dbl&gt;,
## #   Mata Seca &lt;dbl&gt;, Meio Ambiente &lt;dbl&gt;, PSF &lt;dbl&gt;, ...</code></pre>
<p></p>
<p>Sabemos que os dados dessa primeira planilha se referem ao mês de abril de 2019, pois essa informação está incrustada no nome da primeira planilha descrita no objeto <code>caminhos</code>, o qual utilizamos para importar todas as 12 planilhas. Porém, qualquer pessoa que não tenha acesso ao objeto <code>caminhos</code>, não será capaz de identificar tal informação.</p>
<p>Por isso, seria muito importante adicionarmos colunas de mês e ano em cada uma das 12 planilhas. Para isso, podemos aplicar os comandos abaixo. Pelo fato do mês e do ano de cada planilha estarem definidos nos próprios nomes dos arquivos, os primeiros comandos buscam extrair essas informações a partir do objeto <code>caminhos</code>. Depois disso, utilizamos um <code>for</code> <em>loop</em> para adicionar essas informações a cada uma 12 tabelas.</p>
<p></p>
<div class="sourceCode" id="cb1775"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1775-1"><a href="#cb1775-1" aria-hidden="true" tabindex="-1"></a>nomes_arquivos <span class="ot">&lt;-</span> <span class="fu">basename</span>(caminhos)</span>
<span id="cb1775-2"><a href="#cb1775-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1775-3"><a href="#cb1775-3" aria-hidden="true" tabindex="-1"></a>meses <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_replace</span>(</span>
<span id="cb1775-4"><a href="#cb1775-4" aria-hidden="true" tabindex="-1"></a>  nomes_arquivos, <span class="st">&quot;(.*)_(.*)[.]xlsx&quot;</span>, <span class="st">&quot;</span><span class="sc">\\</span><span class="st">1&quot;</span></span>
<span id="cb1775-5"><a href="#cb1775-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1775-6"><a href="#cb1775-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1775-7"><a href="#cb1775-7" aria-hidden="true" tabindex="-1"></a>anos <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_replace</span>(</span>
<span id="cb1775-8"><a href="#cb1775-8" aria-hidden="true" tabindex="-1"></a>  nomes_arquivos, <span class="st">&quot;(.*)_(.*)[.]xlsx&quot;</span>, <span class="st">&quot;</span><span class="sc">\\</span><span class="st">2&quot;</span></span>
<span id="cb1775-9"><a href="#cb1775-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1775-10"><a href="#cb1775-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1775-11"><a href="#cb1775-11" aria-hidden="true" tabindex="-1"></a>anos <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(anos)</span>
<span id="cb1775-12"><a href="#cb1775-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1775-13"><a href="#cb1775-13" aria-hidden="true" tabindex="-1"></a><span class="do">### Um for loop para visitar cada uma das</span></span>
<span id="cb1775-14"><a href="#cb1775-14" aria-hidden="true" tabindex="-1"></a><span class="do">### 12 planilhas e adicionar as colunas Ano e Mes:</span></span>
<span id="cb1775-15"><a href="#cb1775-15" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_along</span>(planilhas)){</span>
<span id="cb1775-16"><a href="#cb1775-16" aria-hidden="true" tabindex="-1"></a>  planilhas[[i]] <span class="ot">&lt;-</span> planilhas[[i]] <span class="sc">%&gt;%</span> </span>
<span id="cb1775-17"><a href="#cb1775-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb1775-18"><a href="#cb1775-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">Ano =</span> anos[i],</span>
<span id="cb1775-19"><a href="#cb1775-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">Mes =</span> meses[i]</span>
<span id="cb1775-20"><a href="#cb1775-20" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb1775-21"><a href="#cb1775-21" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1775-22"><a href="#cb1775-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1775-23"><a href="#cb1775-23" aria-hidden="true" tabindex="-1"></a><span class="do">### Os dados de Abril de 2019:</span></span>
<span id="cb1775-24"><a href="#cb1775-24" aria-hidden="true" tabindex="-1"></a>planilhas[[<span class="dv">1</span>]] <span class="sc">%&gt;%</span> <span class="fu">select</span>(Ano, Mes)</span></code></pre></div>
<pre><code>## # A tibble: 853 x 2
##      Ano Mes  
##    &lt;int&gt; &lt;chr&gt;
##  1  2019 Abril
##  2  2019 Abril
##  3  2019 Abril
##  4  2019 Abril
##  5  2019 Abril
##  6  2019 Abril
##  7  2019 Abril
##  8  2019 Abril
##  9  2019 Abril
## 10  2019 Abril
## # ... with 843 more rows</code></pre>
<div class="sourceCode" id="cb1777"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1777-1"><a href="#cb1777-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Os dados de Dezembro de 2019:</span></span>
<span id="cb1777-2"><a href="#cb1777-2" aria-hidden="true" tabindex="-1"></a>planilhas[[<span class="dv">3</span>]] <span class="sc">%&gt;%</span> <span class="fu">select</span>(Ano, Mes)</span></code></pre></div>
<pre><code>## # A tibble: 853 x 2
##      Ano Mes     
##    &lt;int&gt; &lt;chr&gt;   
##  1  2019 Dezembro
##  2  2019 Dezembro
##  3  2019 Dezembro
##  4  2019 Dezembro
##  5  2019 Dezembro
##  6  2019 Dezembro
##  7  2019 Dezembro
##  8  2019 Dezembro
##  9  2019 Dezembro
## 10  2019 Dezembro
## # ... with 843 more rows</code></pre>
<p></p>
</div>
<div id="selecionando-apenas-as-colunas-relevantes" class="section level3" number="16.7.6">
<h3 number="16.7.6"><span class="header-section-number">16.7.6</span> Selecionando apenas as colunas relevantes</h3>
<p>Agora que adicionamos as colunas de referência a cada uma das 12 planilhas, podemos nos preocupar em selecionar apenas as colunas relevantes para a SEMAD de cada planilha. Para isso, podemos simplesmente aplicar a função <code>select()</code> que vimos no capítulo 4, sobre cada planilha.</p>
<p>Aqui, podemos nos aproveitar do argumento especial <code>...</code> da função <code>map()</code>. Lembre-se que <code>map()</code> utiliza esse argumento especial para coletar os argumentos que serão repassados para a função (<code>.f</code>) que estamos aplicando.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/map2.png" alt="Relembrando os argumentos de `map()`" width="90%" />
<p class="caption">
(#fig:unnamed-chunk-935)Relembrando os argumentos de <code>map()</code>
</p>
</div>
<p></p>
<p>Lembre-se também, que os argumentos repassados serão constantes ao longo de todo o <em>loop</em>. Em outras palavras, esses argumentos serão sempre os mesmos em cada chamada da função <code>.f</code>. Logo, quando você digita um comando como <code>map(x, mean, na.rm = TRUE)</code>, a função <code>map()</code> vai sempre repassar o argumento <code>na.rm</code> com o valor <code>TRUE</code> em cada chamada à função <code>mean()</code>.</p>
<!-- ```{r, echo = FALSE, fig.cap = "Argumentos repassados à `...` são reutilizados em cada chamada à função `.f`", out.width="70%"} -->
<!-- knitr::include_graphics("Figuras/map3.png") -->
<!-- ``` -->
<p>Para compreender como você pode se aproveitar desse argumento, pense em como você aplicaria a função <code>select()</code> sobre apenas 1 das 12 planilhas. Perceba abaixo, que estamos repassando os argumentos <code>Ano</code>, <code>Mes</code>, <code>IBGE1</code>, <code>Municípios</code> e <code>Meio Ambiente</code> à função.</p>
<p></p>
<div class="sourceCode" id="cb1779"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1779-1"><a href="#cb1779-1" aria-hidden="true" tabindex="-1"></a>planilhas[[<span class="dv">1</span>]] <span class="sc">%&gt;%</span> </span>
<span id="cb1779-2"><a href="#cb1779-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Ano, Mes, IBGE1, Municípios, <span class="st">`</span><span class="at">Meio Ambiente</span><span class="st">`</span>)</span></code></pre></div>
<pre><code>## # A tibble: 853 x 5
##      Ano Mes    IBGE1 Municípios          `Meio Ambiente`
##    &lt;int&gt; &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt;                         &lt;dbl&gt;
##  1  2019 Abril 310010 ABADIA DOS DOURADOS              0 
##  2  2019 Abril 310020 ABAETÉ                           0 
##  3  2019 Abril 310030 ABRE CAMPO                   10433.
##  4  2019 Abril 310040 ACAIACA                          0 
##  5  2019 Abril 310050 AÇUCENA                       7727.
##  6  2019 Abril 310060 ÁGUA BOA                     10433.
##  7  2019 Abril 310070 ÁGUA COMPRIDA                21909.
##  8  2019 Abril 310080 AGUANIL                          0 
##  9  2019 Abril 310090 ÁGUAS FORMOSAS                   0 
## 10  2019 Abril 310100 ÁGUAS VERMELHAS              14750.
## # ... with 843 more rows</code></pre>
<p></p>
<p>Essas são as colunas que estamos interessados em extrair de cada planilha. Ou seja, queremos sempre repassar esses 5 argumentos à função <code>select()</code>, pois desejamos selecionar sempre essas mesmas colunas de cada planilha. Tendo isso em mente, podemos aplicar o seguinte comando:</p>
<p></p>
<div class="sourceCode" id="cb1781"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1781-1"><a href="#cb1781-1" aria-hidden="true" tabindex="-1"></a>planilhas <span class="ot">&lt;-</span> <span class="fu">map</span>(</span>
<span id="cb1781-2"><a href="#cb1781-2" aria-hidden="true" tabindex="-1"></a>  planilhas, select,</span>
<span id="cb1781-3"><a href="#cb1781-3" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Argumentos repassados para select():</span></span>
<span id="cb1781-4"><a href="#cb1781-4" aria-hidden="true" tabindex="-1"></a>  Ano, Mes, IBGE1, Municípios, <span class="st">`</span><span class="at">Meio Ambiente</span><span class="st">`</span></span>
<span id="cb1781-5"><a href="#cb1781-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p></p>
</div>
<div id="unindo-as-12-planilhas-em-uma-só" class="section level3" number="16.7.7">
<h3 number="16.7.7"><span class="header-section-number">16.7.7</span> Unindo as 12 planilhas em uma só</h3>
<p>Temos agora, uma lista contendo todas as 12 planilhas com apenas as colunas que a SEMAD necessita. Porém, lembre-se que cada planilha, está atualmente separada em um elemento diferente da lista. Nós estabelecemos anteriormente, que o ideal seria reunirmos todas essas 12 tabelas, em uma só.</p>
<p>Para executarmos esse passo, nós podemos simplesmente aplicar a função <code>bind_rows()</code> (que introduzimos no capítulo 4) sobre a lista <code>planilhas</code>. Se nós temos 12 planilhas diferentes, onde, cada linha de cada planilha representa um dos 853 municípios de Minas Gerais, ao unirmos todas essas tabelas, devemos ter como resultado, uma única tabela contendo 10.236 linhas (<span class="math inline">\(853 \times 12 = 10.236\)</span>).</p>
<p></p>
<div class="sourceCode" id="cb1782"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1782-1"><a href="#cb1782-1" aria-hidden="true" tabindex="-1"></a>resultado <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(planilhas)</span>
<span id="cb1782-2"><a href="#cb1782-2" aria-hidden="true" tabindex="-1"></a>resultado</span></code></pre></div>
<pre><code>## # A tibble: 10,236 x 5
##      Ano Mes    IBGE1 Municípios          `Meio Ambiente`
##    &lt;int&gt; &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt;                         &lt;dbl&gt;
##  1  2019 Abril 310010 ABADIA DOS DOURADOS              0 
##  2  2019 Abril 310020 ABAETÉ                           0 
##  3  2019 Abril 310030 ABRE CAMPO                   10433.
##  4  2019 Abril 310040 ACAIACA                          0 
##  5  2019 Abril 310050 AÇUCENA                       7727.
##  6  2019 Abril 310060 ÁGUA BOA                     10433.
##  7  2019 Abril 310070 ÁGUA COMPRIDA                21909.
##  8  2019 Abril 310080 AGUANIL                          0 
##  9  2019 Abril 310090 ÁGUAS FORMOSAS                   0 
## 10  2019 Abril 310100 ÁGUAS VERMELHAS              14750.
## # ... with 10,226 more rows</code></pre>
<p></p>
<p>Contudo, se você relembrar da função <code>map_dfr()</code> que expomos anteriormente, você pode chegar à conclusão de que poderíamos ter eliminado esse passo, ao utilizarmos essa função <code>map_dfr()</code> para aplicarmos a função <code>select()</code> sobre cada planilha. Pois, como destacamos, a função <code>map_dfr()</code> vai aplicar a função <code>.f</code> sobre cada elemento de <code>.x</code> e, em seguida, vai tentar unir todos os resultados em um único <code>data.frame</code>.</p>
<p></p>
<div class="sourceCode" id="cb1784"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1784-1"><a href="#cb1784-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Todos os resultados já são armazenados</span></span>
<span id="cb1784-2"><a href="#cb1784-2" aria-hidden="true" tabindex="-1"></a><span class="do">## em um único data.frame:</span></span>
<span id="cb1784-3"><a href="#cb1784-3" aria-hidden="true" tabindex="-1"></a>resultado <span class="ot">&lt;-</span> <span class="fu">map_dfr</span>(</span>
<span id="cb1784-4"><a href="#cb1784-4" aria-hidden="true" tabindex="-1"></a>  planilhas, select,</span>
<span id="cb1784-5"><a href="#cb1784-5" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Argumentos repassados para select():</span></span>
<span id="cb1784-6"><a href="#cb1784-6" aria-hidden="true" tabindex="-1"></a>  Ano, Mes, IBGE1, Municípios, <span class="st">`</span><span class="at">Meio Ambiente</span><span class="st">`</span></span>
<span id="cb1784-7"><a href="#cb1784-7" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p></p>
</div>
<div id="conclusão" class="section level3" number="16.7.8">
<h3 number="16.7.8"><span class="header-section-number">16.7.8</span> Conclusão</h3>
<p>Portanto, uma tarefa que inicialmente seria trabalhosa e extremamente repetitiva em muitos programas comuns (como o Excel), pode ser resolvida no R de maneira fácil e rápida, através do uso das funções <code>map()</code>.</p>
<p>Tínhamos como objetivo, reunir os dados presentes em 12 planilhas em uma única tabela, e em seguida, selecionar apenas aquelas colunas que eram de interesse da SEMAD. Se reunirmos todos os comandos que utilizamos no R, temos um <em>script</em> com mais ou menos 30 linhas. Ou seja, com apenas 30 linhas, somos capazes de economizar um tempo e esforço enormes em nosso trabalho.</p>
<p>A partir daqui, com a tabela única em nossas mãos, nós precisamos apenas exportar essa tabela para fora do R. Algo que pode ser rapidamente realizado através de uma função como a <code>write_csv2()</code>, que introduzimos na seção <a href="#sec:exportando_readr">Exportando dados em arquivos de texto com readr</a>.</p>
<p></p>
<div class="sourceCode" id="cb1785"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1785-1"><a href="#cb1785-1" aria-hidden="true" tabindex="-1"></a>caminhos <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="st">&quot;planilhas/&quot;</span>)</span>
<span id="cb1785-2"><a href="#cb1785-2" aria-hidden="true" tabindex="-1"></a>planilhas <span class="ot">&lt;-</span> <span class="fu">map</span>(caminhos, planilhas)</span>
<span id="cb1785-3"><a href="#cb1785-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1785-4"><a href="#cb1785-4" aria-hidden="true" tabindex="-1"></a>nomes_arquivos <span class="ot">&lt;-</span> <span class="fu">basename</span>(caminhos)</span>
<span id="cb1785-5"><a href="#cb1785-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1785-6"><a href="#cb1785-6" aria-hidden="true" tabindex="-1"></a>meses <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_replace</span>(</span>
<span id="cb1785-7"><a href="#cb1785-7" aria-hidden="true" tabindex="-1"></a>  nomes_arquivos, <span class="st">&quot;(.*)_(.*)[.]xlsx&quot;</span>, <span class="st">&quot;</span><span class="sc">\\</span><span class="st">1&quot;</span></span>
<span id="cb1785-8"><a href="#cb1785-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1785-9"><a href="#cb1785-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1785-10"><a href="#cb1785-10" aria-hidden="true" tabindex="-1"></a>anos <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_replace</span>(</span>
<span id="cb1785-11"><a href="#cb1785-11" aria-hidden="true" tabindex="-1"></a>  nomes_arquivos, <span class="st">&quot;(.*)_(.*)[.]xlsx&quot;</span>, <span class="st">&quot;</span><span class="sc">\\</span><span class="st">2&quot;</span></span>
<span id="cb1785-12"><a href="#cb1785-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1785-13"><a href="#cb1785-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1785-14"><a href="#cb1785-14" aria-hidden="true" tabindex="-1"></a>anos <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(anos)</span>
<span id="cb1785-15"><a href="#cb1785-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1785-16"><a href="#cb1785-16" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_along</span>(planilhas)){</span>
<span id="cb1785-17"><a href="#cb1785-17" aria-hidden="true" tabindex="-1"></a>  planilhas[[i]] <span class="ot">&lt;-</span> planilhas[[i]] <span class="sc">%&gt;%</span> </span>
<span id="cb1785-18"><a href="#cb1785-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb1785-19"><a href="#cb1785-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">Ano =</span> anos[i],</span>
<span id="cb1785-20"><a href="#cb1785-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">Mes =</span> meses[i]</span>
<span id="cb1785-21"><a href="#cb1785-21" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb1785-22"><a href="#cb1785-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1785-23"><a href="#cb1785-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1785-24"><a href="#cb1785-24" aria-hidden="true" tabindex="-1"></a>resultado <span class="ot">&lt;-</span> <span class="fu">map_dfr</span>(</span>
<span id="cb1785-25"><a href="#cb1785-25" aria-hidden="true" tabindex="-1"></a>  planilhas, select,</span>
<span id="cb1785-26"><a href="#cb1785-26" aria-hidden="true" tabindex="-1"></a>  Ano, Mes, IBGE1, Municípios, <span class="st">`</span><span class="at">Meio Ambiente</span><span class="st">`</span></span>
<span id="cb1785-27"><a href="#cb1785-27" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1785-28"><a href="#cb1785-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1785-29"><a href="#cb1785-29" aria-hidden="true" tabindex="-1"></a><span class="do">### Para exportar o resultado:</span></span>
<span id="cb1785-30"><a href="#cb1785-30" aria-hidden="true" tabindex="-1"></a>readr<span class="sc">::</span><span class="fu">write_csv2</span>(</span>
<span id="cb1785-31"><a href="#cb1785-31" aria-hidden="true" tabindex="-1"></a>  resultado, <span class="st">&quot;tabela_para_SEMAD.csv&quot;</span></span>
<span id="cb1785-32"><a href="#cb1785-32" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p></p>
</div>
</div>
<div id="iterando-sobre-vários-inputs-simultaneamente" class="section level2" number="16.8">
<h2 number="16.8"><span class="header-section-number">16.8</span> Iterando sobre vários <em>input</em>’s simultaneamente</h2>
<p>A medida em que você vai ganhando familiaridade com a família <code>map</code> de funções, você vai sentir a necessidade de expandir ainda mais as suas funcionalidades. Parte dessa expansão, reside em aplicar o <em>loop</em> implícito sobre um número maior de <em>input</em>’s. Por esse motivo, o pacote <code>purrr</code> também nos oferece as famílias <code>map2</code> e <code>pmap</code> de funções.</p>
<div id="utilizando-dois-inputs" class="section level3" number="16.8.1">
<h3 number="16.8.1"><span class="header-section-number">16.8.1</span> Utilizando dois <em>input</em>’s</h3>
<p>Como o próprio nome dá a entender, a única diferença entre as famílias <code>map</code> e <code>map2</code>, é que as funções <code>map2</code> recebem 2 objetos (<code>.x</code> e <code>.y</code>) diferentes de <em>input</em>. Ou seja, as funções <code>map2</code> buscam aplicar a função <code>.f</code> sobre cada elemento de <code>.x</code> e de <code>.y</code> de forma simultânea. Em mais detalhes, cada elemento de <code>.x</code> é repassado como primeiro argumento de <code>.f</code>, enquanto cada elemento de <code>.y</code> é posicionado no segundo argumento de <code>.f</code>.</p>
<p>Vale destacar que o <em>loop</em> (criado pela função <code>map2</code> em questão) é aplicado de forma paralela sobre os objetos <code>.x</code> e <code>.y</code>. Ou seja, na primeira iteração, serão utilizados os elementos <code>.x[[1]]</code> e <code>.y[[1]]</code>, na segunda iteração, os elementos <code>.x[[2]]</code> e <code>.y[[2]]</code>, e assim por diante. A figura 16.9 abaixo, apresenta tal <em>loop</em> de maneira gráfica:</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/map2_simple.png" alt="Representação da tarefa executada pela função \texttt{map\_dbl()}" width="80%" />
<p class="caption">
(#fig:unnamed-chunk-941)Representação da tarefa executada pela função 
</p>
</div>
<p></p>
<p>Além disso, a família <code>map2</code> também tem um membro para cada estrutura de dado que você deseja retornar. Logo, a função <code>map2()</code> retorna uma lista, <code>map2_chr()</code>, um vetor do tipo <code>character</code>, <code>map2_dfr()</code>, um <code>data.frame</code>, e assim por diante.</p>
<p>Como exemplo, suponha que você tivesse os dois vetores (<code>x</code> e <code>y</code>) abaixo. Agora, suponha também que você desejasse compilar os menores números possíveis entre esses dois vetores. Ou seja, você deseja encontrar o menor número entre cada elemento de <code>x</code> e <code>y</code>. Você poderia realizar esse trabalho, através das funções <code>map2_int()</code> e <code>min()</code>, como demonstrado abaixo:</p>
<p></p>
<div class="sourceCode" id="cb1786"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1786-1"><a href="#cb1786-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(2L, 6L, 9L)</span>
<span id="cb1786-2"><a href="#cb1786-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">c</span>(1L, 7L, 4L)</span>
<span id="cb1786-3"><a href="#cb1786-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1786-4"><a href="#cb1786-4" aria-hidden="true" tabindex="-1"></a><span class="fu">map2_int</span>(x, y, min)</span></code></pre></div>
<pre><code>## [1] 1 6 4</code></pre>
<p></p>
<p>É importante frisar, que os objetos <code>.x</code> e <code>.y</code> precisam necessariamente ter o mesmo comprimento. Caso você não respeite essa regra, um erro será levantado pela função <code>map2</code> que você está utilizando.</p>
<p></p>
<div class="sourceCode" id="cb1788"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1788-1"><a href="#cb1788-1" aria-hidden="true" tabindex="-1"></a><span class="fu">map2</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, sum)</span></code></pre></div>
<p></p>
<pre><code># Error: Mapped vectors must have consistent lengths:
# * `.x` has length 2
# * `.y` has length 3</code></pre>
</div>
<div id="utilizando-n-inputs" class="section level3" number="16.8.2">
<h3 number="16.8.2"><span class="header-section-number">16.8.2</span> Utilizando <span class="math inline">\(n\)</span> <em>input</em>’s</h3>
<p>Se é possível utilizarmos 1 ou 2 <em>input</em>’s diferentes em uma função <code>map</code>, porque não permitirmos também um número arbitrário de <em>input</em>’s ? Esse é exatamente o objetivo que a família <code>pmap</code> de funções busca cumprir.</p>
<p>Assim como as demais famílias apresentadas até o momento, a família <code>pmap</code> também contém um membro para cada tipo de estrutura de dado que você deseja retornar. Sendo assim, <code>pmap_int()</code> retorna um vetor do tipo <code>integer</code>, enquanto <code>pmap()</code> retorna uma lista, e assim por diante.</p>
<p>Todavia, enquanto as funções <code>map</code> e <code>map2</code> podem receber um objeto qualquer em seus primeiros argumentos, uma função <code>pmap</code> recebe necessariamente uma lista (<code>.l</code>) em seu primeiro argumento. Essa lista deve conter todos os <em>input</em>’s sobre os quais você deseja aplicar o <em>loop</em>. Dito de outra forma, cada elemento dessa lista <code>.l</code> corresponde a um <em>input</em> diferente que será utilizado na função <code>.f</code>.</p>
<p>Isso significa que você deve armazenar todos os <em>input</em>’s (sobre os quais você deseja aplicar a função <code>.f</code>) dentro de uma lista, e, fornecer essa lista à função <code>pmap</code>. Apesar desse detalhe, uma função <code>pmap</code> aplica o <em>loop</em> de forma simultânea sobre todos os <em>input</em>’s (da mesma forma como ocorre com as funções <code>map</code> e <code>map2</code>).</p>
<p>Como resultado, se você fornece uma lista como <code>list(x, y, z)</code> à função <code>pmap</code>, na primeira iteração serão utilizados os elementos <code>x[[1]]</code>, <code>y[[1]]</code> e <code>z[[1]]</code>, já na segunda iteração, os elementos <code>x[[2]]</code>, <code>y[[2]]</code> e <code>z[[2]]</code>, e assim por diante. Esse processo está apresentado na figura 16.10 abaixo:</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/pmap_simple.png" alt="Representação da tarefa executada pela função \texttt{pmap\_dbl()}" width="100%" />
<p class="caption">
(#fig:unnamed-chunk-944)Representação da tarefa executada pela função 
</p>
</div>
<p></p>
<p>Perceba também pela figura 16.10, que os elementos da lista <code>.l</code> são fornecidos como argumentos para a função <code>.f</code>, de acordo com a posição que eles ocupam na lista. Sendo assim, o primeiro elemento da lista <code>.l</code> é fornecido como primeiro argumento de <code>.f</code>, enquanto o segundo elemento, como segundo argumento de <code>.f</code>, e assim por diante.</p>
<p>A função <code>pmap</code> realiza essa correspondência por posição sempre que você não dá um nome específico para cada elemento da lista. Como exemplo, a função <code>rnorm()</code> possui 3 argumentos (<code>n</code>, <code>mean</code> e <code>sd</code>). Caso eu nomeie os elementos da lista <code>.l</code> de acordo com esses 3 argumentos, eu posso reorganizar esses <em>input</em>’s dentro da lista <code>.l</code> da maneira que eu bem entender. Pois nesse caso, a função <code>pmap</code> em questão, vai conectar cada argumento da função aos nomes dos elementos da lista <code>.l</code>.</p>
<p>Como exemplo, repare abaixo, que o primeiro elemento da lista <code>args</code> foi corretamente associado ao argumento <code>mean</code>, mesmo que esse argumento não seja o primeiro argumento da função <code>rnorm()</code>.</p>
<p></p>
<div class="sourceCode" id="cb1790"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1790-1"><a href="#cb1790-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb1790-2"><a href="#cb1790-2" aria-hidden="true" tabindex="-1"></a>args <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb1790-3"><a href="#cb1790-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">mean =</span> <span class="fu">c</span>(<span class="dv">15</span>, <span class="dv">50</span>, <span class="dv">500</span>), <span class="at">n =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">5</span>), <span class="at">sd =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">5</span>)</span>
<span id="cb1790-4"><a href="#cb1790-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1790-5"><a href="#cb1790-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1790-6"><a href="#cb1790-6" aria-hidden="true" tabindex="-1"></a><span class="fu">pmap</span>(args, rnorm)</span></code></pre></div>
<pre><code>## [[1]]
## [1] 14.37355 15.18364
## 
## [[2]]
## [1] 49.16437 51.59528 50.32951
## 
## [[3]]
## [1] 495.8977 502.4371 503.6916 502.8789 498.4731</code></pre>
<p></p>
<p>Pelo fato de um <code>data.frame</code> ser essencialmente, uma lista nomeada que contém elementos de mesmo comprimento, podemos armazenar tranquilamente os nossos <em>input</em>’s em um <code>data.frame</code>, e fornecê-lo à função <code>pmap</code>.</p>
<p></p>
<div class="sourceCode" id="cb1792"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1792-1"><a href="#cb1792-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb1792-2"><a href="#cb1792-2" aria-hidden="true" tabindex="-1"></a>args <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb1792-3"><a href="#cb1792-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">mean =</span> <span class="fu">c</span>(<span class="dv">15</span>, <span class="dv">50</span>, <span class="dv">500</span>), </span>
<span id="cb1792-4"><a href="#cb1792-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">5</span>),</span>
<span id="cb1792-5"><a href="#cb1792-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">sd =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">5</span>)</span>
<span id="cb1792-6"><a href="#cb1792-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1792-7"><a href="#cb1792-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1792-8"><a href="#cb1792-8" aria-hidden="true" tabindex="-1"></a><span class="fu">pmap</span>(args, rnorm)</span></code></pre></div>
<pre><code>## [[1]]
## [1] 14.37355 15.18364
## 
## [[2]]
## [1] 49.16437 51.59528 50.32951
## 
## [[3]]
## [1] 495.8977 502.4371 503.6916 502.8789 498.4731</code></pre>
<p></p>
<p>Um outro detalhe, é que assim como todas as funções <code>map</code> e <code>map2</code> que vimos até o momento, <code>pmap</code> também possui o argumento especial <code>...</code> para repassar argumentos específicos para a função <code>.f</code>. Logo, todo argumento que você fornecer após o (ou à direita do) argumento <code>.f</code>, são argumentos que serão sempre repassados à função <code>.f</code> em cada iteração do <em>loop</em>. No exemplo abaixo, estamos repassando os argumentos <code>na.rm = TRUE</code> e <code>names = TRUE</code> em todas as chamadas à função <code>quantile()</code>.</p>
<p></p>
<div class="sourceCode" id="cb1794"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1794-1"><a href="#cb1794-1" aria-hidden="true" tabindex="-1"></a>args <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb1794-2"><a href="#cb1794-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>)</span>
<span id="cb1794-3"><a href="#cb1794-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1794-4"><a href="#cb1794-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1794-5"><a href="#cb1794-5" aria-hidden="true" tabindex="-1"></a>dists <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb1794-6"><a href="#cb1794-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="cn">NA</span>, <span class="fl">2.5</span>, <span class="fl">8.1</span>, <span class="fl">3.9</span>),</span>
<span id="cb1794-7"><a href="#cb1794-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="fl">42.2</span>, <span class="cn">NA</span>, <span class="fl">93.2</span>, <span class="fl">35.1</span>),</span>
<span id="cb1794-8"><a href="#cb1794-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="fl">0.9</span>, <span class="fl">27.1</span>, <span class="fl">5.3</span>, <span class="cn">NA</span>)</span>
<span id="cb1794-9"><a href="#cb1794-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1794-10"><a href="#cb1794-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1794-11"><a href="#cb1794-11" aria-hidden="true" tabindex="-1"></a>args<span class="sc">$</span>x <span class="ot">&lt;-</span> dists</span>
<span id="cb1794-12"><a href="#cb1794-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1794-13"><a href="#cb1794-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1794-14"><a href="#cb1794-14" aria-hidden="true" tabindex="-1"></a><span class="fu">pmap</span>(args, quantile, <span class="at">na.rm =</span> <span class="cn">TRUE</span>, <span class="at">names =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## [[1]]
## 25% 
## 3.2 
## 
## [[2]]
##  50% 
## 42.2 
## 
## [[3]]
##  75% 
## 16.2</code></pre>
<p></p>
</div>
</div>
<div id="a-família-walk" class="section level2" number="16.9">
<h2 number="16.9"><span class="header-section-number">16.9</span> A família <code>walk()</code></h2>
<p>O pacote <code>purrr</code>, também nos oferece a família <code>walk</code> de funções, a qual é composta por apenas três membros: <code>walk()</code>, <code>walk2()</code> e <code>pwalk()</code>. Em resumo, as funções <code>walk</code> funcionam da mesma maneira que as funções <code>map</code>, contudo, elas não retornam, por padrão, algum resultado para o usuário.</p>
<p>Em mais detalhes, as funções <code>walk</code> constroem o <em>loop</em> implícito e aplicam a função <code>.f</code> sobre cada elemento dos objetos de <em>input</em>. Porém, essas funções não coletam os resultados gerados pela função <code>.f</code> a cada iteração, até porque, uma função <code>walk</code> tem como pressuposto, que a função <code>.f</code> não retorna nenhum resultado.</p>
<p>Por esse motivo, você geralmente utiliza a família <code>walk</code>, quando você deseja aplicar o mesmo <em>loop</em> implícito da família <code>map</code>, mas não está preocupado em coletar os resultados gerados. Ou ainda, quando a função <code>.f</code> que você deseja aplicar, não retorna um resultado por padrão, e sim, imprime alguma informação em seu console, ou altera objetos, configurações e <em>environments</em> presentes em sua sessão. No exemplo abaixo, estou aplicando a função <code>print()</code> sobre cada elemento de <code>l</code>.</p>
<p></p>
<div class="sourceCode" id="cb1796"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1796-1"><a href="#cb1796-1" aria-hidden="true" tabindex="-1"></a>l <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>)</span>
<span id="cb1796-2"><a href="#cb1796-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1796-3"><a href="#cb1796-3" aria-hidden="true" tabindex="-1"></a><span class="fu">walk</span>(l, print)</span></code></pre></div>
<pre><code>## [1] 1
## [1] 2
## [1] 3
## [1] 4</code></pre>
<p></p>
<p>Como você já deve ter inferido, a função <code>walk()</code> aceita um objeto (<code>.x</code>) de <em>input</em> e uma função <code>.f</code>, enquanto a função <code>walk2()</code> aceita dois objetos (<code>.x</code> e <code>.y</code>) de <em>input</em> e uma função <code>.f</code>. Já a função <code>pwalk()</code> aceita uma lista (<code>.l</code>) contendo <span class="math inline">\(n\)</span> objetos de <em>input</em>, além de uma função <code>.f</code>. Assim como as demais funções que vimos ao longo desse capítulo, essas três funções também possuem o argumento especial <code>...</code>, com o qual podemos repassar argumentos para a função <code>.f</code> em todas as chamadas executadas.</p>
</div>
<div id="agregando-resultados-com-reduce" class="section level2" number="16.10">
<h2 number="16.10"><span class="header-section-number">16.10</span> Agregando resultados com <code>reduce()</code></h2>
<p>Em algumas ocasiões, você tem uma lista complexa que você deseja reduzir para uma lista mais simples <span class="citation">(<a href="#ref-wickham2017" role="doc-biblioref">Wickham and Grolemund 2017</a>)</span>. É em momentos como esse, que as funções <code>Reduce()</code> e <code>purrr::reduce()</code> se tornam extremamente úteis. Ambas as funções realizam exatamente o mesmo trabalho. A diferença entre elas, é que a função <code>Reduce()</code> pertence aos pacotes básicos do R, enquanto <code>reduce()</code> advém do pacote <code>purrr</code>.</p>
<p>Você possivelmente já conhece o termo <em>reduce</em>, especialmente se você já trabalhou com alguma outra linguagem de programação focada no paradigma FP. Mas esse termo também é muito associado ao modelo <em>MapReduce</em> que é comumente utilizado em ferramentas para processamento de <em>BigData</em>.</p>
<p>Em resumo, <code>reduce()</code> busca combinar todos os elementos de um objeto em um único valor. Ou seja, de certa forma, essa função <code>reduce()</code> calcula uma “agregação” dos elementos de um objeto. Esse processo combinatório de <code>reduce()</code> é uma operação bastante comum em diversos tipos de computação. Por isso, várias linguagens de programação oferecem uma função parecida com <code>reduce()</code>. Um exemplo é o método <code>functools.reduce()</code> da linguagem Python.</p>
<p>A forma como <code>reduce()</code> conduz essa combinação é na realidade, bastante simples. Considerando um objeto que possua 4 elementos como exemplo, <code>reduce()</code> vai primeiro, aplicar a função <code>.f</code> sobre os elementos 1 e 2, produzindo o resultado <code>r1</code>; em seguida, ela aplica novamente a função <code>.f</code> sobre o resultado anterior (<code>r1</code>) e o elemento 3, produzindo assim, o resultado <code>r2</code>; em seguida, ela aplica a função <code>.f</code> sobre o resultado anterior (<code>r2</code>), e o elemento 4, produzindo assim, o resultado final <code>r3</code>, que contém dentro de si, um resumo de todos os 4 elementos do objeto. Descrevendo de outra forma, o resultado de uma expressão como <code>reduce(1:4, f)</code> seria <code>f(f(f(1, 2), 3), 4)</code>. Tal processo de combinação está apresentado de maneira gráfica na figura 16.11 abaixo:</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/reduce.png" alt="Representação da combinação executada por `reduce()`" width="90%" />
<p class="caption">
(#fig:unnamed-chunk-949)Representação da combinação executada por <code>reduce()</code>
</p>
</div>
<p></p>
<p>Um dos exemplos mais clássicos de uso da função <code>reduce()</code> ao longo de várias linguagens de programação, seria o cálculo de uma soma vetorizada. Ou seja, através da função <code>reduce()</code> conseguimos reproduzir a mesma funcionalidade da função <code>sum()</code>. No exemplo abaixo, a função <code>reduce()</code> está calculando o valor da expressão <code>(((1+2)+3)+4)+5</code>, que é basicamente o mesmo cálculo de <code>sum(1:5)</code>.</p>
<p></p>
<div class="sourceCode" id="cb1798"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1798-1"><a href="#cb1798-1" aria-hidden="true" tabindex="-1"></a><span class="fu">reduce</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="st">`</span><span class="at">+</span><span class="st">`</span>)</span></code></pre></div>
<pre><code>## [1] 15</code></pre>
<div class="sourceCode" id="cb1800"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1800-1"><a href="#cb1800-1" aria-hidden="true" tabindex="-1"></a><span class="do">## O mesmo cálculo:</span></span>
<span id="cb1800-2"><a href="#cb1800-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)</span></code></pre></div>
<pre><code>## [1] 15</code></pre>
<p></p>
<p>Com esse exemplo em mente, podemos expandi-lo com facilidade para as demais operações aritméticas, como multiplicação, potência e divisão:</p>
<p></p>
<div class="sourceCode" id="cb1802"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1802-1"><a href="#cb1802-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Multiplicação:</span></span>
<span id="cb1802-2"><a href="#cb1802-2" aria-hidden="true" tabindex="-1"></a><span class="fu">reduce</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="st">`</span><span class="at">*</span><span class="st">`</span>)</span></code></pre></div>
<pre><code>## [1] 120</code></pre>
<div class="sourceCode" id="cb1804"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1804-1"><a href="#cb1804-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Divisão:</span></span>
<span id="cb1804-2"><a href="#cb1804-2" aria-hidden="true" tabindex="-1"></a><span class="fu">reduce</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="st">`</span><span class="at">/</span><span class="st">`</span>)</span></code></pre></div>
<pre><code>## [1] 0.008333333</code></pre>
<div class="sourceCode" id="cb1806"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1806-1"><a href="#cb1806-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Potência:</span></span>
<span id="cb1806-2"><a href="#cb1806-2" aria-hidden="true" tabindex="-1"></a><span class="fu">reduce</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="st">`</span><span class="at">^</span><span class="st">`</span>)</span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<p></p>
<p>Um outro exemplo em que <code>reduce()</code> se torna extremamente útil, seria quando desejamos unir vários <code>data.frame</code>’s através de <em>join</em>’s (os quais apresentamos no capítulo 6). Fica meio chato, escrevermos vários <em>join</em>’s separados para unirmos todas essas tabelas, e a função <code>reduce()</code> oferece uma maneira elegante e eficiente de resumirmos essa operação.</p>
<p></p>
<div class="sourceCode" id="cb1808"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1808-1"><a href="#cb1808-1" aria-hidden="true" tabindex="-1"></a>dias <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb1808-2"><a href="#cb1808-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">dia =</span> <span class="fu">seq.Date</span>(<span class="fu">as.Date</span>(<span class="st">&quot;2021-12-01&quot;</span>), <span class="fu">as.Date</span>(<span class="st">&quot;2021-12-10&quot;</span>), <span class="at">by =</span> <span class="st">&quot;1 day&quot;</span>)</span>
<span id="cb1808-3"><a href="#cb1808-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1808-4"><a href="#cb1808-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1808-5"><a href="#cb1808-5" aria-hidden="true" tabindex="-1"></a>savassi <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb1808-6"><a href="#cb1808-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">dia =</span> <span class="fu">c</span>(<span class="fu">as.Date</span>(<span class="st">&quot;2021-12-01&quot;</span>), <span class="fu">as.Date</span>(<span class="st">&quot;2021-12-03&quot;</span>), <span class="fu">as.Date</span>(<span class="st">&quot;2021-12-05&quot;</span>)),</span>
<span id="cb1808-7"><a href="#cb1808-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">vendas_savassi =</span> <span class="fu">c</span>(<span class="dv">1200</span>, <span class="dv">4500</span>, <span class="dv">3400</span>)</span>
<span id="cb1808-8"><a href="#cb1808-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1808-9"><a href="#cb1808-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1808-10"><a href="#cb1808-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1808-11"><a href="#cb1808-11" aria-hidden="true" tabindex="-1"></a>centro <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb1808-12"><a href="#cb1808-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">dia =</span> <span class="fu">c</span>(</span>
<span id="cb1808-13"><a href="#cb1808-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.Date</span>(<span class="st">&quot;2021-12-02&quot;</span>), <span class="fu">as.Date</span>(<span class="st">&quot;2021-12-03&quot;</span>), <span class="fu">as.Date</span>(<span class="st">&quot;2021-12-04&quot;</span>),</span>
<span id="cb1808-14"><a href="#cb1808-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.Date</span>(<span class="st">&quot;2021-12-05&quot;</span>), <span class="fu">as.Date</span>(<span class="st">&quot;2021-12-07&quot;</span>), <span class="fu">as.Date</span>(<span class="st">&quot;2021-12-10&quot;</span>)</span>
<span id="cb1808-15"><a href="#cb1808-15" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1808-16"><a href="#cb1808-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">vendas_centro =</span> <span class="fu">c</span>(<span class="dv">2400</span>, <span class="dv">3600</span>, <span class="dv">3100</span>, <span class="dv">1400</span>, <span class="dv">1500</span>, <span class="dv">2700</span>)</span>
<span id="cb1808-17"><a href="#cb1808-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1808-18"><a href="#cb1808-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1808-19"><a href="#cb1808-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1808-20"><a href="#cb1808-20" aria-hidden="true" tabindex="-1"></a>barreiro <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb1808-21"><a href="#cb1808-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">dia =</span> <span class="fu">c</span>(</span>
<span id="cb1808-22"><a href="#cb1808-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.Date</span>(<span class="st">&quot;2021-12-07&quot;</span>), <span class="fu">as.Date</span>(<span class="st">&quot;2021-12-08&quot;</span>), <span class="fu">as.Date</span>(<span class="st">&quot;2021-12-09&quot;</span>)</span>
<span id="cb1808-23"><a href="#cb1808-23" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1808-24"><a href="#cb1808-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">vendas_barreiro =</span> <span class="fu">c</span>(<span class="dv">5400</span>, <span class="dv">4500</span>, <span class="dv">8700</span>)</span>
<span id="cb1808-25"><a href="#cb1808-25" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1808-26"><a href="#cb1808-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1808-27"><a href="#cb1808-27" aria-hidden="true" tabindex="-1"></a><span class="do">### Unindo todas essas tabelas através de um FULL JOIN:</span></span>
<span id="cb1808-28"><a href="#cb1808-28" aria-hidden="true" tabindex="-1"></a><span class="fu">reduce</span>(<span class="fu">list</span>(dias, savassi, centro, barreiro), full_join, <span class="at">by =</span> <span class="st">&quot;dia&quot;</span>)</span></code></pre></div>
<pre><code>##           dia vendas_savassi vendas_centro vendas_barreiro
## 1  2021-12-01           1200            NA              NA
## 2  2021-12-02             NA          2400              NA
## 3  2021-12-03           4500          3600              NA
## 4  2021-12-04             NA          3100              NA
## 5  2021-12-05           3400          1400              NA
## 6  2021-12-06             NA            NA              NA
## 7  2021-12-07             NA          1500            5400
## 8  2021-12-08             NA            NA            4500
## 9  2021-12-09             NA            NA            8700
## 10 2021-12-10             NA          2700              NA</code></pre>
<p></p>
<p>Apesar da praticidade de <code>reduce()</code>, é importante que você conheça muito bem a operação que você está aplicando sobre os elementos. Pois a depender da forma como essa operação é realizada, a direção do processo combinatório realizado por <code>reduce()</code> pode te levar a diferentes resultados.</p>
<p>Como um primeiro exemplo, quando aplicamos o operador de potenciação (<code>^</code>) sobre o vetor <code>1:4</code>, o resultado gerado por <code>reduce()</code> é de 1. Pois a função calculou o valor da expressão <code>(((1^2)^3)^4)</code>. Ou seja, estamos elevando repetidamente 1 a um determinado número, e 1 elevado a qualquer coisa é sempre igual a 1.</p>
<p></p>
<div class="sourceCode" id="cb1810"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1810-1"><a href="#cb1810-1" aria-hidden="true" tabindex="-1"></a><span class="fu">reduce</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="st">`</span><span class="at">^</span><span class="st">`</span>)</span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<p></p>
<p>Se invertermos a ordem da combinação (através do argumento <code>.dir</code>), o mesmo resultado é retornado. Pois dessa forma, <code>reduce()</code> está calculando o valor da expressão <code>(1^(2^(3^4)))</code>. Ou seja, no fim das contas, ainda estamos elevando 1 a um número gigantesco.</p>
<p></p>
<div class="sourceCode" id="cb1812"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1812-1"><a href="#cb1812-1" aria-hidden="true" tabindex="-1"></a><span class="fu">reduce</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="st">`</span><span class="at">^</span><span class="st">`</span>, <span class="at">.dir =</span> <span class="st">&quot;backward&quot;</span>)</span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<p>
Entretanto, não se engane por esse caso especial, ou por essa exceção à regra. Pois o resultado da operação de potenciação depende sim da ordem em que os elementos são combinados. Podemos enxergar isso, ao retirarmos o número 1 dessa expressão. Portanto, as expressões <code>((2^3)^4)</code> e <code>(2^(3^4))</code>, calculadas abaixo por <code>reduce()</code>, geram resultados diferentes, pois elas resultam em <span class="math inline">\(8^4\)</span> e <span class="math inline">\(2^{81}\)</span> (respectivamente).</p>
<p></p>
<div class="sourceCode" id="cb1814"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1814-1"><a href="#cb1814-1" aria-hidden="true" tabindex="-1"></a><span class="fu">reduce</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>, <span class="st">`</span><span class="at">^</span><span class="st">`</span>)</span></code></pre></div>
<pre><code>## [1] 4096</code></pre>
<div class="sourceCode" id="cb1816"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1816-1"><a href="#cb1816-1" aria-hidden="true" tabindex="-1"></a><span class="fu">reduce</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>, <span class="st">`</span><span class="at">^</span><span class="st">`</span>, <span class="at">.dir =</span> <span class="st">&quot;backward&quot;</span>)</span></code></pre></div>
<pre><code>## [1] 2.417852e+24</code></pre>
<p></p>
<p>Como um segundo exemplo, perceba que a estrutura das listas <code>a</code> e <code>b</code> abaixo são diferentes, mesmo que ambas tenham sido construídas com base no mesmo objeto (<code>1:4</code>) e função (<code>list</code>).</p>
<p></p>
<div class="sourceCode" id="cb1818"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1818-1"><a href="#cb1818-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">reduce</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, list)</span>
<span id="cb1818-2"><a href="#cb1818-2" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">reduce</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, list, <span class="at">.dir =</span> <span class="st">&quot;backward&quot;</span>)</span>
<span id="cb1818-3"><a href="#cb1818-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1818-4"><a href="#cb1818-4" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(a)</span></code></pre></div>
<pre><code>## List of 2
##  $ :List of 2
##   ..$ :List of 2
##   .. ..$ : int 1
##   .. ..$ : int 2
##   ..$ : int 3
##  $ : int 4</code></pre>
<div class="sourceCode" id="cb1820"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1820-1"><a href="#cb1820-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(b)</span></code></pre></div>
<pre><code>## List of 2
##  $ : int 1
##  $ :List of 2
##   ..$ : int 2
##   ..$ :List of 2
##   .. ..$ : int 3
##   .. ..$ : int 4</code></pre>
<p></p>
<p>Sendo assim, a depender da função que você está aplicando através de <code>reduce()</code>, você terá que inverter a ordem da combinação através do argumento <code>.dir</code>, para chegar ao resultado que você deseja.</p>
</div>
<div id="acumulando-resultados-com-accumulate" class="section level2" number="16.11">
<h2 number="16.11"><span class="header-section-number">16.11</span> Acumulando resultados com <code>accumulate()</code></h2>
<p>Se podemos combinar os diversos resultados gerados para produzir um único valor, também podemos “acumular” esses resultados, através da função <code>accumulate()</code>. Esse processo é um pouco diferente, pois, ao invés de produzir um único valor, ele acaba produzindo um novo objeto de mesmo comprimento que o objeto de <em>input</em>. Contudo, esse processo ainda herda parte da metodologia combinatória empregada por <code>reduce()</code>.</p>
<p>Como exemplo, quando utilizamos <code>accumulate()</code> para aplicar o operador de soma (<code>+</code>) sobre o vetor <code>1:4</code>, o resultado é a soma acumulada do vetor. Ou seja, a expressão abaixo é equivalente à expressão <code>cumsum(1:4)</code>.</p>
<p></p>
<div class="sourceCode" id="cb1822"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1822-1"><a href="#cb1822-1" aria-hidden="true" tabindex="-1"></a><span class="fu">accumulate</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="st">`</span><span class="at">+</span><span class="st">`</span>)</span></code></pre></div>
<pre><code>## [1]  1  3  6 10</code></pre>
<p></p>
<p>Com esse exemplo, podemos entender um pouco melhor o que <code>accumulate()</code> faz. Em resumo, <code>accumulate()</code> aplica o mesmo processo combinatório de <code>reduce()</code>, porém, ele armazena cada resultado gerado ao longo do processo. A figura 16.12 abaixo, traz uma representação do processo executado por <code>accumulate()</code>.</p>
<p>Perceba nessa figura, que para retornar um novo objeto de mesmo comprimento que o objeto de <em>input</em>, <code>accumulate()</code> precisa gerar um resultado para cada elemento deste objeto. Devido a essa regra, na primeira iteração, <code>accumulate()</code> precisa aplicar a função <code>.f</code> somente sobre o primeiro elemento do objeto de <em>input</em>, para nas próximas iterações, aplicar a função <code>.f</code> em pares.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/accumulate.png" alt="Representação da tarefa executada por `accumulate()`" width="100%" />
<p class="caption">
(#fig:unnamed-chunk-958)Representação da tarefa executada por <code>accumulate()</code>
</p>
</div>
<p></p>
<p>Caso <code>accumulate()</code> não fizesse esse passo na primeira iteração, a função nos retornaria um novo objeto de <span class="math inline">\(n-1\)</span> elementos, para um objeto de <em>input</em> de <span class="math inline">\(n\)</span> elementos. O que desrespeitaria a regra de mesmo comprimento entre o <em>input</em> e <em>output</em> da função.</p>
<p>Descrevendo ainda de uma outra forma, a expressão <code>accumulate(1:4, f)</code> resulta em um vetor de 4 elementos, onde o primeiro elemento contém o resultado de <code>f(1)</code>; o segundo elemento, de <code>f(f(1),2)</code>; o terceiro elemento, de <code>f(f(f(1),2),3)</code>; e o quarto elemento, de <code>f(f(f(f(1),2),3),4)</code>.</p>
<p>Assim como ocorre em <code>reduce()</code>, <code>accumulate()</code> também possui um argumento <code>.dir</code> que define a direção do processo combinatório. Ao invertermos a ordem desse processo, os 4 elementos do vetor resultante da expressão <code>accumulate(1:4, f)</code> conteriam os resultados das expressões <code>f(f(f(f(4),3),2),1)</code>, <code>f(f(f(4),3),2)</code>, <code>f(f(4),3)</code> e <code>f(4)</code>, respectivamente.</p>
<p></p>
<div class="sourceCode" id="cb1824"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1824-1"><a href="#cb1824-1" aria-hidden="true" tabindex="-1"></a><span class="fu">accumulate</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="st">`</span><span class="at">+</span><span class="st">`</span>, <span class="at">.dir =</span> <span class="st">&quot;backward&quot;</span>)</span></code></pre></div>
<pre><code>## [1] 10  9  7  4</code></pre>
<p></p>
</div>
<div id="exercícios-12" class="section level2 unnumbered">
<h2 class="unnumbered">Exercícios</h2>
<p><strong>Questão 16.1.</strong> Os itens dessa questão foram inspirados em um exercício da obra de . Considerando a tabela <code>diamonds</code> do pacote <code>ggplot2</code> (lembre-se que você pode acessar essa tabela através do comando <code>ggplot2::diamonds</code>), utilize as funções da família <code>map()</code> para calcular:</p>
<p>16.1.A) A média de todas as colunas numéricas.</p>
<p>16.1.B) O número de valores distintos em todas as colunas não numéricas.</p>
<p><strong>Questão 16.2.</strong> Os itens dessa questão foram retirados de um exercício da obra de .</p>
<p>16.2.A) Tente explicar com suas palavras, o que exatamente o comando abaixo está fazendo. Porque cada elemento da lista resultante contém cada vez mais elementos?</p>
<p></p>
<div class="sourceCode" id="cb1826"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1826-1"><a href="#cb1826-1" aria-hidden="true" tabindex="-1"></a><span class="fu">map</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, rnorm)</span></code></pre></div>
<pre><code>## [[1]]
## [1] 1.511781
## 
## [[2]]
## [1]  0.3898432 -0.6212406
## 
## [[3]]
## [1] -2.21469989  1.12493092 -0.04493361
## 
## [[4]]
## [1] -0.01619026  0.94383621  0.82122120  0.59390132
## 
## [[5]]
## [1]  0.91897737  0.78213630  0.07456498 -1.98935170  0.61982575</code></pre>
<p></p>
<p>16.2.B) Considerando o comando abaixo, o que exatamente ele está fazendo de diferente do comando mostrado no item anterior? Porque o resultado é diferente?</p>
<p></p>
<div class="sourceCode" id="cb1828"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1828-1"><a href="#cb1828-1" aria-hidden="true" tabindex="-1"></a><span class="fu">map</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, rnorm, <span class="at">n =</span> <span class="dv">5</span>)</span></code></pre></div>
<pre><code>## [[1]]
## [1]  0.9438713  0.8442045 -0.4707524  0.5218499  1.4179416
## 
## [[2]]
## [1] 3.3586796 1.8972123 2.3876716 1.9461950 0.6229404
## 
## [[3]]
## [1] 2.585005 2.605710 2.940687 4.100025 3.763176
## 
## [[4]]
## [1] 3.835476 3.746638 4.696963 4.556663 3.311244
## 
## [[5]]
## [1] 4.292505 5.364582 5.768533 4.887654 5.881108</code></pre>
<p></p>
<p><strong>Questão 16.3.</strong> Em cada item abaixo, você deve utilizar uma das funções <code>map</code> para aplicar um teste lógico sobre os elementos de uma lista e, filtrar os elementos dessa lista de acordo com os resultados desse teste lógico.</p>
<p>16.3.A) Considerando a lista <code>l</code> abaixo, utilize uma das funções <code>map</code> para descobrir que elementos de <code>l</code> possuem comprimento maior que 3.</p>
<p></p>
<div class="sourceCode" id="cb1830"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1830-1"><a href="#cb1830-1" aria-hidden="true" tabindex="-1"></a>l <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb1830-2"><a href="#cb1830-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">5</span>),</span>
<span id="cb1830-3"><a href="#cb1830-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">1</span>),</span>
<span id="cb1830-4"><a href="#cb1830-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="dv">9</span>, <span class="dv">8</span>, <span class="dv">9</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb1830-5"><a href="#cb1830-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="dv">7</span>, <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">2</span>),</span>
<span id="cb1830-6"><a href="#cb1830-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">5</span>)</span>
<span id="cb1830-7"><a href="#cb1830-7" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p></p>
<p>16.3.B) Elimine todos os elementos da lista <code>l</code> abaixo, que possuem pelo menos um valor <code>NA</code>.</p>
<p></p>
<div class="sourceCode" id="cb1831"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1831-1"><a href="#cb1831-1" aria-hidden="true" tabindex="-1"></a>l <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb1831-2"><a href="#cb1831-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>),</span>
<span id="cb1831-3"><a href="#cb1831-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="dv">6</span>, <span class="dv">7</span>, <span class="cn">NA</span>, <span class="dv">9</span>),</span>
<span id="cb1831-4"><a href="#cb1831-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="cn">NA</span>, <span class="cn">NA</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">4</span>),</span>
<span id="cb1831-5"><a href="#cb1831-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">8</span>),</span>
<span id="cb1831-6"><a href="#cb1831-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="dv">6</span>, <span class="dv">6</span>, <span class="dv">6</span>)</span>
<span id="cb1831-7"><a href="#cb1831-7" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p></p>
<!--chapter:end:18-purrr.Rmd-->
</div>
</div>
<div id="debugging---resolvendo-bugs-em-suas-funções" class="section level1" number="17">
<h1 number="17"><span class="header-section-number">17</span> <em>Debugging</em> - Resolvendo <em>bugs</em> em suas funções</h1>
<div id="introduzindo-debugging" class="section level2" number="17.1">
<h2 number="17.1"><span class="header-section-number">17.1</span> Introduzindo <em>debugging</em></h2>
<p>Em nosso dia-a-dia, desenvolvemos vários <em>scripts</em> e funções no R, com o objetivo de formar um programa que executa uma tarefa específica. Temos uma sensação de conquista quando conseguimos desenvolver esse programa, e estamos ansiosos para testá-lo pela primeira vez. Criamos a expectativa de que o programa funcione perfeitamente bem, gerando todos os resultados esperados. Porém, no mundo real, quando executamos pela primeira vez o nosso programa, o que ocorre na maioria das vezes são vários erros distintos.</p>
<p>Essa é uma situação extremamente comum, que ocorre em qualquer linguagem de programação, e que atinge desde os mais novatos até os mais experientes programadores. Quanto mais experiência você possui em uma determinada linguagem, menor tendem a ser as suas taxas de erros. Contudo, essas taxas nunca chegam efetivamente a zero.</p>
<p>Pois é sempre muito fácil de se esquecer de uma vírgula aqui ou ali, de fechar um parêntese ou chave, ou ainda, de se certificar que os seus objetos estejam corretamente definidos. Além desses fatos, computadores são extremamente precisos, e, por esse motivo, conseguem perceber facilmente quando algo está fora do lugar.</p>
<p>Sendo assim, um erro é a forma que seu computador tem de te indicar que há algo de errado em seu programa. Logo, em alguma parte desse programa, você pode não ter sido claro o suficiente com suas intenções, ou ainda, você pode ter tentado fazer algo que não é possível de ser feito.</p>
<p>O termo <em>debugging</em> se refere ao ato de analisar, identificar e corrigir as fontes desses erros em nossos programas. Já o termo <em>bug</em> é o nome dado à um erro qualquer em seu programa. Logo, o seu programa pode ter um ou vários <em>bugs</em> (ou erros) diferentes. O seu trabalho é analisar cada um desses <em>bugs</em> e corrigi-los. Nas próximas seções vamos descrever algumas estratégias de <em>debugging</em>.</p>
<p>É comum certos <em>bugs</em> estarem relacionados entre si, de modo que, quando você identifica e corrige um deles, todos os demais <em>bugs</em> são automaticamente solucionados. Porém, uma parte considerável dos <em>bugs</em> podem ser independentes entre si. Nessa situação, você é obrigado a identificar e corrigir individualmente cada um deles.</p>
</div>
<div id="tente-sempre-melhorar-a-organização-de-seu-programa" class="section level2" number="17.2">
<h2 number="17.2"><span class="header-section-number">17.2</span> Tente sempre melhorar a organização de seu programa</h2>
<p><em>Bugs</em> são sempre muito difíceis de se evitar. Especialmente quando estamos construindo um programa relativamente grande e complexo. Mesmo assim, temos sempre a oportunidade de adotarmos pequenas ações que nos ajudam a identificar e resolver esses <em>bugs</em> no futuro.</p>
<p>Uma dessas ações é sempre se preocupar com a organização de seu programa. Um programa (ou um <em>script</em>) é melhor organizado quando ele é repartido em várias funções pequenas. Cada função pequena executa uma única tarefa e, tenta incluir apenas os comandos mínimos para executar essa tarefa.</p>
<p>Dessa forma, você tem uma chance muito maior de compreender por completo, como o seu programa funciona e, mais importante ainda, você tem uma facilidade muito maior de identificar onde os erros de seu programa estão localizados.</p>
<p>Vamos para um exemplo prático. David Brahm e Greg Snow construíram um pacote no R, chamado <code>sudoku</code>, o qual é capaz de resolver jogos de sudoku. A função <code>playSudoku()</code> é a principal função desse pacote. Você fornece a ela uma matriz contendo os valores iniciais de seu jogo e, como resultado, a função vai resolver esse jogo para você.</p>
<p>Porém, perceba no exemplo abaixo, que um erro foi retornado ao fornecer o meu jogo à função.</p>
<p></p>
<div class="sourceCode" id="cb1832"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1832-1"><a href="#cb1832-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sudoku)</span>
<span id="cb1832-2"><a href="#cb1832-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1832-3"><a href="#cb1832-3" aria-hidden="true" tabindex="-1"></a><span class="fu">playSudoku</span>(</span>
<span id="cb1832-4"><a href="#cb1832-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">z =</span> <span class="fu">matrix</span>(<span class="fu">sample</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">9</span>, <span class="at">size =</span> <span class="dv">9</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>))</span>
<span id="cb1832-5"><a href="#cb1832-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p></p>
<pre><code>Solving...Error in z[i, j] : subscript out of bounds</code></pre>
<p>Ao pesquisar pelo erro no Google, você pode chegar a um artigo útil do StackOverflow<a href="#fn43" class="footnote-ref" id="fnref43"><sup>43</sup></a>. Esse artigo descreve que o erro <em>subscript out of bounds</em> ocorre sempre que tentamos acessar um elemento que está fora dos limites de um objeto (em outras palavras, um elemento que não existe nesse objeto). Por exemplo, quando tentamos acessar o 5° elemento de um vetor que possui apenas 4 elementos, ou a 5° coluna de um <code>data.frame</code> que possui apenas 3 colunas, e assim por diante.</p>
<p>Apesar dessa informação ser útil, ainda temos uma questão fundamental para identificar e corrigir esse erro, que é <strong>onde ele ocorre</strong>. Onde? Em que função? Em que parte específica da função estamos tentando acessar um elemento que está fora dos limites?</p>
<p>Como primeiro instinto, você talvez tente compreender o código-fonte da função <code>playSudoku()</code> com o comando <code>sudoku::playSudoku</code>. Porém, você vai rapidamente perceber o quão grande é essa função <code>playSudoku()</code>. Temos uma quantidade enorme de comandos sendo executados dentro dela, e, cada um desses vários comandos podem ser a fonte de nosso erro.</p>
<p>Ao traçar o <em>traceback</em> que levou ao erro, como demonstrado abaixo, você pode identificar que o erro na verdade surgiu dentro da função <code>solveSudoku()</code>, que é executada pela função <code>playSudoku()</code>.</p>
<p></p>
<div class="sourceCode" id="cb1834"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1834-1"><a href="#cb1834-1" aria-hidden="true" tabindex="-1"></a><span class="fu">traceback</span>()</span></code></pre></div>
<p></p>
<pre><code>## 2: solveSudoku(z, print.it = FALSE)
## 1: sudoku::playSudoku(z = matrix(sample(0:9, size = 9, replace = TRUE)))</code></pre>
<p>Apesar de útil, essa nova informação também não é de grande ajuda. Pois ao observar o código-fonte da função <code>solveSudoku()</code> com o comando <code>sudoku::solveSudoku</code>, você percebe que essa função também é muito grande! Temos novamente várias possibilidades para a fonte de nosso erro.</p>
<p>Você já sabe que o nosso erro geralmente ocorre quando estamos tentando acessar um elemento de um objeto, ou seja, quando estamos utilizando <em>subsetting</em> sobre um objeto. Tendo isso em mente, você talvez pense em procurar no código-fonte de <code>solveSudoku()</code>, por todas as partes em que as funções de <em>subsetting</em> (<code>[</code> e <code>[[</code>) são utilizadas. Pois essas partes são as potenciais fontes do erro.</p>
<p>Contudo, temos uma nova frustração. Pois existem em torno de 35 chamadas diferentes à essas funções no código-fonte de <code>solveSudoku()</code>. Em qual dessas 35 chamadas, o nosso erro ocorre?</p>
<p>Concluindo, o problema principal destacado aqui, é que as funções <code>playSudoku()</code> e <code>solveSudoku()</code> são muito grandes. Elas tentam abarcar sozinhas uma parte substancial do programa, e, como consequência disso, temos uma dificuldade muito maior de identificarmos as origens de nossos erros. O ideal, seria que cada etapa fosse quebrada em múltiplas funções pequenas.</p>
<p>Pois se um erro surgir dentro de uma função pequena, você tem um conjunto muito menor de comandos para analisar. Em outras palavras, você tem menos possibilidades para a fonte de seu erro.</p>
<p>Por outro lado, quando os seus erros surgem dentro de uma função muito grande, cada um dos vários e vários comandos que essa função executa são candidatos para a origem do seu erro. Logo, você tem o trabalho de analisar um conjunto muito maior de possibilidades.</p>
</div>
<div id="uma-boa-estratégia-de-debugging" class="section level2" number="17.3">
<h2 number="17.3"><span class="header-section-number">17.3</span> Uma boa estratégia de debugging</h2>
<p>Segundo <span class="citation"><a href="#ref-wickham2015_advanced" role="doc-biblioref">Wickham</a> (<a href="#ref-wickham2015_advanced" role="doc-biblioref">2015a</a>)</span>, encontrar a causa raiz de um <em>bug</em> é sempre um processo desafiador. Por isso, ter uma boa estratégia de <em>debugging</em> é sempre uma boa ajuda nesse processo. O autor dita 4 passos essenciais nessa estratégia, que são:</p>
<ul>
<li><p><strong>Google:</strong> sempre que encontrar um erro, tente primeiro pesquisar por ele no Google. Pois outras pessoas podem ter enfrentado esse mesmo erro anteriormente, e, publicado a solução na internet;</p></li>
<li><p><strong>Monte um exemplo reprodutível do erro:</strong> para analisar e compreender esse erro, você terá que executar várias vezes o mesmo código que gera esse erro. Para que esse processo seja o mais rápido possível, vale a pena investir um tempo organizando um exemplo mínimo e simples que reproduza esse erro.</p></li>
<li><p><strong>Descubra de onde esse erro está surgindo:</strong> compreender e analisar um determinado erro, se torna uma atividade muito mais fácil quando você sabe de onde exatamente esse erro está surgindo;</p></li>
<li><p><strong>Conserte o erro e realize testes para confirmar que ele foi solucionado:</strong> depois de compreender como o erro acontece, e, aplicar uma solução para esse erro, é importante que você teste novamente o seu código, para se certificar que o erro foi de fato solucionado;</p></li>
</ul>
</div>
<div id="compreendendo-tracebacks" class="section level2" number="17.4">
<h2 number="17.4"><span class="header-section-number">17.4</span> Compreendendo <em>tracebacks</em></h2>
<p>Um <em>traceback</em> representa a sequência de funções executadas que geraram um determinado erro. Sendo assim, um <em>traceback</em> nos mostra justamente quais foram as funções executadas antes do erro surgir. Essa informação é extremamente útil quando desejamos localizar onde exatamente o erro ocorre.</p>
<p>Como exemplo, a função <code>infos_compras()</code> exposta abaixo executa dentro dela outras 2 funções chamadas <code>buscar_compras()</code> e <code>extrair_cpfs()</code>. Perceba também que, ao executarmos essa função, um erro é retornado pela expressão <code>compras$info</code>.</p>
<p></p>
<div class="sourceCode" id="cb1836"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1836-1"><a href="#cb1836-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb1836-2"><a href="#cb1836-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1836-3"><a href="#cb1836-3" aria-hidden="true" tabindex="-1"></a>buscar_compras <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb1836-4"><a href="#cb1836-4" aria-hidden="true" tabindex="-1"></a>  github <span class="ot">&lt;-</span> <span class="st">&quot;https://raw.githubusercontent.com/&quot;</span></span>
<span id="cb1836-5"><a href="#cb1836-5" aria-hidden="true" tabindex="-1"></a>  pasta <span class="ot">&lt;-</span> <span class="st">&quot;pedropark99/Curso-R/master/Dados/&quot;</span></span>
<span id="cb1836-6"><a href="#cb1836-6" aria-hidden="true" tabindex="-1"></a>  arquivo <span class="ot">&lt;-</span> <span class="st">&quot;compras.txt&quot;</span></span>
<span id="cb1836-7"><a href="#cb1836-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1836-8"><a href="#cb1836-8" aria-hidden="true" tabindex="-1"></a>  texto <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_file</span>(<span class="fu">paste0</span>(github, pasta, arquivo))</span>
<span id="cb1836-9"><a href="#cb1836-9" aria-hidden="true" tabindex="-1"></a>  texto <span class="ot">&lt;-</span> <span class="fu">unlist</span>(stringr<span class="sc">::</span><span class="fu">str_split</span>(texto, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>))</span>
<span id="cb1836-10"><a href="#cb1836-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(texto)</span>
<span id="cb1836-11"><a href="#cb1836-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1836-12"><a href="#cb1836-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1836-13"><a href="#cb1836-13" aria-hidden="true" tabindex="-1"></a>extrair_cpfs <span class="ot">&lt;-</span> <span class="cf">function</span>(texto){</span>
<span id="cb1836-14"><a href="#cb1836-14" aria-hidden="true" tabindex="-1"></a>  pcpf <span class="ot">&lt;-</span> <span class="st">&quot;([0-9]{3}[.][0-9]{3}[.][0-9]{3}[-][0-9]{2})&quot;</span></span>
<span id="cb1836-15"><a href="#cb1836-15" aria-hidden="true" tabindex="-1"></a>  cpfs <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="fu">paste0</span>(<span class="st">&quot;(.*)&quot;</span>, pcpf, <span class="st">&quot;(.*)&quot;</span>), <span class="st">&quot;</span><span class="sc">\\</span><span class="st">2&quot;</span>, texto)</span>
<span id="cb1836-16"><a href="#cb1836-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(cpfs)</span>
<span id="cb1836-17"><a href="#cb1836-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1836-18"><a href="#cb1836-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1836-19"><a href="#cb1836-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1836-20"><a href="#cb1836-20" aria-hidden="true" tabindex="-1"></a>infos_compras <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb1836-21"><a href="#cb1836-21" aria-hidden="true" tabindex="-1"></a>  compras <span class="ot">&lt;-</span> <span class="fu">buscar_compras</span>()</span>
<span id="cb1836-22"><a href="#cb1836-22" aria-hidden="true" tabindex="-1"></a>  compras<span class="sc">$</span>cpfs <span class="ot">&lt;-</span> <span class="fu">extrair_cpfs</span>(compras<span class="sc">$</span>info)</span>
<span id="cb1836-23"><a href="#cb1836-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1836-24"><a href="#cb1836-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(compras)</span>
<span id="cb1836-25"><a href="#cb1836-25" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1836-26"><a href="#cb1836-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1836-27"><a href="#cb1836-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1836-28"><a href="#cb1836-28" aria-hidden="true" tabindex="-1"></a><span class="fu">infos_compras</span>()</span></code></pre></div>
<p></p>
<pre><code>## Error in compras$info : $ operator is invalid for atomic vectors </code></pre>
<p>Para identificarmos qual a função onde essa expressão <code>compras$info</code> foi executada, podemos olhar para o <em>traceback</em> desse erro. Para acessarmos esse <em>traceback</em>, precisamos apenas executar a função <code>traceback()</code> como demonstrado abaixo.</p>
<p></p>
<div class="sourceCode" id="cb1838"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1838-1"><a href="#cb1838-1" aria-hidden="true" tabindex="-1"></a><span class="fu">traceback</span>()</span></code></pre></div>
<p></p>
<pre><code>## 4: is.factor(x)
## 3: gsub(paste0(&quot;(.*)&quot;, pcpf, &quot;(.*)&quot;), &quot;\\2&quot;, texto) at #3
## 2: extrair_cpfs(compras$info) at #3
## 1: infos_compras()</code></pre>
<p>Como você pode ver acima, a expressão que levantou o erro (<code>compras$info</code>) foi executada dentro da função <code>is.factor()</code>, que por sua vez, foi executada dentro da função <code>gsub()</code>, e, assim por diante. Portanto, a ordem (ou a sequência) de funções executadas antes que o erro fosse levantado foi <code>infos_compras()</code> <span class="math inline">\(\rightarrow\)</span> <code>extrair_cpfs()</code> <span class="math inline">\(\rightarrow\)</span> <code>gsub()</code> <span class="math inline">\(\rightarrow\)</span> <code>is.factor()</code>.</p>
<p>Se você está trabalhando dentro do RStudio, você também pode acessar o <em>traceback</em> de um erro, ao apertar o botão <em>“Show Traceback”</em>, que aparece à direita de todo erro que surge no console. Esse botão está destacado na figura 17.1.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/traceback1.png" alt="Botão de Traceback do RStudio" width="80%" />
<p class="caption">
(#fig:unnamed-chunk-965)Botão de Traceback do RStudio
</p>
</div>
<p></p>
</div>
<div id="o-método-print-ou-print-debugging" class="section level2" number="17.5">
<h2 number="17.5"><span class="header-section-number">17.5</span> O método <code>print()</code> ou <em>print debugging</em></h2>
<p>Uma das grandes dificuldades que emergem das funções, é que elas executam as suas tarefas em um ambiente separado do seu. Por causa disso, você não consegue visualizar com facilidade todos os resultados e objetos que estão sendo gerados dentro dessa função. Como consequência, a sua investigação de erros fica comprometida.</p>
<p>Para solucionar esse problema, vários programadores costumam recorrer ao método <code>print()</code>, ou, como é mais conhecido dentro da comunidade de programação, <em>print debugging</em>.</p>
<p>Com o <em>traceback</em> que mostramos na seção anterior, nós já descobrimos que o erro surge a partir da função <code>infos_compras()</code>, pois a sequência de funções executadas começa por essa função. Tendo isso em mente, um bom próximo passo seria analisarmos se todas as nossas condições ou pressupostos estão sendo respeitados dentro dessa função. Pois se um erro surgiu dessa função, é provável que ela não soube lidar com algo que está fora dessas condições e pressupostos.</p>
<p>Uma das formas mais simples e eficazes de se realizar essa análise, é imprimir ou mostrar informações em seu console que confirmam que esses pressupostos foram respeitados. Para isso, podemos utilizar funções como <code>print()</code> ou <code>cat()</code>.</p>
<p>Portanto, a técnica <em>print debugging</em> consiste em inserir expressões de <code>print()</code> em partes chaves de seu código. Especialmente dentro de funções e <em>loops</em>, que são as partes em que você possui menor visibilidade. Dessa forma, vamos nos certificando aos poucos, que todos os objetos importantes estão sendo criados, e que eles são interpretados pelos tipos de dados corretos (ou esperados).</p>
<p>Vários tipos de erros surgem porque uma condição lógica não está funcionando da forma como você esperava, ou, porque um objeto importante não foi definido, ou ainda, porque um valor <code>NA</code> surge em uma parte inesperada de seu programa, ou mais, porque você esperava que um objeto fosse associado ao tipo de dado A, quando na verdade, ele acaba sendo associado ao tipo de dado B.</p>
<p>Dois objetos principais (<code>compras</code> e <code>cpfs</code>) são criados dentro da função <code>infos_compras()</code>. Geralmente, estamos sempre interessados em identificar duas informações principais sobre um determinado objeto, que é a sua estrutura e o tipo de dado associado a ele.</p>
<p>Com o comando <code>print(str(objeto))</code> podemos identificar essas duas informações de uma vez só. Porém, o resultado de <code>str()</code> pode ser muito grande a depender do objeto, por isso, para visualizar rapidamente a estrutura do objeto, eu costumo olhar apenas os 5 primeiros elementos do objeto, com <code>print(objeto[1:5])</code>, já, para o tipo de dado, eu busco o resultado da função <code>typeof()</code>, com <code>print(typeof(objeto))</code>.</p>
<p>Como exemplo inicial, vamos inserir esses dois comandos de <em>print</em> dentro do corpo da função <code>infos_compras()</code> para analisarmos o objeto <code>compras</code> mais de perto. Perceba que estou redefinindo (ou recriando) a função <code>infos_compras()</code> para adicionar esses comandos de <em>print</em> dentro dela. Em seguida, executo novamente a função para visualizarmos as novas informações.</p>
<p></p>
<div class="sourceCode" id="cb1840"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1840-1"><a href="#cb1840-1" aria-hidden="true" tabindex="-1"></a>infos_compras <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb1840-2"><a href="#cb1840-2" aria-hidden="true" tabindex="-1"></a>  compras <span class="ot">&lt;-</span> <span class="fu">buscar_compras</span>()</span>
<span id="cb1840-3"><a href="#cb1840-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;Primeiros elementos:</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb1840-4"><a href="#cb1840-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(compras[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>])</span>
<span id="cb1840-5"><a href="#cb1840-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;Tipo de dado:</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb1840-6"><a href="#cb1840-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">typeof</span>(compras))</span>
<span id="cb1840-7"><a href="#cb1840-7" aria-hidden="true" tabindex="-1"></a>  compras<span class="sc">$</span>cpfs <span class="ot">&lt;-</span> <span class="fu">extrair_cpfs</span>(compras<span class="sc">$</span>info)</span>
<span id="cb1840-8"><a href="#cb1840-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1840-9"><a href="#cb1840-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(compras)</span>
<span id="cb1840-10"><a href="#cb1840-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1840-11"><a href="#cb1840-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1840-12"><a href="#cb1840-12" aria-hidden="true" tabindex="-1"></a>dados <span class="ot">&lt;-</span> <span class="fu">infos_compras</span>()</span></code></pre></div>
<p></p>
<pre><code>## Primeiros elementos:
## [1] &quot;\&quot;Márcio390.287.917-210akqzS2tk$URMcLOk5Q\&quot;&quot;    
## [2] &quot;\&quot;Igor944.236.416-254tLo8&amp;S9WtXg05fsdU\&quot;&quot;       
## [3] &quot;\&quot;Márcio395.304.955-57pfwji9Z4Q6dZxSWZV7#7Z$J\&quot;&quot;
## [4] &quot;\&quot;Isabela322.900.842-74K5D6b$xAnY&amp;QJ1$XQzE2f\&quot;&quot; 
## [5] &quot;\&quot;Álvaro475.767.740-583WWonElfbisKD1GiIVS\&quot;&quot;    
## Tipo de dado:
## [1] &quot;character&quot;
## Error in compras$info : $ operator is invalid for atomic vectors</code></pre>
<p>O erro permanece, mas agora, mostramos algumas informações relevantes sobre o objeto <code>compras</code>. Perceba que este objeto é um vetor do tipo <code>character</code>. Ao extrair essa informação, você é capaz de compreender o porquê do erro estar acontecendo. Pois o objeto <code>compras</code> é um vetor atômico, e, a mensagem de erro fala bem claramente que o operador <code>$</code> é invalido para este tipo de objeto.</p>
<p>Tendo identificado <strong>o porquê</strong> do erro, temos agora a capacidade de solucionar esse erro. Podemos por exemplo, transformar o objeto <code>compras</code> em um <code>data.frame</code>, e incluir o resultado de <code>buscar_compras()</code> em uma coluna chamada <code>info</code>. Pois o operador <code>$</code> é válido para <code>data.frame</code>’s. Repare abaixo que, após essas alterações, a função <code>infos_compras()</code> foi executada sem erros.</p>
<p></p>
<div class="sourceCode" id="cb1842"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1842-1"><a href="#cb1842-1" aria-hidden="true" tabindex="-1"></a>infos_compras <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb1842-2"><a href="#cb1842-2" aria-hidden="true" tabindex="-1"></a>  compras <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb1842-3"><a href="#cb1842-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">info =</span> <span class="fu">buscar_compras</span>()</span>
<span id="cb1842-4"><a href="#cb1842-4" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb1842-5"><a href="#cb1842-5" aria-hidden="true" tabindex="-1"></a>  compras<span class="sc">$</span>cpfs <span class="ot">&lt;-</span> <span class="fu">extrair_cpfs</span>(compras<span class="sc">$</span>info)</span>
<span id="cb1842-6"><a href="#cb1842-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1842-7"><a href="#cb1842-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(compras)</span>
<span id="cb1842-8"><a href="#cb1842-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1842-9"><a href="#cb1842-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1842-10"><a href="#cb1842-10" aria-hidden="true" tabindex="-1"></a>dados <span class="ot">&lt;-</span> <span class="fu">infos_compras</span>()</span>
<span id="cb1842-11"><a href="#cb1842-11" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dados)</span></code></pre></div>
<p></p>
<pre><code>##                                            info           cpfs
## 1     &quot;Márcio390.287.917-210akqzS2tk$URMcLOk5Q&quot; 390.287.917-21
## 2        &quot;Igor944.236.416-254tLo8&amp;S9WtXg05fsdU&quot; 944.236.416-25
## 3 &quot;Márcio395.304.955-57pfwji9Z4Q6dZxSWZV7#7Z$J&quot; 395.304.955-57
## 4  &quot;Isabela322.900.842-74K5D6b$xAnY&amp;QJ1$XQzE2f&quot; 322.900.842-74
## 5     &quot;Álvaro475.767.740-583WWonElfbisKD1GiIVS&quot; 475.767.740-58
## 6    &quot;Rafael031.357.966-89bOzZ7#2JBcsd!sWzaeNY&quot; 031.357.966-89</code></pre>
</div>
<div id="modo-debug-do-r" class="section level2" number="17.6">
<h2 number="17.6"><span class="header-section-number">17.6</span> Modo <em>debug</em> do R</h2>
<p>Na seção anterior, mostramos algumas informações essenciais sobre os objetos que estavam sendo criados dentro da função <code>infos_compras()</code>, e, com essas informações pudemos identificar e corrigir a fonte do nosso erro. Portanto, <em>debugging</em> é uma atividade puramente de coleta de informações sobre o nosso programa. Quando temos um erro, nós buscamos informações para compreendê-lo, pois só assim vamos saber como corrigi-lo.</p>
<p>Na seção anterior, utilizamos a função <code>print()</code> para coletarmos essas informações. Mas o próprio R possui um modo especial de execução chamado <em>debug</em>. Neste modo, temos um ambiente onde podemos coletar essas informações de maneira interativa e prática. Com isso, não temos o trabalho de redefinir múltiplas vezes as nossas funções.</p>
<p>Como exemplo, vamos voltar à nossa função <code>infos_compras()</code>. Repare abaixo que estou redefinindo a função para o seu estado inicial. Portanto, quando eu executo novamente essa função, o erro anterior volta a aparecer.</p>
<p></p>
<div class="sourceCode" id="cb1844"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1844-1"><a href="#cb1844-1" aria-hidden="true" tabindex="-1"></a>infos_compras <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb1844-2"><a href="#cb1844-2" aria-hidden="true" tabindex="-1"></a>  compras <span class="ot">&lt;-</span> <span class="fu">buscar_compras</span>()</span>
<span id="cb1844-3"><a href="#cb1844-3" aria-hidden="true" tabindex="-1"></a>  compras<span class="sc">$</span>cpfs <span class="ot">&lt;-</span> <span class="fu">extrair_cpfs</span>(compras<span class="sc">$</span>info)</span>
<span id="cb1844-4"><a href="#cb1844-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1844-5"><a href="#cb1844-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(compras)</span>
<span id="cb1844-6"><a href="#cb1844-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1844-7"><a href="#cb1844-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1844-8"><a href="#cb1844-8" aria-hidden="true" tabindex="-1"></a><span class="fu">infos_compras</span>()</span></code></pre></div>
<p></p>
<pre><code>## Error in compras$info : $ operator is invalid for atomic vectors </code></pre>
<div id="inserindo-breakpoints-em-suas-funções" class="section level3" number="17.6.1">
<h3 number="17.6.1"><span class="header-section-number">17.6.1</span> Inserindo <em>breakpoints</em> em suas funções</h3>
<p>Para utilizar este modo <em>debug</em> do R, você precisa inserir um <em>breakpoint</em> em seu código. Um <em>breakpoint</em> representa o ponto (ou a linha) em seu <em>script</em>, que você deseja parar a execução, e, analisar o estado atual de seu programa. Isto é, o R não possui um botão de “Pare agora!” por isso, você precisa dizer antes ao R, <strong>quando</strong> ele deve pausar a execução de seu código.</p>
<p>Para adicionar um <em>breakpoint</em> você tem três alternativas principais (existem outras menos comuns). Todas elas giram em torno da função <code>browser()</code>. Apesar dos resultados serem basicamente os mesmos, uma dessas alternativas oferece vantagens mais importantes que as outras.</p>
<p>Essas alternativas são: 1) inserir manualmente a função <code>browser()</code> dentro do <em>body</em> de sua função de interesse; ou 2) utilizar a função <code>debug()</code> para inserir essa chamada à função <code>browser()</code>; ou 3) permitir que o próprio RStudio faça esse trabalho por você.</p>
<p>A primeira alternativa, consiste em inserir uma chamada à função <code>browser()</code> dentro do <em>body</em> da função que você está investigando. A função <code>browser()</code> advém dos pacotes básicos do R. Tudo que ela faz é criar um <em>breakpoint</em> e acionar o modo <em>debug</em> do R no instante em que ela é avaliada.</p>
<!-- Como um primeiro exemplo, observe a função `normalizar()` abaixo. Essa função deveria normalizar um conjunto de valores numéricos, segundo o indíce de uma distribuição normal. Apesar dessa função funcionar normalmente, quando aplicada sobre o vetor `c(8, 4, 5, 2)`, algo de errado ocorre quando aplicamos ela sobre um valor único como 5. -->
<!-- ```{r} -->
<!-- normalizar <- function(x){ -->
<!--   media <- mean(x, na.rm = TRUE) -->
<!--   desvio <- sd(x, na.rm = TRUE) -->
<!--   resultado <- (x - media) / desvio -->
<!--   return(resultado) -->
<!-- } -->
<!-- normalizar(c(8, 4, 5, 2)) -->
<!-- normalizar(5) -->
<!-- ``` -->
<p>A questão fundamental aqui é: onde inserir esse <em>breakpoint</em>? Para responder a essa pergunta, você precisa localizar a linha de seu <em>script</em> onde você deseja parar a execução e investigar o estado atual.</p>
<p>Por exemplo, utilizando a primeira alternativa citada, queremos investigar a função <code>infos_compras()</code>, pois sabemos que o erro surge a partir dessa função. Por isso, vou redefinir essa função, incluindo um comando <code>browser()</code> logo na primeira linha do <em>body</em> da função. Sendo assim, a execução será interrompida logo no início de <code>infos_compras()</code>.</p>
<p></p>
<div class="sourceCode" id="cb1846"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1846-1"><a href="#cb1846-1" aria-hidden="true" tabindex="-1"></a>infos_compras <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb1846-2"><a href="#cb1846-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">browser</span>()</span>
<span id="cb1846-3"><a href="#cb1846-3" aria-hidden="true" tabindex="-1"></a>  compras <span class="ot">&lt;-</span> <span class="fu">buscar_compras</span>()</span>
<span id="cb1846-4"><a href="#cb1846-4" aria-hidden="true" tabindex="-1"></a>  compras<span class="sc">$</span>cpfs <span class="ot">&lt;-</span> <span class="fu">extrair_cpfs</span>(compras<span class="sc">$</span>info)</span>
<span id="cb1846-5"><a href="#cb1846-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1846-6"><a href="#cb1846-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(compras)</span>
<span id="cb1846-7"><a href="#cb1846-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p></p>
<p>Já a segunda alternativa, consiste em aplicar a função <code>debug()</code> sobre a função que você deseja investigar. Ou seja, ao aplicar a função <code>debug()</code> sobre uma outra função, uma chamada à <code>browser()</code> será incluída na primeira linha do <em>body</em> dessa outra função.</p>
<p>Tendo isso em mente, como desejamos parar a execução na função <code>infos_compras()</code>, poderíamos executar o comando <code>debug(infos_compras)</code>. Após esse comando, se você executar a função <code>infos_compras()</code>, o modo <em>debug</em> será automaticamente acionado, logo na primeira linha da função<a href="#fn44" class="footnote-ref" id="fnref44"><sup>44</sup></a>.</p>
<p></p>
<div class="sourceCode" id="cb1847"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1847-1"><a href="#cb1847-1" aria-hidden="true" tabindex="-1"></a>infos_compras <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb1847-2"><a href="#cb1847-2" aria-hidden="true" tabindex="-1"></a>  compras <span class="ot">&lt;-</span> <span class="fu">buscar_compras</span>()</span>
<span id="cb1847-3"><a href="#cb1847-3" aria-hidden="true" tabindex="-1"></a>  compras<span class="sc">$</span>cpfs <span class="ot">&lt;-</span> <span class="fu">extrair_cpfs</span>(compras<span class="sc">$</span>info)</span>
<span id="cb1847-4"><a href="#cb1847-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1847-5"><a href="#cb1847-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(compras)</span>
<span id="cb1847-6"><a href="#cb1847-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1847-7"><a href="#cb1847-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1847-8"><a href="#cb1847-8" aria-hidden="true" tabindex="-1"></a><span class="fu">debug</span>(infos_compras)</span>
<span id="cb1847-9"><a href="#cb1847-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1847-10"><a href="#cb1847-10" aria-hidden="true" tabindex="-1"></a><span class="do">### Ao executar a função, você entrará automaticamente</span></span>
<span id="cb1847-11"><a href="#cb1847-11" aria-hidden="true" tabindex="-1"></a><span class="do">### em modo debug</span></span>
<span id="cb1847-12"><a href="#cb1847-12" aria-hidden="true" tabindex="-1"></a><span class="fu">infos_compras</span>()</span>
<span id="cb1847-13"><a href="#cb1847-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1847-14"><a href="#cb1847-14" aria-hidden="true" tabindex="-1"></a><span class="do">### Para retornar ao estado inicial da função</span></span>
<span id="cb1847-15"><a href="#cb1847-15" aria-hidden="true" tabindex="-1"></a><span class="do">### utilize undebug()</span></span>
<span id="cb1847-16"><a href="#cb1847-16" aria-hidden="true" tabindex="-1"></a><span class="fu">undebug</span>(infos_compras)</span></code></pre></div>
<p></p>
<p>Em contrapartida, a terceira alternativa, consiste em permitir que o próprio RStudio insira esse comando <code>browser()</code> dentro de sua função com apenas um clique em seu <em>script</em>. Obviamente, para utilizar essa terceira alternativa, você precisa estar trabalhando com o R através do RStudio.</p>
<p>Em resumo, essa terceira alternativa citada consiste em clicar (com o botão esquerdo do mouse) à esquerda do número da linha em que você deseja inserir o <em>breakpoint</em>.</p>
<p>Portanto, eu procuro pela definição dessa função <code>infos_compras()</code> em meu <em>script</em> aberto no RStudio e, identifico que a primeira linha do <em>body</em> dessa função, está na linha 21 de meu <em>script</em> (como demonstrado na figura 17.2 abaixo). Logo, eu clico à esquerda do número 21, e, como resultado, uma bola vermelha aparece ao lado desse número, indicando assim, que um novo <em>breakpoint</em> foi adicionado àquela linha.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/debug2.png" alt="Adicionando *breakpoints* ao seu *script* - Parte 1" width="60%" />
<p class="caption">
(#fig:unnamed-chunk-971)Adicionando <em>breakpoints</em> ao seu <em>script</em> - Parte 1
</p>
</div>
<p></p>
<p>Essa mesma bola vermelha também aparece em sua janela de <em>Environment</em> do RStudio, logo ao lado do nome da função onde esse <em>breakpoint</em> foi inserido.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/debug3.png" alt="Adicionando *breakpoints* ao seu *script* - Parte 2" width="60%" />
<p class="caption">
(#fig:unnamed-chunk-972)Adicionando <em>breakpoints</em> ao seu <em>script</em> - Parte 2
</p>
</div>
<p></p>
<p>Você também pode adicionar esse mesmo <em>breakpoint</em>, ao acionar o atalho <code>Shift + F9</code>, quando o cursor de seu mouse estiver na linha desejada.</p>
<p>Contudo, caso o objeto da função em questão, ainda não tenha sido criado em sua sessão, o RStudio vai levantar um aviso, dizendo que o <em>breakpoint</em> será adicionado assim que o seu <em>script</em> for executado. Esse aviso está apresentado na figura 17.4 abaixo. Perceba que, quando este tipo de situação acontece, a bola vermelha presente em seu <em>script</em> fica oca.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/debug6.png" alt="Breakpoint é adicionado assim que o objeto da função é criado" width="60%" />
<p class="caption">
(#fig:unnamed-chunk-973)Breakpoint é adicionado assim que o objeto da função é criado
</p>
</div>
<p></p>
<p>Após esse processo, ao observamos a definição da função <code>infos_compras()</code>, podemos perceber que essa função é agora um objeto de classe <code>"functionWithTrace"</code>. Apesar da classe ter sido modificada, no fundo, tudo o que o RStudio fez foi inserir um comando <code>browser()</code> dentro do corpo de <code>infos_compras()</code>, mesmo que esse comando não esteja visível à primeira vista.</p>
<p></p>
<div class="sourceCode" id="cb1848"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1848-1"><a href="#cb1848-1" aria-hidden="true" tabindex="-1"></a>infos_compras</span></code></pre></div>
<p></p>
<pre><code>## Object with tracing code, class &quot;functionWithTrace&quot;
## Original definition: 
## function(){
##   compras &lt;- buscar_compras()
##   compras$cpfs &lt;- extrair_cpfs(compras$info)
##  
##   return(compras)
## }
##
## ## (to see the tracing code, look at *body*(object))</code></pre>
<p>O resultado entre as três alternativas é basicamente o mesmo. Porém, configurar esses <em>breakpoints</em> pelas ferramentas que o RStudio oferece é preferível a utilizar a função <code>debug()</code>, ou, inserir manualmente comandos <code>browser()</code>. Pois é mais simples de se configurar, e, você não corre o risco de se esquecer de retirar os comandos <code>browser()</code> de suas funções, após resolver todos os <em>bugs</em> <span class="citation">(<a href="#ref-wickham2015_advanced" role="doc-biblioref">Wickham 2015a</a>)</span>.</p>
</div>
<div id="entrando-em-modo-debug" class="section level3" number="17.6.2">
<h3 number="17.6.2"><span class="header-section-number">17.6.2</span> Entrando em modo debug</h3>
<p>Você consegue identificar se o seu R está em modo <em>debug</em> ou não, ao observar o indicador de seu console. Caso ele esteja no formato <code>Browse[n]&gt;</code>, você está no modo <em>debug</em>. Porém, se ele estiver no formato tradicional com o símbolo de “maior que” (<code>&gt;</code>), você está no modo “normal” do R.</p>
<p>Perceba na figura 17.5 abaixo, que, assim que eu executo a função <code>infos_compras()</code>, o indicador de meu console passa do formato <code>&gt;</code> para <code>Browse[n]&gt;</code>, indicando assim, que eu entrei no modo <em>debug</em>. Além disso, perceba também que um conjunto de botões (<code>Next</code>, <code>Continue</code>, <code>Stop</code>, dentre outros) aparece no canto superior do console do RStudio. Esses botões são uma outra forma de você identificar que o seu R está no modo <em>debug</em>.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/debug4.png" alt="Modo *debug* do R - Parte 1" width="70%" />
<p class="caption">
(#fig:unnamed-chunk-975)Modo <em>debug</em> do R - Parte 1
</p>
</div>
<p></p>
<p>Portanto, quando executamos a função <code>infos_compras()</code>, o R entra automaticamente em modo <em>debug</em>, pelo simples fato de que essa função contém um <em>breakpoint</em> dentro dela. Este modo <em>debug</em> é ligado assim que o R encontra um <em>breakpoint</em>, isto é, no instante em que a função <code>browser()</code> é executada.</p>
<p>Tendo isso em mente, o R realiza a chamada à função <code>infos_compras()</code>. Entretanto, ele paralisa a execução logo na primeira linha descrita no <em>body</em> dessa função. Pois é justo nessa linha que inserimos o <em>breakpoint</em>.</p>
<p>Caso você esteja dentro do RStudio, se você retornar ao <em>script</em> onde está a definição dessa função, você vai reparar que o RStudio marcou em amarelo essa linha, e adicionou uma seta verde à esquerda. Com isso, o RStudio está te avisando que o seu R está parado especificamente naquela linha, aguardando novas instruções para prosseguir com a execução.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/debug5.png" alt="Modo *debug* do RStudio - Parte 2" width="60%" />
<p class="caption">
(#fig:unnamed-chunk-976)Modo <em>debug</em> do RStudio - Parte 2
</p>
</div>
<p></p>
<p>É muito importante destacar que, <strong>se o R está parado em uma linha específica, isso significa que ele ainda não executou essa linha</strong>. Em outras palavras, a função <code>buscar_compras()</code> ainda não foi executada, consequentemente, o objeto <code>compras</code> ainda não foi criado.</p>
<p>Podemos verificar essa afirmativa, ao procurar pelo objeto <code>compras</code> dentro do modo <em>debug</em> do RStudio. Perceba abaixo, que um erro é retornado, indicando que esse objeto ainda não foi definido.</p>
<p></p>
<div class="sourceCode" id="cb1850"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1850-1"><a href="#cb1850-1" aria-hidden="true" tabindex="-1"></a>Browse[<span class="dv">2</span>]<span class="sc">&gt;</span> compras</span></code></pre></div>
<p></p>
<pre><code>## Error: object &#39;compras&#39; not found</code></pre>
<p>Recapitulando, para entrarmos no modo <em>debug</em> do R, precisamos executar uma função que contenha um <em>breakpoint</em> dentro dela. No nosso exemplo, essa função é <code>infos_compras()</code>.</p>
<p>Ao avaliarmos essa função <code>infos_compras()</code>, o R paralisa a execução logo na primeira linha do <em>body</em> dessa função. Contudo, mesmo em modo <em>debug</em>, o R continua disponível para executar novos comandos. Ou seja, você consegue criar novos objetos, executar outras funções e imprimir informações no console, da mesma forma que você normalmente faria no modo “normal” do R.</p>
<p>Sendo assim, em modo <em>debug</em>, o R paralisa a execução da função (ou do <em>loop</em>) que contém o <em>breakpoint</em>. Mas o R não fica indisponível, ou, ele não paralisa toda e qualquer outra execução. Dito de outra forma, o modo <em>debug</em> te permite paralisar a execução de uma função e, investigar de forma interativa o seu estado, atrás de algum problema que revele a fonte de seu erro.</p>
<p>Portanto, o modo <em>debug</em> do R te ajuda a realizar os seguintes passos, que são essenciais em qualquer ato de <em>debugging</em>:</p>
<ol style="list-style-type: decimal">
<li>Você começa a executar o seu script;</li>
<li>Paralisa a execução no ponto em que você suspeita estar a fonte de seu erro;</li>
<li>Começa a investigar os objetos que estão sendo criados e as ações que estão sendo realizadas nesse ponto;</li>
<li>Descobre o problema que está ocorrendo naquele ponto;</li>
</ol>
</div>
<div id="navegando-pelo-modo-debug" class="section level3" number="17.6.3">
<h3 number="17.6.3"><span class="header-section-number">17.6.3</span> Navegando pelo modo debug</h3>
<p>Para navegar pelo modo <em>debug</em>, você pode utilizar os botões que aparecem no canto superior de seu console no RStudio, ou, utilizar um dos comandos curtos de texto que estão descritos abaixo:</p>
<ul>
<li><p><code>n</code>: executar a próxima linha (ou a próxima etapa) da função. Caso você possua um objeto definido chamado <code>n</code>, quando estiver em modo <em>debug</em>, você precisa utilizar o comando <code>print(n)</code> para visualizar o conteúdo desse objeto.</p></li>
<li><p><code>s</code>: funciona de forma parecida com o comando <code>n</code>, porém, caso a próxima linha da função que você está investigando, contenha uma outra função, o modo <em>debug</em> vai entrar dentro dessa outra função, para que você possa investigar o estado dessa outra função também.</p></li>
<li><p><code>f</code>: encerra a execução do <em>loop</em> ou função atual.</p></li>
<li><p><code>c</code>: sai momentaneamente do modo interativo do <em>debug</em>, e, executa todos os próximos passos da função, até que um novo <em>breakpoint</em> seja encontrado. Esse comando é útil, caso você tenha adicionado uma correção para o seu erro, e, deseja confirmar que o problema foi de fato resolvido.</p></li>
<li><p><code>Q</code>: finaliza o modo <em>debug</em>, encerra a execução da função, e, retorna o R para o seu modo “normal” de execução. Utilize esse comando quando você deseja sair do modo <em>debug</em> do R.</p></li>
<li><p><code>where</code>: mostra a árvore atual de chamadas. Esse comando é, basicamente, o equivalente à função <code>traceback()</code> para o modo <em>debug</em>.</p></li>
</ul>
<p>Como destacamos na seção passada, você pode acessar esses mesmos comandos através dos botões que aparecem (quando você entra em modo <em>debug</em>) no canto superior de seu console do RStudio. A figura 17.7 abaixo apresenta justamente a correspondência entre esses comandos em texto e os botões desse painel:</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/painel_debug_rstudio.png" alt="Relação entre os comandos em texto e os botões do painel de *debug* do RStudio" width="80%" />
<p class="caption">
(#fig:unnamed-chunk-978)Relação entre os comandos em texto e os botões do painel de <em>debug</em> do RStudio
</p>
</div>
<p></p>
<p>Como um primeiro exemplo, vamos observar a função <code>f()</code> descrita abaixo. Perceba que essa função executa um <em>loop</em> dentro dela, e, dentro desse <em>loop</em>, temos uma chamada à função <code>browser()</code>.</p>
<p></p>
<div class="sourceCode" id="cb1852"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1852-1"><a href="#cb1852-1" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb1852-2"><a href="#cb1852-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>){</span>
<span id="cb1852-3"><a href="#cb1852-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">browser</span>()</span>
<span id="cb1852-4"><a href="#cb1852-4" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1852-5"><a href="#cb1852-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p></p>
<p>Devido ao fato de <code>browser()</code> ser a única função presente no <em>body</em> de <code>f()</code>, os comandos <code>c</code> e <code>n</code> do modo <em>debug</em> são aproximadamente equivalentes. Pois com o comando <code>n</code>, o R vai executar a próxima linha do <em>body</em> da função <code>f()</code>. Porém, como essa próxima etapa é a próxima iteração do <em>loop</em>, a função <code>browser()</code> será executada novamente e, consequentemente, o R entrará novamente em modo <em>debug</em>.</p>
<p>Já o comando <code>c</code>, vai fazer com que o R saia do modo <em>debug</em> e execute todas as etapas restantes do <em>body</em> da função <code>f()</code>. Todavia, como essas próximas etapas correspondem às próximas iterações do <em>loop</em>, o R vai executar novamente a função <code>browser()</code> e, consequentemente, entrar novamente em modo <em>debug</em>.</p>
<p>Contudo, se inserirmos um novo comando após <code>browser()</code>, os comandos <code>n</code> e <code>c</code> deixam de ser equivalentes. Perceba abaixo, que inserimos a expressão <code>print(i * 10)</code> após a função <code>browser()</code>.</p>
<p></p>
<div class="sourceCode" id="cb1853"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1853-1"><a href="#cb1853-1" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb1853-2"><a href="#cb1853-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>){</span>
<span id="cb1853-3"><a href="#cb1853-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">browser</span>()</span>
<span id="cb1853-4"><a href="#cb1853-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(i <span class="sc">*</span> <span class="dv">10</span>)</span>
<span id="cb1853-5"><a href="#cb1853-5" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1853-6"><a href="#cb1853-6" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p></p>
<p>Com essa nova definição de <code>f()</code>, quando utilizamos o comando <code>c</code>, a expressão <code>print(i * 10)</code>, assim como a próxima iteração do <em>loop</em>, e, consequentemente, o próximo <code>browser()</code>, são todos executados de uma vez só. Perceba na figura 17.8 abaixo, pela expressão <code>Called from: f()</code>, que um novo comando <code>browser()</code> é executado a cada novo comando <code>c</code>.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/debug_continue.png" alt="Comando `Continue`" width="70%" />
<p class="caption">
(#fig:unnamed-chunk-981)Comando <code>Continue</code>
</p>
</div>
<p></p>
<p>Por outro lado, quando utilizamos o comando <code>n</code>, o R se move para a próxima linha do <em>body</em>, que é expressão <code>print(i * 10)</code>. No segundo comando <code>n</code>, o R executa a expressão <code>print(i * 10)</code> e, se move para a próxima linha, que corresponde ao próximo <code>browser()</code>. Logo, para executarmos o próximo <code>browser()</code>, temos que utilizar três comandos <code>n</code>, como apresentado na figura 17.9 abaixo.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/debug_next.png" alt="Comando `Next`" width="60%" />
<p class="caption">
(#fig:unnamed-chunk-982)Comando <code>Next</code>
</p>
</div>
<p></p>
</div>
<div id="investigando-o-estado-de-sua-função" class="section level3" number="17.6.4">
<h3 number="17.6.4"><span class="header-section-number">17.6.4</span> Investigando o estado de sua função</h3>
<p>Portanto, o modo <em>debug</em> do R te permite investigar o ambiente (ou o <em>environment</em>) de sua função, de forma interativa. Em outras palavras, ele te permite analisar os resultados gerados dentro de sua função. Este modo também te permite entrar dentro do ambiente de outras funções que são executadas dentro de sua função (com o botão <em>Step Into</em>, ou, o comando <code>s</code>). Dessa maneira, você também pode investigar os objetos criados e os processos executados dentro dessas funções “secundárias.”</p>
<p>Eu poderia utilizar este modo <em>debug</em> para coletar as mesmas informações que extraímos (sobre o objeto <code>compras</code>) na seção sobre <em>print debugging</em>. Por exemplo, após adicionar um <em>breakpoint</em> à função <code>infos_compras()</code>, eu executo ela para entrar em modo <em>debug</em>. Perceba abaixo (pela expressão <code>debug at</code>), que o R está parado na linha em que o objeto <code>compras</code> é criado.</p>
<p></p>
<div class="sourceCode" id="cb1854"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1854-1"><a href="#cb1854-1" aria-hidden="true" tabindex="-1"></a><span class="fu">infos_compras</span>()</span></code></pre></div>
<p></p>
<pre><code>## Called from: eval(expr, p)
## Browse[1]&gt; n
## *debug* at #21: compras &lt;- buscar_compras()</code></pre>
<p>Lembre-se que, se o R está parado nessa linha, quer dizer que ele ainda não avaliou essa linha. Por isso, eu utilizo o comando <code>n</code> para executar essa linha, para que o objeto <code>compras</code> seja criado.</p>
<p></p>
<div class="sourceCode" id="cb1856"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1856-1"><a href="#cb1856-1" aria-hidden="true" tabindex="-1"></a>Browse[<span class="dv">2</span>]<span class="sc">&gt;</span> n</span></code></pre></div>
<p></p>
<pre><code>## *debug* at #22: cpfs &lt;- extrair_cpfs(compras$info)</code></pre>
<p>Em seguida, começo a investigar o objeto <code>compras</code>, visualizando parte de seu conteúdo, e, investigando sua estrutura.</p>
<p></p>
<div class="sourceCode" id="cb1858"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1858-1"><a href="#cb1858-1" aria-hidden="true" tabindex="-1"></a>Browse[<span class="dv">2</span>]<span class="sc">&gt;</span> compras[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span></code></pre></div>
<p></p>
<pre><code>## [1] &quot;\&quot;Márcio390.287.917-210akqzS2tk$URMcLOk5Q\&quot;&quot;    
## [2] &quot;\&quot;Igor944.236.416-254tLo8&amp;S9WtXg05fsdU\&quot;&quot;       
## [3] &quot;\&quot;Márcio395.304.955-57pfwji9Z4Q6dZxSWZV7#7Z$J\&quot;&quot;
## [4] &quot;\&quot;Isabela322.900.842-74K5D6b$xAnY&amp;QJ1$XQzE2f\&quot;&quot; 
## [5] &quot;\&quot;Álvaro475.767.740-583WWonElfbisKD1GiIVS\&quot;&quot; </code></pre>
<p></p>
<div class="sourceCode" id="cb1860"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1860-1"><a href="#cb1860-1" aria-hidden="true" tabindex="-1"></a>Browse[<span class="dv">2</span>]<span class="sc">&gt;</span> <span class="fu">str</span>(compras)</span></code></pre></div>
<p></p>
<pre><code>## chr [1:1150] &quot;\&quot;Márcio390.287.917-210akqzS2tk$URMcLOk5Q\&quot;&quot; ...</code></pre>
<p>Após coletar todas as informações que preciso para compreender e corrigir o erro, eu posso sair do modo <em>debug</em>, com o comando <code>Q</code>.</p>
<p></p>
<div class="sourceCode" id="cb1862"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1862-1"><a href="#cb1862-1" aria-hidden="true" tabindex="-1"></a>Browse[<span class="dv">2</span>]<span class="sc">&gt;</span> Q</span>
<span id="cb1862-2"><a href="#cb1862-2" aria-hidden="true" tabindex="-1"></a><span class="do">### O R retorna para o seu modo &quot;normal&quot; de execução</span></span></code></pre></div>
<p></p>
</div>
</div>
<div id="sempre-teste-o-seu-código" class="section level2" number="17.7">
<h2 number="17.7"><span class="header-section-number">17.7</span> Sempre teste o seu código</h2>
<p>Após compreender e corrigir os erros em suas funções, é importante que você teste novamente todo o seu código. Pois, ao corrigir uma parte de seu código, você pode acidentalmente quebrar uma outra parte dele.</p>
<p>Apesar dessa importância, você pode se perguntar “quando especificamente você deve realizar esses testes.” Temos três respostas corretas para essa pergunta:</p>
<ul>
<li>Sempre!</li>
<li>O mais cedo possível!</li>
<li>Com frequência!</li>
</ul>
<p>Programadores ou desenvolvedores de software geralmente dividem testes em duas categorias: <em>unity tests</em> e <em>integration tests</em>. Um teste unitário (ou <em>unity test</em>) consiste em testar se uma função isolada funciona da forma esperada. Já um teste integrado (ou <em>integration test</em>) consiste em testar se todas as funções de seu programa funcionam em conjunto, da forma correta.</p>
<p>Existem métodos formais de se realizar tais tipos de testes no R, especialmente a partir do pacote <code>testthat</code>. Porém, como esse pacote é focado especialmente no público que busca desenvolver novos pacotes para o R, ele está fora do escopo deste livro. Por esse motivo, se você deseja aprender mais sobre esse pacote, a obra de <span class="citation"><a href="#ref-wickham2015_packages" role="doc-biblioref">Wickham</a> (<a href="#ref-wickham2015_packages" role="doc-biblioref">2015b</a>)</span> é uma boa referência.</p>
<!-- Portanto, vou descrever aqui, métodos "informais" de testes unitários e integrados. Mesmo assim, são métodos válidos e que vão te ajudar a produzir um código correto e com um maior grau de reprodutibilidade.  -->
<p>Após aplicar as correções necessárias em sua função, execute novamente essa função. Dessa forma, você estará realizando um teste unitário sobre essa função. Confira se essa função retorna o resultado ou erro esperados. Caso tudo ocorra como você previa, é uma boa ideia realizar um teste integrado de seu programa logo em seguida.</p>
<p>Uma forma prática e segura de se realizar esse tipo de teste é reiniciar o seu R (com o atalho <code>Ctrl + Shift + F10</code>) e, em seguida, executar todo o seu <em>script</em> (com o atalho <code>Ctrl + Shift + S</code>). Ao executar todo o seu <em>script</em>, se todas as funções forem executadas normalmente, sem erros, e, todos os objetos esperados forem gerados, isso é um forte sinal de que você possui um programa correto e com bom grau de reprodutibilidade.</p>
<!--chapter:end:15-debugging.Rmd-->
</div>
</div>
<div id="environments-ou-ambientes-no-r" class="section level1" number="18">
<h1 number="18"><span class="header-section-number">18</span> <em>Environments</em> ou ambientes no R</h1>
<div id="introdução-3" class="section level2" number="18.1">
<h2 number="18.1"><span class="header-section-number">18.1</span> Introdução</h2>
<p>Todo objeto existente no R está armazenado em um <em>environment</em> (ou ambiente) específico. Como é destacado por <span class="citation"><a href="#ref-wickham2015_advanced" role="doc-biblioref">Wickham</a> (<a href="#ref-wickham2015_advanced" role="doc-biblioref">2015a</a>)</span> os <em>environments</em> são a estrutura de dados que sustenta o processo de <em>scoping</em> do R, isto é, as regras de “busca” por objetos da linguagem R.</p>
<p>Compreender o que é um <em>environment</em> é algo bastante simples. Porém, entender como os vários <em>environments</em> ativos em sua sessão funcionam em conjunto, representa um outro nível de dificuldade. Mesmo assim, <em>environments</em> são estruturas muito importantes para a linguagem R, e que sustentam grande parte das operações realizadas pelos pacotes <code>dplyr</code> e <code>ggplot2</code>.</p>
<p>Além disso, <em>environments</em> são parte fundamental da reprodutibilidade dos programas criados pela linguagem R. Pois eles são as estruturas responsáveis por garantir que os diferentes componentes de seu programa sejam únicos e independentes entre si.</p>
<p>Ao longo deste capítulo vamos utilizar algumas funções do pacote <code>rlang</code>. Sendo assim, para que você possa acompanhar alguns dos exemplos a seguir, é necessário que esse pacote esteja instalado em sua máquina.</p>
<p></p>
<div class="sourceCode" id="cb1863"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1863-1"><a href="#cb1863-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rlang)</span></code></pre></div>
<p></p>
</div>
<div id="sec:environments" class="section level2" number="18.2">
<h2 number="18.2"><span class="header-section-number">18.2</span> Noções básicas de <em>environments</em></h2>
<p>Para além de uma linguagem que trabalha com objetos, o R é também uma linguagem que trabalha com objetos que estão contidos (ou guardados) em certos <em>environments</em>. Um <em>environment</em> (ou ambiente) no R, é muito parecido com uma lista nomeada. Cada nome presente nessa lista, corresponde ao nome de um objeto que está armazenado nesse respectivo <em>environment</em>.</p>
<p>Segundo <span class="citation"><a href="#ref-wickham2015_advanced" role="doc-biblioref">Wickham</a> (<a href="#ref-wickham2015_advanced" role="doc-biblioref">2015a</a>)</span>, todo <em>environment</em> carrega algumas propriedades:</p>
<ul>
<li><p>Todos os nomes em um <em>environment</em> são únicos (isso garante que dois ou mais objetos de mesmo nome não existam dentro de um mesmo environment);</p></li>
<li><p>Os nomes presentes em um <em>environment</em> não são ordenados;</p></li>
<li><p>Todo <em>environment</em> possui um <em>environment</em> “pai”;</p></li>
<li><p>Um <em>environment</em> é modificado <em>in place</em> (ou seja, ele não é copiado quando ele é modificado).</p></li>
</ul>
<p>Quando estamos trabalhando com um determinado objeto, geralmente nos referimos a este objeto através de seu nome, contudo, o nome é apenas parte desta referência, <strong>pois objetos existem dentro de um determinado contexto, ou escopo</strong>. Portanto, no R, uma referência completa a um determinado objeto, é na verdade, a combinação entre o nome deste objeto e o <em>environment</em> no qual ele está inserido <span class="citation">(<a href="#ref-chambers2016" role="doc-biblioref">Chambers 2016</a>)</span>.</p>
</div>
<div id="descobrindo-o-environment-atual" class="section level2" number="18.3">
<h2 number="18.3"><span class="header-section-number">18.3</span> Descobrindo o <em>environment</em> atual</h2>
<p>Independentemente de onde você esteja dentro do R, você sempre é capaz de identificar qual é o <em>environment</em> atual através da função <code>environment()</code>. Basta executar essa função, e, o endereço do <em>environment</em> no qual você está será retornado como resultado.</p>
<p>Perceba abaixo que, ao executar essa função em minha sessão atual do R, o endereço <code>R_GlobalEnv</code> é retornado. Normalmente, <em>environments</em> são identificados através do endereço da memória RAM no qual eles estão localizados. Contudo, esse valor <code>R_GlobalEnv</code> representa um apelido para um <em>environment</em> especial do R, chamado de <em>global environment</em>. Vamos discutir esse <em>environment</em> na próxima seção.</p>
<p></p>
<div class="sourceCode" id="cb1864"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1864-1"><a href="#cb1864-1" aria-hidden="true" tabindex="-1"></a><span class="fu">environment</span>()</span></code></pre></div>
<p></p>
<pre><code>## &lt;environment: R_GlobalEnv&gt;</code></pre>
<p>Em termos mais técnicos, o que a função <code>environment()</code> faz é retornar o endereço do <em>environment</em> no qual ela é executada. Portanto, o resultado dessa função depende diretamente de <strong>onde</strong> você a executa.</p>
<p>Logo, se o comando <code>environment()</code> está sendo executado dentro do <em>body</em> de uma função chamada <code>f</code>, o resultado será o <em>environment</em> de execução dessa função <code>f</code>. Mas, se você executar esse comando diretamente no seu console do R, o resultado será diferente.</p>
</div>
<div id="o-environment-global" class="section level2" number="18.4">
<h2 number="18.4"><span class="header-section-number">18.4</span> O <em>environment</em> global</h2>
<p>Normalmente, quando digitamos o nome de um determinado objeto, nós não estamos preocupados com o <em>environment</em> no qual este objeto está guardado. Pois o próprio R realiza o trabalho duro de procurar por este objeto ao longo de todos os <em>environments</em> ativos em sua sessão, atrás de um objeto que possua o mesmo nome que você digitou. Tal mecanismo de procura é denominado de <em>scoping</em> ou de <em>lexical scoping</em> <span class="citation">(<a href="#ref-wickham2015_advanced" role="doc-biblioref">Wickham 2015a</a>)</span>, e ele geralmente se inicia pelo seu <em>global environment</em>.</p>
<p>Toda vez que você inicia a sua sessão no R, você está trabalhando com um <em>environment</em> especial que chamamos de <em>global environment</em>, ou ambiente global. Logo, todos os objetos que você normalmente cria em sua sessão, são guardados dentro deste <em>global environment</em>.</p>
<p>Você pode se referir a esse <em>environment</em> através da função <code>globalenv()</code>. Como exemplo, eu posso usar a função <code>ls()</code> para listar os nomes de todos os objetos que estão disponíveis especificamente neste <em>global environment</em>. Como vimos na seção passada, o endereço desse <em>environment</em> é referenciado como <code>R_GlobalEnv</code>.</p>
<p></p>
<div class="sourceCode" id="cb1866"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1866-1"><a href="#cb1866-1" aria-hidden="true" tabindex="-1"></a><span class="fu">globalenv</span>()</span></code></pre></div>
<pre><code>## &lt;environment: R_GlobalEnv&gt;</code></pre>
<p></p>
<p></p>
<div class="sourceCode" id="cb1868"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1868-1"><a href="#cb1868-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Iniciei uma nova sessão no R</span></span>
<span id="cb1868-2"><a href="#cb1868-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1868-3"><a href="#cb1868-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Criei alguns objetos</span></span>
<span id="cb1868-4"><a href="#cb1868-4" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb1868-5"><a href="#cb1868-5" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb1868-6"><a href="#cb1868-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1868-7"><a href="#cb1868-7" aria-hidden="true" tabindex="-1"></a><span class="co"># ls() lista todos os objetos criados</span></span>
<span id="cb1868-8"><a href="#cb1868-8" aria-hidden="true" tabindex="-1"></a><span class="co"># em meu global environment</span></span>
<span id="cb1868-9"><a href="#cb1868-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span>(<span class="at">envir =</span> <span class="fu">globalenv</span>())</span></code></pre></div>
<p></p>
<pre><code>## [1] &quot;a&quot; &quot;b&quot;</code></pre>
<p>Portanto, um <em>environment</em> é uma espécie de caixa ou um espaço reservado para guardar um certo conjunto de objetos. O seu <em>global environment</em> é um desses <em>environments</em>, onde ficam todos os seus objetos que você normalmente cria em sua sessão. Todavia, sempre existem vários outros <em>environments</em> ativos em sua sessão, e você também pode criar objetos dentro desses outros <em>environments</em> (caso seja de seu desejo).</p>
</div>
<div id="sec:environment_exec" class="section level2" number="18.5">
<h2 number="18.5"><span class="header-section-number">18.5</span> O <em>environment</em> de execução de uma função</h2>
<p>Toda função no R, possui o que nós chamamos de <em>function environment</em>, que corresponde ao <em>environment</em> no qual elas foram criadas. No exemplo abaixo, estamos identificando quais são esses <em>environments</em> para as funções <code>filter()</code> do pacote <code>dplyr</code>, e <code>seq()</code> do pacote <code>base</code>.</p>
<p></p>
<div class="sourceCode" id="cb1870"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1870-1"><a href="#cb1870-1" aria-hidden="true" tabindex="-1"></a>rlang<span class="sc">::</span><span class="fu">fn_env</span>(dplyr<span class="sc">::</span>filter)</span></code></pre></div>
<pre><code>## &lt;environment: namespace:dplyr&gt;</code></pre>
<div class="sourceCode" id="cb1872"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1872-1"><a href="#cb1872-1" aria-hidden="true" tabindex="-1"></a>rlang<span class="sc">::</span><span class="fu">fn_env</span>(seq)</span></code></pre></div>
<pre><code>## &lt;environment: namespace:base&gt;</code></pre>
<p></p>
<p>Como um outro exemplo, caso eu crie uma nova função em minha sessão, perceba que o <em>environment</em> a qual ela pertence, se trata justamente do <em>global environment</em> (<code>R_GlobalEnv</code>).</p>
<p></p>
<div class="sourceCode" id="cb1874"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1874-1"><a href="#cb1874-1" aria-hidden="true" tabindex="-1"></a>soma <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y){</span>
<span id="cb1874-2"><a href="#cb1874-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(x <span class="sc">+</span> y)</span>
<span id="cb1874-3"><a href="#cb1874-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1874-4"><a href="#cb1874-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1874-5"><a href="#cb1874-5" aria-hidden="true" tabindex="-1"></a>rlang<span class="sc">::</span><span class="fu">fn_env</span>(soma)</span></code></pre></div>
<p></p>
<pre><code>## &lt;environment: R_GlobalEnv&gt;</code></pre>
<p>Por outro lado, se eu quiser, por exemplo, criar uma função chamada <code>g</code> dentro de uma outra função chamada <code>h</code>, o <em>function environment</em> de <code>g()</code> será o <em>environment</em> de execução de <code>h()</code>. Pois a função <code>g()</code> foi criada dentro deste <em>environment</em> de <code>h()</code>.</p>
<p></p>
<div class="sourceCode" id="cb1876"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1876-1"><a href="#cb1876-1" aria-hidden="true" tabindex="-1"></a>h <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb1876-2"><a href="#cb1876-2" aria-hidden="true" tabindex="-1"></a>  g <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb1876-3"><a href="#cb1876-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="dv">5</span>)</span>
<span id="cb1876-4"><a href="#cb1876-4" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1876-5"><a href="#cb1876-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1876-6"><a href="#cb1876-6" aria-hidden="true" tabindex="-1"></a>  g_env <span class="ot">&lt;-</span> rlang<span class="sc">::</span><span class="fu">fn_env</span>(g)</span>
<span id="cb1876-7"><a href="#cb1876-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(g_env)</span>
<span id="cb1876-8"><a href="#cb1876-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1876-9"><a href="#cb1876-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1876-10"><a href="#cb1876-10" aria-hidden="true" tabindex="-1"></a><span class="fu">h</span>()</span></code></pre></div>
<pre><code>## &lt;environment: 0x000001a249893c28&gt;</code></pre>
<p></p>
<p>Portanto, as funções também possuem o que chamamos de <em>environment</em> de execução, que se trata do <em>environment</em> no qual os seus cálculos são executados. Ou seja, sempre que você executa uma função, os cálculos realizados por essa função são feitos em um <em>environment</em> separado de seu <em>global environment</em>.</p>
<p>Como expomos ao final do capítulo de <a href="#sec:functions_chapter">Funções</a>, quando uma função é executada, um novo <em>environment</em> vazio é criado. Em seguida, um objeto para cada argumento fornecido à função é criado dentro desse novo <em>environment</em>. Por último, todos os comandos presentes no body dessa função são executados dentro desse novo <em>environment</em> <span class="citation">(<a href="#ref-chambers2016" role="doc-biblioref">Chambers 2016</a>, p 52)</span>.</p>
<p>Por esse motivo, você não consegue visualizar com facilidade, os resultados que são gerados por essa função, pois os seus cálculos estão sendo realizados em um <em>environment</em> diferente do <em>environment</em> no qual você se encontra (<em>global environment</em>).</p>
<p>Em contrapartida, essa característica garante que uma função não afete os objetos de seu <em>global environment</em>. Isso também permite que uma função do R seja <em>self-contained</em>, de modo que, os seus resultados dependam apenas dos valores de seus argumentos, e não dos objetos de outros <em>environments</em> presentes em sua sessão <span class="citation">(<a href="#ref-chambers2016" role="doc-biblioref">Chambers 2016</a>)</span>.</p>
<p>Para demonstrar esse conceito de <em>environment</em> de execução, estou criando abaixo uma função chamada <code>f_env</code>, que nos retorna justamente o endereço do <em>environment</em> no qual essa função executou a soma entre 4 e 5. Perceba que a cada momento em que eu executo essa função, ela me retorna um endereço diferente.</p>
<p>Logo, esses <em>environments</em> de execução são temporários (ou efêmeros se preferir), e utilizados uma única vez pela função. Por causa disso, no R, cada execução de uma função é independente uma da outra. A função não sabe absolutamente nada sobre o que aconteceu na última vez em que ela foi avaliada.</p>
<p></p>
<div class="sourceCode" id="cb1878"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1878-1"><a href="#cb1878-1" aria-hidden="true" tabindex="-1"></a>f_env <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb1878-2"><a href="#cb1878-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1878-3"><a href="#cb1878-3" aria-hidden="true" tabindex="-1"></a>  soma <span class="ot">&lt;-</span> <span class="dv">4</span> <span class="sc">+</span> <span class="dv">5</span></span>
<span id="cb1878-4"><a href="#cb1878-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1878-5"><a href="#cb1878-5" aria-hidden="true" tabindex="-1"></a>  env <span class="ot">&lt;-</span> <span class="fu">environment</span>()</span>
<span id="cb1878-6"><a href="#cb1878-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1878-7"><a href="#cb1878-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(env)</span>
<span id="cb1878-8"><a href="#cb1878-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1878-9"><a href="#cb1878-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1878-10"><a href="#cb1878-10" aria-hidden="true" tabindex="-1"></a><span class="fu">f_env</span>()</span></code></pre></div>
<pre><code>## &lt;environment: 0x000001a249ad1b58&gt;</code></pre>
<div class="sourceCode" id="cb1880"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1880-1"><a href="#cb1880-1" aria-hidden="true" tabindex="-1"></a><span class="fu">f_env</span>()</span></code></pre></div>
<pre><code>## &lt;environment: 0x000001a249b29ba0&gt;</code></pre>
<p></p>
<!-- Contudo, só porque esses *environments* são temporários, isso não significa que eles são deletados, ou, que os objetos criados durante a execução da função, são eliminados após a sua finalização. Perceba no exemplo abaixo, que eu consigo acessar normalmente o objeto `soma`, após a execução da função `f()`. Porém, para encontrar esse objeto, eu preciso obrigatoriamente do endereço do *environment* de execução, o qual foi salvo no objeto `x`. -->
<!-- ```{r} -->
<!-- f <- function(){ -->
<!--   soma <- 4 + 5 -->
<!--   env <- environment() -->
<!--   return(env) -->
<!-- } -->
<!-- x <- f() -->
<!-- get("soma", envir = x) -->
<!-- ``` -->
<p>O exemplo abaixo, demonstra essa ideia de que os <em>environments</em> de execução asseguram que toda função não altere os nossos objetos salvos em nosso <em>global environment</em>. Dentro da função <code>f()</code> mostrada abaixo, estou criando um objeto chamado <code>y</code> com o valor de 100. Porém, mesmo após executar essa função, o objeto <code>y</code> que está salvo em meu <em>global environment</em> continua armazenando o valor 1.</p>
<p></p>
<div class="sourceCode" id="cb1882"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1882-1"><a href="#cb1882-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Crie um objeto y em meu global environment</span></span>
<span id="cb1882-2"><a href="#cb1882-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb1882-3"><a href="#cb1882-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1882-4"><a href="#cb1882-4" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb1882-5"><a href="#cb1882-5" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb1882-6"><a href="#cb1882-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1882-7"><a href="#cb1882-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1882-8"><a href="#cb1882-8" aria-hidden="true" tabindex="-1"></a><span class="do">### Executo a função f()</span></span>
<span id="cb1882-9"><a href="#cb1882-9" aria-hidden="true" tabindex="-1"></a><span class="fu">f</span>()</span>
<span id="cb1882-10"><a href="#cb1882-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1882-11"><a href="#cb1882-11" aria-hidden="true" tabindex="-1"></a><span class="do">### O valor de y continua igual a 1</span></span>
<span id="cb1882-12"><a href="#cb1882-12" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(y)</span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<p></p>
<div id="os-environments-de-pacotes" class="section level3" number="18.5.1">
<h3 number="18.5.1"><span class="header-section-number">18.5.1</span> Os <em>environments</em> de pacotes</h3>
<p>Portanto, o trabalho de um <em>environment</em> no R, é o de vincular, ou de associar um conjunto de nomes (os nomes dos objetos), a seus respectivos conjuntos de valores . Ou seja, um dos principais papéis que um <em>environment</em> desempenha no R, é o de organizar um conjunto de objetos, de forma que o R seja capaz de diferenciar dois ou mais objetos com o mesmo nome.</p>
<p>Um bom exemplo disso, é a função <code>filter()</code> do pacote <code>dplyr</code>, que vimos no capítulo 4. Pois nós temos dentre os pacotes básicos do R, mais especificamente no pacote <code>stats</code>, uma outra função também chamada <code>filter()</code>. Por isso, sempre que chamamos pelo pacote <code>dplyr</code> através de <code>library()</code>, a seguinte mensagem aparece, nos informando que há um choque entre as duas funções.</p>
<p></p>
<div class="sourceCode" id="cb1884"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1884-1"><a href="#cb1884-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code></pre></div>
<p></p>
<p></p>
<pre class="text"><code>Attaching package: ‘dplyr’

The following objects are masked from ‘package:stats’:

    filter, lag</code></pre>
<p></p>
<p>Essa mensagem está nos informando, que o pacote <code>dplyr</code> possui funções com os mesmos nomes das funções <code>filter()</code> e <code>lag()</code> do pacote <code>stats</code>, e, que por esse motivo, essas funções seriam “escondidas” de forma a evitar conflitos.</p>
<p>Portanto, após carregarmos o pacote <code>dplyr</code> com <code>library()</code>, as funções <code>filter()</code> e <code>lag()</code> do pacote <code>stats</code> são “escondidas.” Como resultado, se nós chamarmos pela função <code>filter()</code> no console, estaremos utilizando a função do pacote <code>dplyr</code>, e não a função do pacote <code>stats</code>.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/environments.png" alt="Ambientes de pacotes no R" width="80%" />
<p class="caption">
(#fig:unnamed-chunk-1000)Ambientes de pacotes no R
</p>
</div>
<p></p>
<p>Portanto, essas duas funções <code>filter()</code>, são funções diferentes, que servem para propósitos diferentes. O único fator que permite ao R, diferenciar essas funções uma da outra, é o fato de que elas pertencem a ambientes, ou <em>environments</em> diferentes, como demonstrado na figura 18.1. Lembre-se que todas as funções estão associadas a um <em>environment</em> específico. Por isso, nós podemos diferenciar as funções <code>filter()</code> e <code>lag()</code> de ambos os pacotes (<code>dplyr</code> e <code>stats</code>), através do nome do <em>environment</em> ao qual essas funções pertencem.</p>
<p>Pacotes do R são um caso especial, pois eles contêm dois <em>environments</em> diferentes que se relacionam entre si. Um é o <em>environment</em> propriamente dito do pacote, que contém os seus respectivos objetos, e um outro comumente chamado de <em>namespace</em>. Essa diferenciação só será útil na prática, quando você estiver desenvolvendo um novo pacote para o R.</p>
<p>Ou seja, não se preocupe em entender agora a diferença entre esses dois espaços. Apenas entenda que, pacotes no R, vão além de simples <em>environments</em>. Também entenda que, os objetos e funções de todo pacote do R estão sempre armazenados no <em>environment</em> deste pacote, o qual é um <em>environment</em> separado de seu <em>global environment</em>.</p>
<p>Tendo isso em mente, quando desejamos utilizar uma função que está em conflito com uma outra função de um outro pacote, nós devemos definir de alguma forma, o <em>environment</em> do pacote no qual o R deve procurar pela função que você está chamando.</p>
<p>No caso de pacotes, podemos acessar funções definidas em seus respectivos <em>environments</em>, ao fornecer o nome do pacote que contém essa função, seguido do operador <code>::</code>, e do nome da função que desejamos utilizar. Veja o exemplo abaixo, em que estamos utilizando a função <code>filter()</code> do pacote <code>stats</code>.</p>
<p></p>
<div class="sourceCode" id="cb1886"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1886-1"><a href="#cb1886-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">ts</span>(<span class="fu">rnorm</span>(<span class="dv">100</span>), <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1990</span>), <span class="at">end =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">1998</span>), <span class="at">frequency =</span> <span class="dv">12</span>)</span>
<span id="cb1886-2"><a href="#cb1886-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1886-3"><a href="#cb1886-3" aria-hidden="true" tabindex="-1"></a>stats<span class="sc">::</span><span class="fu">filter</span>(x, <span class="at">filter =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.8</span>, <span class="fl">0.2</span>))</span></code></pre></div>
<pre><code>##             Jan         Feb         Mar         Apr         May
## 166                                                            
## 167 -0.11875469  1.91074629  1.68731392 -0.41976451 -0.62389218
## 168 -0.90010012 -0.67343101  0.88807883  1.50201948  2.00649477
## 169 -0.05060343 -0.23506634 -0.74108286 -0.64042848  0.36716686
## 170  0.01642278  0.22333764  1.43799155  1.52000248  1.58566817
##             Jun         Jul         Aug         Sep         Oct
## 166                                                          NA
## 167  0.17942147  1.20670912  1.87466329  0.79380123  0.55794457
## 168  0.45995674 -0.16749206 -0.12045702 -1.25194953 -1.04400313
## 169  0.15365047 -0.68626295  0.33691878  0.91669945  0.76497798
## 170          NA                                                
##             Nov         Dec
## 166 -0.23944009 -0.41419107
## 167 -0.21128700 -0.49462199
## 168 -0.23921563 -0.29579158
## 169  0.15428223  0.36872766
## 170</code></pre>
<p></p>
</div>
</div>
<div id="acessando-outros-environments" class="section level2" number="18.6">
<h2 number="18.6"><span class="header-section-number">18.6</span> Acessando outros environments</h2>
<p>Já mostramos que você pode acessar o <em>environment</em> atual através da função <code>environment()</code>. Também mostramos que você pode acessar o seu <em>global environment</em> por meio da função <code>globalenv()</code>. Agora, a questão que fica é: como podemos acessar outros <em>environments</em> que estão presentes no caminho de pesquisa do R?</p>
<p>Por exemplo, como podemos acessar o <em>environment</em> do pacote <code>dplyr</code>? Para isso podemos utilizar as funções <code>as.environment()</code> e <code>rlang::as_environment()</code>. Ambas as funções desempenham basicamente o mesmo trabalho. Utilizando essas funções, podemos acessar o <em>environment</em> do pacote <code>dplyr</code> ao fornecer o nome de seu <em>environment</em>, como demonstrado abaixo.</p>
<p>Perceba que, se você utilizar a função <code>as.environment()</code> (dos pacotes básicos do R), você precisa fornecer o nome completo do <em>environment</em>. Por se tratar do <em>environment</em> de um pacote, o nome deste pacote precisa ser antecedido por <code>package:</code>. Por outro lado, a função <code>rlang::as_environment()</code> é inteligente o suficiente para pesquisar por um pacote com o nome que você digitou.</p>
<p></p>
<div class="sourceCode" id="cb1888"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1888-1"><a href="#cb1888-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.environment</span>(<span class="st">&quot;package:dplyr&quot;</span>)</span></code></pre></div>
<pre><code>## &lt;environment: package:dplyr&gt;
## attr(,&quot;name&quot;)
## [1] &quot;package:dplyr&quot;
## attr(,&quot;path&quot;)
## [1] &quot;C:/Users/Pedro/Documents/R/win-library/4.1/dplyr&quot;</code></pre>
<div class="sourceCode" id="cb1890"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1890-1"><a href="#cb1890-1" aria-hidden="true" tabindex="-1"></a>rlang<span class="sc">::</span><span class="fu">as_environment</span>(<span class="st">&quot;dplyr&quot;</span>)</span></code></pre></div>
<pre><code>## &lt;environment: package:dplyr&gt;
## attr(,&quot;name&quot;)
## [1] &quot;package:dplyr&quot;
## attr(,&quot;path&quot;)
## [1] &quot;C:/Users/Pedro/Documents/R/win-library/4.1/dplyr&quot;</code></pre>
<p></p>
<p>Como um outro exemplo, vamos refletir sobre o objeto <code>LETTERS</code>. Esse objeto está sempre disponível em sua sessão no R. Pois ele pertence ao <em>environment</em> do pacote <code>base</code> (o qual faz parte dos pacotes básicos da linguagem, e, portanto, é <strong>sempre</strong> carregado para a sua sessão).</p>
<p>Vamos supor que eu crie um novo objeto chamado <code>LETTERS</code> em meu <em>global environment</em>. Como resultado, se eu procurar por este objeto no console do R, o objeto encontrado será este novo objeto salvo em meu <em>global environment</em>. Pois o processo de busca do R geralmente se inicia pelo <em>global environment</em>.</p>
<p></p>
<div class="sourceCode" id="cb1892"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1892-1"><a href="#cb1892-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Este é o objeto LETTERS salvo no</span></span>
<span id="cb1892-2"><a href="#cb1892-2" aria-hidden="true" tabindex="-1"></a><span class="do">### *environment* do pacote `base`</span></span>
<span id="cb1892-3"><a href="#cb1892-3" aria-hidden="true" tabindex="-1"></a>LETTERS</span></code></pre></div>
<p></p>
<p></p>
<pre><code>##  [1] &quot;A&quot; &quot;B&quot; &quot;C&quot; &quot;D&quot; &quot;E&quot; &quot;F&quot; &quot;G&quot; &quot;H&quot; &quot;I&quot; &quot;J&quot; &quot;K&quot; &quot;L&quot; &quot;M&quot; &quot;N&quot; &quot;O&quot; &quot;P&quot; &quot;Q&quot;
## [18] &quot;R&quot; &quot;S&quot; &quot;T&quot; &quot;U&quot; &quot;V&quot; &quot;W&quot; &quot;X&quot; &quot;Y&quot; &quot;Z&quot;</code></pre>
<p></p>
<p></p>
<div class="sourceCode" id="cb1894"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1894-1"><a href="#cb1894-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Estou criando um novo objeto LETTERS em</span></span>
<span id="cb1894-2"><a href="#cb1894-2" aria-hidden="true" tabindex="-1"></a><span class="do">### meu global environment</span></span>
<span id="cb1894-3"><a href="#cb1894-3" aria-hidden="true" tabindex="-1"></a>LETTERS <span class="ot">&lt;-</span> <span class="st">&quot;a&quot;</span></span>
<span id="cb1894-4"><a href="#cb1894-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1894-5"><a href="#cb1894-5" aria-hidden="true" tabindex="-1"></a><span class="do">### Agora, se eu procurar por um objeto</span></span>
<span id="cb1894-6"><a href="#cb1894-6" aria-hidden="true" tabindex="-1"></a><span class="do">### LETTERS, o R vai encontrar primeiro o objeto </span></span>
<span id="cb1894-7"><a href="#cb1894-7" aria-hidden="true" tabindex="-1"></a><span class="do">### salvo em meu global environment</span></span>
<span id="cb1894-8"><a href="#cb1894-8" aria-hidden="true" tabindex="-1"></a>LETTERS</span></code></pre></div>
<pre><code>## [1] &quot;a&quot;</code></pre>
<p></p>
<p>Vale destacar que, o objeto <code>LETTERS</code> original, ainda existe dentro do <em>environment</em> do pacote <code>base</code>. A única diferença é que, antes de chegar ao <em>environment</em> do pacote <code>base</code>, o R está encontrando primeiro o objeto <code>LETTERS</code> salvo em meu global <em>environment</em>. Logo, ele retorna esse objeto contendo o valor <code>"a"</code>, ao invés do objeto original.</p>
<p>Pelo fato de termos dois objetos <code>LETTERS</code> diferentes em nossa sessão, para acessarmos o objeto <code>LETTERS</code> original, precisamos definir o <em>environment</em> no qual o R deve pesquisar por este objeto. Como este objeto <code>LETTERS</code> pertence a um pacote do R, podemos utilizar a mesma estrutura que utilizamos para acessar a função <code>filter()</code> do pacote <code>stats</code>, como demonstrado abaixo.</p>
<p></p>
<div class="sourceCode" id="cb1896"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1896-1"><a href="#cb1896-1" aria-hidden="true" tabindex="-1"></a>base<span class="sc">::</span>LETTERS</span></code></pre></div>
<pre><code>##  [1] &quot;A&quot; &quot;B&quot; &quot;C&quot; &quot;D&quot; &quot;E&quot; &quot;F&quot; &quot;G&quot; &quot;H&quot; &quot;I&quot; &quot;J&quot; &quot;K&quot; &quot;L&quot; &quot;M&quot; &quot;N&quot; &quot;O&quot; &quot;P&quot; &quot;Q&quot;
## [18] &quot;R&quot; &quot;S&quot; &quot;T&quot; &quot;U&quot; &quot;V&quot; &quot;W&quot; &quot;X&quot; &quot;Y&quot; &quot;Z&quot;</code></pre>
<p></p>
<p>Contudo, como uma outra alternativa, também podemos utilizar a função <code>get()</code> para especificarmos melhor, qual dos dois objetos desejamos acessar. Pois essa função possui um argumento (<code>envir</code>) onde podemos definir o <em>environment</em> em que o objeto deve ser pesquisado.</p>
<p>Como exemplo, para acessarmos o objeto <code>LETTERS</code> original, precisamos pesquisar por ele dentro do <em>environment</em> do pacote <code>base</code>. Por isso, eu forneço abaixo, o <em>environment</em> deste pacote ao argumento <code>envir</code>.</p>
<p></p>
<div class="sourceCode" id="cb1898"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1898-1"><a href="#cb1898-1" aria-hidden="true" tabindex="-1"></a><span class="fu">get</span>(<span class="st">&quot;LETTERS&quot;</span>, <span class="at">envir =</span> <span class="fu">as.environment</span>(<span class="st">&quot;package:base&quot;</span>))</span></code></pre></div>
<pre><code>##  [1] &quot;A&quot; &quot;B&quot; &quot;C&quot; &quot;D&quot; &quot;E&quot; &quot;F&quot; &quot;G&quot; &quot;H&quot; &quot;I&quot; &quot;J&quot; &quot;K&quot; &quot;L&quot; &quot;M&quot; &quot;N&quot; &quot;O&quot; &quot;P&quot; &quot;Q&quot;
## [18] &quot;R&quot; &quot;S&quot; &quot;T&quot; &quot;U&quot; &quot;V&quot; &quot;W&quot; &quot;X&quot; &quot;Y&quot; &quot;Z&quot;</code></pre>
<p></p>
<p>Portanto, mesmo que eu crie um objeto em minha sessão, ou em outras palavras, um objeto em meu <em>global environment</em> chamado <code>LETTERS</code>, o R ainda é capaz de diferenciar os dois objetos denominados <code>LETTERS</code>, através do <em>environment</em> ao qual eles estão associados. Esta ideia está apresentada de forma visual na figura 18.2.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/environments2.png" alt="Representação de environments" width="90%" />
<p class="caption">
(#fig:unnamed-chunk-1008)Representação de environments
</p>
</div>
<p></p>
<p>Após criarmos um novo objeto <code>LETTERS</code>, se eu chamar por este objeto no console, o resultado será o valor contido no objeto <code>LETTERS</code> do meu <em>global environment</em>. Isso ocorre, pois o R irá geralmente procura por um objeto primeiro em seu <em>global environment</em>. Depois ele vai procurar por este objeto ao qual você requisitou em outros <em>environments</em>.</p>
<p>Esse caminho de <em>environments</em> pelo qual o R percorre durante sua procura, é comumente chamado por <em>search path</em> (ou “caminho de busca”). Como vimos acima, podemos utilizar a função <code>get()</code> sempre que desejamos contornar esse caminho padrão seguido pelo R, e, pesquisar por nosso objeto em um <em>environment</em> específico.</p>
<p>Concluindo, nós geralmente desejamos acessar um <em>environment</em> específico, quando temos dois objetos existentes em nossa sessão que possuem o mesmo nome, porém, são diferentes entre si. Nesse caso, precisamos unir o nome deste objeto, e o <em>environment</em> ao qual ele pertence, para acessarmos o objeto correto.</p>
<p>Caso esse objeto em questão, pertença a um pacote do R específico, podemos utilizar a estrutura <code>pacote::objeto</code> para acessarmos esse objeto. No entanto, se esse objeto pertence a um outro tipo de <em>environment</em>, podemos utilizar a função <code>get()</code> e seu argumento <code>envir</code>, para definirmos em que <em>environment</em> específico, o objeto deve ser pesquisado.</p>
</div>
<div id="o-sistema-de-scoping-do-r" class="section level2" number="18.7">
<h2 number="18.7"><span class="header-section-number">18.7</span> O sistema de <em>scoping</em> do R</h2>
<p>Sempre que você digita o nome de um objeto, o R inicia um processo de busca ao longo de todos os <em>environments</em> ativos em sua sessão, atrás de um objeto que possua o mesmo nome do que você digitou. Esse processo de busca é chamado de <em>scoping</em>, ou, <em>lexical scoping</em>.</p>
<p>Antes de explicar como esse mecanismo de busca funciona, precisamos descrever o que é um <em>parent environment</em>. Pois eles determinam qual o caminho que o R vai perseguir durante a sua pesquisa.</p>
<div id="compreendendo-parent-environments" class="section level3" number="18.7.1">
<h3 number="18.7.1"><span class="header-section-number">18.7.1</span> Compreendendo <em>parent environments</em></h3>
<p>Todo <em>environment</em> possui um <em>environment</em> “pai.” Dentro da comunidade, esse tipo de <em>environment</em> é chamado de <em>parent environment</em>. Como exemplo, vamos supor que você crie um novo <em>environment</em> a partir de seu global <em>environment</em>.</p>
<p>Para criar um novo <em>environment</em>, você pode utilizar as funções <code>rlang::env()</code> e <code>new.env()</code>. Perceba abaixo, que eu não apenas crio esse novo <em>environment</em> chamado <code>env1</code>, mas eu também já adiciono dois novos objetos (<code>a</code> e <code>b</code>) a esse <em>environment</em>. Esses objetos <code>a</code> e <code>b</code> guardam os valores 1 e 2, respectivamente.</p>
<p></p>
<div class="sourceCode" id="cb1900"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1900-1"><a href="#cb1900-1" aria-hidden="true" tabindex="-1"></a>env1 <span class="ot">&lt;-</span> rlang<span class="sc">::</span><span class="fu">env</span>(<span class="at">a =</span> <span class="dv">1</span>, <span class="at">b =</span> <span class="dv">2</span>)</span></code></pre></div>
<p></p>
<p>Como eu não defini explicitamente dentro da função <code>rlang::env()</code>, um <em>parent environment</em> para esse novo <em>environment</em>, a função vai, por padrão, criar esse novo <em>environment</em> a partir do <em>environment</em> atual, isto é, o <em>environment</em> no qual essa função foi chamada. No exemplo acima, esse <em>environment</em> atual é o global <em>environment</em>, porque eu estou executando a função diretamente em meu console do R.</p>
<p>Por esse motivo, o <em>parent environment</em> de <code>env1</code> é o meu global <em>environment</em>. Eu posso representar essa relação de maneira visual, como na figura 18.3. Cada retângulo nessa figura é um <em>environment</em> específico. Em todas as figuras a seguir, o <em>environment</em> filho vai estar sempre apontando para o <em>environment</em> pai com uma seta azul.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/parent1.png" alt="Apresentando *parent environments* - Parte 1" width="80%" />
<p class="caption">
(#fig:unnamed-chunk-1010)Apresentando <em>parent environments</em> - Parte 1
</p>
</div>
<p></p>
<p>Como um outro exemplo, eu posso criar um outro enviroment chamado <code>env2</code>. Porém, dessa vez, esse <em>environment</em> é criado a partir de <code>env1</code>. Ou seja, <code>env1</code> se torna o <em>parent environment</em> de <code>env2</code>. Repare que eu crio 3 novos objetos (<code>e</code>, <code>d</code> e <code>c</code>) dentro desse novo <em>environment</em>.</p>
<p></p>
<div class="sourceCode" id="cb1901"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1901-1"><a href="#cb1901-1" aria-hidden="true" tabindex="-1"></a>env2 <span class="ot">&lt;-</span> rlang<span class="sc">::</span><span class="fu">env</span>(env1, <span class="at">c =</span> <span class="dv">3</span>, <span class="at">d =</span> <span class="dv">4</span>, <span class="at">e =</span> <span class="dv">5</span>)</span></code></pre></div>
<p></p>
<p>Para descobrir o <em>parent environment</em> de um <em>environment</em> qualquer, você pode utilizar a função <code>parent.env()</code>. Veja no exemplo abaixo que, o resultado do comando <code>parent.env(env2)</code> é justamente o endereço de <code>env1</code>.</p>
<p></p>
<div class="sourceCode" id="cb1902"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1902-1"><a href="#cb1902-1" aria-hidden="true" tabindex="-1"></a><span class="fu">parent.env</span>(env2)</span></code></pre></div>
<pre><code>## &lt;environment: 0x000001a24b2f41a0&gt;</code></pre>
<div class="sourceCode" id="cb1904"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1904-1"><a href="#cb1904-1" aria-hidden="true" tabindex="-1"></a>env1</span></code></pre></div>
<pre><code>## &lt;environment: 0x000001a24b2f41a0&gt;</code></pre>
<p></p>
<p>Caso eu aplique essa função sobre <code>env1</code>, podemos confirmar que o meu global <em>environment</em> é de fato o pai desse <em>environment</em>.</p>
<p></p>
<div class="sourceCode" id="cb1906"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1906-1"><a href="#cb1906-1" aria-hidden="true" tabindex="-1"></a><span class="fu">parent.env</span>(env1)</span></code></pre></div>
<p></p>
<pre><code>## &lt;environment: R_GlobalEnv&gt;</code></pre>
<p>Sendo assim, podemos atualizar a nossa representação visual da seguinte maneira:</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/parent2.png" alt="Apresentando *parent environments* - Parte 2" width="100%" />
<p class="caption">
(#fig:unnamed-chunk-1014)Apresentando <em>parent environments</em> - Parte 2
</p>
</div>
<p></p>
<p>Vale destacar que, a figura 18.4 acima não mostra um <em>parent environment</em> para o meu global <em>environment</em>, mas isso não significa que esse <em>environment</em> não existe. Eu apenas o omiti acima, para manter a figura simples.</p>
<p>Lembre-se sempre que, todo <em>environment</em> possui um <em>parent environment</em>. Como exemplo, perceba abaixo que, o <em>parent environment</em> de meu global <em>environment</em> é (neste momento) o <em>environment</em> do pacote <code>dplyr</code>, que foi o último pacote que eu carreguei para a minha sessão.</p>
<p></p>
<div class="sourceCode" id="cb1908"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1908-1"><a href="#cb1908-1" aria-hidden="true" tabindex="-1"></a><span class="fu">parent.env</span>(<span class="fu">globalenv</span>())</span></code></pre></div>
<p></p>
<pre><code>## &lt;environment: package:dplyr&gt;
## attr(,&quot;name&quot;)
## [1] &quot;package:dplyr&quot;
## attr(,&quot;path&quot;)
## [1] &quot;C:/Users/Pedro/Documents/R/win-library/4.1/dplyr&quot;</code></pre>
<p>Nos manuais internos do R, o <em>parent environment</em> é muitas vezes chamado de <em>enclosing environment</em>, isto é, o ambiente que “envolve” ou que “contém” os demais <em>environments</em> <span class="citation">(<a href="#ref-Rlanguage" role="doc-biblioref">R Core Team 2020b</a>)</span>. Ou seja, de certa forma, o <em>environment</em> <code>env1</code> envolve ou contém <code>env2</code> dentro dele, e, o meu global <em>environment</em> contém <code>env1</code>.</p>
</div>
<div id="o-environment-vazio-ou-empty-environment" class="section level3" number="18.7.2">
<h3 number="18.7.2"><span class="header-section-number">18.7.2</span> O <em>environment</em> vazio ou <em>empty environment</em></h3>
<p>Eventualmente, toda sequência de <em>environments</em> termina em um <em>environment</em> vazio (ou <em>empty environment</em>). Em outras palavras, se você começar a subir pela árvore genealógica de seus <em>environments</em>, seguindo <em>parent environment</em> atrás de <em>parent environment</em>, você vai eventualmente chegar a um empty <em>environment</em>. Que é um tipo especial de <em>environment</em>, pois ele é a exceção à regra de que todo <em>environment</em> possui um pai.</p>
<p>Portanto, um empty <em>environment</em> é identificado pelo apelido <code>R_EmptyEnv</code> e, ele não possui um <em>parent environment</em>. Você pode acessar esse <em>environment</em> através da função <code>emptyenv()</code>.</p>
<p></p>
<div class="sourceCode" id="cb1910"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1910-1"><a href="#cb1910-1" aria-hidden="true" tabindex="-1"></a><span class="fu">emptyenv</span>()</span></code></pre></div>
<pre><code>## &lt;environment: R_EmptyEnv&gt;</code></pre>
<p></p>
<p>Você pode comprovar a afirmação do parágrafo acima, ao tentar aplicar a função <code>parent.env()</code> sobre esse <em>environment</em>. Perceba abaixo que um erro é retornado, avisando que esse <em>environment</em> não possui um <em>environment</em> “pai.”</p>
<p></p>
<div class="sourceCode" id="cb1912"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1912-1"><a href="#cb1912-1" aria-hidden="true" tabindex="-1"></a><span class="fu">parent.env</span>(<span class="fu">emptyenv</span>())</span></code></pre></div>
<p></p>
<pre><code>## Error in parent.env(emptyenv()) : the empty *environment* has no parent</code></pre>
<p>Tendo isso em mente, esse <em>environment</em> vazio representa o final de toda sequência de <em>environments</em>. De certa maneira, esse <em>environment</em> é o último <em>parent environment</em> de todos. Assim que o R atinge esse <em>environment</em>, ele encerra o seu processo de pesquisa, pois ele não tem mais para onde ir.</p>
<p>Se você refletir sobre isso, você pode chegar a conclusão de que, se o R chegar a esse <em>environment</em> vazio durante o seu processo de pesquisa, isso significa que o R não pôde encontrar o objeto que você requisitou. Pois ao chegar a esse <em>environment</em> vazio, o R já vai ter visitado todos os outros <em>environments</em> ativos em sua sessão.</p>
</div>
<div id="o-caminho-de-busca-ou-search-path-do-r" class="section level3" number="18.7.3">
<h3 number="18.7.3"><span class="header-section-number">18.7.3</span> O caminho de busca ou <em>search path</em> do R</h3>
<p>Para encontrar o objeto pelo qual você requisitou, o R visita <em>environment</em> por <em>environment</em>, em busca desse objeto, até atingir um empty <em>environment</em>. A lista de <em>environments</em> que o R visita durante esse processo de pesquisa, é chamada de <em>search path</em> (ou, o caminho de pesquisa). Você pode descobrir qual é esse <em>search path</em>, através da função <code>search()</code>.</p>
<p>Basta executar essa função, que um vetor contendo os nomes de todos esses <em>environments</em> será retornado como resultado. Vale destacar que, os nomes desses <em>environments</em> vão estar precisamente na ordem em que eles são visitados, durante este processo de pesquisa.</p>
<p>Perceba abaixo que, o <em>environment</em> <code>.GlobalEnv</code> (que é um outro apelido para o <em>global environment</em>) é o primeiro da lista. Logo, o seu <em>global environment</em> é o primeiro <em>environment</em> visitado pelo R. Por outro lado, o <em>environment</em> do pacote <code>base</code> é o último <em>environment</em> visitado.</p>
<p></p>
<div class="sourceCode" id="cb1914"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1914-1"><a href="#cb1914-1" aria-hidden="true" tabindex="-1"></a><span class="fu">search</span>()</span></code></pre></div>
<p></p>
<pre><code>## [1]  &quot;.GlobalEnv&quot;        &quot;tools:rstudio&quot;     &quot;package:stats&quot;
## [4]  &quot;package:graphics&quot;  &quot;package:grDevices&quot; &quot;package:utils&quot;
## [7]  &quot;package:datasets&quot;  &quot;package:methods&quot;   &quot;Autoloads&quot;
## [10] &quot;package:base&quot;</code></pre>
<p>Portanto, o <em>search path</em> do R sempre segue essa mesma estrutura. Ele sempre se inicia pelo seu <em>global environment</em>, seguido dos <em>environments</em> dos pacotes que estão carregados em sua sessão, que por sua vez, são seguidos pelo <em>environment</em> <code>Autoloads</code> e pelo <em>environment</em> do pacote <code>base</code>.</p>
<p>O <em>environment</em> Autoloads é basicamente responsável por carregar algumas bases de dados padrão do R. Porém, tais bases são carregadas de maneira <em>lazy</em> (preguiçosa), isto é, essas bases são carregadas para a memória RAM apenas no momento em que você efetivamente requisita por elas.</p>
<p>Já o <em>environment</em> do pacote <code>base</code> é sempre o último <em>environment</em> dessa lista. Isso significa que, após esse <em>environment</em>, temos um <em>environment</em> vazio que encerra o mecanismo de pesquisa do R, como está demonstrado abaixo.</p>
<p></p>
<div class="sourceCode" id="cb1916"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1916-1"><a href="#cb1916-1" aria-hidden="true" tabindex="-1"></a><span class="fu">parent.env</span>(<span class="fu">as.environment</span>(<span class="st">&quot;package:base&quot;</span>))</span></code></pre></div>
<pre><code>## &lt;environment: R_EmptyEnv&gt;</code></pre>
<p></p>
<p>Podemos representar este caminho de maneira gráfica, como apresentado na figura 18.5. Perceba que, pelo fato do <em>environment</em> do pacote <code>base</code> ser o último da lista resultante de <code>search()</code>, o seu <em>parent environment</em> é justamente um <em>environment</em> vazio.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/search_path.png" alt="Representação do *search path* do R" width="100%" />
<p class="caption">
(#fig:unnamed-chunk-1020)Representação do <em>search path</em> do R
</p>
</div>
<p></p>
<!-- Portanto, o R sempre inicia o processo de busca pelo seu *global environment*. Ou seja, o *global environment* é o primeiro *environment* que o R visita em busca do objeto que você digitou. Para mais, o pacote `base` é sempre o último *environment* pesquisado. Logo, esse pacote sempre é o último elemento do vetor resultante de `search()` [@peng2015]. -->
<!-- ### O sentido de busca do R -->
<!-- Para compreender o caminho percorrido pelo R durante o *scoping*, é importante que você entenda o sentido que o R utiliza ao percorrer pela árvore (ou sequência) de *environments*. Em resumo, o R percorre os vários *environments*, **subindo** a árvore genealógica.  -->
<!-- Ou seja, se o R não encontrar o seu objeto em um *environment* `x`, ele parte para o *parent environment* desse *environment* `x`, em seguida, caso ele não encontre o objeto neste outro *environment*, então, ele parte novamente para o próximo *parent environment*, e assim segue, até ele encontrar o seu objeto (ou até atingir um *environment* vazio).  -->
<!-- Portanto, quando você precisa compreender o caminho que o R está percorrendo durante um processo de pesquisa, é importante que você identifique quais são os *parent environments* do *environment* inicial. Se você souber qual é o primeiro *environment* pesquisado, e quais são os seus *parent environments*, você pode desenhar aos poucos esse caminho em sua mente.  -->
<!-- Se utilizarmos como referência, o *search path* mostrado na figura x, o R tenta primeiro encontrar o objeto em seu *global environment*. Caso ele não encontre este objeto, o R parte então para o *parent environment* de seu global *environment*, que é sempre o *environment* do último pacote que você carregou para a sua sessão. E assim vai, seguindo os *environments* de todos os pacotes que você carregou para a sua sessão. Por último, o R ainda tenta encontrar esse objeto em `Autoloads` e no *environment* do pacote `base` (respectivamente) antes de atingir o *environment* vazio e encerrar o seu processo de busca. -->
</div>
<div id="descrevendo-o-lexical-scoping" class="section level3" number="18.7.4">
<h3 number="18.7.4"><span class="header-section-number">18.7.4</span> Descrevendo o <em>lexical scoping</em></h3>
<!-- A obra de @wickham2015_advanced fornece uma descrição bastante clara, completa e precisa de *environments* e, por isso, representa uma importante referência sobre o tema. Porém, da forma como o capítulo de *Environments* está escrito, o leitor pode chegar a conclusão de que o processo de busca do R sempre se inicia pelo *global environment*. Porém, isso não representa a realidade. -->
<!-- Infelizmente, a obra de @wickham2015_advanced não discute esse ponto de forma clara ao longo de seu capítulo de [*Environments*](https://adv-r.hadley.nz/environments.html). Os autores chegam a demonstrar esse ponto de forma implícita em seus exemplos da seção 6.4 de [*Lexical Scoping*](https://adv-r.hadley.nz/functions.html#lexical-scoping). Porém, não apontar esse conhecimento de forma clara dentro do capítulo de *Environments*, pode ter causado certa confusão em muitos leitores. -->
<p>Como descrevemos anteriormente, a linguagem R utiliza um conjunto de regras (chamadas de <em>lexical scoping</em>) para encontrar o valor de seus objetos. Nessa seção, vamos explicar em mais detalhes que regras são essas.</p>
<p>Primeiro, o R <strong>sempre</strong> inicia o seu processo de busca pelo <em>environment</em> em que você chamou por esse objeto. Por exemplo, se você está chamando por esse objeto, diretamente no console do R, então, você está chamando esse objeto a partir de seu <em>global environment</em>, logo, o R começa a sua pesquisa por este <em>environment</em>. Contudo, se você está chamando por esse objeto, dentro do body de uma função, então, o R vai procurar primeiro dentro do <em>environment</em> de execução dessa função.</p>
<p>Segundo, se o R não encontra o objeto em questão no primeiro <em>environment</em> pesquisado, ele começa a subir pela árvore genealógica de <em>environments</em>, até atingir o seu <em>global environment</em>. Ou seja, o R começa a procurar pelo objeto dentro do pai do primeiro <em>environment</em> pesquisado, depois, no pai do pai, e assim por diante.</p>
<p>Explicando ainda esse mesmo ponto, de uma outra forma: se o R não encontrar o seu objeto em um <em>environment</em> <code>x</code>, ele parte para o <em>parent environment</em> desse <em>environment</em> <code>x</code>, caso ele não encontre o objeto neste outro <em>environment</em>, então, ele parte novamente para o próximo <em>parent environment</em>, e assim segue, até ele chegar em seu <em>global environment</em> .</p>
<p>Terceiro, a partir do momento em que o R atinge o seu <em>global environment</em>, o R começa a navegar pelo seu <em>search path</em> . Ou seja, o R começa a subir pela sequência de <em>environments</em> descrita pela função <code>search()</code>. Então ele visita primeiro o seu <em>global environment</em>, depois, parte para os <em>environments</em> dos pacotes carregados em sua sessão, depois, para o <em>environment</em> <code>Autoloads</code> e o <em>environment</em> do pacote <code>base</code>.</p>
<p>Quarto, ao subir pelo seu <em>search path</em>, se o R atingir o empty <em>environment</em> (que é o pai do <em>environment</em> do pacote <code>base</code>), o processo de busca é encerrado, e o R retorna um erro, lhe avisando que o objeto não pôde ser encontrado.</p>
<p>Vamos para alguns exemplos práticos. Suponha que você possua a função <code>f()</code> apresentada abaixo salva em seu <em>global environment</em>. Perceba que dentro do body dessa função, temos dois objetos (<code>x</code> e <code>y</code>) que o R precisa encontrar, no momento em que executar essa função.</p>
<p>Quando essa função é avaliada, o R procura primeiro dentro do <em>environment</em> de execução dessa função. Pois é dentro desse <em>environment</em> que os objetos estão sendo chamados.</p>
<p>Dentro desse <em>environment</em> de execução, o R encontra o objeto <code>y</code> (que é igual a 10), porém, ele não consegue encontrar o objeto <code>x</code>. Consequentemente, o R parte para o pai do <em>environment</em> de execução da função, que no exemplo abaixo se trata do <em>global environment</em>. Ao chegar no <em>global environment</em>, o R encontra o vetor <code>x</code> e, por isso, tal vetor é utilizado pela função <code>f()</code>.</p>
<p></p>
<div class="sourceCode" id="cb1918"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1918-1"><a href="#cb1918-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">1</span>)</span>
<span id="cb1918-2"><a href="#cb1918-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1918-3"><a href="#cb1918-3" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb1918-4"><a href="#cb1918-4" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb1918-5"><a href="#cb1918-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(x <span class="sc">+</span> y)</span>
<span id="cb1918-6"><a href="#cb1918-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1918-7"><a href="#cb1918-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1918-8"><a href="#cb1918-8" aria-hidden="true" tabindex="-1"></a><span class="fu">f</span>()</span></code></pre></div>
<pre><code>## [1] 12 15 16 11</code></pre>
<p></p>
<p>Agora, vamos partir para um exemplo mais profundo. Observe o exemplo abaixo, e tente responder a seguinte pergunta: porque o resultado do comando <code>h(3)</code> mostrado abaixo é 13, e não 25?. Para responder a essa pergunta, vamos recapitular ou esclarecer alguns pontos a seguir.</p>
<p></p>
<div class="sourceCode" id="cb1920"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1920-1"><a href="#cb1920-1" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="dv">15</span></span>
<span id="cb1920-2"><a href="#cb1920-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1920-3"><a href="#cb1920-3" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb1920-4"><a href="#cb1920-4" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb1920-5"><a href="#cb1920-5" aria-hidden="true" tabindex="-1"></a>  g <span class="ot">&lt;-</span> <span class="cf">function</span>(x) x <span class="sc">+</span> y</span>
<span id="cb1920-6"><a href="#cb1920-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(g)</span>
<span id="cb1920-7"><a href="#cb1920-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1920-8"><a href="#cb1920-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1920-9"><a href="#cb1920-9" aria-hidden="true" tabindex="-1"></a>h <span class="ot">&lt;-</span> <span class="fu">f</span>()</span>
<span id="cb1920-10"><a href="#cb1920-10" aria-hidden="true" tabindex="-1"></a><span class="fu">h</span>(<span class="dv">3</span>)</span></code></pre></div>
<pre><code>## [1] 13</code></pre>
<p></p>
<p>Primeiro, vamos expor o caminho de <em>environments</em> que você (leitor) provavelmente achou que o R iria seguir durante o cálculo de <code>h()</code> (painel A), e, o caminho que ele efetivamente seguiu (painel B). Tais caminhos de <em>environments</em> estão expostos na figura 18.6.</p>
<p></p>
<div class="figure" style="text-align: center">
<img src="Figuras/exemplo_path1.png" alt="Certos *parent environments* podem te surpreender" width="100%" />
<p class="caption">
(#fig:unnamed-chunk-1023)Certos <em>parent environments</em> podem te surpreender
</p>
</div>
<p></p>
<p>Pelo fato da função <code>h()</code> ter sido criada dentro do <em>global environment</em>, você provavelmente pressupôs que <code>R_GlobalEnv</code> fosse o <em>parent environment</em> do <em>environment</em> de execução dessa função. Porém, o <em>parent environment</em> de <code>h()</code> é na verdade o <em>environment</em> de execução da função <code>f()</code>.</p>
<p>Pois o valor do objeto <code>h</code> (que está salvo no <em>global environment</em>) é a definição da função <code>g()</code>. Essa função <code>g()</code> foi criada dentro do <em>environment</em> de execução da função <code>f()</code>. Portanto, o <em>parent environment</em> da função que está armazenada dentro do objeto <code>h</code> é o <em>environment</em> de execução da função <code>f()</code>.</p>
<p>Tendo isso em mente, lembre-se que toda função do R possui o que chamamos de <em>function environment</em>. Esse é o <em>environment</em> no qual essa função foi criada. Para mais, o <em>function environment</em> é sempre o pai do <em>environment</em> de execução dessa função.</p>
<p>Esse exemplo mostra que as conexões de todos os objetos envolvidos em uma expressão, são definidos no instante em que aquela expressão é criada. Os manuais internos da linguagem, destacam essa característica como um dos princípios fundamentais de <em>lexical scope</em>:</p>
<blockquote>
<blockquote>
<p>“R adheres to a set of rules that are called lexical scope. This means the variable bindings in effect at the time the expression was created are used to provide values for any unbound symbols in the expression.” </p>
</blockquote>
</blockquote>
<p>Isso significa que essas conexões não são calculadas pelo R, no momento em que executamos essa expressão, e, sim, no momento em que definimos ou criamos essa expressão. Em outras palavras, o <em>parent environment</em> da função <code>h()</code> foi determinado no momento em que a função <code>g()</code> foi criada, e não, no momento em que executamos a função <code>h()</code>.</p>
<p>Concluindo, as regras que regem o <em>lexical scoping</em> no R são:</p>
<ol style="list-style-type: decimal">
<li><p>O R sempre inicia o seu processo de busca pelo <em>environment</em> no qual você requisitou pelo objeto;</p></li>
<li><p>Se ele não encontra o objeto no primeiro <em>environment</em> pesquisado, ele começa a percorrer os <em>parent environments</em>, até atingir o global environment;</p></li>
<li><p>Ao atingir o global <em>environment</em>, o R percorre o <em>search path</em>;</p></li>
<li><p>Ao atingir um empty <em>environment</em>, a procura é interrompida, e um erro é levantado indicando que o objeto não foi encontrado;</p></li>
</ol>
</div>
</div>
<div id="criando-objetos-em-outros-environments." class="section level2" number="18.8">
<h2 number="18.8"><span class="header-section-number">18.8</span> Criando objetos em outros <em>environments</em>.</h2>
<p>Quando utilizamos o operador de assignment <code>&lt;-</code> para criar um objeto, este objeto é sempre criado dentro do <em>environment</em> no qual você executou tal operador. Veja o exemplo abaixo.</p>
<p>Repare que dois objetos numéricos (<code>x</code> e <code>y</code>) estão sendo criados. Contudo, esses dois objetos estão sendo criados em <em>environments</em> diferentes. Mais especificamente, o objeto <code>x</code> é criado dentro do meu global <em>environment</em>, enquanto o objeto y é criado dentro do <em>environment</em> de execução da função <code>f()</code>.</p>
<p></p>
<div class="sourceCode" id="cb1922"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1922-1"><a href="#cb1922-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb1922-2"><a href="#cb1922-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1922-3"><a href="#cb1922-3" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb1922-4"><a href="#cb1922-4" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb1922-5"><a href="#cb1922-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p></p>
<p>Portanto, você pode utilizar o body de uma função, para criar objetos em <em>environments</em> diferentes de seu <em>global environments</em>. Além disso, você já viu que a função <code>rlang::env()</code> te permite fornecer novos objetos para serem armazenados dentro do novo <em>environment</em> criado pela função. No exemplo abaixo, estou criando dois objetos (<code>nome</code> e <code>ano</code>) dentro do <em>environment</em> <code>env1</code>.</p>
<p></p>
<div class="sourceCode" id="cb1923"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1923-1"><a href="#cb1923-1" aria-hidden="true" tabindex="-1"></a>env1 <span class="ot">&lt;-</span> rlang<span class="sc">::</span><span class="fu">env</span>(<span class="at">nome =</span> <span class="st">&quot;Pedro&quot;</span>, <span class="at">ano =</span> <span class="dv">2022</span>)</span></code></pre></div>
<p></p>
<p>Como uma outra alternativa, você pode também utilizar a função <code>assign()</code> quando desejar ser mais específico quanto ao <em>environment</em> em que o objeto deve ser criado. Em resumo, essa função executa o mesmo trabalho do operador de <code>assignment</code> (<code>&lt;-</code>), todavia, essa função nos oferece o argumento <code>envir</code>, no qual podemos definir o <em>environment</em> no qual o objeto será criado.</p>
<p>Como exemplo, estou criando abaixo dois <em>environments</em> separados, <code>env1</code> e <code>env2</code>. Repare que <code>env1</code> é o <em>parent environment</em> de <code>env2</code>. A princípio, esses dois <em>environments</em> estão vazios.</p>
<p></p>
<div class="sourceCode" id="cb1924"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1924-1"><a href="#cb1924-1" aria-hidden="true" tabindex="-1"></a>env1 <span class="ot">&lt;-</span> rlang<span class="sc">::</span><span class="fu">env</span>()</span>
<span id="cb1924-2"><a href="#cb1924-2" aria-hidden="true" tabindex="-1"></a>env2 <span class="ot">&lt;-</span> rlang<span class="sc">::</span><span class="fu">env</span>(env1)</span></code></pre></div>
<p></p>
<p>Se eu desejasse criar um objeto dentro do <em>environment</em> <code>env2</code>, eu poderia utilizar a função <code>assign()</code> como exposto abaixo. Perceba que nesse exemplo, estou criando um objeto chamado <code>x</code> que contém o valor 10.</p>
<p></p>
<div class="sourceCode" id="cb1925"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1925-1"><a href="#cb1925-1" aria-hidden="true" tabindex="-1"></a><span class="fu">assign</span>(<span class="st">&quot;x&quot;</span>, <span class="dv">10</span>, <span class="at">envir =</span> env2)</span></code></pre></div>
<p></p>
<p>Depois de executar a função, podemos acessar o objeto <code>x</code> com o operador <code>$</code>, ou ainda, com a função <code>get()</code> que vimos em seções anteriores.</p>
<p></p>
<div class="sourceCode" id="cb1926"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1926-1"><a href="#cb1926-1" aria-hidden="true" tabindex="-1"></a>env2<span class="sc">$</span>x</span></code></pre></div>
<pre><code>## [1] 10</code></pre>
<div class="sourceCode" id="cb1928"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1928-1"><a href="#cb1928-1" aria-hidden="true" tabindex="-1"></a><span class="fu">get</span>(<span class="st">&quot;x&quot;</span>, <span class="at">envir =</span> env2)</span></code></pre></div>
<pre><code>## [1] 10</code></pre>
<p></p>
<p>Para além dessas opções, você pode utilizar o operador de super-assignment (<code>&lt;&lt;-</code>) para redefinir um objeto presente no <em>parent environment</em> do <em>environment</em> atual. Como exemplo, vamos estudar as funções <code>f()</code> e <code>g()</code> abaixo.</p>
<p>Perceba que a função <code>g()</code> é criada dentro da função <code>f()</code>, logo, o <em>parent environment</em> da função <code>g()</code> é o <em>environment</em> de execução da função <code>f()</code>. Repare também que, dentro da função <code>f()</code> é criado um objeto chamado <code>y</code>, contendo inicialmente o valor 20.</p>
<p>Entretanto, a partir do momento em que a função <code>g()</code> é executada dentro da função <code>f()</code>, o valor do objeto <code>y</code> se torna igual a 1. Isso ocorre, pelo fato da função <code>g()</code> executar dentro dela, uma expressão de <em>super-assignment</em>, mais especificamente, a expressão <code>y &lt;&lt;- 1</code>.</p>
<p></p>
<div class="sourceCode" id="cb1930"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1930-1"><a href="#cb1930-1" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb1930-2"><a href="#cb1930-2" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb1930-3"><a href="#cb1930-3" aria-hidden="true" tabindex="-1"></a>  <span class="do">### Primeiro print()</span></span>
<span id="cb1930-4"><a href="#cb1930-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(y)</span>
<span id="cb1930-5"><a href="#cb1930-5" aria-hidden="true" tabindex="-1"></a>  g <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb1930-6"><a href="#cb1930-6" aria-hidden="true" tabindex="-1"></a>    y <span class="ot">&lt;&lt;-</span> <span class="dv">1</span></span>
<span id="cb1930-7"><a href="#cb1930-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1930-8"><a href="#cb1930-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1930-9"><a href="#cb1930-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">g</span>()</span>
<span id="cb1930-10"><a href="#cb1930-10" aria-hidden="true" tabindex="-1"></a>  <span class="do">### Segundo print()</span></span>
<span id="cb1930-11"><a href="#cb1930-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(y)</span>
<span id="cb1930-12"><a href="#cb1930-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1930-13"><a href="#cb1930-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1930-14"><a href="#cb1930-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1930-15"><a href="#cb1930-15" aria-hidden="true" tabindex="-1"></a><span class="fu">f</span>()</span></code></pre></div>
<pre><code>## [1] 20
## [1] 1</code></pre>
<p></p>
<p>Em mais detalhes, quando utilizamos o operador <code>&lt;&lt;-</code>, ao invés do R criar o objeto dentro do <em>environment</em> onde a expressão foi executada, ele inicia uma busca dentro do <em>parent environment</em>, atrás de um objeto que possua o mesmo nome do objeto contido nessa expressão.</p>
<p>Ou seja, ao executar a expressão <code>y &lt;&lt;- 1</code>, o R começou a procurar dentro do <em>parent environment</em> de <code>g()</code> (que no exemplo acima, é o <em>environment</em> de execução de <code>f()</code>), por um objeto chamado <code>y</code>. Ao encontrar o objeto <code>y</code> que guarda o valor de 20, o R redefine o seu valor para 1.</p>
<p>Portanto, em uma operação de <em>super-assignment</em> (<code>&lt;&lt;-</code>), o R procura pelo objeto envolvido na operação dentro do <em>parent environment</em>. Caso o R encontre esse objeto, ele vai redefinir o seu valor. Entretanto, se o R não encontrar esse objeto dentro do <em>parent environment</em>, então, ele vai criar (ou redefinir) esse objeto dentro de seu global <em>environment</em>.</p>
<p>Por exemplo, observe as funções <code>f()</code> e <code>g()</code> abaixo. O <em>parent environment</em> de <code>g()</code> continua sendo o <em>environment</em> de execução de <code>f()</code>. Porém, perceba que dessa vez, não existe um objeto <code>y</code> sendo definido dentro de <code>f()</code>. Para mais, repare que antes de eu executar a função <code>f()</code>, não existe nenhum objeto <code>y</code> salvo em meu global <em>environment</em>.</p>
<p>Em contrapartida, no instante em que eu executo a função <code>f()</code>, um novo objeto <code>y</code> contendo o valor 1 surge em meu global <em>environment</em>. Perceba que eu utilizo a função <code>get()</code> em conjunto com <code>globalenv()</code> para demonstrar que tal objeto foi encontrado dentro de meu global <em>environment</em>, e não em algum outro <em>environment</em>.</p>
<p></p>
<div class="sourceCode" id="cb1932"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1932-1"><a href="#cb1932-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Perceba que ainda não existe nenhum</span></span>
<span id="cb1932-2"><a href="#cb1932-2" aria-hidden="true" tabindex="-1"></a><span class="do">### objeto chamado `y` em meu global environment</span></span>
<span id="cb1932-3"><a href="#cb1932-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(y)</span></code></pre></div>
<p></p>
<pre><code>## Error in print(y) : object &#39;y&#39; not found</code></pre>
<p></p>
<div class="sourceCode" id="cb1934"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1934-1"><a href="#cb1934-1" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb1934-2"><a href="#cb1934-2" aria-hidden="true" tabindex="-1"></a>  g <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb1934-3"><a href="#cb1934-3" aria-hidden="true" tabindex="-1"></a>    y <span class="ot">&lt;&lt;-</span> <span class="dv">1</span></span>
<span id="cb1934-4"><a href="#cb1934-4" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1934-5"><a href="#cb1934-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1934-6"><a href="#cb1934-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">g</span>()</span>
<span id="cb1934-7"><a href="#cb1934-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1934-8"><a href="#cb1934-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1934-9"><a href="#cb1934-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1934-10"><a href="#cb1934-10" aria-hidden="true" tabindex="-1"></a><span class="fu">f</span>()</span>
<span id="cb1934-11"><a href="#cb1934-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1934-12"><a href="#cb1934-12" aria-hidden="true" tabindex="-1"></a><span class="do">### Agora, como num passe de mágica</span></span>
<span id="cb1934-13"><a href="#cb1934-13" aria-hidden="true" tabindex="-1"></a><span class="do">### surge um objeto chamado `y` em</span></span>
<span id="cb1934-14"><a href="#cb1934-14" aria-hidden="true" tabindex="-1"></a><span class="do">### meu global environment</span></span>
<span id="cb1934-15"><a href="#cb1934-15" aria-hidden="true" tabindex="-1"></a><span class="fu">get</span>(<span class="st">&quot;y&quot;</span>, <span class="at">envir =</span> <span class="fu">globalenv</span>())</span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<p></p>
<p>Portanto, dessa vez, o R não conseguiu encontrar um objeto chamado <code>y</code> dentro do <em>environment</em> de <code>f()</code> e, por isso, ele acabou criando este objeto <code>y</code> dentro de meu global <em>environment</em>.</p>
</div>
<div id="exercícios-13" class="section level2 unnumbered">
<h2 class="unnumbered">Exercícios</h2>
<p><strong>Questão 18.1.</strong> Observe o exemplo abaixo, em que eu acabo de iniciar uma nova sessão no R, e crio logo em seguida, dois novos <em>environments</em> (<code>env1</code> e <code>env2</code>). Através dos resultados de <code>parent.env()</code> abaixo, sabemos que o <em>global environment</em> é o pai de <code>env1</code>, enquanto <code>env1</code> é o pai de <code>env2</code>. Portanto, os itens desta questão focam na relação entre esses três <em>environments</em> (<code>env1</code>, <code>env2</code> e o <em>global environment</em>). Agora, suponha que eu crie dois objetos (<code>obj</code> e <code>i</code>) dentro de <code>env1</code>, e, um objeto (<code>i</code>) dentro de <code>env2</code>.</p>
<p></p>
<div class="sourceCode" id="cb1936"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1936-1"><a href="#cb1936-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Acabei de iniciar um nova sessão no R</span></span>
<span id="cb1936-2"><a href="#cb1936-2" aria-hidden="true" tabindex="-1"></a>env1 <span class="ot">&lt;-</span> rlang<span class="sc">::</span><span class="fu">env</span>()</span>
<span id="cb1936-3"><a href="#cb1936-3" aria-hidden="true" tabindex="-1"></a>env2 <span class="ot">&lt;-</span> rlang<span class="sc">::</span><span class="fu">env</span>(env1)</span>
<span id="cb1936-4"><a href="#cb1936-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1936-5"><a href="#cb1936-5" aria-hidden="true" tabindex="-1"></a>env1</span></code></pre></div>
<pre><code>## &lt;environment: 0x000001a219383858&gt;</code></pre>
<div class="sourceCode" id="cb1938"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1938-1"><a href="#cb1938-1" aria-hidden="true" tabindex="-1"></a>env2</span></code></pre></div>
<pre><code>## &lt;environment: 0x000001a219195430&gt;</code></pre>
<div class="sourceCode" id="cb1940"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1940-1"><a href="#cb1940-1" aria-hidden="true" tabindex="-1"></a><span class="fu">parent.env</span>(env1)</span></code></pre></div>
<pre><code>## &lt;environment: R_GlobalEnv&gt;</code></pre>
<div class="sourceCode" id="cb1942"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1942-1"><a href="#cb1942-1" aria-hidden="true" tabindex="-1"></a><span class="fu">parent.env</span>(env2)</span></code></pre></div>
<pre><code>## &lt;environment: 0x000001a219383858&gt;</code></pre>
<div class="sourceCode" id="cb1944"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1944-1"><a href="#cb1944-1" aria-hidden="true" tabindex="-1"></a>env1<span class="sc">$</span>obj <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">20</span>)</span>
<span id="cb1944-2"><a href="#cb1944-2" aria-hidden="true" tabindex="-1"></a>env1<span class="sc">$</span>i <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb1944-3"><a href="#cb1944-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1944-4"><a href="#cb1944-4" aria-hidden="true" tabindex="-1"></a>env2<span class="sc">$</span>i <span class="ot">&lt;-</span> <span class="dv">2</span></span></code></pre></div>
<p></p>
<p>18.1.A) Abaixo, estou utilizando a função <code>eval()</code> para executar a expressão <code>obj[i] &lt;&lt;- obj[i] + 1</code> dentro do <em>environment</em> <code>env1</code>. O que vai acontecer nesse caso? Em que <em>environment</em> será salvo o resultado dessa expressão?</p>
<p></p>
<div class="sourceCode" id="cb1945"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1945-1"><a href="#cb1945-1" aria-hidden="true" tabindex="-1"></a><span class="fu">eval</span>(<span class="fu">quote</span>(obj <span class="ot">&lt;&lt;-</span> obj[i] <span class="sc">+</span> <span class="dv">1</span>), <span class="at">envir =</span> env1)</span></code></pre></div>
<p></p>
<p>18.1.B) Abaixo, estou utilizando novamente a função <code>eval()</code> para executar a expressão <code>obj[i] &lt;&lt;- obj[i] + 1</code> dentro de um environment específico. Porém, dessa vez, estou executando essa expressão dentro do environment <code>env2</code>. O que vai acontecer nesse caso? O resultado da expressão será salvo em um <em>environment</em> diferente do item anterior? Lembre-se, é muito importante começar com uma sessão limpa do R, e recriar os <em>environments</em> <code>env1</code> e <code>env2</code> para testar o comando abaixo.</p>
<p></p>
<div class="sourceCode" id="cb1946"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1946-1"><a href="#cb1946-1" aria-hidden="true" tabindex="-1"></a><span class="fu">eval</span>(<span class="fu">quote</span>(obj <span class="ot">&lt;&lt;-</span> obj[i] <span class="sc">+</span> <span class="dv">1</span>), <span class="at">envir =</span> env2)</span></code></pre></div>
<p></p>
<p><strong>Questão 18.2.</strong> Observe os exemplos em cada item abaixo, e tente prever qual será o resultado de cada comando <code>print()</code>.</p>
<p>18.2.A)</p>
<p></p>
<div class="sourceCode" id="cb1947"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1947-1"><a href="#cb1947-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb1947-2"><a href="#cb1947-2" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb1947-3"><a href="#cb1947-3" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="dv">15</span></span>
<span id="cb1947-4"><a href="#cb1947-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(x <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb1947-5"><a href="#cb1947-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1947-6"><a href="#cb1947-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1947-7"><a href="#cb1947-7" aria-hidden="true" tabindex="-1"></a><span class="do">### Qual será o resultado do comando print()</span></span>
<span id="cb1947-8"><a href="#cb1947-8" aria-hidden="true" tabindex="-1"></a><span class="do">### executado por f() ?</span></span>
<span id="cb1947-9"><a href="#cb1947-9" aria-hidden="true" tabindex="-1"></a><span class="fu">f</span>()</span></code></pre></div>
<p></p>
<p>18.2.B)</p>
<p></p>
<div class="sourceCode" id="cb1948"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1948-1"><a href="#cb1948-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Iniciei uma nova sessão no R</span></span>
<span id="cb1948-2"><a href="#cb1948-2" aria-hidden="true" tabindex="-1"></a>obj <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb1948-3"><a href="#cb1948-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1948-4"><a href="#cb1948-4" aria-hidden="true" tabindex="-1"></a>env1 <span class="ot">&lt;-</span> rlang<span class="sc">::</span><span class="fu">env</span>()</span>
<span id="cb1948-5"><a href="#cb1948-5" aria-hidden="true" tabindex="-1"></a>env2 <span class="ot">&lt;-</span> rlang<span class="sc">::</span><span class="fu">env</span>(env1)</span>
<span id="cb1948-6"><a href="#cb1948-6" aria-hidden="true" tabindex="-1"></a>env3 <span class="ot">&lt;-</span> rlang<span class="sc">::</span><span class="fu">env</span>(env2)</span>
<span id="cb1948-7"><a href="#cb1948-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1948-8"><a href="#cb1948-8" aria-hidden="true" tabindex="-1"></a>env1<span class="sc">$</span>obj <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">20</span>)</span>
<span id="cb1948-9"><a href="#cb1948-9" aria-hidden="true" tabindex="-1"></a>env3<span class="sc">$</span>obj <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">200</span>)</span>
<span id="cb1948-10"><a href="#cb1948-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1948-11"><a href="#cb1948-11" aria-hidden="true" tabindex="-1"></a><span class="fu">eval</span>(<span class="fu">quote</span>(obj <span class="ot">&lt;&lt;-</span> obj <span class="sc">+</span> <span class="dv">1</span>), <span class="at">envir =</span> env2)</span>
<span id="cb1948-12"><a href="#cb1948-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1948-13"><a href="#cb1948-13" aria-hidden="true" tabindex="-1"></a><span class="do">### Qual é o resultado do print() abaixo ?</span></span>
<span id="cb1948-14"><a href="#cb1948-14" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">get</span>(<span class="st">&quot;obj&quot;</span>, <span class="at">envir =</span> env1))</span></code></pre></div>
<p></p>
<!--chapter:end:16-environments.Rmd-->
</div>
</div>
<div id="part-respostas-dos-exercícios-de-cada-capítulo" class="section level1 unnumbered">
<h1 class="unnumbered">(PART) Respostas dos exercícios de cada capítulo</h1>
<div id="capítulo-1---noções-básicas-do-r" class="section level2 unlisted unnumbered">
<h2 class="unlisted unnumbered">Capítulo 1 - Noções Básicas do R</h2>
<center>
<em>Exercício 1</em>
</center>
<p><strong>1.1.A)</strong> Quando temos um conjunto pequeno de valores a serem somados, podemos utilizar o operador <code>+</code>:</p>
<div class="sourceCode" id="cb1949"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1949-1"><a href="#cb1949-1" aria-hidden="true" tabindex="-1"></a><span class="dv">32397</span> <span class="sc">+</span> <span class="dv">55405</span></span></code></pre></div>
<pre><code>## [1] 87802</code></pre>
<div class="sourceCode" id="cb1951"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1951-1"><a href="#cb1951-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Ou de forma análoga:</span></span>
<span id="cb1951-2"><a href="#cb1951-2" aria-hidden="true" tabindex="-1"></a>n1 <span class="ot">&lt;-</span> <span class="dv">32397</span></span>
<span id="cb1951-3"><a href="#cb1951-3" aria-hidden="true" tabindex="-1"></a>n2 <span class="ot">&lt;-</span> <span class="dv">55405</span></span>
<span id="cb1951-4"><a href="#cb1951-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1951-5"><a href="#cb1951-5" aria-hidden="true" tabindex="-1"></a>n1 <span class="sc">+</span> n2</span></code></pre></div>
<pre><code>## [1] 87802</code></pre>
<p><strong>1.1.B)</strong> Lembre-se que a função <code>sum()</code> lhe permite calcular a soma total de um conjunto de valores, de maneira rápida e eficiente. Lembre-se também de criar o objeto <code>conj</code> em seu console, antes de calcular a soma. Pois se não você estaria pedindo à função <code>sum()</code>, que calculasse a soma de um objeto que <strong>não existe em seu computador</strong>.</p>
<div class="sourceCode" id="cb1953"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1953-1"><a href="#cb1953-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Lembre-se de criar o objeto conj</span></span>
<span id="cb1953-2"><a href="#cb1953-2" aria-hidden="true" tabindex="-1"></a>conj <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">290</span>, <span class="dv">34</span>, <span class="dv">512</span>, <span class="dv">54</span>, <span class="dv">89</span>)</span>
<span id="cb1953-3"><a href="#cb1953-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1953-4"><a href="#cb1953-4" aria-hidden="true" tabindex="-1"></a>resposta <span class="ot">&lt;-</span> <span class="fu">sum</span>(conj)</span>
<span id="cb1953-5"><a href="#cb1953-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(resposta)</span></code></pre></div>
<pre><code>## [1] 979</code></pre>
<div class="sourceCode" id="cb1955"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1955-1"><a href="#cb1955-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Ou de uma maneira bem menos eficiente:</span></span>
<span id="cb1955-2"><a href="#cb1955-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1955-3"><a href="#cb1955-3" aria-hidden="true" tabindex="-1"></a>conj[<span class="dv">1</span>] <span class="sc">+</span> conj[<span class="dv">2</span>] <span class="sc">+</span> conj[<span class="dv">3</span>] <span class="sc">+</span> conj[<span class="dv">4</span>] <span class="sc">+</span> conj[<span class="dv">5</span>]</span></code></pre></div>
<pre><code>## [1] 979</code></pre>
<p><strong>1.1.C)</strong> Considerando <span class="math inline">\(y = 3x^3 - 12x^2 + \frac{1}{15}x+ 25\)</span>, e <span class="math inline">\(x = 5\)</span>, temos que:</p>
<div class="sourceCode" id="cb1957"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1957-1"><a href="#cb1957-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb1957-2"><a href="#cb1957-2" aria-hidden="true" tabindex="-1"></a>y_resposta <span class="ot">&lt;-</span> <span class="dv">3</span> <span class="sc">*</span> (x<span class="sc">^</span><span class="dv">3</span>) <span class="sc">-</span> <span class="dv">12</span> <span class="sc">*</span> (x<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> (<span class="dv">1</span><span class="sc">/</span><span class="dv">15</span>) <span class="sc">*</span> x <span class="sc">+</span> <span class="dv">25</span></span>
<span id="cb1957-3"><a href="#cb1957-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(y_resposta)</span></code></pre></div>
<pre><code>## [1] 100.3333</code></pre>
<center>
<em>Exercício 2</em>
</center>
<p><strong>1.2.A)</strong> Qualquer erro do tipo “objeto ‘x’ não encontrado,” significa que o objeto pelo qual você requisitou não existe atualmente em sua seção do R. Portanto, o erro na questão que diz respeito a um objeto chamado <code>logica</code>, está lhe dizendo que você não criou ainda nenhum objeto chamado <code>logica</code> em sua sessão. A partir do momento em que você define um valor para o nome <code>logica</code>, esse erro passa a não ocorrer mais. Lembre-se que esse erro pode surgir <strong>em qualquer lugar</strong> (dentro de qualquer função, ou de qualquer operação), pois sem esse objeto (que não existe em seu computador) o R não é capaz de completar a operação pela qual você requisitou.</p>
<div class="sourceCode" id="cb1959"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1959-1"><a href="#cb1959-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Suponha que o erro tenha surgido a partir do comando abaixo</span></span>
<span id="cb1959-2"><a href="#cb1959-2" aria-hidden="true" tabindex="-1"></a><span class="do">### com a função sum()</span></span>
<span id="cb1959-3"><a href="#cb1959-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1959-4"><a href="#cb1959-4" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(logica)</span></code></pre></div>
<div class="sourceCode" id="cb1960"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1960-1"><a href="#cb1960-1" aria-hidden="true" tabindex="-1"></a><span class="do">### A partir do momento em que defino um valor para logica</span></span>
<span id="cb1960-2"><a href="#cb1960-2" aria-hidden="true" tabindex="-1"></a><span class="do">### o comando volta a funcionar</span></span>
<span id="cb1960-3"><a href="#cb1960-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1960-4"><a href="#cb1960-4" aria-hidden="true" tabindex="-1"></a>logica <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span></span>
<span id="cb1960-5"><a href="#cb1960-5" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(logica)</span></code></pre></div>
<pre><code>## [1] 6</code></pre>
<p><strong>1.2.B)</strong> A função <code>bind_rows()</code> (assim como a função <code>mutate()</code>) pertence ao pacote <code>dplyr</code>, que está fora dos pacotes básicos do R. Ou seja, sempre que você inicia uma nova sessão no R, a função <code>bind_rows()</code> não é automaticamente carregada para essa seção, pois ela pertence a um pacote (<code>dplyr</code>) que está fora do conjunto de pacotes básicos do R.</p>
<p>Logo, o erro disposto na questão surge quando tentamos acessar a função <code>bind_rows()</code>, quando ela ainda não foi carregada para a nossa seção do R. Como comentamos ao longo da seção <a href="#sec:pacotes">Pacotes</a>, para acessarmos as funções disponíveis dentro de um pacote, é necessário carregarmos esse pacote para a nossa seção (através da função <code>library()</code>). E para carregarmos um pacote para a nossa seção, é necessário que esse pacote esteja instalado em nosso computador.</p>
<div class="sourceCode" id="cb1962"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1962-1"><a href="#cb1962-1" aria-hidden="true" tabindex="-1"></a>dt1 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)</span>
<span id="cb1962-2"><a href="#cb1962-2" aria-hidden="true" tabindex="-1"></a>dt2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)</span>
<span id="cb1962-3"><a href="#cb1962-3" aria-hidden="true" tabindex="-1"></a><span class="do">### Não consigo acessar a função bind_rows()</span></span>
<span id="cb1962-4"><a href="#cb1962-4" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(dt1, dt2)</span></code></pre></div>
<div class="sourceCode" id="cb1963"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1963-1"><a href="#cb1963-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1963-2"><a href="#cb1963-2" aria-hidden="true" tabindex="-1"></a><span class="do">### Agora eu consigo acessar a função bind_rows()</span></span>
<span id="cb1963-3"><a href="#cb1963-3" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(dt1, dt2)</span></code></pre></div>
<pre><code>##   X1.3 X1.5
## 1    1   NA
## 2    2   NA
## 3    3   NA
## 4   NA    1
## 5   NA    2
## 6   NA    3
## 7   NA    4
## 8   NA    5</code></pre>
<p><strong>1.2.C)</strong> Como comentamos ao longo da seção <a href="#sec:pacotes">Pacotes</a>, para utilizarmos as funções disponíveis em um pacote, precisamos carregar esse pacote para a nossa seção do R. E para carregarmos esse pacote para a nossa seção, ele precisa estar instalá-do em nosso computador. Logo, o erro da questão (que se refere ao pacote <code>dplyr</code>) está nos dizendo que o R não foi capaz de encontrar um pacote instalado em sua máquina, que tenha o nome de <code>dplyr</code>. Por esse motivo, para utilizar o pacote <code>dplyr</code> com o comando <code>library()</code>, você precisa primeiro instalar esse pacote em sua máquina, com o comando <code>install.packages()</code></p>
<div class="sourceCode" id="cb1965"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1965-1"><a href="#cb1965-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;dplyr&quot;</span>)</span></code></pre></div>
<center>
<em>Exercício 3</em>
</center>
<p><strong>1.3.A)</strong> Lembre-se que a fórmula do índice <span class="math inline">\(Z\)</span> de uma distribuição normal, usualmente assume a forma:</p>
<p><span class="math display">\[Z = \frac{X - \bar{X}}{\sigma}\]</span></p>
<p>Sendo que, as variáveis nessa equação são:</p>
<ul>
<li><span class="math inline">\(X\)</span>: a variável em questão.</li>
<li><span class="math inline">\(\bar{X}\)</span>: média da variável <span class="math inline">\(X\)</span>.</li>
<li><span class="math inline">\(\sigma\)</span>: desvio padrão da variável <span class="math inline">\(X\)</span>.</li>
</ul>
<p>Logo, os comandos necessários para o cálculo são:</p>
<div class="sourceCode" id="cb1966"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1966-1"><a href="#cb1966-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Lembre-se que você precisa criar </span></span>
<span id="cb1966-2"><a href="#cb1966-2" aria-hidden="true" tabindex="-1"></a><span class="do">### o objeto vec (com o comando abaixo)</span></span>
<span id="cb1966-3"><a href="#cb1966-3" aria-hidden="true" tabindex="-1"></a><span class="do">### antes que você possa utilizá-lo em operações</span></span>
<span id="cb1966-4"><a href="#cb1966-4" aria-hidden="true" tabindex="-1"></a><span class="do">### no R</span></span>
<span id="cb1966-5"><a href="#cb1966-5" aria-hidden="true" tabindex="-1"></a>vec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">1.2</span>, <span class="fl">2.5</span>, <span class="fl">1.3</span>, <span class="fl">2.2</span>, <span class="fl">3.7</span>)</span>
<span id="cb1966-6"><a href="#cb1966-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1966-7"><a href="#cb1966-7" aria-hidden="true" tabindex="-1"></a>desvio_padrao <span class="ot">&lt;-</span> <span class="fu">sd</span>(vec)</span>
<span id="cb1966-8"><a href="#cb1966-8" aria-hidden="true" tabindex="-1"></a>media <span class="ot">&lt;-</span> <span class="fu">mean</span>(vec)</span>
<span id="cb1966-9"><a href="#cb1966-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1966-10"><a href="#cb1966-10" aria-hidden="true" tabindex="-1"></a>resposta <span class="ot">&lt;-</span> (media <span class="sc">-</span> vec) <span class="sc">/</span> desvio_padrao</span>
<span id="cb1966-11"><a href="#cb1966-11" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(resposta)</span></code></pre></div>
<pre><code>## [1]  1.2278812  0.6139406 -0.5262348  0.5262348 -0.2631174 -1.5787044</code></pre>
<p><strong>1.3.B)</strong> Lembre-se que o desvio médio de uma variável é simplesmente uma média dos desvios de seus valores em relação a sua média. Em outras palavras, a fórmula de cálculo do desvio médio (<span class="math inline">\(DM\)</span>) de uma variável chamada <span class="math inline">\(x\)</span>, seria:</p>
<p><span class="math display">\[DM = \frac{1}{n}\displaystyle\sum_{i=1}^{n}|x - \bar{x}|\]</span></p>
<p>Sendo que, as variáveis nessa equação são:</p>
<ul>
<li><span class="math inline">\(n\)</span>: número de observações (ou de valores) que a variável contém.</li>
<li><span class="math inline">\(\bar{x}\)</span>: média da variável <span class="math inline">\(x\)</span>.</li>
<li><span class="math inline">\(x\)</span>: o valor da variável <span class="math inline">\(x\)</span>.</li>
</ul>
<div class="sourceCode" id="cb1968"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1968-1"><a href="#cb1968-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Lembre-se que você precisa criar </span></span>
<span id="cb1968-2"><a href="#cb1968-2" aria-hidden="true" tabindex="-1"></a><span class="do">### o objeto vec (com o comando abaixo)</span></span>
<span id="cb1968-3"><a href="#cb1968-3" aria-hidden="true" tabindex="-1"></a><span class="do">### antes que você possa utilizá-lo em operações</span></span>
<span id="cb1968-4"><a href="#cb1968-4" aria-hidden="true" tabindex="-1"></a><span class="do">### no R</span></span>
<span id="cb1968-5"><a href="#cb1968-5" aria-hidden="true" tabindex="-1"></a>vec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">1.2</span>, <span class="fl">2.5</span>, <span class="fl">1.3</span>, <span class="fl">2.2</span>, <span class="fl">3.7</span>)</span>
<span id="cb1968-6"><a href="#cb1968-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1968-7"><a href="#cb1968-7" aria-hidden="true" tabindex="-1"></a>desvios <span class="ot">&lt;-</span> vec <span class="sc">-</span> <span class="fu">mean</span>(vec)</span>
<span id="cb1968-8"><a href="#cb1968-8" aria-hidden="true" tabindex="-1"></a>total_desvio <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">abs</span>(desvios))</span>
<span id="cb1968-9"><a href="#cb1968-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1968-10"><a href="#cb1968-10" aria-hidden="true" tabindex="-1"></a>resposta <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">/</span> <span class="fu">length</span>(vec)) <span class="sc">*</span> total_desvio</span>
<span id="cb1968-11"><a href="#cb1968-11" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(resposta)</span></code></pre></div>
<pre><code>## [1] 0.9</code></pre>
</div>
</div>
<div id="referências" class="section level1 unnumbered">
<h1 class="unnumbered">Referências</h1>
<div id="capítulo-2---fundamentos-da-linguagem-r" class="section level2 unlisted unnumbered">
<h2 class="unlisted unnumbered">Capítulo 2 - Fundamentos da Linguagem R</h2>
<center>
<em>Exercício 1</em>
</center>
<p><strong>2.1.A)</strong> Uma lista contendo um vetor em seu primeiro (e único) elemento.</p>
<div class="sourceCode" id="cb1970"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1970-1"><a href="#cb1970-1" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">15</span>)</span></code></pre></div>
<pre><code>## [[1]]
##  [1]  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15</code></pre>
<p><strong>2.1.B)</strong> Um vetor atômico contendo a sequência de 1 a 10.</p>
<div class="sourceCode" id="cb1972"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1972-1"><a href="#cb1972-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">:</span><span class="dv">10</span></span></code></pre></div>
<pre><code>##  [1]  1  2  3  4  5  6  7  8  9 10</code></pre>
<p><strong>2.1.C)</strong> Uma matriz <span class="math inline">\(5\times5\)</span> (5 linhas e 5 colunas) contendo valores do tipo <code>character</code>.</p>
<div class="sourceCode" id="cb1974"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1974-1"><a href="#cb1974-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb1974-2"><a href="#cb1974-2" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">sample</span>(</span>
<span id="cb1974-3"><a href="#cb1974-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">&quot;MG&quot;</span>, <span class="st">&quot;SP&quot;</span>, <span class="st">&quot;DF&quot;</span>, <span class="st">&quot;MS&quot;</span>),</span>
<span id="cb1974-4"><a href="#cb1974-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">size =</span> <span class="dv">25</span>, <span class="at">replace =</span> <span class="cn">TRUE</span></span>
<span id="cb1974-5"><a href="#cb1974-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1974-6"><a href="#cb1974-6" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(a) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">5</span>)</span>
<span id="cb1974-7"><a href="#cb1974-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(a)</span></code></pre></div>
<pre><code>##      [,1] [,2] [,3] [,4] [,5]
## [1,] &quot;MG&quot; &quot;MG&quot; &quot;DF&quot; &quot;SP&quot; &quot;MG&quot;
## [2,] &quot;MS&quot; &quot;DF&quot; &quot;DF&quot; &quot;SP&quot; &quot;DF&quot;
## [3,] &quot;DF&quot; &quot;DF&quot; &quot;MG&quot; &quot;SP&quot; &quot;MG&quot;
## [4,] &quot;MG&quot; &quot;SP&quot; &quot;MG&quot; &quot;SP&quot; &quot;MG&quot;
## [5,] &quot;SP&quot; &quot;SP&quot; &quot;MG&quot; &quot;DF&quot; &quot;MG&quot;</code></pre>
<p><strong>2.1.D)</strong> Um <code>data.frame</code> que possui 10 linhas e 2 colunas.</p>
<div class="sourceCode" id="cb1976"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1976-1"><a href="#cb1976-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(</span>
<span id="cb1976-2"><a href="#cb1976-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">id =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,</span>
<span id="cb1976-3"><a href="#cb1976-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">valor =</span> <span class="fu">round</span>(<span class="fu">rnorm</span>(<span class="dv">10</span>), <span class="dv">2</span>)</span>
<span id="cb1976-4"><a href="#cb1976-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>##    id valor
## 1   1 -0.29
## 2   2 -0.30
## 3   3 -0.41
## 4   4  0.25
## 5   5 -0.89
## 6   6  0.44
## 7   7 -1.24
## 8   8 -0.22
## 9   9  0.38
## 10 10  0.13</code></pre>
<p><strong>2.1.E)</strong> Uma lista contendo 4 itens (ou 4 elementos).</p>
<pre><code>## $estado
## [1] &quot;MG&quot;
## 
## $cidade
## [1] &quot;Belo Horizonte&quot;
## 
## $n_municipios
## [1] 853
## 
## $regiao
## [1] &quot;Sudeste&quot;</code></pre>
<p><strong>2.1.F)</strong> Um vetor atômico preenchido por 20 <code>NA</code>’s.</p>
<pre><code>##  [1] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA</code></pre>
<center>
<em>Exercício 2</em>
</center>
<p><strong>2.2.A)</strong> Essa é uma espécie de pegadinha, não porque ela seja maldosa, mas porque demonstra certos cuidados necessários. Provavelmente, o seu primeiro instinto nessa questão foi utilizar a função <code>is.vector()</code>, o que é um bom começo, pois ela é capaz de identificar os objetos <code>v_rep</code> e <code>v_seq</code> como vetores atômicos. Ao mesmo tempo, essa função também consegue caracterizar os objetos <code>dt</code> e <code>mt</code> como estruturas diferentes de um vetor atômico.</p>
<p>Entretanto, a função <code>is.vector()</code> acaba considerando o objeto <code>lst</code> como um vetor também! Lembre-se que, <strong>uma lista é no fundo, um vetor,</strong> onde cada elemento desse vetor pode ser de tipo e estrutura diferentes de seus pares. Portanto, a função <code>is.vector()</code> é capaz de identificar se um objeto é um vetor, mas não necessariamente se ele é um vetor atômico. Por esse motivo, para nos certificarmos de que um dado objeto é um vetor atômico, temos que saber se ele, além de um vetor, também é um objeto diferente de uma lista, através da função <code>is.list()</code>.</p>
<p>Utilizando o operador <code>!</code> sobre <code>is.list()</code>, podemos identificar se o objeto <strong>não é uma lista</strong>. Com isso, precisamos apenas conectar esse teste à função <code>is.vector()</code> e, dessa maneira, temos um teste lógico que segue a estrutura <code>is.vector(x) &amp; !is.list(x)</code>.</p>
<div class="sourceCode" id="cb1980"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1980-1"><a href="#cb1980-1" aria-hidden="true" tabindex="-1"></a>v_seq <span class="ot">&lt;-</span> <span class="dv">10</span><span class="sc">:</span><span class="dv">25</span></span>
<span id="cb1980-2"><a href="#cb1980-2" aria-hidden="true" tabindex="-1"></a>v_rep <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="st">&quot;abc&quot;</span>, <span class="at">times =</span> <span class="dv">30</span>)</span>
<span id="cb1980-3"><a href="#cb1980-3" aria-hidden="true" tabindex="-1"></a>lst <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span>
<span id="cb1980-4"><a href="#cb1980-4" aria-hidden="true" tabindex="-1"></a>mt <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>, <span class="at">nrow =</span> <span class="dv">4</span>, <span class="at">ncol =</span> <span class="dv">5</span>)</span>
<span id="cb1980-5"><a href="#cb1980-5" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="dv">15</span>, <span class="st">&quot;A&quot;</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span>
<span id="cb1980-6"><a href="#cb1980-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1980-7"><a href="#cb1980-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1980-8"><a href="#cb1980-8" aria-hidden="true" tabindex="-1"></a><span class="fu">is.vector</span>(v_rep) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.list</span>(v_rep)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb1982"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1982-1"><a href="#cb1982-1" aria-hidden="true" tabindex="-1"></a><span class="fu">is.vector</span>(v_seq) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.list</span>(v_seq)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb1984"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1984-1"><a href="#cb1984-1" aria-hidden="true" tabindex="-1"></a><span class="fu">is.vector</span>(lst) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.list</span>(lst)</span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<p><strong>2.2.B)</strong> Nesta questão, ao utilizar a função <code>is.list()</code>, você já tem metade do teste lógico necessário para identificar o objeto <code>lst</code> como uma lista. Porém, esta questão, também inclui uma pegadinha parecida com a questão anterior. Pois da mesma maneira que uma lista é, no fundo, um vetor; um <code>data.frame</code> é, no fundo, uma lista nomeada. Isso significa que, a função <code>is.list()</code> também vai nos retornar <code>TRUE</code> para qualquer <code>data.frame</code>, e se desejamos identificar <strong>apenas</strong> listas, precisamos incrementar o nosso teste lógico de modo que ele possa diferenciar <code>data.frame</code>’s de listas.</p>
<p>A função necessária para esse trabalho é <code>is.data.frame()</code>, e utilizando novamente o operador <code>!</code> sobre o resultado dessa função, podemos identificar qualquer objeto que <strong>não é</strong> um <code>data.frame</code>. Com isso, temos um teste lógico que segue a estrutura <code>is.list(x) &amp; !is.data.frame(x)</code>.</p>
<div class="sourceCode" id="cb1986"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1986-1"><a href="#cb1986-1" aria-hidden="true" tabindex="-1"></a>lst <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb1986-2"><a href="#cb1986-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">estado =</span> <span class="st">&quot;MG&quot;</span>,</span>
<span id="cb1986-3"><a href="#cb1986-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">cidade =</span> <span class="st">&quot;Belo Horizonte&quot;</span>,</span>
<span id="cb1986-4"><a href="#cb1986-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_municipios =</span> <span class="dv">853</span>,</span>
<span id="cb1986-5"><a href="#cb1986-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">regiao =</span> <span class="st">&quot;Sudeste&quot;</span></span>
<span id="cb1986-6"><a href="#cb1986-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1986-7"><a href="#cb1986-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1986-8"><a href="#cb1986-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1986-9"><a href="#cb1986-9" aria-hidden="true" tabindex="-1"></a><span class="fu">is.list</span>(lst) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.data.frame</span>(lst)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p><strong>2.2.C)</strong> Quando temos uma lista nomeada (isto é, cada elemento dessa lista possui um nome), podemos descobrir os nomes de cada elemento dessa lista por meio da função <code>names()</code>. Logo, para descobrirmos se essa lista inclui um item chamado “estado,” precisamos apenas de um teste lógico que possa identificar se o valor <code>"estado"</code> está incluso no resultado da função <code>names()</code>.</p>
<div class="sourceCode" id="cb1988"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1988-1"><a href="#cb1988-1" aria-hidden="true" tabindex="-1"></a>lst <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb1988-2"><a href="#cb1988-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">estado =</span> <span class="st">&quot;MG&quot;</span>,</span>
<span id="cb1988-3"><a href="#cb1988-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">cidade =</span> <span class="st">&quot;Belo Horizonte&quot;</span>,</span>
<span id="cb1988-4"><a href="#cb1988-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_municipios =</span> <span class="dv">853</span>,</span>
<span id="cb1988-5"><a href="#cb1988-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">regiao =</span> <span class="st">&quot;Sudeste&quot;</span></span>
<span id="cb1988-6"><a href="#cb1988-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1988-7"><a href="#cb1988-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1988-8"><a href="#cb1988-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1988-9"><a href="#cb1988-9" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;estado&quot;</span> <span class="sc">%in%</span> <span class="fu">names</span>(lst)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb1990"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1990-1"><a href="#cb1990-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Repare que ao aplicarmos o mesmo</span></span>
<span id="cb1990-2"><a href="#cb1990-2" aria-hidden="true" tabindex="-1"></a><span class="do">### teste sobre o objeto lst_sem_estado</span></span>
<span id="cb1990-3"><a href="#cb1990-3" aria-hidden="true" tabindex="-1"></a><span class="do">### o resultado é FALSE, indicando que</span></span>
<span id="cb1990-4"><a href="#cb1990-4" aria-hidden="true" tabindex="-1"></a><span class="do">### essa lista não possui um item chamado</span></span>
<span id="cb1990-5"><a href="#cb1990-5" aria-hidden="true" tabindex="-1"></a><span class="do">### &quot;estado&quot;</span></span>
<span id="cb1990-6"><a href="#cb1990-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1990-7"><a href="#cb1990-7" aria-hidden="true" tabindex="-1"></a>lst_sem_estado <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb1990-8"><a href="#cb1990-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">regiao =</span> <span class="st">&quot;Sudeste&quot;</span>,</span>
<span id="cb1990-9"><a href="#cb1990-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_municipios =</span> <span class="dv">853</span></span>
<span id="cb1990-10"><a href="#cb1990-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1990-11"><a href="#cb1990-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1990-12"><a href="#cb1990-12" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;estado&quot;</span> <span class="sc">%in%</span> <span class="fu">names</span>(lst_sem_estado)</span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<p><strong>2.2.D)</strong> Basta utilizarmos a função <code>is.double()</code> sobre a coluna <code>total</code> de <code>tab</code>, como está demonstrado abaixo:</p>
<div class="sourceCode" id="cb1992"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1992-1"><a href="#cb1992-1" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb1992-2"><a href="#cb1992-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">unidade =</span> <span class="fu">c</span>(<span class="st">&quot;Centro&quot;</span>, <span class="st">&quot;Gameleira&quot;</span>, <span class="st">&quot;Santa Efigênia&quot;</span>, <span class="st">&quot;Centro&quot;</span>,</span>
<span id="cb1992-3"><a href="#cb1992-3" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;Barro Preto&quot;</span>, <span class="st">&quot;Centro&quot;</span>, <span class="st">&quot;Gameleira&quot;</span>, <span class="st">&quot;Centro&quot;</span>,</span>
<span id="cb1992-4"><a href="#cb1992-4" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;Barro Preto&quot;</span>, <span class="st">&quot;Santa Efigênia&quot;</span>),</span>
<span id="cb1992-5"><a href="#cb1992-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">mes =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">4</span>),</span>
<span id="cb1992-6"><a href="#cb1992-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">vendas =</span> <span class="fu">c</span>(<span class="dv">1502</span>, <span class="dv">1430</span>, <span class="dv">1100</span>, <span class="dv">1200</span>, <span class="dv">1443</span>, <span class="dv">1621</span>, <span class="dv">1854</span>, <span class="dv">2200</span>,</span>
<span id="cb1992-7"><a href="#cb1992-7" aria-hidden="true" tabindex="-1"></a>             <span class="dv">1129</span>, <span class="dv">1872</span>),</span>
<span id="cb1992-8"><a href="#cb1992-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">total =</span> <span class="fu">c</span>(<span class="fl">5362.14</span>, <span class="fl">5105.1</span>, <span class="dv">3927</span>, <span class="dv">4284</span>, <span class="fl">5151.51</span>, <span class="fl">5786.97</span>, </span>
<span id="cb1992-9"><a href="#cb1992-9" aria-hidden="true" tabindex="-1"></a>            <span class="fl">6618.78</span>, <span class="dv">7854</span>, <span class="fl">4030.53</span>, <span class="fl">6683.04</span>)</span>
<span id="cb1992-10"><a href="#cb1992-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1992-11"><a href="#cb1992-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1992-12"><a href="#cb1992-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1992-13"><a href="#cb1992-13" aria-hidden="true" tabindex="-1"></a><span class="do">### Use a função is.double() sobre a coluna</span></span>
<span id="cb1992-14"><a href="#cb1992-14" aria-hidden="true" tabindex="-1"></a><span class="fu">is.double</span>(tab<span class="sc">$</span>total)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p><strong>2.2.E)</strong> Lembre-se que <strong>as três condições apresentadas no enunciado da questão são dependentes</strong>. Logo, o objeto que você está testando deve se encaixar nas três condições ao mesmo tempo. Em termos técnicos, isso significa que os testes lógicos referentes a cada uma das três condições, devem obrigatoriamente retornar <code>TRUE</code> para este objeto. Se ao aplicarmos pelo menos um desses testes, e o resultado for <code>FALSE</code>, isso significa que o objeto em questão não se encaixa no teste lógico como um todo, ou, o resultado geral do teste lógico é <code>FALSE</code>. Para que o R entenda que essas condições são dependentes, e que devem ser satisfeitas ao mesmo tempo, você deve conectar as três condições pelo operador <code>&amp;</code>.</p>
<p>Para satisfazer a primeira condição posta no enunciado, podemos conferir se o resultado da função <code>nrow()</code> (que nos retorna o número de linhas presente em um <code>data.frame</code>) é igual a 10, construindo assim, o seguinte componente do teste: <code>nrow(x) == 10</code>. Já para a segunda condição, podemos pesquisar se o valor <code>"vendas"</code> aparece dentro do resultado da função <code>colnames()</code> (uma outra alternativa seria a função <code>names()</code> que gera o mesmo resultado de <code>colnames()</code>). Como <code>colnames()</code> geralmente nos retorna um conjunto de valores (ao invés de 1 único valor), é importante que você utilize o operador <code>%in%</code> (ao invés do operador <code>==</code>) para pesquisar pelo valor <code>"vendas"</code>. Dessa forma, temos o segundo componente do teste <code>"vendas" %in% colnames(x)</code>. Por último, para conferirmos a terceira condição do teste, podemos aplicar a função <code>is.character()</code> sobre a 3° coluna do objeto em questão, criando assim o último componente do teste <code>is.character(x[[3]])</code>.</p>
<p>Sendo assim, temos um teste com a seguinte estrutura: <code>nrow(x) == 10 &amp; "vendas" %in% colnames(x) &amp; is.character(x[[3]])</code>. Perceba abaixo que, o resultado do teste lógico foi <code>FALSE</code> quando aplicado sobre <code>tab</code>, indicando assim, que o objeto <code>tab</code> não se encaixa em pelo menos uma das condições do teste. Para identificar qual dessas condições que <code>tab</code> não se encaixa, você pode observar o resultado de cada um dos três componentes do teste de forma separada.</p>
<div class="sourceCode" id="cb1994"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1994-1"><a href="#cb1994-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(tab) <span class="sc">==</span> <span class="dv">10</span> <span class="sc">&amp;</span> <span class="st">&quot;vendas&quot;</span> <span class="sc">%in%</span> <span class="fu">colnames</span>(tab) <span class="sc">&amp;</span> <span class="fu">is.character</span>(tab[[<span class="dv">3</span>]])</span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<p>Repare abaixo, que os testes <code>nrow(tab) == 10</code> e <code>"vendas" %in% colnames(tab)</code> nos retornam um valor <code>TRUE</code>, logo, <code>tab</code> satisfaz ambas as condições. Contudo, o último teste resulta em <code>FALSE</code>. Portanto, <code>tab</code> não satisfaz a última condição do teste, ou, dito de outra forma, a 3° coluna de <code>tab</code> não é do tipo <code>character</code>.</p>
<div class="sourceCode" id="cb1996"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1996-1"><a href="#cb1996-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(tab) <span class="sc">==</span> <span class="dv">10</span></span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb1998"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1998-1"><a href="#cb1998-1" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;vendas&quot;</span> <span class="sc">%in%</span> <span class="fu">colnames</span>(tab)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb2000"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2000-1"><a href="#cb2000-1" aria-hidden="true" tabindex="-1"></a><span class="fu">is.character</span>(tab[[<span class="dv">3</span>]])</span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<p><strong>2.2.F)</strong> Lembre-se que as condições a serem satisfeitas, para que o ano seja considerado bissexto são: 1) o ano deve ser múltiplo de 4; 2) o ano não deve ser múltiplo de 100 a não ser que ele seja múltiplo de 400; 3) se o ano é múltiplo de 400, ele é obrigatoriamente um ano bissexto.</p>
<p>Para identificarmos se um dado número é múltiplo de um outro número, podemos observar se o resto da divisão entre esses dois números é igual a zero. Em outras palavras, se desejamos saber que um dado valor <span class="math inline">\(x\)</span> é múltiplo de um dado valor <span class="math inline">\(y\)</span>, podemos realizar o cálculo <span class="math inline">\(x \div y\)</span> e, observar se o resto dessa divisão é ou não igual a zero. Lembre-se que no R, temos o operador aritmético <code>%%</code>, que nos retorna justamente o resto da divisão entre dois números.</p>
<p>Tendo isso em mente, para satisfazermos as condições 1 e 3, podemos simplesmente conferir se os resultados das operações <code>ano %% 4</code> e <code>ano %% 400</code> são iguais a zero, construindo assim os componentes <code>ano %% 4 == 0</code> e <code>ano %% 400 == 0</code>. Entretanto, como a condição 2 estabelece que o respectivo ano não deve ser múltiplo de 100, podemos aplicar o operador <code>!</code> sobre o componente do teste referente a essa condição. Deste modo, temos o componente <code>!(ano %% 100 == 0)</code>. Uma outra alternativa para essa condição 2, seria utilizarmos o operador <code>!=</code>, que significa “não igual a,” ou, “diferente de.” Com esse operador teríamos <code>ano %% 100 != 0</code>.</p>
<p>Agora que definimos os componentes do teste, precisamos nos atentar à relação de hierarquia entre essas condições. Pois a condição 3 predomina sobre as condições 1 e 2, assim como as condições 3 e 2 prevalecem sobre a condição 1. Com isso, se um dado ano é múltiplo de 400, não nos interessa se ele é ou não múltiplo de 100 ou de 4, ele é um ano bissexto e ponto final. Da mesma forma que, se o ano não é múltiplo de 400, mas ele é múltiplo de 100, ele não é um ano bissexto, mesmo que ele seja múltiplo de 4.</p>
<p>Primeiro, para que o ano seja bissexto, temos duas possibilidades dentro da relação entre as condições 2 e 3. Ou o número do ano é múltiplo de 400, ou ele não é múltiplo de 100. Como essas duas possibilidades são independentes (ou seja, ou o ano é uma coisa, ou ele é outra), podemos conectar essas duas condições pelo operador <code>|</code>, construindo assim o componente <code>(ano %% 100 != 0) | (ano %% 400 == 0)</code> do teste. Veja alguns exemplos abaixo:</p>
<div class="sourceCode" id="cb2002"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2002-1"><a href="#cb2002-1" aria-hidden="true" tabindex="-1"></a>ano <span class="ot">&lt;-</span> <span class="dv">1240</span></span>
<span id="cb2002-2"><a href="#cb2002-2" aria-hidden="true" tabindex="-1"></a>(ano <span class="sc">%%</span> <span class="dv">100</span> <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">|</span> (ano <span class="sc">%%</span> <span class="dv">400</span> <span class="sc">==</span> <span class="dv">0</span>)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb2004"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2004-1"><a href="#cb2004-1" aria-hidden="true" tabindex="-1"></a>ano <span class="ot">&lt;-</span> <span class="dv">3200</span></span>
<span id="cb2004-2"><a href="#cb2004-2" aria-hidden="true" tabindex="-1"></a>(ano <span class="sc">%%</span> <span class="dv">100</span> <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">|</span> (ano <span class="sc">%%</span> <span class="dv">400</span> <span class="sc">==</span> <span class="dv">0</span>)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb2006"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2006-1"><a href="#cb2006-1" aria-hidden="true" tabindex="-1"></a>ano <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb2006-2"><a href="#cb2006-2" aria-hidden="true" tabindex="-1"></a>(ano <span class="sc">%%</span> <span class="dv">100</span> <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">|</span> (ano <span class="sc">%%</span> <span class="dv">400</span> <span class="sc">==</span> <span class="dv">0</span>)</span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<p>Devido a independência entre essas condições (estabelecida pelo operador <code>|</code>), o R vai nos retornar <code>TRUE</code> caso o valor de <code>ano</code> se encaixe em pelo menos uma dessas duas condições. Isso significa que, se o valor de ano for múltiplo de 400, ele adquire um valor <code>TRUE</code> para o teste <code>ano %% 400 == 0</code> e, consequentemente, um valor <code>TRUE</code> para todo o componente <code>(ano %% 100 != 0) | (ano %% 400 == 0)</code>.</p>
<p>Com isso, precisamos apenas conectar esse componente ao outro componente <code>(ano %% 4 == 0)</code>, que representa a condição 1, formando assim a estrutura final do teste: <code>(ano %% 4 == 0) &amp; ((ano %% 100 != 0) | (ano %% 400 == 0))</code>. Dessa vez, utilizamos o operador que indica dependência (<code>&amp;</code>) entre esses dois componentes principais do teste lógico, que são <code>(ano %% 4 == 0)</code> e <code>(ano %% 100 != 0) | (ano %% 400 == 0)</code>, pois um número que é múltiplo de 4, ainda pode ser um múltiplo de 100. Portanto, essa condição de dependência apenas assegura que a condição 2 seja respeitada, caso o número atenda a condição 1.</p>
<div class="sourceCode" id="cb2008"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2008-1"><a href="#cb2008-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Por exemplo, 2006 não é um ano bissexto</span></span>
<span id="cb2008-2"><a href="#cb2008-2" aria-hidden="true" tabindex="-1"></a>ano <span class="ot">&lt;-</span> <span class="dv">2006</span></span>
<span id="cb2008-3"><a href="#cb2008-3" aria-hidden="true" tabindex="-1"></a>(ano <span class="sc">%%</span> <span class="dv">4</span> <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">&amp;</span> ((ano <span class="sc">%%</span> <span class="dv">100</span> <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">|</span> (ano <span class="sc">%%</span> <span class="dv">400</span> <span class="sc">==</span> <span class="dv">0</span>))</span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<div class="sourceCode" id="cb2010"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2010-1"><a href="#cb2010-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Mas o ano de 2004 é um ano bissexto</span></span>
<span id="cb2010-2"><a href="#cb2010-2" aria-hidden="true" tabindex="-1"></a>ano <span class="ot">&lt;-</span> <span class="dv">2004</span></span>
<span id="cb2010-3"><a href="#cb2010-3" aria-hidden="true" tabindex="-1"></a>(ano <span class="sc">%%</span> <span class="dv">4</span> <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">&amp;</span> ((ano <span class="sc">%%</span> <span class="dv">100</span> <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">|</span> (ano <span class="sc">%%</span> <span class="dv">400</span> <span class="sc">==</span> <span class="dv">0</span>))</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<center>
<em>Exercício 3</em>
</center>
<p><strong>2.3.A)</strong> O vetor resultante será do tipo <code>character</code>.</p>
<div class="sourceCode" id="cb2012"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2012-1"><a href="#cb2012-1" aria-hidden="true" tabindex="-1"></a>vec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">1.2</span>, <span class="fl">2.4</span>, <span class="st">&quot;3.1&quot;</span>, <span class="fl">1.9</span>)</span>
<span id="cb2012-2"><a href="#cb2012-2" aria-hidden="true" tabindex="-1"></a><span class="fu">typeof</span>(vec)</span></code></pre></div>
<pre><code>## [1] &quot;character&quot;</code></pre>
<p><strong>2.3.B)</strong> O vetor resultante será do tipo <code>double</code>.</p>
<div class="sourceCode" id="cb2014"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2014-1"><a href="#cb2014-1" aria-hidden="true" tabindex="-1"></a>integers <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span></span>
<span id="cb2014-2"><a href="#cb2014-2" aria-hidden="true" tabindex="-1"></a>doubles <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">2.23</span>, <span class="fl">9.87</span>, <span class="fl">3.2</span>)</span>
<span id="cb2014-3"><a href="#cb2014-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2014-4"><a href="#cb2014-4" aria-hidden="true" tabindex="-1"></a>vec <span class="ot">&lt;-</span> <span class="fu">c</span>(integers, doubles)</span>
<span id="cb2014-5"><a href="#cb2014-5" aria-hidden="true" tabindex="-1"></a><span class="fu">typeof</span>(vec)</span></code></pre></div>
<pre><code>## [1] &quot;double&quot;</code></pre>
<p><strong>2.3.C)</strong> O vetor resultante será do tipo <code>double</code></p>
<div class="sourceCode" id="cb2016"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2016-1"><a href="#cb2016-1" aria-hidden="true" tabindex="-1"></a>vec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">1.56</span>, 3L, 1L, 5L,  <span class="fl">2.32</span>, <span class="fl">9.87</span>)</span>
<span id="cb2016-2"><a href="#cb2016-2" aria-hidden="true" tabindex="-1"></a><span class="fu">typeof</span>(vec)</span></code></pre></div>
<pre><code>## [1] &quot;double&quot;</code></pre>
<p><strong>2.3.D)</strong> O vetor resultante será do tipo <code>integer</code>.</p>
<div class="sourceCode" id="cb2018"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2018-1"><a href="#cb2018-1" aria-hidden="true" tabindex="-1"></a>vec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="cn">TRUE</span>, 1L, <span class="cn">FALSE</span>)</span>
<span id="cb2018-2"><a href="#cb2018-2" aria-hidden="true" tabindex="-1"></a><span class="fu">typeof</span>(vec)</span></code></pre></div>
<pre><code>## [1] &quot;integer&quot;</code></pre>
<p><strong>2.3.E)</strong> O vetor resultante será do tipo <code>character</code>.</p>
<div class="sourceCode" id="cb2020"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2020-1"><a href="#cb2020-1" aria-hidden="true" tabindex="-1"></a>vec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;p&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>, <span class="cn">TRUE</span>, 2L, <span class="fl">4.318</span>)</span>
<span id="cb2020-2"><a href="#cb2020-2" aria-hidden="true" tabindex="-1"></a><span class="fu">typeof</span>(vec)</span></code></pre></div>
<pre><code>## [1] &quot;character&quot;</code></pre>
<center>
<em>Exercício 4</em>
</center>
<p><strong>2.4.A)</strong> Perceba que as duas condições descritas no enunciado são dependentes, logo, elas precisam ser atendidas ao mesmo tempo. Por isso, os dois componentes do teste lógico são conectados pelo operador <code>&amp;</code>.</p>
<div class="sourceCode" id="cb2022"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2022-1"><a href="#cb2022-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(nycflights13)</span>
<span id="cb2022-2"><a href="#cb2022-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2022-3"><a href="#cb2022-3" aria-hidden="true" tabindex="-1"></a>teste <span class="ot">&lt;-</span> flights<span class="sc">$</span>month <span class="sc">==</span> <span class="dv">5</span> <span class="sc">&amp;</span> flights<span class="sc">$</span>carrier <span class="sc">==</span> <span class="st">&quot;B6&quot;</span></span>
<span id="cb2022-4"><a href="#cb2022-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2022-5"><a href="#cb2022-5" aria-hidden="true" tabindex="-1"></a>flights[teste, ]</span></code></pre></div>
<pre><code>## # A tibble: 4,576 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;dbl&gt;          &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;          &lt;dbl&gt;
##  1  2013     5     1      548            600       -12      831            854
##  2  2013     5     1      556            600        -4      818            835
##  3  2013     5     1      557            600        -3      934            942
##  4  2013     5     1      602            602         0      657            710
##  5  2013     5     1      603            610        -7      844            906
##  6  2013     5     1      621            627        -6      834            900
##  7  2013     5     1      624            630        -6      736            747
##  8  2013     5     1      624            630        -6      854            906
##  9  2013     5     1      627            630        -3      900            916
## 10  2013     5     1      639            645        -6      838            853
## # ... with 4,566 more rows, and 11 more variables: arr_delay &lt;dbl&gt;,
## #   carrier &lt;chr&gt;, flight &lt;dbl&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
## #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<p><strong>2.4.B)</strong> Primeiro, temos que calcular o tempo de atraso total de cada voô, ao somar os tempos de atraso no momento de partida (<code>dep_delay</code>) e no momento de chegada (<code>arr_delay</code>). Com isso, podemos apenas utilizar o operador <code>&gt;</code> (“maior que”) para comparar o tempo de atraso total de cada voô com o resultado da função <code>mean()</code>. Como podemos ver abaixo, 95.685 voôs obtiveram um atraso acima da média.</p>
<div class="sourceCode" id="cb2024"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2024-1"><a href="#cb2024-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(nycflights13)</span>
<span id="cb2024-2"><a href="#cb2024-2" aria-hidden="true" tabindex="-1"></a><span class="do">### Primeiro, vamos calcular o atraso total</span></span>
<span id="cb2024-3"><a href="#cb2024-3" aria-hidden="true" tabindex="-1"></a><span class="do">### de cada voô</span></span>
<span id="cb2024-4"><a href="#cb2024-4" aria-hidden="true" tabindex="-1"></a>atraso_total <span class="ot">&lt;-</span> flights<span class="sc">$</span>dep_delay <span class="sc">+</span> flights<span class="sc">$</span>arr_delay</span>
<span id="cb2024-5"><a href="#cb2024-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2024-6"><a href="#cb2024-6" aria-hidden="true" tabindex="-1"></a>teste <span class="ot">&lt;-</span> atraso_total <span class="sc">&gt;</span> <span class="fu">mean</span>(atraso_total, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2024-7"><a href="#cb2024-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2024-8"><a href="#cb2024-8" aria-hidden="true" tabindex="-1"></a>flights[teste, ]</span></code></pre></div>
<pre><code>## # A tibble: 95,685 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;dbl&gt;          &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;          &lt;dbl&gt;
##  1  2013     1     1      533            529         4      850            830
##  2  2013     1     1      542            540         2      923            850
##  3  2013     1     1      559            600        -1      941            910
##  4  2013     1     1      608            600         8      807            735
##  5  2013     1     1      611            600        11      945            931
##  6  2013     1     1      624            630        -6      909            840
##  7  2013     1     1      628            630        -2     1016            947
##  8  2013     1     1      632            608        24      740            728
##  9  2013     1     1      635            635         0     1028            940
## 10  2013     1     1      702            700         2     1058           1014
## # ... with 95,675 more rows, and 11 more variables: arr_delay &lt;dbl&gt;,
## #   carrier &lt;chr&gt;, flight &lt;dbl&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
## #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<p><strong>2.4.C)</strong> Perceba que ao todo, foram descritas 4 condições no enunciado da questão. 1) <code>arr_delay</code> menor que 2; 2) <code>dest</code> igual a <code>"BOS"</code>; 3) <code>month</code> igual a 1; 4) <code>sched_dep_time</code> igual a 600.</p>
<div class="sourceCode" id="cb2026"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2026-1"><a href="#cb2026-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(nycflights13)</span>
<span id="cb2026-2"><a href="#cb2026-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2026-3"><a href="#cb2026-3" aria-hidden="true" tabindex="-1"></a>teste <span class="ot">&lt;-</span> (flights<span class="sc">$</span>arr_delay <span class="sc">&lt;</span> <span class="dv">2</span> <span class="sc">&amp;</span> flights<span class="sc">$</span>dest <span class="sc">==</span> <span class="st">&quot;BOS&quot;</span>) <span class="sc">|</span></span>
<span id="cb2026-4"><a href="#cb2026-4" aria-hidden="true" tabindex="-1"></a>  (flights<span class="sc">$</span>month <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> flights<span class="sc">$</span>sched_dep_time <span class="sc">==</span> <span class="dv">600</span>)</span>
<span id="cb2026-5"><a href="#cb2026-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2026-6"><a href="#cb2026-6" aria-hidden="true" tabindex="-1"></a>flights[teste, ]</span></code></pre></div>
<pre><code>## # A tibble: 11,500 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;dbl&gt;          &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;          &lt;dbl&gt;
##  1  2013     1     1      554            600        -6      812            837
##  2  2013     1     1      555            600        -5      913            854
##  3  2013     1     1      557            600        -3      709            723
##  4  2013     1     1      557            600        -3      838            846
##  5  2013     1     1      558            600        -2      753            745
##  6  2013     1     1      558            600        -2      849            851
##  7  2013     1     1      558            600        -2      853            856
##  8  2013     1     1      558            600        -2      924            917
##  9  2013     1     1      558            600        -2      923            937
## 10  2013     1     1      559            600        -1      941            910
## # ... with 11,490 more rows, and 11 more variables: arr_delay &lt;dbl&gt;,
## #   carrier &lt;chr&gt;, flight &lt;dbl&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
## #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;,
## #   time_hour &lt;dttm&gt;</code></pre>
<div class="sourceCode" id="cb2028"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2028-1"><a href="#cb2028-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Ou de forma um pouco mais organizada:</span></span>
<span id="cb2028-2"><a href="#cb2028-2" aria-hidden="true" tabindex="-1"></a><span class="do">###</span></span>
<span id="cb2028-3"><a href="#cb2028-3" aria-hidden="true" tabindex="-1"></a>condicao1 <span class="ot">&lt;-</span> flights<span class="sc">$</span>arr_delay <span class="sc">&lt;</span> <span class="dv">2</span> <span class="sc">&amp;</span> flights<span class="sc">$</span>dest <span class="sc">==</span> <span class="st">&quot;BOS&quot;</span></span>
<span id="cb2028-4"><a href="#cb2028-4" aria-hidden="true" tabindex="-1"></a>condicao2 <span class="ot">&lt;-</span> flights<span class="sc">$</span>month <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> flights<span class="sc">$</span>sched_dep_time <span class="sc">==</span> <span class="dv">600</span></span>
<span id="cb2028-5"><a href="#cb2028-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2028-6"><a href="#cb2028-6" aria-hidden="true" tabindex="-1"></a>teste <span class="ot">&lt;-</span> condicao1 <span class="sc">|</span> condicao2</span>
<span id="cb2028-7"><a href="#cb2028-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2028-8"><a href="#cb2028-8" aria-hidden="true" tabindex="-1"></a>flights[teste, ]</span></code></pre></div>
</div>
</div>
<div id="referências-1" class="section level1 unnumbered">
<h1 class="unnumbered">Referências</h1>
<div id="capítulo-3---importando-e-exportando-dados-com-o-r" class="section level2 unlisted unnumbered">
<h2 class="unlisted unnumbered">Capítulo 3 - Importando e exportando dados com o R</h2>
<center>
<em>Exercício 1</em>
</center>
<p><strong>3.1.A)</strong> Primeiro, sempre comece identificando o caractere especial que está separando cada coluna nesse arquivo. No caso do objeto <code>t</code> abaixo, esse caractere especial é o til (<code>~</code>). Com isso, podemos utilizar o argumento <code>delim</code>, da função <code>read_delim()</code> para termos uma primeira leitura do arquivo, como demonstrado abaixo:</p>
<div class="sourceCode" id="cb2029"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2029-1"><a href="#cb2029-1" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> <span class="st">&quot;</span></span>
<span id="cb2029-2"><a href="#cb2029-2" aria-hidden="true" tabindex="-1"></a><span class="st">ID~Valor/Grupo~Unidade</span></span>
<span id="cb2029-3"><a href="#cb2029-3" aria-hidden="true" tabindex="-1"></a><span class="st">1~2,5488/Marketing~Kg</span></span>
<span id="cb2029-4"><a href="#cb2029-4" aria-hidden="true" tabindex="-1"></a><span class="st">2~4,0101/Análise~Kg</span></span>
<span id="cb2029-5"><a href="#cb2029-5" aria-hidden="true" tabindex="-1"></a><span class="st">3~1097/Vendas~g</span></span>
<span id="cb2029-6"><a href="#cb2029-6" aria-hidden="true" tabindex="-1"></a><span class="st">4~12,76/Logísitica~Kg&quot;</span></span>
<span id="cb2029-7"><a href="#cb2029-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2029-8"><a href="#cb2029-8" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> <span class="fu">iconv</span>(t, <span class="at">from =</span> <span class="st">&quot;Latin1&quot;</span>, <span class="at">to =</span> <span class="st">&quot;UTF-8&quot;</span>)</span>
<span id="cb2029-9"><a href="#cb2029-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2029-10"><a href="#cb2029-10" aria-hidden="true" tabindex="-1"></a>readr<span class="sc">::</span><span class="fu">read_delim</span>(t, <span class="at">delim =</span> <span class="st">&quot;~&quot;</span>)</span></code></pre></div>
<pre><code>## Rows: 4 Columns: 3</code></pre>
<pre><code>## -- Column specification ---------------------------------------------------
## Delimiter: &quot;~&quot;
## chr (2): Valor/Grupo, Unidade
## dbl (1): ID</code></pre>
<pre><code>## 
## i Use `spec()` to retrieve the full column specification for this data.
## i Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<pre><code>## # A tibble: 4 x 3
##      ID `Valor/Grupo`    Unidade
##   &lt;dbl&gt; &lt;chr&gt;            &lt;chr&gt;  
## 1     1 2,5488/Marketing Kg     
## 2     2 4,0101/Análise   Kg     
## 3     3 1097/Vendas      g      
## 4     4 12,76/Logísitica Kg</code></pre>
<p><strong>3.1.B)</strong> Ao observarmos com cuidado os resultados apresentados pela questão, podemos identificar que a importação de ambos os arquivos (<code>pac1</code> e <code>pac2</code>) apresentam erros. Focando primeiramente em <code>pac1</code>, perceba que os valores presentes em todas as colunas numéricas (<code>Produção</code>, <code>Receita</code> e <code>Gasto em P&amp;D</code>) estão muito altos. Esse erro ocorre, devido ao padrão empregado pela função <code>read_delim()</code>. Lembre-se que grande parte das funções do pacote <code>readr</code> seguem o padrão americano, que utiliza o ponto como o separador decimal, e a vírgula, como separador de milhares.</p>
<div class="sourceCode" id="cb2034"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2034-1"><a href="#cb2034-1" aria-hidden="true" tabindex="-1"></a>pac1 <span class="ot">&lt;-</span> <span class="st">&quot;Setor;Produção;Receita;Gasto em P&amp;D</span></span>
<span id="cb2034-2"><a href="#cb2034-2" aria-hidden="true" tabindex="-1"></a><span class="st">Produtos alimentícios;10828,37;199907,55;3358,36</span></span>
<span id="cb2034-3"><a href="#cb2034-3" aria-hidden="true" tabindex="-1"></a><span class="st">Bebidas;759,53;28093,21;</span></span>
<span id="cb2034-4"><a href="#cb2034-4" aria-hidden="true" tabindex="-1"></a><span class="st">Produtos do fumo;69,99;8863,5;121,35</span></span>
<span id="cb2034-5"><a href="#cb2034-5" aria-hidden="true" tabindex="-1"></a><span class="st">Produtos têxteis;4153,97;25804,16;746,83</span></span>
<span id="cb2034-6"><a href="#cb2034-6" aria-hidden="true" tabindex="-1"></a><span class="st">Produtos de madeira;5088,78;15320,69;279,54</span></span>
<span id="cb2034-7"><a href="#cb2034-7" aria-hidden="true" tabindex="-1"></a><span class="st">Celulose e outras pastas;26,95;4245,19;216,7</span></span>
<span id="cb2034-8"><a href="#cb2034-8" aria-hidden="true" tabindex="-1"></a><span class="st">Refino de petróleo;75,48;114316,31;1550,73</span></span>
<span id="cb2034-9"><a href="#cb2034-9" aria-hidden="true" tabindex="-1"></a><span class="st">Produtos químicos;3179,52;133582,8;2914,09</span></span>
<span id="cb2034-10"><a href="#cb2034-10" aria-hidden="true" tabindex="-1"></a><span class="st">Produtos farmacêuticos;621,82;24972,07;1038,73&quot;</span></span>
<span id="cb2034-11"><a href="#cb2034-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2034-12"><a href="#cb2034-12" aria-hidden="true" tabindex="-1"></a>pac1 <span class="ot">&lt;-</span> <span class="fu">iconv</span>(pac1, <span class="at">from =</span> <span class="st">&quot;Latin1&quot;</span>, <span class="at">to =</span> <span class="st">&quot;UTF-8&quot;</span>)</span>
<span id="cb2034-13"><a href="#cb2034-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2034-14"><a href="#cb2034-14" aria-hidden="true" tabindex="-1"></a>readr<span class="sc">::</span><span class="fu">read_delim</span>(pac1, <span class="at">delim =</span> <span class="st">&quot;;&quot;</span>)</span></code></pre></div>
<pre><code>## Rows: 9 Columns: 4</code></pre>
<pre><code>## -- Column specification ---------------------------------------------------
## Delimiter: &quot;;&quot;
## chr (1): Setor</code></pre>
<pre><code>## 
## i Use `spec()` to retrieve the full column specification for this data.
## i Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<pre><code>## # A tibble: 9 x 4
##   Setor                    Produção  Receita `Gasto em P&amp;D`
##   &lt;chr&gt;                       &lt;dbl&gt;    &lt;dbl&gt;          &lt;dbl&gt;
## 1 Produtos alimentícios     1082837 19990755         335836
## 2 Bebidas                     75953  2809321             NA
## 3 Produtos do fumo             6999    88635          12135
## 4 Produtos têxteis           415397  2580416          74683
## 5 Produtos de madeira        508878  1532069          27954
## 6 Celulose e outras pastas     2695   424519           2167
## 7 Refino de petróleo           7548 11431631         155073
## 8 Produtos químicos          317952  1335828         291409
## 9 Produtos farmacêuticos      62182  2497207         103873</code></pre>
<p>Portanto, ao ler o número <code>10828,37</code>, a função <code>read_delim()</code> entende que esse valor corresponde ao número 1.082.837. Por esse motivo, precisamos sobrepor esse padrão, ao descrevermos explicitamente à função <code>read_delim()</code>, o padrão utilizado pelos valores numéricos presentes no arquivo <code>pac1</code>. Lembre-se que uma descrição desse tipo é fornecida dentro da função <code>locale()</code>, mais especificamente, no argumento <code>locale</code> da função que você está utilizando para a importação.</p>
<div class="sourceCode" id="cb2039"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2039-1"><a href="#cb2039-1" aria-hidden="true" tabindex="-1"></a>readr<span class="sc">::</span><span class="fu">read_delim</span>(</span>
<span id="cb2039-2"><a href="#cb2039-2" aria-hidden="true" tabindex="-1"></a>  pac1, <span class="at">delim =</span> <span class="st">&quot;;&quot;</span>,</span>
<span id="cb2039-3"><a href="#cb2039-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">locale =</span> <span class="fu">locale</span>(<span class="at">grouping_mark =</span> <span class="st">&quot;.&quot;</span>, <span class="at">decimal_mark =</span> <span class="st">&quot;,&quot;</span>)</span>
<span id="cb2039-4"><a href="#cb2039-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## Rows: 9 Columns: 4</code></pre>
<pre><code>## -- Column specification ---------------------------------------------------
## Delimiter: &quot;;&quot;
## chr (1): Setor
## dbl (3): Produção, Receita, Gasto em P&amp;D</code></pre>
<pre><code>## 
## i Use `spec()` to retrieve the full column specification for this data.
## i Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<pre><code>## # A tibble: 9 x 4
##   Setor                    Produção Receita `Gasto em P&amp;D`
##   &lt;chr&gt;                       &lt;dbl&gt;   &lt;dbl&gt;          &lt;dbl&gt;
## 1 Produtos alimentícios     10828.  199908.          3358.
## 2 Bebidas                     760.   28093.            NA 
## 3 Produtos do fumo             70.0   8864.           121.
## 4 Produtos têxteis           4154.   25804.           747.
## 5 Produtos de madeira        5089.   15321.           280.
## 6 Celulose e outras pastas     27.0   4245.           217.
## 7 Refino de petróleo           75.5 114316.          1551.
## 8 Produtos químicos          3180.  133583.          2914.
## 9 Produtos farmacêuticos      622.   24972.          1039.</code></pre>
<p>Por outro lado, podemos perceber que o arquivo <code>pac2</code> enfrenta o mesmo problema de <code>pac1</code>. Pois valores como <code>18.828,37</code> e <code>69,99</code>, foram interpretados pela função <code>read_delim()</code> como os números 18,828 e 6.999, respectivamente.</p>
<div class="sourceCode" id="cb2044"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2044-1"><a href="#cb2044-1" aria-hidden="true" tabindex="-1"></a>pac2 <span class="ot">&lt;-</span> <span class="st">&quot;Setor;Produção;Receita;Gasto em P&amp;D</span></span>
<span id="cb2044-2"><a href="#cb2044-2" aria-hidden="true" tabindex="-1"></a><span class="st">Produtos alimentícios;10.828,37;199907,55;3358,36</span></span>
<span id="cb2044-3"><a href="#cb2044-3" aria-hidden="true" tabindex="-1"></a><span class="st">Bebidas;759,53;28093,21;x</span></span>
<span id="cb2044-4"><a href="#cb2044-4" aria-hidden="true" tabindex="-1"></a><span class="st">Produtos do fumo;69,99;8863,5;121,35</span></span>
<span id="cb2044-5"><a href="#cb2044-5" aria-hidden="true" tabindex="-1"></a><span class="st">Produtos têxteis;4.153,97;25804,16;746,83</span></span>
<span id="cb2044-6"><a href="#cb2044-6" aria-hidden="true" tabindex="-1"></a><span class="st">Produtos de madeira;5.088,78;15320,69;279,54</span></span>
<span id="cb2044-7"><a href="#cb2044-7" aria-hidden="true" tabindex="-1"></a><span class="st">Celulose e outras pastas;26,95;4245,19;216,7</span></span>
<span id="cb2044-8"><a href="#cb2044-8" aria-hidden="true" tabindex="-1"></a><span class="st">Refino de petróleo;75,48;114316,31;1550,73</span></span>
<span id="cb2044-9"><a href="#cb2044-9" aria-hidden="true" tabindex="-1"></a><span class="st">Produtos químicos;3.179,52;133582,8;2914,09</span></span>
<span id="cb2044-10"><a href="#cb2044-10" aria-hidden="true" tabindex="-1"></a><span class="st">Produtos farmacêuticos;621,82;24972,07;1038,73&quot;</span></span>
<span id="cb2044-11"><a href="#cb2044-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2044-12"><a href="#cb2044-12" aria-hidden="true" tabindex="-1"></a>pac2 <span class="ot">&lt;-</span> <span class="fu">iconv</span>(pac2, <span class="at">from =</span> <span class="st">&quot;Latin1&quot;</span>, <span class="at">to =</span> <span class="st">&quot;UTF-8&quot;</span>)</span>
<span id="cb2044-13"><a href="#cb2044-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2044-14"><a href="#cb2044-14" aria-hidden="true" tabindex="-1"></a>readr<span class="sc">::</span><span class="fu">read_delim</span>(pac2, <span class="at">delim =</span> <span class="st">&quot;;&quot;</span>)</span></code></pre></div>
<pre><code>## Rows: 9 Columns: 4</code></pre>
<pre><code>## -- Column specification ---------------------------------------------------
## Delimiter: &quot;;&quot;
## chr (2): Setor, Gasto em P&amp;D</code></pre>
<pre><code>## 
## i Use `spec()` to retrieve the full column specification for this data.
## i Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<pre><code>## # A tibble: 9 x 4
##   Setor                    Produção  Receita `Gasto em P&amp;D`
##   &lt;chr&gt;                       &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;         
## 1 Produtos alimentícios       10.8  19990755 3358,36       
## 2 Bebidas                  75953     2809321 x             
## 3 Produtos do fumo          6999       88635 121,35        
## 4 Produtos têxteis             4.15  2580416 746,83        
## 5 Produtos de madeira          5.09  1532069 279,54        
## 6 Celulose e outras pastas  2695      424519 216,7         
## 7 Refino de petróleo        7548    11431631 1550,73       
## 8 Produtos químicos            3.18  1335828 2914,09       
## 9 Produtos farmacêuticos   62182     2497207 1038,73</code></pre>
<p>Para corrigir esse problema, utilizamos novamente a função <code>locale()</code>. Entretanto, um outro problema ainda persiste no arquivo <code>pac2</code>. Pois o tipo <code>character</code> foi aplicado sobre a coluna <code>Gasto em P&amp;D</code>, a qual é claramente uma coluna numérica.</p>
<div class="sourceCode" id="cb2049"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2049-1"><a href="#cb2049-1" aria-hidden="true" tabindex="-1"></a>readr<span class="sc">::</span><span class="fu">read_delim</span>(</span>
<span id="cb2049-2"><a href="#cb2049-2" aria-hidden="true" tabindex="-1"></a>  pac2, <span class="at">delim =</span> <span class="st">&quot;;&quot;</span>,</span>
<span id="cb2049-3"><a href="#cb2049-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">locale =</span> <span class="fu">locale</span>(<span class="at">grouping_mark =</span> <span class="st">&quot;.&quot;</span>, <span class="at">decimal_mark =</span> <span class="st">&quot;,&quot;</span>)</span>
<span id="cb2049-4"><a href="#cb2049-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## Rows: 9 Columns: 4</code></pre>
<pre><code>## -- Column specification ---------------------------------------------------
## Delimiter: &quot;;&quot;
## chr (2): Setor, Gasto em P&amp;D
## dbl (1): Receita</code></pre>
<pre><code>## 
## i Use `spec()` to retrieve the full column specification for this data.
## i Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<pre><code>## # A tibble: 9 x 4
##   Setor                    Produção Receita `Gasto em P&amp;D`
##   &lt;chr&gt;                       &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;         
## 1 Produtos alimentícios     10828.  199908. 3358,36       
## 2 Bebidas                     760.   28093. x             
## 3 Produtos do fumo             70.0   8864. 121,35        
## 4 Produtos têxteis           4154.   25804. 746,83        
## 5 Produtos de madeira        5089.   15321. 279,54        
## 6 Celulose e outras pastas     27.0   4245. 216,7         
## 7 Refino de petróleo           75.5 114316. 1550,73       
## 8 Produtos químicos          3180.  133583. 2914,09       
## 9 Produtos farmacêuticos      622.   24972. 1038,73</code></pre>
<p>Tal erro, ocorre pelo simples fato de que a segunda linha dessa coluna é preenchida por um “x.” Ao encontrar esse “x,” a função <code>read_delim()</code> opta pelo tipo de dado mais flexível possível (o tipo <code>character</code>). Dessa maneira, precisamos apenas afirmar à função <code>read_delim()</code>, que essa coluna deve ser interpretada por um tipo numérico, como o tipo <code>double</code>.</p>
<div class="sourceCode" id="cb2054"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2054-1"><a href="#cb2054-1" aria-hidden="true" tabindex="-1"></a>readr<span class="sc">::</span><span class="fu">read_delim</span>(</span>
<span id="cb2054-2"><a href="#cb2054-2" aria-hidden="true" tabindex="-1"></a>  pac2, <span class="at">delim =</span> <span class="st">&quot;;&quot;</span>,</span>
<span id="cb2054-3"><a href="#cb2054-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">locale =</span> <span class="fu">locale</span>(<span class="at">grouping_mark =</span> <span class="st">&quot;.&quot;</span>, <span class="at">decimal_mark =</span> <span class="st">&quot;,&quot;</span>),</span>
<span id="cb2054-4"><a href="#cb2054-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">col_types =</span> <span class="fu">cols</span>(</span>
<span id="cb2054-5"><a href="#cb2054-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">.default =</span> <span class="fu">col_number</span>(), <span class="at">Setor =</span> <span class="fu">col_character</span>()</span>
<span id="cb2054-6"><a href="#cb2054-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb2054-7"><a href="#cb2054-7" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## Warning: One or more parsing issues, see `problems()` for details</code></pre>
<pre><code>## # A tibble: 9 x 4
##   Setor                    Produção Receita `Gasto em P&amp;D`
##   &lt;chr&gt;                       &lt;dbl&gt;   &lt;dbl&gt;          &lt;dbl&gt;
## 1 Produtos alimentícios     10828.  199908.          3358.
## 2 Bebidas                     760.   28093.            NA 
## 3 Produtos do fumo             70.0   8864.           121.
## 4 Produtos têxteis           4154.   25804.           747.
## 5 Produtos de madeira        5089.   15321.           280.
## 6 Celulose e outras pastas     27.0   4245.           217.
## 7 Refino de petróleo           75.5 114316.          1551.
## 8 Produtos químicos          3180.  133583.          2914.
## 9 Produtos farmacêuticos      622.   24972.          1039.</code></pre>
<p><strong>3.1.C)</strong> Quando erros desse tipo ocorrem, é interessante que você olhe para dentro do arquivo, ou seja, abra as primeiras milhares de linhas do arquivo, e tente identificar algum fator que possa estar causando este erro. Como o arquivo <code>challenge.csv</code> é relativamente pequeno, você pode abrí-lo em uma janela de seu RStudio por meio dos comandos abaixo:</p>
<div class="sourceCode" id="cb2057"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2057-1"><a href="#cb2057-1" aria-hidden="true" tabindex="-1"></a><span class="fu">file.edit</span>(<span class="fu">readr_example</span>(<span class="st">&quot;challenge.csv&quot;</span>))</span></code></pre></div>
<p>Ao navegar em direção ao final do arquivo, você vai perceber que os dados mudam drasticamente de formato a partir da linha 1001 do arquivo (veja abaixo, um retrato dessa porção do arquivo).</p>
<pre class="text"><code>998   1843,NA
999   1687,NA
1000  4569,NA
1001  4548,NA
1002  0.23837975086644292,2015-01-16
1003  0.41167997173033655,2018-05-18
1004  0.7460716762579978,2015-09-05
1005  0.723450553836301,2012-11-28
1006  0.614524137461558,2020-01-13</code></pre>
<p>Logo, podemos inferir que o problema gerado na importação, se trata novamente de um chute errado da função <code>read_csv()</code>. Pois a função interpretou que as duas colunas do arquivo, pertencem aos tipos <code>double</code> e <code>logical</code>, respectivamente, sendo que a segunda coluna é, de forma clara, do tipo <code>Date</code>, ao observarmos a sua porção à frente da linha 1001.</p>
<p>Lembre-se que, as funções do pacote <code>readr</code> vão, por definição, utilizar as 1000 primeiras linhas do arquivo para advinhar o tipo de dado contido em cada coluna do arquivo. Devido ao fato de que a mudança drástica nos dados armazenados em <code>challenge.csv</code>, ocorre após essas 1000 primeiras linhas, a função <code>read_csv()</code> acaba não percebendo o seu erro. Por esses motivos, precisamos sobrepor essa decisão, ao definirmos explicitamente os tipos desejados para cada coluna no argumento <code>col_types</code>.</p>
<div class="sourceCode" id="cb2059"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2059-1"><a href="#cb2059-1" aria-hidden="true" tabindex="-1"></a><span class="fu">read_csv</span>(</span>
<span id="cb2059-2"><a href="#cb2059-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">readr_example</span>(<span class="st">&quot;challenge.csv&quot;</span>),</span>
<span id="cb2059-3"><a href="#cb2059-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">col_types =</span> <span class="fu">cols</span>(</span>
<span id="cb2059-4"><a href="#cb2059-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">col_double</span>(),</span>
<span id="cb2059-5"><a href="#cb2059-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="fu">col_date</span>()</span>
<span id="cb2059-6"><a href="#cb2059-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb2059-7"><a href="#cb2059-7" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## # A tibble: 2,000 x 2
##        x y     
##    &lt;dbl&gt; &lt;date&gt;
##  1   404 NA    
##  2  4172 NA    
##  3  3004 NA    
##  4   787 NA    
##  5    37 NA    
##  6  2332 NA    
##  7  2489 NA    
##  8  1449 NA    
##  9  3665 NA    
## 10  3863 NA    
## # ... with 1,990 more rows</code></pre>
<p><strong>3.1.D)</strong> Novamente, sempre comece identificando o caractere especial que está separando cada coluna nesse arquivo. No caso do objeto <code>t</code>, esse caractere especial é o asterisco (<code>*</code>). Com isso, podemos utilizar o argumento <code>delim</code>, da função <code>read_delim()</code> para termos uma primeira leitura do arquivo, como demonstrado abaixo:</p>
<div class="sourceCode" id="cb2061"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2061-1"><a href="#cb2061-1" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> <span class="st">&quot;Data_execução*Unidades*Valor_compra</span></span>
<span id="cb2061-2"><a href="#cb2061-2" aria-hidden="true" tabindex="-1"></a><span class="st">20/01/2020*21*R$ 3049,50</span></span>
<span id="cb2061-3"><a href="#cb2061-3" aria-hidden="true" tabindex="-1"></a><span class="st">23/01/2020*502*R$ 1289,03</span></span>
<span id="cb2061-4"><a href="#cb2061-4" aria-hidden="true" tabindex="-1"></a><span class="st">25/01/2020*90*R$ 678,00</span></span>
<span id="cb2061-5"><a href="#cb2061-5" aria-hidden="true" tabindex="-1"></a><span class="st">02/02/2020*123*R$ 5401</span></span>
<span id="cb2061-6"><a href="#cb2061-6" aria-hidden="true" tabindex="-1"></a><span class="st">05/02/2020*45*R$ 1450,10</span></span>
<span id="cb2061-7"><a href="#cb2061-7" aria-hidden="true" tabindex="-1"></a><span class="st">07/02/2020*67*R$ 2320,97</span></span>
<span id="cb2061-8"><a href="#cb2061-8" aria-hidden="true" tabindex="-1"></a><span class="st">09/02/2020*187*R$ 6231,76&quot;</span></span>
<span id="cb2061-9"><a href="#cb2061-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2061-10"><a href="#cb2061-10" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> <span class="fu">iconv</span>(t, <span class="at">from =</span> <span class="st">&quot;Latin1&quot;</span>, <span class="at">to =</span> <span class="st">&quot;UTF-8&quot;</span>)</span>
<span id="cb2061-11"><a href="#cb2061-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2061-12"><a href="#cb2061-12" aria-hidden="true" tabindex="-1"></a>readr<span class="sc">::</span><span class="fu">read_delim</span>(t, <span class="at">delim =</span> <span class="st">&quot;*&quot;</span>)</span></code></pre></div>
<pre><code>## Rows: 7 Columns: 3</code></pre>
<pre><code>## -- Column specification ---------------------------------------------------
## Delimiter: &quot;*&quot;
## chr (2): Data_execução, Valor_compra
## dbl (1): Unidades</code></pre>
<pre><code>## 
## i Use `spec()` to retrieve the full column specification for this data.
## i Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<pre><code>## # A tibble: 7 x 3
##   Data_execução Unidades Valor_compra
##   &lt;chr&gt;            &lt;dbl&gt; &lt;chr&gt;       
## 1 20/01/2020          21 R$ 3049,50  
## 2 23/01/2020         502 R$ 1289,03  
## 3 25/01/2020          90 R$ 678,00   
## 4 02/02/2020         123 R$ 5401     
## 5 05/02/2020          45 R$ 1450,10  
## 6 07/02/2020          67 R$ 2320,97  
## 7 09/02/2020         187 R$ 6231,76</code></pre>
<p>Ainda assim, há alguns pontos que precisamos melhorar. Primeiro, a coluna <code>Valor_compra</code> está sendo atualmente interpretada pelo tipo <code>character</code>, sendo que ela claramente guarda valores numéricos, isto é, valores do tipo <code>double</code>. O mesmo ocorre com a coluna <code>Data_execução</code>, que armazena datas específicas, as quais poderiam ser melhor interpretadas pelo tipo <code>Date</code>.</p>
<p>Por isso, precisamos definir explicitamente os tipos dessas colunas à função <code>read_delim()</code>, como demonstrado abaixo. Repare que utilizamos <code>col_number()</code> sobre a coluna <code>Valor_compra</code>, e não, <code>col_double()</code>. Pois <code>col_double()</code> não seria capaz de ler corretamente essa coluna, dado que os valores numéricos estão acompanhados de informações textuais (<code>R$</code>), as quais <code>col_double()</code> não é capaz de compreender. Já <code>col_number()</code>, busca extrair qualquer valor numérico presente em um <em>string</em> e, por isso, acaba ignorando por padrão todas as informações não-numéricas presentes neste mesmo <em>string</em>. Após extrair o valor numérico, <code>col_number()</code> ainda vai analisar esse valor, e decidir se ele deve ser convertido para o tipo <code>integer</code>, ou para o tipo <code>double</code>, o que nos dá bastante flexibilidade, e economiza certo trabalho de nossa parte.</p>
<div class="sourceCode" id="cb2066"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2066-1"><a href="#cb2066-1" aria-hidden="true" tabindex="-1"></a><span class="fu">read_delim</span>(</span>
<span id="cb2066-2"><a href="#cb2066-2" aria-hidden="true" tabindex="-1"></a>  t, <span class="at">delim =</span> <span class="st">&quot;*&quot;</span>,</span>
<span id="cb2066-3"><a href="#cb2066-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">col_types =</span> <span class="fu">cols</span>(</span>
<span id="cb2066-4"><a href="#cb2066-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">col_date</span>(<span class="at">format =</span> <span class="st">&quot;%d/%m/%Y&quot;</span>),</span>
<span id="cb2066-5"><a href="#cb2066-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">col_integer</span>(),</span>
<span id="cb2066-6"><a href="#cb2066-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">col_number</span>()</span>
<span id="cb2066-7"><a href="#cb2066-7" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb2066-8"><a href="#cb2066-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">locale =</span> <span class="fu">locale</span>(</span>
<span id="cb2066-9"><a href="#cb2066-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">decimal_mark =</span> <span class="st">&quot;,&quot;</span>, <span class="at">grouping_mark =</span> <span class="st">&quot;.&quot;</span></span>
<span id="cb2066-10"><a href="#cb2066-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb2066-11"><a href="#cb2066-11" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## # A tibble: 7 x 3
##   Data_execução Unidades Valor_compra
##   &lt;date&gt;           &lt;int&gt;        &lt;dbl&gt;
## 1 2020-01-20          21        3050.
## 2 2020-01-23         502        1289.
## 3 2020-01-25          90         678 
## 4 2020-02-02         123        5401 
## 5 2020-02-05          45        1450.
## 6 2020-02-07          67        2321.
## 7 2020-02-09         187        6232.</code></pre>
<center>
<em>Exercício 2</em>
</center>
<p><strong>3.2)</strong> Primeiro, falando especificamente de planilhas do Excel, a mescla de células é uma ferramenta que pode deixar a sua planilha esteticamente atraente. Porém, tal ferramenta gera sérias anomalias na estrutura de sua tabela. Pois duas células que foram mescladas, são apresentadas a você como uma única célula. Mas no fundo, o Excel armazena os valores presente nessa célula de uma maneira não uniforme (ou em uma estrutura não retangular) ao longo de sua tabela.</p>
<p>No caso do arquivo <code>emater_icms_solidario.xlsx</code>, as células mescladas se encontram no cabeçalho da tabela. Com isso, essas células mescladas nos impedem de importar diretamente da planilha, os nomes de cada coluna da tabela. Por isso, é mais fácil simplesmente ignorarmos o fato de que cada coluna possui um nome, e tentarmos selecionar apenas a parte da planilha que contém os dados em si, de forma crua. Por essa estratégia, podemos fornecer corretamente os nomes de cada coluna de forma separada, através do argumento <code>col_names</code>.</p>
<div class="sourceCode" id="cb2068"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2068-1"><a href="#cb2068-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Nomes de cada coluna</span></span>
<span id="cb2068-2"><a href="#cb2068-2" aria-hidden="true" tabindex="-1"></a>nomes <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb2068-3"><a href="#cb2068-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Semestre&quot;</span>, <span class="st">&quot;Ano&quot;</span>, <span class="st">&quot;Municipio&quot;</span>, <span class="st">&quot;Cod_IBGE&quot;</span>,</span>
<span id="cb2068-4"><a href="#cb2068-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Area_2017&quot;</span>, <span class="st">&quot;Area_2018&quot;</span>, <span class="st">&quot;Area_Media&quot;</span>,</span>
<span id="cb2068-5"><a href="#cb2068-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Pastagens_2006&quot;</span>, <span class="st">&quot;Area_Total&quot;</span>, <span class="st">&quot;N_pequeno_prod&quot;</span>,</span>
<span id="cb2068-6"><a href="#cb2068-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Extensao_Rural&quot;</span>, <span class="st">&quot;PM_Fundo_Rotativo&quot;</span>, <span class="st">&quot;PM_Mecanizacao_Agr&quot;</span>,</span>
<span id="cb2068-7"><a href="#cb2068-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;PM_Sementes_Mudas&quot;</span>, <span class="st">&quot;PM_Calcario_Fertilizante&quot;</span>,</span>
<span id="cb2068-8"><a href="#cb2068-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;PM_Apoio_Comercializacao&quot;</span></span>
<span id="cb2068-9"><a href="#cb2068-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2068-10"><a href="#cb2068-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2068-11"><a href="#cb2068-11" aria-hidden="true" tabindex="-1"></a><span class="do">### Lembre-se que o caminho até o arquivo</span></span>
<span id="cb2068-12"><a href="#cb2068-12" aria-hidden="true" tabindex="-1"></a><span class="do">### será diferente em sua máquina.</span></span>
<span id="cb2068-13"><a href="#cb2068-13" aria-hidden="true" tabindex="-1"></a><span class="do">### Pois muito provavelmente você não possui um</span></span>
<span id="cb2068-14"><a href="#cb2068-14" aria-hidden="true" tabindex="-1"></a><span class="do">### um usuário chamado Pedro.</span></span>
<span id="cb2068-15"><a href="#cb2068-15" aria-hidden="true" tabindex="-1"></a>readxl<span class="sc">::</span><span class="fu">read_excel</span>(</span>
<span id="cb2068-16"><a href="#cb2068-16" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;C:/Users/Pedro/Downloads/emater_icms_solidario.xlsx&quot;</span>,</span>
<span id="cb2068-17"><a href="#cb2068-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">range =</span> <span class="st">&quot;A6:P858&quot;</span>, </span>
<span id="cb2068-18"><a href="#cb2068-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">col_names =</span> nomes</span>
<span id="cb2068-19"><a href="#cb2068-19" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## # A tibble: 853 x 16
##    Semestre      Ano Municipio         Cod_IBGE Area_2017 Area_2018 Area_Media
##    &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;             &lt;chr&gt;        &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;
##  1 1° semestre  2020 Abadia dos Doura~ 3100104      5192.     3612.      4402.
##  2 1° semestre  2020 Abaeté            3100203      4800      2042       3421 
##  3 1° semestre  2020 Abre Campo        3100302      7116      4744       5930
##  4 1° semestre  2020 Acaiaca           3100401       104.      109.       107.
##  5 1° semestre  2020 Açucena           3100500     12525     12028.     12277.
##  6 1° semestre  2020 Água Boa          3100609      5185      4860.      5022.
##  7 1° semestre  2020 Água Comprida     3100708     36750     47020      41885 
##  8 1° semestre  2020 Aguanil           3100807      4492.     4728.      4610.
##  9 1° semestre  2020 Águas Formosas    3100906       893       904        898.
## 10 1° semestre  2020 Águas Vermelhas   3101003      3242      3487       3364.
## # ... with 843 more rows, and 8 more variables: Pastagens_2006 &lt;dbl&gt;, 
## #   Area_Total &lt;dbl&gt;, N_pequeno_prod &lt;dbl&gt;, Extensao_Rural &lt;dbl&gt;, 
## #   PM_Fundo_Rotativo &lt;dbl&gt;, PM_Mecanizacao_Agr &lt;dbl&gt;, PM_Sementes_Mudas &lt;dbl&gt;, 
## #   PM_Calcario_Fertilizante &lt;dbl&gt;, PM_Apoio_Comercializacao &lt;dbl&gt;</code></pre>
</div>
</div>
<div id="referências-2" class="section level1 unnumbered">
<h1 class="unnumbered">Referências</h1>
<div id="capítulo-4---transformando-dados-com-dplyr" class="section level2 unlisted unnumbered">
<h2 class="unlisted unnumbered">Capítulo 4 - Transformando dados com <code>dplyr</code></h2>
<center>
<em>Exercício 1</em>
</center>
<p><strong>4.1.A)</strong> Em resumo, os comandos abaixo calculam o número de linhas que descrevem um personagem masculino que possui olhos vermelhos. Primeiro, <code>count()</code> calcula o número de linhas por sexo e por cada coloração do olho. Em seguida, a função <code>filter()</code> seleciona apenas as linhas que dizem respeito a personagens masculinos e que possuem olhos vermelhos.</p>
<div class="sourceCode" id="cb2070"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2070-1"><a href="#cb2070-1" aria-hidden="true" tabindex="-1"></a>starwars <span class="sc">%&gt;%</span> </span>
<span id="cb2070-2"><a href="#cb2070-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(sex, eye_color) <span class="sc">%&gt;%</span> </span>
<span id="cb2070-3"><a href="#cb2070-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(sex <span class="sc">==</span> <span class="st">&quot;male&quot;</span>, eye_color <span class="sc">==</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 3
##   sex   eye_color     n
##   &lt;chr&gt; &lt;chr&gt;     &lt;int&gt;
## 1 male  red           2</code></pre>
<p><strong>4.1.B)</strong> Em resumo, os comandos abaixo calculam o peso médio de cada sexo descrito na tabela <code>starwars</code>. Primeiro, a função <code>select()</code> vai selecionar todas as colunas da tabela <code>starwars</code>, <strong>exceto as colunas contidas no vetor <code>vec</code></strong>. Segundo, <code>group_by()</code> vai agrupar a base de acordo com os valores dispostos na coluna <code>sex</code>. Terceiro, <code>summarise()</code> vai tratar de calcular o peso médio dentro de cada grupo da coluna <code>sex</code>. Em outras palavras, <code>summarise()</code> vai separar as linhas da tabela de acordo com os grupos da coluna <code>sex</code> e, em seguida, vai aplicar a função <code>mean()</code> sobre a coluna <code>mass</code> de cada um desses grupos.</p>
<div class="sourceCode" id="cb2072"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2072-1"><a href="#cb2072-1" aria-hidden="true" tabindex="-1"></a>vec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;species&quot;</span>, <span class="st">&quot;homeworld&quot;</span>, <span class="st">&quot;films&quot;</span>, <span class="st">&quot;vehicles&quot;</span>, <span class="st">&quot;starships&quot;</span>)</span>
<span id="cb2072-2"><a href="#cb2072-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2072-3"><a href="#cb2072-3" aria-hidden="true" tabindex="-1"></a>starwars <span class="sc">%&gt;%</span> </span>
<span id="cb2072-4"><a href="#cb2072-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">all_of</span>(vec)) <span class="sc">%&gt;%</span> </span>
<span id="cb2072-5"><a href="#cb2072-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(sex) <span class="sc">%&gt;%</span> </span>
<span id="cb2072-6"><a href="#cb2072-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">peso_medio =</span> <span class="fu">mean</span>(mass, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
<pre><code>## # A tibble: 5 x 2
##   sex            peso_medio
##   &lt;chr&gt;               &lt;dbl&gt;
## 1 female               54.7
## 2 hermaphroditic     1358  
## 3 male                 81.0
## 4 none                 69.8
## 5 &lt;NA&gt;                 48</code></pre>
<p><strong>4.1.C)</strong> O código abaixo aplica os seguintes passos sobre a tabela <code>mpg</code>: primeiro, <code>mutate()</code> adiciona uma coluna chamada <code>pais_origem</code>, onde cada modelo de carro descrito na tabela é categorizado de acoro com o país de origem do fabricante deste modelo; em seguida, <code>count()</code> contabiliza a quantidade de modelos que pertencem a cada país; por último, um novo <code>mutate()</code> é aplicado com o objetivo de calcular a proporção de cada país em relação ao total de modelos descritos na tabela.</p>
<div class="sourceCode" id="cb2074"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2074-1"><a href="#cb2074-1" aria-hidden="true" tabindex="-1"></a>mpg <span class="sc">%&gt;%</span> </span>
<span id="cb2074-2"><a href="#cb2074-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb2074-3"><a href="#cb2074-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">pais_origem =</span> <span class="fu">case_when</span>(</span>
<span id="cb2074-4"><a href="#cb2074-4" aria-hidden="true" tabindex="-1"></a>      manufacturer <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;audi&quot;</span>, <span class="st">&quot;volkswagen&quot;</span>) <span class="sc">~</span> <span class="st">&quot;Alemanha&quot;</span>,</span>
<span id="cb2074-5"><a href="#cb2074-5" aria-hidden="true" tabindex="-1"></a>      manufacturer <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;nissan&quot;</span>, <span class="st">&quot;honda&quot;</span>,</span>
<span id="cb2074-6"><a href="#cb2074-6" aria-hidden="true" tabindex="-1"></a>                          <span class="st">&quot;subaru&quot;</span>, <span class="st">&quot;toyota&quot;</span>) <span class="sc">~</span> <span class="st">&quot;Japão&quot;</span>,</span>
<span id="cb2074-7"><a href="#cb2074-7" aria-hidden="true" tabindex="-1"></a>      manufacturer <span class="sc">==</span> <span class="st">&quot;hyundai&quot;</span> <span class="sc">~</span> <span class="st">&quot;Coréia do Sul&quot;</span>,</span>
<span id="cb2074-8"><a href="#cb2074-8" aria-hidden="true" tabindex="-1"></a>      manufacturer <span class="sc">==</span> <span class="st">&quot;land rover&quot;</span> <span class="sc">~</span> <span class="st">&quot;Inglaterra&quot;</span>,</span>
<span id="cb2074-9"><a href="#cb2074-9" aria-hidden="true" tabindex="-1"></a>      manufacturer <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;dodge&quot;</span>, <span class="st">&quot;jeep&quot;</span>, </span>
<span id="cb2074-10"><a href="#cb2074-10" aria-hidden="true" tabindex="-1"></a>                          <span class="st">&quot;chevrolet&quot;</span>, <span class="st">&quot;ford&quot;</span>,</span>
<span id="cb2074-11"><a href="#cb2074-11" aria-hidden="true" tabindex="-1"></a>                          <span class="st">&quot;lincoln&quot;</span>, <span class="st">&quot;pontiac&quot;</span>,</span>
<span id="cb2074-12"><a href="#cb2074-12" aria-hidden="true" tabindex="-1"></a>                          <span class="st">&quot;mercury&quot;</span>) <span class="sc">~</span> <span class="st">&quot;EUA&quot;</span></span>
<span id="cb2074-13"><a href="#cb2074-13" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb2074-14"><a href="#cb2074-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb2074-15"><a href="#cb2074-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(pais_origem) <span class="sc">%&gt;%</span> </span>
<span id="cb2074-16"><a href="#cb2074-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb2074-17"><a href="#cb2074-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">prop =</span> ( n <span class="sc">*</span> <span class="dv">100</span> ) <span class="sc">/</span> <span class="fu">sum</span>(n)</span>
<span id="cb2074-18"><a href="#cb2074-18" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 5 x 3
##   pais_origem       n  prop
##   &lt;chr&gt;         &lt;int&gt; &lt;dbl&gt;
## 1 Alemanha         45 19.2 
## 2 Coréia do Sul    14  5.98
## 3 EUA             101 43.2 
## 4 Inglaterra        4  1.71
## 5 Japão            70 29.9</code></pre>
<center>
<em>Exercício 2</em>
</center>
<p><strong>4.2.A)</strong> Primeiro, identifique as principais colunas que são de seu interesse para responder a pergunta estipulada na questão. Para responder a pergunta, precisamos medir em quanto os preços cobrados por cada universidade aumentou e, para isso, não precisaremos das colunas <code>net_cost</code>, <code>income_lvl</code> e <code>campus</code>. Por isso, podemos rapidamente eliminar essas colunas com um <code>select()</code>.</p>
<div class="sourceCode" id="cb2076"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2076-1"><a href="#cb2076-1" aria-hidden="true" tabindex="-1"></a>custos <span class="ot">&lt;-</span> dados <span class="sc">%&gt;%</span></span>
<span id="cb2076-2"><a href="#cb2076-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>net_cost, <span class="sc">-</span>income_lvl, <span class="sc">-</span>campus)</span>
<span id="cb2076-3"><a href="#cb2076-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2076-4"><a href="#cb2076-4" aria-hidden="true" tabindex="-1"></a>custos</span></code></pre></div>
<pre><code>## # A tibble: 209,012 x 4
##    name                              state total_price  year
##    &lt;chr&gt;                             &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt;
##  1 Piedmont International University NC          20174  2016
##  2 Piedmont International University NC          20174  2016
##  3 Piedmont International University NC          20174  2016
##  4 Piedmont International University NC          20174  2016
##  5 Piedmont International University NC          20514  2017
##  6 Piedmont International University NC          20514  2017
##  7 Piedmont International University NC          20514  2017
##  8 Piedmont International University NC          20514  2017
##  9 Piedmont International University NC          20514  2017
## 10 Piedmont International University NC          20829  2018
## # ... with 209,002 more rows</code></pre>
<p>Agora, temos um problema importante a ser analisado: é possível que haja observações repetidas? Ou, será que há várias linhas descrevendo uma mesma universidade em um mesmo ano? As primeiras linhas da tabela acima já nos mostram que sim, há repetição de observações ao longo da base. Para corrigir essa repetição podemos aplicar a função <code>distinct()</code> sobre a base.</p>
<div class="sourceCode" id="cb2078"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2078-1"><a href="#cb2078-1" aria-hidden="true" tabindex="-1"></a>custos <span class="ot">&lt;-</span> custos <span class="sc">%&gt;%</span> </span>
<span id="cb2078-2"><a href="#cb2078-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span>
<span id="cb2078-3"><a href="#cb2078-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2078-4"><a href="#cb2078-4" aria-hidden="true" tabindex="-1"></a>custos</span></code></pre></div>
<pre><code>## # A tibble: 40,991 x 4
##    name                              state total_price  year
##    &lt;chr&gt;                             &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt;
##  1 Piedmont International University NC          20174  2016
##  2 Piedmont International University NC          20514  2017
##  3 Piedmont International University NC          20829  2018
##  4 Piedmont International University NC          23000  2016
##  5 Piedmont International University NC          26430  2017
##  6 Piedmont International University NC          26870  2018
##  7 Kaplan University-Milwaukee       WI          22413  2017
##  8 Kaplan University-Milwaukee       WI          22492  2018
##  9 Kaplan University-Indianapolis    IN          22413  2017
## 10 Kaplan University-Indianapolis    IN          22492  2018
## # ... with 40,981 more rows</code></pre>
<p>Lembre-se que, mesmo após aplicarmos <code>distinct()</code> sobre a base, pode haver dois <code>total_price</code>’s para uma mesma universidade em um mesmo ano. Ou seja, <code>distinct()</code> tratou de eliminar observações repetidas da tabela, isto é, observações que possuem exatamente os mesmos valores em todas as colunas. Sendo assim, podem existir na tabela, dois (ou mais) valores que se referem a uma mesma universidade e a um mesmo ano, mas que possuem valores diferentes na coluna <code>total_price</code>. O resultado dos comandos abaixo confirmam essa suspeita:</p>
<div class="sourceCode" id="cb2080"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2080-1"><a href="#cb2080-1" aria-hidden="true" tabindex="-1"></a>custos <span class="sc">%&gt;%</span> </span>
<span id="cb2080-2"><a href="#cb2080-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(name, year) <span class="sc">%&gt;%</span> </span>
<span id="cb2080-3"><a href="#cb2080-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(total_price) <span class="sc">%&gt;%</span> </span>
<span id="cb2080-4"><a href="#cb2080-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## # A tibble: 14 x 4
## # Groups:   name, year [14]
##    name                                  year total_price     n
##    &lt;chr&gt;                                &lt;dbl&gt;       &lt;dbl&gt; &lt;int&gt;
##  1 Academy of Interactive Entertainment  2015       30876     2
##  2 Bryan University                      2010       32572     2
##  3 Bryan University                      2011       40821     2
##  4 Bryan University                      2013       24449     2
##  5 Bryan University                      2014       25446     2
##  6 Bryan University                      2016       25595     2
##  7 Bryan University                      2017       25595     2
##  8 Stevens-Henager College               2011       28414     2
##  9 Stevens-Henager College               2012       29539     2
## 10 Stevens-Henager College               2014       32312     2
## 11 Stevens-Henager College               2015       32440     2
## 12 Stevens-Henager College               2016       33960     2
## 13 Stevens-Henager College               2017       33960     2
## 14 Stevens-Henager College               2018       33489     2</code></pre>
<p>São poucas as universidades que possuem mais de um preço para um mesmo ano. Contudo, precisamos que cada ano de cada universidade possua um único preço. Logo, temos que encontrar um método que combine esses dois valores em um só. Calcular a média desses dois valores é uma solução razoável. Repare abaixo, que aplicamos um <code>group_by()</code> sobre <code>custos</code>, antes do <code>summarise()</code>, pois desejamos aplicar a média sobre <code>total_price</code>, dentro de cada ano (<code>year</code>) de cada universidade (<code>name</code>):</p>
<div class="sourceCode" id="cb2082"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2082-1"><a href="#cb2082-1" aria-hidden="true" tabindex="-1"></a>custos <span class="ot">&lt;-</span> custos <span class="sc">%&gt;%</span> </span>
<span id="cb2082-2"><a href="#cb2082-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(name, year) <span class="sc">%&gt;%</span> </span>
<span id="cb2082-3"><a href="#cb2082-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_price =</span> <span class="fu">mean</span>(total_price))</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;name&#39;. You can override using the `.groups` argument.</code></pre>
<div class="sourceCode" id="cb2084"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2084-1"><a href="#cb2084-1" aria-hidden="true" tabindex="-1"></a>custos</span></code></pre></div>
<pre><code>## # A tibble: 30,066 x 3
## # Groups:   name [3,664]
##    name                          year mean_price
##    &lt;chr&gt;                        &lt;dbl&gt;      &lt;dbl&gt;
##  1 Aaniiih Nakoda College        2010      17030
##  2 Aaniiih Nakoda College        2011      17030
##  3 Aaniiih Nakoda College        2012      17030
##  4 Aaniiih Nakoda College        2013      17030
##  5 Aaniiih Nakoda College        2014      17030
##  6 Aaniiih Nakoda College        2015      17030
##  7 Aaniiih Nakoda College        2016      17030
##  8 Aaniiih Nakoda College        2017      17030
##  9 Aaniiih Nakoda College        2018      17030
## 10 Abilene Christian University  2011      38250
## # ... with 30,056 more rows</code></pre>
<p>Resolvido esse problema, podemos nos preocupar em calcular a variação anual do preço de cada universidade. As funções <code>lead()</code> e <code>lag()</code> são muito úteis para compararmos o valor de um determinado ano ao seu par do ano anterior. Porém, para que <code>lag()</code> capture corretamente o valor do ano anterior, é fundamental que esses anos estejam organizados dentro de cada universidade, em uma ordem crescente, ao longo de toda a base. Por esse motivo, um <code>arrange()</code> é aplicado sobre a base antes do <code>mutate()</code>.</p>
<div class="sourceCode" id="cb2086"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2086-1"><a href="#cb2086-1" aria-hidden="true" tabindex="-1"></a>custos <span class="ot">&lt;-</span> custos <span class="sc">%&gt;%</span> </span>
<span id="cb2086-2"><a href="#cb2086-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(name, year) <span class="sc">%&gt;%</span> </span>
<span id="cb2086-3"><a href="#cb2086-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb2086-4"><a href="#cb2086-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">var_price =</span> mean_price <span class="sc">-</span> <span class="fu">lag</span>(mean_price)</span>
<span id="cb2086-5"><a href="#cb2086-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb2086-6"><a href="#cb2086-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb2086-7"><a href="#cb2086-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2086-8"><a href="#cb2086-8" aria-hidden="true" tabindex="-1"></a>custos</span></code></pre></div>
<pre><code>## # A tibble: 30,066 x 4
##    name                          year mean_price var_price
##    &lt;chr&gt;                        &lt;dbl&gt;      &lt;dbl&gt;     &lt;dbl&gt;
##  1 Aaniiih Nakoda College        2010      17030        NA
##  2 Aaniiih Nakoda College        2011      17030         0
##  3 Aaniiih Nakoda College        2012      17030         0
##  4 Aaniiih Nakoda College        2013      17030         0
##  5 Aaniiih Nakoda College        2014      17030         0
##  6 Aaniiih Nakoda College        2015      17030         0
##  7 Aaniiih Nakoda College        2016      17030         0
##  8 Aaniiih Nakoda College        2017      17030         0
##  9 Aaniiih Nakoda College        2018      17030         0
## 10 Abilene Christian University  2011      38250        NA
## # ... with 30,056 more rows</code></pre>
<p>Com esses valores em mãos, podemos enfim responder à pergunta da questão. Basta reordenarmos a base de acordo com as maiores variações de preço (<code>var_price</code>) com <code>arrange()</code> e, em seguida, extraírmos as 10 primeiras linhas com <code>head()</code>. Com isso, temos que o custo anual do Los Medanos College subiu 95.944 dólares em 2012 (comparado ao valor do ano anterior).</p>
<div class="sourceCode" id="cb2088"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2088-1"><a href="#cb2088-1" aria-hidden="true" tabindex="-1"></a>custos <span class="sc">%&gt;%</span> </span>
<span id="cb2088-2"><a href="#cb2088-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(var_price)) <span class="sc">%&gt;%</span> </span>
<span id="cb2088-3"><a href="#cb2088-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="at">n =</span> <span class="dv">10</span>)</span></code></pre></div>
<pre><code>## # A tibble: 10 x 4
##    name                                           year mean_price var_price
##    &lt;chr&gt;                                         &lt;dbl&gt;      &lt;dbl&gt;     &lt;dbl&gt;
##  1 Los Medanos College                            2012    114083     95944 
##  2 Webb Institute                                 2013     61820     43300 
##  3 Jewish Theological Seminary of America         2016     75590     34140 
##  4 Santa Barbara Business College-Ventura         2018     57535     31207 
##  5 Rosedale Technical College                     2011     52240     21883 
##  6 Michigan Career and Technical Institute        2011     28462.    19388.
##  7 Hawaii Medical College                         2013     35918     18951 
##  8 St Paul&#39;s School of Nursing-Queens             2016     56189     18065 
##  9 Phillips School of Nursing at Mount Sinai Be~  2017     62850     17920 
## 10 Trinity International University-Florida       2017     30468     17718</code></pre>
<p><strong>4.2.B)</strong> Ao filtrarmos especificamente as observações do Los Medanos College, podemos identificar que a variação de mais de 94 mil dólares ocorre entre os valores $18.139 e $114.083. Perceba que os demais preços referentes a essa universidade se encontram entre 18 e 21 mil dólares. Logo, tal variação de mais 94 mil parece muito distoante para o padrão da universidade.</p>
<div class="sourceCode" id="cb2090"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2090-1"><a href="#cb2090-1" aria-hidden="true" tabindex="-1"></a>los_medanos <span class="ot">&lt;-</span> custos <span class="sc">%&gt;%</span> </span>
<span id="cb2090-2"><a href="#cb2090-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(name <span class="sc">==</span> <span class="st">&quot;Los Medanos College&quot;</span>, <span class="sc">!</span><span class="fu">is.na</span>(var_price)) </span>
<span id="cb2090-3"><a href="#cb2090-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2090-4"><a href="#cb2090-4" aria-hidden="true" tabindex="-1"></a>los_medanos</span></code></pre></div>
<pre><code>## # A tibble: 8 x 4
##   name                 year mean_price var_price
##   &lt;chr&gt;               &lt;dbl&gt;      &lt;dbl&gt;     &lt;dbl&gt;
## 1 Los Medanos College  2011      18139       427
## 2 Los Medanos College  2012     114083     95944
## 3 Los Medanos College  2013      19006    -95077
## 4 Los Medanos College  2014      18686      -320
## 5 Los Medanos College  2015      19200       514
## 6 Los Medanos College  2016      19750       550
## 7 Los Medanos College  2017      20700       950
## 8 Los Medanos College  2018      21260       560</code></pre>
<p>Expondo essa variação de maneira visual, temos:</p>
<div class="sourceCode" id="cb2092"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2092-1"><a href="#cb2092-1" aria-hidden="true" tabindex="-1"></a>nudge <span class="ot">&lt;-</span> <span class="fu">if_else</span>(los_medanos<span class="sc">$</span>var_price <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="dv">7000</span>, <span class="sc">-</span><span class="dv">7000</span>)</span>
<span id="cb2092-2"><a href="#cb2092-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2092-3"><a href="#cb2092-3" aria-hidden="true" tabindex="-1"></a>los_medanos <span class="sc">%&gt;%</span> </span>
<span id="cb2092-4"><a href="#cb2092-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(</span>
<span id="cb2092-5"><a href="#cb2092-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> var_price)</span>
<span id="cb2092-6"><a href="#cb2092-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb2092-7"><a href="#cb2092-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(</span>
<span id="cb2092-8"><a href="#cb2092-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">&quot;#0f5099&quot;</span></span>
<span id="cb2092-9"><a href="#cb2092-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb2092-10"><a href="#cb2092-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb2092-11"><a href="#cb2092-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">round</span>(var_price, <span class="dv">0</span>)),</span>
<span id="cb2092-12"><a href="#cb2092-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">nudge_y =</span> nudge</span>
<span id="cb2092-13"><a href="#cb2092-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb2092-14"><a href="#cb2092-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb2092-15"><a href="#cb2092-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="cf">function</span>(x){</span>
<span id="cb2092-16"><a href="#cb2092-16" aria-hidden="true" tabindex="-1"></a>      <span class="fu">format</span>(x, <span class="at">digits =</span> <span class="dv">0</span>, <span class="at">big.mark =</span> <span class="st">&quot;.&quot;</span>)</span>
<span id="cb2092-17"><a href="#cb2092-17" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2092-18"><a href="#cb2092-18" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb2092-19"><a href="#cb2092-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb2092-20"><a href="#cb2092-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Ano&quot;</span>,</span>
<span id="cb2092-21"><a href="#cb2092-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Variação de preço&quot;</span></span>
<span id="cb2092-22"><a href="#cb2092-22" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>Como definimos no enunciado, não temos uma resposta certa ou errada para a questão. O objetivo era apenas que você encontrasse esses dados e questionasse a sua validade. Qual o motivo para uma variação dessa magnitude é a principal questão aqui, e ela levanta altas suspeitas de que esse dado está incorreto, ou que foi alterado de alguma maneira durante o seu processo de coleta. Não sabemos exatamente o que ocorreu com esse dado, mas muito provavelmente há algo de errado com ele.</p>
<center>
<em>Exercício 3</em>
</center>
<p><strong>4.3.A)</strong> Primeiro, como vamos utilizar apenas da coluna 1 até a coluna 11, podemos selecionar essas colunas da tabela com um <code>select()</code>:</p>
<div class="sourceCode" id="cb2093"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2093-1"><a href="#cb2093-1" aria-hidden="true" tabindex="-1"></a>dados <span class="ot">&lt;-</span> starwars <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">11</span>)</span></code></pre></div>
<p>Em seguida, temos que descobrir o número de valores únicos presentes em cada coluna do tipo <code>character</code> de <code>dados</code>. Essas colunas são: <code>name</code>, <code>hair_color</code>, <code>skin_color</code>, <code>eye_color</code>, <code>sex</code>, <code>gender</code>, <code>homeworld</code> e <code>species</code>. Para esse cálculo, poderíamos aplicar as funções <code>length()</code> e <code>unique()</code> separadamente em cada uma dessas colunas, como mostrado abaixo:</p>
<div class="sourceCode" id="cb2094"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2094-1"><a href="#cb2094-1" aria-hidden="true" tabindex="-1"></a>name_n <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(dados<span class="sc">$</span>name))</span>
<span id="cb2094-2"><a href="#cb2094-2" aria-hidden="true" tabindex="-1"></a>hair_color_n <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(dados<span class="sc">$</span>hair_color))</span>
<span id="cb2094-3"><a href="#cb2094-3" aria-hidden="true" tabindex="-1"></a>skin_color_n <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(dados<span class="sc">$</span>skin_color))</span>
<span id="cb2094-4"><a href="#cb2094-4" aria-hidden="true" tabindex="-1"></a>    .</span>
<span id="cb2094-5"><a href="#cb2094-5" aria-hidden="true" tabindex="-1"></a>    .</span>
<span id="cb2094-6"><a href="#cb2094-6" aria-hidden="true" tabindex="-1"></a>    .</span>
<span id="cb2094-7"><a href="#cb2094-7" aria-hidden="true" tabindex="-1"></a>species_n <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(dados<span class="sc">$</span>species))</span></code></pre></div>
<p>Porém, uma forma muito mais eficiente de realizarmos esse mesmo cálculo, é com o uso da função <code>across()</code>, que lhe permite aplicar uma mesma função sobre várias colunas de seu <code>data.frame</code>. Detalhe que a função <code>n_distinct()</code> pertence ao pacote <code>dplyr</code>, sendo apenas uma função equivalente e mais rápida do que a operação <code>length(unique(x))</code>. Em outras palavras, as operações <code>n_distinct(x)</code> e <code>length(unique(x))</code> trazem o mesmo resultado.</p>
<div class="sourceCode" id="cb2095"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2095-1"><a href="#cb2095-1" aria-hidden="true" tabindex="-1"></a>colunas <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;name&quot;</span>, <span class="st">&quot;hair_color&quot;</span>, <span class="st">&quot;skin_color&quot;</span>, <span class="st">&quot;eye_color&quot;</span>,</span>
<span id="cb2095-2"><a href="#cb2095-2" aria-hidden="true" tabindex="-1"></a>             <span class="st">&quot;sex&quot;</span>, <span class="st">&quot;gender&quot;</span>, <span class="st">&quot;homeworld&quot;</span>, <span class="st">&quot;species&quot;</span>)</span>
<span id="cb2095-3"><a href="#cb2095-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2095-4"><a href="#cb2095-4" aria-hidden="true" tabindex="-1"></a>contagens <span class="ot">&lt;-</span> dados <span class="sc">%&gt;%</span> </span>
<span id="cb2095-5"><a href="#cb2095-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb2095-6"><a href="#cb2095-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">across</span>(<span class="fu">all_of</span>(colunas), n_distinct)</span>
<span id="cb2095-7"><a href="#cb2095-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb2095-8"><a href="#cb2095-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2095-9"><a href="#cb2095-9" aria-hidden="true" tabindex="-1"></a>contagens</span></code></pre></div>
<pre><code>## # A tibble: 1 x 8
##    name hair_color skin_color eye_color   sex gender homeworld species
##   &lt;int&gt;      &lt;int&gt;      &lt;int&gt;     &lt;int&gt; &lt;int&gt;  &lt;int&gt;     &lt;int&gt;   &lt;int&gt;
## 1    87         13         31        15     5      3        49      38</code></pre>
<p>Como resultado, temos um <code>data.frame</code> de uma única linha e várias colunas em <code>contagens</code>. Temos a capacidade de transformar esse <code>data.frame</code> em um vetor, através da função <code>unlist()</code>. Dessa maneira, para descobrirmos o maior número de valores únicos em cada coluna, podemos simplesmente aplicar a função <code>sort()</code> sobre o vetor resultante de <code>unlist()</code>. Repare abaixo, que as colunas <code>name</code> e <code>homeworld</code> são as colunas que contém mais valores únicos da coluna 1 até a coluna 11 da base, contendo 87 e 49 valores únicos respectivamente.</p>
<div class="sourceCode" id="cb2097"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2097-1"><a href="#cb2097-1" aria-hidden="true" tabindex="-1"></a>contagens <span class="sc">%&gt;%</span> </span>
<span id="cb2097-2"><a href="#cb2097-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unlist</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb2097-3"><a href="#cb2097-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sort</span>(<span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>##       name  homeworld    species skin_color  eye_color hair_color 
##         87         49         38         31         15         13 
##        sex     gender 
##          5          3</code></pre>
<center>
<em>Exercício 4</em>
</center>
<p><strong>4.4.A)</strong> Temos dois caminhos possíveis aqui, os quais se diferenciam apenas pelo posicionamento da função <code>filter()</code>. Em resumo, a questão pede por uma média que diz respeito apenas ao atendente Eduardo, logo, vamos precisar, em algum momento, de aplicar um <code>filter()</code> com o objetivo de pegar apenas as observações que dizem respeito ao Eduardo. Podemos: 1) filtrar a base inteira para pegar apenas as observações do Eduardo e, em seguida, calcular a média; ou, 2) agrupar a base por cada atendente, calcular a média de cada um e, em seguida, filtrar apenas a média de Eduardo. Ambas as opções chegam ao mesmo resultado de $3462 de receita média por parte de Eduardo.</p>
<div class="sourceCode" id="cb2099"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2099-1"><a href="#cb2099-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Opção 1:</span></span>
<span id="cb2099-2"><a href="#cb2099-2" aria-hidden="true" tabindex="-1"></a>transf <span class="sc">%&gt;%</span> </span>
<span id="cb2099-3"><a href="#cb2099-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Usuario <span class="sc">==</span> <span class="st">&quot;Eduardo&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2099-4"><a href="#cb2099-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">media =</span> <span class="fu">mean</span>(Valor))</span></code></pre></div>
<pre><code>## # A tibble: 1 x 1
##   media
##   &lt;dbl&gt;
## 1 3462.</code></pre>
<div class="sourceCode" id="cb2101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2101-1"><a href="#cb2101-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Opção 2:</span></span>
<span id="cb2101-2"><a href="#cb2101-2" aria-hidden="true" tabindex="-1"></a>transf <span class="sc">%&gt;%</span> </span>
<span id="cb2101-3"><a href="#cb2101-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Usuario) <span class="sc">%&gt;%</span> </span>
<span id="cb2101-4"><a href="#cb2101-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">media =</span> <span class="fu">mean</span>(Valor)) <span class="sc">%&gt;%</span> </span>
<span id="cb2101-5"><a href="#cb2101-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Usuario <span class="sc">==</span> <span class="st">&quot;Eduardo&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 2
##   Usuario media
##   &lt;chr&gt;   &lt;dbl&gt;
## 1 Eduardo 3462.</code></pre>
<p><strong>4.4.B)</strong> Como podemos observar abaixo, Ana tem maior costume de enviar transferências para o Equador, com um total de 302 transferências destinadas para esse país ao longo da base. Tal cálculo consiste em: 1) filtrar da base todas as linhas que dizem respeito à Ana; 2) contar o número de linhas que dizem respeito a cada país; 3) ordenar a tabela resultante de acordo com a contagem de cada país em ordem crescente; 4) com o resultado ordenado em ordem crescente, os países mais populares ficam nas últimas linhas do resultado, logo, basta extraírmos a última do linha do resultado que teremos o país de destino mais popular de todos.</p>
<div class="sourceCode" id="cb2103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2103-1"><a href="#cb2103-1" aria-hidden="true" tabindex="-1"></a>transf <span class="sc">%&gt;%</span> </span>
<span id="cb2103-2"><a href="#cb2103-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Usuario <span class="sc">==</span> <span class="st">&quot;Ana&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2103-3"><a href="#cb2103-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(Pais) <span class="sc">%&gt;%</span> </span>
<span id="cb2103-4"><a href="#cb2103-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(n) <span class="sc">%&gt;%</span> </span>
<span id="cb2103-5"><a href="#cb2103-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tail</span>(<span class="at">n =</span> <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 2
##   Pais        n
##   &lt;chr&gt;   &lt;int&gt;
## 1 Equador   302</code></pre>
<p><strong>4.4.C)</strong> O pacote <code>dplyr</code> nos oferece a função <code>last()</code>, que é capaz de extrair o último valor de um vetor específico. Perceba que eu ainda forneço a coluna <code>Data</code> no argumento <code>order_by</code>. Dessa forma, <code>last()</code> vai pegar o último valor de um vetor com base na ordem dos valores da coluna <code>Data</code>. Porém, como a função <code>last()</code> é capaz de extrair o último valor de um vetor, eu preciso utilizar a função <code>across()</code> para aplicar <code>last()</code> sobre cada uma das colunas da tabela.</p>
<div class="sourceCode" id="cb2105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2105-1"><a href="#cb2105-1" aria-hidden="true" tabindex="-1"></a>transf <span class="sc">%&gt;%</span> </span>
<span id="cb2105-2"><a href="#cb2105-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Usuario) <span class="sc">%&gt;%</span> </span>
<span id="cb2105-3"><a href="#cb2105-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="at">.fns =</span> last, <span class="at">order_by =</span> Data))</span></code></pre></div>
<pre><code>## # A tibble: 8 x 6
##   Usuario     Data                 Valor TransferID Pais     Descricao
##   &lt;chr&gt;       &lt;dttm&gt;               &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;    &lt;lgl&gt;    
## 1 Ana         2018-12-23 22:06:50 16169.  115756250 Alemanha NA       
## 2 Armando     2018-12-23 18:54:36 17630.  114268959 Alemanha NA       
## 3 Eduardo     2018-12-23 23:49:44 16983.  115188827 Alemanha NA       
## 4 Júlio       2018-12-23 13:29:04 15614.  114836120 Alemanha NA       
## 5 Júlio Cesar 2018-12-23 20:17:38 16601.  115054244 Alemanha NA       
## 6 nathalia    2018-12-23 17:48:23 15256.  115476749 Alemanha NA       
## 7 Nathália    2018-12-23 21:12:50 17621.  114970801 Alemanha NA       
## 8 Sandra      2018-12-23 17:59:44 16081.  114979909 Alemanha NA</code></pre>
<p>Uma outra alternativa é utilizar a função <code>slice_max()</code>, que precisa apenas de uma coluna no argumento <code>order_by</code>, que corresponde à coluna de referência, ou, a coluna pela qual a função vai determinar o último valor de cada atendente.</p>
<div class="sourceCode" id="cb2107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2107-1"><a href="#cb2107-1" aria-hidden="true" tabindex="-1"></a>transf <span class="sc">%&gt;%</span> </span>
<span id="cb2107-2"><a href="#cb2107-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Usuario) <span class="sc">%&gt;%</span> </span>
<span id="cb2107-3"><a href="#cb2107-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(<span class="at">order_by =</span> Data)</span></code></pre></div>
<pre><code>## # A tibble: 8 x 6
## # Groups:   Usuario [8]
##   Data                Usuario      Valor TransferID Pais     Descricao
##   &lt;dttm&gt;              &lt;chr&gt;        &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;    &lt;lgl&gt;    
## 1 2018-12-23 22:06:50 Ana         16169.  115756250 Alemanha NA       
## 2 2018-12-23 18:54:36 Armando     17630.  114268959 Alemanha NA       
## 3 2018-12-23 23:49:44 Eduardo     16983.  115188827 Alemanha NA       
## 4 2018-12-23 13:29:04 Júlio       15614.  114836120 Alemanha NA       
## 5 2018-12-23 20:17:38 Júlio Cesar 16601.  115054244 Alemanha NA       
## 6 2018-12-23 17:48:23 nathalia    15256.  115476749 Alemanha NA       
## 7 2018-12-23 21:12:50 Nathália    17621.  114970801 Alemanha NA       
## 8 2018-12-23 17:59:44 Sandra      16081.  114979909 Alemanha NA</code></pre>
</div>
</div>
<div id="referências-3" class="section level1 unnumbered">
<h1 class="unnumbered">Referências</h1>
<div id="capítulo-6---introdução-a-base-de-dados-relacionais-no-r" class="section level2 unlisted unnumbered">
<h2 class="unlisted unnumbered">Capítulo 6 - Introdução a base de dados relacionais no R</h2>
<center>
<em>Exercício 1</em>
</center>
<p><strong>6.1)</strong> Primeiro de tudo, precisamos identificar quais são as informações que nós precisamos para calcular o indicador requisitado na questão. Queremos estimar o tempo de trabalho necessário (após a graduação) para cobrir os custos totais do curso de graduação em cada universidade. Portanto, precisamos saber qual o custo total do curso em cada universidade, além do salário estimado dos profissionais que formam nessa respectiva universidade.</p>
<p>Por morarmos no Brasil, universidades americanas nos cobrariam o preço de um estudante não residente do estado de sua sede (<em>out of state</em>). O custo total para esse tipo de aluno está na coluna <code>out_of_state_total</code> da tabela <code>tuition_cost</code>. Já o salário potencial de um aluno que acaba de se formar, é descrito na coluna <code>early_career_pay</code> da tabela <code>salary_potential</code>.</p>
<div class="sourceCode" id="cb2109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2109-1"><a href="#cb2109-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb2109-2"><a href="#cb2109-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2109-3"><a href="#cb2109-3" aria-hidden="true" tabindex="-1"></a>github <span class="ot">&lt;-</span> <span class="st">&quot;https://raw.githubusercontent.com/rfordatascience/&quot;</span></span>
<span id="cb2109-4"><a href="#cb2109-4" aria-hidden="true" tabindex="-1"></a>pasta <span class="ot">&lt;-</span> <span class="st">&quot;tidytuesday/master/data/2020/2020-03-10/&quot;</span></span>
<span id="cb2109-5"><a href="#cb2109-5" aria-hidden="true" tabindex="-1"></a>cost <span class="ot">&lt;-</span> <span class="st">&quot;tuition_cost.csv&quot;</span></span>
<span id="cb2109-6"><a href="#cb2109-6" aria-hidden="true" tabindex="-1"></a>salary <span class="ot">&lt;-</span> <span class="st">&quot;salary_potential.csv&quot;</span></span>
<span id="cb2109-7"><a href="#cb2109-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2109-8"><a href="#cb2109-8" aria-hidden="true" tabindex="-1"></a>tuition_cost <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">paste0</span>(github, pasta, cost))</span></code></pre></div>
<pre><code>## Rows: 2973 Columns: 10</code></pre>
<pre><code>## -- Column specification ---------------------------------------------------
## Delimiter: &quot;,&quot;
## chr (5): name, state, state_code, type, degree_length
## dbl (5): room_and_board, in_state_tuition, in_state_total, out_of_state...</code></pre>
<pre><code>## 
## i Use `spec()` to retrieve the full column specification for this data.
## i Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<div class="sourceCode" id="cb2113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2113-1"><a href="#cb2113-1" aria-hidden="true" tabindex="-1"></a>salary_potential <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">paste0</span>(github, pasta, salary))</span></code></pre></div>
<pre><code>## Rows: 935 Columns: 7</code></pre>
<pre><code>## -- Column specification ---------------------------------------------------
## Delimiter: &quot;,&quot;
## chr (2): name, state_name
## dbl (5): rank, early_career_pay, mid_career_pay, make_world_better_perc...</code></pre>
<pre><code>## 
## i Use `spec()` to retrieve the full column specification for this data.
## i Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<p>Porém, como os custos descritos na tabela <code>tuition_cost</code> são anuais, precisamos multiplicar esses custos pelo número de anos presentes na coluna <code>degree_length</code>. Para extrairmos o número de cada <em>string</em> da coluna <code>degree_length</code>, podemos utilizar a função <code>parse_number()</code> do pacote <code>readr</code>. Em seguida, utilizo a função <code>colnames()</code> sobre as duas primeiras colunas da tabela, com o objetivo de traduzir os nomes dessas colunas em uma linguagem mais acessível.</p>
<div class="sourceCode" id="cb2117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2117-1"><a href="#cb2117-1" aria-hidden="true" tabindex="-1"></a>custo <span class="ot">&lt;-</span> tuition_cost <span class="sc">%&gt;%</span> </span>
<span id="cb2117-2"><a href="#cb2117-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(name, degree_length, out_of_state_total) <span class="sc">%&gt;%</span> </span>
<span id="cb2117-3"><a href="#cb2117-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb2117-4"><a href="#cb2117-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">anos =</span> readr<span class="sc">::</span><span class="fu">parse_number</span>(degree_length),</span>
<span id="cb2117-5"><a href="#cb2117-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">custo_total =</span> anos <span class="sc">*</span> out_of_state_total</span>
<span id="cb2117-6"><a href="#cb2117-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb2117-7"><a href="#cb2117-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>degree_length)</span></code></pre></div>
<pre><code>## Warning: 1 parsing failure.
##  row col expected actual
## 2632  -- a number  Other</code></pre>
<div class="sourceCode" id="cb2119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2119-1"><a href="#cb2119-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(custo)[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb2119-2"><a href="#cb2119-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;nome_universidade&quot;</span>, <span class="st">&quot;custo_anual&quot;</span></span>
<span id="cb2119-3"><a href="#cb2119-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2119-4"><a href="#cb2119-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2119-5"><a href="#cb2119-5" aria-hidden="true" tabindex="-1"></a>custo</span></code></pre></div>
<pre><code>## # A tibble: 2,973 x 4
##    nome_universidade                    custo_anual  anos custo_total
##    &lt;chr&gt;                                      &lt;dbl&gt; &lt;dbl&gt;       &lt;dbl&gt;
##  1 Aaniiih Nakoda College                      2380     2        4760
##  2 Abilene Christian University               45200     4      180800
##  3 Abraham Baldwin Agricultural College       21024     2       42048
##  4 Academy College                            17661     2       35322
##  5 Academy of Art University                  44458     4      177832
##  6 Adams State University                     29238     4      116952
##  7 Adelphi University                         54690     4      218760
##  8 Adirondack Community College               21595     2       43190
##  9 Adrian College                             48405     4      193620
## 10 Advanced Technology Institute              13680     2       27360
## # ... with 2,963 more rows</code></pre>
<p>Como precisamos apenas das colunas <code>early_career_pay</code> e <code>name</code> da tabela <code>salary_potential</code>, eu aplico um <code>select()</code> sobre a tabela. Além disso, eu também renomeio as colunas (para nomes mais fáceis de se interpretar) dessa tabela.</p>
<div class="sourceCode" id="cb2121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2121-1"><a href="#cb2121-1" aria-hidden="true" tabindex="-1"></a>salario <span class="ot">&lt;-</span> salary_potential <span class="sc">%&gt;%</span></span>
<span id="cb2121-2"><a href="#cb2121-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(name, early_career_pay)</span>
<span id="cb2121-3"><a href="#cb2121-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2121-4"><a href="#cb2121-4" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(salario) <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb2121-5"><a href="#cb2121-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;nome_universidade&quot;</span>, <span class="st">&quot;salario_inicio_carreira&quot;</span></span>
<span id="cb2121-6"><a href="#cb2121-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>Com essas informações em mãos, podemos utilizar a função <code>inner_join()</code> para unir as duas tabelas criadas (<code>salario</code> e <code>custo</code>) em uma só. Em seguida, precisamos apenas dividir o custo total do curso pela renda esperada para adquirir uma estimativa dos anos de trabalho necessários para repor o investimento aplicado no curso. Como você pode ver abaixo, um aluno formado na Adams State University levaria em torno de 2,63 anos (isto é, <span class="math inline">\(2,63 \times 365 \approx 960\)</span> dias) de trabalho para recompor os valores dispendidos em sua graduação.</p>
<div class="sourceCode" id="cb2122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2122-1"><a href="#cb2122-1" aria-hidden="true" tabindex="-1"></a>custo <span class="sc">%&gt;%</span> </span>
<span id="cb2122-2"><a href="#cb2122-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(</span>
<span id="cb2122-3"><a href="#cb2122-3" aria-hidden="true" tabindex="-1"></a>    salario,</span>
<span id="cb2122-4"><a href="#cb2122-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="st">&quot;nome_universidade&quot;</span></span>
<span id="cb2122-5"><a href="#cb2122-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb2122-6"><a href="#cb2122-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb2122-7"><a href="#cb2122-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">anos_necessarios =</span> custo_total <span class="sc">/</span> salario_inicio_carreira</span>
<span id="cb2122-8"><a href="#cb2122-8" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 728 x 6
##    nome_universidade        custo_anual  anos custo_total salario_inicio_c~
##    &lt;chr&gt;                          &lt;dbl&gt; &lt;dbl&gt;       &lt;dbl&gt;             &lt;dbl&gt;
##  1 Adams State University         29238     4      116952             44400
##  2 Adventist University of~       19350     4       77400             51600
##  3 Agnes Scott College            53490     4      213960             46000
##  4 Alabama State University       24818     4       99272             39800
##  5 Alaska Pacific Universi~       28130     4      112520             50300
##  6 Albany College of Pharm~       46025     4      184100             81000
##  7 Albertus Magnus College        45260     4      181040             49700
##  8 Albion College                 58155     4      232620             52100
##  9 Alcorn State University        16752     4       67008             40900
## 10 Allen College                  27252     4      109008             51600
## # ... with 718 more rows, and 1 more variable: anos_necessarios &lt;dbl&gt;</code></pre>
<center>
<em>Exercício 2</em>
</center>
<p><strong>6.2.A)</strong> Na tabela <code>consumidores</code>, temos as colunas <code>Id_consumidor</code> e <code>Id_vendedor</code> que representam as <em>keys</em> nessa tabela. Já na tabela <code>vendedores</code>, temos apenas a coluna <code>Id_vendedor</code> como <em>key</em>.</p>
<p><strong>6.2.B)</strong> Lembre-se que, uma <em>primary key</em> é uma variável capaz de identificar unicamente cada observação presente em sua tabela. Logo, podemos perceber que a coluna <code>Id_consumidor</code> é a <em>primary key</em> da tabela <code>consumidores</code>. Pois cada observação da tabela, possui um valor diferente na coluna <code>Id_consumidor</code>. Já uma <em>foreign key</em> é uma coluna que não é capaz de identificar unicamente cada uma das observações de uma tabela. Com isso, podemos chegar à conclusão de que a coluna <code>Id_vendedor</code> é a <em>foreign key</em> da tabela <code>consumidores</code>.</p>
<p>Entenda que as colunas que representam as <em>keys</em> de uma tabela, podem mudar de acordo com o contexto. A princípio, as colunas <code>Id_consumidor</code> e <code>Id_vendedor</code> são as <em>keys</em>, pelo simples fato de que elas identificam o objeto foco que está sendo descrito nas tabelas <code>consumidores</code> e <code>vendedores</code>. Em outras palavras, a tabela <code>consumidores</code> apresenta um conjunto de dados sobre <strong>consumidores</strong> e, a coluna <code>Id_consumidor</code> identifica unicamente esses consumidores.</p>
<p>A partir do momento em que meu foco de atenção muda, eu posso estar preocupado em identificar unidades, pessoas, grupos, empresas e características diferentes. Por exemplo, se eu estou mais interessado nas <strong>cidades onde o atendimento foi realizado</strong>, é provável que a coluna <code>Cidade_atendimento</code> seja uma <em>key</em> mais importante que as colunas <code>Id_vendedor</code> e <code>Id_consumidor</code>.</p>
<p><strong>6.2.C)</strong> Após importarmos as tabelas para o R, precisamos aplicar um <em>join</em> entre elas, para que possamos relacionar as cidades de atendimento (<code>Cidade_atendimento</code>) aos respectivos vendedores (<code>Nome_vendedor</code>). Em seguida, podemos aplicar dois <code>count()</code>’s seguidos para chegarmos ao resultado desejado.</p>
<div class="sourceCode" id="cb2124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2124-1"><a href="#cb2124-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb2124-2"><a href="#cb2124-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2124-3"><a href="#cb2124-3" aria-hidden="true" tabindex="-1"></a>github <span class="ot">&lt;-</span> <span class="st">&quot;https://raw.githubusercontent.com/pedropark99/&quot;</span></span>
<span id="cb2124-4"><a href="#cb2124-4" aria-hidden="true" tabindex="-1"></a>pasta <span class="ot">&lt;-</span> <span class="st">&quot;Curso-R/master/Dados/&quot;</span></span>
<span id="cb2124-5"><a href="#cb2124-5" aria-hidden="true" tabindex="-1"></a>arquivo1 <span class="ot">&lt;-</span> <span class="st">&quot;consumidor.csv&quot;</span></span>
<span id="cb2124-6"><a href="#cb2124-6" aria-hidden="true" tabindex="-1"></a>arquivo2 <span class="ot">&lt;-</span> <span class="st">&quot;vendedores.csv&quot;</span></span>
<span id="cb2124-7"><a href="#cb2124-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2124-8"><a href="#cb2124-8" aria-hidden="true" tabindex="-1"></a>consumidores <span class="ot">&lt;-</span> <span class="fu">read_csv2</span>(<span class="fu">paste0</span>(github, pasta, arquivo1))</span>
<span id="cb2124-9"><a href="#cb2124-9" aria-hidden="true" tabindex="-1"></a>vendedores <span class="ot">&lt;-</span> <span class="fu">read_csv2</span>(<span class="fu">paste0</span>(github, pasta, arquivo2))</span></code></pre></div>
<div class="sourceCode" id="cb2125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2125-1"><a href="#cb2125-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Resposta:</span></span>
<span id="cb2125-2"><a href="#cb2125-2" aria-hidden="true" tabindex="-1"></a>consumidores <span class="sc">%&gt;%</span> </span>
<span id="cb2125-3"><a href="#cb2125-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(vendedores) <span class="sc">%&gt;%</span> </span>
<span id="cb2125-4"><a href="#cb2125-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(Nome_vendedor, Cidade_atendimento) <span class="sc">%&gt;%</span> </span>
<span id="cb2125-5"><a href="#cb2125-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(Nome_vendedor)</span></code></pre></div>
<pre><code>## Joining, by = &quot;Id_vendedor&quot;</code></pre>
<pre><code>## # A tibble: 6 x 2
##   Nome_vendedor           n
##   &lt;chr&gt;               &lt;int&gt;
## 1 Jaiminho da Cerveja     1
## 2 Laura Lima              2
## 3 Miguel Anabiguel        1
## 4 Natália Vista           2
## 5 Pablo Osmar             2
## 6 Paulo Morato            2</code></pre>
<center>
<em>Exercício 3</em>
</center>
<p><strong>6.3)</strong> Esse comando de <em>join</em> não funciona, pelo fato de que as tabelas <code>filmes</code> e <code>filmes_receita</code> não possuem colunas de nomes congruentes. Ou seja, a função <code>left_join()</code> procura por colunas de mesmo nome entre as tabelas <code>filmes</code> e <code>filmes_receita</code>, para utilizar como <em>key</em> no processo de <em>join</em>. Porém, ao não uma coluna de nome correspondente, o <em>join</em> acaba falhando.</p>
<p>Para corrigirmos esse problema, podemos: 1) renomear uma das colunas que representa a <em>key</em> do <em>join</em>, de modo que os seus nomes fiquem iguais; ou 2) dizer explicitamente à <code>left_join()</code>, quais são as colunas equivalente entre essas tabelas, através do argumento <code>by</code> da função. Temos a capacidade de realizar a segunda opção de uma maneira bem direta, como demonstrado abaixo:</p>
<div class="sourceCode" id="cb2128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2128-1"><a href="#cb2128-1" aria-hidden="true" tabindex="-1"></a>filmes <span class="sc">%&gt;%</span> </span>
<span id="cb2128-2"><a href="#cb2128-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb2128-3"><a href="#cb2128-3" aria-hidden="true" tabindex="-1"></a>    filmes_receita,</span>
<span id="cb2128-4"><a href="#cb2128-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;FilmeId&quot;</span> <span class="ot">=</span> <span class="st">&quot;Movie_id&quot;</span>)</span>
<span id="cb2128-5"><a href="#cb2128-5" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 14 x 8
##    FilmeId Titulo              Diretor   Ano DuracaoMinutos Nota_do_publico
##      &lt;dbl&gt; &lt;chr&gt;               &lt;chr&gt;   &lt;dbl&gt;          &lt;dbl&gt;           &lt;dbl&gt;
##  1       1 Toy Story           John L~  1995             81              83
##  2       2 A Bug&#39;s Life        John L~  1998             95              72
##  3       3 Toy Story 2         John L~  1999             93              79
##  4       4 Monsters, Inc.      Pete D~  2001             92              81
##  5       5 Finding Nemo        Andrew~  2003            107              82
##  6       6 The Incredibles     Brad B~  2004            116               8
##  7       7 Cars                John L~  2006            117              72
##  8       8 Ratatouille         Brad B~  2007            115               8
##  9       9 WALL-E              Andrew~  2008            104              85
## 10      10 Up                  Pete D~  2009            101              83
## 11      11 Toy Story 3         Lee Un~  2010            103              84
## 12      12 Cars 2              John L~  2011            120              64
## 13      13 Brave               Brenda~  2012            102              72
## 14      14 Monsters University Dan Sc~  2013            110              74
## # ... with 2 more variables: Receita_interna &lt;dbl&gt;,
## #   Receita_internacional &lt;dbl&gt;</code></pre>
<p>Por outro lado, a primeira opção envolve o uso da função <code>colnames()</code> para renomear a coluna desejada. Após esse passo, a função <code>left_join()</code> volta a funcionar normalmente.</p>
<div class="sourceCode" id="cb2130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2130-1"><a href="#cb2130-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(filmes_receita)[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="st">&quot;FilmeId&quot;</span></span>
<span id="cb2130-2"><a href="#cb2130-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2130-3"><a href="#cb2130-3" aria-hidden="true" tabindex="-1"></a>filmes <span class="sc">%&gt;%</span> </span>
<span id="cb2130-4"><a href="#cb2130-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb2130-5"><a href="#cb2130-5" aria-hidden="true" tabindex="-1"></a>    filmes_receita</span>
<span id="cb2130-6"><a href="#cb2130-6" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## Joining, by = &quot;FilmeId&quot;</code></pre>
<pre><code>## # A tibble: 14 x 8
##    FilmeId Titulo              Diretor   Ano DuracaoMinutos Nota_do_publico
##      &lt;dbl&gt; &lt;chr&gt;               &lt;chr&gt;   &lt;dbl&gt;          &lt;dbl&gt;           &lt;dbl&gt;
##  1       1 Toy Story           John L~  1995             81              83
##  2       2 A Bug&#39;s Life        John L~  1998             95              72
##  3       3 Toy Story 2         John L~  1999             93              79
##  4       4 Monsters, Inc.      Pete D~  2001             92              81
##  5       5 Finding Nemo        Andrew~  2003            107              82
##  6       6 The Incredibles     Brad B~  2004            116               8
##  7       7 Cars                John L~  2006            117              72
##  8       8 Ratatouille         Brad B~  2007            115               8
##  9       9 WALL-E              Andrew~  2008            104              85
## 10      10 Up                  Pete D~  2009            101              83
## 11      11 Toy Story 3         Lee Un~  2010            103              84
## 12      12 Cars 2              John L~  2011            120              64
## 13      13 Brave               Brenda~  2012            102              72
## 14      14 Monsters University Dan Sc~  2013            110              74
## # ... with 2 more variables: Receita_interna &lt;dbl&gt;,
## #   Receita_internacional &lt;dbl&gt;</code></pre>
</div>
</div>
<div id="referências-4" class="section level1 unnumbered">
<h1 class="unnumbered">Referências</h1>
<div id="capítulo-7---tidy-data-uma-abordagem-para-organizar-os-seus-dados" class="section level2 unlisted unnumbered">
<h2 class="unlisted unnumbered">Capítulo 7 - <em>Tidy Data</em>: uma abordagem para organizar os seus dados</h2>
<center>
<em>Exercício 1</em>
</center>
<p><strong>7.1.A)</strong> Primeiro, comece sempre identificando a unidade básica que está sendo tratada na tabela. Como foi definido no enunciado, a tabela <code>world_bank_pop</code> lhe apresenta a série histórica de diversos indicadores populacionais de diferentes países. Com isso, podemos chegar à conclusão de que a unidade básica dessa tabela são os países tratados nessa tabela.</p>
<p><strong>Caso houvesse um único indicador nessa tabela</strong>, como por exemplo, crescimento anual da população, poderíamos dizer que a unidade básica da tabela seria o crescimento anual da população de cada país. Mas como há pelo menos 4 indicadores para cada país, e cada um deles apresenta uma característica diferente da população desse país, não podemos considerar todos eles como parte da unidade básica da tabela.</p>
<div class="sourceCode" id="cb2133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2133-1"><a href="#cb2133-1" aria-hidden="true" tabindex="-1"></a>n_indicadores <span class="ot">&lt;-</span> <span class="fu">n_distinct</span>(world_bank_pop<span class="sc">$</span>indicator)</span>
<span id="cb2133-2"><a href="#cb2133-2" aria-hidden="true" tabindex="-1"></a>n_indicadores</span></code></pre></div>
<pre><code>## [1] 4</code></pre>
<p>Como você pode ver abaixo, temos 264 países diferentes ao longo da base, logo, se é de nosso desejo respeitar o pressuposto de que “cada observação deve possuir a sua própria linha,” a tabela <code>world_bank_pop</code> deve acomodar 264 linhas. Pelo fato dessa tabela possuir 1056 linhas, sabemos que esse pressuposto é violado pela tabela.</p>
<div class="sourceCode" id="cb2135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2135-1"><a href="#cb2135-1" aria-hidden="true" tabindex="-1"></a>n_paises <span class="ot">&lt;-</span> <span class="fu">n_distinct</span>(world_bank_pop<span class="sc">$</span>country)</span>
<span id="cb2135-2"><a href="#cb2135-2" aria-hidden="true" tabindex="-1"></a>n_paises</span></code></pre></div>
<pre><code>## [1] 264</code></pre>
<div class="sourceCode" id="cb2137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2137-1"><a href="#cb2137-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(world_bank_pop)</span></code></pre></div>
<pre><code>## [1] 1056</code></pre>
<p>Além disso, temos a capacidade de rapidamente identificar que o pressuposto de que “cada variável deve possuir a sua própria coluna” também é violado pelo formato da tabela. Pois os diferentes anos da série histórica de cada indicador estão espalhados ao longo de várias colunas, sendo que, esses anos deveriam estar concentrados em uma única coluna, assim como os valores de cada série histórica em si.</p>
<p><strong>7.1.B)</strong> Com a resposta do item anterior, podemos chegar aos seguintes passos a serem realizados, com o objetivo de transportar a tabela <code>world_bank_pop</code> para o formato <em>tidy</em>: 1) trazer os diversos anos para uma única coluna e, o mesmo deve ser feito para os valores de cada série histórica; 2) separar uma coluna diferente para cada um dos indicadores da coluna <code>indicator</code>. Podemos realizar esses passos com as funções <code>pivot_longer()</code> e <code>pivot_wider()</code>.</p>
<div class="sourceCode" id="cb2139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2139-1"><a href="#cb2139-1" aria-hidden="true" tabindex="-1"></a>tab_tidy <span class="ot">&lt;-</span> world_bank_pop <span class="sc">%&gt;%</span> </span>
<span id="cb2139-2"><a href="#cb2139-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb2139-3"><a href="#cb2139-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">matches</span>(<span class="st">&quot;[0-9]{4}&quot;</span>),</span>
<span id="cb2139-4"><a href="#cb2139-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">&quot;ano&quot;</span>,</span>
<span id="cb2139-5"><a href="#cb2139-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">&quot;valor&quot;</span></span>
<span id="cb2139-6"><a href="#cb2139-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb2139-7"><a href="#cb2139-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb2139-8"><a href="#cb2139-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">id_cols =</span> <span class="fu">c</span>(<span class="st">&quot;country&quot;</span>, <span class="st">&quot;ano&quot;</span>),</span>
<span id="cb2139-9"><a href="#cb2139-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> <span class="st">&quot;indicator&quot;</span>,</span>
<span id="cb2139-10"><a href="#cb2139-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> <span class="st">&quot;valor&quot;</span></span>
<span id="cb2139-11"><a href="#cb2139-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb2139-12"><a href="#cb2139-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2139-13"><a href="#cb2139-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2139-14"><a href="#cb2139-14" aria-hidden="true" tabindex="-1"></a>tab_tidy</span></code></pre></div>
<pre><code>## # A tibble: 4,752 x 6
##    country ano   SP.URB.TOTL SP.URB.GROW SP.POP.TOTL SP.POP.GROW
##    &lt;chr&gt;   &lt;chr&gt;       &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;
##  1 ABW     2000        42444      1.18         90853      2.06  
##  2 ABW     2001        43048      1.41         92898      2.23  
##  3 ABW     2002        43670      1.43         94992      2.23  
##  4 ABW     2003        44246      1.31         97017      2.11  
##  5 ABW     2004        44669      0.951        98737      1.76  
##  6 ABW     2005        44889      0.491       100031      1.30  
##  7 ABW     2006        44881     -0.0178      100832      0.798 
##  8 ABW     2007        44686     -0.435       101220      0.384 
##  9 ABW     2008        44375     -0.698       101353      0.131 
## 10 ABW     2009        44052     -0.731       101453      0.0986
## # ... with 4,742 more rows</code></pre>
<p><strong>7.1.C)</strong> Realizar o primeiro passo descrito no enunciado do item é muito simples com a função <code>filter()</code>. Porém, ainda assim, o formato no qual a base se encontra, torna o cálculo da variação muito trabalhoso. Porque nós teríamos que calcular a variação entre cada uma das colunas anuais. Como temos 18 anos diferentes em cada série histórica, precisaríamos calcular 17 variações diferentes. Isso significa que teríamos de construir 17 colunas diferentes com <code>mutate()</code> para chegarmos a esses números.</p>
<div class="sourceCode" id="cb2141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2141-1"><a href="#cb2141-1" aria-hidden="true" tabindex="-1"></a>pop_total <span class="ot">&lt;-</span> world_bank_pop <span class="sc">%&gt;%</span> </span>
<span id="cb2141-2"><a href="#cb2141-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb2141-3"><a href="#cb2141-3" aria-hidden="true" tabindex="-1"></a>    indicator <span class="sc">==</span> <span class="st">&quot;SP.POP.TOTL&quot;</span></span>
<span id="cb2141-4"><a href="#cb2141-4" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb2141-5"><a href="#cb2141-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2141-6"><a href="#cb2141-6" aria-hidden="true" tabindex="-1"></a>pop_total</span></code></pre></div>
<pre><code>## # A tibble: 264 x 20
##    country indicator      `2000`  `2001` `2002` `2003` `2004` `2005` `2006`
##    &lt;chr&gt;   &lt;chr&gt;           &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
##  1 ABW     SP.POP.TOTL     90853  9.29e4 9.50e4 9.70e4 9.87e4 1.00e5 1.01e5
##  2 AFG     SP.POP.TOTL  20093756  2.10e7 2.20e7 2.31e7 2.41e7 2.51e7 2.59e7
##  3 AGO     SP.POP.TOTL  16440924  1.70e7 1.76e7 1.82e7 1.89e7 1.96e7 2.03e7
##  4 ALB     SP.POP.TOTL   3089027  3.06e6 3.05e6 3.04e6 3.03e6 3.01e6 2.99e6
##  5 AND     SP.POP.TOTL     65390  6.73e4 7.00e4 7.32e4 7.62e4 7.89e4 8.10e4
##  6 ARB     SP.POP.TOTL 283832016  2.90e8 2.96e8 3.02e8 3.09e8 3.16e8 3.24e8
##  7 ARE     SP.POP.TOTL   3154925  3.33e6 3.51e6 3.74e6 4.09e6 4.58e6 5.24e6
##  8 ARG     SP.POP.TOTL  37057452  3.75e7 3.79e7 3.83e7 3.87e7 3.91e7 3.96e7
##  9 ARM     SP.POP.TOTL   3069588  3.05e6 3.03e6 3.02e6 3.00e6 2.98e6 2.96e6
## 10 ASM     SP.POP.TOTL     57521  5.82e4 5.87e4 5.91e4 5.93e4 5.91e4 5.86e4
## # ... with 254 more rows, and 11 more variables: 2007 &lt;dbl&gt;, 2008 &lt;dbl&gt;,
## #   2009 &lt;dbl&gt;, 2010 &lt;dbl&gt;, 2011 &lt;dbl&gt;, 2012 &lt;dbl&gt;, 2013 &lt;dbl&gt;,
## #   2014 &lt;dbl&gt;, 2015 &lt;dbl&gt;, 2016 &lt;dbl&gt;, 2017 &lt;dbl&gt;</code></pre>
<p>Por isso, é muito mais fácil calcularmos essa variação ao transportarmos esses anos para uma única coluna e, em seguida, subtraírmos o valor de uma linha específica do valor da linha anterior, com a função <code>lag()</code> que apresentamos no Capítulo 4.</p>
<div class="sourceCode" id="cb2143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2143-1"><a href="#cb2143-1" aria-hidden="true" tabindex="-1"></a>pop_total <span class="ot">&lt;-</span> pop_total <span class="sc">%&gt;%</span> </span>
<span id="cb2143-2"><a href="#cb2143-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb2143-3"><a href="#cb2143-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">matches</span>(<span class="st">&quot;[0-9]{4}&quot;</span>),</span>
<span id="cb2143-4"><a href="#cb2143-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">&quot;ano&quot;</span>,</span>
<span id="cb2143-5"><a href="#cb2143-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">&quot;valor&quot;</span></span>
<span id="cb2143-6"><a href="#cb2143-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb2143-7"><a href="#cb2143-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(country) <span class="sc">%&gt;%</span> </span>
<span id="cb2143-8"><a href="#cb2143-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb2143-9"><a href="#cb2143-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">variacao =</span> valor <span class="sc">-</span> <span class="fu">lag</span>(valor)</span>
<span id="cb2143-10"><a href="#cb2143-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb2143-11"><a href="#cb2143-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2143-12"><a href="#cb2143-12" aria-hidden="true" tabindex="-1"></a>pop_total</span></code></pre></div>
<pre><code>## # A tibble: 4,752 x 5
## # Groups:   country [264]
##    country indicator   ano    valor variacao
##    &lt;chr&gt;   &lt;chr&gt;       &lt;chr&gt;  &lt;dbl&gt;    &lt;dbl&gt;
##  1 ABW     SP.POP.TOTL 2000   90853       NA
##  2 ABW     SP.POP.TOTL 2001   92898     2045
##  3 ABW     SP.POP.TOTL 2002   94992     2094
##  4 ABW     SP.POP.TOTL 2003   97017     2025
##  5 ABW     SP.POP.TOTL 2004   98737     1720
##  6 ABW     SP.POP.TOTL 2005  100031     1294
##  7 ABW     SP.POP.TOTL 2006  100832      801
##  8 ABW     SP.POP.TOTL 2007  101220      388
##  9 ABW     SP.POP.TOTL 2008  101353      133
## 10 ABW     SP.POP.TOTL 2009  101453      100
## # ... with 4,742 more rows</code></pre>
</div>
</div>
<div id="referências-5" class="section level1 unnumbered">
<h1 class="unnumbered">Referências</h1>
<div id="capítulo-8---visualização-de-dados-com-ggplot2" class="section level2 unlisted unnumbered">
<h2 class="unlisted unnumbered">Capítulo 8 - Visualização de dados com <code>ggplot2</code></h2>
<center>
<em>Exercício 1</em>
</center>
<p><strong>8.1.A)</strong> O erro nesse item está no uso do <em>pipe</em> para conectar os componentes do gráfico <code>ggplot</code>. Lembre-se que, as camadas de um gráfico <code>ggplot</code> são adicionadas umas as outras, por meio do operador <code>+</code>. Logo, basta substituírmos o <em>pipe</em> pelo operador <code>+</code> que os comandos voltam a funcionar normalmente.</p>
<div class="sourceCode" id="cb2145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2145-1"><a href="#cb2145-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> mpg) <span class="sc">+</span></span>
<span id="cb2145-2"><a href="#cb2145-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb2145-3"><a href="#cb2145-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> displ, <span class="at">y =</span> hwy)</span>
<span id="cb2145-4"><a href="#cb2145-4" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><strong>8.1.B)</strong> O erro nesse item está no uso do argumento <code>fill</code> ao invés do argumento <code>color</code>. Lembre-se que, para colorir geometrias criadas por <code>geoms</code> individuais (como pontos - <code>geom_point()</code> e linhas - <code>geom_line()</code>), utiliza-se o argumento <code>color</code>. Já geomtrias que são criadas por <code>geoms</code> coletivos (como barras - <code>geom_bar()</code> ou <code>boxplots</code> - <code>geom_boxplot()</code>), utiliza-se o argumento <code>fill</code>. Logo, ao substituírmos o argumento <code>fill</code> pelo <code>color</code>, o resultado desejado é atingido.</p>
<div class="sourceCode" id="cb2146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2146-1"><a href="#cb2146-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> diamonds) <span class="sc">+</span></span>
<span id="cb2146-2"><a href="#cb2146-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb2146-3"><a href="#cb2146-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> carat, <span class="at">y =</span> price, <span class="at">color =</span> cut)</span>
<span id="cb2146-4"><a href="#cb2146-4" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><strong>8.1.C)</strong> Lembre-se que, se desejamos manter uma característica do gráfico (cores, formatos, posição, etc.) constante ao longo de todo o gráfico, nos definimos essa característica <strong>fora da função <code>aes()</code></strong>. Portanto, para atingirmos o resultado desejado, precisamos apenas retirar o termo <code>color = "blue"</code> de dentro da função <code>aes()</code>.</p>
<div class="sourceCode" id="cb2147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2147-1"><a href="#cb2147-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diamonds) <span class="sc">+</span></span>
<span id="cb2147-2"><a href="#cb2147-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(</span>
<span id="cb2147-3"><a href="#cb2147-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> cut), <span class="at">fill =</span> <span class="st">&quot;blue&quot;</span></span>
<span id="cb2147-4"><a href="#cb2147-4" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<div style="page-break-after: always;"></div>
<center>
<em>Exercício 2</em>
</center>
<p><strong>8.2.A)</strong> Antes de tudo, é interessante armazenarmos os códigos HEX das cores que formam a bandeira LGBTQ+. Pode ser em um vetor qualquer, como o <code>vec_colors</code> abaixo.</p>
<div class="sourceCode" id="cb2148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2148-1"><a href="#cb2148-1" aria-hidden="true" tabindex="-1"></a>vec_colors <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb2148-2"><a href="#cb2148-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;#a319ff&quot;</span>,</span>
<span id="cb2148-3"><a href="#cb2148-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;#1294ff&quot;</span>,</span>
<span id="cb2148-4"><a href="#cb2148-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;#19bf45&quot;</span>,</span>
<span id="cb2148-5"><a href="#cb2148-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;#ffdc14&quot;</span>,</span>
<span id="cb2148-6"><a href="#cb2148-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;#ff6a00&quot;</span>,</span>
<span id="cb2148-7"><a href="#cb2148-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;#ff1919&quot;</span></span>
<span id="cb2148-8"><a href="#cb2148-8" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>Agora, o pacote <code>ggplot2</code> nos permite desenhar essa mesma bandeira de diversas formas, mas nessa seção vou mostrar apenas 2 formas intuitivas. Provavelmente, a primeira estratégia que passou pela sua cabeça é simplesmente desenhar 6 faixas empilhadas uma em cima da outra, sendo uma de cada cor presente no vetor <code>vec_colors</code> acima.</p>
<p>Como desejamos desejar faixas (ou linhas retas consideravelmente largas), uma opção seria utilizarmos a função <code>geom_bar()</code> para construírmos 6 barras de mesma altura. Perceba abaixo, que em <code>geom_bar()</code> essas barras são posicionadas (horizontalmente) uma do lado da outra. Porém, utilizo logo em seguida a função <code>coord_flip()</code> para inverter o plano cartesiano por completo, isto é, trocar o eixo x pelo eixo y, e, trocar o eixo y pelo eixo x. Dessa forma, as barras que estavam uma do lado da outra, passam a estar uma em cima da outra, ou, são empilhadas verticalmente. Por último, precisamos apenas colorir essas barras com as cores da bandeira. Para isso, basta conectarmos o argumento <code>fill</code> ao vetor <code>vec_colors</code> e, utilizar a função <code>scale_fill_identity()</code> para ler os códigos das cores presentes nesse vetor.</p>
<div class="sourceCode" id="cb2149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2149-1"><a href="#cb2149-1" aria-hidden="true" tabindex="-1"></a>dados <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb2149-2"><a href="#cb2149-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="dv">10</span>,</span>
<span id="cb2149-3"><a href="#cb2149-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span></span>
<span id="cb2149-4"><a href="#cb2149-4" aria-hidden="true" tabindex="-1"></a>  ) </span>
<span id="cb2149-5"><a href="#cb2149-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2149-6"><a href="#cb2149-6" aria-hidden="true" tabindex="-1"></a>dados <span class="sc">%&gt;%</span> </span>
<span id="cb2149-7"><a href="#cb2149-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb2149-8"><a href="#cb2149-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(</span>
<span id="cb2149-9"><a href="#cb2149-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">fill =</span> vec_colors),</span>
<span id="cb2149-10"><a href="#cb2149-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">position =</span> <span class="st">&quot;dodge&quot;</span>,</span>
<span id="cb2149-11"><a href="#cb2149-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>,</span>
<span id="cb2149-12"><a href="#cb2149-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span> <span class="dv">1</span></span>
<span id="cb2149-13"><a href="#cb2149-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb2149-14"><a href="#cb2149-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb2149-15"><a href="#cb2149-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_identity</span>() <span class="sc">+</span></span>
<span id="cb2149-16"><a href="#cb2149-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span></code></pre></div>
<p>Esse é certamente um método simples e eficaz de desenhar essa bandeira. Entretanto, uma outra forma de desenharmos essa bandeira, seria desenhando 6 retângulos, um sobre o outro. Podemos realizar esse processo por meio de <code>geom_rect()</code>. Todos os retângulos possuem a mesma largura (de 10 unidades), porém, as alturas se reduzem em 1 unidade (6, 5, 4, 3,…) em cada retângulo. Ou seja, o primeiro retângulo (de cor vermelha) é o maior de todos, ou, dito de outra forma, sua altura cobre todas as 6 faixas da bandeira. Já o último retângulo (de cor roxa), é o menor de todos, pois sua altura cobre apenas 1 única faixa.</p>
<div class="sourceCode" id="cb2150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2150-1"><a href="#cb2150-1" aria-hidden="true" tabindex="-1"></a>dados <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb2150-2"><a href="#cb2150-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">colors =</span> vec_colors[<span class="fu">length</span>(vec_colors)<span class="sc">:</span><span class="dv">1</span>],</span>
<span id="cb2150-3"><a href="#cb2150-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">xmin =</span> <span class="dv">0</span>, </span>
<span id="cb2150-4"><a href="#cb2150-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">xmax =</span> <span class="dv">10</span>,</span>
<span id="cb2150-5"><a href="#cb2150-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">ymin =</span> <span class="dv">0</span>,</span>
<span id="cb2150-6"><a href="#cb2150-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">ymax =</span> <span class="dv">6</span><span class="sc">:</span><span class="dv">1</span></span>
<span id="cb2150-7"><a href="#cb2150-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2150-8"><a href="#cb2150-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2150-9"><a href="#cb2150-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2150-10"><a href="#cb2150-10" aria-hidden="true" tabindex="-1"></a>dados <span class="sc">%&gt;%</span> </span>
<span id="cb2150-11"><a href="#cb2150-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb2150-12"><a href="#cb2150-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_rect</span>(</span>
<span id="cb2150-13"><a href="#cb2150-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">xmin =</span> xmin, <span class="at">xmax =</span> xmax,</span>
<span id="cb2150-14"><a href="#cb2150-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">ymin =</span> ymin, <span class="at">ymax =</span> ymax,</span>
<span id="cb2150-15"><a href="#cb2150-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">fill =</span> colors)</span>
<span id="cb2150-16"><a href="#cb2150-16" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb2150-17"><a href="#cb2150-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_identity</span>() <span class="sc">+</span></span>
<span id="cb2150-18"><a href="#cb2150-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span></code></pre></div>
<div style="page-break-after: always;"></div>
<p><strong>8.2.B)</strong> Primeiro, precisamos calcular os valores de <span class="math inline">\(y\)</span> a medida em que <span class="math inline">\(x\)</span> varia de 0 a 1000. Lembre-se que a função é <span class="math inline">\(y = x^2 + 15x + 32\)</span>. Com os valores de <span class="math inline">\(x\)</span> e os seus respectivos valores de <span class="math inline">\(y\)</span> calculados, precisamos apenas fornecer esses vetores ao <code>aes()</code> de <code>geom_line()</code> para atingirmos o resultado esperado.</p>
<div class="sourceCode" id="cb2151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2151-1"><a href="#cb2151-1" aria-hidden="true" tabindex="-1"></a>valores_x <span class="ot">&lt;-</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1000</span></span>
<span id="cb2151-2"><a href="#cb2151-2" aria-hidden="true" tabindex="-1"></a>valores_y <span class="ot">&lt;-</span> (valores_x <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">+</span> (<span class="dv">15</span> <span class="sc">*</span> valores_x) <span class="sc">+</span> <span class="dv">32</span></span>
<span id="cb2151-3"><a href="#cb2151-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2151-4"><a href="#cb2151-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb2151-5"><a href="#cb2151-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(</span>
<span id="cb2151-6"><a href="#cb2151-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> valores_x, <span class="at">y =</span> valores_y)</span>
<span id="cb2151-7"><a href="#cb2151-7" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<div style="page-break-after: always;"></div>
<p><strong>8.2.C)</strong> Com os comandos abaixo, você poderia desenhar o texto “Uma anotação muito importante” em seu gráfico. Com isso, precisamos agora incrementar esses comandos com novas camadas do gráfico que vão desenhar as setas desejadas.</p>
<div class="sourceCode" id="cb2152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2152-1"><a href="#cb2152-1" aria-hidden="true" tabindex="-1"></a>anotacao <span class="ot">&lt;-</span> <span class="st">&quot;Uma anotação</span><span class="sc">\n</span><span class="st">muito importante&quot;</span></span>
<span id="cb2152-2"><a href="#cb2152-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2152-3"><a href="#cb2152-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb2152-4"><a href="#cb2152-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb2152-5"><a href="#cb2152-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">10</span>, <span class="at">y =</span> <span class="dv">10</span>, <span class="at">label =</span> anotacao)</span>
<span id="cb2152-6"><a href="#cb2152-6" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>A função <code>geom_segment()</code> serve para desenhar linhas retas (ou “segmentos”) em seu gráfico. Para mais, essa função oferece um argumento <code>arrow</code> que permite desenhar a cabeça de uma seta de forma automática em cada segmento. Portanto, preciso apenas definir as coordenadas de cada seta (valores da tabela <code>setas</code>) e deixar que o argumento <code>arrow</code> desenhe as cabeças de cada seta.</p>
<div class="sourceCode" id="cb2153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2153-1"><a href="#cb2153-1" aria-hidden="true" tabindex="-1"></a>setas <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb2153-2"><a href="#cb2153-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">id =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>,</span>
<span id="cb2153-3"><a href="#cb2153-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">c</span>(<span class="dv">8</span>, <span class="dv">12</span>, <span class="dv">12</span>, <span class="dv">8</span>),</span>
<span id="cb2153-4"><a href="#cb2153-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">8</span>, <span class="dv">8</span>, <span class="dv">12</span>, <span class="dv">12</span>),</span>
<span id="cb2153-5"><a href="#cb2153-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">xend =</span> <span class="fu">c</span>(<span class="fl">9.5</span>, <span class="fl">10.5</span>, <span class="fl">10.5</span>, <span class="fl">9.5</span>),</span>
<span id="cb2153-6"><a href="#cb2153-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">yend =</span> <span class="fu">c</span>(<span class="fl">9.5</span>, <span class="fl">9.5</span>, <span class="fl">10.5</span>, <span class="fl">10.5</span>)</span>
<span id="cb2153-7"><a href="#cb2153-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2153-8"><a href="#cb2153-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2153-9"><a href="#cb2153-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb2153-10"><a href="#cb2153-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb2153-11"><a href="#cb2153-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">10</span>, <span class="at">y =</span> <span class="dv">10</span>, <span class="at">label =</span> anotacao)</span>
<span id="cb2153-12"><a href="#cb2153-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb2153-13"><a href="#cb2153-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(</span>
<span id="cb2153-14"><a href="#cb2153-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">xend =</span> xend, <span class="at">yend =</span> yend,</span>
<span id="cb2153-15"><a href="#cb2153-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">group =</span> id),</span>
<span id="cb2153-16"><a href="#cb2153-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> setas,</span>
<span id="cb2153-17"><a href="#cb2153-17" aria-hidden="true" tabindex="-1"></a>    <span class="do">### Ao definirmos o argumento arrow</span></span>
<span id="cb2153-18"><a href="#cb2153-18" aria-hidden="true" tabindex="-1"></a>    <span class="do">### com a função arrow(),</span></span>
<span id="cb2153-19"><a href="#cb2153-19" aria-hidden="true" tabindex="-1"></a>    <span class="do">### podemos adicionar a cabeça da</span></span>
<span id="cb2153-20"><a href="#cb2153-20" aria-hidden="true" tabindex="-1"></a>    <span class="do">### seta de forma fácil e automática</span></span>
<span id="cb2153-21"><a href="#cb2153-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">arrow =</span> <span class="fu">arrow</span>()</span>
<span id="cb2153-22"><a href="#cb2153-22" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<div style="page-break-after: always;"></div>
<center>
<em>Exercício 3</em>
</center>
<p><strong>8.3)</strong> Poderíamos responder essa pergunta de diversas formas e, utilizando diferentes tipos de gráfico. Por exemplo, uma primeira aproximação da resposta, seria empregarmos um simples gráfico de <em>boxplot</em>, com a função <code>geom_boxplot()</code>. Ainda podemos empregar a função <code>reorder()</code> sobre o a variável <code>cut</code>, para reordenarmos o eixo x de maneira crescente segundo a mediana de <code>price</code>. Dessa maneira, podemos observar facilmente que os diamantes que possuem corte <em>“Ideal”</em> são os de menor preço na média. Enquanto isso, também identificamos que os diamentes de pior corte (isto é, os de corte <em>“Fair”</em> ou “justo”) são, na média, os diamantes mais caros no mercado.</p>
<div class="sourceCode" id="cb2154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2154-1"><a href="#cb2154-1" aria-hidden="true" tabindex="-1"></a>diamonds <span class="sc">%&gt;%</span> </span>
<span id="cb2154-2"><a href="#cb2154-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb2154-3"><a href="#cb2154-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(</span>
<span id="cb2154-4"><a href="#cb2154-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(</span>
<span id="cb2154-5"><a href="#cb2154-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="fu">reorder</span>(cut, price, <span class="at">FUN =</span> median),</span>
<span id="cb2154-6"><a href="#cb2154-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> price</span>
<span id="cb2154-7"><a href="#cb2154-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb2154-8"><a href="#cb2154-8" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>Uma alternativa, seria primeiro calcular as estatísticas descritivas e, em seguida, requisitar às funções do <code>ggplot</code> que apenas identifiquem esses valores no gráfico. Tendo isso em mente, nós agrupamos a base de acordo com a variável <code>cut</code> com a função <code>group_by()</code>, calculamos o preço médio de cada grupo com <code>summarise()</code> e, por último, utilizamos <code>geom_col()</code> para desenhar um gráfico de barras simples, onde a altura de cada barra representa os preços médios calculados por <code>summarise()</code>.</p>
<div class="sourceCode" id="cb2155"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2155-1"><a href="#cb2155-1" aria-hidden="true" tabindex="-1"></a>estatisticas <span class="ot">&lt;-</span> diamonds <span class="sc">%&gt;%</span> </span>
<span id="cb2155-2"><a href="#cb2155-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cut) <span class="sc">%&gt;%</span> </span>
<span id="cb2155-3"><a href="#cb2155-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb2155-4"><a href="#cb2155-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">media =</span> <span class="fu">mean</span>(price, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2155-5"><a href="#cb2155-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb2155-6"><a href="#cb2155-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2155-7"><a href="#cb2155-7" aria-hidden="true" tabindex="-1"></a>estatisticas <span class="sc">%&gt;%</span> </span>
<span id="cb2155-8"><a href="#cb2155-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb2155-9"><a href="#cb2155-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(</span>
<span id="cb2155-10"><a href="#cb2155-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(</span>
<span id="cb2155-11"><a href="#cb2155-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="fu">reorder</span>(cut, media),</span>
<span id="cb2155-12"><a href="#cb2155-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> media</span>
<span id="cb2155-13"><a href="#cb2155-13" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb2155-14"><a href="#cb2155-14" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
</div>
</div>
<div id="referências-6" class="section level1 unnumbered">
<h1 class="unnumbered">Referências</h1>
<div id="capítulo-9---configurando-componentes-estéticos-do-gráfico-no-ggplot2" class="section level2 unlisted unnumbered">
<h2 class="unlisted unnumbered">Capítulo 9 - Configurando componentes estéticos do gráfico no <code>ggplot2</code></h2>
<center>
<em>Exercício 1</em>
</center>
<p><strong>9.1.)</strong> Primeiro, podemos colorir o plano de fundo do gráfico e do <em>grid</em> da seguinte maneira:</p>
<div class="sourceCode" id="cb2156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2156-1"><a href="#cb2156-1" aria-hidden="true" tabindex="-1"></a>tema <span class="ot">&lt;-</span> <span class="fu">theme</span>(</span>
<span id="cb2156-2"><a href="#cb2156-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;#1a232e&quot;</span>),</span>
<span id="cb2156-3"><a href="#cb2156-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.background =</span> <span class="fu">element_rect</span>(</span>
<span id="cb2156-4"><a href="#cb2156-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">&quot;#1a232e&quot;</span>, <span class="at">color =</span> <span class="st">&quot;#171717&quot;</span>, <span class="at">size =</span> <span class="dv">2</span></span>
<span id="cb2156-5"><a href="#cb2156-5" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb2156-6"><a href="#cb2156-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;#666666&quot;</span>)</span>
<span id="cb2156-7"><a href="#cb2156-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2156-8"><a href="#cb2156-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2156-9"><a href="#cb2156-9" aria-hidden="true" tabindex="-1"></a>plot_exemplo <span class="sc">+</span> tema</span></code></pre></div>
<pre><code>## Warning: Removed 2 rows containing missing values (geom_point).</code></pre>
<div style="page-break-after: always;"></div>
<p>Segundo, seria ideal colorirmos todos os textos do gráfico de branco, além de alterarmos a fonte e o estilo empregados sobre o título do gráfico, como demonstrado abaixo.</p>
<div class="sourceCode" id="cb2158"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2158-1"><a href="#cb2158-1" aria-hidden="true" tabindex="-1"></a>tema <span class="ot">&lt;-</span> <span class="fu">theme</span>(</span>
<span id="cb2158-2"><a href="#cb2158-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;#1a232e&quot;</span>),</span>
<span id="cb2158-3"><a href="#cb2158-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.background =</span> <span class="fu">element_rect</span>(</span>
<span id="cb2158-4"><a href="#cb2158-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">&quot;#1a232e&quot;</span>, <span class="at">color =</span> <span class="st">&quot;#171717&quot;</span>, <span class="at">size =</span> <span class="dv">2</span></span>
<span id="cb2158-5"><a href="#cb2158-5" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb2158-6"><a href="#cb2158-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;#666666&quot;</span>),</span>
<span id="cb2158-7"><a href="#cb2158-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">&quot;white&quot;</span>),</span>
<span id="cb2158-8"><a href="#cb2158-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">&quot;white&quot;</span>),</span>
<span id="cb2158-9"><a href="#cb2158-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot.title =</span> <span class="fu">element_text</span>(</span>
<span id="cb2158-10"><a href="#cb2158-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="st">&quot;serif&quot;</span>, <span class="at">size =</span> <span class="dv">15</span>,</span>
<span id="cb2158-11"><a href="#cb2158-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">face =</span> <span class="st">&quot;bold.italic&quot;</span></span>
<span id="cb2158-12"><a href="#cb2158-12" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb2158-13"><a href="#cb2158-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2158-14"><a href="#cb2158-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2158-15"><a href="#cb2158-15" aria-hidden="true" tabindex="-1"></a>plot_exemplo <span class="sc">+</span> tema</span></code></pre></div>
<pre><code>## Warning: Removed 2 rows containing missing values (geom_point).</code></pre>
<div style="page-break-after: always;"></div>
<p>Por último, podemos adicionar as alterações necessárias sobre a legenda do gráfico, por meio dos seguintes comandos:</p>
<div class="sourceCode" id="cb2160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2160-1"><a href="#cb2160-1" aria-hidden="true" tabindex="-1"></a>tema <span class="ot">&lt;-</span> <span class="fu">theme</span>(</span>
<span id="cb2160-2"><a href="#cb2160-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;#1a232e&quot;</span>),</span>
<span id="cb2160-3"><a href="#cb2160-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.background =</span> <span class="fu">element_rect</span>(</span>
<span id="cb2160-4"><a href="#cb2160-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">&quot;#1a232e&quot;</span>, <span class="at">color =</span> <span class="st">&quot;#171717&quot;</span>, <span class="at">size =</span> <span class="dv">2</span></span>
<span id="cb2160-5"><a href="#cb2160-5" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb2160-6"><a href="#cb2160-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;#666666&quot;</span>),</span>
<span id="cb2160-7"><a href="#cb2160-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">&quot;white&quot;</span>),</span>
<span id="cb2160-8"><a href="#cb2160-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">&quot;white&quot;</span>),</span>
<span id="cb2160-9"><a href="#cb2160-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot.title =</span> <span class="fu">element_text</span>(</span>
<span id="cb2160-10"><a href="#cb2160-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="st">&quot;serif&quot;</span>, <span class="at">size =</span> <span class="dv">15</span>,</span>
<span id="cb2160-11"><a href="#cb2160-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">face =</span> <span class="st">&quot;bold.italic&quot;</span></span>
<span id="cb2160-12"><a href="#cb2160-12" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb2160-13"><a href="#cb2160-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>,</span>
<span id="cb2160-14"><a href="#cb2160-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">legend.title =</span> <span class="fu">element_text</span>(</span>
<span id="cb2160-15"><a href="#cb2160-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="st">&quot;serif&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold.italic&quot;</span></span>
<span id="cb2160-16"><a href="#cb2160-16" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb2160-17"><a href="#cb2160-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">legend.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;#1a232e&quot;</span>),</span>
<span id="cb2160-18"><a href="#cb2160-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">legend.key =</span> <span class="fu">element_rect</span>(</span>
<span id="cb2160-19"><a href="#cb2160-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">&quot;#1a232e&quot;</span>, <span class="at">color =</span> <span class="st">&quot;#171717&quot;</span>, <span class="at">size =</span> <span class="fl">1.5</span></span>
<span id="cb2160-20"><a href="#cb2160-20" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb2160-21"><a href="#cb2160-21" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2160-22"><a href="#cb2160-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2160-23"><a href="#cb2160-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2160-24"><a href="#cb2160-24" aria-hidden="true" tabindex="-1"></a>plot_exemplo <span class="sc">+</span> tema</span></code></pre></div>
<pre><code>## Warning: Removed 2 rows containing missing values (geom_point).</code></pre>
<div style="page-break-after: always;"></div>
<p><strong>9.2.A)</strong> Lembre-se que para eliminarmos a legenda de um gráfico, basta configurar o argumento <code>legend.position</code> para <code>"none"</code>.</p>
<div class="sourceCode" id="cb2162"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2162-1"><a href="#cb2162-1" aria-hidden="true" tabindex="-1"></a>plot_exemplo <span class="sc">+</span></span>
<span id="cb2162-2"><a href="#cb2162-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<pre><code>## Warning: Removed 2 rows containing missing values (geom_point).</code></pre>
<p><strong>9.2.B)</strong> O erro ocorre, devido ao fato de que estamos empregando a função <code>element_*()</code> errada no elemento <code>panel.grid</code>. Lembre-se que o elemento <code>panel.grid</code> diz respeito às linhas do <em>grid</em>, logo, para alterar esse elemento deve-se utilizar a função <code>element_line()</code>, ao invés de <code>element_rect()</code>.</p>
<div class="sourceCode" id="cb2164"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2164-1"><a href="#cb2164-1" aria-hidden="true" tabindex="-1"></a>plot_exemplo <span class="sc">+</span></span>
<span id="cb2164-2"><a href="#cb2164-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb2164-3"><a href="#cb2164-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">&quot;#6E1450&quot;</span>),</span>
<span id="cb2164-4"><a href="#cb2164-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;#6E1450&quot;</span>)</span>
<span id="cb2164-5"><a href="#cb2164-5" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## Warning: Removed 2 rows containing missing values (geom_point).</code></pre>
<div style="page-break-after: always;"></div>
<p><strong>9.2.C)</strong> Para isso, precisamos definir o argumento <code>color</code> da função <code>element_rect()</code> no argumento <code>panel.background</code> de <code>theme()</code>.</p>
<div class="sourceCode" id="cb2166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2166-1"><a href="#cb2166-1" aria-hidden="true" tabindex="-1"></a>plot_exemplo <span class="sc">+</span></span>
<span id="cb2166-2"><a href="#cb2166-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">&quot;#222222&quot;</span>))</span></code></pre></div>
<pre><code>## Warning: Removed 2 rows containing missing values (geom_point).</code></pre>
<div style="page-break-after: always;"></div>
</div>
</div>
<div id="referências-7" class="section level1 unnumbered">
<h1 class="unnumbered">Referências</h1>
<div id="capítulo-10---manipulação-e-transformação-de-strings-com-stringr" class="section level2 unlisted unnumbered">
<h2 class="unlisted unnumbered">Capítulo 10 - Manipulação e transformação de <em>strings</em> com <code>stringr</code></h2>
<center>
<em>Exercício 1</em>
</center>
<p><strong>10.1.A)</strong> Tal sequência de caracteres pode ser representada pela expressão regular <code>"[bc]al"</code>, ou ainda, pela expressão <code>"bal|cal"</code>. Ambas as expressões atingem o mesmo resultado:</p>
<div class="sourceCode" id="cb2168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2168-1"><a href="#cb2168-1" aria-hidden="true" tabindex="-1"></a>index <span class="ot">&lt;-</span> <span class="fu">str_which</span>(</span>
<span id="cb2168-2"><a href="#cb2168-2" aria-hidden="true" tabindex="-1"></a>  words,</span>
<span id="cb2168-3"><a href="#cb2168-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;[bc]al&quot;</span></span>
<span id="cb2168-4"><a href="#cb2168-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2168-5"><a href="#cb2168-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2168-6"><a href="#cb2168-6" aria-hidden="true" tabindex="-1"></a>words[index]</span></code></pre></div>
<pre><code>## [1] &quot;balance&quot; &quot;ball&quot;    &quot;call&quot;    &quot;local&quot;</code></pre>
<p><strong>10.1.B)</strong> Perceba que, pelo que foi requisitado no enunciado do item, o primeiro caractere da expressão regular pode ser qualquer um (<strong>exceto a letra “a”</strong>). Logo, podemos começar a expressão regular pela classe de caracteres negativa <code>"[^a]"</code>, que lista o caractere não permitido nessa primeira posição. Em seguida, precisamos apenas incluir a letra “c,” além do <em>metacharacter</em> <code>$</code> que representa o final do <em>string</em>.</p>
<div class="sourceCode" id="cb2170"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2170-1"><a href="#cb2170-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_subset</span>(</span>
<span id="cb2170-2"><a href="#cb2170-2" aria-hidden="true" tabindex="-1"></a>  words,</span>
<span id="cb2170-3"><a href="#cb2170-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;[^a]c$&quot;</span></span>
<span id="cb2170-4"><a href="#cb2170-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## [1] &quot;electric&quot; &quot;music&quot;    &quot;politic&quot;  &quot;public&quot;   &quot;specific&quot; &quot;traffic&quot;</code></pre>
<p><strong>10.1.C)</strong> A primeira sequência citada (“s-p-a-c-e”) é bem específica e, por isso, talvez seja mais fácil utilizarmos um <em>metacharacter</em> de alternação <code>|</code> para separa essa sequência como um caso especial. Do outro lado do <em>metacharacter</em> <code>|</code> podemos a expressão <code>"ess$"</code>, ou ainda, a expressão <code>"e(s{2})$"</code>, ambas são expressões equivalentes.</p>
<div class="sourceCode" id="cb2172"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2172-1"><a href="#cb2172-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_subset</span>(</span>
<span id="cb2172-2"><a href="#cb2172-2" aria-hidden="true" tabindex="-1"></a>  words,</span>
<span id="cb2172-3"><a href="#cb2172-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;space|e(s{2})$&quot;</span></span>
<span id="cb2172-4"><a href="#cb2172-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>##  [1] &quot;address&quot;  &quot;business&quot; &quot;dress&quot;    &quot;express&quot;  &quot;guess&quot;    &quot;less&quot;    
##  [7] &quot;press&quot;    &quot;process&quot;  &quot;space&quot;    &quot;unless&quot;</code></pre>
<div class="sourceCode" id="cb2174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2174-1"><a href="#cb2174-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_subset</span>(</span>
<span id="cb2174-2"><a href="#cb2174-2" aria-hidden="true" tabindex="-1"></a>  words,</span>
<span id="cb2174-3"><a href="#cb2174-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;space|ess$&quot;</span></span>
<span id="cb2174-4"><a href="#cb2174-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>##  [1] &quot;address&quot;  &quot;business&quot; &quot;dress&quot;    &quot;express&quot;  &quot;guess&quot;    &quot;less&quot;    
##  [7] &quot;press&quot;    &quot;process&quot;  &quot;space&quot;    &quot;unless&quot;</code></pre>
<p><strong>10.1.D)</strong> Muitas pessoas ao verem uma questão como essa, tendem rapidamente para a expressão <code>"..."</code>, ou de outra maneira, <code>".{3}"</code>, que representa a mesma coisa. Pois essa expressão significa “um caractere qualquer, imediatamente seguido por um outro caractere qualquer, que por sua vez, é seguido por um outro caractere qualquer.” Bem, porque não testamos essa expressão. Como podemos ver pelo resultado abaixo, essa expressão acaba nos retornando praticamente todo o vetor <code>words</code> de volta.</p>
<div class="sourceCode" id="cb2176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2176-1"><a href="#cb2176-1" aria-hidden="true" tabindex="-1"></a>resultado <span class="ot">&lt;-</span> <span class="fu">str_subset</span>(</span>
<span id="cb2176-2"><a href="#cb2176-2" aria-hidden="true" tabindex="-1"></a>  words,</span>
<span id="cb2176-3"><a href="#cb2176-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;...&quot;</span></span>
<span id="cb2176-4"><a href="#cb2176-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2176-5"><a href="#cb2176-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2176-6"><a href="#cb2176-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(resultado, <span class="at">max =</span> <span class="dv">30</span>)</span></code></pre></div>
<pre><code>##  [1] &quot;able&quot;      &quot;about&quot;     &quot;absolute&quot;  &quot;accept&quot;    &quot;account&quot;  
##  [6] &quot;achieve&quot;   &quot;across&quot;    &quot;act&quot;       &quot;active&quot;    &quot;actual&quot;   
## [11] &quot;add&quot;       &quot;address&quot;   &quot;admit&quot;     &quot;advertise&quot; &quot;affect&quot;   
## [16] &quot;afford&quot;    &quot;after&quot;     &quot;afternoon&quot; &quot;again&quot;     &quot;against&quot;  
## [21] &quot;age&quot;       &quot;agent&quot;     &quot;ago&quot;       &quot;agree&quot;     &quot;air&quot;      
## [26] &quot;all&quot;       &quot;allow&quot;     &quot;almost&quot;    &quot;along&quot;     &quot;already&quot;  
##  [ reached getOption(&quot;max.print&quot;) -- omitted 931 entries ]</code></pre>
<p>O que está acontecendo? Em momentos como esse, é importante que você compreenda bem o que a sua expressão regular significa. Lembre-se sempre de ler ou interpretar a sua expressão como a “descrição de uma sequência específica de caracteres,” e não como uma palavra ou frase específicas.</p>
<p>A expressão <code>"..."</code> significa “um caractere qualquer, imediatamente seguido por um outro caractere qualquer, que por sua vez, é seguido por um outro caractere qualquer.” Logo, em resumo, essa expressão está procurando por um sequência de 3 caracteres quaisquer. Com isso em mente, podemos chegar à conclusão de que quase todo o vetor <code>words</code> é retornado por essa expressão, pelo fato de que quase todas as palavras desse vetor <strong>contém pelo menos 3 caracteres</strong>.</p>
<p>Em outras palavras, a expressão <code>"..."</code> não possui qualquer noção de limite, ou quantidade exata a ser procurada. Essa expressão vai procurar por uma sequência de três letras quaisquer, independente de onde ela ocorra, seja em uma palavra que possui exatos 3 caracteres, ou em uma palavra que possui 10 caracteres. Como a maior parte das palavras do vetor <code>words</code> possuem 3 ou mais letras, quase todas as palavras desse vetor contém uma sequência de 3 letras quaisquer em algum lugar dentro de si.</p>
<p>Portanto, precisamos adicionar “limites” à expressão <code>"..."</code> para que ela possa procurar pelas palavras que desejamos encontrar. Uma opção de limite apropriada, seria o uso de <em>metacharacters</em> do tipo âncora (<code>$</code> e <code>^</code>), formando assim, a expressão <code>"^...$"</code>. Dessa forma, estaríamos procurando pela seguinte sequência de caracteres: “o início do texto, imediatamente seguido por três caracteres quaisquer, que por sua vez, são imediatamente seguidos pelo fim desse mesmo texto.”</p>
<div class="sourceCode" id="cb2178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2178-1"><a href="#cb2178-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_subset</span>(</span>
<span id="cb2178-2"><a href="#cb2178-2" aria-hidden="true" tabindex="-1"></a>  words,</span>
<span id="cb2178-3"><a href="#cb2178-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;^...$&quot;</span></span>
<span id="cb2178-4"><a href="#cb2178-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>##   [1] &quot;act&quot; &quot;add&quot; &quot;age&quot; &quot;ago&quot; &quot;air&quot; &quot;all&quot; &quot;and&quot; &quot;any&quot; &quot;arm&quot; &quot;art&quot; &quot;ask&quot;
##  [12] &quot;bad&quot; &quot;bag&quot; &quot;bar&quot; &quot;bed&quot; &quot;bet&quot; &quot;big&quot; &quot;bit&quot; &quot;box&quot; &quot;boy&quot; &quot;bus&quot; &quot;but&quot;
##  [23] &quot;buy&quot; &quot;can&quot; &quot;car&quot; &quot;cat&quot; &quot;cup&quot; &quot;cut&quot; &quot;dad&quot; &quot;day&quot; &quot;die&quot; &quot;dog&quot; &quot;dry&quot;
##  [34] &quot;due&quot; &quot;eat&quot; &quot;egg&quot; &quot;end&quot; &quot;eye&quot; &quot;far&quot; &quot;few&quot; &quot;fit&quot; &quot;fly&quot; &quot;for&quot; &quot;fun&quot;
##  [45] &quot;gas&quot; &quot;get&quot; &quot;god&quot; &quot;guy&quot; &quot;hit&quot; &quot;hot&quot; &quot;how&quot; &quot;job&quot; &quot;key&quot; &quot;kid&quot; &quot;lad&quot;
##  [56] &quot;law&quot; &quot;lay&quot; &quot;leg&quot; &quot;let&quot; &quot;lie&quot; &quot;lot&quot; &quot;low&quot; &quot;man&quot; &quot;may&quot; &quot;mrs&quot; &quot;new&quot;
##  [67] &quot;non&quot; &quot;not&quot; &quot;now&quot; &quot;odd&quot; &quot;off&quot; &quot;old&quot; &quot;one&quot; &quot;out&quot; &quot;own&quot; &quot;pay&quot; &quot;per&quot;
##  [78] &quot;put&quot; &quot;red&quot; &quot;rid&quot; &quot;run&quot; &quot;say&quot; &quot;see&quot; &quot;set&quot; &quot;sex&quot; &quot;she&quot; &quot;sir&quot; &quot;sit&quot;
##  [89] &quot;six&quot; &quot;son&quot; &quot;sun&quot; &quot;tax&quot; &quot;tea&quot; &quot;ten&quot; &quot;the&quot; &quot;tie&quot; &quot;too&quot; &quot;top&quot; &quot;try&quot;
## [100] &quot;two&quot; &quot;use&quot; &quot;war&quot; &quot;way&quot; &quot;wee&quot; &quot;who&quot; &quot;why&quot; &quot;win&quot; &quot;yes&quot; &quot;yet&quot; &quot;you&quot;</code></pre>
<center>
<em>Exercício 2</em>
</center>
<p><strong>10.2.A)</strong> Há alguns métodos diferentes que você pode utilizar para resolver essa questão. Em algum ponto, essa solução vai envolver o uso de expressões regulares. Nessa resposta, vamos apresentar o método que envolve o uso de uma única expressão regular, capaz de descrever toda a sequência de caracteres presente em cada <em>string</em> do vetor <code>compras</code>.</p>
<p>A ideia básica desse método, é utilizar uma expressão regular que possa descrever cada uma das seções dos <em>strings</em>, e com a ajuda da função <code>str_replace()</code>, inserir um caractere especial entre cada uma dessas seções, criando assim uma espécie de arquivo CSV, onde cada variável está agora separada por um delimitador. Dessa forma, podemos fornecer esse resultado à função <code>read_csv()</code>, que fara todo o trabalho de separar essas seções em diferentes colunas de um <code>data.frame</code> por nós.</p>
<div class="sourceCode" id="cb2180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2180-1"><a href="#cb2180-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb2180-2"><a href="#cb2180-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2180-3"><a href="#cb2180-3" aria-hidden="true" tabindex="-1"></a>github <span class="ot">&lt;-</span> <span class="st">&quot;https://raw.githubusercontent.com/pedropark99/&quot;</span></span>
<span id="cb2180-4"><a href="#cb2180-4" aria-hidden="true" tabindex="-1"></a>pasta <span class="ot">&lt;-</span> <span class="st">&quot;Curso-R/master/Dados/&quot;</span></span>
<span id="cb2180-5"><a href="#cb2180-5" aria-hidden="true" tabindex="-1"></a>arquivo <span class="ot">&lt;-</span> <span class="st">&quot;compras_completo.txt&quot;</span></span>
<span id="cb2180-6"><a href="#cb2180-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2180-7"><a href="#cb2180-7" aria-hidden="true" tabindex="-1"></a>compras <span class="ot">&lt;-</span> <span class="fu">read_lines</span>(<span class="fu">paste0</span>(github, pasta, arquivo))</span></code></pre></div>
<p>Vamos começar pelos nomes dos consumidores. Uma expressão capaz de descrever essa seção é <code>"[a-zA-ZÁÉÍÓÚáéíóú]+"</code>. Uma outra alternativa seria a expressão <code>"([:lower:]|[:upper:])+"</code>. Com essas duas expressões somos capazes de encontrar nomes sem acentos (e.g. “Luiz”), assim como os nomes que contém acento (e.g. “Bárbara”) em alguma letra (seja ela maiúscula ou minúscula).</p>
<p>A parte que apresenta o CPF do consumidor é uma das mais fáceis dessa <em>string</em>, pois todo brasileiro que já precisou assinar algum contrato, ou comprar um produto pela internet, ou adquirir um documento pessoal, como a sua CNH (carteira de habilitação), conhece muito bem a estrutura tradicional de um CPF brasileiro. Em resumo, CPF’s costumam seguir a estrutura 123.456.789-00. Com isso, podemos chegar à expressão <code>"[0-9]{3}[.][0-9]{3}[.][0-9]{3}[-][0-9]{2}"</code> como uma boa candidata para descrever essa seção.</p>
<p>Em seguida, temos a seção que guarda o código de identificação da venda. Essa é uma das partes que mais contribuem para a complexidade da estrutura desses <em>string</em> como um todo. Principalmente pelo fato de que esses códigos variam em comprimento, podendo conter de 16 a 24 caracteres diferentes. Porém, ao sabermos todos os caracteres possíveis de aparecer nesses códigos, fica muito mais fácil de descrevermos essa seção. Com a lista de caracteres apresentada na figura 10.8, podemos chegar à expressão <code>"[a-zA-Z0-9!#$*&amp;]{16,24}"</code> como uma possível candidata.</p>
<p>Prosseguindo, temos a seção que guarda o código de identificação do produto. Essa seção é a mais fácil de todas, pois todos os códigos possuem 4 dígitos de comprimento. Tendo isso em mente, uma expressão simples como <code>"[0-9]{4}"</code> já resolve o nosso problema.</p>
<p>Após essa parte, temos o valor unitário do produto. O único detalhe que devemos estar atentos a essa seção, é que a parte decimal do valor sempre contém dois dígitos (preços não costumam ter 3 dígitos ou mais de centavos), mas a parte inteira do valor pode variar entre 1 e 3 dígitos (ou até mais, pois os preços dos produtos podem variar com o tempo e, como resultado, atingir o 4° dígito). Logo, podemos utilizar a expressão <code>"[0-9]+[.][0-9]{2}"</code> para descrever essa seção em específico.</p>
<p>A sexta parte dos <em>strings</em> contém datas e horários, os quais formam uma informação também muito familiar a várias pessoas. Lembre-se que no Brasil, datas e horários geralmente seguem a estrutura “Dia/Mês/Ano Hora:Minuto:Segundo.” No caso específico de <code>compras</code>, essas datas e horários vem acompanhados de uma descrição do fuso horário empregado. Essa descrição é igual a “-03” em todas as <em>strings</em> de <code>compras</code>. Com essas informações, você pode identificar a expressão <code>"[0-9]{2}/[0-9]{2}/[0-9]{4} [0-9]{2}:[0-9]{2}:[0-9]{2} -03"</code> como uma candidata possível.</p>
<p>Todavia, por algum motivo, os dia abaixo de 10 (ou seja, dias 1, 2, 3, 4, 5, etc.) estão desacompanhados do zero inicial. Ou seja, uma data que deveria estar escrita como “04/05/2020” está na verdade escrita na forma “4/05/2020.” Portanto, uma alternativa para corrigir esse problema é incluir o <em>metacharacter</em> da dúvida (<code>?</code>) no zero, formando assim a expressão <code>"[0-9]?[0-9]/[0-9]{2}/[0-9]{4} [0-9]{2}:[0-9]{2}:[0-9]{2} -03"</code>. Dessa forma, estamos definindo indiretamente que o dia pode ter 1 ou 2 caracteres, pois o primeiro caractere nessa região é opcional.</p>
<p>Caso você queira ser mais estrito, ou, mais preciso a respeito das datas, você poderia utilizar a expressão <code>"(3[0-1]|[0-2][0-9])/(0[1-9]|1[1-2])/2[0-9]{3}"</code>. O mesmo poderia ser feito com o horário, o qual seria melhor representado por uma expressão como <code>"(0[0-9]|1[0-9]|2[0-3]):([0-5][0-9]):([0-5][0-9])"</code>. Entranto, se tratando dos <em>strings</em> contidos no vetor <code>compras</code>, nós não precisamos ser tão específicos assim.</p>
<p>Por último, temos uma seção que armazena a quantidade do produto adquirida pelo consumidor. Essa parte também é bem simples de ser descrita, especialmente se levarmos em conta que a sequência " unidades" é constante ao longo de todo o vetor <code>compras</code>. Para mais, a quantidade adquirida pode variar entre 1 e 2 dígitos. Desse modo, podemos chegar à expressão <code>"[0-9]{1,2} unidades"</code> para descrever tal seção.</p>
<p>Com todos os fragmentos de expressões regulares em mãos, podemos começar a unir essas peças, com o objetivo de formarmos uma única grande expressão regular capaz de descrever toda a sequência de caracteres presentes em cada <em>string</em> do vetor <code>compras</code>. Neste processo, <strong>é fundamental contornar cada fragmento da expressão regular por um par de parênteses</strong>. Pois assim, temos acesso ao mecanismo de <em>backreferencing</em> em cada seção do <em>string</em>.</p>
<div class="sourceCode" id="cb2181"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2181-1"><a href="#cb2181-1" aria-hidden="true" tabindex="-1"></a>nome <span class="ot">&lt;-</span> <span class="st">&quot;([a-zA-ZÁÉÍÓÚáéíóú]+)&quot;</span></span>
<span id="cb2181-2"><a href="#cb2181-2" aria-hidden="true" tabindex="-1"></a>cpf <span class="ot">&lt;-</span> <span class="st">&quot;([0-9]{3}[.][0-9]{3}[.][0-9]{3}[-][0-9]{2})&quot;</span></span>
<span id="cb2181-3"><a href="#cb2181-3" aria-hidden="true" tabindex="-1"></a>idcompra <span class="ot">&lt;-</span> <span class="st">&quot;([a-zA-Z0-9!#$*&amp;]{16,24})&quot;</span></span>
<span id="cb2181-4"><a href="#cb2181-4" aria-hidden="true" tabindex="-1"></a>idproduto <span class="ot">&lt;-</span> <span class="st">&quot;([0-9]{4})&quot;</span></span>
<span id="cb2181-5"><a href="#cb2181-5" aria-hidden="true" tabindex="-1"></a>preço <span class="ot">&lt;-</span> <span class="st">&quot;([0-9]+[.][0-9]{2})&quot;</span></span>
<span id="cb2181-6"><a href="#cb2181-6" aria-hidden="true" tabindex="-1"></a>horario <span class="ot">&lt;-</span> <span class="st">&quot;([0-9]?[0-9]/[0-9]{2}/[0-9]{4} [0-9]{2}:[0-9]{2}:[0-9]{2} -03)&quot;</span></span>
<span id="cb2181-7"><a href="#cb2181-7" aria-hidden="true" tabindex="-1"></a>unidades <span class="ot">&lt;-</span> <span class="st">&quot;([0-9]{1,2} unidades)&quot;</span></span>
<span id="cb2181-8"><a href="#cb2181-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2181-9"><a href="#cb2181-9" aria-hidden="true" tabindex="-1"></a>expressao_completa <span class="ot">&lt;-</span> <span class="fu">str_c</span>(</span>
<span id="cb2181-10"><a href="#cb2181-10" aria-hidden="true" tabindex="-1"></a>  nome, cpf, idcompra,</span>
<span id="cb2181-11"><a href="#cb2181-11" aria-hidden="true" tabindex="-1"></a>  idproduto, preço, </span>
<span id="cb2181-12"><a href="#cb2181-12" aria-hidden="true" tabindex="-1"></a>  horario, unidades</span>
<span id="cb2181-13"><a href="#cb2181-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2181-14"><a href="#cb2181-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2181-15"><a href="#cb2181-15" aria-hidden="true" tabindex="-1"></a><span class="fu">str_trunc</span>(expressao_completa, <span class="at">width =</span> <span class="dv">50</span>, <span class="at">ellipsis =</span> <span class="st">&quot;~&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;([a-zA-ZÁÉÍÓÚáéíóú]+)([0-9]{3}[.][0-9]{3}[.][0-9]~&quot;</code></pre>
<p>Com a expressão completa formada, podemos adicionar pontos e vírgulas entre cada seção, com o uso de <em>backreferencing</em> na função <code>str_replace()</code>, como demonstrado abaixo. Após essa modificação, basta fornecermos o texto resultante a qualquer função que seja capaz de ler um arquivo CSV que utiliza o caractere <code>;</code> como separador. Nesse caso, eu utilizo a função <code>read_csv2()</code>, a qual introduzimos no capítulo 3 deste livro.</p>
<div class="sourceCode" id="cb2183"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2183-1"><a href="#cb2183-1" aria-hidden="true" tabindex="-1"></a>resultado <span class="ot">&lt;-</span> <span class="fu">str_replace</span>(</span>
<span id="cb2183-2"><a href="#cb2183-2" aria-hidden="true" tabindex="-1"></a>  compras,</span>
<span id="cb2183-3"><a href="#cb2183-3" aria-hidden="true" tabindex="-1"></a>  expressao_completa,</span>
<span id="cb2183-4"><a href="#cb2183-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;</span><span class="sc">\\</span><span class="st">1;</span><span class="sc">\\</span><span class="st">2;</span><span class="sc">\\</span><span class="st">3;</span><span class="sc">\\</span><span class="st">4;</span><span class="sc">\\</span><span class="st">5;</span><span class="sc">\\</span><span class="st">6;</span><span class="sc">\\</span><span class="st">7&quot;</span></span>
<span id="cb2183-5"><a href="#cb2183-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2183-6"><a href="#cb2183-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2183-7"><a href="#cb2183-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2183-8"><a href="#cb2183-8" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> resultado <span class="sc">%&gt;%</span></span>
<span id="cb2183-9"><a href="#cb2183-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_c</span>(<span class="at">collapse =</span> <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2183-10"><a href="#cb2183-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_csv2</span>(<span class="at">col_names =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p><strong>10.2.B)</strong> Para extrairmos a parte que contém a data e horário da compra, nós podemos utilizar a mesma expressão regular que empregamos na resposta do item anterior. Dessa maneira, podemos usar a função <code>str_extract()</code> para extrair de cada <em>string</em> do vetor <code>compras</code>, todo o pedaço de texto encontrado por essa expressão regular. Em seguida, podemos utilizar a função <code>str_sub()</code> para extrair os dois primeiros caracteres (que correspondem à parte do dia em cada data) de cada texto resultante de <code>str_extract()</code>.</p>
<div class="sourceCode" id="cb2184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2184-1"><a href="#cb2184-1" aria-hidden="true" tabindex="-1"></a>horario <span class="ot">&lt;-</span> <span class="st">&quot;([0-9]?[0-9]/[0-9]{2}/[0-9]{4} [0-9]{2}:[0-9]{2}:[0-9]{2} -03)&quot;</span></span>
<span id="cb2184-2"><a href="#cb2184-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2184-3"><a href="#cb2184-3" aria-hidden="true" tabindex="-1"></a>parte <span class="ot">&lt;-</span> <span class="fu">str_extract</span>(</span>
<span id="cb2184-4"><a href="#cb2184-4" aria-hidden="true" tabindex="-1"></a>  compras, <span class="at">pattern =</span> horario</span>
<span id="cb2184-5"><a href="#cb2184-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2184-6"><a href="#cb2184-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2184-7"><a href="#cb2184-7" aria-hidden="true" tabindex="-1"></a>dias <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(</span>
<span id="cb2184-8"><a href="#cb2184-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_sub</span>(parte, <span class="at">end =</span> <span class="dv">2</span>)</span>
<span id="cb2184-9"><a href="#cb2184-9" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>Agora, precisamos apenas fazer um cálculo de frequência sobre os valores presentes no vetor <code>dias</code>. Para realizar cálculos desse tipo, estivemos utilizando bastante a função <code>count()</code> ao longo desse livro. Porém, essa função trabalha com <code>data.frame</code>’s, ao invés de vetores. Por isso, neste caso específico, eu substituo a função <code>count()</code> pela função <code>table()</code> que é uma alternativa mais adequada para vetores. Perceba pelo resultado abaixo, que, aparentemente, o dia 26 é o dia do mês em que ocorre o maior número de vendas na loja.</p>
<div class="sourceCode" id="cb2185"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2185-1"><a href="#cb2185-1" aria-hidden="true" tabindex="-1"></a>contagens <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">table</span>(dias), <span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2185-2"><a href="#cb2185-2" aria-hidden="true" tabindex="-1"></a><span class="do">### Para facilitar a leitura dos resultados</span></span>
<span id="cb2185-3"><a href="#cb2185-3" aria-hidden="true" tabindex="-1"></a><span class="do">### eu utilizo str_c() para modificar o nome</span></span>
<span id="cb2185-4"><a href="#cb2185-4" aria-hidden="true" tabindex="-1"></a><span class="do">### de cada elemento desse resultado. </span></span>
<span id="cb2185-5"><a href="#cb2185-5" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(contagens) <span class="ot">&lt;-</span> <span class="fu">str_c</span>(</span>
<span id="cb2185-6"><a href="#cb2185-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Dia &quot;</span>,</span>
<span id="cb2185-7"><a href="#cb2185-7" aria-hidden="true" tabindex="-1"></a>   <span class="fu">names</span>(contagens)</span>
<span id="cb2185-8"><a href="#cb2185-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2185-9"><a href="#cb2185-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2185-10"><a href="#cb2185-10" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(contagens)</span></code></pre></div>
<pre><code>## Dia 26 Dia 12 Dia 14 Dia 20  Dia 3 Dia 13 Dia 19 Dia 29  Dia 7 Dia 24 
##     56     49     46     46     42     42     42     41     40     39 
##  Dia 4  Dia 9 Dia 10 Dia 27  Dia 1 Dia 21 Dia 22  Dia 8 Dia 25  Dia 6 
##     38     38     38     38     37     37     37     36     36     35 
## Dia 16 Dia 30 Dia 11 Dia 18  Dia 5 Dia 15 Dia 17  Dia 2 Dia 23 Dia 28 
##     35     35     34     33     32     32     32     29     29     28 
## Dia 31 
##     18</code></pre>
<p><strong>10.2.C)</strong> O problema principal nessa questão é o fato do CPF estar incluso após o nome do consumidor, o qual varia radicalmente em seu número de caracteres. Em outras palavras, seria muito simples extrairmos os 3 primeiros dígitos do CPF, caso ele fosse antecedido por um número fixo de caracteres, com o uso da função <code>str_sub()</code>.</p>
<p>Entretanto, devido ao número variável de caracteres que podem anteceder o CPF do consumidor, nós precisamos utilizar um outro método. Uma alternativa tão simples quanto a primeira, é utilizar a função <code>str_extract()</code> com a expressão regular <code>"[0-9]{3}"</code>.</p>
<div class="sourceCode" id="cb2187"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2187-1"><a href="#cb2187-1" aria-hidden="true" tabindex="-1"></a>resultado <span class="ot">&lt;-</span> <span class="fu">str_extract</span>(compras, <span class="st">&quot;[0-9]{3}&quot;</span>)</span>
<span id="cb2187-2"><a href="#cb2187-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(resultado, <span class="at">max =</span> <span class="dv">30</span>)</span></code></pre></div>
<pre><code>##  [1] &quot;390&quot; &quot;944&quot; &quot;395&quot; &quot;322&quot; &quot;475&quot; &quot;031&quot; &quot;528&quot; &quot;890&quot; &quot;571&quot; &quot;339&quot; &quot;753&quot;
## [12] &quot;110&quot; &quot;059&quot; &quot;543&quot; &quot;072&quot; &quot;327&quot; &quot;096&quot; &quot;138&quot; &quot;608&quot; &quot;079&quot; &quot;141&quot; &quot;841&quot;
## [23] &quot;078&quot; &quot;472&quot; &quot;988&quot; &quot;647&quot; &quot;493&quot; &quot;446&quot; &quot;236&quot; &quot;417&quot;
##  [ reached getOption(&quot;max.print&quot;) -- omitted 1120 entries ]</code></pre>
<p>Nesse momento você pode estar confuso, pois a expressão <code>"[0-9]{3}"</code> é muito geral, essa expressão representa uma sequência de três dígitos quaisquer e, há diversos locais ao longo de cada <em>string</em> que poderiam ser representados por tal expressão. Em outras palavras, porque a expressão <code>"[0-9]{3}"</code> extrai especificamente os 3 primeiros dígitos do CPF? Sendo que ela poderia extrair os 3 primeiros dígitos do código de identificação do produto? Ou parte do ano presente na data e horário da compra?</p>
<p>A resposta para essas perguntas se baseia no princípio de que pesquisas por expressões regulares ocorrem da esquerda para a direita em um <em>string</em> <span class="citation">(<a href="#ref-friedl2006" role="doc-biblioref">Friedl 2006</a>)</span>. Portanto, a expressão <code>"[0-9]{3}"</code> é capaz de extrair os 3 primeiros dígitos de cada CPF, pelo simples fato de que o CPF é o primeiro campo numérico a aparecer no <em>string</em>, antes do código de identificação do produto, e antes da data e horário da compra.</p>
</div>
</div>
<div id="referências-8" class="section level1 unnumbered">
<h1 class="unnumbered">Referências</h1>
<div id="capítulo-12---introdução-à-variáveis-de-tempo-com-lubridate" class="section level2 unlisted unnumbered">
<h2 class="unlisted unnumbered">Capítulo 12 - Introdução à variáveis de tempo com <code>lubridate</code></h2>
<center>
<em>Exercício 1</em>
</center>
<p><strong>12.1.A)</strong> Alguns valores do vetor <code>vec</code> são convertidos para <code>NA</code>, pelo simples fato de que eles não representam datas válidas segundo o calendário Gregoriano. Por exemplo, a data <code>"2020-02-30"</code> (30 de fevereiro de 2020) não existe em nosso calendário, assim como a data <code>"2020-09-87"</code> (87 de setembro de 2020).</p>
<div class="sourceCode" id="cb2189"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2189-1"><a href="#cb2189-1" aria-hidden="true" tabindex="-1"></a>vec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;2020-01-17&quot;</span>, <span class="st">&quot;2020-02-21&quot;</span>, <span class="st">&quot;2020-02-30&quot;</span>, </span>
<span id="cb2189-2"><a href="#cb2189-2" aria-hidden="true" tabindex="-1"></a>         <span class="st">&quot;2020-04-12&quot;</span>, <span class="st">&quot;2020-13-19&quot;</span>, <span class="st">&quot;2020-09-87&quot;</span>)</span>
<span id="cb2189-3"><a href="#cb2189-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2189-4"><a href="#cb2189-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2189-5"><a href="#cb2189-5" aria-hidden="true" tabindex="-1"></a><span class="fu">as.Date</span>(vec)</span></code></pre></div>
<pre><code>## [1] &quot;2020-01-17&quot; &quot;2020-02-21&quot; NA           &quot;2020-04-12&quot; NA          
## [6] NA</code></pre>
<p>Portanto, a menos que você queira utilizar um calendário diferente do Gregoriano, esse comportamento é correto e, provavelmente é exatamente o que você deseja que ocorra com datas inexistentes ou não válidas.</p>
<p><strong>12.1.B)</strong> Uma primeira alternativa, seria empregarmos a função <code>dmy()</code> do pacote <code>lubridate</code>.</p>
<div class="sourceCode" id="cb2191"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2191-1"><a href="#cb2191-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb2191-2"><a href="#cb2191-2" aria-hidden="true" tabindex="-1"></a>vec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;02, 02, 2020&quot;</span>, <span class="st">&quot;15, 03, 2020&quot;</span>, <span class="st">&quot;21, 04, 2020&quot;</span>,</span>
<span id="cb2191-3"><a href="#cb2191-3" aria-hidden="true" tabindex="-1"></a>         <span class="st">&quot;19, 09, 2020&quot;</span>, <span class="st">&quot;22, 06, 2020&quot;</span>, <span class="st">&quot;25, 12, 2020&quot;</span>)</span>
<span id="cb2191-4"><a href="#cb2191-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2191-5"><a href="#cb2191-5" aria-hidden="true" tabindex="-1"></a><span class="fu">dmy</span>(vec)</span></code></pre></div>
<pre><code>## [1] &quot;2020-02-02&quot; &quot;2020-03-15&quot; &quot;2020-04-21&quot; &quot;2020-09-19&quot; &quot;2020-06-22&quot;
## [6] &quot;2020-12-25&quot;</code></pre>
<p>Uma segunda alternativa, seria utilizarmos o argumento <code>format</code> da função <code>as.Date()</code> para definir a estrutura dessa data.</p>
<div class="sourceCode" id="cb2193"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2193-1"><a href="#cb2193-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.Date</span>(vec, <span class="at">format =</span> <span class="st">&quot;%d, %m, %Y&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2020-02-02&quot; &quot;2020-03-15&quot; &quot;2020-04-21&quot; &quot;2020-09-19&quot; &quot;2020-06-22&quot;
## [6] &quot;2020-12-25&quot;</code></pre>
<p><strong>12.1.C)</strong> Este ponto no tempo (meia noite de 01 de janeiro de 1970) foi armazenado como 10800 devido ao fuso horário aplicado pela função <code>as.POSIXct()</code>. Lembre-se que, quando não definimos algum fuso horário no argumento <code>tz</code>, a função <code>as.POSIXct()</code> vai automaticamente utilizar o fuso horário padrão de seu sistema operacional. No meu caso, esse fuso é o de São Paulo (o qual é equivalente ao fuso horário de Brasília).</p>
<p>O fuso horário de Brasília está a 3 desvios negativos do horário UTC, ou, dito de outra forma, está 3 horas atrasado em relação ao horário UTC. Tendo isso em mente, o instante “meia noite de 01 de janeiro de 1970” no horário de Brasília, está a 3 horas (ou a 10.800 segundos) de distância deste mesmo instante no horário UTC. Em outras palavras, o ano de 1970 começou oficialmente no Brasil, depois de 3 horas que ele já tinha começado no mundo como um todo.</p>
<p>Logo, lembre-se que valores do tipo <code>date-time</code> são armazenados como o número de segundos desde o instante “meia noite de 01 de janeiro de 1970” <strong>no horário UTC</strong>. Tanto que se eu recriar o objeto <code>ponto</code>, dessa vez utilizando o fuso horário UTC, ao retirarmos a sua classe podemos perceber abaixo que este ponto é armazenado pelo valor zero.</p>
<div class="sourceCode" id="cb2195"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2195-1"><a href="#cb2195-1" aria-hidden="true" tabindex="-1"></a>ponto <span class="ot">&lt;-</span> <span class="fu">as.POSIXct</span>(<span class="st">&quot;1970-01-01 00:00:00&quot;</span>, <span class="at">tz =</span> <span class="st">&quot;UTC&quot;</span>)</span>
<span id="cb2195-2"><a href="#cb2195-2" aria-hidden="true" tabindex="-1"></a><span class="fu">unclass</span>(ponto)</span></code></pre></div>
<pre><code>## [1] 0
## attr(,&quot;tzone&quot;)
## [1] &quot;UTC&quot;</code></pre>
<center>
<em>Exercício 2</em>
</center>
<p><strong>12.2)</strong> A primeira coisa que chama atenção nos valores do vetor <code>numero_no_excel</code> é que todos eles estão muito próximos do número 43881. Com algum tempo de reflexão, você pode acabar chegando a conclusão de que esses valores representam <strong>o número de dias desde a data de origem</strong>. Ou seja, enquanto no R, valores do tipo <code>date-time</code> são armazenados em segundos, esses mesmos valores são armazenados em dias no Excel.</p>
<div class="sourceCode" id="cb2197"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2197-1"><a href="#cb2197-1" aria-hidden="true" tabindex="-1"></a>numero_no_excel <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb2197-2"><a href="#cb2197-2" aria-hidden="true" tabindex="-1"></a>  <span class="fl">43881.1527777778</span>,</span>
<span id="cb2197-3"><a href="#cb2197-3" aria-hidden="true" tabindex="-1"></a>  <span class="fl">43881.15625</span>,</span>
<span id="cb2197-4"><a href="#cb2197-4" aria-hidden="true" tabindex="-1"></a>  <span class="fl">43881.159722222226</span>,</span>
<span id="cb2197-5"><a href="#cb2197-5" aria-hidden="true" tabindex="-1"></a>  <span class="fl">43881.1632060185</span>, </span>
<span id="cb2197-6"><a href="#cb2197-6" aria-hidden="true" tabindex="-1"></a>  <span class="fl">43881.1666666667</span></span>
<span id="cb2197-7"><a href="#cb2197-7" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>Por isso, ao fornecermos esses valores para a função <code>as.POSIXct()</code> precisamos converter esses valores para segundos (ao multiplicá-los pelo fator <span class="math inline">\(60 \times 60 \times 24\)</span>). Como foi destacado no enunciado, o Excel utiliza o dia 30 de dezembro de 1899 como o seu ponto de origem e, por isso, precisamos fornecer esse dia ao argumento <code>origin</code>. Dessa maneira, <code>as.POSIXct()</code> vai utilizar a data 30 de dezembro de 1899 (ao invés de 01 de janeiro de 1970) como base para calcular as datas.</p>
<p>Para mais, podemos configurar o argumento <code>tz</code> para o fuso UTC, com o objetivo de evitarmos possíveis ajustes automáticos adicionados aos valores, os quais podem ocorrer devido as diferenças entre o fuso horário de seu sistema operacional e o fuso UTC.</p>
<div class="sourceCode" id="cb2198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2198-1"><a href="#cb2198-1" aria-hidden="true" tabindex="-1"></a>ajuste <span class="ot">&lt;-</span> <span class="fu">as.POSIXct</span>(</span>
<span id="cb2198-2"><a href="#cb2198-2" aria-hidden="true" tabindex="-1"></a>  numero_no_excel <span class="sc">*</span> (<span class="dv">60</span> <span class="sc">*</span> <span class="dv">60</span> <span class="sc">*</span> <span class="dv">24</span>), </span>
<span id="cb2198-3"><a href="#cb2198-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">origin =</span> <span class="st">&quot;1899-12-30 00:00:00&quot;</span>,</span>
<span id="cb2198-4"><a href="#cb2198-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">tz =</span> <span class="st">&quot;UTC&quot;</span></span>
<span id="cb2198-5"><a href="#cb2198-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2198-6"><a href="#cb2198-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2198-7"><a href="#cb2198-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(ajuste)</span></code></pre></div>
<pre><code>## [1] &quot;2020-02-20 03:40:00 UTC&quot; &quot;2020-02-20 03:45:00 UTC&quot;
## [3] &quot;2020-02-20 03:50:00 UTC&quot; &quot;2020-02-20 03:55:00 UTC&quot;
## [5] &quot;2020-02-20 04:00:00 UTC&quot;</code></pre>
</div>
</div>
<div id="referências-9" class="section level1 unnumbered">
<h1 class="unnumbered">Referências</h1>
<div id="capítulo-14---funções" class="section level2 unlisted unnumbered">
<h2 class="unlisted unnumbered">Capítulo 14 - Funções</h2>
<center>
<em>Exercício 1</em>
</center>
<p><strong>14.1.A)</strong> Para aceitarmos um número variável de argumentos, precisamos utilizar o argumento especial <em>dot-dot-dot</em> (<code>...</code>). Em seguida, para incluir os argumentos dentro de uma lista, podemos apenas aplicar a função <code>list()</code> sobre o argumento especial. Com isso, temos a função <code>f()</code> abaixo:</p>
<div class="sourceCode" id="cb2200"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2200-1"><a href="#cb2200-1" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="cf">function</span>(...){</span>
<span id="cb2200-2"><a href="#cb2200-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(...))</span>
<span id="cb2200-3"><a href="#cb2200-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2200-4"><a href="#cb2200-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2200-5"><a href="#cb2200-5" aria-hidden="true" tabindex="-1"></a><span class="do">### 1 argumento:</span></span>
<span id="cb2200-6"><a href="#cb2200-6" aria-hidden="true" tabindex="-1"></a><span class="fu">f</span>(<span class="at">a =</span> <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## $a
## [1] 1</code></pre>
<div class="sourceCode" id="cb2202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2202-1"><a href="#cb2202-1" aria-hidden="true" tabindex="-1"></a><span class="do">### 3 argumentos:</span></span>
<span id="cb2202-2"><a href="#cb2202-2" aria-hidden="true" tabindex="-1"></a><span class="fu">f</span>(<span class="at">a =</span> <span class="dv">1</span>, <span class="at">b =</span> <span class="dv">2</span>, <span class="at">c =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>## $a
## [1] 1
## 
## $b
## [1] 2
## 
## $c
## [1] 3</code></pre>
<p><strong>14.1.B)</strong> A área de um círculo (<span class="math inline">\(A\)</span>) é definido como <span class="math inline">\(A = \pi \times r^2\)</span>, sendo <span class="math inline">\(\pi\)</span> o número pi, e <span class="math inline">\(r^2\)</span>, o raio elevado ao quadrado. Vale destacar que, o R já possui um objeto pré-definido chamado <code>pi</code>, que contém o número pi. Portanto, uma função que calcule essa equação seria:</p>
<div class="sourceCode" id="cb2204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2204-1"><a href="#cb2204-1" aria-hidden="true" tabindex="-1"></a>area_circulo <span class="ot">&lt;-</span> <span class="cf">function</span>(r){</span>
<span id="cb2204-2"><a href="#cb2204-2" aria-hidden="true" tabindex="-1"></a>  pi <span class="sc">*</span> (r <span class="sc">^</span> <span class="dv">2</span>)</span>
<span id="cb2204-3"><a href="#cb2204-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2204-4"><a href="#cb2204-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2204-5"><a href="#cb2204-5" aria-hidden="true" tabindex="-1"></a><span class="do">### A área de um círculo de raio 5</span></span>
<span id="cb2204-6"><a href="#cb2204-6" aria-hidden="true" tabindex="-1"></a><span class="fu">area_circulo</span>(<span class="dv">5</span>)</span></code></pre></div>
<pre><code>## [1] 78.53982</code></pre>
<center>
<em>Exercício 2</em>
</center>
<p><strong>14.2.)</strong> Existem algumas alternativas para construir tal função. Estou mostrando abaixo, uma dessas alternativas. Primeiro, precisamos pensar no input dessa função que estou dando o nome de <code>scrabble_score()</code>.</p>
<p>Essa função vai receber uma palavra, porém, a pontuação do jogo é baseada em letras, logo, precisamos de alguma forma separar as diferentes letras da palavra, em diferentes elementos de um vetor. Para isso, podemos utilizar a função <code>str_split()</code> do pacote <code>stringr</code>, que mostramos no capítulo 10.</p>
<div class="sourceCode" id="cb2206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2206-1"><a href="#cb2206-1" aria-hidden="true" tabindex="-1"></a>scrabble_score <span class="ot">&lt;-</span> <span class="cf">function</span>(palavra){</span>
<span id="cb2206-2"><a href="#cb2206-2" aria-hidden="true" tabindex="-1"></a>  letras <span class="ot">&lt;-</span> <span class="fu">unlist</span>(stringr<span class="sc">::</span><span class="fu">str_split</span>(palavra, <span class="st">&quot;&quot;</span>))</span>
<span id="cb2206-3"><a href="#cb2206-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(letras)</span>
<span id="cb2206-4"><a href="#cb2206-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2206-5"><a href="#cb2206-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2206-6"><a href="#cb2206-6" aria-hidden="true" tabindex="-1"></a><span class="fu">scrabble_score</span>(<span class="st">&quot;teste&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;t&quot; &quot;e&quot; &quot;s&quot; &quot;t&quot; &quot;e&quot;</code></pre>
<p>É possível que o usuário dessa função, acabe misturando letras maiúsculas e minúsculas dentro da palavra fornecida. Como é um pouco trabalhoso lidar com todas as diferentes possibilidades que surgem dessa mistura, seria uma boa ideia incluírmos uma correção sobre o input da função, com o objetivo de sempre transformar os caracteres da palavra para letras minúsculas. Para isso, temos a função <code>str_to_lower()</code> que também apresentamos no capítulo 10.</p>
<div class="sourceCode" id="cb2208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2208-1"><a href="#cb2208-1" aria-hidden="true" tabindex="-1"></a>scrabble_score <span class="ot">&lt;-</span> <span class="cf">function</span>(palavra){</span>
<span id="cb2208-2"><a href="#cb2208-2" aria-hidden="true" tabindex="-1"></a>  palavra <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_to_lower</span>(palavra)</span>
<span id="cb2208-3"><a href="#cb2208-3" aria-hidden="true" tabindex="-1"></a>  letras <span class="ot">&lt;-</span> <span class="fu">unlist</span>(stringr<span class="sc">::</span><span class="fu">str_split</span>(palavra, <span class="st">&quot;&quot;</span>))</span>
<span id="cb2208-4"><a href="#cb2208-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(letras)</span>
<span id="cb2208-5"><a href="#cb2208-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2208-6"><a href="#cb2208-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2208-7"><a href="#cb2208-7" aria-hidden="true" tabindex="-1"></a><span class="fu">scrabble_score</span>(<span class="st">&quot;TeStE&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;t&quot; &quot;e&quot; &quot;s&quot; &quot;t&quot; &quot;e&quot;</code></pre>
<p>Agora, precisamos adicionar um sistema que relaciona cada letra ao seu respectivo ponto. Uma forma eficiente de se implementar tal sistema é através de um <em>lookup vector</em>. No exemplo abaixo, tal <em>lookup vector</em> é o vetor <code>pontos</code>.</p>
<div class="sourceCode" id="cb2210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2210-1"><a href="#cb2210-1" aria-hidden="true" tabindex="-1"></a>scrabble_score <span class="ot">&lt;-</span> <span class="cf">function</span>(palavra){</span>
<span id="cb2210-2"><a href="#cb2210-2" aria-hidden="true" tabindex="-1"></a>  pontos <span class="ot">&lt;-</span> <span class="fu">rep.int</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="dv">8</span>, <span class="dv">10</span>), <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb2210-3"><a href="#cb2210-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(pontos) <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb2210-4"><a href="#cb2210-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;a&quot;</span>,<span class="st">&quot;e&quot;</span>,<span class="st">&quot;i&quot;</span>,<span class="st">&quot;o&quot;</span>,<span class="st">&quot;u&quot;</span>,<span class="st">&quot;l&quot;</span>,<span class="st">&quot;n&quot;</span>,<span class="st">&quot;r&quot;</span>,<span class="st">&quot;s&quot;</span>,<span class="st">&quot;t&quot;</span>,</span>
<span id="cb2210-5"><a href="#cb2210-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;d&quot;</span>,<span class="st">&quot;g&quot;</span>,</span>
<span id="cb2210-6"><a href="#cb2210-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;b&quot;</span>,<span class="st">&quot;c&quot;</span>,<span class="st">&quot;m&quot;</span>,<span class="st">&quot;p&quot;</span>,</span>
<span id="cb2210-7"><a href="#cb2210-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;f&quot;</span>,<span class="st">&quot;h&quot;</span>,<span class="st">&quot;v&quot;</span>,<span class="st">&quot;w&quot;</span>,<span class="st">&quot;y&quot;</span>,</span>
<span id="cb2210-8"><a href="#cb2210-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;k&quot;</span>,</span>
<span id="cb2210-9"><a href="#cb2210-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;j&quot;</span>,<span class="st">&quot;x&quot;</span>,</span>
<span id="cb2210-10"><a href="#cb2210-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;q&quot;</span>,<span class="st">&quot;z&quot;</span></span>
<span id="cb2210-11"><a href="#cb2210-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb2210-12"><a href="#cb2210-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2210-13"><a href="#cb2210-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2210-14"><a href="#cb2210-14" aria-hidden="true" tabindex="-1"></a>  palavra <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_to_lower</span>(palavra)</span>
<span id="cb2210-15"><a href="#cb2210-15" aria-hidden="true" tabindex="-1"></a>  letras <span class="ot">&lt;-</span> <span class="fu">unlist</span>(stringr<span class="sc">::</span><span class="fu">str_split</span>(palavra, <span class="st">&quot;&quot;</span>))</span>
<span id="cb2210-16"><a href="#cb2210-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2210-17"><a href="#cb2210-17" aria-hidden="true" tabindex="-1"></a>  total <span class="ot">&lt;-</span> <span class="fu">unname</span>(pontos[letras])</span>
<span id="cb2210-18"><a href="#cb2210-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2210-19"><a href="#cb2210-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(total)</span>
<span id="cb2210-20"><a href="#cb2210-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2210-21"><a href="#cb2210-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2210-22"><a href="#cb2210-22" aria-hidden="true" tabindex="-1"></a><span class="fu">scrabble_score</span>(<span class="st">&quot;yamandu&quot;</span>)</span></code></pre></div>
<pre><code>## [1] 4 1 3 1 1 2 1</code></pre>
<p>Por último, precisamos apenas somar esse vetor de pontos armazenados no objeto <code>total</code>, como demonstrado abaixo.</p>
<div class="sourceCode" id="cb2212"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2212-1"><a href="#cb2212-1" aria-hidden="true" tabindex="-1"></a>scrabble_score <span class="ot">&lt;-</span> <span class="cf">function</span>(palavra){</span>
<span id="cb2212-2"><a href="#cb2212-2" aria-hidden="true" tabindex="-1"></a>  pontos <span class="ot">&lt;-</span> <span class="fu">rep.int</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="dv">8</span>, <span class="dv">10</span>), <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb2212-3"><a href="#cb2212-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(pontos) <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb2212-4"><a href="#cb2212-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;a&quot;</span>,<span class="st">&quot;e&quot;</span>,<span class="st">&quot;i&quot;</span>,<span class="st">&quot;o&quot;</span>,<span class="st">&quot;u&quot;</span>,<span class="st">&quot;l&quot;</span>,<span class="st">&quot;n&quot;</span>,<span class="st">&quot;r&quot;</span>,<span class="st">&quot;s&quot;</span>,<span class="st">&quot;t&quot;</span>,</span>
<span id="cb2212-5"><a href="#cb2212-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;d&quot;</span>,<span class="st">&quot;g&quot;</span>,</span>
<span id="cb2212-6"><a href="#cb2212-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;b&quot;</span>,<span class="st">&quot;c&quot;</span>,<span class="st">&quot;m&quot;</span>,<span class="st">&quot;p&quot;</span>,</span>
<span id="cb2212-7"><a href="#cb2212-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;f&quot;</span>,<span class="st">&quot;h&quot;</span>,<span class="st">&quot;v&quot;</span>,<span class="st">&quot;w&quot;</span>,<span class="st">&quot;y&quot;</span>,</span>
<span id="cb2212-8"><a href="#cb2212-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;k&quot;</span>,</span>
<span id="cb2212-9"><a href="#cb2212-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;j&quot;</span>,<span class="st">&quot;x&quot;</span>,</span>
<span id="cb2212-10"><a href="#cb2212-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;q&quot;</span>,<span class="st">&quot;z&quot;</span></span>
<span id="cb2212-11"><a href="#cb2212-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb2212-12"><a href="#cb2212-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2212-13"><a href="#cb2212-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2212-14"><a href="#cb2212-14" aria-hidden="true" tabindex="-1"></a>  palavra <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_to_lower</span>(palavra)</span>
<span id="cb2212-15"><a href="#cb2212-15" aria-hidden="true" tabindex="-1"></a>  letras <span class="ot">&lt;-</span> <span class="fu">unlist</span>(stringr<span class="sc">::</span><span class="fu">str_split</span>(palavra, <span class="st">&quot;&quot;</span>))</span>
<span id="cb2212-16"><a href="#cb2212-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2212-17"><a href="#cb2212-17" aria-hidden="true" tabindex="-1"></a>  total <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">unname</span>(pontos[letras]), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2212-18"><a href="#cb2212-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2212-19"><a href="#cb2212-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(total)</span>
<span id="cb2212-20"><a href="#cb2212-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2212-21"><a href="#cb2212-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2212-22"><a href="#cb2212-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2212-23"><a href="#cb2212-23" aria-hidden="true" tabindex="-1"></a><span class="fu">scrabble_score</span>(<span class="st">&quot;yamandu&quot;</span>)</span></code></pre></div>
<pre><code>## [1] 13</code></pre>
<p>Para confirmar que essa função está funcionando corretamente, podemos aplicá-la sobre cada elemento do vetor <code>w</code>, e conferir os resultados. Perceba abaixo, que os resultados são idênticos aos elementos do vetor <code>p</code> mostrado na questão.</p>
<div class="sourceCode" id="cb2214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2214-1"><a href="#cb2214-1" aria-hidden="true" tabindex="-1"></a>w <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;isabela&quot;</span>, <span class="st">&quot;caderno&quot;</span>, <span class="st">&quot;mouse&quot;</span>, <span class="st">&quot;elevador&quot;</span>,</span>
<span id="cb2214-2"><a href="#cb2214-2" aria-hidden="true" tabindex="-1"></a>       <span class="st">&quot;solar&quot;</span>, <span class="st">&quot;gaveta&quot;</span>, <span class="st">&quot;porta&quot;</span>, <span class="st">&quot;eduardo&quot;</span>)</span>
<span id="cb2214-3"><a href="#cb2214-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2214-4"><a href="#cb2214-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2214-5"><a href="#cb2214-5" aria-hidden="true" tabindex="-1"></a>vec <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">&quot;double&quot;</span>, <span class="at">length =</span> <span class="fu">length</span>(w))</span>
<span id="cb2214-6"><a href="#cb2214-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_along</span>(w)){</span>
<span id="cb2214-7"><a href="#cb2214-7" aria-hidden="true" tabindex="-1"></a>  vec[i] <span class="ot">&lt;-</span> <span class="fu">scrabble_score</span>(w[i])</span>
<span id="cb2214-8"><a href="#cb2214-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2214-9"><a href="#cb2214-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2214-10"><a href="#cb2214-10" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(vec)</span></code></pre></div>
<pre><code>## [1]  9 10  7 12  5 10  7  9</code></pre>
</div>
</div>
<div id="referências-10" class="section level1 unnumbered">
<h1 class="unnumbered">Referências</h1>
<div id="capítulo-15---loops" class="section level2 unlisted unnumbered">
<h2 class="unlisted unnumbered">Capítulo 15 - <em>Loops</em></h2>
<center>
<em>Exercício 1</em>
</center>
<p><strong>15.1.A)</strong> A resposta curta é: nada! Nada ocorre se executarmos o <code>for</code> <em>loop</em> abaixo. Tal fato ocorre, pois o objeto <code>x</code> é um vetor vazio. Ou seja, ele possui 0 elementos.</p>
<div class="sourceCode" id="cb2216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2216-1"><a href="#cb2216-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">&quot;integer&quot;</span>)</span>
<span id="cb2216-2"><a href="#cb2216-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2216-3"><a href="#cb2216-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_along</span>(x)){</span>
<span id="cb2216-4"><a href="#cb2216-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(i)</span>
<span id="cb2216-5"><a href="#cb2216-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Na seção “Descrevendo <code>for</code> <em>loops</em>” nós destacamos que a quantidade de repetições que são executadas por um <code>for</code> <em>loop</em>, depende diretamente no número de elementos que o objeto contido na definição deste <em>loop</em> possui. Como o objeto <code>x</code> possui 0 elementos, o <code>for</code> <em>loop</em> vai executar 0 repetições.</p>
<p><strong>15.1.B)</strong> O <em>loop</em> abaixo é um <em>loop</em> infinito devido ao <code>if</code> <em>statement</em> que está presente em seu corpo. Primeiro, a condição lógica que rege o while loop abaixo é <code>x &lt; 10</code>. Portanto, para que este while loop pare a sua execução em algum momento, o objeto <code>x</code> deve conter um valor maior ou igual a 10.</p>
<p>A expressão <code>x &lt;- x + 1</code> garante que o valor armazenado nesse objeto <code>x</code> aumente a cada repetição do <em>loop</em>. Contudo, o <code>if</code> <em>statement</em> analisa a condição lógica <code>x %% 5 == 0</code>. Por causa dessa condição, assim que o objeto <code>x</code> atingir o primeiro número múltiplo de 5 (que neste caso é o próprio 5), o <code>if</code> <em>statement</em> vai resetar o objeto <code>x</code> para o seu estado inicial, ao executar a expressão <code>x &lt;- 1</code>.</p>
<p>Portanto, todo esse processo se repete. O loop vai aumentando o valor de <code>x</code>, porém, assim que esse objeto atinge o número 5, ele é resetado de volta para o valor 1, e, por isso, o loop continua executando os comandos de seu <em>body</em> indefinidamente.</p>
<div class="sourceCode" id="cb2217"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2217-1"><a href="#cb2217-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb2217-2"><a href="#cb2217-2" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> ( x <span class="sc">&lt;</span> <span class="dv">10</span> ) {</span>
<span id="cb2217-3"><a href="#cb2217-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(x)</span>
<span id="cb2217-4"><a href="#cb2217-4" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> x <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb2217-5"><a href="#cb2217-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (x <span class="sc">%%</span> <span class="dv">5</span> <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb2217-6"><a href="#cb2217-6" aria-hidden="true" tabindex="-1"></a>    x <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb2217-7"><a href="#cb2217-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2217-8"><a href="#cb2217-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>15.1.C)</strong> Lembre-se que, o número de repetições executadas por um <code>for</code> <em>loop</em>, depende diretamente do número de elementos presentes no objeto que você fornece na definição deste <code>loop</code>.</p>
<div class="sourceCode" id="cb2218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2218-1"><a href="#cb2218-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">id =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span>
<span id="cb2218-2"><a href="#cb2218-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(name <span class="cf">in</span> letters[<span class="dv">1</span><span class="sc">:</span><span class="dv">24</span>]){</span>
<span id="cb2218-3"><a href="#cb2218-3" aria-hidden="true" tabindex="-1"></a>  df[[name]] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb2218-4"><a href="#cb2218-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>No exemplo desta questão, esse objeto é <code>letters[1:24]</code>. Portanto, para descobrirmos o número de repetições executadas por este <em>loop</em>, podemos executar o comando <code>length(letters[1:24])</code>. Perceba pelo resultado abaixo, que são 24 repetições executadas pelo <em>loop</em>.</p>
<div class="sourceCode" id="cb2219"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2219-1"><a href="#cb2219-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(letters[<span class="dv">1</span><span class="sc">:</span><span class="dv">24</span>])</span></code></pre></div>
<pre><code>## [1] 24</code></pre>
<p><strong>15.1.D)</strong> A expressão <code>1:length(y)</code> determina os valores que o iterador (<code>i</code>) vai assumir ao longo do <em>loop</em> abaixo.</p>
<div class="sourceCode" id="cb2221"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2221-1"><a href="#cb2221-1" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">&quot;integer&quot;</span>)</span>
<span id="cb2221-2"><a href="#cb2221-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span></span>
<span id="cb2221-3"><a href="#cb2221-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(y)){</span>
<span id="cb2221-4"><a href="#cb2221-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(x[i] <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb2221-5"><a href="#cb2221-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## [1] 2
## numeric(0)</code></pre>
<p>Se executarmos essa expressão de maneira separada, podemos descobrir que valores são esses. Porém, perceba abaixo, que o resultado dessa expressão é um vetor contendo os números 1 e 0. O zero em questão, é resultado de <code>length(y)</code>. Isso significa que o vetor <code>y</code> é um vetor vazio (em outras palavras, ele possui 0 elementos).</p>
<div class="sourceCode" id="cb2223"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2223-1"><a href="#cb2223-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(y)</span></code></pre></div>
<pre><code>## [1] 1 0</code></pre>
<p>Por causa disso, o <code>for</code> <em>loop</em> acima acaba executando a expressão <code>x[0] + 1</code> na segunda repetição do <em>loop</em>. Contudo, nunca existe um elemento 0 em qualquer objeto, pois índices no R começam a partir do número 1. Em outras palavras, uma expressão como <code>objeto[0]</code> vai sempre retornar um vetor vazio como resultado. Logo, um vetor vazio somado de 1 (isto é, a expressão <code>numeric(0) + 1</code>) é igual a um novo vetor vazio. Por esse motivo, que um vetor vazio foi retornado na segunda repetição do <em>loop</em>.</p>
<center>
<em>Exercício 2</em>
</center>
<p><strong>15.2)</strong> Primeiro, precisamos de um for loop que visite cada um dos elementos do vetor <code>vec</code>.</p>
<div class="sourceCode" id="cb2225"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2225-1"><a href="#cb2225-1" aria-hidden="true" tabindex="-1"></a>vec <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb2225-2"><a href="#cb2225-2" aria-hidden="true" tabindex="-1"></a>  <span class="fl">5.2</span>, <span class="fl">6.1</span>, <span class="fl">2.3</span>, <span class="fl">7.4</span>, <span class="fl">1.1</span>, <span class="fl">3.6</span>,</span>
<span id="cb2225-3"><a href="#cb2225-3" aria-hidden="true" tabindex="-1"></a>  <span class="fl">7.2</span>, <span class="fl">8.1</span>, <span class="fl">3.3</span>, <span class="fl">4.5</span>, <span class="fl">0.8</span>, <span class="fl">5.4</span></span>
<span id="cb2225-4"><a href="#cb2225-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2225-5"><a href="#cb2225-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2225-6"><a href="#cb2225-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_along</span>(vec)){</span>
<span id="cb2225-7"><a href="#cb2225-7" aria-hidden="true" tabindex="-1"></a>  <span class="do">### Acessando cada elemento de vec</span></span>
<span id="cb2225-8"><a href="#cb2225-8" aria-hidden="true" tabindex="-1"></a>  vec[i]</span>
<span id="cb2225-9"><a href="#cb2225-9" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Para encontrarmos o valor máximo em <code>vec</code>, vamos basicamente, armazenar o primeiro elemento de <code>vec</code> em um objeto chamado <code>x</code>, e, ao longo do <em>loop</em>, vamos comparar cada elemento de <code>vec</code> a este objeto <code>x</code>. Caso o valor do elemento em que estamos no momento, for maior que o valor do objeto <code>x</code>, vamos redefinir o objeto <code>x</code> para este valor, e, prosseguir com o loop, comparando o próximo elemento com o valor do objeto <code>x</code>.</p>
<div class="sourceCode" id="cb2226"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2226-1"><a href="#cb2226-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> vec[<span class="dv">1</span>]</span>
<span id="cb2226-2"><a href="#cb2226-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_along</span>(vec)){</span>
<span id="cb2226-3"><a href="#cb2226-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(vec[i] <span class="sc">&gt;</span> x){</span>
<span id="cb2226-4"><a href="#cb2226-4" aria-hidden="true" tabindex="-1"></a>    x <span class="ot">&lt;-</span> vec[i]</span>
<span id="cb2226-5"><a href="#cb2226-5" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2226-6"><a href="#cb2226-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2226-7"><a href="#cb2226-7" aria-hidden="true" tabindex="-1"></a><span class="do">### Após a execução do loop, temos o valor máximo de vec:</span></span>
<span id="cb2226-8"><a href="#cb2226-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(x)</span></code></pre></div>
<pre><code>## [1] 8.1</code></pre>
<div class="sourceCode" id="cb2228"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2228-1"><a href="#cb2228-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Perceba que a função max() retorna o mesmo resultado:</span></span>
<span id="cb2228-2"><a href="#cb2228-2" aria-hidden="true" tabindex="-1"></a><span class="fu">max</span>(vec)</span></code></pre></div>
<pre><code>## [1] 8.1</code></pre>
<center>
<em>Exercício 3</em>
</center>
<p><strong>15.3)</strong> Recapitulando, temos a matriz <code>mt</code> abaixo, e desejamos preencher cada elemento desta matriz, com o resultado da multiplicação entre os índice que localizam o respectivo elemento. Repare que esse objeto <code>mt</code> é uma matriz de 30 linhas e 30 colunas.</p>
<div class="sourceCode" id="cb2230"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2230-1"><a href="#cb2230-1" aria-hidden="true" tabindex="-1"></a>mt <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">ncol =</span> <span class="dv">30</span>, <span class="at">nrow =</span> <span class="dv">30</span>)</span></code></pre></div>
<p>Primeiro, vamos criar um <em>loop</em> que visita cada linha dessa matriz, como demonstrado abaixo:</p>
<div class="sourceCode" id="cb2231"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2231-1"><a href="#cb2231-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(mt)) {</span>
<span id="cb2231-2"><a href="#cb2231-2" aria-hidden="true" tabindex="-1"></a>  <span class="do">### Corpo do loop:</span></span>
<span id="cb2231-3"><a href="#cb2231-3" aria-hidden="true" tabindex="-1"></a>  mt[i, ]</span>
<span id="cb2231-4"><a href="#cb2231-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Agora, para cada linha da matriz <code>mt</code>, desejamos visitar cada uma das 30 colunas. Por isso, precisamos incluir um novo <em>loop</em> dentro do <em>loop</em> atual. Dessa forma, esse segundo <em>loop</em> será responsável por navegar ao longo das colunas desta matriz.</p>
<p>O iterador do primeiro <em>loop</em> é o objeto <code>i</code>, enquanto o iterador do segundo <em>loop</em> é o objeto <code>j</code>. Para cada repetição do primeiro <em>loop</em> (ou para cada valor assumido por <code>i</code>), o segundo <em>loop</em> é executado por completo (ou seja, todas as 30 repetições são executadas).</p>
<div class="sourceCode" id="cb2232"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2232-1"><a href="#cb2232-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(mt)) {</span>
<span id="cb2232-2"><a href="#cb2232-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(mt)) {</span>
<span id="cb2232-3"><a href="#cb2232-3" aria-hidden="true" tabindex="-1"></a>    mt[i, j]</span>
<span id="cb2232-4"><a href="#cb2232-4" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2232-5"><a href="#cb2232-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Por último, precisamos apenas salvar em cada elemento visitado, o resultado da multiplicação dos iteradores desses dois <em>loops</em>, como demonstrado abaixo.</p>
<div class="sourceCode" id="cb2233"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2233-1"><a href="#cb2233-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(mt)) {</span>
<span id="cb2233-2"><a href="#cb2233-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(mt)) {</span>
<span id="cb2233-3"><a href="#cb2233-3" aria-hidden="true" tabindex="-1"></a>    mt[i, j] <span class="ot">&lt;-</span> i <span class="sc">*</span> j</span>
<span id="cb2233-4"><a href="#cb2233-4" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2233-5"><a href="#cb2233-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Podemos visualizar abaixo, as 5 primeiras linhas das 5 primeiras colunas dessa matriz <code>mt</code> após a execução do <em>loop</em> aninhado.</p>
<div class="sourceCode" id="cb2234"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2234-1"><a href="#cb2234-1" aria-hidden="true" tabindex="-1"></a>mt[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span></code></pre></div>
<pre><code>##      [,1] [,2] [,3] [,4] [,5]
## [1,]    1    2    3    4    5
## [2,]    2    4    6    8   10
## [3,]    3    6    9   12   15
## [4,]    4    8   12   16   20
## [5,]    5   10   15   20   25</code></pre>
</div>
</div>
<div id="referências-11" class="section level1 unnumbered">
<h1 class="unnumbered">Referências</h1>
<div id="capítulo-16---functional-programming-com-purrr" class="section level2 unlisted unnumbered">
<h2 class="unlisted unnumbered">Capítulo 16 - <em>Functional programming</em> com <code>purrr</code></h2>
<center>
<em>Exercício 1</em>
</center>
<p><strong>16.1.A)</strong> Como desejamos calcular a média apenas das colunas númericas da tabela <code>diamonds</code>, podemos primeiro selecionar essas colunas específicas, antes de executar a função <code>map_dbl()</code>. Para isso, podemos utilizar a função <code>select()</code> que introduzimos no capítulo 5. Para selecionarmos todas as colunas numéricas, utilizamos a função <code>where()</code> dentro de <code>select()</code>, como demonstrado abaixo:</p>
<div class="sourceCode" id="cb2236"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2236-1"><a href="#cb2236-1" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span>diamonds <span class="sc">%&gt;%</span> </span>
<span id="cb2236-2"><a href="#cb2236-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">where</span>(is.numeric))</span></code></pre></div>
<pre><code>## # A tibble: 53,940 x 7
##    carat depth table price     x     y     z
##    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1  0.23  61.5    55   326  3.95  3.98  2.43
##  2  0.21  59.8    61   326  3.89  3.84  2.31
##  3  0.23  56.9    65   327  4.05  4.07  2.31
##  4  0.29  62.4    58   334  4.2   4.23  2.63
##  5  0.31  63.3    58   335  4.34  4.35  2.75
##  6  0.24  62.8    57   336  3.94  3.96  2.48
##  7  0.24  62.3    57   336  3.95  3.98  2.47
##  8  0.26  61.9    55   337  4.07  4.11  2.53
##  9  0.22  65.1    61   337  3.87  3.78  2.49
## 10  0.23  59.4    61   338  4     4.05  2.39
## # ... with 53,930 more rows</code></pre>
<p>Agora que temos todas as colunas numéricas da tabela, podemos repassar esse resultado para a função <code>map_dbl()</code>, e, pedir a ela que aplique a função <code>mean()</code> sobre cada coluna.</p>
<div class="sourceCode" id="cb2238"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2238-1"><a href="#cb2238-1" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span>diamonds <span class="sc">%&gt;%</span> </span>
<span id="cb2238-2"><a href="#cb2238-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">where</span>(is.numeric)) <span class="sc">%&gt;%</span> </span>
<span id="cb2238-3"><a href="#cb2238-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map_dbl</span>(mean)</span></code></pre></div>
<pre><code>##        carat        depth        table        price            x 
##    0.7979397   61.7494049   57.4571839 3932.7997219    5.7311572 
##            y            z 
##    5.7345260    3.5387338</code></pre>
<p><strong>16.1.B)</strong> Podemos utilizar basicamente o mesmo processo do item anterior para responder esta questão. Basta selecionarmos todas as colunas não numéricas da tabela <code>diamonds</code> e, repassarmos o resultado para uma função <code>map</code>.</p>
<p>Para selecionarmos todas as colunas não numéricas, podemos apenas inverter o teste lógico (com o operador <code>!</code>) que utilizamos dentro da função <code>where()</code> para descobrirmos todas as colunas não numéricas.</p>
<div class="sourceCode" id="cb2240"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2240-1"><a href="#cb2240-1" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span>diamonds <span class="sc">%&gt;%</span> </span>
<span id="cb2240-2"><a href="#cb2240-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">where</span>(<span class="sc">~!</span><span class="fu">is.numeric</span>(.)))</span></code></pre></div>
<pre><code>## # A tibble: 53,940 x 3
##    cut       color clarity
##    &lt;ord&gt;     &lt;ord&gt; &lt;ord&gt;  
##  1 Ideal     E     SI2    
##  2 Premium   E     SI1    
##  3 Good      E     VS1    
##  4 Premium   I     VS2    
##  5 Good      J     SI2    
##  6 Very Good J     VVS2   
##  7 Very Good I     VVS1   
##  8 Very Good H     SI1    
##  9 Fair      E     VS2    
## 10 Very Good H     VS1    
## # ... with 53,930 more rows</code></pre>
<p>Por último, repassamos o resultado para <code>map()</code> abaixo, e pedimos a essa função que aplique a função <code>dplyr::n_distinct()</code> sobre cada coluna.</p>
<div class="sourceCode" id="cb2242"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2242-1"><a href="#cb2242-1" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span>diamonds <span class="sc">%&gt;%</span> </span>
<span id="cb2242-2"><a href="#cb2242-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">where</span>(<span class="sc">~!</span><span class="fu">is.numeric</span>(.))) <span class="sc">%&gt;%</span>  </span>
<span id="cb2242-3"><a href="#cb2242-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(dplyr<span class="sc">::</span>n_distinct)</span></code></pre></div>
<pre><code>## $cut
## [1] 5
## 
## $color
## [1] 7
## 
## $clarity
## [1] 8</code></pre>
<center>
<em>Exercício 2</em>
</center>
<p><strong>16.2.A)</strong> Toda função <code>map</code> vai aplicar a função definida em seu segundo argumento, sobre cada elemento do objeto definido em seu primeiro argumento. Portanto, no comando <code>map(1:5, rnorm)</code>, a função <code>map()</code> vai aplicar a função <code>rnorm()</code> sobre cada elemento do vetor resultante de <code>1:5</code>.</p>
<p>Sendo assim, o primeiro resultado gerado por <code>map(1:5, rnorm)</code> é o resultado do comando <code>rnorm(1)</code>; já o segundo resultado é equivalente ao comando <code>rnorm(2)</code>; enquanto o terceiro resultado, equivale a <code>rnorm(3)</code>; e assim por diante.</p>
<p>Como o primeiro argumento (<code>n</code>) de <code>rnorm()</code> define a quantidade de valores que serão gerados pela função, a cada iteração de <code>map()</code>, uma quantidade diferente de valores são gerados pela função <code>rnorm()</code>.</p>
<p><strong>16.2.B)</strong> Como descrevemos no item anterior, toda função <code>map</code> vai aplicar a função definida em seu segundo argumento, sobre cada elemento do objeto definido em seu primeiro argumento. Porém, todo argumento que é definido em argumentos posteriores ao segundo argumento da função, são iterpretados como argumentos estáticos.</p>
<p>Isso significa que, o terceiro argumento <code>n = 5</code> é sempre repassado para a função <code>rnorm()</code>. Portanto, se no item anterior, estávamos executando os comandos <code>rnorm(1)</code>, <code>rnorm(2)</code>, etc., neste item, estamos executando os comandos <code>rnorm(n = 5, 1)</code>, <code>rnorm(n = 5, 2)</code>, etc.</p>
<p>Por esse motivo, a funçao <code>rnorm()</code> sempre gera 5 valores diferentes a cada iteração da função <code>map()</code>. Por outro lado, cada elemento do vetor resultante de <code>1:5</code>, são interpretados como o segundo argumento de <code>rnorm()</code> (pois o primeiro argumento dessa função - <code>n</code>, já foi definido em <code>n = 5</code>), o qual define a média aproximada dos valores gerados pela função.</p>
<p>Ou seja, o número de valores gerados a cada iteração de <code>map()</code> permanece o mesmo. Contudo, a média estimada desses valores está mudando a cada iteração.</p>
<center>
<em>Exercício 3</em>
</center>
<p><strong>16.3.A)</strong> Para descobrirmos o comprimento de um dado elemento de <code>l</code> podemos aplicar a função <code>length()</code> sobre este elemento. Consequentemente, para descobrirmos se esse elemento possui comprimento maior que 3, podemos simplesmente aplicar o teste <code>length(x) &gt; 3</code> sobre cada elemento (<code>x</code>).</p>
<p>Você pode realizar esse trabalho de duas maneiras. Primeiro, você pode coletar o comprimento de todos os elementos da lista <code>l</code>, com o comando <code>map_int(l, length)</code>, e, em seguida, aplicar o teste lógico de “maior que 3” sobre o resultado desse comando, como demonstrado abaixo.</p>
<div class="sourceCode" id="cb2244"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2244-1"><a href="#cb2244-1" aria-hidden="true" tabindex="-1"></a>l <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb2244-2"><a href="#cb2244-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">5</span>),</span>
<span id="cb2244-3"><a href="#cb2244-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">1</span>),</span>
<span id="cb2244-4"><a href="#cb2244-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="dv">9</span>, <span class="dv">8</span>, <span class="dv">9</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb2244-5"><a href="#cb2244-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="dv">7</span>, <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">2</span>),</span>
<span id="cb2244-6"><a href="#cb2244-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">5</span>)</span>
<span id="cb2244-7"><a href="#cb2244-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2244-8"><a href="#cb2244-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2244-9"><a href="#cb2244-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2244-10"><a href="#cb2244-10" aria-hidden="true" tabindex="-1"></a><span class="fu">map_int</span>(l, length) <span class="sc">&gt;</span> <span class="dv">3</span></span></code></pre></div>
<pre><code>## [1] FALSE FALSE  TRUE  TRUE FALSE</code></pre>
<p>Uma outra forma, seria incluir todo o teste lógico dentro da função <code>map</code>. Dessa forma, estamos aplicando o comando <code>length(x) &gt; 3</code> sobre cada elemento da lista <code>l</code>.</p>
<div class="sourceCode" id="cb2246"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2246-1"><a href="#cb2246-1" aria-hidden="true" tabindex="-1"></a><span class="fu">map_lgl</span>(l, <span class="sc">~</span><span class="fu">length</span>(.) <span class="sc">&gt;</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>## [1] FALSE FALSE  TRUE  TRUE FALSE</code></pre>
<p>Possuindo os resultados do teste lógico em mãos, basta repassá-lo para a função de <em>subsetting</em>.</p>
<div class="sourceCode" id="cb2248"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2248-1"><a href="#cb2248-1" aria-hidden="true" tabindex="-1"></a>l[ <span class="fu">map_lgl</span>(l, <span class="sc">~</span><span class="fu">length</span>(.) <span class="sc">&gt;</span> <span class="dv">3</span>) ]</span></code></pre></div>
<pre><code>## [[1]]
## [1] 9 8 9 0 0 1
## 
## [[2]]
## [1] 7 4 4 2</code></pre>
<p><strong>16.3.B)</strong> Para descobrirmos quais elementos de <code>l</code> possuem valores <code>NA</code>, precisamos primeiro aplicar a função <code>is.na()</code> sobre cada elemento de <code>l</code>. Porém, perceba abaixo que essa função nos retorna um vetor para cada elemento de <code>l</code>.</p>
<div class="sourceCode" id="cb2250"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2250-1"><a href="#cb2250-1" aria-hidden="true" tabindex="-1"></a>l <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb2250-2"><a href="#cb2250-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>),</span>
<span id="cb2250-3"><a href="#cb2250-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="dv">6</span>, <span class="dv">7</span>, <span class="cn">NA</span>, <span class="dv">9</span>),</span>
<span id="cb2250-4"><a href="#cb2250-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="cn">NA</span>, <span class="cn">NA</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">4</span>),</span>
<span id="cb2250-5"><a href="#cb2250-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">8</span>),</span>
<span id="cb2250-6"><a href="#cb2250-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="dv">6</span>, <span class="dv">6</span>, <span class="dv">6</span>)</span>
<span id="cb2250-7"><a href="#cb2250-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2250-8"><a href="#cb2250-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2250-9"><a href="#cb2250-9" aria-hidden="true" tabindex="-1"></a><span class="fu">map</span>(l, is.na)</span></code></pre></div>
<pre><code>## [[1]]
## [1] FALSE FALSE FALSE
## 
## [[2]]
## [1] FALSE FALSE  TRUE FALSE
## 
## [[3]]
## [1]  TRUE  TRUE FALSE FALSE FALSE
## 
## [[4]]
## [1] FALSE FALSE FALSE FALSE
## 
## [[5]]
## [1] FALSE FALSE FALSE</code></pre>
<p>Precisamos reduzir os resultados dessa função para um único valor para cada elemento de <code>l</code>. Para isso, podemos aplicar a função <code>any()</code> sobre os resultados de <code>is.na()</code>. Com isso, temos um vetor do tipo <code>logical</code>, que indica se cada elemento de <code>l</code> possui pelo menos 1 valor <code>NA</code>.</p>
<div class="sourceCode" id="cb2252"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2252-1"><a href="#cb2252-1" aria-hidden="true" tabindex="-1"></a><span class="fu">map_lgl</span>(l, <span class="sc">~</span><span class="fu">any</span>(<span class="fu">is.na</span>(.)))</span></code></pre></div>
<pre><code>## [1] FALSE  TRUE  TRUE FALSE FALSE</code></pre>
<p>Porém, o objetivo deste item é filtrar todos os elementos de <code>l</code> que <strong>não possuem</strong> algum valor <code>NA</code>. Portanto, precisamos inverter esse teste lógico, com o operador <code>!</code>, como demonstrado abaixo:</p>
<div class="sourceCode" id="cb2254"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2254-1"><a href="#cb2254-1" aria-hidden="true" tabindex="-1"></a><span class="fu">map_lgl</span>(l, <span class="sc">~!</span><span class="fu">any</span>(<span class="fu">is.na</span>(.)))</span></code></pre></div>
<pre><code>## [1]  TRUE FALSE FALSE  TRUE  TRUE</code></pre>
<p>Agora que temos os resultados do teste lógico que precisávamos, podemos repassar esses resultados para a função de <em>subsetting</em>. Sendo assim, temos todos os elementos de <code>l</code> que não possuem algum valor <code>NA</code>.</p>
<div class="sourceCode" id="cb2256"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2256-1"><a href="#cb2256-1" aria-hidden="true" tabindex="-1"></a>l[ <span class="fu">map_lgl</span>(l, <span class="sc">~</span><span class="fu">any</span>(<span class="fu">is.na</span>(.))) ]</span></code></pre></div>
<pre><code>## [[1]]
## [1]  6  7 NA  9
## 
## [[2]]
## [1] NA NA  1  3  4</code></pre>
</div>
</div>
<div id="referências-12" class="section level1 unnumbered">
<h1 class="unnumbered">Referências</h1>
<div id="capítulo-18---environments-ou-ambientes-no-r" class="section level2 unlisted unnumbered">
<h2 class="unlisted unnumbered">Capítulo 18 - <em>Environments</em> ou ambientes no R</h2>
<center>
<em>Exercício 1</em>
</center>
<p><strong>18.1.A)</strong> Antes de tudo, vale reforçar que, em toda expressão que inclui o operador de <em>super-assignment</em> (<code>&lt;&lt;-</code>), existe uma diferença importante entre os objetos que estão à direita do operador, e os objetos que estão à esquerda do mesmo.</p>
<p>Por exemplo, em uma expressão como <code>x &lt;&lt;- y + z</code>, o R procura os objetos que estão à direita do operador (<code>y</code> e <code>z</code>) da mesma que forma que faria nos demais tipos de expressão (isto é, ele segue as regras de <em>scoping</em>). Logo, ele procura no <em>environment</em> atual, depois, sobe a árvore genealógica até atingir o <em>global environment</em>, em seguida, sobe o <em>search path</em> de sua sessão.</p>
<p>Em contrapartida, ao procurar pelo objeto que está à esquerda do operador (<code>x</code>), o R segue as regras que descrevemos na sessão 18.8 a respeito do operador de <em>super-assignment</em>. Portanto, o R procura por <code>x</code> no <em>parent environment</em>, caso ele não encontre esse objeto lá, ele então realiza o <em>assignment</em> dentro de seu <em>global environment</em> <span class="citation">(<a href="#ref-Rlanguage" role="doc-biblioref">R Core Team 2020b</a>)</span>.</p>
<p>Tendo essas informações em mente, quando avaliamos a expressão <code>obj &lt;&lt;- obj[i] + 1</code> dentro do <em>environment</em> <code>env1</code>, o R primeiro tenta procurar pelos objetos <code>i</code> e <code>obj</code>, dentro do próprio <code>env1</code>. Consequentemente, o R encontra os valores 1 e <code>c(10, 20)</code>, e calcula o valor da sub-expressão <code>obj[i] + 1</code>, que é igual a <code>11</code>.</p>
<p>Depois, o R tenta descobrir onde o <em>assignment</em> vai ocorrer. Por isso, ele começa a procurar por <code>obj</code> no <em>parent environment</em> de <code>env1</code>, que no caso, é o <em>global environment</em>. Porém o R não encontra <code>obj</code> neste environment. Como resultado, o R vai avaliar o <em>assignment</em> dentro do <em>global environment</em>.</p>
<p>Por esse motivo que, ao avaliarmos a expressão <code>obj &lt;&lt;- obj[i] + 1</code> dentro de <code>env1</code>, um novo objeto chamado <code>obj</code> é criado dentro do <em>global environment</em>.</p>
<div class="sourceCode" id="cb2258"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2258-1"><a href="#cb2258-1" aria-hidden="true" tabindex="-1"></a><span class="fu">get</span>(<span class="st">&quot;obj&quot;</span>, <span class="at">envir =</span> <span class="fu">globalenv</span>())</span></code></pre></div>
<pre><code>## [1] 11</code></pre>
<p><strong>18.1.B)</strong> Dessa vez, como estamos executando a expressão <code>obj &lt;&lt;- obj[i] + 1</code> dentro de <code>env2</code>, os objetos <code>i</code> e <code>obj</code> vão ser inicialmente procurados dentro de <code>env2</code>, depois em seu parent environment (<code>env1</code>). Consequentemente, o valor 2 será encontrado para o objeto <code>i</code>, e <code>c(10, 20)</code> para o objeto <code>obj</code>. Como resultado, dessa vez, a sub-expressão <code>obj[i] + 1</code> gera o valor 21.</p>
<p>Em seguida, o R tenta descobrir o local onde o <em>assignment</em> será avaliado. Logo, ele tenta encontrar um objeto chamado <code>obj</code> no <em>parent environment</em> de <code>env2</code> (isto é, <code>env1</code>). Como <code>env1</code> possui um objeto chamado <code>obj</code>, tal objeto é redefinido para o valor 21.</p>
<div class="sourceCode" id="cb2260"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2260-1"><a href="#cb2260-1" aria-hidden="true" tabindex="-1"></a>env1<span class="sc">$</span>obj</span></code></pre></div>
<pre><code>## [1] 21</code></pre>
<center>
<em>Exercício 2</em>
</center>
<p><strong>18.2.A)</strong> O resultado será 16.</p>
<div class="sourceCode" id="cb2262"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2262-1"><a href="#cb2262-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb2262-2"><a href="#cb2262-2" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb2262-3"><a href="#cb2262-3" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="dv">15</span></span>
<span id="cb2262-4"><a href="#cb2262-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(x <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb2262-5"><a href="#cb2262-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2262-6"><a href="#cb2262-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2262-7"><a href="#cb2262-7" aria-hidden="true" tabindex="-1"></a><span class="do">### Qual será o resultado do comando print()</span></span>
<span id="cb2262-8"><a href="#cb2262-8" aria-hidden="true" tabindex="-1"></a><span class="do">### executado por f() ?</span></span>
<span id="cb2262-9"><a href="#cb2262-9" aria-hidden="true" tabindex="-1"></a><span class="fu">f</span>()</span></code></pre></div>
<pre><code>## [1] 16</code></pre>
<p><strong>18.2.B)</strong> O resultado será o vetor <code>c(11, 21)</code>.</p>
<div class="sourceCode" id="cb2264"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2264-1"><a href="#cb2264-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Iniciei uma nova sessão no R</span></span>
<span id="cb2264-2"><a href="#cb2264-2" aria-hidden="true" tabindex="-1"></a>obj <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb2264-3"><a href="#cb2264-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2264-4"><a href="#cb2264-4" aria-hidden="true" tabindex="-1"></a>env1 <span class="ot">&lt;-</span> rlang<span class="sc">::</span><span class="fu">env</span>()</span>
<span id="cb2264-5"><a href="#cb2264-5" aria-hidden="true" tabindex="-1"></a>env2 <span class="ot">&lt;-</span> rlang<span class="sc">::</span><span class="fu">env</span>(env1)</span>
<span id="cb2264-6"><a href="#cb2264-6" aria-hidden="true" tabindex="-1"></a>env3 <span class="ot">&lt;-</span> rlang<span class="sc">::</span><span class="fu">env</span>(env2)</span>
<span id="cb2264-7"><a href="#cb2264-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2264-8"><a href="#cb2264-8" aria-hidden="true" tabindex="-1"></a>env1<span class="sc">$</span>obj <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">20</span>)</span>
<span id="cb2264-9"><a href="#cb2264-9" aria-hidden="true" tabindex="-1"></a>env3<span class="sc">$</span>obj <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">200</span>)</span>
<span id="cb2264-10"><a href="#cb2264-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2264-11"><a href="#cb2264-11" aria-hidden="true" tabindex="-1"></a><span class="fu">eval</span>(<span class="fu">quote</span>(obj <span class="ot">&lt;&lt;-</span> obj <span class="sc">+</span> <span class="dv">1</span>), <span class="at">envir =</span> env2)</span>
<span id="cb2264-12"><a href="#cb2264-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2264-13"><a href="#cb2264-13" aria-hidden="true" tabindex="-1"></a><span class="do">### Qual é o resultado do print() abaixo ?</span></span>
<span id="cb2264-14"><a href="#cb2264-14" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">get</span>(<span class="st">&quot;obj&quot;</span>, <span class="at">envir =</span> env1))</span></code></pre></div>
<pre><code>## [1] 11 21</code></pre>
</div>
</div>
<div id="referências-13" class="section level1 unnumbered">
<h1 class="unnumbered">Referências</h1>
<!--chapter:end:Exercícios/respostas_complete.md-->
</div>
<div id="appendix-apêndices" class="section level1 unnumbered">
<h1 class="unnumbered">(APPENDIX) Apêndices</h1>
</div>
<div id="pnad-contínua-arquivo-csv-para-input" class="section level1" number="19">
<h1 number="19"><span class="header-section-number">19</span> PNAD Contínua: arquivo CSV para <code>input</code></h1>
<p></p>
<p>Neste apêndice, você pode encontrar logo abaixo, os comandos necessários para importar um arquivo CSV para o seu R. Esse arquivo CSV, possui as especificações de cada coluna presente nos arquivos dos microdados da PNAD Contínua. Sendo que essas especificações, são necessárias para importar os microdados da PNAD Contínua em qualquer programa estatístico.</p>
<p>Esse arquivo CSV foi construído no dia 26/11/2020, com base nas especificações das colunas presentes no arquivo <em>input</em> (<code>input_PNADC_trimestral.txt</code>), que você pode encontrar na <a href="ftp://ftp.ibge.gov.br/Trabalho_e_Rendimento/Pesquisa_Nacional_por_Amostra_de_Domicilios_continua/Trimestral/">página do servidor</a> em que os microdados da PNAD Contínua são hospedados, ou então, você pode baixar um ZIP (<code>Dicionario_input.zip</code>) contendo este arquivo <code>input</code>, através deste <a href="https://www.ibge.gov.br/estatisticas/downloads-estatisticas.html?caminho=Trabalho_e_Rendimento/Pesquisa_Nacional_por_Amostra_de_Domicilios_continua/Trimestral/Microdados/Documentacao">link</a>. Este arquivo CSV, foi utilizado para importar os microdados da PNAD Contínua referente ao 1° trimestre de 2020, na seção <a href="#sec:estudo_pnad_continua">Um estudo de caso: lendo os microdados da PNAD Contínua com read_fwf()</a> desta obra.</p>
<p></p>
<div class="sourceCode" id="cb2266"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2266-1"><a href="#cb2266-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb2266-2"><a href="#cb2266-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2266-3"><a href="#cb2266-3" aria-hidden="true" tabindex="-1"></a>github <span class="ot">&lt;-</span> <span class="st">&quot;https://raw.githubusercontent.com/pedropark99/&quot;</span></span>
<span id="cb2266-4"><a href="#cb2266-4" aria-hidden="true" tabindex="-1"></a>pasta <span class="ot">&lt;-</span> <span class="st">&quot;Curso-R/master/Dados/&quot;</span></span>
<span id="cb2266-5"><a href="#cb2266-5" aria-hidden="true" tabindex="-1"></a>arquivo <span class="ot">&lt;-</span> <span class="st">&quot;input_PNADC.txt&quot;</span></span>
<span id="cb2266-6"><a href="#cb2266-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2266-7"><a href="#cb2266-7" aria-hidden="true" tabindex="-1"></a>input <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(</span>
<span id="cb2266-8"><a href="#cb2266-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(github, pasta, arquivo),</span>
<span id="cb2266-9"><a href="#cb2266-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">col_names =</span> <span class="fu">c</span>(<span class="st">&quot;nome_coluna&quot;</span>, <span class="st">&quot;largura&quot;</span>, <span class="st">&quot;coluna_numerica&quot;</span>)</span>
<span id="cb2266-10"><a href="#cb2266-10" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p></p>
</div>
<div id="referências-14" class="section level1 unnumbered">
<h1 class="unnumbered">Referências</h1>
<!--chapter:end:appendixes.Rmd-->
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-adler2010" class="csl-entry">
Adler, Joseph. 2010. <em>R in a Nutshell</em>. Sebastopol, CA: O’Reilly.
</div>
<div id="ref-pnadc" class="csl-entry">
Braga, Douglas, Gabriel Assuncao, and Luna Hidalgo. 2020. <span>“PNADcIBGE: Downloading, Reading and Analysing PNADC Microdata.”</span> In. CRAN R Package. <a href="https://cran.r-project.org/web/packages/PNADcIBGE/index.html">https://cran.r-project.org/web/packages/PNADcIBGE/index.html</a>.
</div>
<div id="ref-camara2001" class="csl-entry">
Câmara, Gilberto, and Antônio Miguel Vieira Monteiro. 2001. <span>“Conceitos básicos Em Ciência Da Geoinformação.”</span> In <em>Introdução à Ciência Da Geoinformação</em>, edited by Gilberto Câmara, Clodoveu Davis, and Antônio Miguel Vieira Monteiro, 7–42. São José dos Campos: Instituto Nacional de Pesquisas Espaciais - INPE. <a href="http://www.dpi.inpe.br/gilberto/livro/introd/">http://www.dpi.inpe.br/gilberto/livro/introd/</a>.
</div>
<div id="ref-chambers2008" class="csl-entry">
Chambers, John M. 2008. <em>Software for Data Analysis: Programming with r</em>. New York, NY: Springer.
</div>
<div id="ref-chambers2016" class="csl-entry">
———. 2016. <em>Extending r</em>. The r Series. Boca Raton, FL: CRC Press.
</div>
<div id="ref-chang2012" class="csl-entry">
Chang, Winston. 2012. <em>R Graphics Cookbook</em>. Sebastopol, CA: O’Reilly Media, Inc. <a href="https://r-graphics.org">https://r-graphics.org</a>.
</div>
<div id="ref-chase2019" class="csl-entry">
Chase, Will. 2019. <span>“Custom Fonts and Plot Quality with Ggplot on Windows.”</span> <a href="https://www.williamrchase.com/post/custom-fonts-and-plot-quality-with-ggplot-on-windows/">https://www.williamrchase.com/post/custom-fonts-and-plot-quality-with-ggplot-on-windows/</a>.
</div>
<div id="ref-chase2020" class="csl-entry">
———. 2020. <span>“Constructing a Career in Dataviz: The How.”</span> <a href="https://www.williamrchase.com/post/constructing-a-career-in-dataviz-the-how/">https://www.williamrchase.com/post/constructing-a-career-in-dataviz-the-how/</a>.
</div>
<div id="ref-friedl2006" class="csl-entry">
Friedl, Jeffrey E. F. 2006. <em>Mastering Regular Expressions</em>. 3rd ed. Sebastopol, CA: O’Reilly Media, Inc.
</div>
<div id="ref-gillespie2017" class="csl-entry">
Gillespie, Colin, and Robin Lovelace. 2017. <em>Efficient r Programming</em>. Sebastopol, CA: O’Reilly Media, Inc. <a href="https://csgillespie.github.io/efficientR/">https://csgillespie.github.io/efficientR/</a>.
</div>
<div id="ref-grolemund2014" class="csl-entry">
Grolemund, Garrett. 2014. <em>Hands-on Programming with r</em>. Sebastopol, CA: O’Reilly Media, Inc. <a href="https://rstudio-education.github.io/hopr/">https://rstudio-education.github.io/hopr/</a>.
</div>
<div id="ref-rnews2004" class="csl-entry">
Grothendieck, Gabor, and Thomas Petzoldt. 2004. <span>“Date and Time Classes in r.”</span> <em>R News</em> 4 (1): 29–31.
</div>
<div id="ref-haralambous2007" class="csl-entry">
Haralambous, Yannis. 2007. <em>Fonts &amp; Encodings</em>. Sebastopol, CA: O’Reilly Media, Inc.
</div>
<div id="ref-hughes2014" class="csl-entry">
Hughes, John F., Andries Van Dam, Morgan Mcguire, David F. Sklar, James D. Foley, Steven K. Feiner, and Kurt Akeley. 2014. <em>Computer Graphics: Principles and Practice</em>. 3rd ed. Addison-Wesley.
</div>
<div id="ref-ihaka1996" class="csl-entry">
Ihaka, Ross, and Robert Gentleman. 1996. <span>“R: A Language for Data Analysis and Graphics.”</span> <em>Journal of Computational and Graphical Statistics</em> 5 (3): 299–314.
</div>
<div id="ref-long2019" class="csl-entry">
Long, James D., and Paul Teetor. 2019. <em>R Cookbook</em>. 2nd ed. Sebastopol, CA: O’Reilly Media, Inc. <a href="https://rc2e.com">https://rc2e.com</a>.
</div>
<div id="ref-cepr" class="csl-entry">
McDonnell, Robert Myles, Eduardo Oliveira, and Rodrigo Giannotti. 2020. <span>“cepR: Busca CEPs Brasileiros.”</span> In. CRAN R Package. <a href="https://cran.r-project.org/web/packages/cepR/index.html">https://cran.r-project.org/web/packages/cepR/index.html</a>.
</div>
<div id="ref-murray1996" class="csl-entry">
Murray, James D., and William vanRyper. 1996. <em>Encyclopedia of Graphics Files Formats</em>. 2nd ed. Sepastopol, CA: O’Reilly Media.
</div>
<div id="ref-murrell2006" class="csl-entry">
Murrell, Paul. 2006. <em>R Graphics</em>. 1st ed. Boca Raton, FL: Chapman &amp; Hall - CRC Press.
</div>
<div id="ref-nield2016" class="csl-entry">
Nield, Thomas. 2016. <em>Getting Started with SQL: A Hands-on Approach for Beginners</em>. 1st ed. Sepastopol, CA: O’Reilly Media.
</div>
<div id="ref-pedersen2020" class="csl-entry">
Pedersen, Thomas Lin. 2020. <span>“Updates to Ragg and Systemfonts.”</span> <a href="https://www.tidyverse.org/blog/2020/05/updates-to-ragg-and-systemfonts/">https://www.tidyverse.org/blog/2020/05/updates-to-ragg-and-systemfonts/</a>.
</div>
<div id="ref-peng2015" class="csl-entry">
Peng, Roger D. 2015. <em>R Programming for Data Science</em>. Leanpub. <a href="https://bookdown.org/rdpeng/rprogdatascience/">https://bookdown.org/rdpeng/rprogdatascience/</a>.
</div>
<div id="ref-geobr" class="csl-entry">
Pereira, Rafael H., Caio Nogueira Goncalves, Paulo Henrique Fernandes de Araujo, Guilherme Duarte Carvalho, Rodrigo Almeida de Arruda, Igor Nascimento, Barbara Santiago Pedreira da Costa, et al. 2020. <span>“Geobr: Loads Shapefiles of Official Spatial Data Sets of Brazil.”</span> In. IPEA - Instituto de Pesquisa Econômica Aplicada; CRAN R Package. <a href="https://cran.r-project.org/web/packages/geobr/index.html">https://cran.r-project.org/web/packages/geobr/index.html</a>.
</div>
<div id="ref-ibge_pnad" class="csl-entry">
<em>Pesquisa Nacional Por Amostra de Domicílios Contínua: Notas técnicas</em>. 2019. Rio de Janeiro: Instituto Brasileiro de Geografia e Estatística. <a href="https://biblioteca.ibge.gov.br/visualizacao/livros/liv101674_notas_tecnicas.pdf">https://biblioteca.ibge.gov.br/visualizacao/livros/liv101674_notas_tecnicas.pdf</a>.
</div>
<div id="ref-read_dbc" class="csl-entry">
Petruzalek, Daniela. 2016. <span>“Read.dbc: Read Data Stored in DBC (Compressed DBF) Files.”</span> In. CRAN R Package. <a href="https://cran.r-project.org/web/packages/read.dbc/index.html">https://cran.r-project.org/web/packages/read.dbc/index.html</a>.
</div>
<div id="ref-qiu2015" class="csl-entry">
Qiu, Yixuan. 2015. <span>“Showtext: Using System Fonts in r Graphics.”</span> <em><span>The R Journal</span></em> 7 (1): 99–108. <a href="https://doi.org/10.32614/RJ-2015-008">https://doi.org/10.32614/RJ-2015-008</a>.
</div>
<div id="ref-Rintroduction" class="csl-entry">
R Core Team. 2020a. <em>An Introduction to r: A Programming Environment for Data Analysis and Graphics</em>. Version 4.0.3. R Foundation. <a href="https://cran.r-project.org/doc/manuals/r-release/R-intro.html">https://cran.r-project.org/doc/manuals/r-release/R-intro.html</a>.
</div>
<div id="ref-Rlanguage" class="csl-entry">
———. 2020b. <em>R Language Definition</em>. Version 4.0.3. R Foundation. <a href="https://cran.r-project.org/doc/manuals/r-release/R-lang.html">https://cran.r-project.org/doc/manuals/r-release/R-lang.html</a>.
</div>
<div id="ref-rnews2001" class="csl-entry">
Ripley, Brian D., and Kurt Hornik. 2001. <span>“Date-Time Classes.”</span> <em>R News</em> 1 (2): 8–11.
</div>
<div id="ref-sidrar" class="csl-entry">
Siqueira, Renato Prado. 2020. <span>“Sidrar: An Interface to IBGE’s SIDRA API.”</span> In. CRAN R Package. <a href="https://cran.r-project.org/web/packages/sidrar/index.html">https://cran.r-project.org/web/packages/sidrar/index.html</a>.
</div>
<div id="ref-wickham2014" class="csl-entry">
Wickham, Hadley. 2014. <span>“Tidy Data.”</span> <em>The Journal of Statistical Software</em> 59. <a href="http://www.jstatsoft.org/v59/i10/">http://www.jstatsoft.org/v59/i10/</a>.
</div>
<div id="ref-wickham2015_advanced" class="csl-entry">
———. 2015a. <em>Advanced r</em>. 2nd ed. Boca Raton, Florida: CRC Press. <a href="https://adv-r.hadley.nz">https://adv-r.hadley.nz</a>.
</div>
<div id="ref-wickham2015_packages" class="csl-entry">
———. 2015b. <em>R Packages</em>. Sebastopol, CA: O’Reilly Media, Inc. <a href="http://r-pkgs.had.co.nz">http://r-pkgs.had.co.nz</a>.
</div>
<div id="ref-wickham2016" class="csl-entry">
———. 2016. <em>Ggplot2: Elegant Graphics for Data Analysis</em>. 2nd ed. Use r! Springer International Publishing. <a href="https://ggplot2-book.org">https://ggplot2-book.org</a>.
</div>
<div id="ref-wickham_tidyverse2020" class="csl-entry">
———. 2020. <span>“Dplyr 1.0.0 Available Now!”</span> <a href="https://www.tidyverse.org/blog/2020/06/dplyr-1-0-0/">https://www.tidyverse.org/blog/2020/06/dplyr-1-0-0/</a>.
</div>
<div id="ref-wickham2019" class="csl-entry">
Wickham, Hadley, Mara Averick, Jennifer Bryan, Winston Chang, Lucy D’Agostino McGowan, Romain François, Garrett Grolemund, et al. 2019. <span>“Welcome to the Tidyverse.”</span> <em>Journal of Open Source Software</em> 4 (43): 1686. <a href="https://doi.org/10.21105/joss.01686">https://doi.org/10.21105/joss.01686</a>.
</div>
<div id="ref-wickham2017" class="csl-entry">
Wickham, Hadley, and Garrett Grolemund. 2017. <em>R for Data Science</em>. Sebastopol, CA: O’Reilly Media, Inc. <a href="https://r4ds.had.co.nz">https://r4ds.had.co.nz</a>.
</div>
<div id="ref-wilkinson" class="csl-entry">
Wilkinson, Leland. 2005. <em>The Grammar of Graphics</em>. 2nd ed. Verlag, NY: Springer. <a href="https://doi.org/10.1007/0-387-28695-0">https://doi.org/10.1007/0-387-28695-0</a>.
</div>
</div>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>A Fundação João Pinheiro (fundada em 1969), é uma instituição de pesquisa e ensino vinculada à Secretaria de Estado de Planejamento e Gestão de Minas Gerais, e é responsável por produzir as principais estatísticas econômicas, sociais e demográficas do estado de Minas Gerais.<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p><a href="#fnref2" class="footnote-back">↩︎</a></p></li>
<li id="fn3"><p><a href="https://docs.microsoft.com/en-us/azure/architecture/data-guide/technology-choices/r-developers-guide" class="uri">https://docs.microsoft.com/en-us/azure/architecture/data-guide/technology-choices/r-developers-guide</a><a href="#fnref3" class="footnote-back">↩︎</a></p></li>
<li id="fn4"><p>Você pode consultar a lista completa dos capítulos brasileiros na página principal do <a href="https://rladies.org/">R-Ladies global</a>.<a href="#fnref4" class="footnote-back">↩︎</a></p></li>
<li id="fn5"><p><a href="https://www.tidyverse.org/packages/" class="uri">https://www.tidyverse.org/packages/</a><a href="#fnref5" class="footnote-back">↩︎</a></p></li>
<li id="fn6"><p>Uma parte pequena dos pacotes disponíveis, não se encontram no CRAN, mas sim em outras plataformas como o GitHub. Neste caso, você precisa instalá-los a partir de funções do pacote <code>devtools</code>. Para mais detalhes, consulte o item <a href="https://rc2e.com/navigatingthesoftware#recipe-installGH">Installing a Package from GitHub</a> de <span class="citation"><a href="#ref-long2019" role="doc-biblioref">Long and Teetor</a> (<a href="#ref-long2019" role="doc-biblioref">2019</a>)</span>.<a href="#fnref6" class="footnote-back">↩︎</a></p></li>
<li id="fn7"><p><a href="https://www.youtube.com/watch?v=rz3_FDVt9eg" class="uri">https://www.youtube.com/watch?v=rz3_FDVt9eg</a><a href="#fnref7" class="footnote-back">↩︎</a></p></li>
<li id="fn8"><p>Caso tenha alguma dificuldade em chamar pelo pacote, volte a seção <a href="#sec:pacotes">Pacotes</a> para descobrir o passo que você se esqueceu de cumprir.<a href="#fnref8" class="footnote-back">↩︎</a></p></li>
<li id="fn9"><p>Lembre-se que no fundo, <code>data.frame</code>’s são listas, com a propriedade de que todos os elementos dessa lista, devem possuir o mesmo número de linhas. Portanto, se cada coluna desse <code>data.frame</code> representa um elemento da lista que forma esse <code>data.frame</code>, ao utilizarmos o operador <code>$</code>, também estaríamos selecionando um “elemento,” que se traduz em uma coluna do <code>data.frame</code>.<a href="#fnref9" class="footnote-back">↩︎</a></p></li>
<li id="fn10"><p><a href="https://www.sas.com/en_us/home.html" class="uri">https://www.sas.com/en_us/home.html</a><a href="#fnref10" class="footnote-back">↩︎</a></p></li>
<li id="fn11"><p><a href="https://www.ibm.com/products/spss-statistics" class="uri">https://www.ibm.com/products/spss-statistics</a><a href="#fnref11" class="footnote-back">↩︎</a></p></li>
<li id="fn12"><p><a href="https://notepad-plus-plus.org/" class="uri">https://notepad-plus-plus.org/</a><a href="#fnref12" class="footnote-back">↩︎</a></p></li>
<li id="fn13"><p>Vetores contendo <em>bytes</em> de informação são comumente chamados de <em>raw vectors</em> pela comunidade de R.<a href="#fnref13" class="footnote-back">↩︎</a></p></li>
<li id="fn14"><p>Essa função pertence ao pacote <code>RcppRoll</code> e, portanto, para ter acesso à função você deve possuir esse pacote instalado em sua máquina, e chamar por ele em sua sessão.<a href="#fnref14" class="footnote-back">↩︎</a></p></li>
<li id="fn15"><p>Esses são termos comuns na comunidade de R, mas estes formatos também são conhecidos, ou chamados por <em>indexed data</em> (<em>long</em>) e por <em>cartesian data</em> (<em>wide</em>).<a href="#fnref15" class="footnote-back">↩︎</a></p></li>
<li id="fn16"><p>Apesar de serem um caso raro no R, as tabelas que possuem listas como colunas, tem se tornado cada vez mais comuns ao longo de diversas análises, e são comumente chamadas pela comunidade de <em>nested tables</em>, ou de <em>nested data</em>. Alguns pacotes tem se desenvolvido, de maneira muito forte nessa área, e por isso, essas estruturas tem se tornado de grande utilidade em diversas aplicações. Alguns desses pacotes incluem o próprio <code>tidyr</code>, além do pacote <code>broom</code>.<a href="#fnref16" class="footnote-back">↩︎</a></p></li>
<li id="fn17"><p><a href="https://www.youtube.com/watch?v=rz3_FDVt9eg&amp;ab_channel=PsychologyattheUniversityofEdinburgh" class="uri">https://www.youtube.com/watch?v=rz3_FDVt9eg&amp;ab_channel=PsychologyattheUniversityofEdinburgh</a><a href="#fnref17" class="footnote-back">↩︎</a></p></li>
<li id="fn18"><p>Caso você não conheça a função <code>full_join()</code>, lembre-se que ela é descrita em detalhes no capítulo “Introdução a base de dados relacionais.”<a href="#fnref18" class="footnote-back">↩︎</a></p></li>
<li id="fn19"><p>Ou seja, em relação a seus concorrentes, o <code>ggplot</code> não é necessariamente o pacote que oferece praticidade, mas sim, um leque de possibilidades muito maior em relação a seus concorrentes.<a href="#fnref19" class="footnote-back">↩︎</a></p></li>
<li id="fn20"><p><a href="https://rstudio.com/wp-content/uploads/2015/03/ggplot2-cheatsheet.pdf" class="uri">https://rstudio.com/wp-content/uploads/2015/03/ggplot2-cheatsheet.pdf</a><a href="#fnref20" class="footnote-back">↩︎</a></p></li>
<li id="fn21"><p><a href="https://ggplot2.tidyverse.org/reference/index.html" class="uri">https://ggplot2.tidyverse.org/reference/index.html</a><a href="#fnref21" class="footnote-back">↩︎</a></p></li>
<li id="fn22"><p><a href="https://www.r-graph-gallery.com/" class="uri">https://www.r-graph-gallery.com/</a><a href="#fnref22" class="footnote-back">↩︎</a></p></li>
<li id="fn23"><p><a href="http://www.ipeadata.gov.br/Default.aspx" class="uri">http://www.ipeadata.gov.br/Default.aspx</a><a href="#fnref23" class="footnote-back">↩︎</a></p></li>
<li id="fn24"><p><a href="https://ggplot2.tidyverse.org/reference/index.html" class="uri">https://ggplot2.tidyverse.org/reference/index.html</a><a href="#fnref24" class="footnote-back">↩︎</a></p></li>
<li id="fn25"><p><a href="https://www.curso-r.com/material/ggplot/" class="uri">https://www.curso-r.com/material/ggplot/</a><a href="#fnref25" class="footnote-back">↩︎</a></p></li>
<li id="fn26"><p><a href="http://www.leg.ufpr.br/~walmes/cursoR/data-vis/index.html" class="uri">http://www.leg.ufpr.br/~walmes/cursoR/data-vis/index.html</a><a href="#fnref26" class="footnote-back">↩︎</a></p></li>
<li id="fn27"><p><a href="https://pt.stackoverflow.com/" class="uri">https://pt.stackoverflow.com/</a><a href="#fnref27" class="footnote-back">↩︎</a></p></li>
<li id="fn28"><p><a href="https://www.r-graph-gallery.com/" class="uri">https://www.r-graph-gallery.com/</a><a href="#fnref28" class="footnote-back">↩︎</a></p></li>
<li id="fn29"><p>Veja a página oficial do pacote: <a href="https://cran.r-project.org/web/packages/ggridges/vignettes/introduction.html" class="uri">https://cran.r-project.org/web/packages/ggridges/vignettes/introduction.html</a><a href="#fnref29" class="footnote-back">↩︎</a></p></li>
<li id="fn30"><p>No caso de arquivos do tipo SVG, a função <code>ggsave()</code> utiliza a função <code>svglite()</code>, que vem do pacote <code>svglite</code>.<a href="#fnref30" class="footnote-back">↩︎</a></p></li>
<li id="fn31"><p>Esse item foi inspirado em um exercício de .<a href="#fnref31" class="footnote-back">↩︎</a></p></li>
<li id="fn32"><p>Você pode ver a lista completa de nomes, ao rodar a função <code>colors()</code> no console.<a href="#fnref32" class="footnote-back">↩︎</a></p></li>
<li id="fn33"><p>Caso você queira entrar em mais detalhes, um bom início é o artigo intitulado <em>“Text Rendering Hates You”</em>, de Alexis Beingessner: <a href="https://gankra.github.io/blah/text-hates-you/" class="uri">https://gankra.github.io/blah/text-hates-you/</a><a href="#fnref33" class="footnote-back">↩︎</a></p></li>
<li id="fn34"><p>Este exercício foi diretamente extraído da obra de <a href="#fnref34" class="footnote-back">↩︎</a></p></li>
<li id="fn35"><p>Pode haver certa confusão entre sexo e gênero aqui. O sexo se refere às características físicas e biológicas do corpo, e essas características podem identificar uma pessoa como Homem ou Mulher. Já o gênero, está muito mais relacionado à cultura e a forma como um indivíduo se identifica como ser. Logo, se nossa variável identificasse o gênero de uma pessoa, haveria muito mais possibilidades do que a simples divisão entre Homem e Mulher.<a href="#fnref35" class="footnote-back">↩︎</a></p></li>
<li id="fn36"><p>Em resumo, datas podem ser criadas a partir de todos os outros tipos que vimos até o momento (<code>character</code>, <code>double</code>, <code>integer</code>, <code>logical</code>, e <code>factor</code>). Para mais detalhes, consulte <code>?as.Date</code> e <code>?Date</code>.<a href="#fnref36" class="footnote-back">↩︎</a></p></li>
<li id="fn37"><p>A <a href="https://www.stat.berkeley.edu/~s133/dates.html">Universidade da California - Berkeley</a> possui uma excelente página sobre como definir esses formatos, e que vale a pena conferir.<a href="#fnref37" class="footnote-back">↩︎</a></p></li>
<li id="fn38"><p>Se é algo não muito comum, e ainda, complicado de se entender, então porque falar sobre o código <code>%z</code>? Pelo simples fato de que ele demonstra de forma eficiente, como o uso de fusos horários podem contribuir para a confusão de muitos usuários.<a href="#fnref38" class="footnote-back">↩︎</a></p></li>
<li id="fn39"><p>Portanto, diversos programas e linguagens utilizam números para representar pontos em uma “escala de tempo.” Porém, o que tende a divergir e muito entre esses diversos sistemas é a data de origem utilizada <span class="citation">(<a href="#ref-rnews2004" role="doc-biblioref">Grothendieck and Petzoldt 2004</a>)</span>. O Excel por exemplo, utiliza o dia 01 de janeiro de 1900 como o ponto zero de sua escala de tempo, enquanto o SPSS, utiliza o dia de início do calendário gregoriano (14 de outubro de 1582).<a href="#fnref39" class="footnote-back">↩︎</a></p></li>
<li id="fn40"><p>A principal diferença entre <code>match.arg()</code> e <code>rlang::arg_match()</code>, é que <code>rlang::arg_match()</code> não permite <em>matches</em> parciais. Ou seja, se dentre os valores possíveis de um argumento <code>x</code> temos o valor <code>"center"</code>, e eu forneço o valor <code>"cent"</code> a este argumento durante a chamada da função, <code>rlang::arg_match()</code> vai me retornar um erro, enquanto <code>match.arg()</code> vai tentar encontrar um texto parecido com <code>"cent"</code> dentre as possibilidades.<a href="#fnref40" class="footnote-back">↩︎</a></p></li>
<li id="fn41"><p><a href="https://www.youtube.com/watch?v=vgYS-F8opgE&amp;ab_channel=RStudio" class="uri">https://www.youtube.com/watch?v=vgYS-F8opgE&amp;ab_channel=RStudio</a><a href="#fnref41" class="footnote-back">↩︎</a></p></li>
<li id="fn42"><p><a href="https://www.almg.gov.br/consulte/legislacao/completa/completa-nova-min.html?tipo=LEI&amp;num=18030&amp;comp=&amp;ano=2009&amp;texto=original" class="uri">https://www.almg.gov.br/consulte/legislacao/completa/completa-nova-min.html?tipo=LEI&amp;num=18030&amp;comp=&amp;ano=2009&amp;texto=original</a><a href="#fnref42" class="footnote-back">↩︎</a></p></li>
<li id="fn43"><p><a href="https://stackoverflow.com/questions/15031338/subscript-out-of-bounds-general-definition-and-solution" class="uri">https://stackoverflow.com/questions/15031338/subscript-out-of-bounds-general-definition-and-solution</a><a href="#fnref43" class="footnote-back">↩︎</a></p></li>
<li id="fn44"><p>Após aplicar <code>debug()</code> sobre a sua função de interesse, se você deseja retornar para o seu estado inicial de sua função, você pode aplicar <code>undebug()</code> sobre essa função.<a href="#fnref44" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
<!--bookdown:body:end-->
  </main>

  <div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page">
      <h2>On this page</h2>
      <div id="book-on-this-page"></div>

      <div class="book-extra">
        <ul class="list-unstyled">
          <li><a id="book-source" href="#">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="#">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
      </div>
    </nav>
  </div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5">
  <div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Introdução à Linguagem R: seus fundamentos e sua prática</strong>" was written by Pedro Faria. It was last built on 2022-04-03.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
<script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>

</html>
