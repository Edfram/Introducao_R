<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Capítulo 11 Introduzindo fatores (factor’s) com forcats | Introdução à Linguagem R: seus fundamentos e sua prática</title>
<meta name="author" content="Pedro Faria">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.9/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.5.1/tabs.js"></script><script src="libs/bs3compat-0.2.5.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script><!-- CSS -->
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Introdução à Linguagem R: seus fundamentos e sua prática</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Bem vindo!</a></li>
<li><a class="" href="sobre-os-autores.html">Sobre os autores</a></li>
<li><a class="" href="pref%C3%A1cio.html">Prefácio</a></li>
<li><a class="" href="no%C3%A7%C3%B5es-b%C3%A1sicas-do-r.html"><span class="header-section-number">1</span> Noções Básicas do R</a></li>
<li><a class="" href="fundamentos-da-linguagem-r.html"><span class="header-section-number">2</span> Fundamentos da Linguagem R</a></li>
<li><a class="" href="importando-e-exportando-dados-com-o-r.html"><span class="header-section-number">3</span> Importando e exportando dados com o R</a></li>
<li><a class="" href="transformando-dados-com-dplyr.html"><span class="header-section-number">4</span> Transformando dados com dplyr</a></li>
<li><a class="" href="fun%C3%A7%C3%B5es-e-loops-no-r.html"><span class="header-section-number">5</span> Funções e Loops no R</a></li>
<li><a class="" href="introdu%C3%A7%C3%A3o-a-base-de-dados-relacionais-no-r.html"><span class="header-section-number">6</span> Introdução a base de dados relacionais no R</a></li>
<li><a class="" href="tidy-data-uma-abordagem-para-organizar-os-seus-dados.html"><span class="header-section-number">7</span> Tidy Data: Uma abordagem para organizar os seus dados</a></li>
<li><a class="" href="visualiza%C3%A7%C3%A3o-de-dados-com-ggplot2.html"><span class="header-section-number">8</span> Visualização de dados com ggplot2</a></li>
<li><a class="" href="configurando-componentes-est%C3%A9ticos-do-gr%C3%A1fico-no-ggplot2.html"><span class="header-section-number">9</span> Configurando componentes estéticos do gráfico no ggplot2</a></li>
<li><a class="" href="manipula%C3%A7%C3%A3o-e-transforma%C3%A7%C3%A3o-de-strings-com-stringr.html"><span class="header-section-number">10</span> Manipulação e transformação de strings com stringr</a></li>
<li><a class="active" href="introduzindo-fatores-factors-com-forcats.html"><span class="header-section-number">11</span> Introduzindo fatores (factor’s) com forcats</a></li>
<li><a class="" href="introdu%C3%A7%C3%A3o-%C3%A0-vari%C3%A1veis-de-tempo-com-lubridate.html"><span class="header-section-number">12</span> Introdução à variáveis de tempo com lubridate</a></li>
<li class="book-part">Apêndices</li>
<li><a class="" href="pnad-cont%C3%ADnua-arquivo-csv-para-input.html"><span class="header-section-number">A</span> PNAD Contínua: arquivo CSV para input</a></li>
<li><a class="" href="refer%C3%AAncias.html">Referências</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/pedropark99/Introducao_R/">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="introduzindo-fatores-factors-com-forcats" class="section level1" number="11">
<h1>
<span class="header-section-number">Capítulo 11</span> Introduzindo fatores (<code>factor</code>’s) com <code>forcats</code><a class="anchor" aria-label="anchor" href="#introduzindo-fatores-factors-com-forcats"><i class="fas fa-link"></i></a>
</h1>
<div id="introdução-e-pré-requisitos-5" class="section level2" number="11.1">
<h2>
<span class="header-section-number">11.1</span> Introdução e pré-requisitos<a class="anchor" aria-label="anchor" href="#introdu%C3%A7%C3%A3o-e-pr%C3%A9-requisitos-5"><i class="fas fa-link"></i></a>
</h2>
<p>No capítulo de <a href="fundamentos-da-linguagem-r.html#sec:fundamentos_R">Fundamentos da Linguagem R</a>, introduzimos os 4 tipos básicos de dados disponíveis no R, sendo eles: <code>integer</code>; <code>double</code>; <code>character</code>; e <code>logical</code>. Entretanto, também destacamos que outros tipos de dados “mais complexos” estão presentes na linguagem R, e, que eles serão tão importantes quanto os tipos básicos em suas análises.</p>
<p>Os exemplos mais importantes desses tipos são os fatores (<code>factor</code>) e as variáveis de tempo, isto é, datas e horários (<code>Date</code> ou <code>POSIXct</code>). Neste capítulo, vamos focar a discussão no tipo <code>factor</code>, e, no próximo capítulo, discutiremos os tipos referentes às variáveis de tempo.</p>
<p>Parte dos exemplos deste capítulo, envolvem o uso de funções do pacote <code>forcats</code>, portanto, não se esqueça de instalar esse pacote (com o comando <code><a href="https://rdrr.io/r/utils/install.packages.html">install.packages()</a></code>), e, logo depois, chamar pelo pacote para a sua sessão (com o comando <code><a href="https://rdrr.io/r/base/library.html">library()</a></code>). O pacote <code>forcats</code> está incluso no pacote <code>tidyverse</code>, e, por isso, o <code>tidyverse</code> representa um caminho alternativo para você acessar as funções deste pacote.</p>
<p></p>
<div class="sourceCode" id="cb1047"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://forcats.tidyverse.org">forcats</a></span><span class="op">)</span>
<span class="co">## Ou</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></code></pre></div>
<p></p>
</div>
<div id="o-que-são-fatores" class="section level2" number="11.2">
<h2>
<span class="header-section-number">11.2</span> O que são fatores ?<a class="anchor" aria-label="anchor" href="#o-que-s%C3%A3o-fatores"><i class="fas fa-link"></i></a>
</h2>
<p>Um fator (ou <code>factor</code>) é um tipo de dado do R desenvolvido para o trabalho com <strong>variáveis categóricas</strong>, ou <strong>variáveis qualitativas</strong>. Ou seja, o tipo de dado <code>factor</code> lhe permite armazenar características e qualidades que um indivíduo carrega, ou de outra forma, qual a “categoria” ou grupo em que cada indivíduo de sua tabela se encaixa.</p>
<p>O sexo e a cor de pele são dois exemplos clássicos de variáveis qualitativas, pois elas identificam uma característica física do indivíduo. Características essas que determinam se o indíviduo pertence ou não a um grupo específico de pessoas (mulheres pardas, homens brancos, etc.). A faixa etária é um outro exemplo muito comum, sendo uma varíavel que busca separar indivíduos em vários grupos de acordo com as suas idades.</p>
<p>Entretanto, para além de características e categorias, também podemos identificar uma variável categórica, ao percebermos se essa variável pode (ou deve) assumir um conjunto muito específico e muito bem definido de valores <span class="citation">(<a href="refer%C3%AAncias.html#ref-Rlanguage" role="doc-biblioref">R Core Team 2020b</a>, p 8)</span>. Por exemplo, uma variável que apresente o sexo de uma pessoa pode assumir apenas dois valores diferentes (Homem ou Mulher; Masculino ou Feminimo; H ou M; ou alguma outra variação desses valores). Pode haver ainda, a necessidade de incluir um terceiro valor para casos especiais, como “Indefinido,” mas em geral, o sexo assume apenas os dois valores supracitados<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;Pode haver certa confusão entre sexo e gênero aqui. O sexo se refere às características físicas e biológicas do corpo, e essas características podem identificar uma pessoa como Homem ou Mulher. Já o gênero, está muito mais relacionado à cultura e a forma como um indivíduo se identifica como ser. Logo, se nossa variável identificasse o gênero de uma pessoa, haveria muito mais possibilidades do que a simples divisão entre Homem e Mulher.&lt;/p&gt;"><sup>36</sup></a>. Como um outro exemplo, uma variável que guarda o mês do ano ao qual os dados de sua tabela se referem pode assumir apenas doze valores diferentes (Janeiro, Fevereiro, Março, …, Novembro, Dezembro), logo, essa também é uma variável categórica sob essa perspectiva.</p>
</div>
<div id="como-construir-um-fator" class="section level2" number="11.3">
<h2>
<span class="header-section-number">11.3</span> Como construir um fator<a class="anchor" aria-label="anchor" href="#como-construir-um-fator"><i class="fas fa-link"></i></a>
</h2>
<p>Suponha que você tenha questionado o sexo de várias pessoas, e anotado as suas respostas no vetor abaixo (<code>entrevista</code>):</p>
<p></p>
<div class="sourceCode" id="cb1048"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">entrevista</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Mulher"</span>, <span class="st">"Homem"</span>, <span class="st">"Homem"</span>, <span class="st">"Mulher"</span>, <span class="st">"Mum"</span><span class="op">)</span></code></pre></div>
<p></p>
<p>Se você deseja transformar esse vetor acima (que no momento é um vetor do tipo <code>character</code>) em um vetor do tipo <code>factor</code>, você deve primeiro pensar sobre o atributo <code>levels</code> que será utilizado neste vetor. Ou seja, <strong>todo objeto do tipo <code>factor</code> no R possui um atributo chamado <code>levels</code></strong>, que representa o conjunto de valores que a variável em questão pode assumir. Como estamos anotando o sexo de algumas pessoas entrevistadas, sabemos que essa variável pode assumir apenas dois valores diferentes. Eu crio o vetor abaixo (<code>niveis_sexo</code>) com o objetivo de guardar essas informações.</p>
<p></p>
<div class="sourceCode" id="cb1049"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">niveis_sexo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Homem"</span>, <span class="st">"Mulher"</span><span class="op">)</span></code></pre></div>
<p></p>
<p>Agora que temos o vetor com a informação original (<code>entrevista</code>) e um vetor com os níveis, ou, os valores permitidos para essa variável (<code>niveis_sexo</code>), podemos criar o nosso fator através da função <code><a href="https://rdrr.io/r/base/factor.html">factor()</a></code>.</p>
<p></p>
<div class="sourceCode" id="cb1050"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">vec_fator</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">entrevista</span>, levels <span class="op">=</span> <span class="va">niveis_sexo</span><span class="op">)</span>
<span class="va">vec_fator</span></code></pre></div>
<pre><code>## [1] Mulher Homem  Homem  Mulher &lt;NA&gt;  
## Levels: Homem Mulher</code></pre>
<p></p>
<p>Perceba acima, que ao chamarmos pelo novo fator criado, os níveis da variável (atributo <code>levels</code>) são mostrados logo abaixo dos valores armazenados. Repare também, que todos os valores presentes no vetor original (<code>entrevista</code>) e que estejam fora dos níveis da variável (<code>niveis_sexo</code>) são silenciosamente convertidos para valores <code>NA</code>. Isto é, qualquer valor que esteja minimamente divergente dos valores presentes em <code>levels</code>, ou que contenha algum erro ortográfico, será convertido para um valor <code>NA</code>.</p>
<p>Você sempre pode acessar os níveis (isto é, o atributo <code>levels</code>) de um fator por meio da função <code><a href="https://rdrr.io/r/base/levels.html">levels()</a></code>. Basta aplicá-la diretamente sobre o fator, que um vetor contendo esses níveis será retornado para você.</p>
<p></p>
<div class="sourceCode" id="cb1052"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">vec_fator</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "Homem"  "Mulher"</code></pre>
<p></p>
<p>Vale destacar, que para o R, um vetor do tipo <code>factor</code>, é na verdade, um vetor do tipo <code>integer</code> que carrega uma classe <code>factor</code>, e que possui um atributo chamado <code>levels</code>. Esse é um dos principais motivos pelos quais os tipos <code>factor</code>, <code>Date</code> e <code>POSIXct</code> são caracterizados como tipos “mais complexos” da linguagem R. Pois esses tipos são construídos a partir dos quatro tipos básicos, mas eles também acumulam novas características ou propriedades que não estão presentes nesses tipos básicos.</p>
<p>No caso do tipo <code>factor</code>, ele é construído a partir do tipo <code>integer</code> devido a forma como o R guarda os valores presentes em um vetor do tipo <code>factor</code> <span class="citation">(<a href="refer%C3%AAncias.html#ref-Rlanguage" role="doc-biblioref">R Core Team 2020b</a>, p 8)</span>. Por exemplo, os valores “Homem” e “Mulher” do vetor <code>vec_fator</code> acima, são guardados pelo R como valores 1 e 2, e são posteriormente traduzidos como valores “Homem” e “Mulher” quando chamamos pelo vetor <code>vec_fator</code>. Tudo isso ocorre, devido às propriedades e atributos que um vetor do tipo <code>factor</code> carrega, e que o diferenciam de um vetor do tipo <code>integer</code>.</p>
<p></p>
<div class="sourceCode" id="cb1054"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/typeof.html">typeof</a></span><span class="op">(</span><span class="va">vec_fator</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "integer"</code></pre>
<div class="sourceCode" id="cb1056"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">vec_fator</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "factor"</code></pre>
<div class="sourceCode" id="cb1058"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/attributes.html">attributes</a></span><span class="op">(</span><span class="va">vec_fator</span><span class="op">)</span></code></pre></div>
<pre><code>## $levels
## [1] "Homem"  "Mulher"
## 
## $class
## [1] "factor"</code></pre>
<p></p>
</div>
<div id="porque-utilizar-fatores-se-eu-posso-armazenar-como-texto" class="section level2" number="11.4">
<h2>
<span class="header-section-number">11.4</span> Porque utilizar fatores se eu posso armazenar como texto ?<a class="anchor" aria-label="anchor" href="#porque-utilizar-fatores-se-eu-posso-armazenar-como-texto"><i class="fas fa-link"></i></a>
</h2>
<p>Você provavelmente está se perguntando qual a necessidade verdadeira dos fatores, levando em conta que você pode utilizar o tipo <code>character</code> para armazenar os dados de um variável qualitativa. <span class="citation"><a href="refer%C3%AAncias.html#ref-wickham2017" role="doc-biblioref">Wickham and Grolemund</a> (<a href="refer%C3%AAncias.html#ref-wickham2017" role="doc-biblioref">2017</a>, p 224)</span> nos concede um ótimo exemplo de como um fator pode fazer toda a diferença.</p>
<p>Por exemplo, suponha que você possua o vetor abaixo contendo alguns meses do ano. Em geral, há dois problemas no uso de um vetor do tipo <code>character</code> para guardar essas informações.</p>
<p></p>
<div class="sourceCode" id="cb1060"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">vec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Mar"</span>, <span class="st">"Fev"</span>, <span class="st">"Jan"</span>, <span class="st">"Set"</span>, <span class="st">"Out"</span>, <span class="st">"Abr"</span><span class="op">)</span></code></pre></div>
<p></p>
<p>Primeiro, você não está prevenido contra possíveis erros ortográficos. Isso pode ser um problema de pouca importância caso esses dados estejam sendo gerados por uma máquina ou programa, mas ele se torna um problema sério caso você esteja anotando esses valores na mão, ou esteja constantemente corrigindo-os de alguma maneira que seja suscetível ao erro. Logo, se algum mês for incorretamente gravado, nenhum erro ou medida cautelar será acionada pelo R para corrigir esse problema.</p>
<p>Segundo, quando essas informações estão sendo guardadas pelo tipo <code>character</code>, o sistema de ordenação utilizado pelo R (ordenação alfabética) é de pouca utilidade. Como você pode ver abaixo, o R acabou colocando o mês de Abril antes dos meses de Fevereiro e Janeiro.</p>
<p></p>
<div class="sourceCode" id="cb1061"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="va">vec</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "Abr" "Fev" "Jan" "Mar" "Out" "Set"</code></pre>
<p></p>
<p>O uso do tipo <code>factor</code> consegue resolver ambos desses problemas. Pois você já sabe que qualquer valor disposto em <code>vec</code>, que possua algum erro ortográfico em comparação com os meses dispostos no atributo <code>levels</code> do fator será automaticamente convertido para um valor <code>NA</code>. Além disso, <strong>ao ordenar um objeto do tipo <code>factor</code>, o R sempre vai utilizar como referência, a ordem na qual os valores estão apresentados no atributo <code>levels</code>.</strong></p>
<p>Como o vetor <code>vec</code> guarda alguns meses do ano, o vetor <code>meses</code> abaixo, representa o atributo <code>levels</code> do fator a ser criado a partir de <code>vec</code>. Lembre-se que, a ordem na qual os meses estão dispostos no atributo <code>levels</code>, afeta diretamente a maneira como o R ordena o fator. Logo, a ordem em que você fornece os valores em <code>meses</code>, será a ordem utilizada pelo R ao ordenar os valores de <code>vec_fator</code>.</p>
<p></p>
<div class="sourceCode" id="cb1063"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">meses</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Jan"</span>, <span class="st">"Fev"</span>, <span class="st">"Mar"</span>, <span class="st">"Abr"</span>, <span class="st">"Mai"</span>, <span class="st">"Jun"</span>,
           <span class="st">"Jul"</span>, <span class="st">"Ago"</span>, <span class="st">"Set"</span>, <span class="st">"Out"</span>, <span class="st">"Nov"</span>, <span class="st">"Dez"</span><span class="op">)</span>

<span class="va">vec_fator</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">vec</span>, levels <span class="op">=</span> <span class="va">meses</span><span class="op">)</span>
<span class="va">vec_fator</span></code></pre></div>
<pre><code>## [1] Mar Fev Jan Set Out Abr
## Levels: Jan Fev Mar Abr Mai Jun Jul Ago Set Out Nov Dez</code></pre>
<div class="sourceCode" id="cb1065"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="va">vec_fator</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] Jan Fev Mar Abr Set Out
## Levels: Jan Fev Mar Abr Mai Jun Jul Ago Set Out Nov Dez</code></pre>
<p></p>
</div>
<div id="não-construir-o-atributo-levels-é-contraintuitivo" class="section level2" number="11.5">
<h2>
<span class="header-section-number">11.5</span> Não construir o atributo <code>levels</code> é contraintuitivo<a class="anchor" aria-label="anchor" href="#n%C3%A3o-construir-o-atributo-levels-%C3%A9-contraintuitivo"><i class="fas fa-link"></i></a>
</h2>
<p>Apesar de ser o ideal, você não precisa obrigatoriamente construir o atributo <code>levels</code> ao formar um fator. Pois você tem a opção de delegar esse trabalho para a própria função <code><a href="https://rdrr.io/r/base/factor.html">factor()</a></code>, ao aplicá-la diretamente sobre o seu vetor de interesse.</p>
<p>Porém, ao escolher esse caminho, <code><a href="https://rdrr.io/r/base/factor.html">factor()</a></code> vai extrair todos os valores únicos de seu vetor, e posicioná-los em ordem alfabética no atributo <code>levels</code>. Ou seja, supondo que o seu vetor de interesse se chame <code>x</code>, é como se o atributo <code>levels</code> de seu fator, equivalesse ao resultado dos comandos: <code>unique(x) %&gt;% sort()</code>; ou de outra forma: <code><a href="https://rdrr.io/r/base/sort.html">sort(unique(x))</a></code>. Veja o exemplo abaixo:</p>
<p></p>
<div class="sourceCode" id="cb1067"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">v_letras</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"e"</span>, <span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>, <span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"d"</span><span class="op">)</span>
<span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">v_letras</span><span class="op">)</span>
<span class="va">f</span></code></pre></div>
<pre><code>## [1] e a b c a b d
## Levels: a b c d e</code></pre>
<div class="sourceCode" id="cb1069"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] a a b b c d e
## Levels: a b c d e</code></pre>
<p></p>
<p>Perceba acima, que tal comportamento de <code><a href="https://rdrr.io/r/base/factor.html">factor()</a></code> torna o uso de fatores, algo inútil ou desnecessário. Pois a ordenação de seu fator será idêntica à ordenação alfabética utilizada sobre um vetor do tipo <code>character</code>. Lembre-se que para a ordenação de um fator, é utilizada a ordem na qual os valores são apresentados em <code><a href="https://rdrr.io/r/base/levels.html">levels()</a></code>. Tal ponto pode ser inferido pelo exemplo abaixo, em que a ordenação produzida sobre os valores de <code>v_letras</code> é a mesma (em comparação com o resultado acima) quando ela se encontra no tipo <code>character</code>.</p>
<p></p>
<div class="sourceCode" id="cb1071"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">v_letras</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"e"</span>, <span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>, <span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"d"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/typeof.html">typeof</a></span><span class="op">(</span><span class="va">v_letras</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "character"</code></pre>
<div class="sourceCode" id="cb1073"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="va">v_letras</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "a" "a" "b" "b" "c" "d" "e"</code></pre>
<p></p>
</div>
<div id="alterando-a-ordem-dos-níveis-de-um-fator" class="section level2" number="11.6">
<h2>
<span class="header-section-number">11.6</span> Alterando a ordem dos níveis de um fator<a class="anchor" aria-label="anchor" href="#alterando-a-ordem-dos-n%C3%ADveis-de-um-fator"><i class="fas fa-link"></i></a>
</h2>
<p>Portanto, o sistema de ordenação é um dos principais recursos do tipo <code>factor</code> no R, e tal sistema está diretamente conectado com o seu atributo <code>levels</code>. Por isso, uma das principais atividades com fatores está na reordenação e do atributo <code>levels</code>, ou em sua reatribuição.</p>
<div id="a-maneira-mais-simples-e-direta" class="section level3" number="11.6.1">
<h3>
<span class="header-section-number">11.6.1</span> A maneira mais simples e direta<a class="anchor" aria-label="anchor" href="#a-maneira-mais-simples-e-direta"><i class="fas fa-link"></i></a>
</h3>
<p>A forma mais “simples” de alterarmos esse atributo é redefinindo-o por completo através da função <code><a href="https://rdrr.io/r/base/levels.html">levels()</a></code>. Repare no exemplo abaixo, que apenas a letra “a” foi reposicionada no atributo.</p>
<p></p>
<div class="sourceCode" id="cb1075"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"b"</span>, <span class="st">"c"</span>, <span class="st">"d"</span>, <span class="st">"e"</span>, <span class="st">"a"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] b b c c d e a
## Levels: b c d e a</code></pre>
<p></p>
<p>Tal operação poderia ser realizada de diversas formas. Por exemplo, caso o seu fator possua um número muito grande de níveis, ao invés de reescrevê-los na mão, talvez seja mais rápido utilizar técnicas de <em>subsetting</em> para reordenar os níveis da maneira desejada.</p>
<p></p>
<div class="sourceCode" id="cb1077"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Criando um fator com muitos níveis</span>
<span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>, <span class="st">"d"</span>, <span class="st">"e"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
  <span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>, <span class="st">"d"</span>, <span class="st">"e"</span>, <span class="st">"f"</span>, <span class="st">"g"</span>,
  <span class="st">"h"</span>, <span class="st">"i"</span>, <span class="st">"j"</span>, <span class="st">"k"</span>, <span class="st">"l"</span>, <span class="st">"m"</span>, <span class="st">"n"</span>,
  <span class="st">"o"</span>, <span class="st">"p"</span>, <span class="st">"q"</span>, <span class="st">"r"</span>, <span class="st">"s"</span>, <span class="st">"t"</span>, <span class="st">"u"</span>,
  <span class="st">"v"</span>, <span class="st">"w"</span>, <span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"z"</span>
<span class="op">)</span>

<span class="co">## Selecionando os níveis atuais</span>
<span class="co">## e reordenando-os com subsetting</span>
<span class="va">niveis_atuais</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span>
<span class="va">n_niveis</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">niveis_atuais</span><span class="op">)</span>
<span class="va">novos_niveis</span> <span class="op">&lt;-</span> <span class="va">niveis_atuais</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span><span class="op">:</span><span class="fl">2</span>, <span class="fl">5</span><span class="op">:</span><span class="va">n_niveis</span>, <span class="fl">1</span><span class="op">)</span><span class="op">]</span>

<span class="co">## Redefinindo os níveis do fator</span>
<span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">novos_niveis</span>
<span class="va">f</span></code></pre></div>
<pre><code>## [1] "a" "b" "c" "d" "e"
## attr(,"levels")
##  [1] "d" "c" "b" "e" "f" "g" "h" "i" "j" "k" "l" "m" "n" "o" "p" "q" "r"
## [18] "s" "t" "u" "v" "w" "x" "y" "z" "a"</code></pre>
<p></p>
</div>
<div id="maneiras-alternativas-que-podem-fazer-a-diferença" class="section level3" number="11.6.2">
<h3>
<span class="header-section-number">11.6.2</span> Maneiras alternativas que podem fazer a diferença<a class="anchor" aria-label="anchor" href="#maneiras-alternativas-que-podem-fazer-a-diferen%C3%A7a"><i class="fas fa-link"></i></a>
</h3>
<p>O pacote <code>forcats</code> oferece várias funções voltadas especificamente para o trabalho com fatores no R. Dentre essas funções, temos a <code><a href="https://forcats.tidyverse.org/reference/fct_inorder.html">fct_infreq()</a></code>, que lhe permite reordenar o atributo <code>levels</code> de acordo com a frequência em que cada nível aparece no vetor (do nível mais frequente para o menos frequente).</p>
<p></p>
<div class="sourceCode" id="cb1079"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">v_letras</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"e"</span>, <span class="st">"d"</span>, <span class="st">"d"</span>, <span class="st">"c"</span>, <span class="st">"a"</span>, <span class="st">"a"</span>, <span class="st">"a"</span>, <span class="st">"c"</span>,
              <span class="st">"b"</span>, <span class="st">"d"</span>, <span class="st">"d"</span>, <span class="st">"e"</span>, <span class="st">"d"</span>, <span class="st">"a"</span>, <span class="st">"d"</span>, <span class="st">"c"</span><span class="op">)</span>
<span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">v_letras</span><span class="op">)</span>
<span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_inorder.html">fct_infreq</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span></code></pre></div>
<pre><code>##  [1] e d d c a a a c b d d e d a d c
## Levels: d a c e b</code></pre>
<p></p>
<p>Além disso, você também pode estar interessado em ordenar os níveis de um fator, de acordo com a ordem da primeira aparição de cada nível. Para isso, nós podemos utilizar a função <code><a href="https://forcats.tidyverse.org/reference/fct_inorder.html">fct_inorder()</a></code>. Perceba pelo resultado do exemplo abaixo, que as letras “e,” “d” e “c” antecedem as letras “a” e “b” no atributo <code>levels</code> do fator gerado, pois essas letras aparecem primeiro no vetor original.</p>
<p></p>
<div class="sourceCode" id="cb1081"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_inorder.html">fct_inorder</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span></code></pre></div>
<pre><code>##  [1] e d d c a a a c b d d e d a d c
## Levels: e d c a b</code></pre>
<p></p>
<p>Para mais, haverá momentos em que você deseja ordenar os níveis de seu fator, de acordo com uma segunda variável. Essa situação ocorre principalmente quando o seu fator está incluso em um <code>data.frame</code>, junto de várias outras variáveis de seu interesse. Para tal ação, temos a função <code><a href="https://forcats.tidyverse.org/reference/fct_reorder.html">fct_reorder()</a></code>, que lhe permite fornecer uma segunda variável na qual a ordenação do atributo <code>levels</code> será baseada.</p>
<p>Como exemplo, suponha que você possua a seguinte tabela contendo receitas mensais de algums lojas:</p>
<p></p>
<div class="sourceCode" id="cb1083"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">unidades</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Savassi"</span>, <span class="st">"Centro"</span>, <span class="st">"Gameleira"</span>, <span class="st">"Pampulha"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span>
<span class="va">tab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>
  ano <span class="op">=</span> <span class="fl">2021</span>,
  mes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">12</span>, each <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>,
  unidade <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="va">unidades</span>, times <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>,
  receita <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">48</span>, <span class="fl">17000</span>, <span class="fl">4800</span><span class="op">)</span>
<span class="op">)</span>
<span class="va">tab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">tab</span>, <span class="va">mes</span>, <span class="va">unidade</span><span class="op">)</span>
<span class="va">tab</span></code></pre></div>
<pre><code>## # A tibble: 48 x 4
##      ano   mes unidade   receita
##    &lt;dbl&gt; &lt;int&gt; &lt;chr&gt;       &lt;dbl&gt;
##  1  2021     1 Centro     15596.
##  2  2021     1 Gameleira  18242.
##  3  2021     1 Pampulha   11470.
##  4  2021     1 Savassi    12383.
##  5  2021     2 Centro     17145.
##  6  2021     2 Gameleira  17410.
##  7  2021     2 Pampulha   22360.
##  8  2021     2 Savassi    17940.
##  9  2021     3 Centro     23083.
## 10  2021     3 Gameleira  13425.
## # ... with 38 more rows</code></pre>
<p></p>
<p>No exemplo abaixo, ao transformarmos a variável <code>unidade</code> em um fator, os níveis da variável são organizados em ordem alfabética, como era esperado.</p>
<p></p>
<div class="sourceCode" id="cb1085"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tab</span><span class="op">$</span><span class="va">unidade</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">tab</span><span class="op">$</span><span class="va">unidade</span><span class="op">)</span>
<span class="va">tab</span><span class="op">$</span><span class="va">unidade</span></code></pre></div>
<pre><code>##  [1] Centro    Gameleira Pampulha  Savassi   Centro    Gameleira Pampulha 
##  [8] Savassi   Centro    Gameleira Pampulha  Savassi   Centro    Gameleira
## [15] Pampulha  Savassi   Centro    Gameleira Pampulha  Savassi   Centro   
## [22] Gameleira Pampulha  Savassi   Centro    Gameleira Pampulha  Savassi  
## [29] Centro    Gameleira Pampulha  Savassi   Centro    Gameleira Pampulha 
## [36] Savassi   Centro    Gameleira Pampulha  Savassi   Centro    Gameleira
## [43] Pampulha  Savassi   Centro    Gameleira Pampulha  Savassi  
## Levels: Centro Gameleira Pampulha Savassi</code></pre>
<p></p>
<p>A função <code><a href="https://forcats.tidyverse.org/reference/fct_reorder.html">fct_reorder()</a></code> vai sempre ordenar o seu fator de acordo com um sumário, ou alguma estatística descritiva da segunda variável. Por isso, você deve se perguntar qual estatística descritiva você deseja utilizar sobre a segunda variável em questão. Como exemplo, você talvez queira ordenar os níveis de <code>unidade</code>, de acordo com a receita média mensal de cada loja.</p>
<p>Logo, desejamos aplicar uma função de média sobre a variável <code>receita</code> ao longo de cada nível do fator <code>unidade</code>. Por isso, eu forneço a função <code><a href="https://rdrr.io/r/base/mean.html">mean()</a></code> ao argumento <code>.fun</code> de <code><a href="https://forcats.tidyverse.org/reference/fct_reorder.html">fct_reorder()</a></code>. Como podemos ver abaixo, as unidades do Centro e da Savassi possuem receitas médias menores do que unidades da Pampulha e da Gameleira, pois essas unidades se encontram nas primeiras posições do atributo <code>levels</code> do fator resultante de <code><a href="https://forcats.tidyverse.org/reference/fct_reorder.html">fct_reorder()</a></code>. Ou seja, a função <code><a href="https://forcats.tidyverse.org/reference/fct_reorder.html">fct_reorder()</a></code> utiliza, por padrão, uma ordem crescente no atributo <code>levels</code>. Caso você deseje inverter esse comportamento, basta configurar o argumento <code>.desc</code> da função para <code>TRUE</code>.</p>
<p></p>
<div class="sourceCode" id="cb1087"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Utilize: fct_reorder(unidade, receita, .fun = mean, .desc = TRUE)</span>
<span class="co">## para utilizar uma ordenação crescente no atributo levels</span>
<span class="va">tab</span> <span class="op">&lt;-</span> <span class="va">tab</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>
    unidade <span class="op">=</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_reorder.html">fct_reorder</a></span><span class="op">(</span><span class="va">unidade</span>, <span class="va">receita</span>, .fun <span class="op">=</span> <span class="va">mean</span><span class="op">)</span>
  <span class="op">)</span>

<span class="va">tab</span><span class="op">$</span><span class="va">unidade</span></code></pre></div>
<pre><code>##  [1] Centro    Gameleira Pampulha  Savassi   Centro    Gameleira Pampulha 
##  [8] Savassi   Centro    Gameleira Pampulha  Savassi   Centro    Gameleira
## [15] Pampulha  Savassi   Centro    Gameleira Pampulha  Savassi   Centro   
## [22] Gameleira Pampulha  Savassi   Centro    Gameleira Pampulha  Savassi  
## [29] Centro    Gameleira Pampulha  Savassi   Centro    Gameleira Pampulha 
## [36] Savassi   Centro    Gameleira Pampulha  Savassi   Centro    Gameleira
## [43] Pampulha  Savassi   Centro    Gameleira Pampulha  Savassi  
## Levels: Centro Savassi Pampulha Gameleira</code></pre>
<p></p>
</div>
</div>
<div id="reordenando-fatores-em-gráficos" class="section level2" number="11.7">
<h2>
<span class="header-section-number">11.7</span> Reordenando fatores em gráficos<a class="anchor" aria-label="anchor" href="#reordenando-fatores-em-gr%C3%A1ficos"><i class="fas fa-link"></i></a>
</h2>
<p>A ordem na qual apresentamos certas informações pode mudar drasticamente não apenas as características físicas e visuais de seu gráfico, mas também, pode afetar e muito a clareza ou a ênfase em certas informações que são cruciais em nosso gráfico. Por essa razão, reordenar variáveis categóricas em seu gráfico pode ser fundamental. Veja o primeiro exemplo abaixo, dado por <span class="citation"><a href="refer%C3%AAncias.html#ref-wickham2017" role="doc-biblioref">Wickham and Grolemund</a> (<a href="refer%C3%AAncias.html#ref-wickham2017" role="doc-biblioref">2017</a>, p 228)</span>.</p>
<p>Dentre as funções que mostramos na seção passada, a função <code><a href="https://forcats.tidyverse.org/reference/fct_reorder.html">fct_reorder()</a></code> é talvez a mais útil delas em gráficos. Por exemplo, no gráfico abaixo, temos certa dificuldade em comparar e, principalmente, classificar os vários tempos médios gastos dentro de cada grupo religioso.</p>
<p></p>
<div class="sourceCode" id="cb1089"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">relig</span> <span class="op">&lt;-</span> <span class="va">gss_cat</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">relig</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>
    age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">age</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
    tvhours <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">tvhours</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
    n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>
  <span class="op">)</span>

<span class="va">relig</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">tvhours</span>, <span class="va">relig</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="Introducao_R_files/figure-html/unnamed-chunk-653-1.png" width="65%" style="display: block; margin: auto;"></div>
<p></p>
<p>Tal problema, pode ser rapidamente resolvido ao aplicarmos a função <code><a href="https://forcats.tidyverse.org/reference/fct_reorder.html">fct_reorder()</a></code> sobre a variável no eixo y, para que ela seja reordenada de acordo com os valores da variável do eixo x do gráfico. Perceba abaixo, que agora temos uma facilidade muito maior em comparar e classificar os vários tempos médios gastos em cada grupo religioso. Com essa nova ordenação, podemos rapidamente identificar que as pessoas que não sabem (<em>“Don’t know”</em>) a sua religião (ou que são ateus), são aquelas que mais gastam seu tempo em frente a uma televisão.</p>
<p></p>
<div class="sourceCode" id="cb1090"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">relig</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">tvhours</span>, <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_reorder.html">fct_reorder</a></span><span class="op">(</span><span class="va">relig</span>, <span class="va">tvhours</span><span class="op">)</span><span class="op">)</span>
  <span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="Introducao_R_files/figure-html/unnamed-chunk-654-1.png" width="65%" style="display: block; margin: auto;"></div>
<p></p>
<p>Como um outro exemplo, pode haver certas variáveis que não necessitam de uma reordenação acentuada. Além disso, tais variáveis podem possuir uma ordem própria, que não depende de uma segunda variável. Ou seja, essas variáveis podem possuir uma “ordem natural.” Essa característica, torna o uso de <code><a href="https://forcats.tidyverse.org/reference/fct_reorder.html">fct_reorder()</a></code> inadequado (lembre-se que <code><a href="https://forcats.tidyverse.org/reference/fct_reorder.html">fct_reorder()</a></code> busca reordenar um fator de acordo com os valores de uma segunda variável).</p>
<p>Por exemplo, se você olhar para o gráfico abaixo, você poderá perceber que temos uma variável de faixa etária no eixo y, e que apenas a faixa de “Menos de 10” está incorretamente posicionada no eixo. Pelo fato das faixas etárias possuírem uma “ordem natural,” isto é, as faixas “mais altas” são aquelas referentes às idades mais elevadas, enquanto as faixas “mais baixas” são aquelas referentes às idades “mais baixas,” não faz sentido reordenarmos essa variável de acordo com os valores de uma segunda variável.</p>
<p></p>
<div class="sourceCode" id="cb1091"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">github</span> <span class="op">&lt;-</span> <span class="st">"https://raw.githubusercontent.com/pedropark99/"</span>
<span class="va">arquivo</span> <span class="op">&lt;-</span> <span class="st">"Curso-R/master/Dados/datasus.csv"</span>
<span class="va">datasus</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv2</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">github</span>, <span class="va">arquivo</span><span class="op">)</span><span class="op">)</span>

<span class="va">totais</span> <span class="op">&lt;-</span> <span class="va">datasus</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">`Faixa etaria`</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>
    Total <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">Contagem</span><span class="op">)</span>
  <span class="op">)</span></code></pre></div>
<p></p>
<p></p>
<div class="sourceCode" id="cb1092"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">totais</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span><span class="op">(</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">`Faixa etaria`</span>, x <span class="op">=</span> <span class="va">Total</span><span class="op">)</span>
  <span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="Introducao_R_files/figure-html/unnamed-chunk-657-1.png" width="65%" style="display: block; margin: auto;"></div>
<p></p>
<p>Portanto, a faixa de “Menos de 10” é a única faixa a ser reposicionada, e podemos realizar tal ação com a função <code><a href="https://forcats.tidyverse.org/reference/fct_relevel.html">fct_relevel()</a></code>. Repare no exemplo abaixo, que após o ajuste, a faixa “Menos de 10” foi realocada para a posição mais inferior do eixo.</p>
<p></p>
<div class="sourceCode" id="cb1093"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">totais</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>
    `Faixa etaria` <span class="op">=</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_relevel.html">fct_relevel</a></span><span class="op">(</span><span class="va">`Faixa etaria`</span>, <span class="st">"Menos de 10"</span><span class="op">)</span>
  <span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span><span class="op">(</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">`Faixa etaria`</span>, x <span class="op">=</span> <span class="va">Total</span><span class="op">)</span>
  <span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="Introducao_R_files/figure-html/unnamed-chunk-658-1.png" width="65%" style="display: block; margin: auto;"></div>
<p></p>
<p>Além dessas opções, a função <code><a href="https://forcats.tidyverse.org/reference/fct_inorder.html">fct_infreq()</a></code> é muito útil para gráficos de barras do <code>ggplot</code>, que incluem por padrão um cálculo de frequência. Em outras palavras, ao lembrarmos que <code><a href="https://forcats.tidyverse.org/reference/fct_inorder.html">fct_infreq()</a></code> busca reordenar um fator de acordo com a frequência em que os seus níveis aparecem em seus dados, se torna muito natural aliarmos essa função a um gráfico de barras do <code>ggplot</code>.</p>
<p>Por exemplo, se gerarmos um gráfico de barras a partir de cada cor de pele presente em nossa tabela <code>datasus</code>, temos o seguinte resultado:</p>
<p></p>
<div class="sourceCode" id="cb1094"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">datasus</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Cor</span><span class="op">)</span>
  <span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="Introducao_R_files/figure-html/unnamed-chunk-659-1.png" width="65%" style="display: block; margin: auto;"></div>
<p></p>
<p>Agora, com o uso de <code><a href="https://forcats.tidyverse.org/reference/fct_inorder.html">fct_infreq()</a></code> podemos reposicionar essas barras em um sentido mais lógico, como está demonstrado abaixo:</p>
<p></p>
<div class="sourceCode" id="cb1095"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">datasus</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_inorder.html">fct_infreq</a></span><span class="op">(</span><span class="va">Cor</span><span class="op">)</span><span class="op">)</span>
  <span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="Introducao_R_files/figure-html/unnamed-chunk-660-1.png" width="65%" style="display: block; margin: auto;"></div>
<p></p>
</div>
<div id="modificando-os-níveis-de-um-fator" class="section level2" number="11.8">
<h2>
<span class="header-section-number">11.8</span> Modificando os níveis de um fator<a class="anchor" aria-label="anchor" href="#modificando-os-n%C3%ADveis-de-um-fator"><i class="fas fa-link"></i></a>
</h2>
<p>Até o momento, demos bastante foco sobre a ordenação dos valores presentes no atributo <code>levels</code>. Justamente pelo fato de que essa característica define uma das principais vantagens do tipo <code>factor</code> no R, que é a de modificar a forma como a linguagem ordena os valores presentes em um vetor. Porém, ainda não discutimos o que ocorre quando nós deliberadamente alteramos um dos valores presentes no atributo <code>levels</code>.</p>
<p>Por exemplo, suponha que eu possua o fator abaixo. Nesse caso, o fator <code>f</code> possui quatro níveis, sendo eles: <code>a</code>, <code>b</code>, <code>c</code>, e <code>d</code>.</p>
<p></p>
<div class="sourceCode" id="cb1096"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">vec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"c"</span>, <span class="st">"c"</span>, <span class="st">"d"</span>, <span class="st">"b"</span>, <span class="st">"a"</span>, <span class="st">"b"</span><span class="op">)</span>
<span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">vec</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>, <span class="st">"d"</span><span class="op">)</span><span class="op">)</span>
<span class="va">f</span></code></pre></div>
<pre><code>## [1] a c c d b a b
## Levels: a b c d</code></pre>
<p></p>
<p>Agora, o que ocorre se eu tentar modificar o primeiro nível (<code>a</code>) desse fator? De maneira elegante e surpreendente, o R irá substituir todos os valores <code>a</code> presentes no fator, pelo novo valor definido, como está demonstrado abaixo:</p>
<p></p>
<div class="sourceCode" id="cb1098"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"m"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>, <span class="st">"d"</span><span class="op">)</span>
<span class="va">f</span></code></pre></div>
<pre><code>## [1] m c c d b m b
## Levels: m b c d</code></pre>
<p></p>
<p>Assim como nas seções anteriores, o pacote <code>forcats</code> também oferece algumas funções muito úteis para esse procedimento. Veja o exemplo abaixo, em que eu utilizo a função <code><a href="https://forcats.tidyverse.org/reference/fct_recode.html">fct_recode()</a></code> para reconfigurar todos os níveis (ou valores) presentes coluna <code>Cor</code> em nossa tabela <code>datasus</code>.</p>
<p></p>
<div class="sourceCode" id="cb1100"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">datasus</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>
    Cor <span class="op">=</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_recode.html">fct_recode</a></span><span class="op">(</span>
      <span class="va">Cor</span>,
      <span class="st">"Carmim"</span> <span class="op">=</span> <span class="st">"Parda"</span>,
      <span class="st">"Azul"</span> <span class="op">=</span> <span class="st">"Amarela"</span>,
      <span class="st">"Bronze"</span> <span class="op">=</span> <span class="st">"Branca"</span>,
      <span class="st">"Roxo"</span> <span class="op">=</span> <span class="st">"Indígena"</span>
    <span class="op">)</span>
  <span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 1,836 x 6
##    `Faixa etaria` Genero    Cor    `Nome UF` UF    Contagem
##    &lt;chr&gt;          &lt;chr&gt;     &lt;fct&gt;  &lt;chr&gt;     &lt;chr&gt;    &lt;dbl&gt;
##  1 10 a 14        Feminino  Carmim Acre      AC           4
##  2 10 a 14        Masculino Carmim Acre      AC           4
##  3 15 a 19        Feminino  Bronze Acre      AC           2
##  4 15 a 19        Feminino  Carmim Acre      AC           4
##  5 15 a 19        Masculino Bronze Acre      AC           6
##  6 15 a 19        Masculino Carmim Acre      AC          65
##  7 15 a 19        Masculino Preta  Acre      AC           1
##  8 20 a 24        Feminino  Roxo   Acre      AC           1
##  9 20 a 24        Feminino  Carmim Acre      AC           4
## 10 20 a 24        Masculino Bronze Acre      AC           7
## # ... with 1,826 more rows</code></pre>
<p></p>
<p>Caso você precise unir diversos níveis em um só, ou, em outras palavras, se você precisa agregar vários níveis, a função <code><a href="https://forcats.tidyverse.org/reference/fct_collapse.html">fct_collapse()</a></code> é uma melhor escolha. Pois ela lhe permite fornecer um vetor contendo todos os níveis antigos a serem agregados em um só. Veja o exemplo abaixo, em que eu agrego diversas faixas etárias, gerando assim, uma descrição etária menos detalhada:</p>
<p></p>
<div class="sourceCode" id="cb1102"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">datasus</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>
    `Faixa etaria` <span class="op">=</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_collapse.html">fct_collapse</a></span><span class="op">(</span>
      <span class="va">`Faixa etaria`</span>,
      <span class="st">"Menos de 19 anos"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Menos de 10"</span>, <span class="st">"10 a 14"</span>, <span class="st">"15 a 19"</span><span class="op">)</span>,
      <span class="st">"Entre 20 e 64 anos"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"20 a 24"</span>, <span class="st">"25 a 29"</span>, <span class="st">"30 a 34"</span>,
                               <span class="st">"35 a 39"</span>, <span class="st">"40 a 44"</span>, <span class="st">"45 a 49"</span>,
                               <span class="st">"50 a 54"</span>, <span class="st">"55 a 59"</span>, <span class="st">"60 a 64"</span><span class="op">)</span>,
      <span class="st">"Acima de 64 anos"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"65 a 69"</span>, <span class="st">"Mais de 70"</span><span class="op">)</span>
    <span class="op">)</span>
  <span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 1,836 x 6
##    `Faixa etaria`     Genero    Cor      `Nome UF` UF    Contagem
##    &lt;fct&gt;              &lt;chr&gt;     &lt;chr&gt;    &lt;chr&gt;     &lt;chr&gt;    &lt;dbl&gt;
##  1 Menos de 19 anos   Feminino  Parda    Acre      AC           4
##  2 Menos de 19 anos   Masculino Parda    Acre      AC           4
##  3 Menos de 19 anos   Feminino  Branca   Acre      AC           2
##  4 Menos de 19 anos   Feminino  Parda    Acre      AC           4
##  5 Menos de 19 anos   Masculino Branca   Acre      AC           6
##  6 Menos de 19 anos   Masculino Parda    Acre      AC          65
##  7 Menos de 19 anos   Masculino Preta    Acre      AC           1
##  8 Entre 20 e 64 anos Feminino  Indígena Acre      AC           1
##  9 Entre 20 e 64 anos Feminino  Parda    Acre      AC           4
## 10 Entre 20 e 64 anos Masculino Branca   Acre      AC           7
## # ... with 1,826 more rows</code></pre>
<p></p>

</div>
</div>

  <div class="chapter-nav">
<div class="prev"><a href="manipula%C3%A7%C3%A3o-e-transforma%C3%A7%C3%A3o-de-strings-com-stringr.html"><span class="header-section-number">10</span> Manipulação e transformação de strings com stringr</a></div>
<div class="next"><a href="introdu%C3%A7%C3%A3o-%C3%A0-vari%C3%A1veis-de-tempo-com-lubridate.html"><span class="header-section-number">12</span> Introdução à variáveis de tempo com lubridate</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#introduzindo-fatores-factors-com-forcats"><span class="header-section-number">11</span> Introduzindo fatores (factor’s) com forcats</a></li>
<li><a class="nav-link" href="#introdu%C3%A7%C3%A3o-e-pr%C3%A9-requisitos-5"><span class="header-section-number">11.1</span> Introdução e pré-requisitos</a></li>
<li><a class="nav-link" href="#o-que-s%C3%A3o-fatores"><span class="header-section-number">11.2</span> O que são fatores ?</a></li>
<li><a class="nav-link" href="#como-construir-um-fator"><span class="header-section-number">11.3</span> Como construir um fator</a></li>
<li><a class="nav-link" href="#porque-utilizar-fatores-se-eu-posso-armazenar-como-texto"><span class="header-section-number">11.4</span> Porque utilizar fatores se eu posso armazenar como texto ?</a></li>
<li><a class="nav-link" href="#n%C3%A3o-construir-o-atributo-levels-%C3%A9-contraintuitivo"><span class="header-section-number">11.5</span> Não construir o atributo levels é contraintuitivo</a></li>
<li>
<a class="nav-link" href="#alterando-a-ordem-dos-n%C3%ADveis-de-um-fator"><span class="header-section-number">11.6</span> Alterando a ordem dos níveis de um fator</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#a-maneira-mais-simples-e-direta"><span class="header-section-number">11.6.1</span> A maneira mais simples e direta</a></li>
<li><a class="nav-link" href="#maneiras-alternativas-que-podem-fazer-a-diferen%C3%A7a"><span class="header-section-number">11.6.2</span> Maneiras alternativas que podem fazer a diferença</a></li>
</ul>
</li>
<li><a class="nav-link" href="#reordenando-fatores-em-gr%C3%A1ficos"><span class="header-section-number">11.7</span> Reordenando fatores em gráficos</a></li>
<li><a class="nav-link" href="#modificando-os-n%C3%ADveis-de-um-fator"><span class="header-section-number">11.8</span> Modificando os níveis de um fator</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/pedropark99/Introducao_R//blob/master/11-factors.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/pedropark99/Introducao_R//edit/master/11-factors.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Introdução à Linguagem R: seus fundamentos e sua prática</strong>" was written by Pedro Faria. It was last built on 2021-07-26.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>
</html>
