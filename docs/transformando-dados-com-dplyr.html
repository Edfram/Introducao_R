<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Capítulo 5 Transformando dados com dplyr | Introdução à Linguagem R: seus fundamentos e sua prática</title>
<meta name="author" content="Pedro Faria">
<meta name="description" content="5.1 Introdução e pré-requisitos São raras as ocasiões em que os seus dados já se encontram no formato exato que você precisa para realizar as suas análises, ou para gerar os gráficos que você...">
<meta name="generator" content="bookdown 0.26.3 with bs4_book()">
<meta property="og:title" content="Capítulo 5 Transformando dados com dplyr | Introdução à Linguagem R: seus fundamentos e sua prática">
<meta property="og:type" content="book">
<meta property="og:url" content="bem-vindo.html/transformando-dados-com-dplyr.html">
<meta property="og:image" content="bem-vindo.html/capa.png">
<meta property="og:description" content="5.1 Introdução e pré-requisitos São raras as ocasiões em que os seus dados já se encontram no formato exato que você precisa para realizar as suas análises, ou para gerar os gráficos que você...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Capítulo 5 Transformando dados com dplyr | Introdução à Linguagem R: seus fundamentos e sua prática">
<meta name="twitter:description" content="5.1 Introdução e pré-requisitos São raras as ocasiões em que os seus dados já se encontram no formato exato que você precisa para realizar as suas análises, ou para gerar os gráficos que você...">
<meta name="twitter:image" content="bem-vindo.html/capa.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.1/transition.js"></script><script src="libs/bs3compat-0.3.1/tabs.js"></script><script src="libs/bs3compat-0.3.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Introdução à Linguagem R: seus fundamentos e sua prática</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Bem vindo!</a></li>
<li><a class="" href="sobre-o-autor.html">Sobre o autor</a></li>
<li><a class="" href="pref%C3%A1cio.html">Prefácio</a></li>
<li class="book-part">Introduzindo a Linguagem R</li>
<li><a class="" href="no%C3%A7%C3%B5es-b%C3%A1sicas-do-r.html"><span class="header-section-number">1</span> Noções Básicas do R</a></li>
<li><a class="" href="fundamentos-da-linguagem-r.html"><span class="header-section-number">2</span> Fundamentos da Linguagem R</a></li>
<li class="book-part">Importando, organizando e transformando dados</li>
<li><a class="" href="introduzindo-o-universo-do-tidyverse.html"><span class="header-section-number">3</span> Introduzindo o universo do tidyverse</a></li>
<li><a class="" href="importando-e-exportando-dados-com-readr-readxl-e-haven.html"><span class="header-section-number">4</span> Importando e exportando dados com readr, readxl e haven</a></li>
<li><a class="active" href="transformando-dados-com-dplyr.html"><span class="header-section-number">5</span> Transformando dados com dplyr</a></li>
<li><a class="" href="introdu%C3%A7%C3%A3o-a-base-de-dados-relacionais-com-dplyr.html"><span class="header-section-number">6</span> Introdução a base de dados relacionais com dplyr</a></li>
<li><a class="" href="tidy-data-uma-abordagem-para-organizar-os-seus-dados-com-tidyr.html"><span class="header-section-number">7</span> Tidy Data: uma abordagem para organizar os seus dados com tidyr</a></li>
<li class="book-part">Visualizando seus dados</li>
<li><a class="" href="visualiza%C3%A7%C3%A3o-de-dados-com-ggplot2.html"><span class="header-section-number">8</span> Visualização de dados com ggplot2</a></li>
<li><a class="" href="configurando-componentes-est%C3%A9ticos-do-gr%C3%A1fico-no-ggplot2.html"><span class="header-section-number">9</span> Configurando componentes estéticos do gráfico no ggplot2</a></li>
<li class="book-part">Ferramentas para tipos específicos de dados</li>
<li><a class="" href="manipula%C3%A7%C3%A3o-e-transforma%C3%A7%C3%A3o-de-strings-com-stringr.html"><span class="header-section-number">10</span> Manipulação e transformação de strings com stringr</a></li>
<li><a class="" href="introduzindo-fatores-factors-com-forcats.html"><span class="header-section-number">11</span> Introduzindo fatores (factor’s) com forcats</a></li>
<li><a class="" href="introdu%C3%A7%C3%A3o-%C3%A0-vari%C3%A1veis-de-tempo-com-lubridate.html"><span class="header-section-number">12</span> Introdução à variáveis de tempo com lubridate</a></li>
<li class="book-part">Funções e Loops: construindo os seus próprios programas e automatizando tarefas</li>
<li><a class="" href="controle-condicional-de-fluxo.html"><span class="header-section-number">13</span> Controle condicional de fluxo</a></li>
<li><a class="" href="fun%C3%A7%C3%B5es.html"><span class="header-section-number">14</span> Funções</a></li>
<li><a class="" href="loops.html"><span class="header-section-number">15</span> Loops</a></li>
<li><a class="" href="functional-programming-com-purrr.html"><span class="header-section-number">16</span> Functional programming com purrr</a></li>
<li><a class="" href="debugging---resolvendo-bugs-em-suas-fun%C3%A7%C3%B5es.html"><span class="header-section-number">17</span> Debugging - Resolvendo bugs em suas funções</a></li>
<li><a class="" href="environments-ou-ambientes-no-r.html"><span class="header-section-number">18</span> Environments ou ambientes no R</a></li>
<li class="book-part">Respostas dos exercícios de cada capítulo</li>
<li><a class="" href="respostas.html">Respostas</a></li>
<li class="book-part">Apêndices</li>
<li><a class="" href="pnad-cont%C3%ADnua-arquivo-csv-para-input.html"><span class="header-section-number">A</span> PNAD Contínua: arquivo CSV para input</a></li>
<li><a class="" href="refer%C3%AAncias.html">Referências</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/pedropark99/Introducao_R/">View book source <i class="fas fa-book-open"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="transformando-dados-com-dplyr" class="section level1" number="5">
<h1>
<span class="header-section-number">Capítulo 5</span> Transformando dados com <code>dplyr</code><a class="anchor" aria-label="anchor" href="#transformando-dados-com-dplyr"><i class="fas fa-link"></i></a>
</h1>
<div id="introdução-e-pré-requisitos" class="section level2" number="5.1">
<h2>
<span class="header-section-number">5.1</span> Introdução e pré-requisitos<a class="anchor" aria-label="anchor" href="#introdu%C3%A7%C3%A3o-e-pr%C3%A9-requisitos"><i class="fas fa-link"></i></a>
</h2>
<p>São raras as ocasiões em que os seus dados já se encontram no formato exato que você precisa para realizar as suas análises, ou para gerar os gráficos que você deseja <span class="citation">(<a href="refer%C3%AAncias.html#ref-wickham2017" role="doc-biblioref">Wickham and Grolemund 2017</a>)</span>. Por essa razão, você irá passar uma parte considerável de seu tempo, aplicando transformações sobre os seus dados, e calculando novas variáveis, e como os seus dados estarão, na maioria das situações, alocados em um <code>data.frame</code>, você precisa de ferramentas que sejam eficientes com tal estrutura <span class="citation">(<a href="refer%C3%AAncias.html#ref-peng2015" role="doc-biblioref">Peng 2015</a>)</span>. Esse é o objetivo do pacote <code>dplyr</code> com o qual vamos trabalhar neste capítulo.</p>
<p>Para que você tenha acesso as funções e possa acompanhar os exemplos desse capítulo, você precisa chamar pelo pacote <code>dplyr</code>. Porém, vamos utilizar algumas bases de dados que estão disponíveis através de outros pacotes presentes no <code>tidyverse</code>. Por isso, é preferível que você chame pelo <code>tidyverse</code> por meio do comando <code><a href="https://rdrr.io/r/base/library.html">library()</a></code>.</p>
<p></p>
<div class="sourceCode" id="cb516"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></code></pre></div>
<p></p>
</div>
<div id="panorama-e-padrões-do-pacote-dplyr" class="section level2" number="5.2">
<h2>
<span class="header-section-number">5.2</span> Panorama e padrões do pacote <code>dplyr</code><a class="anchor" aria-label="anchor" href="#panorama-e-padr%C3%B5es-do-pacote-dplyr"><i class="fas fa-link"></i></a>
</h2>
<p>Segundo a <a href="https://dplyr.tidyverse.org/">página oficial</a>, o pacote <code>dplyr</code> busca oferecer um conjunto de “verbos” (i.e. funções) voltados para as operações mais comumente aplicadas em tabelas. Ou seja, as funções desse pacote em geral aceitam um <code>data.frame</code> como <em>input</em>, e retornam um novo <code>data.frame</code> como <em>output</em>. Dito de forma menos técnica, você fornece uma tabela para essas funções, e elas lhe retornam como resultado uma nova tabela.</p>
<p>Se você possui alguma experiência com <em>relational database management systems</em> (RDBMS), você vai acabar percebendo ao longo deste capítulo, que o pacote <code>dplyr</code> é profundamente inspirado nos verbos da linguagem SQL. Por esse motivo, muitos usuários tendem a chamar as funções do pacote <code>dplyr</code> de “verbos”. Logo abaixo, temos uma lista das principais funções oferecidas pelo pacote, além de uma descrição rápida da ação realizada por cada um desses verbos.</p>
<ol style="list-style-type: decimal">
<li><p><code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code>: busca selecionar ou extrair colunas de seu <code>data.frame</code>.</p></li>
<li><p><code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code>: busca filtrar linhas de seu <code>data.frame</code>.</p></li>
<li><p><code><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange()</a></code>: busca ordenar (ou organizar) as linhas de seu <code>data.frame</code>.</p></li>
<li><p><code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code>: busca adicionar ou calcular novas colunas em seu <code>data.frame</code>.</p></li>
<li><p><code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code>: busca sintetizar múltiplos valores de seu <code>data.frame</code> em um único valor.</p></li>
<li><p><code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code>: permite que as operações sejam executadas dentro de cada “grupo” de seu <code>data.frame</code>; em outras palavras, a função busca definir os grupos existentes em seu <code>data.frame</code>, e deixar essa definição explícita e disponível para os outros verbos, de modo que eles possam respeitar esses grupos em suas operações.</p></li>
</ol>
<p>Dentre os verbos acima, o <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> é definitivamente o mais difícil de se explicar de uma maneira clara e, ao mesmo tempo, resumida. De qualquer maneira, vamos discutir ele por extenso na seção <a href="transformando-dados-com-dplyr.html#sec:group_by_summarise">Agrupando dados com <code>group_by()</code> e gerando estatísticas sumárias com <code>summarise()</code></a>. Além disso, também vamos abordar nesse capítulo, o uso do operador <em>pipe</em> (<code>%&gt;%</code>) que provêm do pacote <code>magrittr</code>, e que hoje, faz parte da identidade do pacote <code>dplyr</code>, e do <code>tidyverse</code> como um todo.</p>
<p><span class="citation">Peng (<a href="refer%C3%AAncias.html#ref-peng2015" role="doc-biblioref">2015</a>)</span> destacou algumas características compartilhadas pelas funções do pacote <code>dplyr</code>:</p>
<ol style="list-style-type: decimal">
<li><p>Possuem como primeiro argumento (<code>.data</code>), o <code>data.frame</code> no qual você deseja aplicar a função que você está utilizando.</p></li>
<li><p>Os argumentos subsequentes buscam descrever como e onde aplicar a função sobre o <code>data.frame</code> definido no primeiro argumento.</p></li>
<li><p>Geram um novo <code>data.frame</code> como resultado.</p></li>
<li><p>Como você definiu o <code>data.frame</code> a ser utilizando no primeiro argumento da função, você pode se referir às colunas desse <code>data.frame</code> apenas pelo seus nomes. Ou seja, dentro das funções do pacote <code>dplyr</code>, você não precisa mais do operador <code>$</code> para acessar as colunas do <code>data.frame</code> utilizado.</p></li>
</ol>
<p>No momento, essas características podem parecer difusas. Porém, você irá rapidamente reconhecê-las ao longo deste capítulo.</p>
</div>
<div id="operador-pipe-do-pacote-magrittr" class="section level2" number="5.3">
<h2>
<span class="header-section-number">5.3</span> Operador <em>pipe</em> do pacote <code>magrittr</code> (<code>%&gt;%</code>)<a class="anchor" aria-label="anchor" href="#operador-pipe-do-pacote-magrittr"><i class="fas fa-link"></i></a>
</h2>
<p>Hoje, o operador <em>pipe</em> (<code>%&gt;%</code>) faz parte da identidade dos pacotes que compõe o <code>tidyverse</code>. Por esse motivo, você vai encontrar esse operador em praticamente todos os <em>script</em> que utilizam algum desses pacotes. Grande parte dessa identidade foi construída nos últimos anos, em especial, com a obra de <span class="citation">Wickham and Grolemund (<a href="refer%C3%AAncias.html#ref-wickham2017" role="doc-biblioref">2017</a>)</span> que se tornou um importante livro-texto da linguagem R como um todo.</p>
<p>O operador <em>pipe</em> provêm do pacote <code>magrittr</code>, e o seu único objetivo é tornar o seu código mais claro e compreensível. Ou seja, o <em>pipe</em> em nada altera o resultado ou as configurações de seus comandos, ele apenas os organiza em uma estrutura mais limpa e arranjada. Apesar de sua origem ser o pacote <code>magrittr</code>, o <em>pipe</em> é carregado automaticamente quando chamamos pelo <code>tidyverse</code>, através do comando <code><a href="https://rdrr.io/r/base/library.html">library()</a></code>. Com isso, temos duas opções para termos acesso a esse operador: chamar pelo pacote <code>magrittr</code>, ou chamar pelo <code>tidyverse</code>.</p>
<p></p>
<div class="sourceCode" id="cb517"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Com um desses comandos você</span>
<span class="co">## pode utilizar o operador %&gt;% </span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>
<span class="co">## Ou</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org">magrittr</a></span><span class="op">)</span></code></pre></div>
<p></p>
<p><strong>ATALHO:</strong> No RStudio, você pode criar um <em>pipe</em> através do atalho <code>Ctrl + Shift + M</code>.</p>
<p>Organizar o seu código é algo de extrema importância, e o <em>pipe</em> te ajuda a cumprir essa missão. Além disso, a estrutura em “cadeia” construída pelo <em>pipe</em> gera uma grande economia em seu tempo de trabalho, pois você não precisa mais se preocupar em salvar o resultado de vários passos intermediários em algum objeto.</p>
<p>Dessa maneira, você pode focar uma parte maior de seu tempo nas ações e transformações que você deseja aplicar, e no resultado que você deseja atingir. Para mais, essa estrutura também vai salvar muito de seu tempo, nos momentos em que você retornar ao seu trabalho no dia seguinte. Pois o seu código fica mais claro e fácil de se ler nessa estrutura. Com isso, você pode recuperar com maior rapidez a compreensão do ponto em que você parou no dia anterior.</p>
<p>Isso é muito importante, pois você nunca está trabalhando sozinho! Você sempre está, no mínimo, trabalhando com o seu futuro eu <span class="citation">(<a href="refer%C3%AAncias.html#ref-wickham2017" role="doc-biblioref">Wickham and Grolemund 2017</a>)</span>. Por isso, qualquer quantidade de tempo que você emprega para tornar os seus comandos mais legíveis e eficientes, você estará automaticamente economizando o seu tempo no dia seguinte, quando você terá de retornar a esses comandos, e prosseguir com o seu trabalho.</p>
<p>Para mais, os seus possíveis colegas de trabalho, ou outras pessoas que estiverem envolvidas no desenvolvimento de seu <em>script</em>, vão compreender de maneira mais eficiente as transformações que você está aplicando e, portanto, vão ser capazes de contribuir com o seu trabalho de maneira mais rápida.</p>
<div id="o-que-o-pipe-faz" class="section level3" number="5.3.1">
<h3>
<span class="header-section-number">5.3.1</span> O que o <em>pipe</em> faz ?<a class="anchor" aria-label="anchor" href="#o-que-o-pipe-faz"><i class="fas fa-link"></i></a>
</h3>
<p>Em qualquer análise, temos em geral diversas etapas ou transformações a serem executadas, e em sua maioria, essas etapas assumem uma ordem específica. Quando realizamos essas etapas no R, nós comumente salvamos os resultados de cada passo em novos objetos, e utilizamos esses objetos “intermediários” em cada operação adicional para chegarmos ao resultado final que desejamos. Perceba no exemplo abaixo, o trabalho que temos ao salvarmos os resultados de cada passo em um objeto, e utilizarmos esse objeto na próxima transformação.</p>
<p></p>
<div class="sourceCode" id="cb518"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dados</span> <span class="op">&lt;-</span> <span class="va">mpg</span>
<span class="va">agrupamento</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span>.data <span class="op">=</span> <span class="va">dados</span>, <span class="va">class</span><span class="op">)</span>
<span class="va">base_ordenada</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span>.data <span class="op">=</span> <span class="va">agrupamento</span>, <span class="va">hwy</span><span class="op">)</span>
<span class="va">base_completa</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>
  .data <span class="op">=</span> <span class="va">base_ordenada</span>,
  media <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">hwy</span><span class="op">)</span>,
  desvio <span class="op">=</span> <span class="va">hwy</span> <span class="op">-</span> <span class="va">media</span>
<span class="op">)</span></code></pre></div>
<p></p>
<p>Aqui se encontra uma vantagem muito importante do operador <em>pipe</em>, pois ele elimina essa necessidade de objetos “intermediários”, ao “carregar” os resultados ao longo de diversas funções. Em outras palavras, esse operador funciona como uma ponte entre cada etapa, ou entre cada função aplicada. Dito de uma maneira mais específica, quando conectamos duas funções por um <em>pipe</em>, o operador carrega o resultado da primeira função, e o insere como o primeiro argumento da segunda função. Com isso, eu posso reescrever os comandos anteriores da seguinte forma:</p>
<p></p>
<div class="sourceCode" id="cb519"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mpg</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">class</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">hwy</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>
    media <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">hwy</span><span class="op">)</span>,
    desvio <span class="op">=</span> <span class="va">hwy</span> <span class="op">-</span> <span class="va">media</span>
  <span class="op">)</span></code></pre></div>
<p></p>
<p>Além das vantagens destacadas até o momento, ao evitar o uso de objetos “intermediários”, o <em>pipe</em> acaba evitando que você use desnecessariamente a memória de seu computador. Pois cada objeto criado no R, precisa ocupar um espaço de sua memória RAM para permanecer “vivo” e disponível em sua sessão. Como estamos evitando criar novos objetos “intermediários”, estamos utilizando menos memória para realizar exatamente as mesmas etapas e gerar os mesmos resultados.</p>
<p>Apenas para que o uso do <em>pipe</em> fique claro, se eu possuo as funções <code><a href="https://ggplot2.tidyverse.org/reference/aes_position.html">x()</a></code>, <code><a href="https://ggplot2.tidyverse.org/reference/aes_position.html">y()</a></code> e <code>z()</code>, e desejo calcular a expressão <code>z(y(x(10), times = 1), n = 20, replace = TRUE)</code>, nós podemos reescrever essa expressão do modo exposto abaixo. Dessa maneira, o <em>pipe</em> vai pegar o resultado de <code>x(10)</code>, e inseri-lo como o primeiro argumento da função <code><a href="https://ggplot2.tidyverse.org/reference/aes_position.html">y()</a></code>; depois de calcular o resultado da função <code><a href="https://ggplot2.tidyverse.org/reference/aes_position.html">y()</a></code>, o próximo <em>pipe</em> vai passá-lo para o primeiro argumento da função <code>z()</code>; e como a função <code>z()</code> é a última função da cadeia, o console vai lhe mostrar o resultado final desse processo.</p>
<p></p>
<div class="sourceCode" id="cb520"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Expressão original</span>
<span class="fu">z</span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_position.html">y</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_position.html">x</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>, times <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, n <span class="op">=</span> <span class="fl">20</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="co">## Com o uso do pipe %&gt;% </span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_position.html">x</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_position.html">y</a></span><span class="op">(</span>times <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">z</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">20</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p></p>
</div>
<div id="o-que-o-pipe-não-é-capaz-de-fazer" class="section level3" number="5.3.2">
<h3>
<span class="header-section-number">5.3.2</span> O que o <em>pipe</em> não é capaz de fazer ?<a class="anchor" aria-label="anchor" href="#o-que-o-pipe-n%C3%A3o-%C3%A9-capaz-de-fazer"><i class="fas fa-link"></i></a>
</h3>
<p>O <em>pipe</em> não é capaz de trabalhar perfeitamente com qualquer função, e a principal característica que você precisa observar para identificar se essa afirmação é verdadeira ou falsa para uma dada função, é o seu primeiro argumento.</p>
<p>Como o <em>pipe</em> insere o <strong>resultado</strong> da expressão anterior no primeiro argumento da próxima função, esse primeiro argumento precisa corresponder ao argumento no qual você deseja utilizar esse <strong>resultado</strong>. Na maior parte do tempo, desejamos utilizar esse <strong>resultado</strong> como os dados sobre os quais vamos aplicar a nossa próxima função.</p>
<p>Este é um dos principais motivos pelos quais praticamente todas as funções de todos os pacotes que compõe o <code>tidyverse</code>, trabalham perfeitamente bem com o operador <em>pipe</em>. Pois todas essas funções possuem como primeiro argumento, algo parecido com <code>.data</code>, <code>data</code> ou <code>x</code>, que busca definir o objeto sobre o qual vamos aplicar a função.</p>
<p>Porém, caso o argumento a ser utilizado, esteja em uma posição diferente (se trata do segundo, terceiro ou quarto argumento da função), você pode utilizar um ponto final (<code>.</code>) para alterar a posição em que o resultado das etapas anteriores será introduzido. Basta posicionar o ponto final no argumento em que você deseja inserir esse resultado.</p>
<p>Um clássico exemplo que se encaixa nessa hipótese, é a função <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code>, que é a principal função empregada no cálculo de uma regressão linear no R. Nessa função, o primeiro argumento corresponde a fórmula a ser utilizada na regressão; já os dados a serem usados na regressão, são delimitados no segundo argumento da função (<code>data</code>). Veja no exemplo abaixo, que eu utilizo um ponto final sobre o argumento <code>data</code>, para dizer ao <em>pipe</em> que ele deve inserir o resultado anterior especificamente nesse argumento.</p>
<p></p>
<div class="sourceCode" id="cb521"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mpg</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">hwy</span> <span class="op">~</span> <span class="va">cyl</span>, data <span class="op">=</span> <span class="va">.</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = hwy ~ cyl, data = .)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -8.7579 -2.4968  0.2421  2.4379 15.2421 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  40.0190     0.9591   41.72   &lt;2e-16 ***
## cyl          -2.8153     0.1571  -17.92   &lt;2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 3.865 on 232 degrees of freedom
## Multiple R-squared:  0.5805, Adjusted R-squared:  0.5787 
## F-statistic: 321.1 on 1 and 232 DF,  p-value: &lt; 2.2e-16</code></pre>
<p></p>
</div>
<div id="duas-dicas-rápidas-sobre-o-pipe" class="section level3" number="5.3.3">
<h3>
<span class="header-section-number">5.3.3</span> Duas dicas rápidas sobre o <em>pipe</em><a class="anchor" aria-label="anchor" href="#duas-dicas-r%C3%A1pidas-sobre-o-pipe"><i class="fas fa-link"></i></a>
</h3>
<p>O <em>pipe</em> cria uma espécie de efeito em cadeia, e muitas vezes nos preocupamos demais com as etapas dessa cadeia, e nos esquecemos de definir o local em que o resultado dessa cadeia deve ocupar. Portanto, lembre-se que para salvar o resultado final da cadeia formada pelos seus <em>pipe</em>’s, você necessita salvar esse resultado em algum objeto. Para isso, você deve posicionar o nome do objeto, e o símbolo de <em>assignment</em> (<code>&lt;-</code>), logo no início dessa cadeia, como no exemplo abaixo.</p>
<p></p>
<div class="sourceCode" id="cb523"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">resultado</span> <span class="op">&lt;-</span> <span class="va">mpg</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">class</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">hwy</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>
    consumo_medio <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">hwy</span><span class="op">)</span>,
    desvio_consumo <span class="op">=</span> <span class="va">hwy</span> <span class="op">-</span> <span class="va">consumo_medio</span>
  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span>
    <span class="va">manufacturer</span>, <span class="va">model</span>, <span class="va">class</span>,
    <span class="va">consumo_medio</span>, <span class="va">desvio_consumo</span>
  <span class="op">)</span>


<span class="va">resultado</span></code></pre></div>
<pre><code>## # A tibble: 234 × 5
## # Groups:   class [7]
##    manufacturer model               class  consumo_medio desvio_consumo
##    &lt;chr&gt;        &lt;chr&gt;               &lt;chr&gt;          &lt;dbl&gt;          &lt;dbl&gt;
##  1 dodge        dakota pickup 4wd   pickup          16.9          -4.88
##  2 dodge        durango 4wd         suv             18.1          -6.13
##  3 dodge        ram 1500 pickup 4wd pickup          16.9          -4.88
##  4 dodge        ram 1500 pickup 4wd pickup          16.9          -4.88
##  5 jeep         grand cherokee 4wd  suv             18.1          -6.13
##  6 chevrolet    k1500 tahoe 4wd     suv             18.1          -4.13
##  7 jeep         grand cherokee 4wd  suv             18.1          -4.13
##  8 chevrolet    c1500 suburban 2wd  suv             18.1          -3.13
##  9 chevrolet    k1500 tahoe 4wd     suv             18.1          -3.13
## 10 dodge        dakota pickup 4wd   pickup          16.9          -1.88
## # … with 224 more rows</code></pre>
<p></p>
<p>Uma outra dica, seria não formar cadeias muito longas. Se você precisa aplicar várias transformações em sequência sobre o mesmo objeto, tente dividir essas várias transformações em vários “blocos” de <em>pipe</em>’s.</p>
<p>Como um guia, o ideal é que uma cadeia de <em>pipe</em>’s nunca passe de 10 etapas. Caso você precise aplicar mais do que 10 etapas, é melhor que você salve o resultado da 10° etapa em um objeto, e inicie uma nova cadeia de <em>pipe</em>’s a partir deste objeto.</p>
</div>
</div>
<div id="operador-pipe-nativo-do-r" class="section level2" number="5.4">
<h2>
<span class="header-section-number">5.4</span> Operador <em>pipe</em> nativo do R (<code>|&gt;</code>)<a class="anchor" aria-label="anchor" href="#operador-pipe-nativo-do-r"><i class="fas fa-link"></i></a>
</h2>
<p>Depois do grande sucesso do operador <em>pipe</em> criado pelo pacote <code>magrittr</code> (<code>%&gt;%</code>), a equipe que mantém a linguagem R decidiu desenvolver um operador <em>pipe</em> nativo para a linguagem. Tal operador possui o formato <code>|&gt;</code>, e foi oficialmente introduzido na versão 4.1 do R.</p>
<p>Em resumo, o operador <code>|&gt;</code> possui a exata mesma funcionalidade do operador <code>%&gt;%</code>. Ou seja, ele pega o resultado da função a esquerda, e, o transfere para o primeiro argumento da função a direita. Logo, poderíamos tranquilamente reescrever o exemplo anterior, ao substituir o operador <code>%&gt;%</code> por <code>|&gt;</code>, produzindo assim, o mesmo resultado:</p>
<p></p>
<div class="sourceCode" id="cb525"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">resultado</span> <span class="op">&lt;-</span> <span class="va">mpg</span> |&gt;
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">class</span><span class="op">)</span> |&gt;
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">hwy</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>
    consumo_medio <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">hwy</span><span class="op">)</span>,
    desvio_consumo <span class="op">=</span> <span class="va">hwy</span> <span class="op">-</span> <span class="va">consumo_medio</span>
  <span class="op">)</span> |&gt;
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span>
    <span class="va">manufacturer</span>, <span class="va">model</span>, <span class="va">class</span>,
    <span class="va">consumo_medio</span>, <span class="va">desvio_consumo</span>
  <span class="op">)</span>


<span class="va">resultado</span></code></pre></div>
<pre><code>## # A tibble: 234 × 5
## # Groups:   class [7]
##    manufacturer model               class  consumo_medio desvio_consumo
##    &lt;chr&gt;        &lt;chr&gt;               &lt;chr&gt;          &lt;dbl&gt;          &lt;dbl&gt;
##  1 dodge        dakota pickup 4wd   pickup          16.9          -4.88
##  2 dodge        durango 4wd         suv             18.1          -6.13
##  3 dodge        ram 1500 pickup 4wd pickup          16.9          -4.88
##  4 dodge        ram 1500 pickup 4wd pickup          16.9          -4.88
##  5 jeep         grand cherokee 4wd  suv             18.1          -6.13
##  6 chevrolet    k1500 tahoe 4wd     suv             18.1          -4.13
##  7 jeep         grand cherokee 4wd  suv             18.1          -4.13
##  8 chevrolet    c1500 suburban 2wd  suv             18.1          -3.13
##  9 chevrolet    k1500 tahoe 4wd     suv             18.1          -3.13
## 10 dodge        dakota pickup 4wd   pickup          16.9          -1.88
## # … with 224 more rows</code></pre>
<p></p>
<p>Contudo, apesar de realizar o mesmo trabalho, o operador <code>|&gt;</code> possui três características importantes:</p>
<ol style="list-style-type: decimal">
<li><p>Primeiro, esse operador é nativo. Ou seja, ele vem “de fábrica”, junto com o R. Logo, você não precisa chamar por nenhum pacote extra para utilizá-lo;</p></li>
<li><p>Segundo, enquanto o operador <code>%&gt;%</code> executa cada uma das etapas de forma sequencial, o operador <code>|&gt;</code> utiliza uma transformação sintática (<em>syntax transformation</em>) para agrupar todas as etapas em uma única chamada;</p></li>
<li><p>Terceiro, enquanto o operador <code>%&gt;%</code> utiliza um ponto final para alterar a posição em que o resultado será inserido, o operador <code>|&gt;</code> utiliza um <em>underline</em> (<code>_</code>) para realizar esse serviço;</p></li>
</ol>
<p>Quanto à segunda característica supracitada, o operador <code>|&gt;</code> sempre realiza uma transformação sintática sobre a sua cadeia de operações, antes de executá-la. Em outras palavras, ele reescreve os comandos em sua cadeia, com o objetivo de agrupar todas as operações em um único comando. Você pode ver o resultado desse processo, ao revelar a expressão gerada por uma cadeia qualquer, com a função <code><a href="https://rdrr.io/r/base/substitute.html">quote()</a></code>:</p>
<p></p>
<div class="sourceCode" id="cb527"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/substitute.html">quote</a></span><span class="op">(</span><span class="op">{</span>
  <span class="va">mpg</span> |&gt;
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">class</span><span class="op">)</span> |&gt;
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">hwy</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>
    consumo_medio <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">hwy</span><span class="op">)</span>,
    desvio_consumo <span class="op">=</span> <span class="va">hwy</span> <span class="op">-</span> <span class="va">consumo_medio</span>
  <span class="op">)</span> |&gt;
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span>
    <span class="va">manufacturer</span>, <span class="va">model</span>, <span class="va">class</span>,
    <span class="va">consumo_medio</span>, <span class="va">desvio_consumo</span>
  <span class="op">)</span>
<span class="op">}</span><span class="op">)</span></code></pre></div>
<p></p>
<pre><code>## {
##     select(mutate(arrange(group_by(mpg, class), hwy),
##        consumo_medio = mean(hwy), 
##        desvio_consumo = hwy - consumo_medio),
##        manufacturer, model, class,
##        consumo_medio, desvio_consumo)
## }</code></pre>
<p>Portanto, o operador <code>|&gt;</code> agrupa todas as suas operações em um único comando, e, em seguida, executa esse comando único para adquirir o resultado final de sua cadeia. Em contrapartida, o operador <code>%&gt;%</code> executa cada uma das etapas de sua cadeia de forma separada.</p>
<p>Quanto à terceira característica supracitada, para alterarmos a posição em que o resultado da expressão anterior é inserido, precisamos utilizar um <em>underline</em> ao invés de um ponto final (como ocorre com <code>%&gt;%</code>). Vale destacar que este <em>underline</em> é permitido apenas em argumentos nomeados. Em outras palavras, a expressão <code>x |&gt; y(10, _)</code> não é permitida, enquanto a expressão <code>x |&gt; y(10, z = _)</code> é.</p>
<p>Tendo isso em mente, para reproduzirmos o exemplo anterior dado com a função <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code>, teríamos:</p>
<p></p>
<div class="sourceCode" id="cb529"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mpg</span> |&gt; 
  <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">hwy</span> <span class="op">~</span> <span class="va">cyl</span>, data <span class="op">=</span> _<span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = hwy ~ cyl, data = mpg)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -8.7579 -2.4968  0.2421  2.4379 15.2421 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  40.0190     0.9591   41.72   &lt;2e-16 ***
## cyl          -2.8153     0.1571  -17.92   &lt;2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 3.865 on 232 degrees of freedom
## Multiple R-squared:  0.5805, Adjusted R-squared:  0.5787 
## F-statistic: 321.1 on 1 and 232 DF,  p-value: &lt; 2.2e-16</code></pre>
<p></p>
<div id="utilizando-o-operador-pipe-nativo-no-rstudio" class="section level3" number="5.4.1">
<h3>
<span class="header-section-number">5.4.1</span> Utilizando o operador <em>pipe</em> nativo no RStudio<a class="anchor" aria-label="anchor" href="#utilizando-o-operador-pipe-nativo-no-rstudio"><i class="fas fa-link"></i></a>
</h3>
<p>Em versões mais recentes do RStudio, você pode utilizar o pipe nativo do R através do atalho <code>Crtl + Shift + M</code>. Basta acessar a janela de configurações globais, através de <code>Tools</code> <span class="math inline">\(\rightarrow\)</span> <code>Global Options...</code>, depois, ir na seção de <code>Code</code>, e, marcar a caixa <em>“Use native pipe operator |&gt;”</em>, como demonstrado na figura 5.1 abaixo:</p>
<p></p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:unnamed-chunk-269"></span>
<img src="Figuras/native_pipe_operator.png" alt="RStudio - opção para utilizar o *pipe* nativo do R" width="80%"><p class="caption">
Figura 5.1: RStudio - opção para utilizar o <em>pipe</em> nativo do R
</p>
</div>
<p></p>
</div>
</div>
<div id="selecionando-colunas-com-select" class="section level2" number="5.5">
<h2>
<span class="header-section-number">5.5</span> Selecionando colunas com <code>select()</code><a class="anchor" aria-label="anchor" href="#selecionando-colunas-com-select"><i class="fas fa-link"></i></a>
</h2>
<p>Como definimos anteriormente, a função <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> busca selecionar colunas de seu <code>data.frame</code>. Você já possui uma boa ideia de como realizar essa ação através da função de <em>subsetting</em> (<code>[</code>). Porém, nós podemos usufruir da flexibilidade oferecida pela função <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code>, que lhe permite realizar essa mesma operação de diversas maneiras intuitivas.</p>
<p>No geral, temos ao menos 5 métodos diferentes que podemos utilizar na função <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code>:</p>
<ol style="list-style-type: decimal">
<li><p>simplesmente listar o nome das colunas que desejamos;</p></li>
<li><p>fornecer um vetor externo, contendo os nomes das colunas a serem extraídas;</p></li>
<li><p>selecionar um conjunto de colunas com base em seu tipo (<code>integer</code>, <code>double</code>, <code>character</code>, <code>logical</code>);</p></li>
<li><p>selecionar um conjunto de colunas com base em padrões que aparecem nos nomes dessas colunas (nome começa por y, ou termina em z, ou contém x);</p></li>
<li><p>selecionar um conjunto de colunas com base em seus índices numéricos (1° colunas, 2° coluna, 3° coluna, etc.).</p></li>
</ol>
<p>Como exemplo inicial, vamos utilizar a tabela <code>billboard</code>, que apresenta a posição de diversas músicas na lista Billboard Top 100, ao longo do ano de 2000. Se você chamou com sucesso pelo <code>tidyverse</code>, você tem acesso a essa tabela. Perceba que a posição de cada música descrita na tabela, é apresentada de forma semanal, onde cada semana possui a sua coluna própria. Por essa razão, temos uma quantidade exorbitante de colunas na tabela.</p>
<p></p>
<div class="sourceCode" id="cb531"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">billboard</span></code></pre></div>
<pre><code>## # A tibble: 317 × 79
##    artist  track date.ent…¹   wk1   wk2   wk3   wk4   wk5   wk6   wk7   wk8
##    &lt;chr&gt;   &lt;chr&gt; &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 2 Pac   Baby… 2000-02-26    87    82    72    77    87    94    99    NA
##  2 2Ge+her The … 2000-09-02    91    87    92    NA    NA    NA    NA    NA
##  3 3 Door… Kryp… 2000-04-08    81    70    68    67    66    57    54    53
##  4 3 Door… Loser 2000-10-21    76    76    72    69    67    65    55    59
##  5 504 Bo… Wobb… 2000-04-15    57    34    25    17    17    31    36    49
##  6 98^0    Give… 2000-08-19    51    39    34    26    26    19     2     2
##  7 A*Teens Danc… 2000-07-08    97    97    96    95   100    NA    NA    NA
##  8 Aaliyah I Do… 2000-01-29    84    62    51    41    38    35    35    38
##  9 Aaliyah Try … 2000-03-18    59    53    38    28    21    18    16    14
## 10 Adams,… Open… 2000-08-26    76    76    74    69    68    67    61    58
## # … with 307 more rows, 68 more variables: wk9 &lt;dbl&gt;, wk10 &lt;dbl&gt;,
## #   wk11 &lt;dbl&gt;, wk12 &lt;dbl&gt;, wk13 &lt;dbl&gt;, wk14 &lt;dbl&gt;, wk15 &lt;dbl&gt;,
## #   wk16 &lt;dbl&gt;, wk17 &lt;dbl&gt;, wk18 &lt;dbl&gt;, wk19 &lt;dbl&gt;, wk20 &lt;dbl&gt;,
## #   wk21 &lt;dbl&gt;, wk22 &lt;dbl&gt;, wk23 &lt;dbl&gt;, wk24 &lt;dbl&gt;, wk25 &lt;dbl&gt;,
## #   wk26 &lt;dbl&gt;, wk27 &lt;dbl&gt;, wk28 &lt;dbl&gt;, wk29 &lt;dbl&gt;, wk30 &lt;dbl&gt;,
## #   wk31 &lt;dbl&gt;, wk32 &lt;dbl&gt;, wk33 &lt;dbl&gt;, wk34 &lt;dbl&gt;, wk35 &lt;dbl&gt;,
## #   wk36 &lt;dbl&gt;, wk37 &lt;dbl&gt;, wk38 &lt;dbl&gt;, wk39 &lt;dbl&gt;, wk40 &lt;dbl&gt;, …</code></pre>
<p></p>
<p>O método 5 citado acima é um dos métodos mais práticos e eficientes de se utilizar a função <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code>. Por exemplo, se desejássemos extrair todas as colunas entre a 1° e 4° colunas da tabela, poderíamos fornecer um vetor à função, contendo uma sequência de 1 a 4, que representa os índices das colunas que desejamos, como no exemplo abaixo.</p>
<p></p>
<div class="sourceCode" id="cb533"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">billboard_sel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">billboard</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span>

<span class="va">billboard_sel</span></code></pre></div>
<pre><code>## # A tibble: 317 × 4
##    artist         track                   date.entered   wk1
##    &lt;chr&gt;          &lt;chr&gt;                   &lt;date&gt;       &lt;dbl&gt;
##  1 2 Pac          Baby Don't Cry (Keep... 2000-02-26      87
##  2 2Ge+her        The Hardest Part Of ... 2000-09-02      91
##  3 3 Doors Down   Kryptonite              2000-04-08      81
##  4 3 Doors Down   Loser                   2000-10-21      76
##  5 504 Boyz       Wobble Wobble           2000-04-15      57
##  6 98^0           Give Me Just One Nig... 2000-08-19      51
##  7 A*Teens        Dancing Queen           2000-07-08      97
##  8 Aaliyah        I Don't Wanna           2000-01-29      84
##  9 Aaliyah        Try Again               2000-03-18      59
## 10 Adams, Yolanda Open My Heart           2000-08-26      76
## # … with 307 more rows</code></pre>
<p></p>
<p>Agora, e se você precisasse selecionar todas as colunas que representam as semanas? Nesse caso, o método 5 ainda seria uma boa alternativa, pois você precisaria apenas fornecer uma sequência que represente a posição dessas colunas na tabela (de 4 a 79 para ser mais preciso).</p>
<p>Porém, todas essas colunas possuem um padrão em seus nomes. Elas se iniciam pelos caracteres <code>"wk"</code>, acrescidos de um número que representa o índice da semana que essa coluna corresponde. Portanto, em todas as ocasiões que houver algum padrão presente nos nomes das colunas que você deseja selecionar, o método 4 que citamos configura-se como uma ótima solução. Nesse método, devemos utilizar as funções de suporte <code><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with()</a></code>, <code><a href="https://tidyselect.r-lib.org/reference/starts_with.html">ends_with()</a></code>, <code><a href="https://tidyselect.r-lib.org/reference/starts_with.html">matches()</a></code>.</p>
<p>Como os seus próprios nomes dão a entender, as funções <code><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with()</a></code> e <code><a href="https://tidyselect.r-lib.org/reference/starts_with.html">ends_with()</a></code> vão selecionar qualquer coluna de sua tabela que comece (<em>start</em>) ou termine (<em>end</em>) por uma determinada cadeia de caracteres, respectivamente. Como exemplo, eu posso selecionar todas as colunas que apresentam as posições semanais na tabela <code>billboard</code>, ao encontrar todas as colunas que começam pelas letras <code>"wk"</code>, com a função <code><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with()</a></code>.</p>
<p></p>
<div class="sourceCode" id="cb535"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">billboard_sel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">billboard</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"wk"</span><span class="op">)</span><span class="op">)</span>

<span class="va">billboard_sel</span></code></pre></div>
<pre><code>## # A tibble: 317 × 76
##      wk1   wk2   wk3   wk4   wk5   wk6   wk7   wk8   wk9  wk10  wk11  wk12
##    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1    87    82    72    77    87    94    99    NA    NA    NA    NA    NA
##  2    91    87    92    NA    NA    NA    NA    NA    NA    NA    NA    NA
##  3    81    70    68    67    66    57    54    53    51    51    51    51
##  4    76    76    72    69    67    65    55    59    62    61    61    59
##  5    57    34    25    17    17    31    36    49    53    57    64    70
##  6    51    39    34    26    26    19     2     2     3     6     7    22
##  7    97    97    96    95   100    NA    NA    NA    NA    NA    NA    NA
##  8    84    62    51    41    38    35    35    38    38    36    37    37
##  9    59    53    38    28    21    18    16    14    12    10     9     8
## 10    76    76    74    69    68    67    61    58    57    59    66    68
## # … with 307 more rows, and 64 more variables: wk13 &lt;dbl&gt;, wk14 &lt;dbl&gt;,
## #   wk15 &lt;dbl&gt;, wk16 &lt;dbl&gt;, wk17 &lt;dbl&gt;, wk18 &lt;dbl&gt;, wk19 &lt;dbl&gt;,
## #   wk20 &lt;dbl&gt;, wk21 &lt;dbl&gt;, wk22 &lt;dbl&gt;, wk23 &lt;dbl&gt;, wk24 &lt;dbl&gt;,
## #   wk25 &lt;dbl&gt;, wk26 &lt;dbl&gt;, wk27 &lt;dbl&gt;, wk28 &lt;dbl&gt;, wk29 &lt;dbl&gt;,
## #   wk30 &lt;dbl&gt;, wk31 &lt;dbl&gt;, wk32 &lt;dbl&gt;, wk33 &lt;dbl&gt;, wk34 &lt;dbl&gt;,
## #   wk35 &lt;dbl&gt;, wk36 &lt;dbl&gt;, wk37 &lt;dbl&gt;, wk38 &lt;dbl&gt;, wk39 &lt;dbl&gt;,
## #   wk40 &lt;dbl&gt;, wk41 &lt;dbl&gt;, wk42 &lt;dbl&gt;, wk43 &lt;dbl&gt;, wk44 &lt;dbl&gt;, …</code></pre>
<p></p>
<p>Já a função <code><a href="https://tidyselect.r-lib.org/reference/starts_with.html">matches()</a></code> se trata de um caso muito mais flexível das funções <code><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with()</a></code> e <code><a href="https://tidyselect.r-lib.org/reference/starts_with.html">ends_with()</a></code>, pois ela lhe permite selecionar qualquer coluna cujo o nome se encaixa em uma dada expressão regular. Expressões regulares são uma poderosa ferramenta para processamento de texto, a qual vamos discutir no capítulo 11 deste livro, especialmente na seção <a href="manipula%C3%A7%C3%A3o-e-transforma%C3%A7%C3%A3o-de-strings-com-stringr.html#sec:stringr_regex">Expressões regulares (ou <em>regex</em>) com <code>str_detect()</code></a>. Outras duas referências úteis sobre o assunto, se encontram no <a href="https://r4ds.had.co.nz/strings.html">capítulo 14</a> de <span class="citation">Wickham and Grolemund (<a href="refer%C3%AAncias.html#ref-wickham2017" role="doc-biblioref">2017</a>)</span>, que provê uma visão mais direta, além da obra de <span class="citation">Friedl (<a href="refer%C3%AAncias.html#ref-friedl2006" role="doc-biblioref">2006</a>)</span> que oferece uma visão técnica e aprofundada sobre o assunto. Veja alguns exemplos abaixo:</p>
<p></p>
<div class="sourceCode" id="cb537"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Seleciona todas as semanas que são</span>
<span class="co">## maiores do que 9 e menores do que 100.</span>
<span class="co">## Ou seja, toda semana com dois dígitos</span>
<span class="va">billboard</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">matches</a></span><span class="op">(</span><span class="st">"wk[0-9]{2}"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 317 × 67
##    wk10  wk11  wk12  wk13  wk14  wk15  wk16  wk17  wk18  wk19  wk20  wk21
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA
## 2    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA
## 3    51    51    51    47    44    38    28    22    18    18    14    12
## 4    61    61    59    61    66    72    76    75    67    73    70    NA
## 5    57    64    70    75    76    78    85    92    96    NA    NA    NA
## # … with 312 more rows, and 55 more variables: wk22 &lt;dbl&gt;, wk23 &lt;dbl&gt;,
## #   wk24 &lt;dbl&gt;, wk25 &lt;dbl&gt;, wk26 &lt;dbl&gt;, wk27 &lt;dbl&gt;, wk28 &lt;dbl&gt;,
## #   wk29 &lt;dbl&gt;, wk30 &lt;dbl&gt;, wk31 &lt;dbl&gt;, wk32 &lt;dbl&gt;, wk33 &lt;dbl&gt;,
## #   wk34 &lt;dbl&gt;, wk35 &lt;dbl&gt;, wk36 &lt;dbl&gt;, wk37 &lt;dbl&gt;, wk38 &lt;dbl&gt;,
## #   wk39 &lt;dbl&gt;, wk40 &lt;dbl&gt;, wk41 &lt;dbl&gt;, wk42 &lt;dbl&gt;, wk43 &lt;dbl&gt;,
## #   wk44 &lt;dbl&gt;, wk45 &lt;dbl&gt;, wk46 &lt;dbl&gt;, wk47 &lt;dbl&gt;, wk48 &lt;dbl&gt;,
## #   wk49 &lt;dbl&gt;, wk50 &lt;dbl&gt;, wk51 &lt;dbl&gt;, wk52 &lt;dbl&gt;, wk53 &lt;dbl&gt;, …</code></pre>
<div class="sourceCode" id="cb539"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Seleciona todas as colunas cujo nome</span>
<span class="co">## possua um ponto final antecedido por</span>
<span class="co">## 4 letras</span>
<span class="va">billboard</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">matches</a></span><span class="op">(</span><span class="st">"[a-z]{4}[.]"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 317 × 1
##   date.entered
##   &lt;date&gt;      
## 1 2000-02-26  
## 2 2000-09-02  
## 3 2000-04-08  
## 4 2000-10-21  
## 5 2000-04-15  
## # … with 312 more rows</code></pre>
<p></p>
<p>Essas são maneiras eficientes de selecionarmos um grande conjunto de colunas, porém, muitas vezes as nossas necessidades são pequenas e, portanto, não exigem mecanismos tão poderosos. Nessas situações, o método 1 se torna útil pois ele consiste em simplesmente listarmos o nome das colunas desejadas. Como exemplo, eu posso selecionar as colunas <code>artist</code>, <code>track</code> e <code>wk5</code> da tabela <code>billboard</code> pelo comando abaixo.</p>
<p></p>
<div class="sourceCode" id="cb541"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">billboard</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">artist</span>, <span class="va">track</span>, <span class="va">wk5</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 317 × 3
##    artist         track                     wk5
##    &lt;chr&gt;          &lt;chr&gt;                   &lt;dbl&gt;
##  1 2 Pac          Baby Don't Cry (Keep...    87
##  2 2Ge+her        The Hardest Part Of ...    NA
##  3 3 Doors Down   Kryptonite                 66
##  4 3 Doors Down   Loser                      67
##  5 504 Boyz       Wobble Wobble              17
##  6 98^0           Give Me Just One Nig...    26
##  7 A*Teens        Dancing Queen             100
##  8 Aaliyah        I Don't Wanna              38
##  9 Aaliyah        Try Again                  21
## 10 Adams, Yolanda Open My Heart              68
## # … with 307 more rows</code></pre>
<p></p>
<p>Vale destacar que a ordem dos índices utilizados importa para a função <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code>. Logo, se no exemplo acima, eu listasse as colunas na ordem <code>track</code>, <code>wk5</code> e <code>artist</code>, o novo <code>data.frame</code> resultante de <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code>, iria conter essas colunas precisamente nessa ordem. O mesmo efeito seria produzido, caso eu utilizasse novamente o método 5, e fornecesse o vetor <code>c(3, 2, 4)</code> à função. Dessa forma, <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> iria me retornar um novo <code>data.frame</code> contendo 3 colunas, que correspondem a 3°, 2° e 4° colunas da tabela <code>billboard</code>, exatamente nessa ordem.</p>
<p>Por outro lado, não há uma maneira de variarmos a ordem dos resultados gerados nos métodos 3 e 4, especificamente. Por isso, caso você utilize um desses dois métodos, as colunas selecionadas serão apresentadas no novo <code>data.frame</code>, precisamente na ordem em que eles aparecem no <code>data.frame</code> inicial.</p>
<p>Visto esses pontos, ao invés de selecionar colunas, você também pode utilizar o método 1 para rapidamente eliminar algumas colunas de seu <code>data.frame</code>, ao posicionar um sinal negativo (<code>-</code>) antes do nome da coluna que você deseja retirar. Por exemplo, eu posso selecionar todas as colunas da tabela <code>mpg</code>, exceto as colunas <code>hwy</code> e <code>manufacturer</code> por meio do seguinte comando:</p>
<p></p>
<div class="sourceCode" id="cb543"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mpg</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">hwy</span>, <span class="op">-</span><span class="va">manufacturer</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 234 × 9
##    model      displ  year   cyl trans      drv     cty fl    class  
##    &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;      &lt;chr&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt;  
##  1 a4           1.8  1999     4 auto(l5)   f        18 p     compact
##  2 a4           1.8  1999     4 manual(m5) f        21 p     compact
##  3 a4           2    2008     4 manual(m6) f        20 p     compact
##  4 a4           2    2008     4 auto(av)   f        21 p     compact
##  5 a4           2.8  1999     6 auto(l5)   f        16 p     compact
##  6 a4           2.8  1999     6 manual(m5) f        18 p     compact
##  7 a4           3.1  2008     6 auto(av)   f        18 p     compact
##  8 a4 quattro   1.8  1999     4 manual(m5) 4        18 p     compact
##  9 a4 quattro   1.8  1999     4 auto(l5)   4        16 p     compact
## 10 a4 quattro   2    2008     4 manual(m6) 4        20 p     compact
## # … with 224 more rows</code></pre>
<p></p>
<p>Em contrapartida, o método 3 busca selecionar um conjunto de colunas com base em seu tipo de dado, através da função <code>where()</code> e das funções de teste lógico <code>is.*()</code> (<code>is.double</code>, <code>is.character</code>, <code>is.integer</code>, …). Como exemplo, nós podemos selecionar todas as colunas da tabela <code>billboard</code> que contém dados textuais, através do comando abaixo. Portanto, para utilizar esse método você precisa apenas se referir a função <code>is.*()</code> que corresponde ao tipo de dado no qual você está interessado, dentro da função <code>where()</code>.</p>
<p></p>
<div class="sourceCode" id="cb545"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">billboard</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu">where</span><span class="op">(</span><span class="va">is.character</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 317 × 2
##    artist         track                  
##    &lt;chr&gt;          &lt;chr&gt;                  
##  1 2 Pac          Baby Don't Cry (Keep...
##  2 2Ge+her        The Hardest Part Of ...
##  3 3 Doors Down   Kryptonite             
##  4 3 Doors Down   Loser                  
##  5 504 Boyz       Wobble Wobble          
##  6 98^0           Give Me Just One Nig...
##  7 A*Teens        Dancing Queen          
##  8 Aaliyah        I Don't Wanna          
##  9 Aaliyah        Try Again              
## 10 Adams, Yolanda Open My Heart          
## # … with 307 more rows</code></pre>
<p></p>
<p>Com isso, você possui não apenas uma boa variedade de métodos disponíveis na função <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code>, mas você também é capaz de misturá-los livremente dentro da função. Ou seja, se for de meu desejo, eu posso utilizar os métodos 2, 4 e 5 ao mesmo tempo, como no exemplo abaixo. Tratando especificamente do método 2, eu preciso fornecer dentro da função <code><a href="https://tidyselect.r-lib.org/reference/all_of.html">all_of()</a></code>, um vetor contendo os nomes das colunas desejadas. Como exemplo, eu posso novamente extrair as colunas <code>artist</code>, <code>track</code> e <code>wk5</code> através desse método. O método 2, em particular, se torna um método interessante quando ainda não conhecemos o conjunto de colunas a serem extraídas. Talvez você precise aplicar previamente diversos testes sobre o seu <code>data.frame</code>, para identificar essas colunas. Logo, um vetor contendo os nomes das colunas desejadas seria o resultado ideal para tais testes.</p>
<p></p>
<div class="sourceCode" id="cb547"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">vec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"artist"</span>, <span class="st">"track"</span>, <span class="st">"wk5"</span><span class="op">)</span>

<span class="va">billboard</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span>
  <span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html">all_of</a></span><span class="op">(</span><span class="va">vec</span><span class="op">)</span>,  <span class="co">## Método 2</span>
  <span class="fl">3</span><span class="op">:</span><span class="fl">5</span>,  <span class="co">## Método 5</span>
  <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">matches</a></span><span class="op">(</span><span class="st">"wk[0-9]{2}"</span><span class="op">)</span>  <span class="co">## Método 4</span>
<span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 317 × 73
##    artist  track   wk5 date.ent…¹   wk1   wk2  wk10  wk11  wk12  wk13  wk14
##    &lt;chr&gt;   &lt;chr&gt; &lt;dbl&gt; &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 2 Pac   Baby…    87 2000-02-26    87    82    NA    NA    NA    NA    NA
##  2 2Ge+her The …    NA 2000-09-02    91    87    NA    NA    NA    NA    NA
##  3 3 Door… Kryp…    66 2000-04-08    81    70    51    51    51    47    44
##  4 3 Door… Loser    67 2000-10-21    76    76    61    61    59    61    66
##  5 504 Bo… Wobb…    17 2000-04-15    57    34    57    64    70    75    76
##  6 98^0    Give…    26 2000-08-19    51    39     6     7    22    29    36
##  7 A*Teens Danc…   100 2000-07-08    97    97    NA    NA    NA    NA    NA
##  8 Aaliyah I Do…    38 2000-01-29    84    62    36    37    37    38    49
##  9 Aaliyah Try …    21 2000-03-18    59    53    10     9     8     6     1
## 10 Adams,… Open…    68 2000-08-26    76    76    59    66    68    61    67
## # … with 307 more rows, 62 more variables: wk15 &lt;dbl&gt;, wk16 &lt;dbl&gt;,
## #   wk17 &lt;dbl&gt;, wk18 &lt;dbl&gt;, wk19 &lt;dbl&gt;, wk20 &lt;dbl&gt;, wk21 &lt;dbl&gt;,
## #   wk22 &lt;dbl&gt;, wk23 &lt;dbl&gt;, wk24 &lt;dbl&gt;, wk25 &lt;dbl&gt;, wk26 &lt;dbl&gt;,
## #   wk27 &lt;dbl&gt;, wk28 &lt;dbl&gt;, wk29 &lt;dbl&gt;, wk30 &lt;dbl&gt;, wk31 &lt;dbl&gt;,
## #   wk32 &lt;dbl&gt;, wk33 &lt;dbl&gt;, wk34 &lt;dbl&gt;, wk35 &lt;dbl&gt;, wk36 &lt;dbl&gt;,
## #   wk37 &lt;dbl&gt;, wk38 &lt;dbl&gt;, wk39 &lt;dbl&gt;, wk40 &lt;dbl&gt;, wk41 &lt;dbl&gt;,
## #   wk42 &lt;dbl&gt;, wk43 &lt;dbl&gt;, wk44 &lt;dbl&gt;, wk45 &lt;dbl&gt;, wk46 &lt;dbl&gt;, …</code></pre>
<p></p>
</div>
<div id="filtrando-linhas-com-filter" class="section level2" number="5.6">
<h2>
<span class="header-section-number">5.6</span> Filtrando linhas com <code>filter()</code><a class="anchor" aria-label="anchor" href="#filtrando-linhas-com-filter"><i class="fas fa-link"></i></a>
</h2>
<p>Você também já possui conhecimento para realizar essa operação através da função de <em>subsetting</em> (<code>[</code>). Porém, novamente o pacote <code>dplyr</code> nos oferece uma alternativa mais intuitiva. A função <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> busca filtrar linhas de uma tabela de acordo com uma condição lógica que nós devemos definir. Ou seja, os operadores lógicos são primordiais para essa função. Por isso, temos na tabela 5.1, um resumo de cada um deles.</p>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:label5">Tabela 5.1: </span> Lista de operadores lógicos</caption>
<thead><tr class="header">
<th align="left"><!-- --></th>
</tr></thead>
<tbody><tr class="odd">
<td align="left"><img src="Figuras/tab_operadores.png"></td>
</tr></tbody>
</table></div>
<p>Portanto, ao utilizar a função <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> você deve construir uma condição lógica que seja capaz de identificar as linhas que você deseja filtrar. Como exemplo inicial, nós podemos retornar à tabela <code>mpg</code>, que contém dados de consumo de diversos modelos de carro. Por exemplo, nós podemos filtrar todas as linhas que dizem respeito a modelos da Toyota, através do comando abaixo. Como um paralelo, temos mais abaixo a mesma operação segundo a função de <em>subsetting</em>.</p>
<p></p>
<div class="sourceCode" id="cb549"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mpg</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">manufacturer</span> <span class="op">==</span> <span class="st">"toyota"</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 34 × 11
##    manufacturer model displ  year   cyl trans drv     cty   hwy fl    class
##    &lt;chr&gt;        &lt;chr&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt;
##  1 toyota       4run…   2.7  1999     4 manu… 4        15    20 r     suv  
##  2 toyota       4run…   2.7  1999     4 auto… 4        16    20 r     suv  
##  3 toyota       4run…   3.4  1999     6 auto… 4        15    19 r     suv  
##  4 toyota       4run…   3.4  1999     6 manu… 4        15    17 r     suv  
##  5 toyota       4run…   4    2008     6 auto… 4        16    20 r     suv  
##  6 toyota       4run…   4.7  2008     8 auto… 4        14    17 r     suv  
##  7 toyota       camry   2.2  1999     4 manu… f        21    29 r     mids…
##  8 toyota       camry   2.2  1999     4 auto… f        21    27 r     mids…
##  9 toyota       camry   2.4  2008     4 manu… f        21    31 r     mids…
## 10 toyota       camry   2.4  2008     4 auto… f        21    31 r     mids…
## # … with 24 more rows</code></pre>
<p></p>
<p></p>
<div class="sourceCode" id="cb551"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## -------------------------------------</span>
<span class="co">## A mesma operação por subsetting:</span>
<span class="co">##</span>
<span class="va">clog</span> <span class="op">&lt;-</span> <span class="va">mpg</span><span class="op">$</span><span class="va">manufacturer</span> <span class="op">==</span> <span class="st">"toyota"</span>

<span class="va">mpg</span><span class="op">[</span><span class="va">clog</span>, <span class="op">]</span></code></pre></div>
<p></p>
<p>Múltiplas condições lógicas podem ser construídas dentro da função <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code>. Por exemplo, podemos ser um pouco mais específicos e selecionarmos apenas os modelos da Toyota que possuem um motor de 4 cilindradas com o comando abaixo. Repare abaixo, que ao acrescentarmos novas condições na função <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code>, elas acabam se tornando dependentes. Ou seja, ambas as condições devem ser atendidas ao mesmo tempo em cada linha retornada pela função <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code>.</p>
<p></p>
<div class="sourceCode" id="cb552"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mpg</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">manufacturer</span> <span class="op">==</span> <span class="st">"toyota"</span>, <span class="va">cyl</span> <span class="op">==</span> <span class="fl">4</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 18 × 11
##    manufacturer model displ  year   cyl trans drv     cty   hwy fl    class
##    &lt;chr&gt;        &lt;chr&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt;
##  1 toyota       4run…   2.7  1999     4 manu… 4        15    20 r     suv  
##  2 toyota       4run…   2.7  1999     4 auto… 4        16    20 r     suv  
##  3 toyota       camry   2.2  1999     4 manu… f        21    29 r     mids…
##  4 toyota       camry   2.2  1999     4 auto… f        21    27 r     mids…
##  5 toyota       camry   2.4  2008     4 manu… f        21    31 r     mids…
##  6 toyota       camry   2.4  2008     4 auto… f        21    31 r     mids…
##  7 toyota       camr…   2.2  1999     4 auto… f        21    27 r     comp…
##  8 toyota       camr…   2.2  1999     4 manu… f        21    29 r     comp…
##  9 toyota       camr…   2.4  2008     4 manu… f        21    31 r     comp…
## 10 toyota       camr…   2.4  2008     4 auto… f        22    31 r     comp…
## 11 toyota       coro…   1.8  1999     4 auto… f        24    30 r     comp…
## 12 toyota       coro…   1.8  1999     4 auto… f        24    33 r     comp…
## 13 toyota       coro…   1.8  1999     4 manu… f        26    35 r     comp…
## 14 toyota       coro…   1.8  2008     4 manu… f        28    37 r     comp…
## 15 toyota       coro…   1.8  2008     4 auto… f        26    35 r     comp…
## 16 toyota       toyo…   2.7  1999     4 manu… 4        15    20 r     pick…
## 17 toyota       toyo…   2.7  1999     4 auto… 4        16    20 r     pick…
## 18 toyota       toyo…   2.7  2008     4 manu… 4        17    22 r     pick…</code></pre>
<p></p>
<p></p>
<div class="sourceCode" id="cb554"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## -------------------------------------</span>
<span class="co">## A mesma operação por subsetting:</span>
<span class="co">##</span>
<span class="va">clog</span> <span class="op">&lt;-</span> <span class="va">mpg</span><span class="op">$</span><span class="va">manufacturer</span> <span class="op">==</span> <span class="st">"toyota"</span> <span class="op">&amp;</span> <span class="va">mpg</span><span class="op">$</span><span class="va">cyl</span> <span class="op">==</span> <span class="fl">4</span>

<span class="va">mpg</span><span class="op">[</span><span class="va">clog</span>, <span class="op">]</span></code></pre></div>
<p></p>
<p>Nós tradicionalmente estabelecemos relações de dependência entre condições lógicas, por meio do operador <code>&amp;</code>. Mas a função <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> busca ser prática e, por isso, ela automaticamente realiza esse trabalho por nós. Porém, isso implica que se as suas condições forem independentes, ajustes precisam ser feitos, através do operador <code>|</code>.</p>
<p>Visto esse ponto, você pode estar interessado em filtrar a sua tabela, de acordo com um conjunto de valores. Por exemplo, ao invés de selecionar apenas os modelos pertencentes à Toyota, podemos selecionar um conjunto maior de marcas. Em ocasiões como essa, o operador <code>%in%</code> se torna útil, pois você está pesquisando se o valor presente em cada linha de sua tabela, pertence ou não a um dado conjunto de valores.</p>
<p></p>
<div class="sourceCode" id="cb555"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">marcas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"volkswagen"</span>, <span class="st">"audi"</span>, <span class="st">"toyota"</span>, <span class="st">"honda"</span><span class="op">)</span>

<span class="va">mpg</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">manufacturer</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">marcas</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 88 × 11
##    manufacturer model displ  year   cyl trans drv     cty   hwy fl    class
##    &lt;chr&gt;        &lt;chr&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt;
##  1 audi         a4      1.8  1999     4 auto… f        18    29 p     comp…
##  2 audi         a4      1.8  1999     4 manu… f        21    29 p     comp…
##  3 audi         a4      2    2008     4 manu… f        20    31 p     comp…
##  4 audi         a4      2    2008     4 auto… f        21    30 p     comp…
##  5 audi         a4      2.8  1999     6 auto… f        16    26 p     comp…
##  6 audi         a4      2.8  1999     6 manu… f        18    26 p     comp…
##  7 audi         a4      3.1  2008     6 auto… f        18    27 p     comp…
##  8 audi         a4 q…   1.8  1999     4 manu… 4        18    26 p     comp…
##  9 audi         a4 q…   1.8  1999     4 auto… 4        16    25 p     comp…
## 10 audi         a4 q…   2    2008     4 manu… 4        20    28 p     comp…
## # … with 78 more rows</code></pre>
<p></p>
<p></p>
<div class="sourceCode" id="cb557"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## -------------------------------------</span>
<span class="co">## A mesma operação por subsetting:</span>
<span class="co">##</span>
<span class="va">marcas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"volkswagen"</span>, <span class="st">"audi"</span>, <span class="st">"toyota"</span>, <span class="st">"honda"</span><span class="op">)</span>
<span class="va">clog</span> <span class="op">&lt;-</span> <span class="va">mpg</span><span class="op">$</span><span class="va">manufacturer</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">marcas</span>

<span class="va">mpg</span><span class="op">[</span><span class="va">clog</span>, <span class="op">]</span></code></pre></div>
<p></p>
<div id="cuidados-com-o-operador-de-igualdade" class="section level3" number="5.6.1">
<h3>
<span class="header-section-number">5.6.1</span> Cuidados com o operador de igualdade<a class="anchor" aria-label="anchor" href="#cuidados-com-o-operador-de-igualdade"><i class="fas fa-link"></i></a>
</h3>
<p>Quando você estiver filtrando as linhas de sua tabela de acordo com uma condição de igualdade, é importante que você tome alguns cuidados, especialmente se valores textuais estiverem envolvidos nessa condição. O primeiro ponto a ser abordado é o uso do operador <code>==</code>, que para além de igualdade, ele busca encontrar valores <strong>exatamente</strong> iguais.</p>
<p>O “exatamente” é importante aqui, pois certos valores numéricos podem ser aparentemente idênticos aos nossos olhos, mas ainda assim, diferentes segundo a visão de <code>==</code>. Isso ocorre especialmente com valores numéricos do tipo <code>double</code>. Pois os nossos computadores utilizam precisão aritmética finita para guardar esse tipo de valor <span class="citation">(<a href="refer%C3%AAncias.html#ref-wickham2017" role="doc-biblioref">Wickham and Grolemund 2017</a>, p 47)</span>. Isso significa que os nossos computadores guardam apenas as casas decimais significantes de um valor <code>double</code>, e a perda de casas decimais que ocorre nesse processo, pode ser a fonte de alguma diferença em operações aritméticas. Por exemplo, se testarmos a igualdade entre <span class="math inline">\((\sqrt{2})^2 = 2\)</span>, o R vai nos indicar alguma diferença existente entre esses dois valores.</p>
<p></p>
<div class="sourceCode" id="cb558"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">==</span> <span class="fl">2</span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<p></p>
<p>Por essa razão, quando você estiver testando a igualdade entre valores do tipo <code>double</code>, é interessante que você utilize a função <code><a href="https://dplyr.tidyverse.org/reference/near.html">near()</a></code> ao invés do operador <code>==</code>. Por padrão, a função <code><a href="https://dplyr.tidyverse.org/reference/near.html">near()</a></code> possui uma tolerância próxima de <span class="math inline">\(1,49 \times 10^{-8}\)</span>, mas você pode ajustar esse valor pelo argumento <code>tol</code> da função.</p>
<p></p>
<div class="sourceCode" id="cb560"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://dplyr.tidyverse.org/reference/near.html">near</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p></p>
<p>Para mais, você também deve estar atento ao uso do operador <code>==</code>, quando estiver testando a igualdade entre palavras, ou valores textuais. Pois uma palavra pode ser escrita de múltiplas maneiras sem que ela perca o seu sentido, e a mínima diferença presente nos caracteres utilizados pode torná-las valores completamente diferentes aos olhos do operador <code>==</code>. Logo, os valores <code>"Isabela"</code> e <code>"isabela"</code> são diferentes na visão de <code>==</code>, mesmo que na prática, esses valores muito provavelmente se referem ao mesmo indivíduo.</p>
<p></p>
<div class="sourceCode" id="cb562"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="st">"Isabela"</span> <span class="op">==</span> <span class="st">"isabela"</span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<p></p>
<p>Se você possui em sua coluna, uma variedade maior de valores textuais, que são diferentes, mas que dizem respeito ao mesmo indivíduo (por exemplo, você possui seis variedades de “Isabela”: <code>Isabela</code>; <code>ISABELA</code>; <code>IsAbElA</code>; <code>Ísabela</code>; <code>ísabela</code>; <code>i\@abela</code>), você muito provavelmente necessita de uma expressão regular. Para acessar esse mecanismo e utilizá-lo dentro da função <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code>, você precisa de uma função que utilize essa funcionalidade para pesquisar os textos que se encaixam em sua expressão, e que retorne como resultado, um vetor de valores lógicos que indicam as linhas de sua tabela em que esses textos ocorrem. Sendo os principais indivíduos dessa categoria, a função <code><a href="https://rdrr.io/r/base/grep.html">grepl()</a></code>, e a função <code><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect()</a></code> que pertence ao pacote <code>stringr</code>.</p>
<p>Por outro lado, pode ser que você não precise ir tão longe, caso as diferenças presentes em seus textos se apresentem na forma de capitalização das letras (maiúsculo ou minúsculo). Por exemplo, suponha que a sua variedade de “Isabela” fosse: <code>Isabela</code>; <code>ISABELA</code>; <code>IsAbElA</code> e <code>isabela</code>. Para tornar esses valores iguais, você precisaria apenas de um método de pesquisa que seja capaz de ignorar a capitalização das letras. Para isso, você pode utilizar a função <code><a href="https://rdrr.io/r/base/grep.html">grepl()</a></code> que possui o argumento <code>ignore.case</code>, no qual você pode pedir a função que ignore essas diferenças na capitalização, como no exemplo abaixo.</p>
<p></p>
<div class="sourceCode" id="cb564"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span>
<span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>
  usuario <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Ana"</span>, <span class="st">"Isabela"</span>, <span class="st">"isabela"</span>, <span class="st">"Julia"</span><span class="op">)</span>,
  id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span>,
  valor <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span>
<span class="op">)</span>

<span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span><span class="st">"Isabela"</span>, <span class="va">usuario</span>, ignore.case <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>##   usuario id valor
## 1 Isabela  2  0.18
## 2 isabela  3  1.59</code></pre>
<p></p>
</div>
<div id="estabelecendo-intervalos-com-a-função-between" class="section level3" number="5.6.2">
<h3>
<span class="header-section-number">5.6.2</span> Estabelecendo intervalos com a função <code>between()</code><a class="anchor" aria-label="anchor" href="#estabelecendo-intervalos-com-a-fun%C3%A7%C3%A3o-between"><i class="fas fa-link"></i></a>
</h3>
<p>Para estabelecermos uma condição de intervalo no R, precisamos de duas condições lógicas que definam os limites deste intervalo. Em seguida, nós devemos tornar essas duas condições dependentes. Por exemplo, se desejássemos filtrar todas as linhas de <code>mpg</code> que possuem um valor na coluna <code>hwy</code> entre 18 e 24, precisaríamos do seguinte teste lógico:</p>
<p></p>
<div class="sourceCode" id="cb566"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mpg</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">hwy</span> <span class="op">&gt;=</span> <span class="fl">18</span>, <span class="va">hwy</span> <span class="op">&lt;=</span> <span class="fl">24</span><span class="op">)</span>

<span class="co">## -------------------------------------</span>
<span class="co">## A mesma operação por subsetting:</span>
<span class="co">##</span>
<span class="va">clog</span> <span class="op">&lt;-</span> <span class="va">mpg</span><span class="op">$</span><span class="va">hwy</span> <span class="op">&gt;=</span> <span class="fl">18</span> <span class="op">&amp;</span> <span class="va">mpg</span><span class="op">$</span><span class="va">hwy</span> <span class="op">&lt;=</span> <span class="fl">24</span>

<span class="va">mpg</span><span class="op">[</span><span class="va">clog</span>, <span class="op">]</span></code></pre></div>
<p></p>
<p>Porém, de uma maneira mais prática, podemos utilizar a função <code><a href="https://dplyr.tidyverse.org/reference/between.html">between()</a></code> que consiste em um atalho para essa metodologia. A função possui três argumentos: 1) <code>x</code>, a coluna ou o vetor sobre o qual você deseja aplicar o teste de intervalo; 2) <code>left</code>, o limite “inferior” (ou “esquerdo”) do intervalo; 3) <code>right</code>, o limite “superior” (ou “direito”) do intervalo. Logo, se fôssemos traduzir o teste de intervalo anterior para a função <code><a href="https://dplyr.tidyverse.org/reference/between.html">between()</a></code>, faríamos da seguinte maneira:</p>
<p></p>
<div class="sourceCode" id="cb567"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mpg</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/between.html">between</a></span><span class="op">(</span><span class="va">hwy</span>, <span class="fl">18</span>, <span class="fl">24</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 63 × 11
##    manufacturer model displ  year   cyl trans drv     cty   hwy fl    class
##    &lt;chr&gt;        &lt;chr&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt;
##  1 audi         a6 q…   2.8  1999     6 auto… 4        15    24 p     mids…
##  2 audi         a6 q…   4.2  2008     8 auto… 4        16    23 p     mids…
##  3 chevrolet    c150…   5.3  2008     8 auto… r        14    20 r     suv  
##  4 chevrolet    c150…   5.3  2008     8 auto… r        14    20 r     suv  
##  5 chevrolet    corv…   5.7  1999     8 auto… r        15    23 p     2sea…
##  6 chevrolet    corv…   7    2008     8 manu… r        15    24 p     2sea…
##  7 chevrolet    k150…   5.3  2008     8 auto… 4        14    19 r     suv  
##  8 dodge        cara…   2.4  1999     4 auto… f        18    24 r     mini…
##  9 dodge        cara…   3    1999     6 auto… f        17    24 r     mini…
## 10 dodge        cara…   3.3  1999     6 auto… f        16    22 r     mini…
## # … with 53 more rows</code></pre>
<p></p>
</div>
<div id="sec:ataque_terrorista" class="section level3" number="5.6.3">
<h3>
<span class="header-section-number">5.6.3</span> Ataque terrorista<a class="anchor" aria-label="anchor" href="#sec:ataque_terrorista"><i class="fas fa-link"></i></a>
</h3>
<p>Vamos dar um pouco de contexto para as nossas operações. Nessa seção, vamos utilizar os dados disponíveis na tabela <code>transf</code>, que podem ser importados para o seu R através dos comandos abaixo. A tabela <code>transf</code> contém informações sobre diversas transferências bancárias realizadas por uma instituição bancária. Algumas informações presentes nessa tabela incluem: a data e o horário da transferência (<code>Data</code>); O <em>username</em> do usuário do banco responsável por realizar a transferência (<code>Usuario</code>); o país de destino da transferência (<code>Pais</code>); um código de identificação da transferência (<code>TransferID</code>); e o valor transferido (<code>Valor</code>).</p>
<p></p>
<div class="sourceCode" id="cb569"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">github</span> <span class="op">&lt;-</span> <span class="st">"https://raw.githubusercontent.com/pedropark99/"</span>
<span class="va">pasta</span> <span class="op">&lt;-</span> <span class="st">"Curso-R/master/Dados/"</span>
<span class="va">arquivo</span> <span class="op">&lt;-</span> <span class="st">"transf_reform.csv"</span>

<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://readr.tidyverse.org">readr</a></span><span class="op">)</span>

<span class="va">transf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv2</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">github</span>, <span class="va">pasta</span>, <span class="va">arquivo</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p></p>
<p></p>
<div class="sourceCode" id="cb570"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">transf</span></code></pre></div>
<pre><code>## # A tibble: 20,006 × 6
##    Data                Usuario   Valor TransferID Pais     Descricao
##    &lt;dttm&gt;              &lt;chr&gt;     &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;    &lt;lgl&gt;    
##  1 2018-12-06 22:19:19 Eduardo    599.  116241629 Alemanha NA       
##  2 2018-12-06 22:10:34 Júlio     4611.  115586504 Alemanha NA       
##  3 2018-12-06 21:59:50 Nathália  4418.  115079280 Alemanha NA       
##  4 2018-12-06 21:54:13 Júlio     2740.  114972398 Alemanha NA       
##  5 2018-12-06 21:41:27 Ana       1408.  116262934 Alemanha NA       
##  6 2018-12-06 21:18:40 Nathália  5052.  115710402 Alemanha NA       
##  7 2018-12-06 20:54:32 Eduardo   5665.  114830203 Alemanha NA       
##  8 2018-12-06 20:15:46 Sandra    1474.  116323455 Alemanha NA       
##  9 2018-12-06 20:04:35 Armando   8906.  115304382 Alemanha NA       
## 10 2018-12-22 20:00:56 Armando  18521.  114513684 Alemanha NA       
## # … with 19,996 more rows</code></pre>
<p></p>
<p>Vamos supor que no dia 24 de dezembro de 2018, tenha ocorrido um ataque terrorista na cidade de Berlim (Alemanha). Suponha também, que você faz parte do setor de <em>compliance</em> da instituição financeira responsável pelas transferências descritas na tabela <code>transf</code>. Em geral, um dos principais papéis de um setor de <em>compliance</em> é garantir que a sua instituição não esteja contribuindo com práticas ilícitas (dentre elas está o terrorismo).</p>
<p>Segundo o relatório da polícia, há fortes indícios de que a munição utilizada no ato, foi comprada durante os dias 20 e 23. Além disso, a polícia também destacou que levando em conta a quantidade utilizada no ataque, somente a munição empregada custou em média mais de $15.000.</p>
<p>Logo, o seu papel seria se certificar de que a instituição a qual você pertence, não realizou alguma transferência que se encaixa nessas características. Pois caso tal transferência exista, vocês teriam de abrir uma investigação em conjunto com a polícia, para apurar as fontes e os destinatários dos recursos dessa transferência.</p>
<p>Portanto, estamos procurando por uma transferência na tabela <code>transf</code> de valor acima de $15.000, que possua a Alemanha como país de destino, e que tenha ocorrido durante os dias 20 e 23 de dezembro de 2018. Perceba que todas essas condições, ou características da transferência devem ser atendidas ao mesmo tempo. Ou seja, essas condições lógicas são dependentes uma da outra.</p>
<p>Lembre-se que quando temos diversas condições lógicas dependentes, nós podemos separá-las por vírgulas na função <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code>. Por outro lado, fora do uso da função <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code>, nós estabelecemos uma relação de dependência entre várias condições lógicas por meio do operador <code>&amp;</code>, e será esse o método tradicional utilizado nessa seção. Logo, quando temos diversas condições no R que devem ser atendidas ao mesmo tempo, nós devemos conectar cada uma dessas condições pelo operador <code>&amp;</code>, como no exemplo abaixo.</p>
<p></p>
<div class="sourceCode" id="cb572"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">transf</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span>
    <span class="va">Valor</span> <span class="op">&gt;</span> <span class="fl">15000</span> <span class="op">&amp;</span> <span class="va">Pais</span> <span class="op">==</span> <span class="st">"Alemanha"</span> <span class="op">&amp;</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/between.html">between</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="va">Data</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2018-12-20"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2018-12-23"</span><span class="op">)</span><span class="op">)</span>
  <span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 132 × 6
##    Data                Usuario      Valor TransferID Pais     Descricao
##    &lt;dttm&gt;              &lt;chr&gt;        &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;    &lt;lgl&gt;    
##  1 2018-12-22 20:00:56 Armando     18521.  114513684 Alemanha NA       
##  2 2018-12-21 18:46:59 Júlio Cesar 16226.  116279014 Alemanha NA       
##  3 2018-12-21 17:41:48 Nathália    17583.  115748273 Alemanha NA       
##  4 2018-12-23 09:46:23 Júlio       15396.  115272184 Alemanha NA       
##  5 2018-12-21 06:38:20 Júlio Cesar 17555.  114983226 Alemanha NA       
##  6 2018-12-23 18:11:27 Eduardo     17219.  115904797 Alemanha NA       
##  7 2018-12-22 13:09:13 Eduardo     16255.  114520578 Alemanha NA       
##  8 2018-12-23 10:59:50 Júlio Cesar 15093.  115919119 Alemanha NA       
##  9 2018-12-23 10:29:34 Sandra      19241.  114665132 Alemanha NA       
## 10 2018-12-21 06:04:49 Júlio Cesar 18938.  116281869 Alemanha NA       
## # … with 122 more rows</code></pre>
<p></p>
<p></p>
<div class="sourceCode" id="cb574"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## -------------------------------------</span>
<span class="co">## A mesma operação por subsetting:</span>
<span class="co">##</span>
<span class="va">clog</span> <span class="op">&lt;-</span> <span class="va">transf</span><span class="op">$</span><span class="va">Valor</span> <span class="op">&gt;</span> <span class="fl">15000</span> <span class="op">&amp;</span> <span class="va">transf</span><span class="op">$</span><span class="va">Pais</span> <span class="op">==</span> <span class="st">"Alemanha"</span> <span class="op">&amp;</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/between.html">between</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="va">transf</span><span class="op">$</span><span class="va">Data</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2018-12-20"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2018-12-23"</span><span class="op">)</span><span class="op">)</span>

<span class="va">transf</span><span class="op">[</span><span class="va">clog</span>, <span class="op">]</span></code></pre></div>
<p></p>
<p>No total, 132 linhas foram retornadas pela função, e você teria de conferir cada uma dessas transferências. Um baita trabalho! Porém, vamos supor que em um minuto de reflexão sobre as regras do banco, você se lembre que o remetente da transferência não é obrigado a apresentar uma prova de fundos ou um comprovante de endereço, caso a transferência possua um valor menor do que $200. Em casos como esse, o remetente precisa apresentar apenas a identidade (que ele pode ter falsificado).</p>
<p></p>
<div class="sourceCode" id="cb575"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">transf</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span>
    <span class="va">Valor</span> <span class="op">&lt;=</span> <span class="fl">200</span> <span class="op">&amp;</span> <span class="va">Pais</span> <span class="op">==</span> <span class="st">"Alemanha"</span> <span class="op">&amp;</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/between.html">between</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="va">Data</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2018-12-20"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2018-12-23"</span><span class="op">)</span><span class="op">)</span>
  <span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 5 × 6
##   Data                Usuario Valor TransferID Pais     Descricao
##   &lt;dttm&gt;              &lt;chr&gt;   &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;    &lt;lgl&gt;    
## 1 2018-12-20 00:31:17 Júlio     193  115555598 Alemanha NA       
## 2 2018-12-22 06:30:01 Sandra    100  116400001 Alemanha NA       
## 3 2018-12-22 06:35:00 Sandra    200  116400002 Alemanha NA       
## 4 2018-12-22 06:42:12 Eduardo   200  116400005 Alemanha NA       
## 5 2018-12-22 06:55:54 Eduardo   150  116400009 Alemanha NA</code></pre>
<p></p>
<p>Isso é interessante, pois conseguimos reduzir os nossos resultados para apenas 5 transferências. Ao conferirmos as informações da primeira transferência, os recursos estão limpos. Porém, as próximas 4 transferências levantam algumas suspeitas. Pois elas foram realizadas por clientes diferentes, mas com poucos minutos de diferença. Ao conversar com os agentes Sandra e Eduardo, que autorizaram essas transferências, você descobre que todos os diferentes clientes apresentaram transferências francesas. Será que esses clientes estavam testando as regras da instituição para com identidades desse país?</p>
<p>Ao procurar por todas as transferências em que identidades francesas foram apresentadas, e que foram realizadas entre os dias 20 e 23 de dezembro de 2018, e que possuíam a Alemanha como país de destino, você chega a uma estranha transferência de $20.000 efetuada poucos minutos depois das 4 transferências que encontramos anteriormente. Durante a análise das informações dessa transferência, você percebe diversas falhas presentes na prova de fundos que sustentou a decisão de autorização dessa operação. Há uma grande possibilidade de que os chefes e agentes de sua instituição que autorizaram essa operação, estejam em maus lençóis.</p>
<p></p>
<div class="sourceCode" id="cb577"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">transf</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span><span class="op">(</span>
    <span class="va">identidade</span>,
    by <span class="op">=</span> <span class="st">"TransferID"</span>
  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span>
    <span class="va">Pais</span> <span class="op">==</span> <span class="st">"Alemanha"</span> <span class="op">&amp;</span> <span class="va">Identi_Nacion</span> <span class="op">==</span> <span class="st">"França"</span> <span class="op">&amp;</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/between.html">between</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="va">Data</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2018-12-20"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2018-12-23"</span><span class="op">)</span><span class="op">)</span>
  <span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 5 × 7
##   Data                Usuario Valor TransferID Pais     Descricao Identi_…¹
##   &lt;dttm&gt;              &lt;chr&gt;   &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;    &lt;lgl&gt;     &lt;chr&gt;    
## 1 2018-12-22 06:30:01 Sandra    100  116400001 Alemanha NA        França   
## 2 2018-12-22 06:35:00 Sandra    200  116400002 Alemanha NA        França   
## 3 2018-12-22 06:42:12 Eduardo   200  116400005 Alemanha NA        França   
## 4 2018-12-22 06:55:54 Eduardo   150  116400009 Alemanha NA        França   
## 5 2018-12-22 06:59:07 Eduardo 20000  116400010 Alemanha NA        França   
## # … with abbreviated variable name ¹​Identi_Nacion</code></pre>
<p></p>
</div>
<div id="condições-dependentes-ou-independentes" class="section level3" number="5.6.4">
<h3>
<span class="header-section-number">5.6.4</span> Condições dependentes (&amp;) ou independentes (|) ?<a class="anchor" aria-label="anchor" href="#condi%C3%A7%C3%B5es-dependentes-ou-independentes"><i class="fas fa-link"></i></a>
</h3>
<p>Na seção anterior, as condições lógicas que guiavam o nosso filtro eram dependentes entre si. Em outras palavras, as condições deveriam ser todas atendidas ao mesmo tempo. Por essa razão, nós conectamos as condições lógicas com o operador <code>&amp;</code>. Porém, em algumas ocasiões as suas condições serão independentes e, por isso, devemos utilizar um outro operador para conectá-las, que é a barra vertical (<code>|</code>).</p>
<p>Por exemplo, se eu quiser encontrar todas as transferências na tabela <code>transf</code> que ocorreram no dia 13 de novembro de 2018, <strong>ou</strong> que possuem um valor menor que $500, <strong>ou</strong> que foram autorizadas pelo agente Eduardo, eu devo construir o comando abaixo. Logo, toda linha da tabela <code>transf</code> que atenda pelo menos uma das condições que estabelecemos, é filtrada pela função <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code>.</p>
<p></p>
<div class="sourceCode" id="cb579"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">transf</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span>
    <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="va">Data</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2018-11-13"</span><span class="op">)</span> <span class="op">|</span> <span class="va">Valor</span> <span class="op">&lt;</span> <span class="fl">500</span> <span class="op">|</span>
    <span class="va">Usuario</span> <span class="op">==</span> <span class="st">"Eduardo"</span>
  <span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 5,581 × 6
##    Data                Usuario      Valor TransferID Pais     Descricao
##    &lt;dttm&gt;              &lt;chr&gt;        &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;    &lt;lgl&gt;    
##  1 2018-12-06 22:19:19 Eduardo       599.  116241629 Alemanha NA       
##  2 2018-12-06 20:54:32 Eduardo      5665.  114830203 Alemanha NA       
##  3 2018-12-06 19:07:50 Eduardo      9561.  115917812 Alemanha NA       
##  4 2018-12-06 18:09:15 Júlio Cesar   388.  114894102 Alemanha NA       
##  5 2018-12-06 16:59:38 Eduardo     11759.  115580064 Alemanha NA       
##  6 2018-12-06 15:21:36 Eduardo      4436.  114425893 Alemanha NA       
##  7 2018-12-06 14:47:25 Ana           483.  114387526 Alemanha NA       
##  8 2018-12-06 12:59:58 Ana           207.  115615456 Alemanha NA       
##  9 2018-12-06 10:05:21 Eduardo       708.  114746955 Alemanha NA       
## 10 2018-12-06 09:50:03 Eduardo      1587.  114796170 Alemanha NA       
## # … with 5,571 more rows</code></pre>
<p></p>
<p></p>
<div class="sourceCode" id="cb581"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## -------------------------------------</span>
<span class="co">## A mesma operação por subsetting:</span>
<span class="co">##</span>
<span class="va">clog</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="va">transf</span><span class="op">$</span><span class="va">Data</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2018-11-13"</span><span class="op">)</span> <span class="op">|</span> 
  <span class="va">transf</span><span class="op">$</span><span class="va">Valor</span> <span class="op">&lt;</span> <span class="fl">500</span> <span class="op">|</span> <span class="va">transf</span><span class="op">$</span><span class="va">Usuario</span> <span class="op">==</span> <span class="st">"Eduardo"</span>

<span class="va">transf</span><span class="op">[</span><span class="va">clog</span>, <span class="op">]</span></code></pre></div>
<p></p>
</div>
</div>
<div id="ordenando-linhas-com-arrange" class="section level2" number="5.7">
<h2>
<span class="header-section-number">5.7</span> Ordenando linhas com <code>arrange()</code><a class="anchor" aria-label="anchor" href="#ordenando-linhas-com-arrange"><i class="fas fa-link"></i></a>
</h2>
<p>Algumas operações que realizamos dependem diretamente da forma como as linhas de nossa tabela estão ordenadas. Em outros momentos, desejamos ordenar a nossa tabela, para rapidamente identificarmos as observações que possuem os 10 maiores valores de alguma variável ao longo da base. Ou seja, a ordenação de linhas é uma operação muito comum, e o pacote <code>dplyr</code> oferece a função <code><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange()</a></code> para tal ação.</p>
<p>O uso da função <code><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange()</a></code> é bem simples. Tudo o que você precisa fazer é listar as colunas pelas quais você deseja ordenar a base. Caso a coluna seja numérica, <code><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange()</a></code> vai seguir uma ordenação numérica. Mas se essa coluna for do tipo <code>character</code>, <code><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange()</a></code> vai utilizar uma ordenação alfabética para organizar os valores da coluna. Por outro lado, na hipótese dessa coluna ser do tipo <code>factor</code>, <code><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange()</a></code> vai seguir a ordem presente nos “níveis” (<code>levels</code>) desse <code>factor</code>, aos quais você pode acessar pela função <code><a href="https://rdrr.io/r/base/levels.html">levels()</a></code>.</p>
<p></p>
<div class="sourceCode" id="cb582"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mpg</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">displ</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 234 × 11
##    manufacturer model displ  year   cyl trans drv     cty   hwy fl    class
##    &lt;chr&gt;        &lt;chr&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt;
##  1 honda        civic   1.6  1999     4 manu… f        28    33 r     subc…
##  2 honda        civic   1.6  1999     4 auto… f        24    32 r     subc…
##  3 honda        civic   1.6  1999     4 manu… f        25    32 r     subc…
##  4 honda        civic   1.6  1999     4 manu… f        23    29 p     subc…
##  5 honda        civic   1.6  1999     4 auto… f        24    32 r     subc…
##  6 audi         a4      1.8  1999     4 auto… f        18    29 p     comp…
##  7 audi         a4      1.8  1999     4 manu… f        21    29 p     comp…
##  8 audi         a4 q…   1.8  1999     4 manu… 4        18    26 p     comp…
##  9 audi         a4 q…   1.8  1999     4 auto… 4        16    25 p     comp…
## 10 honda        civic   1.8  2008     4 manu… f        26    34 r     subc…
## # … with 224 more rows</code></pre>
<p></p>
<p>Você pode recorrer a várias colunas para ordenar a sua base. Nessa situação, a função <code><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange()</a></code> vai ordenar as colunas na ordem em que você as definiu na função. Ou seja, no exemplo abaixo, a função <code><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange()</a></code> primeiro ordena a base de acordo com a coluna <code>displ</code>, em seguida, segundo a coluna <code>hwy</code>, e por último, a coluna <code>trans</code>.</p>
<p></p>
<div class="sourceCode" id="cb584"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mpg</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">displ</span>, <span class="va">hwy</span>, <span class="va">trans</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 234 × 11
##    manufacturer model displ  year   cyl trans drv     cty   hwy fl    class
##    &lt;chr&gt;        &lt;chr&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt;
##  1 honda        civic   1.6  1999     4 manu… f        23    29 p     subc…
##  2 honda        civic   1.6  1999     4 auto… f        24    32 r     subc…
##  3 honda        civic   1.6  1999     4 auto… f        24    32 r     subc…
##  4 honda        civic   1.6  1999     4 manu… f        25    32 r     subc…
##  5 honda        civic   1.6  1999     4 manu… f        28    33 r     subc…
##  6 audi         a4 q…   1.8  1999     4 auto… 4        16    25 p     comp…
##  7 audi         a4 q…   1.8  1999     4 manu… 4        18    26 p     comp…
##  8 audi         a4      1.8  1999     4 auto… f        18    29 p     comp…
##  9 volkswagen   pass…   1.8  1999     4 auto… f        18    29 p     mids…
## 10 audi         a4      1.8  1999     4 manu… f        21    29 p     comp…
## # … with 224 more rows</code></pre>
<p></p>
<p>Por padrão, a função <code><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange()</a></code> utiliza uma ordenação em um sentido crescente (do menor para o maior valor; do primeiro para o último valor), qualquer que seja o tipo de dado contido na coluna que você forneceu a função. Caso você deseja utilizar uma ordenação em um sentido decrescente (do maior para o menor valor; do último para o primeiro valor) em uma dada coluna, você deve encapsular o nome dessa coluna na função <code><a href="https://dplyr.tidyverse.org/reference/desc.html">desc()</a></code>. No exemplo abaixo, <code><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange()</a></code> primeiro ordena a coluna <code>manufacturer</code> em uma forma decrescente e, em seguida, ordena a coluna <code>hwy</code> de acordo com uma ordem crescente.</p>
<p></p>
<div class="sourceCode" id="cb586"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mpg</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">manufacturer</span><span class="op">)</span>, <span class="va">hwy</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 234 × 11
##    manufacturer model displ  year   cyl trans drv     cty   hwy fl    class
##    &lt;chr&gt;        &lt;chr&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt;
##  1 volkswagen   jetta   2.8  1999     6 auto… f        16    23 r     comp…
##  2 volkswagen   gti     2.8  1999     6 manu… f        17    24 r     comp…
##  3 volkswagen   jetta   2.8  1999     6 manu… f        17    24 r     comp…
##  4 volkswagen   gti     2    1999     4 auto… f        19    26 r     comp…
##  5 volkswagen   jetta   2    1999     4 auto… f        19    26 r     comp…
##  6 volkswagen   new …   2    1999     4 auto… f        19    26 r     subc…
##  7 volkswagen   pass…   2.8  1999     6 auto… f        16    26 p     mids…
##  8 volkswagen   pass…   2.8  1999     6 manu… f        18    26 p     mids…
##  9 volkswagen   pass…   3.6  2008     6 auto… f        17    26 p     mids…
## 10 volkswagen   new …   2.5  2008     5 manu… f        20    28 r     subc…
## # … with 224 more rows</code></pre>
<p></p>
<p>Como estamos basicamente definindo colunas na função <code><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange()</a></code>, é natural que você anseie pelos diversos métodos de seleção que aprendemos em <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code>. Por isso, em versões mais recentes do pacote <code>dplyr</code> tivemos a introdução da função <code><a href="https://dplyr.tidyverse.org/reference/across.html">across()</a></code>, pela qual você tem novamente acesso a todos esses métodos que vimos em <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code>.</p>
<p></p>
<div class="sourceCode" id="cb588"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Ordenar a base segundo as três primeiras colunas</span>
<span class="va">mpg</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span>

<span class="co">## Ordenar a base segundo o conjunto de colunas</span>
<span class="co">## que possuem um nome que se inicia</span>
<span class="co">## pelos caracteres "dis"</span>
<span class="va">mpg</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"dis"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p></p>
<p>Vale destacar que a função <code><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange()</a></code>, por padrão, não respeita os grupos de sua tabela e, portanto, considera toda a sua tabela no momento em que a ordenação ocorre. Ainda veremos em mais detalhes nas próximas seções, a função <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code>, pela qual você pode definir os grupos presentes em sua tabela. Portanto, pode ser de seu desejo que a ordenação executada por <code><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange()</a></code> ocorra dentro de cada um dos grupos que você delimitou através da função <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code>. Para isso, você precisa configurar o argumento <code>.by_group</code> para <code>TRUE</code>.</p>
<p></p>
<div class="sourceCode" id="cb589"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mpg</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">manufacturer</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">hwy</span>, .by_group <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 234 × 11
## # Groups:   manufacturer [15]
##    manufacturer model displ  year   cyl trans drv     cty   hwy fl    class
##    &lt;chr&gt;        &lt;chr&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt;
##  1 audi         a6 q…   4.2  2008     8 auto… 4        16    23 p     mids…
##  2 audi         a6 q…   2.8  1999     6 auto… 4        15    24 p     mids…
##  3 audi         a4 q…   1.8  1999     4 auto… 4        16    25 p     comp…
##  4 audi         a4 q…   2.8  1999     6 auto… 4        15    25 p     comp…
##  5 audi         a4 q…   2.8  1999     6 manu… 4        17    25 p     comp…
##  6 audi         a4 q…   3.1  2008     6 auto… 4        17    25 p     comp…
##  7 audi         a4 q…   3.1  2008     6 manu… 4        15    25 p     comp…
##  8 audi         a6 q…   3.1  2008     6 auto… 4        17    25 p     mids…
##  9 audi         a4      2.8  1999     6 auto… f        16    26 p     comp…
## 10 audi         a4      2.8  1999     6 manu… f        18    26 p     comp…
## # … with 224 more rows</code></pre>
<p></p>
</div>
<div id="sec:mutate_dplyr" class="section level2" number="5.8">
<h2>
<span class="header-section-number">5.8</span> Adicionando variáveis à sua tabela com <code>mutate()</code><a class="anchor" aria-label="anchor" href="#sec:mutate_dplyr"><i class="fas fa-link"></i></a>
</h2>
<p>Frequentemente, você deseja adicionar uma nova variável em sua tabela como uma função de outras variáveis já existentes em sua tabela. Para tal fim, o pacote <code>dplyr</code> disponibiliza a função <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code>, que oferta um mecanismo limpo e rápido para executarmos tal ação.</p>
<p>Como um exemplo inicial, vamos voltar a tabela <code>transf</code> que introduzimos na seção <a href="transformando-dados-com-dplyr.html#sec:ataque_terrorista">Ataque terrorista</a>. A coluna <code>Data</code> retém a data e o horário em que cada operação foi registrada no sistema do banco. Entretanto, o horário pode se tornar irrelevante para certos passos e, por essa razão, seria interessante que possuíssemos uma coluna na tabela <code>transf</code>, contendo apenas a data de cada transferência. Com esse objetivo em mente, somos capazes de extrair a data da coluna <code>Data</code> através da função <code><a href="https://rdrr.io/r/base/as.Date.html">as.Date()</a></code>, e empregar a função <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> para armazenarmos o resultado desse procedimento em uma nova coluna chamada <code>Sem_hora</code>, como mostrado abaixo.</p>
<p></p>
<div class="sourceCode" id="cb591"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">transf</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">Pais</span>, <span class="op">-</span><span class="va">Descricao</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>
    Sem_hora <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="va">Data</span><span class="op">)</span>
  <span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 20,006 × 5
##    Data                Usuario   Valor TransferID Sem_hora  
##    &lt;dttm&gt;              &lt;chr&gt;     &lt;dbl&gt;      &lt;dbl&gt; &lt;date&gt;    
##  1 2018-12-06 22:19:19 Eduardo    599.  116241629 2018-12-06
##  2 2018-12-06 22:10:34 Júlio     4611.  115586504 2018-12-06
##  3 2018-12-06 21:59:50 Nathália  4418.  115079280 2018-12-06
##  4 2018-12-06 21:54:13 Júlio     2740.  114972398 2018-12-06
##  5 2018-12-06 21:41:27 Ana       1408.  116262934 2018-12-06
##  6 2018-12-06 21:18:40 Nathália  5052.  115710402 2018-12-06
##  7 2018-12-06 20:54:32 Eduardo   5665.  114830203 2018-12-06
##  8 2018-12-06 20:15:46 Sandra    1474.  116323455 2018-12-06
##  9 2018-12-06 20:04:35 Armando   8906.  115304382 2018-12-06
## 10 2018-12-22 20:00:56 Armando  18521.  114513684 2018-12-22
## # … with 19,996 more rows</code></pre>
<p></p>
<p>Portanto, sempre que você recorrer à função <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code>, você deve compor essa estrutura de <code>&lt;nome_coluna&gt; = &lt;expressao&gt;</code> em cada coluna adicionada. Ou seja, como flexibilidade e eficiência são valores que as funções do pacote <code>dplyr</code> carregam, você tem a capacidade de criar múltiplas colunas em um mesmo <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code>. Porém, como um aviso, é ideal que você não crie mais de 7 colunas ao mesmo tempo. Na hipótese dessa recomendação ser ignorada, há uma probabilidade significativa de você enfrentar problemas de memória e mensagens de erro bastante nebulosas.</p>
<p></p>
<div class="sourceCode" id="cb593"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb593-1"><a href="transformando-dados-com-dplyr.html#cb593-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Estrutura básica de um mutate():</span></span>
<span id="cb593-2"><a href="transformando-dados-com-dplyr.html#cb593-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&lt;</span>sua_tabela<span class="sc">&gt;</span> <span class="sc">%&gt;%</span> </span>
<span id="cb593-3"><a href="transformando-dados-com-dplyr.html#cb593-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb593-4"><a href="transformando-dados-com-dplyr.html#cb593-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">nome_coluna1 =</span> expressao1,</span>
<span id="cb593-5"><a href="transformando-dados-com-dplyr.html#cb593-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">nome_coluna2 =</span> expressao2,</span>
<span id="cb593-6"><a href="transformando-dados-com-dplyr.html#cb593-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">nome_coluna3 =</span> expressao3,</span>
<span id="cb593-7"><a href="transformando-dados-com-dplyr.html#cb593-7" aria-hidden="true" tabindex="-1"></a>    ...</span>
<span id="cb593-8"><a href="transformando-dados-com-dplyr.html#cb593-8" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p></p>
<p>Um outro ponto muito importante, é que em um mesmo <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code>, você também pode empregar uma nova coluna que você acaba de criar, no cálculo de uma outra coluna a ser produzida. Por exemplo, eu posso guardar o desvio de <code>Valor</code> em relação à sua média, na coluna <code>Desvio</code>, e logo em seguida, utilizar os valores dessa coluna para produzir a coluna <code>Valor_norm</code>, como exposto abaixo.</p>
<p></p>
<div class="sourceCode" id="cb594"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">transf</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">Pais</span>, <span class="op">-</span><span class="va">Descricao</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>
    Desvio <span class="op">=</span> <span class="va">Valor</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">Valor</span><span class="op">)</span>,
    Valor_norm <span class="op">=</span> <span class="va">Desvio</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">Valor</span><span class="op">)</span>
  <span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 20,006 × 6
##    Data                Usuario   Valor TransferID Desvio Valor_norm
##    &lt;dttm&gt;              &lt;chr&gt;     &lt;dbl&gt;      &lt;dbl&gt;  &lt;dbl&gt;      &lt;dbl&gt;
##  1 2018-12-06 22:19:19 Eduardo    599.  116241629 -2920.     -0.772
##  2 2018-12-06 22:10:34 Júlio     4611.  115586504  1093.      0.289
##  3 2018-12-06 21:59:50 Nathália  4418.  115079280   900.      0.238
##  4 2018-12-06 21:54:13 Júlio     2740.  114972398  -778.     -0.206
##  5 2018-12-06 21:41:27 Ana       1408.  116262934 -2110.     -0.558
##  6 2018-12-06 21:18:40 Nathália  5052.  115710402  1534.      0.405
##  7 2018-12-06 20:54:32 Eduardo   5665.  114830203  2147.      0.568
##  8 2018-12-06 20:15:46 Sandra    1474.  116323455 -2044.     -0.540
##  9 2018-12-06 20:04:35 Armando   8906.  115304382  5387.      1.42 
## 10 2018-12-22 20:00:56 Armando  18521.  114513684 15003.      3.97 
## # … with 19,996 more rows</code></pre>
<p></p>
<p>Com isso, a parte fundamental de um <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> é construirmos a expressão que produzirá os valores a serem alocados na nova coluna que estamos criando. Logo abaixo, consta uma lista de várias funções que você pode utilizar para formar a expressão que você deseja. Ademais, essa é uma lista parcial, logo, há diversas outras funções que você pode utilizar para calcular os valores dos quais você necessita.</p>
<ol style="list-style-type: decimal">
<li><p><strong>Somatórios:</strong> soma total de uma coluna - <code><a href="https://rdrr.io/r/base/sum.html">sum()</a></code>; somatório por linha, ao longo de algumas colunas - operador <code>+</code>; somatório por linha, ao longo de várias colunas - <code><a href="https://rdrr.io/r/base/colSums.html">rowSums()</a></code>.</p></li>
<li><p><strong>Operações cumulativas:</strong> somatório acumulado de uma coluna - <code><a href="https://rdrr.io/r/base/cumsum.html">cumsum()</a></code>; média acumulada de uma coluna - <code><a href="https://dplyr.tidyverse.org/reference/cumall.html">cummean()</a></code>; mínimo acumulado de uma coluna - <code><a href="https://rdrr.io/r/base/cumsum.html">cummin()</a></code>; máximo acumulado de uma coluna - <code><a href="https://rdrr.io/r/base/cumsum.html">cummax()</a></code>.</p></li>
<li><p><strong>Medidas de posição:</strong> média de uma coluna - <code><a href="https://rdrr.io/r/base/mean.html">mean()</a></code>; mediana de uma coluna - <code><a href="https://rdrr.io/r/stats/median.html">median()</a></code>; média por linha, ao longo de várias colunas - <code><a href="https://rdrr.io/r/base/colSums.html">rowMeans()</a></code>; média móvel - <code><a href="https://rdrr.io/pkg/RcppRoll/man/RcppRoll-exports.html">roll_mean()</a></code><a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;Essa função pertence ao pacote &lt;code&gt;RcppRoll&lt;/code&gt; e, portanto, para ter acesso à função você deve possuir esse pacote instalado em sua máquina, e chamar por ele em sua sessão.&lt;/p&gt;"><sup>35</sup></a>.</p></li>
<li><p><strong>Medidas de dispersão:</strong> desvio padrão de uma coluna - <code><a href="https://rdrr.io/r/stats/sd.html">sd()</a></code>; variância de uma coluna - <code><a href="https://rdrr.io/r/stats/cor.html">var()</a></code>; intervalo interquartil - <code><a href="https://rdrr.io/r/stats/IQR.html">IQR()</a></code>; desvio absoluto da mediana - <code><a href="https://rdrr.io/r/stats/mad.html">mad()</a></code>.</p></li>
<li><p><strong>Operadores aritméticos:</strong> soma (<code>+</code>); subtração (<code>-</code>); divisão (<code>/</code>); multiplicação (<code>*</code>); potência, ou elevar um número a <code>x</code> (<code>^</code>); restante da divisão (<code>%%</code>); apenas o número inteiro resultante da divisão (<code>%/%</code>); logaritmo - <code><a href="https://rdrr.io/r/base/Log.html">log()</a></code>.</p></li>
<li><p><strong>Operadores lógicos:</strong> aplique um teste lógico em cada linha, e preencha essa linha com <code>x</code> caso o teste resulte em <code>TRUE</code>, ou preencha com <code>y</code> caso o teste resulte em <code>FALSE</code> - <code><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else()</a></code>; quando você quer aplicar uma operação parecida com <code><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else()</a></code>, mas que há vários casos possíveis, um exemplo típico seria criar uma coluna de faixas etárias - <code><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when()</a></code>; você também pode utilizar normalmente todos os operadores que vimos na seção de <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code>, para criar um teste lógico sobre cada linha - <code>&lt;, &lt;=, &gt;, &gt;=, ==, !=, !, &amp;, |</code>.</p></li>
<li><p><strong>Funções para discretizar variáveis contínuas:</strong> calcula intervalos de forma a encaixar o mesmo número de observações em cada intervalo (comumente chamados de quantis) - <code><a href="https://ggplot2.tidyverse.org/reference/cut_interval.html">cut_number()</a></code>; calcula intervalos com o mesmo alcance - <code><a href="https://ggplot2.tidyverse.org/reference/cut_interval.html">cut_interval()</a></code>; calcula intervalos de largura definida no argumento <code>width</code> - <code><a href="https://ggplot2.tidyverse.org/reference/cut_interval.html">cut_width()</a></code>.</p></li>
<li><p><strong>Funções de defasagem e liderança:</strong> quando você precisa em algum cálculo naquela linha, utilizar o valor da linha anterior - <code><a href="https://dplyr.tidyverse.org/reference/lead-lag.html">lag()</a></code>; ou ao invés do valor da linha anterior, você precisa do valor da linha posterior - <code><a href="https://dplyr.tidyverse.org/reference/lead-lag.html">lead()</a></code>.</p></li>
</ol>
<p>Porém, é necessário ter cautela. Como a função <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> busca trabalhar com <code>data.frame</code>’s, é de suma importância, que você esteja sempre consciente das propriedades que essa estrutura carrega. Em especial, a propriedade de que as suas colunas devem possuir o mesmo número de elementos. Portanto, se o seu <code>data.frame</code> possui exatamente 10 mil linhas, você precisa se certificar de que cada expressão utilizada na função <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code>, vai gerar 10 mil elementos como resultado.</p>
<p>Na hipótese de que alguma dessas expressões produzam, por exemplo, 9.999 elementos, um erro será acionado, pois esses 9,999 mil elementos não podem ser guardados em um <code>data.frame</code> que possui 10 mil linhas. Logo, a função <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> lhe provê flexibilidade e eficiência, mas ela não é capaz de quebrar regras fundamentais da linguagem R.</p>
<p>Um exemplo prático disso é encontrado quando tentamos calcular uma média móvel de alguma série temporal, ou de algum valor diário utilizando a função <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code>, como no exemplo abaixo. O erro ocorre devido a própria natureza do cálculo de uma média móvel, que gera uma “perda” de observações, e como consequência, um número menor de observações é gerado dentro do resultado. Perceba abaixo, que ao aplicarmos uma janela de cálculo de 5 observações, a função <code><a href="https://rdrr.io/pkg/RcppRoll/man/RcppRoll-exports.html">roll_mean()</a></code> foi capaz de produzir 996 valores, consequentemente, perdemos 4 observações no processo.</p>
<p></p>
<div class="sourceCode" id="cb596"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>
<span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>
  dia <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">1000</span>,
  valor <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">1000</span><span class="op">)</span>
<span class="op">)</span>

<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">RcppRoll</span><span class="op">)</span>

<span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>
    media_movel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/RcppRoll/man/RcppRoll-exports.html">roll_mean</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">valor</span>, n <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>
  <span class="op">)</span></code></pre></div>
<p></p>
<pre><code>Erro: Problem with `mutate()` input `media_movel`.
x Input `media_movel` can't be recycled to size 1000.
i Input `media_movel` is `roll_mean(df$valor, n = 5)`.
i Input `media_movel` must be size 1000 or 1, not 996.
Run `rlang::last_error()` to see where the error occurred.</code></pre>
<p>Compreendendo os potenciais problemas fabricados por essa característica do cálculo de uma média móvel, a função <code><a href="https://rdrr.io/pkg/RcppRoll/man/RcppRoll-exports.html">roll_mean()</a></code> oferece o argumento <code>fill</code>, no qual podemos pedir à função que complete as observações restantes com zeros, como no exemplo abaixo. Dessa forma, a função volta a produzir 1000 observações em seu resultado e, consequentemente, nenhum erro é acionado.</p>
<p></p>
<div class="sourceCode" id="cb598"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>
    media_movel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/RcppRoll/man/RcppRoll-exports.html">roll_mean</a></span><span class="op">(</span><span class="va">valor</span>, n <span class="op">=</span> <span class="fl">5</span>, fill <span class="op">=</span> <span class="fl">0</span>, align <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span>
  <span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 1,000 × 3
##      dia  valor media_movel
##    &lt;int&gt;  &lt;dbl&gt;       &lt;dbl&gt;
##  1     1 -0.626      0     
##  2     2  0.184      0     
##  3     3 -0.836      0     
##  4     4  1.60       0     
##  5     5  0.330      0.129 
##  6     6 -0.820      0.0905
##  7     7  0.487      0.151 
##  8     8  0.738      0.466 
##  9     9  0.576      0.262 
## 10    10 -0.305      0.135 
## # … with 990 more rows</code></pre>
<p></p>
<p>Desse modo, estamos discutindo as possibilidades existentes de sua expressão fornecida à <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code>, produzir múltiplos valores. Todavia, diversas funções extremamente úteis, e que utilizamos com bastante frequência nessas expressões, resultam apenas em um único valor. Grandes exemplos são as funções <code><a href="https://rdrr.io/r/base/mean.html">mean()</a></code> e <code><a href="https://rdrr.io/r/base/sum.html">sum()</a></code>, que calculam a média e a soma de uma coluna, respectivamente.</p>
<p>Em todas as ocasiões em que a sua expressão na função <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> gerar um único valor, qualquer que ele seja, a função <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> irá automaticamente replicar esse mesmo valor ao longo de toda a coluna que você acaba de criar. Vemos uma demonstração disso, ao criarmos abaixo, as colunas <code>soma</code>, <code>prop</code> e <code>um_numero</code>. Com essa ideia em mente, se temos diversos valores numéricos em uma dada coluna, nós podemos eficientemente calcular uma proporção desses valores em relação ao total de sua coluna, com o uso da função <code><a href="https://rdrr.io/r/base/sum.html">sum()</a></code>, como no exemplo abaixo. Da mesma forma, nós podemos rapidamente normalizar uma coluna numérica segundo a fórmula de uma estatística Z, por meio das funções <code><a href="https://rdrr.io/r/stats/sd.html">sd()</a></code> e <code><a href="https://rdrr.io/r/base/mean.html">mean()</a></code>.</p>
<p></p>
<div class="sourceCode" id="cb600"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>
  id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,
  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2.5</span>, <span class="fl">1.5</span>, <span class="fl">3.2</span>, <span class="fl">5.1</span>, <span class="fl">2.2</span><span class="op">)</span>,
  y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">5</span><span class="op">)</span>
<span class="op">)</span>

<span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>
    soma <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,
    prop <span class="op">=</span> <span class="va">y</span> <span class="op">*</span> <span class="fl">100</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span>,
    um_numero <span class="op">=</span> <span class="fl">25</span>,
    norm <span class="op">=</span> <span class="op">(</span><span class="va">x</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
  <span class="op">)</span>

<span class="va">df</span></code></pre></div>
<pre><code>## # A tibble: 5 × 7
##      id     x     y  soma  prop um_numero   norm
##   &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;  &lt;dbl&gt;
## 1     1   2.5     1  14.5  6.67        25 -0.291
## 2     2   1.5     2  14.5 13.3         25 -1.02 
## 3     3   3.2     3  14.5 20           25  0.219
## 4     4   5.1     4  14.5 26.7         25  1.60 
## 5     5   2.2     5  14.5 33.3         25 -0.510</code></pre>
<p></p>
</div>
<div id="sec:group_by_summarise" class="section level2" number="5.9">
<h2>
<span class="header-section-number">5.9</span> Agrupando dados com <code>group_by()</code> e gerando estatísticas sumárias com <code>summarise()</code><a class="anchor" aria-label="anchor" href="#sec:group_by_summarise"><i class="fas fa-link"></i></a>
</h2>
<p>Em diversas áreas, é muito comum que contenhamos variáveis qualitativas em nossa base de dados. Variáveis desse tipo, usualmente definem grupos ou estratos de uma amostra, população ou medida, como faixas etárias ou faixas de valor salarial. Se você está analisando, por exemplo, dados epidemiológicos, você em geral deseja examinar se uma dada doença está ocorrendo com maior ou menor intensidade em um determinado grupo de sua população.</p>
<p>Ou seja, será que fatores como a raça, a idade, o gênero, a orientação sexual ou a localidade de um indivíduo são capazes de afetar as suas chances de ser infectado por essa doença? De outra maneira, será que essas variáveis qualitativas são capazes de gerar, por exemplo, diferenças no salário deste indivíduo? Da mesma forma, quando analisamos a performance de determinadas firmas, desejamos saber se a localidade, o setor, o tamanho, o investimento e a receita total, além do número de funcionários dessa firma são capazes de prover alguma vantagem em relação aos seus concorrentes.</p>
<p>Para esse tipo de estudo, o pacote <code>dplyr</code> nos oferece a função <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> que fundamentalmente altera o comportamento de funções como <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> e <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code>, e nos permite calcular estatísticas e aplicarmos operações dentro de cada grupo presente em nossos dados. Como um exemplo inicial, vamos utilizar a tabela <code>minas_pop</code>, que contém dados de população e PIB (Produto Interno Bruto) dos 853 municípios do estado de Minas Gerais.</p>
<p></p>
<div class="sourceCode" id="cb602"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">github</span> <span class="op">&lt;-</span> <span class="st">"https://raw.githubusercontent.com/pedropark99/"</span>
<span class="va">pasta</span> <span class="op">&lt;-</span> <span class="st">"Curso-R/master/Dados/"</span>
<span class="va">arquivo</span> <span class="op">&lt;-</span> <span class="st">"populacao.csv"</span>

<span class="va">minas_pop</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv2</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">github</span>, <span class="va">pasta</span>, <span class="va">arquivo</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p></p>
<p></p>
<pre><code>## # A tibble: 853 × 7
##    IBGE2   IBGE Munic               Populacao   Ano      PIB Intermediaria
##    &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;                   &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;        
##  1    10 310010 Abadia dos Dourados      6972  2017 33389769 Uberlândia   
##  2    20 310020 Abaeté                  23223  2017 96201158 Divinópolis  
##  3    30 310030 Abre Campo              13465  2017 29149429 Juíz de Fora 
##  4    40 310040 Acaiaca                  3994  2017  2521892 Juíz de Fora 
##  5    50 310050 Açucena                  9575  2017 15250077 Ipatinga     
##  6    60 310060 Água Boa                13600  2017 29988906 Teófilo Otoni
##  7    70 310070 Água Comprida            2005  2017 74771408 Uberaba      
##  8    80 310080 Aguanil                  4448  2017 15444038 Varginha     
##  9    90 310090 Águas Formosas          19166  2017 11236696 Teófilo Otoni
## 10   100 310100 Águas Vermelhas         13477  2017 48088397 Teófilo Otoni
## # … with 843 more rows</code></pre>
<p></p>
<p>Como demonstramos na seção anterior, a função <code><a href="https://rdrr.io/r/base/sum.html">sum()</a></code> serve para calcularmos o total de uma coluna inteira. Logo, se aplicássemos a função <code><a href="https://rdrr.io/r/base/sum.html">sum()</a></code> sobre a coluna <code>Populacao</code>, teríamos a população total do estado de Minas Gerais. Porém, e se desejássemos calcular a população total de cada uma das regiões intermediárias (presentes na coluna <code>Intermediaria</code>) que compõe o estado de Minas Gerais?</p>
<p>Para isso, nós podemos utilizar a função <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> para determinar onde em nossa tabela se encontram os grupos de nossos dados. No nosso caso, esses grupos estão na coluna <code>Intermediaria</code>. Dessa forma, após utilizarmos o <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code>, perceba abaixo que os totais calculados pela função <code><a href="https://rdrr.io/r/base/sum.html">sum()</a></code>, e que estão apresentados na coluna <code>Pop_total</code>, variam ao longo da tabela de acordo com o valor presente na coluna <code>Intermediaria</code>. Logo, temos agora a população total de cada região intermediária na coluna <code>Pop_total</code>. Da mesma maneira, ao invés de possuírmos uma proporção baseada na população do estado, as proporções de cada município expostas na coluna <code>Prop_pop_mun</code> possuem como denominador, a população total da região intermediária a qual o município pertence.</p>
<p></p>
<div class="sourceCode" id="cb604"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">minas_pop</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">Ano</span>, <span class="op">-</span><span class="va">PIB</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">Intermediaria</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>
    Pop_total <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">Populacao</span><span class="op">)</span>,
    Prop_pop_mun <span class="op">=</span> <span class="va">Populacao</span> <span class="op">*</span> <span class="fl">100</span> <span class="op">/</span> <span class="va">Pop_total</span>
  <span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 853 × 7
## # Groups:   Intermediaria [13]
##    IBGE2   IBGE Munic               Populacao Intermediaria Pop_t…¹ Prop_…²
##    &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;                   &lt;dbl&gt; &lt;chr&gt;           &lt;dbl&gt;   &lt;dbl&gt;
##  1    10 310010 Abadia dos Dourados      6972 Uberlândia    1161513   0.600
##  2    20 310020 Abaeté                  23223 Divinópolis   1300658   1.79 
##  3    30 310030 Abre Campo              13465 Juíz de Fora  2334530   0.577
##  4    40 310040 Acaiaca                  3994 Juíz de Fora  2334530   0.171
##  5    50 310050 Açucena                  9575 Ipatinga      1022384   0.937
##  6    60 310060 Água Boa                13600 Teófilo Otoni 1222050   1.11 
##  7    70 310070 Água Comprida            2005 Uberaba        800412   0.250
##  8    80 310080 Aguanil                  4448 Varginha      1634643   0.272
##  9    90 310090 Águas Formosas          19166 Teófilo Otoni 1222050   1.57 
## 10   100 310100 Águas Vermelhas         13477 Teófilo Otoni 1222050   1.10 
## # … with 843 more rows, and abbreviated variable names ¹​Pop_total,
## #   ²​Prop_pop_mun</code></pre>
<p></p>
<p>Para verificarmos se os grupos em uma dada tabela estão definidos, podemos observar se a descrição <code>Groups</code> se encontra logo abaixo às dimensões da tabela (<code>tibble: 853 x 7</code>). Essa descrição <code>Groups</code>, acaba nos informando a coluna (ou o conjunto de colunas) envolvidas nessa definição, além do número de grupos que estão contidos em nossa tabela. Logo, pelo resultado do exemplo acima, temos 13 grupos, ou 13 regiões intermediárias diferentes presentes na coluna <code>Intermediaria</code>.</p>
<p>Como um outro exemplo, dessa vez, em um contexto mais atual, podemos utilizar os dados de COVID-19 presentes na tabela abaixo, denominada <code>covid</code>. Nessa tabela, temos o acumulado do número de casos confirmados do vírus em cada estado brasileiro, durante o período de 25 de Fevereiro a 27 de Julho de 2020.</p>
<p></p>
<div class="sourceCode" id="cb606"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">github</span> <span class="op">&lt;-</span> <span class="st">"https://raw.githubusercontent.com/pedropark99/"</span>
<span class="va">pasta</span> <span class="op">&lt;-</span> <span class="st">"Curso-R/master/Dados/"</span>
<span class="va">arquivo</span> <span class="op">&lt;-</span> <span class="st">"covid.csv"</span>

<span class="va">covid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv2</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">github</span>, <span class="va">pasta</span>, <span class="va">arquivo</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p></p>
<p></p>
<pre><code>## # A tibble: 3,625 × 4
##    data       estado casos mortes
##    &lt;date&gt;     &lt;chr&gt;  &lt;dbl&gt;  &lt;dbl&gt;
##  1 2020-03-17 AC         3      0
##  2 2020-03-18 AC         3      0
##  3 2020-03-19 AC         4      0
##  4 2020-03-20 AC         7      0
##  5 2020-03-21 AC        11      0
##  6 2020-03-22 AC        11      0
##  7 2020-03-23 AC        17      0
##  8 2020-03-24 AC        21      0
##  9 2020-03-25 AC        23      0
## 10 2020-03-26 AC        23      0
## # … with 3,615 more rows</code></pre>
<p></p>
<p>Durante o ano de 2020, a Fundação João Pinheiro (FJP) tem oferecido parte de seu corpo técnico para a Secretaria Estadual de Saúde, com o objetivo de dar suporte técnico à instituição no monitoramento das estatísticas de contaminação e
impacto do vírus no estado de Minas Gerais.</p>
<p>Portanto, uma atividade muito comum com os dados da COVID-19, seria calcularmos a variação diária no número de casos acumulados. Tal cálculo pode ser atingido, através dos valores acumulados na coluna <code>casos</code>, ao subtrairmos do valor da linha corrente, o valor da linha anterior nessa mesma coluna. Para incluirmos o valor da linha anterior em nosso cálculo, podemos usar a função <code><a href="https://dplyr.tidyverse.org/reference/lead-lag.html">lag()</a></code>, como no código abaixo:</p>
<p></p>
<div class="sourceCode" id="cb608"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">covid</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>
    casos_var <span class="op">=</span> <span class="va">casos</span> <span class="op">-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html">lag</a></span><span class="op">(</span><span class="va">casos</span><span class="op">)</span>,
    mortes_var <span class="op">=</span> <span class="va">mortes</span> <span class="op">-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html">lag</a></span><span class="op">(</span><span class="va">mortes</span><span class="op">)</span>
  <span class="op">)</span></code></pre></div>
<p></p>
<p>Porém, temos um problema nessa operação, que emerge do fato de que não delimitamos os grupos da tabela. Por essa razão, a função <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> vai aplicar a expressão <code>casos - lag(casos)</code> sobre toda a tabela de uma vez só. O correto, seria que nós aplicássemos essa operação separadamente sobre os dados de cada estado.</p>
<p>Dito de outra forma, ao não dizermos que cada estado deveria ser tratado de forma separada dos demais, estamos invadindo os limites de cada estado com o cálculo pertencente a outros estados. Em outras palavras, o problema que emerge do código anterior, em que não definimos os grupos, se encontra nas linhas que definem os limites entre cada estado, ou as linhas que marcam a transição entre os dados do estado A para os dados do estado B. Logo, caso não definirmos esses grupos, estaremos utilizando no cálculo da variação presente na primeira linha referente ao estado de São Paulo, o número acumulado de casos localizado na última linha pertencente ao estado que vem antes de São Paulo na base (o estado de Sergipe).</p>
<p>Por isso, ao utilizarmos a função <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> sobre a tabela <code>covid</code>, faremos com que a função <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> esteja consciente dos limites entre os dados de cada estado, e que, portanto, respeite esses limites durante o cálculo dessa variação.</p>
<p></p>
<div class="sourceCode" id="cb609"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">covid_novo</span> <span class="op">&lt;-</span> <span class="va">covid</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">estado</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>
    casos_var <span class="op">=</span> <span class="va">casos</span> <span class="op">-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html">lag</a></span><span class="op">(</span><span class="va">casos</span><span class="op">)</span>,
    mortes_var <span class="op">=</span> <span class="va">mortes</span> <span class="op">-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html">lag</a></span><span class="op">(</span><span class="va">mortes</span><span class="op">)</span>
  <span class="op">)</span>

<span class="va">covid_novo</span> </code></pre></div>
<pre><code>## # A tibble: 3,625 × 6
## # Groups:   estado [27]
##    data       estado casos mortes casos_var mortes_var
##    &lt;date&gt;     &lt;chr&gt;  &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;
##  1 2020-03-17 AC         3      0        NA         NA
##  2 2020-03-18 AC         3      0         0          0
##  3 2020-03-19 AC         4      0         1          0
##  4 2020-03-20 AC         7      0         3          0
##  5 2020-03-21 AC        11      0         4          0
##  6 2020-03-22 AC        11      0         0          0
##  7 2020-03-23 AC        17      0         6          0
##  8 2020-03-24 AC        21      0         4          0
##  9 2020-03-25 AC        23      0         2          0
## 10 2020-03-26 AC        23      0         0          0
## # … with 3,615 more rows</code></pre>
<p></p>
<p>Agora que vimos a função <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code>, podemos prosseguir para a função <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code>, que busca sumarizar, sintetizar ou reduzir múltiplos valores de seu <code>data.frame</code> em poucas linhas. Logo, se eu aplicar a função <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code> sobre a tabela <code>minas_pop</code>, um novo <code>data.frame</code> será gerado, e ele irá conter provavelmente uma única linha. O seu trabalho é definir os valores que vão ocupar esse espaço.</p>
<p>Por isso, dentro da função <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code>, devemos fornecer expressões, exatamente da mesma forma que fornecemos em <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code>. Essas expressões vão ser responsáveis por calcular os valores que vão preencher as linhas presentes no novo <code>data.frame</code> criado. Se as expressões delineadas por você gerarem um único valor ou uma única estatística sumária, o novo <code>data.frame</code> resultante de <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code> vai possuir uma única linha, e uma coluna para cada expressão definida. Como exemplo, podemos calcular o somatório total e a média da coluna <code>Populacao</code> da seguinte forma:</p>
<p></p>
<div class="sourceCode" id="cb611"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">minas_pop</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>
    total_pop <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">Populacao</span><span class="op">)</span>,
    media_pop <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">Populacao</span><span class="op">)</span>
  <span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 2
##   total_pop media_pop
##       &lt;dbl&gt;     &lt;dbl&gt;
## 1  21040662    24667.</code></pre>
<p></p>
<p>Por outro lado, caso a sua expressão produza <span class="math inline">\(n\)</span> valores como resultado, o novo <code>data.frame</code> fabricado por <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code> vai possuir <span class="math inline">\(n\)</span> linhas para alocar esses valores. Em outras palavras, o número de linhas presente no <code>data.frame</code> resultante, nesse caso, depende diretamente da quantidade de valores produzidos por sua expressão. Como um exemplo disso, podemos utilizar a função <code><a href="https://rdrr.io/r/stats/quantile.html">quantile()</a></code> para extrairmos os limites do intervalo interquartil (percentis de número 25 e 75) da coluna <code>Populacao</code>.</p>
<p></p>
<div class="sourceCode" id="cb613"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">minas_pop</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>iqr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">Populacao</span>, probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.75</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 2 × 1
##     iqr
##   &lt;dbl&gt;
## 1  4844
## 2 17739</code></pre>
<p></p>
<p>Apesar dessas características, a função <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code> é normalmente utilizada em conjunto com a função <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code>. Pois ao definirmos os grupos de nossa tabela, a função <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code> passa a produzir uma linha para cada grupo presente em nossa tabela. Logo, o cálculo da população total e da população média anterior, que produzia uma única linha, passa a gerar 13 valores diferentes e, portanto, 13 linhas diferentes ao agruparmos os dados de acordo com a coluna <code>Intermediaria</code>. Podemos ainda aplicar a função <code><a href="https://dplyr.tidyverse.org/reference/context.html">n()</a></code>, com o objetivo de descobrirmos quantas linhas, ou quantos municípios representam cada região intermediária do estado.</p>
<p></p>
<div class="sourceCode" id="cb615"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">minas_pop</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">Intermediaria</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>
    total_pop <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">Populacao</span><span class="op">)</span>,
    media_pop <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">Populacao</span><span class="op">)</span>,
    numero_municipios <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>
  <span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 13 × 4
##    Intermediaria        total_pop media_pop numero_municipios
##    &lt;chr&gt;                    &lt;dbl&gt;     &lt;dbl&gt;             &lt;int&gt;
##  1 Barbacena               772694    15769.                49
##  2 Belo Horizonte         6237890    84296.                74
##  3 Divinópolis            1300658    21322.                61
##  4 Governador Valadares    771775    13306.                58
##  5 Ipatinga               1022384    23236                 44
##  6 Juíz de Fora           2334530    15990.               146
##  7 Montes Claros          1673263    19457.                86
##  8 Patos de Minas          819435    24101.                34
##  9 Pouso Alegre           1289415    16118.                80
## 10 Teófilo Otoni          1222050    14210.                86
## 11 Uberaba                 800412    27600.                29
## 12 Uberlândia             1161513    48396.                24
## 13 Varginha               1634643    19935.                82</code></pre>
<p></p>
<p>Neste momento, vale a pena comentar também, a função <code><a href="https://dplyr.tidyverse.org/reference/count.html">count()</a></code>, que se traduz como um atalho para a junção das funções <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code> e <code><a href="https://dplyr.tidyverse.org/reference/context.html">n()</a></code>. Logo, ao invés de construirmos toda a estrutura de <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> e <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code>, nós poderíamos rapidamente contabilizar o número de municípios em cada região intermediária, através da função <code><a href="https://dplyr.tidyverse.org/reference/count.html">count()</a></code>, como no exemplo abaixo. Lembrando que cada coluna fornecida à <code><a href="https://dplyr.tidyverse.org/reference/count.html">count()</a></code>, será repassada a <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> e, portanto, será responsável por definir os grupos nos quais a contagem será aplicada. Logo, se definíssemos a função como <code>count(minas_pop, Intermediaria, Ano)</code>, estaríamos calculando o número de municípios existentes em cada região intermediária, dentro de um dado ano descrito em nossa tabela.</p>
<p></p>
<div class="sourceCode" id="cb617"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">minas_pop</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">Intermediaria</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 13 × 2
##    Intermediaria            n
##    &lt;chr&gt;                &lt;int&gt;
##  1 Barbacena               49
##  2 Belo Horizonte          74
##  3 Divinópolis             61
##  4 Governador Valadares    58
##  5 Ipatinga                44
##  6 Juíz de Fora           146
##  7 Montes Claros           86
##  8 Patos de Minas          34
##  9 Pouso Alegre            80
## 10 Teófilo Otoni           86
## 11 Uberaba                 29
## 12 Uberlândia              24
## 13 Varginha                82</code></pre>
<p></p>
<p></p>
<div class="sourceCode" id="cb619"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## ----------------------------------------</span>
<span class="co">## Sem o uso de pipe ( %&gt;% ) teríamos:</span>
<span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">minas_pop</span>, <span class="va">Intermediaria</span><span class="op">)</span></code></pre></div>
<p></p>
<p>Para além desses pontos, vale destacar que certos momentos em que você necessita de várias colunas para identificar um único grupo de sua tabela, não são incomuns. Por isso, você pode incluir mais de uma coluna dentro da função <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code>. Por exemplo, suponha que você possua na tabela <code>covid</code>, uma coluna que apresenta o mês ao qual cada linha se encontra. Suponha ainda, que você deseja calcular a média mensal de novos casos diários em cada estado. Para realizar essa ação, você precisa aplicar o cálculo da média não apenas dentro de cada estado, mas também, dentro de cada mês disponível na base. Logo, precisamos fornecer tanto a coluna <code>estado</code> quanto a coluna <code>mes</code> à função <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code>, como no exemplo abaixo.</p>
<p></p>
<div class="sourceCode" id="cb620"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">covid_novo</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>mes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="va">data</span>, <span class="st">"%m"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">estado</span>, <span class="va">mes</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>
    media_novos_casos <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">casos_var</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>
  <span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 136 × 3
## # Groups:   estado [27]
##    estado   mes media_novos_casos
##    &lt;chr&gt;  &lt;int&gt;             &lt;dbl&gt;
##  1 AC         3              2.79
##  2 AC         4             12.1 
##  3 AC         5            188.  
##  4 AC         6            234.  
##  5 AC         7            205.  
##  6 AL         3              0.85
##  7 AL         4             34.2 
##  8 AL         5            298.  
##  9 AL         6            856.  
## 10 AL         7            750.  
## # … with 126 more rows</code></pre>
<p></p>
<p>Perceba também acima, que utilizamos a função <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup()</a></code> sobre a tabela <code>covid_novo</code>, antes de aplicarmos a função <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code>. O motivo para tal operação, está no fato de que a tabela <code>covid_novo</code> já se encontrava agrupada desde o momento em que ela foi criada. Por isso, ao aplicarmos novamente a função <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> com o uso das colunas <code>estado</code> e <code>mes</code>, para redefinirmos os grupos da tabela, precisamos remover a definição anterior desses grupos. Sendo esta a única ação executada pela função <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup()</a></code>.</p>
<p>Portanto, a partir do momento em que você “terminou” de utilizar as operações “por grupo” em sua tabela, e deseja ignorar novamente esses grupos em suas próximas etapas, você deve retirar a definição dos grupos de sua tabela, por meio da função <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup()</a></code>.</p>
</div>
<div id="a-função-across-como-a-grande-novidade" class="section level2" number="5.10">
<h2>
<span class="header-section-number">5.10</span> A função <code>across()</code> como a grande novidade<a class="anchor" aria-label="anchor" href="#a-fun%C3%A7%C3%A3o-across-como-a-grande-novidade"><i class="fas fa-link"></i></a>
</h2>
<p>A função <code><a href="https://dplyr.tidyverse.org/reference/across.html">across()</a></code> foi uma das grandes novidades introduzidas em uma versão recente do pacote <code>dplyr</code> <span class="citation">(<a href="refer%C3%AAncias.html#ref-wickham_tidyverse2020" role="doc-biblioref">Wickham 2020</a>)</span>. Essa função lhe permite aplicar os métodos de seleção que vimos em <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code>, dentro dos demais verbos expostos (funções <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code> e <code><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange()</a></code>). Para mais, o principal objetivo dessa função está em prover uma maneira muito mais prática de empregarmos uma mesma operação ao longo de várias colunas.</p>
<p>Por exemplo, suponha que você desejasse calcular o logaritmo de todas as colunas numéricas da tabela <code>mpg</code>. Temos então, que aplicar a mesma operação sobre 5 colunas diferentes, mais especificamente, as colunas <code>displ</code>, <code>year</code>, <code>cyl</code>, <code>cty</code> e <code>hwy</code>. Com o que vimos até o momento, você provavelmente faria tal ação da seguinte forma:</p>
<p></p>
<div class="sourceCode" id="cb622"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mpg</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>
    displ <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">displ</span><span class="op">)</span>,
    year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span>,
    cyl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">cyl</span><span class="op">)</span>,
    cty <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">cty</span><span class="op">)</span>,
    hwy <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">hwy</span><span class="op">)</span>
  <span class="op">)</span></code></pre></div>
<p></p>
<p>Porém, além de tedioso, a repetição envolvida nesse tipo de solução, incorre em uma grande chance de erro de nossa parte. Pois os nossos olhos tendem a prestar atenção no que é diferente dos demais, no que se destaca do ambiente, e não sobre blocos e blocos de comandos que são basicamente idênticos.</p>
<p>Com isso, a função <code><a href="https://dplyr.tidyverse.org/reference/across.html">across()</a></code> provê um excelente mecanismo para automatizarmos essa aplicação. Nessa função, temos dois argumentos principais a serem preenchidos: 1)<code>.cols</code>, que representa o conjunto de colunas onde a ação desejada será aplicada; 2) <code>.fns</code>, a função ou a expressão que será empregada em cada coluna (neste argumento, você pode fornecer apenas o nome da função). Com isso, poderíamos reescrever a operação anterior como:</p>
<p></p>
<div class="sourceCode" id="cb623"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Aplicar log() na terceira, quarta,</span>
<span class="co">## quinta, oitava e nona coluna da tabela mpg:</span>
<span class="va">mpg</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span>.cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">8</span><span class="op">:</span><span class="fl">9</span><span class="op">)</span>, .fns <span class="op">=</span> <span class="va">log</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 234 × 11
##    manufacturer model displ  year   cyl trans drv     cty   hwy fl    class
##    &lt;chr&gt;        &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;
##  1 audi         a4    0.588  7.60  1.39 auto… f      2.89  3.37 p     comp…
##  2 audi         a4    0.588  7.60  1.39 manu… f      3.04  3.37 p     comp…
##  3 audi         a4    0.693  7.60  1.39 manu… f      3.00  3.43 p     comp…
##  4 audi         a4    0.693  7.60  1.39 auto… f      3.04  3.40 p     comp…
##  5 audi         a4    1.03   7.60  1.79 auto… f      2.77  3.26 p     comp…
##  6 audi         a4    1.03   7.60  1.79 manu… f      2.89  3.26 p     comp…
##  7 audi         a4    1.13   7.60  1.79 auto… f      2.89  3.30 p     comp…
##  8 audi         a4 q… 0.588  7.60  1.39 manu… 4      2.89  3.26 p     comp…
##  9 audi         a4 q… 0.588  7.60  1.39 auto… 4      2.77  3.22 p     comp…
## 10 audi         a4 q… 0.693  7.60  1.39 manu… 4      3.00  3.33 p     comp…
## # … with 224 more rows</code></pre>
<p></p>
<p>Portanto, em <code><a href="https://dplyr.tidyverse.org/reference/across.html">across()</a></code> você é capaz de aplicar qualquer um dos 5 métodos que vimos em <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code>. Como um outro exemplo, podemos aplicar a função <code><a href="https://rdrr.io/r/base/Log.html">log()</a></code> sobre qualquer coluna que se inicie pela letra “h”, com o comando abaixo:</p>
<p></p>
<div class="sourceCode" id="cb625"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mpg</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span>.cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"h"</span><span class="op">)</span>, .fns <span class="op">=</span> <span class="va">log</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 234 × 11
##    manufacturer model displ  year   cyl trans drv     cty   hwy fl    class
##    &lt;chr&gt;        &lt;chr&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;
##  1 audi         a4      1.8  1999     4 auto… f        18  3.37 p     comp…
##  2 audi         a4      1.8  1999     4 manu… f        21  3.37 p     comp…
##  3 audi         a4      2    2008     4 manu… f        20  3.43 p     comp…
##  4 audi         a4      2    2008     4 auto… f        21  3.40 p     comp…
##  5 audi         a4      2.8  1999     6 auto… f        16  3.26 p     comp…
##  6 audi         a4      2.8  1999     6 manu… f        18  3.26 p     comp…
##  7 audi         a4      3.1  2008     6 auto… f        18  3.30 p     comp…
##  8 audi         a4 q…   1.8  1999     4 manu… 4        18  3.26 p     comp…
##  9 audi         a4 q…   1.8  1999     4 auto… 4        16  3.22 p     comp…
## 10 audi         a4 q…   2    2008     4 manu… 4        20  3.33 p     comp…
## # … with 224 more rows</code></pre>
<p></p>
<p>Por outro lado, caso você necessite aplicar várias funções em cada coluna, é melhor que você crie uma nova função (a partir da palavra-chave <code>function</code>) dentro de <code><a href="https://dplyr.tidyverse.org/reference/across.html">across()</a></code>, contendo as operações que você deseja aplicar. Pois dessa maneira, você possui um melhor controle sobre em que partes do cálculo, os valores de cada coluna serão posicionados.</p>
<p>Por exemplo, podemos normalizar todas as colunas numéricas da tabela <code>mpg</code>, por uma estatística Z. Perceba abaixo, que nesse caso, precisamos utilizar o valor da coluna em 3 ocasiões: duas vezes no numerador, para calcularmos o desvio de cada valor da coluna em relação a sua média; e uma vez no denominador, para calcularmos o desvio padrão. Repare também, que ao menos quatro funções são utilizadas dentro desse cálculo: as funções <code><a href="https://rdrr.io/r/base/mean.html">mean()</a></code> e <code><a href="https://rdrr.io/r/stats/sd.html">sd()</a></code>, além dos operadores de subtração (<code>-</code>) e de divisão (<code>/</code>).</p>
<p></p>
<div class="sourceCode" id="cb627"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mpg</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span>
    .cols <span class="op">=</span> <span class="fu">where</span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span>,
    .fns <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
  <span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 234 × 11
##    manufactu…¹ model  displ  year   cyl trans drv     cty   hwy fl    class
##    &lt;chr&gt;       &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;
##  1 audi        a4    -0.887 1555. 0.346 auto… f      14.0  25.1 p     comp…
##  2 audi        a4    -0.887 1555. 0.346 manu… f      17.0  25.1 p     comp…
##  3 audi        a4    -0.687 1564. 0.346 manu… f      16.0  27.1 p     comp…
##  4 audi        a4    -0.687 1564. 0.346 auto… f      17.0  26.1 p     comp…
##  5 audi        a4     0.113 1555. 2.35  auto… f      12.0  22.1 p     comp…
##  6 audi        a4     0.113 1555. 2.35  manu… f      14.0  22.1 p     comp…
##  7 audi        a4     0.413 1564. 2.35  auto… f      14.0  23.1 p     comp…
##  8 audi        a4 q… -0.887 1555. 0.346 manu… 4      14.0  22.1 p     comp…
##  9 audi        a4 q… -0.887 1555. 0.346 auto… 4      12.0  21.1 p     comp…
## 10 audi        a4 q… -0.687 1564. 0.346 manu… 4      16.0  24.1 p     comp…
## # … with 224 more rows, and abbreviated variable name ¹​manufacturer</code></pre>
<p></p>
<p>Com isso, a função <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code> também se torna um local extremamente útil para o emprego da função <code><a href="https://dplyr.tidyverse.org/reference/across.html">across()</a></code>. Pois através de <code><a href="https://dplyr.tidyverse.org/reference/across.html">across()</a></code>, nós podemos rapidamente aplicar uma função sobre cada coluna que desejamos sintetizar com <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code>. Por exemplo, somos capazes de extrair o valor total de todas as colunas numéricas da tabela <code>mpg</code>, por meio dos seguintes comandos:</p>
<p></p>
<div class="sourceCode" id="cb629"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mpg</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">cyl</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span>
    .cols <span class="op">=</span> <span class="fu">where</span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span>,
    .fns <span class="op">=</span> <span class="va">sum</span>
  <span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 4 × 5
##     cyl displ   year   cty   hwy
##   &lt;int&gt; &lt;dbl&gt;  &lt;int&gt; &lt;int&gt; &lt;int&gt;
## 1     4  174. 162243  1702  2333
## 2     5   10    8032    82   115
## 3     6  269. 158227  1281  1803
## 4     8  359. 140317   880  1234</code></pre>
<p></p>
</div>
<div id="removendo-duplicatas-com-distinct" class="section level2" number="5.11">
<h2>
<span class="header-section-number">5.11</span> Removendo duplicatas com <code>distinct()</code><a class="anchor" aria-label="anchor" href="#removendo-duplicatas-com-distinct"><i class="fas fa-link"></i></a>
</h2>
<p>Às vezes, os nossos dados chegam com algum erro de registro, e usualmente, esse erro se manifesta na forma de registros duplicados. Nessa seção, veremos o uso da função <code><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct()</a></code> como um mecanismo útil para eliminarmos observações duplicadas em sua tabela. Como um exemplo inicial, podemos utilizar a tabela <code>ponto</code>, criada pelos comandos abaixo:</p>
<p></p>
<div class="sourceCode" id="cb631"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ponto</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>
  usuario <span class="op">=</span> <span class="st">"Ana"</span>,
  dia <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span>,
  hora <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">14</span>, <span class="fl">14</span>, <span class="fl">18</span>, <span class="fl">8</span>, <span class="fl">13</span><span class="op">)</span>,
  minuto <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">30</span>, <span class="fl">30</span>, <span class="fl">50</span>, <span class="fl">0</span>, <span class="fl">30</span><span class="op">)</span>,
  tipo <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"E"</span>, <span class="st">"E"</span>, <span class="st">"S"</span>, <span class="st">"E"</span>, <span class="st">"E"</span><span class="op">)</span>,
  mes <span class="op">=</span> <span class="fl">3</span>,
  ano <span class="op">=</span> <span class="fl">2020</span>
<span class="op">)</span>

<span class="va">ponto</span></code></pre></div>
<pre><code>## # A tibble: 5 × 7
##   usuario   dia  hora minuto tipo    mes   ano
##   &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 Ana         1    14     30 E         3  2020
## 2 Ana         1    14     30 E         3  2020
## 3 Ana         1    18     50 S         3  2020
## 4 Ana         2     8      0 E         3  2020
## 5 Ana         2    13     30 E         3  2020</code></pre>
<p></p>
<p>Inicialmente, a função <code><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct()</a></code> funciona da mesma maneira que a função <code><a href="https://rdrr.io/r/base/unique.html">unique()</a></code>. Porém, a função <code><a href="https://rdrr.io/r/base/unique.html">unique()</a></code> pode ser aplicada em praticamente qualquer tipo de estrutura, além do tipo de estrutura adotado em seu resultado, variar em diversas aplicações. Enquanto isso, a função <code><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct()</a></code> (assim como as demais funções do pacote <code>dplyr</code>) irá sempre aceitar um <code>data.frame</code> como <em>input</em> e gerar um novo <code>data.frame</code> como <em>output</em>. Logo, se aplicarmos <code><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct()</a></code> sobre a tabela <code>ponto</code>, temos o seguinte resultado:</p>
<p></p>
<div class="sourceCode" id="cb633"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ponto_dis</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op">(</span><span class="va">ponto</span><span class="op">)</span>

<span class="va">ponto_dis</span></code></pre></div>
<pre><code>## # A tibble: 4 × 7
##   usuario   dia  hora minuto tipo    mes   ano
##   &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 Ana         1    14     30 E         3  2020
## 2 Ana         1    18     50 S         3  2020
## 3 Ana         2     8      0 E         3  2020
## 4 Ana         2    13     30 E         3  2020</code></pre>
<p></p>
<p>Repare pelo produto acima, que a função <code><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct()</a></code> eliminou a segunda linha da tabela <code>ponto</code>, pois essa era uma duplicata da primeira linha. Para mais, a função <code><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct()</a></code> nos permite aplicar a função sobre colunas específicas do <code>data.frame</code> em questão. No exemplo acima, nós omitimos essa funcionalidade, e pedimos para que a função <code><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct()</a></code> fosse aplicada sobre a toda a tabela. Isso significa, que ao não definirmos uma coluna ou um conjunto de colunas em particular, <code><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct()</a></code> vai utilizar a combinação dos valores de todas as colunas para determinar os valores únicos presentes em sua tabela e, portanto, eliminar os valores duplicados segundo essa abordagem.</p>
<p>Como exemplo, podemos aplicar a função sobre as colunas <code>usuario</code> e <code>tipo</code>. Dessa forma, <code><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct()</a></code> nos retorna um novo <code>data.frame</code> contendo os valores únicos presentes nessas colunas. No entanto, perceba que um efeito colateral foi gerado, pois nós perdemos todas as demais colunas da tabela <code>ponto</code> durante o processo. Isso ocorre em todas as ocasiões em que listamos uma combinação de colunas em <code><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct()</a></code>. Para evitar esse comportamento, você pode definir o argumento <code>.keep_all</code> para <code>TRUE</code>, como no exemplo abaixo.</p>
<p></p>
<div class="sourceCode" id="cb635"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ponto_dis</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op">(</span><span class="va">ponto</span>, <span class="va">usuario</span>, <span class="va">tipo</span><span class="op">)</span>

<span class="va">ponto_dis</span></code></pre></div>
<pre><code>## # A tibble: 2 × 2
##   usuario tipo 
##   &lt;chr&gt;   &lt;chr&gt;
## 1 Ana     E    
## 2 Ana     S</code></pre>
<div class="sourceCode" id="cb637"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ponto_dis</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op">(</span><span class="va">ponto</span>, <span class="va">usuario</span>, <span class="va">tipo</span>, .keep_all <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="va">ponto_dis</span></code></pre></div>
<pre><code>## # A tibble: 2 × 7
##   usuario   dia  hora minuto tipo    mes   ano
##   &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 Ana         1    14     30 E         3  2020
## 2 Ana         1    18     50 S         3  2020</code></pre>
<p></p>
<p>Com isso, se desejamos eliminar os valores duplicados em nossas tabelas, podemos rapidamente aplicar a função <code><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct()</a></code> sobre toda a tabela. Contudo, haverá momentos em que combinações específicas de colunas devem ser utilizadas para determinarmos as observações únicas da tabela, ao invés de todas as colunas disponíveis. Para isso, você deve listar os nomes das colunas a serem utilizadas pela função <code><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct()</a></code> neste processo. Além disso, você geralmente vai desejar utilizar a configuração <code>.keep_all = TRUE</code> durante essa situação, com o objetivo de conservar as demais colunas da tabela no resultado de <code><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct()</a></code>.</p>
<p>Ademais, lembre-se que você pode utilizar a função <code><a href="https://dplyr.tidyverse.org/reference/across.html">across()</a></code> para ter acesso aos mecanismos de seleção de <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code>, para definir o conjunto de colunas a ser empregado por <code><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct()</a></code>. Por exemplo, eu posso encontrar todos os valores únicos criados pela combinação entre as colunas <code>dia</code> e <code>tipo</code>, por meio do seguinte comando:</p>
<p></p>
<div class="sourceCode" id="cb639"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op">(</span><span class="va">ponto</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span>, .keep_all <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 3 × 7
##   usuario   dia  hora minuto tipo    mes   ano
##   &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 Ana         1    14     30 E         3  2020
## 2 Ana         1    18     50 S         3  2020
## 3 Ana         2     8      0 E         3  2020</code></pre>
<p></p>
</div>
<div id="combinando-tabelas-com-bind_cols-e-bind_rows" class="section level2" number="5.12">
<h2>
<span class="header-section-number">5.12</span> Combinando tabelas com <code>bind_cols()</code> e <code>bind_rows()</code><a class="anchor" aria-label="anchor" href="#combinando-tabelas-com-bind_cols-e-bind_rows"><i class="fas fa-link"></i></a>
</h2>
<p>Os pacotes básicos do R oferecem as funções <code><a href="https://rdrr.io/r/base/cbind.html">rbind()</a></code> e <code><a href="https://rdrr.io/r/base/cbind.html">cbind()</a></code>, que lhe permite combinar objetos. Porém, o pacote <code>dplyr</code> oferece implementações mais rápidas e completas desse mecanismo, através das funções <code><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_cols()</a></code> e <code><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows()</a></code>. Do mesmo modo que as demais funções do pacote, <code><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_cols()</a></code> e <code><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows()</a></code> aceitam um conjunto de <code>data.frame</code>’s como <em>input</em>, e lhe retornam um novo <code>data.frame</code> como <em>output</em>.</p>
<p>Como exemplo inicial, suponha que você possua o conjunto de tabelas abaixo. Essas tabelas contêm dados das vendas de três lojas diferentes.</p>
<p></p>
<div class="sourceCode" id="cb641"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">savassi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>
  dia <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"2020-03-01"</span>, <span class="st">"2020-03-02"</span>, <span class="st">"2020-03-03"</span>,
                  <span class="st">"2020-03-04"</span><span class="op">)</span><span class="op">)</span>,
  produtoid <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"10241"</span>, <span class="st">"10241"</span>, <span class="st">"10032"</span>, <span class="st">"15280"</span><span class="op">)</span>,
  loja <span class="op">=</span> <span class="st">"Savassi"</span>,
  unidades <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>,
  valor <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">15.5</span>, <span class="fl">31</span>, <span class="fl">12.4</span>, <span class="fl">16.7</span><span class="op">)</span>
<span class="op">)</span>

<span class="va">prado</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>
  dia <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"2020-03-10"</span>, <span class="st">"2020-03-11"</span>, <span class="st">"2020-03-12"</span><span class="op">)</span><span class="op">)</span>,
  produtoid <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"15280"</span>, <span class="st">"10032"</span>, <span class="st">"10032"</span><span class="op">)</span>,
  loja <span class="op">=</span> <span class="st">"Prado"</span>,
  unidades <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">2</span><span class="op">)</span>,
  valor <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">50.1</span>, <span class="fl">49.6</span>, <span class="fl">24.8</span><span class="op">)</span>
<span class="op">)</span>

<span class="va">centro</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>
  dia <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"2020-03-07"</span>, <span class="st">"2020-03-10"</span>, <span class="st">"2020-03-12"</span><span class="op">)</span><span class="op">)</span>,
  produtoid <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"15280"</span>, <span class="st">"15280"</span>, <span class="st">"15280"</span><span class="op">)</span>,
  loja <span class="op">=</span> <span class="st">"Centro"</span>,
  unidades <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>,
  valor <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">83.5</span>, <span class="fl">16.7</span>, <span class="fl">16.7</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<p></p>
<p>Supondo que você seja um analista da empresa dona dessas lojas, e que foi delegado a você, a tarefa de analisar os dados dessas tabelas, você terá no mínimo o triplo de trabalho, caso mantenha essas tabelas separadas. Pois cada etapa de sua análise teria de ser replicar em três lugares diferentes. Por isso, a melhor opção é reunir essas tabelas em um lugar só. Pois dessa maneira, você precisa aplicar as suas operações em um único lugar.</p>
<p>Ou seja, a motivação para o uso das funções <code><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows()</a></code> e <code><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_cols()</a></code>, surge em geral, a partir da dificuldade que temos em aplicar a mesma função em diversos pontos de nosso trabalho, além da manutenção e monitoramento dos resultados gerados em cada um desses pontos envolvidos nesse serviço. Portanto, se você possui um grande conjunto de tabelas, que são semelhantes entre si, e você precisa aplicar os mesmos passos sobre cada uma delas, é interessante que você tente juntar essas tabelas em uma só. Dessa maneira, você pode direcionar o seu foco e as suas energias para um só local.</p>
<p>Como as tabelas <code>savassi</code>, <code>prado</code> e <code>centro</code> possuem as mesmas colunas, faz mais sentido unirmos as linhas de cada tabela para formarmos a nossa tabela única. Para isso, basta listarmos essas tabelas dentro da função <code><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows()</a></code>, como demonstrado abaixo. Uma outra opção, seria provermos uma lista de <code>data.frame</code>’s à função, o que também está demonstrado abaixo:</p>
<p></p>
<div class="sourceCode" id="cb642"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span><span class="op">(</span><span class="va">savassi</span>, <span class="va">prado</span>, <span class="va">centro</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 10 × 5
##    dia        produtoid loja    unidades valor
##    &lt;date&gt;     &lt;chr&gt;     &lt;chr&gt;      &lt;dbl&gt; &lt;dbl&gt;
##  1 2020-03-01 10241     Savassi        1  15.5
##  2 2020-03-02 10241     Savassi        2  31  
##  3 2020-03-03 10032     Savassi        1  12.4
##  4 2020-03-04 15280     Savassi        1  16.7
##  5 2020-03-10 15280     Prado          3  50.1
##  6 2020-03-11 10032     Prado          4  49.6
##  7 2020-03-12 10032     Prado          2  24.8
##  8 2020-03-07 15280     Centro         5  83.5
##  9 2020-03-10 15280     Centro         1  16.7
## 10 2020-03-12 15280     Centro         1  16.7</code></pre>
<p></p>
<p></p>
<div class="sourceCode" id="cb644"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## ------------------------------------------------</span>
<span class="co">## Uma alternativa seria fornecermos uma lista</span>
<span class="co">## contendo as tabelas a serem unidas:</span>

<span class="va">lista</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">savassi</span>, <span class="va">prado</span>, <span class="va">centro</span><span class="op">)</span>

<span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span><span class="op">(</span><span class="va">lista</span><span class="op">)</span></code></pre></div>
<p></p>
<p>Portanto, ao unir as linhas de cada tabela, a função <code><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows()</a></code> está de certa forma “empilhando” uma tabela em cima da outra. Mas para que este tipo de operação ocorra de maneira adequada, é <strong>importante que as colunas de todas as tabelas estejam nomeadas igualmente</strong>. Dito de outra forma, as tabelas envolvidas nesse cálculo, devem ser formadas pelo mesmo grupo de colunas. Essas colunas podem se encontrar em ordens diferentes ao longo das tabelas, mas elas precisam necessariamente estar nomeadas da mesma maneira. Caso alguma coluna em pelo menos uma das tabelas possua um nome diferente de seus pares, a função vai alocar os seus valores em uma coluna separada das demais, e isso geralmente não é o que você deseja.</p>
<p></p>
<div class="sourceCode" id="cb645"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">centro</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ProdutoID"</span>, <span class="st">"Loja"</span><span class="op">)</span>

<span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span><span class="op">(</span><span class="va">savassi</span>, <span class="va">prado</span>, <span class="va">centro</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 10 × 7
##    dia        produtoid loja    unidades valor ProdutoID Loja  
##    &lt;date&gt;     &lt;chr&gt;     &lt;chr&gt;      &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;     &lt;chr&gt; 
##  1 2020-03-01 10241     Savassi        1  15.5 &lt;NA&gt;      &lt;NA&gt;  
##  2 2020-03-02 10241     Savassi        2  31   &lt;NA&gt;      &lt;NA&gt;  
##  3 2020-03-03 10032     Savassi        1  12.4 &lt;NA&gt;      &lt;NA&gt;  
##  4 2020-03-04 15280     Savassi        1  16.7 &lt;NA&gt;      &lt;NA&gt;  
##  5 2020-03-10 15280     Prado          3  50.1 &lt;NA&gt;      &lt;NA&gt;  
##  6 2020-03-11 10032     Prado          4  49.6 &lt;NA&gt;      &lt;NA&gt;  
##  7 2020-03-12 10032     Prado          2  24.8 &lt;NA&gt;      &lt;NA&gt;  
##  8 2020-03-07 &lt;NA&gt;      &lt;NA&gt;           5  83.5 15280     Centro
##  9 2020-03-10 &lt;NA&gt;      &lt;NA&gt;           1  16.7 15280     Centro
## 10 2020-03-12 &lt;NA&gt;      &lt;NA&gt;           1  16.7 15280     Centro</code></pre>
<p></p>
<p>Por outro lado, quando estamos planejando unir tabelas a partir de suas colunas, a nossa preocupação principal deve ser com o número de linhas de cada tabela. Com isso, quando utilizar a função <code><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_cols()</a></code>, é <strong>essencial que as tabelas envolvidas possuam exatamente o mesmo número de linhas</strong>. Ou seja, no caso da função <code><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_cols()</a></code>, é primordial que as tabelas fornecidas à função, possuam o mesmo número de linhas, pois caso contrário, um erro será acionado pela função, e você não poderá prosseguir.</p>
<p>Tendo esse ponto em mente, você utiliza a função <code><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_cols()</a></code> do mesmo modo que a função <code><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows()</a></code>. Basta listar as tabelas a serem unidas dentro da função, ou fornecer uma lista contendo os <code>data.frame</code>’s a serem fundidos. Veja abaixo, um exemplo com as tabelas <code>tab1</code> e <code>tab2</code>.</p>
<p></p>
<div class="sourceCode" id="cb647"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tab1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>
  dia <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,
  valor <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span>
<span class="op">)</span>

<span class="va">tab2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>
  id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"104"</span>, <span class="st">"104"</span>, <span class="st">"105"</span>, <span class="st">"106"</span>, <span class="st">"106"</span><span class="op">)</span>,
  nome <span class="op">=</span> <span class="st">"Ana"</span>
<span class="op">)</span>

<span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_cols</a></span><span class="op">(</span><span class="va">tab1</span>, <span class="va">tab2</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 5 × 4
##     dia valor id    nome 
##   &lt;int&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;
## 1     1  1.13 104   Ana  
## 2     2  1.11 104   Ana  
## 3     3 -0.87 105   Ana  
## 4     4  0.21 106   Ana  
## 5     5  0.07 106   Ana</code></pre>
<p></p>
<p></p>
<div class="sourceCode" id="cb649"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## ------------------------------------------------</span>
<span class="co">## Uma alternativa seria fornecermos uma lista</span>
<span class="co">## contendo as tabelas a serem unidas:</span>

<span class="va">lista</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">tab1</span>, <span class="va">tab2</span><span class="op">)</span>

<span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_cols</a></span><span class="op">(</span><span class="va">lista</span><span class="op">)</span></code></pre></div>
<p></p>
</div>
<div id="exercícios-3" class="section level2 unnumbered">
<h2>Exercícios<a class="anchor" aria-label="anchor" href="#exerc%C3%ADcios-3"><i class="fas fa-link"></i></a>
</h2>
<p>Uma excelente forma de exercitar os conhecimentos adquiridos nesse capítulo é simplesmente brincar com bases de dados diferentes! Simplesmente, brinque! Tente encontrar fatos curiosos sobre cada base de dados. Faça perguntas (quantas pessoas se encaixam nessa categoria? Quantas mensagens foram enviadas durante esse dia? Qual é o custo médio de um curso de Medicina nos EUA?) e tente respondê-las com as funções que você descobriu nesse capítulo.</p>
<p>Por isso, a maioria dos exercícios a seguir são exercícios práticos, que pedem por uma informação específica a respeito dos dados contidos em uma determinada tabela (isto é, um <code>data.frame</code>). Para chegar a essa informação, você pode utilizar as funções do pacote <code>dplyr</code>. O código necessário para ter acesso a cada uma dessas tabelas será fornecido em cada questão.</p>
<p>O projeto <a href="https://github.com/rfordatascience/tidytuesday">TidyTuesday</a> é um ótimo lugar para encontrarmos diferentes bases de dados. Pois todas essas bases estão hospedadas na pasta do projeto no GitHub, e grande parte delas estão guardadas em arquivos de texto (<code>.txt</code>, <code>.csv</code>, <code>.fwf</code>, etc.), os quais podemos ler e importar diretamente da página do GitHub para o R, sem a necessidade de baixar arquivos manualmente. Em resumo, o Tidy Tuesday é um projeto onde os integrantes disponibilizam toda semana, uma base de dados diferente. Qualquer pessoa pode submeter uma base de dados para o projeto, incluindo ou não, artigos e materiais que possam instruir os usuários sobre como analisar e compreender os dados contidos nessa base.</p>
<p><strong>Questão 4.1.</strong> Antes de partirmos para as questões práticas, vamos exercitar o seu conhecimento sobre cada função mostrada nesse capítulo. Em cada item abaixo, eu forneço um conjunto de comandos. Cada conjunto inclui funções do pacote <code>dplyr</code> (como <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code>, etc.) e uma tabela específica logo no início dessa cadeia de comandos, além do operador <em>pipe</em> (<code>%&gt;%</code>) conectando cada uma das funções aplicadas. Seu trabalho é ler esse conjunto de comandos, e descrever mentalmente (ou escrever em algum papel) o que cada uma das funções aplicadas estão fazendo nessa cadeia. Em outras palavras, seu objetivo é descrever o papel que cada função desempenha nessa cadeia de comandos.</p>
<p>4.1.A) Descreva os comandos abaixo:</p>
<p></p>
<div class="sourceCode" id="cb650"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">starwars</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">sex</span>, <span class="va">eye_color</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">sex</span> <span class="op">==</span> <span class="st">"male"</span>, <span class="va">eye_color</span> <span class="op">==</span> <span class="st">"red"</span><span class="op">)</span></code></pre></div>
<p></p>
<p>4.1.B) Descreva os comandos abaixo:</p>
<p></p>
<div class="sourceCode" id="cb651"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">vec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"species"</span>, <span class="st">"homeworld"</span>, <span class="st">"films"</span>, <span class="st">"vehicles"</span>, <span class="st">"starships"</span><span class="op">)</span>

<span class="va">starwars</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html">all_of</a></span><span class="op">(</span><span class="va">vec</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">sex</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>peso_medio <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">mass</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p></p>
<p>4.1.C) Descreva os comandos abaixo:</p>
<p></p>
<div class="sourceCode" id="cb652"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mpg</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>
    pais_origem <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span>
      <span class="va">manufacturer</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"audi"</span>, <span class="st">"volkswagen"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"Alemanha"</span>,
      <span class="va">manufacturer</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"nissan"</span>, <span class="st">"honda"</span>,
                          <span class="st">"subaru"</span>, <span class="st">"toyota"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"Japão"</span>,
      <span class="va">manufacturer</span> <span class="op">==</span> <span class="st">"hyundai"</span> <span class="op">~</span> <span class="st">"Coréia do Sul"</span>,
      <span class="va">manufacturer</span> <span class="op">==</span> <span class="st">"land rover"</span> <span class="op">~</span> <span class="st">"Inglaterra"</span>,
      <span class="va">manufacturer</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"dodge"</span>, <span class="st">"jeep"</span>, 
                          <span class="st">"chevrolet"</span>, <span class="st">"ford"</span>,
                          <span class="st">"lincoln"</span>, <span class="st">"pontiac"</span>,
                          <span class="st">"mercury"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"EUA"</span>
    <span class="op">)</span>
  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">pais_origem</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>
    prop <span class="op">=</span> <span class="op">(</span> <span class="va">n</span> <span class="op">*</span> <span class="fl">100</span> <span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>
  <span class="op">)</span></code></pre></div>
<p></p>
<p><strong>Questão 4.2.</strong> Vamos começar pela base <code>tuition_income.csv</code>, referente a semana 11 do TidyTuesday em 2020. Com os comandos abaixo, você pode rapidamente importar essa base de dados para o seu R. Os dados contidos nessa base, descrevem um conjunto de universidades dos Estados Unidos durante o período de 2010 a 2018, e oferecendo informações como: nome da faculdade/universidade (<code>name</code>); estado em que ela se encontra (<code>state</code>); preço ou custo total (em dólares) exigido pela graduação na instituição (<code>total_price</code>); ano ao qual os valores se referem (<code>year</code>); fica localizada dentro do campus ou fora dele? (<code>campus</code>); custo total líquido (custo total menos bolsas de auxílio e prêmios) pago pela graduação na instituição (<code>net_cost</code>).</p>
<p></p>
<div class="sourceCode" id="cb653"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>

<span class="va">github</span> <span class="op">&lt;-</span> <span class="st">"https://raw.githubusercontent.com/rfordatascience/"</span>
<span class="va">arquivo</span> <span class="op">&lt;-</span> <span class="st">"tidytuesday/master/data/2020/2020-03-10/tuition_income.csv"</span>

<span class="va">dados</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">github</span>, <span class="va">arquivo</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p></p>
<p>4.2.A) Com esses dados em mão, tente descobrir as 10 universidades que sofreram os maiores aumentos de preços durante o período descrito na base.</p>
<p>4.2.B) Dado que você descubra a universidade que sofreu o maior aumento de preço dentre as 10 universidades descritas no item anterior, procure pelos dados dessa universidade ao longo da base. Com esses dados, discuta o momento em que houve a variação. Não tem resposta certa ou errada, apenas encontre os dados dessa universidade na base, e dê sua opinião sobre tamanha variação no preço dessa universidade.</p>
<p><strong>Questão 4.3.</strong> Caso você tenha chamado pelo pacote <code>dplyr</code> com sucesso em sua sessão, através do comando <code><a href="https://rdrr.io/r/base/library.html">library()</a></code>, você tem acesso à tabela <code>starwars</code>, que é utilizada nessa questão. Tendo a tabela <code>starwars</code> em mãos, da coluna 1 até a coluna 11, descubra qual a coluna do tipo <code>character</code> que possui o maior número de valores únicos (ou o maior número de “grupos”) ao longo da base.</p>
<p></p>
<div class="sourceCode" id="cb654"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">starwars</span></code></pre></div>
<pre><code>## # A tibble: 87 × 14
##    name   height  mass hair_…¹ skin_…² eye_c…³ birth…⁴ sex   gender homew…⁵
##    &lt;chr&gt;   &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;  
##  1 Luke …    172    77 blond   fair    blue       19   male  mascu… Tatooi…
##  2 C-3PO     167    75 &lt;NA&gt;    gold    yellow    112   none  mascu… Tatooi…
##  3 R2-D2      96    32 &lt;NA&gt;    white,… red        33   none  mascu… Naboo  
##  4 Darth…    202   136 none    white   yellow     41.9 male  mascu… Tatooi…
##  5 Leia …    150    49 brown   light   brown      19   fema… femin… Aldera…
##  6 Owen …    178   120 brown,… light   blue       52   male  mascu… Tatooi…
##  7 Beru …    165    75 brown   light   blue       47   fema… femin… Tatooi…
##  8 R5-D4      97    32 &lt;NA&gt;    white,… red        NA   none  mascu… Tatooi…
##  9 Biggs…    183    84 black   light   brown      24   male  mascu… Tatooi…
## 10 Obi-W…    182    77 auburn… fair    blue-g…    57   male  mascu… Stewjon
## # … with 77 more rows, 4 more variables: species &lt;chr&gt;, films &lt;list&gt;,
## #   vehicles &lt;list&gt;, starships &lt;list&gt;, and abbreviated variable names
## #   ¹​hair_color, ²​skin_color, ³​eye_color, ⁴​birth_year, ⁵​homeworld</code></pre>
<p></p>
<p><strong>Questão 4.4.</strong> Vamos agora, voltar rapidamente para a base de dados <code>transf</code> que visitamos ao longo deste capítulo. Lembre-se que você pode importar essa base diretamente para o seu R, ao copiar e colar os comandos abaixo.</p>
<p></p>
<div class="sourceCode" id="cb656"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>

<span class="va">github</span> <span class="op">&lt;-</span> <span class="st">"https://raw.githubusercontent.com/pedropark99/"</span>
<span class="va">pasta</span> <span class="op">&lt;-</span> <span class="st">"Curso-R/master/Dados/"</span>
<span class="va">arquivo</span> <span class="op">&lt;-</span> <span class="st">"transf_reform.csv"</span>

<span class="va">transf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv2</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">github</span>, <span class="va">pasta</span>, <span class="va">arquivo</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p></p>
<p>4.4.A) Qual é a receita média que o atendente Eduardo realiza com transferências destinadas à Alemanha?</p>
<p>4.4.B) Qual é o país de destino com o qual a atendente Ana mais trabalha?</p>
<p>4.4.C) Descubra quais foram as últimas transferências executadas por cada um dos 8 atendentes presentes em <code>transf</code>. Lembre-se que a coluna <code>Data</code> fornece o ponto do tempo em que a transferência foi executada.</p>

</div>
</div>

  <div class="chapter-nav">
<div class="prev"><a href="importando-e-exportando-dados-com-readr-readxl-e-haven.html"><span class="header-section-number">4</span> Importando e exportando dados com readr, readxl e haven</a></div>
<div class="next"><a href="introdu%C3%A7%C3%A3o-a-base-de-dados-relacionais-com-dplyr.html"><span class="header-section-number">6</span> Introdução a base de dados relacionais com dplyr</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#transformando-dados-com-dplyr"><span class="header-section-number">5</span> Transformando dados com dplyr</a></li>
<li><a class="nav-link" href="#introdu%C3%A7%C3%A3o-e-pr%C3%A9-requisitos"><span class="header-section-number">5.1</span> Introdução e pré-requisitos</a></li>
<li><a class="nav-link" href="#panorama-e-padr%C3%B5es-do-pacote-dplyr"><span class="header-section-number">5.2</span> Panorama e padrões do pacote dplyr</a></li>
<li>
<a class="nav-link" href="#operador-pipe-do-pacote-magrittr"><span class="header-section-number">5.3</span> Operador pipe do pacote magrittr (%&gt;%)</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#o-que-o-pipe-faz"><span class="header-section-number">5.3.1</span> O que o pipe faz ?</a></li>
<li><a class="nav-link" href="#o-que-o-pipe-n%C3%A3o-%C3%A9-capaz-de-fazer"><span class="header-section-number">5.3.2</span> O que o pipe não é capaz de fazer ?</a></li>
<li><a class="nav-link" href="#duas-dicas-r%C3%A1pidas-sobre-o-pipe"><span class="header-section-number">5.3.3</span> Duas dicas rápidas sobre o pipe</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#operador-pipe-nativo-do-r"><span class="header-section-number">5.4</span> Operador pipe nativo do R (|&gt;)</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#utilizando-o-operador-pipe-nativo-no-rstudio"><span class="header-section-number">5.4.1</span> Utilizando o operador pipe nativo no RStudio</a></li></ul>
</li>
<li><a class="nav-link" href="#selecionando-colunas-com-select"><span class="header-section-number">5.5</span> Selecionando colunas com select()</a></li>
<li>
<a class="nav-link" href="#filtrando-linhas-com-filter"><span class="header-section-number">5.6</span> Filtrando linhas com filter()</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#cuidados-com-o-operador-de-igualdade"><span class="header-section-number">5.6.1</span> Cuidados com o operador de igualdade</a></li>
<li><a class="nav-link" href="#estabelecendo-intervalos-com-a-fun%C3%A7%C3%A3o-between"><span class="header-section-number">5.6.2</span> Estabelecendo intervalos com a função between()</a></li>
<li><a class="nav-link" href="#sec:ataque_terrorista"><span class="header-section-number">5.6.3</span> Ataque terrorista</a></li>
<li><a class="nav-link" href="#condi%C3%A7%C3%B5es-dependentes-ou-independentes"><span class="header-section-number">5.6.4</span> Condições dependentes (&amp;) ou independentes (|) ?</a></li>
</ul>
</li>
<li><a class="nav-link" href="#ordenando-linhas-com-arrange"><span class="header-section-number">5.7</span> Ordenando linhas com arrange()</a></li>
<li><a class="nav-link" href="#sec:mutate_dplyr"><span class="header-section-number">5.8</span> Adicionando variáveis à sua tabela com mutate()</a></li>
<li><a class="nav-link" href="#sec:group_by_summarise"><span class="header-section-number">5.9</span> Agrupando dados com group_by() e gerando estatísticas sumárias com summarise()</a></li>
<li><a class="nav-link" href="#a-fun%C3%A7%C3%A3o-across-como-a-grande-novidade"><span class="header-section-number">5.10</span> A função across() como a grande novidade</a></li>
<li><a class="nav-link" href="#removendo-duplicatas-com-distinct"><span class="header-section-number">5.11</span> Removendo duplicatas com distinct()</a></li>
<li><a class="nav-link" href="#combinando-tabelas-com-bind_cols-e-bind_rows"><span class="header-section-number">5.12</span> Combinando tabelas com bind_cols() e bind_rows()</a></li>
<li><a class="nav-link" href="#exerc%C3%ADcios-3">Exercícios</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/pedropark99/Introducao_R//blob/main/04-transformacao.Rmd">View source <i class="fas fa-book-open"></i></a></li>
          <li><a id="book-edit" href="https://github.com/pedropark99/Introducao_R//edit/main/04-transformacao.Rmd">Edit this page <i class="fas fa-book-open"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Introdução à Linguagem R: seus fundamentos e sua prática</strong>" was written by Pedro Faria. It was last built on 2022-11-29.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
